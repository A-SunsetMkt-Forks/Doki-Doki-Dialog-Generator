var jn=Object.defineProperty,Pn=Object.defineProperties;var Tn=Object.getOwnPropertyDescriptors;var zo=Object.getOwnPropertySymbols;var _n=Object.prototype.hasOwnProperty,Bn=Object.prototype.propertyIsEnumerable;var Oe=(t,e,o)=>e in t?jn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,m=(t,e)=>{for(var o in e||(e={}))_n.call(e,o)&&Oe(t,o,e[o]);if(zo)for(var o of zo(e))Bn.call(e,o)&&Oe(t,o,e[o]);return t},S=(t,e)=>Pn(t,Tn(e));var f=(t,e,o)=>(Oe(t,typeof e!="symbol"?e+"":e,o),o);import{d as I,c as g,w as A,v as On,a,t as F,o as h,m as In,r as Ie,b as Uo,e as Jt,f as bt,F as _,g as E,h as j,n as W,i as O,j as v,k,l as w,T as Xo,p as y,q as ot,s as G,u as Y,x as C,y as K,z as Go,A as z,B as Yo,C as qo,K as Dn,D as Hn,E as An,G as Rn,H as Mn,I as Ko,J as Wn,L as Nn}from"./vendor.cc880211.js";const Vn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}};Vn();const Fn="modulepreload",Jo={},Ln="./",Zo=function(e,o){return!o||o.length===0?e():Promise.all(o.map(s=>{if(s=`${Ln}${s}`,s in Jo)return;Jo[s]=!0;const n=s.endsWith(".css"),i=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${i}`))return;const r=document.createElement("link");if(r.rel=n?"stylesheet":Fn,n||(r.as="script",r.crossOrigin=""),r.href=s,document.head.appendChild(r),n)return new Promise((l,d)=>{r.addEventListener("load",l),r.addEventListener("error",d)})})).then(()=>e())};var D=(t,e)=>{const o=t.__vccOpts||t;for(const[s,n]of e)o[s]=n;return o};const En=I({props:{label:String,modelValue:{type:Boolean,default:!1}},computed:{value:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},checkbox(){return this.$refs.checkbox}}}),zn={class:"toggle_box"},Un=["id"],Xn=["for"],Gn=["for"];function Yn(t,e,o,s,n,i){return h(),g("div",zn,[A(a("input",{id:t._.uid,type:"checkbox",ref:"checkbox","onUpdate:modelValue":e[0]||(e[0]=r=>t.value=r)},null,8,Un),[[On,t.value]]),a("label",{for:t._.uid,class:"switch"},null,8,Xn),a("label",{for:t._.uid,class:"toggle_label"},F(t.label),9,Gn)])}var nt=D(En,[["render",Yn]]);const qn=25,De={methods:{verticalScrollRedirect(t){if(t.type!=="wheel"||!t.currentTarget)return;const e=t.currentTarget,o=getComputedStyle(e),s=t;if(s.deltaY===0)return;if(o.overflowY==="auto"){if(s.deltaY>0){if(e.scrollHeight>e.scrollTop+e.clientHeight){t.stopPropagation();return}}else if(e.scrollTop>0){t.stopPropagation();return}}const n=e.scrollLeft;s.mozInputSource?e.scrollLeft+=s.deltaY*qn:e.scrollLeft+=s.deltaY,e.scrollLeft!==n&&t.stopPropagation()}}},Q={mixins:[De],computed:{vertical(){return this.$store.state.ui.vertical}},mounted(){this.updateVertical(),this.$el.addEventListener("wheel",t=>{this.vertical||this.verticalScrollRedirect(t)},{passive:!0})},methods:{updateVertical(){!this.$el||(this.vertical?this.$el.classList.add("vertical"):this.$el.classList.remove("vertical"))}},watch:{vertical(){this.updateVertical()}}},He=In();var U={fire(t){He.emit(t.kind,t)},subscribe(t,e){He.on(t.kind,e)},unsubscribe(t,e){He.off(t.kind,e)}};class Ae{constructor(e){f(this,"kind","AssetFailureEvent");this.path=e}}f(Ae,"kind","AssetFailureEvent");class Re{constructor(e){f(this,"kind","FailureEvent");this.message=e}}f(Re,"kind","FailureEvent");class Me{constructor(e){f(this,"kind","CustomAssetFailureEvent");this.error=e}}f(Me,"kind","CustomAssetFailureEvent");class Qo{constructor(){f(this,"kind","InvalidateRenderEvent")}}f(Qo,"kind","InvalidateRenderEvent");class lt{constructor(e){f(this,"kind","ShowMessageEvent");this.message=e}}f(lt,"kind","ShowMessageEvent");class re{constructor(e){f(this,"kind","ColorPickedEvent");this.color=e}}f(re,"kind","ColorPickedEvent");class ts{constructor(e,o){f(this,"kind","VueErrorEvent");this.error=e,this.info=o}}f(ts,"kind","VueErrorEvent");const Kn="https://edave64.github.io/Doki-Doki-Dialog-Generator-Packs/",Z=class{constructor(e,o,s){f(this,"onlineRepo");f(this,"localRepo");f(this,"tempRepo",Jt({authors:{},packs:[]}));f(this,"combinedList");f(this,"authors");this.$store=s,window.repo=this,e||(e={authors:{},packs:[]},U.fire(new lt("Couldn't load remote repository."))),o||(o={authors:{},packs:[]},R.supports.localRepo&&U.fire(new lt("Couldn't load local repository."))),this.onlineRepo=Ie(e),this.localRepo=Ie(o),this.combinedList=Uo(()=>{var V,_t;const n=this.onlineRepo.value,i=(V=n==null?void 0:n.packs)!=null?V:[],r=new Map(i.map(B=>[B.id,B])),l=this.localRepo.value,d=(_t=l==null?void 0:l.packs)!=null?_t:[],c=new Map(d.map(B=>[B.id,B])),p=this.tempRepo.packs,b=new Map(p.map(B=>[B.id,B])),T=new Set(R.state.autoAdd),x=this.$store.state.content.contentPacks.map(B=>B.packId).filter(B=>!!B),$=new Set(x),et=new Set;return[...x,...d.map(B=>B.id),...i.map(B=>B.id),...p.map(B=>B.id)].filter(B=>B.startsWith("dddg.buildin.")||B.startsWith("dddg.desktop.")||et.has(B)?!1:(et.add(B),!0)).map(B=>{var L,kt,gt;return S(m(m(m({},(L=r.get(B))!=null?L:{characters:[],kind:[],authors:[]}),(kt=c.get(B))!=null?kt:{}),(gt=b.get(B))!=null?gt:{}),{autoloading:T.has(B),installed:c.has(B),online:r.has(B)||b.has(B),loaded:$.has(B)})})}),this.authors=Uo(()=>{var d,c;const n=this.onlineRepo.value,i=(d=n==null?void 0:n.authors)!=null?d:{},r=this.localRepo.value,l=(c=r==null?void 0:r.authors)!=null?c:{};return m(m({},i),l)}),Object.freeze(this)}static getInstance(){return Z.instance||(Z.instance=this.createInstance()),Z.instance}static async createInstance(){const e=Z.loadRepo(Kn),o=R.supports.localRepo?await Z.loadRepo(R.localRepositoryUrl):null,[s,n,i]=await Promise.all([e,o,Z.$store]);return new Z(s,n,i)}static async loadRepo(e){try{const[o,s]=await Promise.all([Z.fetchJSON(e+"repo.json"),Z.fetchJSON(e+"people.json")]);return{packs:o,authors:s}}catch{return null}}static async fetchJSON(e){const o=await fetch(e);if(!o.ok)throw new Error("Could not load json");return await o.json()}async reloadLocalRepo(){this.localRepo.value=R.supports.localRepo?await Z.loadRepo(R.localRepositoryUrl):null}getPacks(){return this.combinedList.value}hasPack(e){return!!this.getPacks().find(o=>o.id===e)}getPack(e){return this.getPacks().find(o=>o.id===e)}getAuthor(e){return this.authors.value[e]||null}getAuthors(){return this.authors.value}async loadTempPack(e){const o=fetch(e);let s;try{s=await o}catch{throw new Error(`Failed to load '${e}'`)}let n;try{n=await s.json()}catch(l){throw new Error(`The contents of '${e}' is not a valid JSON: ${l.message}`)}if(!n.pack)throw new Error(`The json file '${e}' does not contain any packages`);if(n.authors)for(const l in n.authors)this.tempRepo.authors[l]&&(this.tempRepo.authors[l]=n.authors[l]);const i=n.pack;let r=i.id;return i.repoUrl=e,this.tempRepo.packs.find(l=>l.id===i.id)||this.tempRepo.packs.push(i),r}};let mt=Z;f(mt,"instance"),f(mt,"setStore"),f(mt,"$store",new Promise((e,o)=>{Z.setStore=e}));class es{constructor(){f(this,"state",Jt({autoAdd:[],downloadLocation:"Default download folder"}));f(this,"supports");f(this,"_gameMode",null);f(this,"vuexHistory",null);f(this,"$store",null);f(this,"isSavingEnabled",Ie(!1));f(this,"localRepositoryUrl","");f(this,"loading");f(this,"creatingDB");const e=this,o=X.canSave();window.addEventListener("beforeunload",function(s){s.preventDefault(),s.returnValue="Are you sure you want to leave? All your progress will be lost!"}),this.supports=Jt({optionalSaving:o,get autoLoading(){return o&&e.isSavingEnabled.value},backgroundInstall:!1,localRepo:!1,lq:!0,setDownloadFolder:!1,openableFolders:new Set([])}),o?this.loading=(async()=>{this.savingEnabled=await X.doesDbExists()})():this.loading=Promise.resolve(),this.loading.then(async()=>{if(this.creatingDB&&await this.creatingDB,this.savingEnabled){const s=await X.loadAutoload()||[];this.state.autoAdd=s;const n=await mt.getInstance(),i=await Promise.all(s.map(async r=>{const[l,d]=r.split(";",2);d&&!n.hasPack(l)&&await n.loadTempPack(d);const c=n.getPack(l);return c.dddg2Path||c.dddg1Path}));await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/loadContentPacks",i)})}})}get gameMode(){return this._gameMode}get savingEnabled(){return this.isSavingEnabled.value}set savingEnabled(e){e?(localStorage.setItem("saving","true"),this.creatingDB=X.createDB(),this.creatingDB.then(()=>{this.creatingDB=void 0,this.isSavingEnabled.value=!0}).catch(()=>{})):(localStorage.clear(),this.isSavingEnabled.value=!1,this.creatingDB=X.clearDB().then(()=>{this.creatingDB=void 0}).catch(()=>{}))}async loadGameMode(){const o=new URLSearchParams(location.search).get("mode");if(o==="ddlc"||o==="ddlc_plus"){this._gameMode=o;return}await this.loading,await this.creatingDB;let s="";this.isSavingEnabled.value&&(s=await X.loadGameMode());let n="ddlc";(s==="ddlc"||s==="ddlc_plus")&&(n=s),this._gameMode=n}async saveGameMode(e){this.isSavingEnabled.value&&await X.saveGameMode(e)}updateDownloadFolder(){throw new Error("Method not implemented.")}openFolder(e){throw new Error("Method not implemented.")}connectToStore(e,o){this.vuexHistory=e,this.$store=o}async saveToFile(e,o,s="image/png",n=1){const i=document.createElement("a");i.setAttribute("download",o);const r=await this.createObjectURL(e,s,n);return i.setAttribute("href",r),document.body.appendChild(i),i.click(),document.body.removeChild(i),r}installBackground(e){throw new Error("This environment does not support installing backgrounds")}uninstallBackground(e){throw new Error("This environment does not support uninstalling backgrounds")}localRepoInstall(e,o,s){throw new Error("This environment does not support a local repository")}localRepoUninstall(e){throw new Error("This environment does not support a local repository")}async autoLoadAdd(e){await this.loading,await this.creatingDB,await X.saveAutoload([...this.state.autoAdd,e]),this.state.autoAdd.push(e)}async autoLoadRemove(e){await this.loading,await this.creatingDB;const o=this.normalizePackId(e);await X.saveAutoload(this.state.autoAdd.filter(n=>this.normalizePackId(n)!=o));const s=this.state.autoAdd.indexOf(e);this.state.autoAdd.splice(s,1)}normalizePackId(e){const o=e.split(";");return o.length===1?o[0]:o[o.length-1]}async loadSettings(){await this.loading,await this.creatingDB;const e={darkMode:void 0,lq:!0,nsfw:!1,defaultCharacterTalkingZoom:!0};return this.isSavingEnabled.value?m(m({},e),await X.loadSettings()):e}async saveSettings(e){await this.loading,await this.creatingDB,!!this.isSavingEnabled.value&&await X.saveSettings(e)}async isInitialized(){await this.loading,await this.creatingDB}prompt(e,o){return new Promise((s,n)=>{s(prompt(e,o))})}onPanelChange(e){}createObjectURL(e,o,s){return new Promise((n,i)=>{if(!!!(window.URL&&window.URL.createObjectURL))return n(e.toDataURL(o,s));if(e.toBlob)e.toBlob(l=>{if(!l){i();return}n(URL.createObjectURL(l))},o,s);else{const l=e.toDataURL(o,s),d=this.dataURItoBlob(l,o);n(URL.createObjectURL(d))}})}dataURItoBlob(e,o){const s=atob(e.split(",")[1]),n=s.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=s.charCodeAt(r);return new Blob([i],{type:o})}}const X={indexedDB:(()=>{try{return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB}catch{return null}})(),transaction:(()=>{try{return window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction}catch{return null}})(),db:null,canSave(){return!!(X.indexedDB&&window.localStorage)},doesDbExists(){return localStorage.getItem("saving")==="true"?Promise.resolve(!0):Promise.resolve(!1)},createDB(){return X.db?X.db:X.db=new Promise((t,e)=>{const o=X.indexedDB.open("dddg",3);o.onerror=s=>{e(s)},o.onupgradeneeded=s=>{var r;const n=s.target.result,i=(r=s.oldVersion)!=null?r:s.version;i<1&&n.createObjectStore("settings"),i===1&&(n.deleteObjectStore("settings"),n.createObjectStore("settings"))},o.onsuccess=s=>{t(o.result)}})},clearDB(){return new Promise((t,e)=>{if(!X.db){t();return}const o=X.indexedDB.deleteDatabase("dddg");X.db=null,o.onerror=s=>{e(s)},o.onsuccess=s=>{t()}})},loadAutoload(){return this.objectStorePromise("readonly",async t=>await this.reqPromise(t.get("autoload")))},saveAutoload(t){return this.objectStorePromise("readwrite",async e=>{await this.reqPromise(e.put([...t],"autoload"))})},loadGameMode(){return this.objectStorePromise("readonly",async t=>await this.reqPromise(t.get("gameMode")))},saveGameMode(t){return this.objectStorePromise("readwrite",async e=>{await this.reqPromise(e.put(t,"gameMode"))})},saveSettings(t){return this.objectStorePromise("readwrite",async e=>{await this.reqPromise(e.put(m({},t),"settings"))})},loadSettings(){return this.objectStorePromise("readonly",async t=>await this.reqPromise(t.get("settings")))},objectStorePromise(t,e){return this.db?new Promise(async(o,s)=>{const i=(await this.db).transaction(["settings"],t).objectStore("settings");try{o(await e(i))}catch(r){s(r)}}):Promise.reject(new Error("No database"))},reqPromise(t){return new Promise((e,o)=>{t.onerror=s=>{o(s)},t.onsuccess=s=>{e(t.result)}})}};class Jn extends es{async saveToFile(e,o,s="image/png",n=1){let i=e.toDataURL(s,n);const r=this.dataURItoBlob(i,s);return window.URL&&window.URL.createObjectURL&&(i=URL.createObjectURL(r)),window.navigator.msSaveBlob(r,o),i}}class os{}let We,Ne;function Bt(){return We||(We=new Promise((t,e)=>{const o="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=",s=document.createElement("img");s.addEventListener("load",()=>{t(s.width===2&&s.height===1)}),s.addEventListener("error",()=>{t(!1)}),s.src=o})),We}function Zn(){return Ne||(Ne=new Promise((t,e)=>{const o="data:image/heic;base64,AAAAGGZ0eXBoZWljAAAAAG1pZjFoZWljAAAAsW1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAHBpY3QAXABjAGMAcwBsAGEAAAAADnBpdG0AAAAAAAEAAAAQaWxvYwAAAABEQAAAAAAAI2lpbmYAAAAAAAEAAAAVaW5mZQIAAAAAAQAAaHZjMQAAAABDaXBycAAAACdpcGNvAAAAH2h2Y0NmzGx1ci0AAAAAAABv9HP+//v9bjr3AAAAABRpcG1hAAAAAAAAAAEAAQGBAAAACG1kYXQ=",s=document.createElement("img");s.addEventListener("load",()=>{console.log("Heif no error. "+(s.width===2&&s.height===1)),t(s.width===2&&s.height===1)}),s.addEventListener("error",()=>{console.log("Heif not supported"),t(!1)}),s.src=o})),Ne}const ae={},Ve={};function Ot(t,e=!0){return Fe(R.supports.lq&&!e?t.lq:t.hq)}async function Fe(t){return ae[t]||(ae[t]=new Promise((e,o)=>{const s=new Image;s.addEventListener("load",()=>{e(s)}),s.addEventListener("error",()=>{U.fire(new Ae(t)),ae[t]=void 0,e(new os)}),s.crossOrigin="Anonymous",s.src=t,s.style.display="none",document.body.appendChild(s)})),ae[t]}const Qn="./";async function dt(t,e=!0){if(Ve[t])return Ve[t];const o=`${Qn}/assets/${t}${e?"":".lq"}${await Bt()?".webp":".png"}`.replace(/\/+/,"/");return await Fe(o)}function ti(t,e){const o=URL.createObjectURL(e);return Le(t,o),o}function Le(t,e){return Ve[t]=new Promise((o,s)=>{const n=new Image;n.addEventListener("load",()=>{o(n)}),n.addEventListener("error",i=>{U.fire(new Me(i)),s(`Failed to load "${e}"`)}),n.crossOrigin="Anonymous",n.src=e,n.style.display="none",document.body.appendChild(n)})}const ss={packId:"dddg.buildin.installedBackgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]};class ei{constructor(){f(this,"state",Jt({autoAdd:[],downloadLocation:""}));f(this,"localRepositoryUrl","/repo/");f(this,"_gameMode",null);f(this,"electron",window);f(this,"vuexHistory",null);f(this,"$store",null);f(this,"bgInvalidation",null);f(this,"pendingContentPacks",[]);f(this,"supports",{autoLoading:!0,backgroundInstall:!0,localRepo:!0,lq:!1,optionalSaving:!1,setDownloadFolder:!0,openableFolders:new Set(["downloads","backgrounds","sprites"])});f(this,"savingEnabled",!0);this.electron.ipcRenderer.on("add-persistent-content-pack",async e=>{if(!this.$store||!this.vuexHistory){this.pendingContentPacks.push(e);return}await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/loadContentPacks",e)})}),this.electron.ipcRenderer.on("add-persistent-background",async e=>{const o="persistentBg-"+e,s=e.split("/");await Le(o,e),ss.backgrounds.push({id:o,variants:[[o]],label:s[s.length-1],scaling:"none"}),this.invalidateInstalledBGs()}),this.electron.ipcRenderer.on("push-message",async e=>{U.fire(new lt(e))}),this.electron.ipcRenderer.on("config.downloadFolderUpdate",async e=>{this.state.downloadLocation=e}),this.electron.ipcRenderer.onConversation("load-packs",async e=>{const o=await mt.getInstance(),s=e.map(n=>{const i=o.getPack(n);return i.dddg2Path||i.dddg1Path});await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/loadContentPacks",s)})}),this.electron.ipcRenderer.onConversation("auto-load.changed",async e=>{this.state.autoAdd=e}),this.electron.ipcRenderer.onConversation("reload-repo",async()=>{await(await mt.getInstance()).reloadLocalRepo()}),this.electron.ipcRenderer.onConversation("replace-pack",async e=>{await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/replaceContentPack",{processed:!1,contentPack:e})})}),this.electron.ipcRenderer.send("init-dddg")}get gameMode(){return this._gameMode}updateDownloadFolder(){this.electron.ipcRenderer.send("config.newDownloadFolder")}openFolder(e){this.electron.ipcRenderer.send("open-folder",e)}onPanelChange(e){}async saveSettings(e){var o;await this.electron.ipcRenderer.sendConvo("config.set","nsfw",e.nsfw),await this.electron.ipcRenderer.sendConvo("config.set","darkMode",(o=e.darkMode)!=null?o:void 0),await this.electron.ipcRenderer.sendConvo("config.set","defaultCharacterTalkingZoom",e.defaultCharacterTalkingZoom)}async loadGameMode(){this._gameMode=await this.electron.ipcRenderer.sendConvo("config.get","gameMode")||"ddlc"}async saveGameMode(e){await this.electron.ipcRenderer.sendConvo("config.set","gameMode",e)}async loadSettings(){var e,o,s;return{lq:!1,nsfw:(e=await this.electron.ipcRenderer.sendConvo("config.get","nsfw"))!=null?e:!1,darkMode:(o=await this.electron.ipcRenderer.sendConvo("config.get","darkMode"))!=null?o:void 0,defaultCharacterTalkingZoom:(s=await this.electron.ipcRenderer.sendConvo("config.get","defaultCharacterTalkingZoom"))!=null?s:void 0}}async localRepoInstall(e,o,s){await this.electron.ipcRenderer.sendConvo("repo.install",e,o,s)}async localRepoUninstall(e){await this.electron.ipcRenderer.sendConvo("repo.uninstall",e)}async autoLoadAdd(e){await this.electron.ipcRenderer.sendConvo("auto-load.add",e)}async autoLoadRemove(e){await this.electron.ipcRenderer.sendConvo("auto-load.remove",e)}saveToFile(e,o,s="image/png",n=1){return new Promise((i,r)=>{e.toBlob(async l=>{if(!l){r();return}const d=await l.arrayBuffer();await this.electron.ipcRenderer.sendConvo("save-file",o,new Uint8Array(d)),i(URL.createObjectURL(l))},s,n)})}async installBackground(e){if(e.assets.length!==1||e.assets[0].sourcePack!=="dddg.buildin.uploadedBackgrounds")return;const o=await dt(e.assets[0].hq,!0);if(!(o instanceof HTMLImageElement))return;const s=await fetch(o.src),n=new Uint8Array(await s.arrayBuffer());this.electron.ipcRenderer.send("install-background",n)}async uninstallBackground(e){if(e.assets.length!==1||e.assets[0].sourcePack!=="dddg.buildin.installedBackgrounds")return;const o=await dt(e.assets[0].hq,!0);if(o instanceof HTMLImageElement){if(!o.src.startsWith("blob:")){const n=await(await fetch(o.src)).blob(),i=URL.createObjectURL(n);await Le(e.assets[0].hq,i)}this.electron.ipcRenderer.send("uninstall-background",e.id)}}async prompt(e,o){return await this.electron.ipcRenderer.sendConvo("show-prompt",e,o)}connectToStore(e,o){this.vuexHistory=e,this.$store=o,this.invalidateInstalledBGs(),this.pendingContentPacks.length>0&&this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/loadContentPacks",this.pendingContentPacks)})}invalidateInstalledBGs(){!this.vuexHistory||!this.$store||this.bgInvalidation===null&&(this.bgInvalidation=requestAnimationFrame(()=>{this.updateInstalledBGs()}))}updateInstalledBGs(){this.bgInvalidation&&(cancelAnimationFrame(this.bgInvalidation),this.bgInvalidation=null),!(!this.vuexHistory||!this.$store)&&this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/replaceContentPack",{contentPack:ss})})}}function oi(){return window.isElectron?new ei:window.navigator.msSaveOrOpenBlob!==void 0?new Jn:new es}const ns=oi();window.toast=ns;var R=ns;const si=I({props:{noBaseSize:Boolean,options:{type:Array,default:[]}}}),ni={key:0,id:"submit-options"},ii=["onClick"];function ri(t,e,o,s,n,i){return h(),g("div",{class:"dialog-wrapper",onClick:e[1]||(e[1]=r=>t.$emit("leave"))},[a("dialog",{open:"",class:W({"base-size":!t.noBaseSize}),onClick:e[0]||(e[0]=O(()=>{},["stop"]))},[bt(t.$slots,"default",{},void 0,!0),t.options.length>0?(h(),g("div",ni,[(h(!0),g(_,null,E(t.options,r=>(h(),g("button",{key:r,class:"option",onClick:l=>t.$emit("option",r)},F(r),9,ii))),128))])):j("",!0)],2)])}var Ee=D(si,[["render",ri],["__scopeId","data-v-21abd0f3"]]);const ai=I({mixins:[De],props:{to:{type:String,required:!0}},computed:{href(){let t=this.to;return t=t.replace(/^github:\/\//,"https://github.com/edave64/Doki-Doki-Dialog-Generator/"),t=t.replace(/^wiki:\/\/(.*)/,(e,o)=>"https://github.com/edave64/Doki-Doki-Dialog-Generator/wiki/Version-2:-"+o.replaceAll(" ","-")),t}}}),li=["href"];function di(t,e,o,s,n,i){return h(),g("a",{target:"_blank",rel:"noopener noreferrer",href:t.href},[bt(t.$slots,"default")],8,li)}var ze=D(ai,[["render",di]]);async function ci(t,e){try{await e()}catch(o){console.error("Error in promise",t,o),U.fire(new Re("Unexpected error! Please copy the following message and send it to /u/edave64: Error in '"+t+'", '+ui(o)))}}function ui(t){if(t instanceof Error){if(t.stack){const e=t.stack.split(`
`);return e[0].includes(t.name)&&e[0].includes(t.message)?e[0]+`
<br />`+e[1]:t.name+": "+t.message+`
<br />`+e[0]}return t.name+": "+t.message}return t instanceof Object?JSON.stringify(t):""+t}const hi=I({mixins:[Q],components:{Toggle:nt,ModalDialog:Ee,L:ze},data:()=>({allowSavesModal:!1,denySavesModal:!1,waitOnSaveChange:!1,showModeDialog:!1}),computed:{savesAllowed:{get(){return R.savingEnabled},set(t){this.waitOnSaveChange=!0,R.savingEnabled=t,this.saveSettings()}},inPlusMode(){return R.gameMode==="ddlc_plus"},savesEnabledInEnv(){return R.supports.optionalSaving},lqAllowed(){return R.supports.lq},lqRendering:{get(){return this.$store.state.ui.lqRendering},set(t){this.vuexHistory.transaction(async()=>{await this.$store.commit("ui/setLqRendering",t)}),this.saveSettings()}},nsfw:{get(){return!!this.$store.state.ui.nsfw},set(t){this.vuexHistory.transaction(async()=>{await this.$store.commit("ui/setNsfw",t),this.saveSettings()})}},defaultCharacterTalkingZoom:{get(){return!!this.$store.state.ui.defaultCharacterTalkingZoom},set(t){this.vuexHistory.transaction(async()=>{await this.$store.commit("ui/setDefaultCharacterTalkingZoom",t),this.saveSettings()})}},theme:{get(){return this.$store.state.ui.useDarkTheme},set(t){this.vuexHistory.transaction(async()=>{await this.$store.commit("ui/setDarkTheme",t),this.saveSettings()})}},showDownloadFolder(){return R.supports.setDownloadFolder},downloadFolder(){return R.state.downloadLocation}},watch:{savesAllowed(){this.waitOnSaveChange=!1}},methods:{allowSaves(t){this.allowSavesModal=!1,t==="Allow"&&(this.savesAllowed=!0)},denySaves(t){this.denySavesModal=!1,t==="Deny"&&(this.savesAllowed=!1)},modeChange(t){ci("changing modes",async()=>{const e=`${location.protocol}//${location.host}${location.pathname}`;t==="Enter Classic Mode"?(await R.saveGameMode("ddlc"),location.href=`${e}?mode=ddlc`):t==="Enter Plus mode"&&(await R.saveGameMode("ddlc_plus"),location.href=`${e}?mode=ddlc_plus`)})},saveSettings(){var t;R.saveSettings({lq:this.$store.state.ui.lqRendering,nsfw:this.$store.state.ui.nsfw,darkMode:(t=this.$store.state.ui.useDarkTheme)!=null?t:void 0,defaultCharacterTalkingZoom:this.$store.state.ui.defaultCharacterTalkingZoom})},setDownloadFolder(){R.updateDownloadFolder()},openDownloadFolder(){R.openFolder("downloads")}}}),tt=t=>(G("data-v-6f19e1f9"),t=t(),Y(),t),pi={class:"panel"},fi=tt(()=>a("h1",null,"Settings",-1)),gi={class:"modal-scroll-area"},bi=tt(()=>a("p",null," Do you want to allow DDDG to save settings on your device? ",-1)),mi=tt(()=>a("p",null," By choosing to enable saving settings, DDDG can save data to your device, and nowhere else. However, your browser and any installed browser extensions might possibly read and send this data to other servers, e.g. to sync between devices. This is outside of our control. But in general, we recommend only using browsers and browser extensions that you trust with your personal data. ",-1)),yi=tt(()=>a("p",null," You can revoke this permission at any time. ",-1)),vi=C(" Our usual "),wi=C("privacy policy"),Ci=C(" still applies. "),$i={class:"modal-scroll-area"},ki=tt(()=>a("p",null," Do you want to deny DDDG from saving settings on your device? ",-1)),xi=tt(()=>a("p",null," This will cause all your settings to reset when leaving the page. ",-1)),Si=C(" Our usual "),ji=C("privacy policy"),Pi=C(" still applies. "),Ti=tt(()=>a("div",{class:"modal-scroll-area"},[a("p",null," WARNING: Swiching modes will discard everything you have done in this session. All dialouge will be lost! ")],-1)),_i={key:0,disabled:""},Bi=C(" Enter Classic Mode "),Oi=C(" Enter DDLC Plus Mode "),Ii=tt(()=>a("td",null,[a("label",null,"Theme:")],-1)),Di=tt(()=>a("option",{value:null},"System",-1)),Hi=tt(()=>a("option",{value:!1},"Light",-1)),Ai=tt(()=>a("option",{value:!0},"Dark",-1)),Ri=[Di,Hi,Ai],Mi={key:4,class:"downloadTable"},Wi=tt(()=>a("td",null,[a("label",null,"Download folder:")],-1));function Ni(t,e,o,s,n,i){const r=v("l"),l=v("modal-dialog"),d=v("toggle");return h(),g("div",pi,[fi,(h(),k(Xo,{to:"#modal-messages"},[t.allowSavesModal?(h(),k(l,{key:0,options:["Allow","Deny"],onLeave:e[0]||(e[0]=c=>t.allowSaves("Deny")),onOption:t.allowSaves,"no-base-size":""},{default:w(()=>[a("div",gi,[bi,mi,yi,a("p",null,[vi,y(r,{to:"wiki://Privacy Statement"},{default:w(()=>[wi]),_:1}),Ci])])]),_:1},8,["onOption"])):j("",!0),t.denySavesModal?(h(),k(l,{key:1,options:["Deny","Cancle"],onLeave:e[1]||(e[1]=c=>t.denySaves("Cancle")),onOption:t.denySaves,"no-base-size":""},{default:w(()=>[a("div",$i,[ki,xi,a("p",null,[Si,y(r,{to:"wiki://Privacy Statement"},{default:w(()=>[ji]),_:1}),Pi])])]),_:1},8,["onOption"])):j("",!0),t.showModeDialog?(h(),k(l,{key:2,options:[t.inPlusMode?"Enter Classic Mode":"Enter Plus mode","Stay"],onLeave:e[2]||(e[2]=c=>t.showModeDialog=!1),onOption:t.modeChange,"no-base-size":""},{default:w(()=>[Ti]),_:1},8,["options","onOption"])):j("",!0)])),t.waitOnSaveChange?(h(),g("button",_i," Applying... ")):!t.savesAllowed&&t.savesEnabledInEnv?(h(),g("button",{key:1,onClick:e[3]||(e[3]=c=>t.allowSavesModal=!0)}," Allow saving options ")):t.savesAllowed&&t.savesEnabledInEnv?(h(),g("button",{key:2,onClick:e[4]||(e[4]=c=>t.denySavesModal=!0)}," Deny saving options ")):j("",!0),a("button",{onClick:e[5]||(e[5]=c=>t.showModeDialog=!0)},[t.inPlusMode?(h(),g(_,{key:0},[Bi],64)):(h(),g(_,{key:1},[Oi],64))]),t.lqAllowed?(h(),k(d,{key:3,label:"Low quality preview?",title:"Reduces the quality of the preview images to speed up the user experience and consume less data. Does not effect final render.",modelValue:t.lqRendering,"onUpdate:modelValue":e[6]||(e[6]=c=>t.lqRendering=c)},null,8,["modelValue"])):j("",!0),y(d,{label:"NSFW Mode?",modelValue:t.nsfw,"onUpdate:modelValue":e[7]||(e[7]=c=>t.nsfw=c)},null,8,["modelValue"]),y(d,{label:"Enlarge talking objects? (Default value)",modelValue:t.defaultCharacterTalkingZoom,"onUpdate:modelValue":e[8]||(e[8]=c=>t.defaultCharacterTalkingZoom=c)},null,8,["modelValue"]),a("table",null,[a("tr",null,[Ii,a("td",null,[A(a("select",{"onUpdate:modelValue":e[9]||(e[9]=c=>t.theme=c)},Ri,512),[[ot,t.theme]])])])]),t.showDownloadFolder?(h(),g("table",Mi,[a("tr",null,[Wi,a("td",null,F(t.downloadFolder),1),a("td",null,[a("button",{onClick:e[10]||(e[10]=(...c)=>t.setDownloadFolder&&t.setDownloadFolder(...c))}," Set "),a("button",{onClick:e[11]||(e[11]=(...c)=>t.openDownloadFolder&&t.openDownloadFolder(...c))}," Open ")])])])):j("",!0)])}var Vi=D(hi,[["render",Ni],["__scopeId","data-v-6f19e1f9"]]);const Fi=I({computed:{vertical(){return this.$store.state.ui.vertical}},data:()=>({visible:!1}),methods:{show(){this.visible=!0},hide(){this.visible=!1},drop(t){if(this.hide(),t.stopPropagation(),t.preventDefault(),!!t.dataTransfer)for(const e of t.dataTransfer.items)e.kind==="file"&&e.type.match(/image.*/)&&this.$emit("drop",e.getAsFile())}}});function Li(t,e,o,s,n,i){return t.visible?(h(),g("div",{key:0,onDragleave:e[0]||(e[0]=r=>t.visible=!1),onDrop:e[1]||(e[1]=(...r)=>t.drop&&t.drop(...r)),class:W({vertical:t.vertical})},[bt(t.$slots,"default",{},void 0,!0)],34)):j("",!0)}var is=D(Fi,[["render",Li],["__scopeId","data-v-5ea72163"]]);const Ei=I({props:{icon:{type:String,required:!0},iconPos:{type:String,default:"left"},disabled:{type:Boolean,default:!1}}}),zi=["disabled"],Ui={class:"material-icons","aria-hidden":"true"},Xi={class:"content"};function Gi(t,e,o,s,n,i){return h(),g("button",{class:W([t.iconPos]),disabled:t.disabled},[a("div",Ui,F(t.icon),1),a("div",Xi,[bt(t.$slots,"default",{},void 0,!0)])],10,zi)}var le=D(Ei,[["render",Gi],["__scopeId","data-v-0588b632"]]);const rs={packId:"dddg.buildin.uploadedSprites",packCredits:[""],dependencies:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},Yi=I({mixins:[Q],components:{DropTarget:is,DButton:le},data:()=>({isWebPSupported:null,customAssetCount:0,group:"characters"}),computed:{characters(){return this.$store.state.content.current.characters},sprites(){return this.$store.state.content.current.sprites},hasClipboardContent(){return!!this.$store.state.ui.clipboard},showSpritesFolder(){return R.supports.openableFolders.has("sprites")}},methods:{assetSpriteBackground(t){return t.variants[0].map(e=>`url('${e.lq}')`).join(",")},assetPath(t){return t.chibi?R.supports.lq?t.chibi.lq:t.chibi.hq:""},showDropTarget(t){!t.dataTransfer||(t.dataTransfer.effectAllowed="none",!!Array.from(t.dataTransfer.items).find(e=>e.type.match(/^image.*$/))&&(t.dataTransfer.effectAllowed="link",this.group==="sprites"&&this.$refs.spriteDt.show()))},hideDropTarget(){this.group==="sprites"&&this.$refs.spriteDt.hide()},onSpriteFileUpload(){const t=this.$refs.spriteUpload;if(!!t.files)for(const e of t.files)this.addCustomSpriteFile(e)},async uploadFromURL(){const t=prompt("Enter the URL of the image");if(!t)return;const e=t.split("/").slice(-1)[0];this.addNewCustomSprite(e,t)},async addSpriteToScene(t){await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("objects/createSprite",{assets:t.variants[0]})})},addTextBox(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("objects/createTextBox",{})})},addChoice(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("objects/createChoice",{})})},addDialog(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("objects/createNotification",{})})},addPoem(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("objects/createPoem",{})})},addConsole(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("objects/createConsole",{})})},paste(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("objects/pasteObjectFromClipboard",{})})},onChosen(t){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("objects/createCharacters",{characterType:t})})},addCustomSpriteFile(t){const e=URL.createObjectURL(t);this.addNewCustomSprite(t.name,e)},addNewCustomSprite(t,e){rs.sprites.push({id:e,label:t,variants:[[e]],defaultScale:[1,1],hd:null}),this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:rs,processed:!1})})},openSpritesFolder(){R.openFolder("sprites")}},async created(){this.isWebPSupported=await Bt()}}),qi=t=>(G("data-v-4e81bbdc"),t=t(),Y(),t),Ki=C("Drop here to add as a new sprite "),Ji=qi(()=>a("h1",null,"Add",-1)),Zi=C(" Char\xADacters "),Qi=C(" Sprites "),tr=C(" UI "),er=["title","onClick"],or=["src","alt"],sr=C(" Search in content packs "),nr=["title","onClick"],ir=C(" Upload new sprite "),rr=C(" New sprite from URL "),ar=C(" Search in content packs "),lr=C(" Open sprites folder "),dr=["disabled"];function cr(t,e,o,s,n,i){const r=v("drop-target"),l=v("d-button");return t.isWebPSupported!==void 0?(h(),g("div",{key:0,class:"panel",onDragenter:e[13]||(e[13]=(...d)=>t.showDropTarget&&t.showDropTarget(...d)),onMouseleave:e[14]||(e[14]=(...d)=>t.hideDropTarget&&t.hideDropTarget(...d))},[y(r,{ref:"spriteDt",class:"drop-target",onDrop:t.addCustomSpriteFile},{default:w(()=>[Ki]),_:1},8,["onDrop"]),Ji,a("div",{class:W({"group-selector":!0,vertical:t.vertical})},[y(l,{class:W({active:t.group==="characters"}),"icon-pos":"top",icon:"emoji_people",onClick:e[0]||(e[0]=d=>t.group="characters")},{default:w(()=>[Zi]),_:1},8,["class"]),y(l,{class:W({active:t.group==="sprites"}),"icon-pos":"top",icon:"change_history",onClick:e[1]||(e[1]=d=>t.group="sprites")},{default:w(()=>[Qi]),_:1},8,["class"]),y(l,{class:W({active:t.group==="ui"}),"icon-pos":"top",icon:"view_quilt",onClick:e[2]||(e[2]=d=>t.group="ui")},{default:w(()=>[tr]),_:1},8,["class"])],2),a("div",{class:W({"item-grid":!0,vertical:t.vertical})},[t.group==="characters"?(h(),g(_,{key:0},[(h(!0),g(_,null,E(t.characters,d=>(h(),g("div",{class:"character",key:d.id,title:d.label,onClick:c=>t.onChosen(d.id.toLowerCase())},[a("img",{src:t.assetPath(d),alt:d.label},null,8,or)],8,er))),128)),y(l,{class:"custom-sprite",icon:"extension",onClick:e[3]||(e[3]=d=>t.$emit("show-dialog","type: Characters"))},{default:w(()=>[sr]),_:1})],64)):j("",!0),t.group==="sprites"?(h(),g(_,{key:1},[(h(!0),g(_,null,E(t.sprites,d=>(h(),g("div",{class:"sprite",key:d.label,title:d.label,style:K({background:t.assetSpriteBackground(d)}),onClick:c=>t.addSpriteToScene(d)},F(d.label),13,nr))),128)),y(l,{class:"custom-sprite",icon:"publish",onClick:e[5]||(e[5]=d=>t.$refs.spriteUpload.click())},{default:w(()=>[ir,a("input",{type:"file",ref:"spriteUpload",onChange:e[4]||(e[4]=(...d)=>t.onSpriteFileUpload&&t.onSpriteFileUpload(...d))},null,544)]),_:1}),y(l,{icon:"insert_link",onClick:t.uploadFromURL},{default:w(()=>[rr]),_:1},8,["onClick"]),y(l,{icon:"extension",onClick:e[6]||(e[6]=d=>t.$emit("show-dialog","type: Sprites"))},{default:w(()=>[ar]),_:1}),t.showSpritesFolder?(h(),k(l,{key:0,icon:"folder",onClick:t.openSpritesFolder},{default:w(()=>[lr]),_:1},8,["onClick"])):j("",!0)],64)):j("",!0),t.group==="ui"?(h(),g(_,{key:2},[a("button",{onClick:e[7]||(e[7]=(...d)=>t.addTextBox&&t.addTextBox(...d))},"Textbox"),a("button",{onClick:e[8]||(e[8]=(...d)=>t.addPoem&&t.addPoem(...d))},"Poem"),a("button",{onClick:e[9]||(e[9]=(...d)=>t.addDialog&&t.addDialog(...d))},"Notification"),a("button",{onClick:e[10]||(e[10]=(...d)=>t.addChoice&&t.addChoice(...d))},"Choice"),a("button",{onClick:e[11]||(e[11]=(...d)=>t.addConsole&&t.addConsole(...d))},"Console")],64)):j("",!0),a("button",{onClick:e[12]||(e[12]=(...d)=>t.paste&&t.paste(...d)),disabled:!t.hasClipboardContent}," Paste ",8,dr)],2)],32)):j("",!0)}var ur=D(Yi,[["render",cr],["__scopeId","data-v-4e81bbdc"]]);function Zt(t,e,o){let s=e+o;const n=t.length;return s<0&&(s+=n),s>=n&&(s-=n),s}const de=1280,Ue=720,hr=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],pr=1,fr=1/1.5,gr=-74,br=-26,mr=[200,240,400,493,640,786,880,1040,1080];var yr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",screenWidth:de,screenHeight:Ue,positions:hr,sdCharacterScaleFactor:pr,hdCharacterScaleFactor:fr,CloseUpYOffset:gr,BaseCharacterYPos:br,characterPositions:mr});const Tt=class{constructor(e,o,s,n){this.r=e,this.g=o,this.b=s,this.a=n}static validCss(e){return this.validCssRgb(e)||this.validHex(e)}static fromCss(e){if(this.validCssRgb(e))return this.fromCssRgb(e);if(this.validHex(e))return this.fromHex(e);throw new Error("Invalid RGB color format")}static validCssRgb(e){return this.rgbEx.test(e)||this.rgbaEx.test(e)}static fromCssRgb(e){if(!this.validCssRgb(e))throw new Error("Invalid RGB color format");const o=e.slice(0,-1),s=o.indexOf("("),i=o.slice(s+1).split(",").map(r=>parseFloat(r.trim()));return new Tt(i[0],i[1],i[2],i.length===4?i[3]:1)}static validHex(e){return this.hexShortEx.test(e)||this.hexLongEx.test(e)}static fromHex(e){if(!this.validHex(e))throw new Error("Invalid Hex color format");const o=e.slice(1);if(o.length===3)return new Tt(parseInt(o[0]+o[0],16),parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),1);if(o.length===4)return new Tt(parseInt(o[0]+o[0],16),parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)/255);if(o.length===6)return new Tt(parseInt(o[0]+o[1],16),parseInt(o[2]+o[3],16),parseInt(o[4]+o[5],16),1);if(o.length===8)return new Tt(parseInt(o[0]+o[1],16),parseInt(o[2]+o[3],16),parseInt(o[4]+o[5],16),parseInt(o[6]+o[7],16)/255);throw new Error("Invalid Hex color format length")}toCss(){return this.a>1?`rgb(${this.r},${this.g},${this.b})`:`rgba(${this.r},${this.g},${this.b},${this.a})`}toHex(){return`#${Math.round(this.r).toString(16).padStart(2,"0")}${Math.round(this.g).toString(16).padStart(2,"0")}${Math.round(this.b).toString(16).padStart(2,"0")}${Math.round(this.a*255).toString(16).padStart(2,"0")}`}toRgb(){return this}toHSL(){let{r:e,g:o,b:s}=this;const{a:n}=this;e/=255,o/=255,s/=255;const i=Math.max(e,o,s),r=Math.min(e,o,s);let l,d;const c=(i+r)/2;if(i===r)l=d=0;else{const u=i-r;switch(d=c>.5?u/(2-i-r):u/(i+r),i){case e:l=(o-s)/u+(o<s?6:0);break;case o:l=(s-e)/u+2;break;case s:l=(e-o)/u+4;break}l/=6}return new N(l,d,c,n)}get luminance(){return Math.sqrt(Math.pow(.299*(this.r/255),2)+Math.pow(.587*(this.g/255),2)+Math.pow(.114*(this.b/255),2))}};let H=Tt;f(H,"rgbEx",/^rgb\((\d*?),(\d*?),(\d*?)\)$/i),f(H,"rgbaEx",/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([\d.]+)\)$/i),f(H,"hexShortEx",/^#[0-9A-Z]{3,4}$/i),f(H,"hexLongEx",/^#[0-9A-Z]{6,8}$/i);class N{constructor(e,o,s,n){this.h=e,this.s=o,this.l=s,this.a=n,Object.freeze(this)}toCss(){return this.a>=1?`hsl(${this.h}, ${this.s}, ${this.l})`:`hsla(${this.h}, ${this.s}, ${this.l}, ${this.a})`}shift(e){let{h:o,s,l:n,a:i}=this;return o+=e.h,o>=1?o-=1:o<0&&(o+=1),s+e.s>1?s-=e.s:(s+=e.s,s<0&&(s=0)),n+e.l>1||n+e.l<0?n-=e.l:n+=e.l,i+e.a>1||i+e.a<0?i-=e.a:i+=e.a,new N(o,s,n,i)}toRgb(){const{h:e,s:o,l:s,a:n}=this;let i,r,l;if(o===0)i=r=l=s;else{const d=s<.5?s*(1+o):s+o-s*o,c=2*s-d;i=N.hue2rgb(c,d,e+1/3),r=N.hue2rgb(c,d,e),l=N.hue2rgb(c,d,e-1/3)}return new H(Math.round(i*255),Math.round(r*255),Math.round(l*255),n)}toHSL(){return this}static hue2rgb(e,o,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(o-e)*6*s:s<1/2?o:s<2/3?e+(o-e)*(2/3-s)*6:e}}const vr=new N(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),wr="#ffe6f4",Cr="#ffbde1",$r=420,kr=22,xr=640,as=270,Sr=7,jr=3,Pr=(Ue-as)/2,Tr={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0};var _r=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",nameboxTextOutlineDelta:vr,ChoiceButtonColor:wr,ChoiceButtonBorderColor:Cr,ChoiceButtonWidth:$r,ChoiceSpacing:kr,ChoiceX:xr,ChoiceYOffset:as,ChoicePadding:Sr,Outline:jr,ChoiceY:Pr,ChoiceTextStyle:Tr});const ls="#ffa8d2",Br="#552222",Or="#ffeef6",Xe="#bb5599",ds=new N(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),cs=new N(.002028397565922768,0,.13725490196078438,0),us=.82,hs=new N(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),ps=12,Ir=1.5,Ge=12,ct=1.5,Dr=.6,Hr=new N(.08045977011494243,-.5714285714285714,-.5960784313725489,0),Ar=new N(0,-.14285714285714296,.3,0),fs=new N(.004269293924466178,-.01869158878504662,-.039215686274509665,0),Ye=9.5,ut=47,gs=new N(.0023347701149424305,0,.10784313725490202,0),bs=3;var Rr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",textboxDefaultColor:ls,controlsDefaultColor:Br,nameboxDefaultColor:Or,nameboxStrokeDefaultColor:Xe,nameboxTextOutlineDelta:ds,nameboxBackgroundDelta:cs,nameboxGradientMiddleStopPosition:us,nameboxGradientEndDelta:hs,nameboxRounding:ps,nameboxRoundingBuffer:Ir,textboxRounding:Ge,textboxRoundingBuffer:ct,nameColorThreshold:Dr,controlColorDelta:Hr,controlDisableColorDelta:Ar,dotColorDelta:fs,dotRadius:Ye,dotPatternSize:ut,textboxOutlineColorDelta:gs,textboxOutlineWidth:bs});const It=816,qe=900,ce=146,Mr=0,Wr=29,Nr=8,Qt=38,ue=44,Vr=6,Fr=93,Lr=404,Er=9,zr=9,it=39,te=168,ee=34,he=29,Ke=12,Je=-126,Ze=-72,Qe=-38,to=30.75,eo=26,ms=426,oo=58,so={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},pe=S(m({},so),{fontName:"riffic",fontSize:24,strokeColor:Xe,strokeWidth:6,color:"white",letterSpacing:1}),no={align:"left",font:"13px aller",fill:{style:"#522"}},ys=S(m({},no),{fill:{style:"#a66"}}),Ur={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},io={alpha:1,color:"#ffffff",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:4,lineSpacing:1.2},Dt=de/2-It/2,Xr=de/2-qe/2,Gr=Dt+Qt,vs=Dt+ee,Yr=vs+te/2,qr=Dt+Je,Kr=Dt+Ze,Jr=Dt+Qe,Zr="normal";var Qr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",TextBoxWidth:It,TextBoxCorruptedWidth:qe,TextBoxHeight:ce,TextBoxKerning:Mr,TextBoxLineHeight:Wr,TextBoxCorruptedKerning:Nr,TextBoxTextXOffset:Qt,TextBoxTextYOffset:ue,TextBoxBottomSpacing:Vr,HdSpacing:Fr,HdSideMargin:Lr,TextBoxTextCorruptedXOffset:Er,TextBoxTextCorruptedYOffset:zr,NameboxHeight:it,NameboxWidth:te,NameboxXOffset:ee,NameboxTextYOffset:he,ControlsYBottomOffset:Ke,ControlsXHistoryOffset:Je,ControlsXSkipOffset:Ze,ControlsXStuffOffset:Qe,ArrowXRightOffset:to,ArrowYBottomOffset:eo,GlowRX:ms,GlowRY:oo,BaseTextStyle:so,NameboxTextStyle:pe,ControlsTextStyle:no,ControlsTextDisabledStyle:ys,TextBoxCorruptedStyle:Ur,TextBoxStyle:io,TextBoxX:Dt,TextBoxCorruptedX:Xr,TextBoxTextX:Gr,NameboxX:vs,NameboxTextX:Yr,ControlsXHistory:qr,ControlsXSkip:Kr,ControlsXStuff:Jr,DefaultTextboxStyle:Zr});const ta="#ffe6f4",ea="#ffbde1",oa="rgba(255,255,255,0.6)",sa=40,na=30,ia=S(m({},so),{fontName:"riffic",fontSize:24,strokeColor:Xe,strokeWidth:8,letterSpacing:1,color:"white"}),ra={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0};var aa=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",NotificationBackgroundColor:ta,NotificationBorderColor:ea,NotificationBackdropColor:oa,NotificationPadding:sa,NotificationSpacing:na,NotificationOkTextStyle:ia,NotificationTextStyle:ra});const ws=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],la=0,da=0,ca=de/2,ua=Ue/2,ha=33,pa=100,fa=30,ga=800,ba=720,ma="rgba(51,51,51,0.75)",ya=480,va=180,wa=3,Ca=7,yt={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:12},Cs=[S(m({},yt),{name:"Sayori",fontName:"hashtag",fontSize:34,lineSpacing:1.05,letterSpacing:0}),S(m({},yt),{name:"Natsuki",fontName:"ammy_handwriting",fontSize:28}),S(m({},yt),{name:"Monika",fontName:"journal",fontSize:34}),S(m({},yt),{name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.5,fontSize:32}),S(m({},yt),{name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:18,letterSpacing:-8}),S(m({},yt),{name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:40}),S(m({},yt),{name:"MC",fontName:"halogen",fontSize:30,lineSpacing:1.53}),S(m({},yt),{name:"Console",fontName:"f25_bank_printer",fontSize:18,color:"white",lineSpacing:1.1})];var $a=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",poemBackgrounds:ws,defaultPoemBackground:la,defaultPoemStyle:da,defaultX:ca,defaultY:ua,poemTopPadding:ha,poemBottomPadding:pa,poemPadding:fa,defaultPoemWidth:ga,defaultPoemHeight:ba,consoleBackgroundColor:ma,consoleWidth:ya,consoleHeight:va,defaultConsoleBackground:wa,defaultConsoleStyle:Ca,poemTextStyles:Cs}),ka={Base:yr,Choices:_r,Notification:aa,Poem:$a,TextBox:Qr,TextBoxCustom:Rr};const fe=1920,ro=1080,xa=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],Sa=1.5,ja=1,Pa=-111,Ta=-39,_a=[300,360,600,740,960,1180,1320,1560,1620];var Ba=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",screenWidth:fe,screenHeight:ro,positions:xa,sdCharacterScaleFactor:Sa,hdCharacterScaleFactor:ja,CloseUpYOffset:Pa,BaseCharacterYPos:Ta,characterPositions:_a});const Oa=new N(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Ia="#ffe6f4",Da="#ffbde1",Ha=630,Aa=33,Ra=960,$s=405,Ma=10.5,Wa=4.5,Na=(ro-$s)/2,Va={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0};var Fa=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",nameboxTextOutlineDelta:Oa,ChoiceButtonColor:Ia,ChoiceButtonBorderColor:Da,ChoiceButtonWidth:Ha,ChoiceSpacing:Aa,ChoiceX:Ra,ChoiceYOffset:$s,ChoicePadding:Ma,Outline:Wa,ChoiceY:Na,ChoiceTextStyle:Va});const ks="#ffa8d2",La="#552222",Ea="#ffeef6",ao="#bb5599",xs=new N(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Ss=new N(.002028397565922768,0,.13725490196078438,0),js=.82,Ps=new N(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),Ts=15,za=1.5,lo=19,ht=1.5,Ua=.6,Xa=new N(.08045977011494243,-.5714285714285714,-.5960784313725489,0),Ga=new N(0,-.14285714285714296,.3,0),_s=new N(.004269293924466178,-.01869158878504662,-.039215686274509665,0),co=9.5*1.5,pt=47*1.5,Bs=new N(.0023347701149424305,0,.10784313725490202,0),Os=5;var Ya=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",textboxDefaultColor:ks,controlsDefaultColor:La,nameboxDefaultColor:Ea,nameboxStrokeDefaultColor:ao,nameboxTextOutlineDelta:xs,nameboxBackgroundDelta:Ss,nameboxGradientMiddleStopPosition:js,nameboxGradientEndDelta:Ps,nameboxRounding:Ts,nameboxRoundingBuffer:za,textboxRounding:lo,textboxRoundingBuffer:ht,nameColorThreshold:Ua,controlColorDelta:Xa,controlDisableColorDelta:Ga,dotColorDelta:_s,dotRadius:co,dotPatternSize:pt,textboxOutlineColorDelta:Bs,textboxOutlineWidth:Os});const uo=1220,Is=900,Ds=219,qa=0,Ka=29,Ja=8,ho=57,Hs=68,Za=54,Qa=9,tl=9,Ht=59,po=252,fo=49,As=43,Rs=12*1.5,Ms=-126*1.5,Ws=-72*1.5,Ns=-38*1.5,Vs=30.75*1.5,Fs=26*1.5,Ls=426*1.5,go=58*1.5,bo={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:1,lineSpacing:1.2,strokeColor:"",strokeWidth:0},Es=S(m({},bo),{fontName:"riffic",fontSize:36,strokeColor:ao,strokeWidth:9,color:"white",letterSpacing:2}),ge={align:"left",font:"24px aller",fill:{style:"#522"}},zs=S(m({},ge),{fill:{style:"#a66"}}),Us={alpha:1,color:"#ffffff",fontName:"aller",fontSize:30,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:5,lineSpacing:1.2},el={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},At=fe/2-uo/2,ol=fe/2-Is/2,sl=At+ho,Xs=At+fo,nl=Xs+po/2,il=At+Ms,rl=At+Ws,al=At+Ns,ll="custom_plus";var dl=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",TextBoxWidth:uo,TextBoxCorruptedWidth:Is,TextBoxHeight:Ds,TextBoxKerning:qa,TextBoxLineHeight:Ka,TextBoxCorruptedKerning:Ja,TextBoxTextXOffset:ho,TextBoxTextYOffset:Hs,TextBoxBottomSpacing:Za,TextBoxTextCorruptedXOffset:Qa,TextBoxTextCorruptedYOffset:tl,NameboxHeight:Ht,NameboxWidth:po,NameboxXOffset:fo,NameboxTextYOffset:As,ControlsYBottomOffset:Rs,ControlsXHistoryOffset:Ms,ControlsXSkipOffset:Ws,ControlsXStuffOffset:Ns,ArrowXRightOffset:Vs,ArrowYBottomOffset:Fs,GlowRX:Ls,GlowRY:go,BaseTextStyle:bo,NameboxTextStyle:Es,ControlsTextStyle:ge,ControlsTextDisabledStyle:zs,TextBoxStyle:Us,TextBoxCorruptedStyle:el,TextBoxX:At,TextBoxCorruptedX:ol,TextBoxTextX:sl,NameboxX:Xs,NameboxTextX:nl,ControlsXHistory:il,ControlsXSkip:rl,ControlsXStuff:al,DefaultTextboxStyle:ll});const cl="#ffe6f4",ul="#ffbde1",hl="rgba(255,255,255,0.6)",pl=60,fl=45,gl=S(m({},bo),{fontName:"riffic",fontSize:36,strokeColor:ao,strokeWidth:12,letterSpacing:1,color:"white"}),bl={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0};var ml=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",NotificationBackgroundColor:cl,NotificationBorderColor:ul,NotificationBackdropColor:hl,NotificationPadding:pl,NotificationSpacing:fl,NotificationOkTextStyle:gl,NotificationTextStyle:bl});const yl=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],vl=0,wl=0,Cl=fe/2,$l=ro/2,kl=33,xl=100,Sl=30,jl=800,Pl=720,Tl="rgba(51,51,51,0.75)",_l=480,Bl=180,Ol=3,Il=7,vt={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:12},Dl=[S(m({},vt),{name:"Sayori",fontName:"hashtag",fontSize:34,lineSpacing:1.05,letterSpacing:0}),S(m({},vt),{name:"Natsuki",fontName:"ammy_handwriting",fontSize:28}),S(m({},vt),{name:"Monika",fontName:"journal",fontSize:34}),S(m({},vt),{name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.5,fontSize:32}),S(m({},vt),{name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:18,letterSpacing:-8}),S(m({},vt),{name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:40}),S(m({},vt),{name:"MC",fontName:"halogen",fontSize:30,lineSpacing:1.53}),S(m({},vt),{name:"Console",fontName:"f25_bank_printer",fontSize:18,color:"white",lineSpacing:1.1})];var Hl=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",poemBackgrounds:yl,defaultPoemBackground:vl,defaultPoemStyle:wl,defaultX:Cl,defaultY:$l,poemTopPadding:kl,poemBottomPadding:xl,poemPadding:Sl,defaultPoemWidth:jl,defaultPoemHeight:Pl,consoleBackgroundColor:Tl,consoleWidth:_l,consoleHeight:Bl,defaultConsoleBackground:Ol,defaultConsoleStyle:Il,poemTextStyles:Dl}),Al={Base:Ba,Choices:Fa,Notification:ml,Poem:Hl,TextBox:dl,TextBoxCustom:Ya};function P(){return R.gameMode==="ddlc_plus"?Al:ka}function Rt(){return{flip:!1,rotation:0,version:0,opacity:100,x:P().Base.screenWidth/2,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!1,nameboxWidth:null,zoom:1}}const Rl={setPose(t,e){const o=t.objects[e.id];o.poseId=e.poseId,++o.version},setCharStyleGroup(t,{id:e,styleGroupId:o}){const s=t.objects[e];s.styleGroupId=o,++s.version},setCharStyle(t,{id:e,styleId:o}){const s=t.objects[e];s.styleId=o,++s.version},setPosePosition(t,e){const o=t.objects[e.id];o.posePositions=m(m({},o.posePositions),e.posePositions),++o.version},setClose(t,e){const o=t.objects[e.id];o.close=e.close,++o.version},setFreeMove(t,e){const o=t.objects[e.id];if(o.freeMove=e.freeMove,!o.freeMove){const s=P();o.x=s.Base.characterPositions[me(o.x)],o.y=s.Base.BaseCharacterYPos}}};function be(t,e){return t.getters["content/getCharacters"].get(e.characterType)}function xt(t,e){return t["content/getCharacters"].get(e)}function wt(t,e){return t.styleGroups[e.styleGroupId].styles[e.styleId].poses[e.poseId]}function Ml(t,e){const o=wt(t,e),s=[...Object.keys(o.positions).filter(n=>o.positions[n].length>1)];return o.compatibleHeads.length>0&&s.unshift("head"),s}function mo(t,e,o=e.posePositions.headType||0){const s=wt(t,e).compatibleHeads;return!s||s.length===0?null:t.heads[s[o]]}function me(t){return P().Base.characterPositions.map((s,n)=>({pos:Math.abs(t-s),idx:n})).sort((s,n)=>s.pos-n.pos)[0].idx}let Wl=0;const Nl={createCharacters({rootState:t,rootGetters:e,commit:o},s){const n=P(),i=xt(e,s.characterType),r=i.hd?n.Base.hdCharacterScaleFactor:n.Base.sdCharacterScaleFactor;o("create",{object:S(m({},Rt()),{id:"characters_"+ ++Wl,panelId:t.panels.currentPanel,onTop:!1,type:"character",y:n.Base.BaseCharacterYPos,preserveRatio:!0,ratio:1,width:i.size[0]*i.defaultScale[0]*r,height:i.size[1]*i.defaultScale[1]*r,characterType:s.characterType,close:!1,freeMove:!1,poseId:0,styleId:0,styleGroupId:0,posePositions:{},label:i.label||i.id,enlargeWhenTalking:t.ui.defaultCharacterTalkingZoom})})},seekPart({state:t,commit:e,dispatch:o,rootGetters:s},{delta:n,id:i,part:r}){if(r==="head"){o("seekHead",{id:i,delta:n});return}const l=t.objects[i],d=wt(xt(s,l.characterType),l);!d.positions[r]||e("setPosePosition",{id:i,posePositions:{[r]:Zt(d.positions[r],l.posePositions[r]||0,n)}})},seekPose({state:t,commit:e,rootGetters:o},{id:s,delta:n}){const i=t.objects[s],r=xt(o,i.characterType),l=r.styleGroups[i.styleGroupId].styles[i.styleId].poses;Mt(e,i,r,d=>{d.poseId=Zt(l,d.poseId,n)})},seekStyle({state:t,commit:e,rootGetters:o},{id:s,delta:n}){const i=t.objects[s],r=xt(o,i.characterType),l=r.styleGroups.flatMap((c,u)=>c.styles.map((p,b)=>({styleGroupIdx:u,styleIdx:b,styleGroupJson:JSON.stringify(p.components)}))).sort((c,u)=>c.styleGroupJson.localeCompare(u.styleGroupJson)),d=l.findIndex(c=>c.styleGroupIdx===i.styleGroupId&&c.styleIdx===i.styleId);Mt(e,i,r,c=>{const u=Zt(l,d,n),p=l[u];c.styleGroupId=p.styleGroupIdx,c.styleId=p.styleIdx})},seekHead({state:t,commit:e,rootGetters:o},{id:s,delta:n}){const i=t.objects[s],r=xt(o,i.characterType),l=wt(r,i);let d=mo(r,i);if(!d)return;let c=(i.posePositions.head||0)+n,u=i.posePositions.headType||0;(c<0||c>=d.variants.length)&&(u=Zt(l.compatibleHeads.map(p=>r.heads[p]),u,n),d=mo(r,i,u),c=n===1?0:d.variants.length-1),e("setPosePosition",{id:s,posePositions:{head:c,headType:u}})},setPart({state:t,commit:e,rootGetters:o},{id:s,part:n,val:i}){const r=t.objects[s],l=xt(o,r.characterType);n==="pose"?Mt(e,r,l,d=>{d.poseId=i}):n==="style"?Mt(e,r,l,d=>{d.styleId=i}):Mt(e,r,l,d=>{d.posePositions[n]=i})},setCharStyle({state:t,commit:e,rootGetters:o},{id:s,styleGroupId:n,styleId:i}){const r=t.objects[s],l=xt(o,r.characterType);Mt(e,r,l,d=>{d.styleGroupId=n,d.styleId=i})},setCharacterPosition({state:t,commit:e},{id:o,x:s,y:n}){const i=t.objects[o];if(i.freeMove)e("setPosition",{id:o,x:s,y:n});else{const r=P();e("setPosition",{id:o,x:r.Base.characterPositions[me(s)],y:r.Base.BaseCharacterYPos+(i.close?r.Base.CloseUpYOffset:0)})}},shiftCharacterSlot({state:t,commit:e},{id:o,delta:s}){const n=t.objects[o],i=P();let l=me(n.x)+s;l<0&&(l=0),l>=i.Base.characterPositions.length&&(l=i.Base.characterPositions.length-1),e("setPosition",{id:o,x:i.Base.characterPositions[l],y:n.y})}};async function Vl(t,e,o){const s=t.state.objects[e],n=o.characters.find(L=>L.id===s.characterType);if(!n){console.error("Character data is missing. Dropping the character."),await t.dispatch("removeObject",{id:e});return}const i=Gs(s),r=n.styleGroups[s.styleGroupId],l=r.styles[i.styleId],d=l.poses[i.poseId],c=t.rootState.content.current.characters.find(L=>L.id===n.id);if(!c){console.error("Character data is missing. Dropping the character."),await t.dispatch("removeObject",{id:e});return}const u=c.styleGroups.findIndex(L=>L.id===r.id);i.styleGroupId=u===-1?0:u;const p=c.styleGroups[i.styleGroupId],b=JSON.stringify(l.components),T=p.styles.findIndex(L=>JSON.stringify(L.components)===b);i.styleId=T===-1?0:T;const x=p.styles[i.styleId],$=x.poses.findIndex(L=>L.id===d.id);i.poseId=$===-1?0:$;const et=x.poses[i.poseId],V={};for(const L in et.positions){if(!et.positions.hasOwnProperty(L))continue;const kt=et.positions[L];if(d.positions[L]){const gt=i.posePositions[L];gt>=0&&gt<kt.length?V[L]=gt:V[L]=0}else V[L]=0}const _t=d.compatibleHeads[s.posePositions.headType],B=et.compatibleHeads.indexOf(_t);if(B===-1)i.posePositions.headType=0,i.posePositions.head=0;else{B!==s.posePositions.headType&&(i.posePositions.headType=B);const L=JSON.stringify(n.heads[_t].variants[s.posePositions.head]),kt=c.heads[_t].variants.findIndex(gt=>JSON.stringify(gt)===L);kt===-1?i.posePositions.head=0:i.posePositions.head=kt}Ys(t.commit,s,i)}function Gs(t){return{styleGroupId:t.styleGroupId,styleId:t.styleId,poseId:t.poseId,posePositions:m({},t.posePositions)}}function Ys(t,e,o){o.styleGroupId!==e.styleGroupId&&t("setCharStyleGroup",{id:e.id,styleGroupId:o.styleGroupId}),o.styleId!==e.styleId&&(console.log(`Setting style of ${e.id} to ${o.styleId}`),t("setCharStyle",{id:e.id,styleId:o.styleId})),o.poseId!==e.poseId&&t("setPose",{id:e.id,poseId:o.poseId}),JSON.stringify(o.posePositions)!==JSON.stringify(e.posePositions)&&t("setPosePosition",{id:e.id,posePositions:o.posePositions})}function Mt(t,e,o,s){const n=Gs(e);s(n),o.styleGroups[n.styleGroupId]||(n.styleGroupId=0);const i=o.styleGroups[n.styleGroupId];i.styles[n.styleId]||(n.styleId=0);const r=i.styles[n.styleId];r.poses[n.poseId]||(n.poseId=0);const l=r.poses[n.poseId];for(const p in l.positions)!l.positions[p]||l.positions[p][n.posePositions[p]]||(n.posePositions[p]=0);const c=o.styleGroups[e.styleGroupId].styles[e.styleId].poses[e.poseId].compatibleHeads[e.posePositions.headType||0],u=l.compatibleHeads.indexOf(c);u>=0?n.posePositions.headType=u:(n.posePositions.headType=0,n.posePositions.head=0),Ys(t,e,n)}const Fl=I({props:{title:{required:!0,type:String}}}),Ll={class:"fieldset_wrapper"},El={key:0},zl={class:"fieldset_contents"};function Ul(t,e,o,s,n,i){return h(),g("div",Ll,[a("fieldset",null,[t.title>""?(h(),g("legend",El,F(t.title),1)):j("",!0),a("div",zl,[bt(t.$slots,"default",{},void 0,!0)])])])}var rt=D(Fl,[["render",Ul],["__scopeId","data-v-6781d4a8"]]);const qs=960,Xl=I({props:{part:{required:!0},value:{required:!0},size:{type:Number,default:150}},data:()=>({lookups:[],loaded:!1}),computed:{scaleX(){return this.size/this.part.size[0]},scaleY(){return this.size/this.part.size[1]},backgroundSize(){return`${Math.floor(qs*this.scaleX)}px ${Math.floor(qs*this.scaleY)}px`},backgroundPosition(){return`${Math.floor(this.part.offset[0]*-this.scaleX)}px ${Math.floor(this.part.offset[1]*-this.scaleY)}px`},style(){return{backgroundImage:this.lookups.filter(e=>e instanceof HTMLImageElement).map(e=>`url('${e.src.replace("'","\\'")}')`).join(","),height:this.size+"px",width:this.size+"px",backgroundPosition:this.backgroundPosition,backgroundSize:this.backgroundSize}}},async created(){this.lookups=await Promise.all(this.part.images.map(t=>typeof t.asset=="string"?dt(t.asset,!1):Ot(t.asset,!1)))}});function Gl(t,e,o,s,n,i){return h(),g("div",{class:W({part:!0,active:!1}),style:K(t.style),onClick:e[0]||(e[0]=r=>t.$emit("click"))},null,4)}var Yl=D(Xl,[["render",Gl],["__scopeId","data-v-735437fe"]]);const ql=I({mixins:[De],props:{noWraping:{type:Boolean,default:!1},direction:{type:String,default:"global"},maxSize:{},gap:{type:String,default:"0px"}},computed:{finalDirection(){return this.direction==="global"?this.$store.state.ui.vertical?"vertical":"horizontal":this.direction==="inverted"?this.$store.state.ui.vertical?"horizontal":"vertical":this.direction}},render(){const t=this.noWraping?"no-wraping":"wraping",o=Go("div",S(m({},{}),{class:["d-flow",this.finalDirection,t],style:{gap:this.gap}}),this.$slots.default());if(this.maxSize){const s=this.maxSize instanceof Array?this.maxSize[this.finalDirection==="horizontal"?0:1]:this.maxSize;return Go("div",{ref:"scrollContainer",class:["d-flow-scroll-container",this.finalDirection],style:{[this.finalDirection==="horizontal"?"maxWidth":"maxHeight"]:s}},[o])}return o},mounted(){this.$refs.scrollContainer&&this.$refs.scrollContainer.addEventListener("wheel",this.verticalScrollRedirect)}});var oe=D(ql,[["__scopeId","data-v-d6cdab54"]]);const Kl=I({components:{PartButton:Yl,DFieldset:rt,DFlow:oe},props:{character:{type:Object,required:!0},part:{required:!0,type:String}},data:()=>({isWebPSupported:null,stylePriorities:[]}),computed:{vertical(){return this.$store.state.ui.vertical},styleComponents(){if(this.part!=="style")return[];const t=this.charData.styleGroups[this.character.styleGroupId];return t.styleComponents.map(e=>{const o={};for(const s in e.variants){if(!e.variants.hasOwnProperty(s))continue;const n=e.variants[s];o[s]={size:t.styles[0].poses[0].size,offset:[0,0],images:[{offset:[0,0],asset:n}]}}return{label:e.label,name:e.id,buttons:o}})},parts(){const t={};let e,o,s;const n=this.charData,i=wt(n,this.character);switch(this.part){case"head":for(let l=0;l<i.compatibleHeads.length;++l){const d=i.compatibleHeads[l],c=n.heads[d];for(let u=0;u<c.variants.length;++u){const p=c.variants[u];t[`${l}_${u}`]={size:c.previewSize,offset:c.previewOffset,images:p.map(b=>({asset:b,offset:[0,0]}))}}}return t;case"pose":const r=n.styleGroups[this.character.styleGroupId].styles[this.character.styleId];for(let l=0;l<r.poses.length;++l){const d=r.poses[l];t[l]=this.generatePosePreview(d)}return t;case"style":for(const l of n.styleGroups)t[l.id]=this.generatePosePreview(l.styles[0].poses[0]);return t;default:e=i.positions[this.part],s=i.previewSize,o=i.previewOffset;break}for(let r=0;r<e.length;++r){const l=e[r];t[r]={images:l.map(d=>({offset:[0,0],asset:d})),size:s,offset:o}}return t},charData(){return be(this.$store,this.character)}},methods:{updateStyleData(){const t=this.charData.styleGroups[this.character.styleGroupId].styles[this.character.styleId];this.stylePriorities=Object.keys(t.components).map(e=>[e,t.components[e]])},generatePosePreview(t){const o=this.charData.heads[t.compatibleHeads[0]],s=o?o.variants[0]:null;let n=[];for(const i of t.renderCommands)switch(i.type){case"pose-part":const r=t.positions[i.part];if(!r||r.length===0)break;n=n.concat(r[0]);break;case"head":s&&(n=n.concat(s));break;case"image":n=n.concat(i.images);break}return{images:n.map(i=>({asset:i,offset:[0,0]})),size:t.previewSize,offset:t.previewOffset}},updatePose(t){t==null&&(t=this.character.styleGroupId);const o=this.charData.styleGroups[t];let s=o.styles;for(const n of this.stylePriorities){const i=s.filter(r=>r.components[n[0]]===n[1]);i.length>0&&(s=i)}this.vuexHistory.transaction(async()=>{await this.$store.dispatch("objects/setCharStyle",{id:this.character.id,styleGroupId:t,styleId:o.styles.indexOf(s[0])})})},choose(t){if(this.part==="style")this.updatePose(this.charData.styleGroups.findIndex(e=>e.id===t));else if(this.part==="head"){const[e,o]=t.split("_",2).map(s=>parseInt(s,10));this.$store.commit("objects/setPosePosition",{id:this.character.id,posePositions:{headType:e,head:o}})}else this.setPart(this.part,parseInt(t,10))},choose_component(t,e){const o=this.stylePriorities.findIndex(s=>s[0]===t);this.stylePriorities.splice(o,1),this.stylePriorities.unshift([t,e]),this.updatePose()},setPart(t,e){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/setPart",{id:this.character.id,part:t,val:e})})}},async created(){this.updateStyleData(),this.isWebPSupported=await Bt()},watch:{character(){this.updateStyleData()}}}),Ct=t=>(G("data-v-733e7ead"),t=t(),Y(),t),Jl=Ct(()=>a("i",{class:"material-icons"},"extension",-1)),Zl=Ct(()=>a("span",{class:"text-block"},"Create new expressions",-1)),Ql=[Jl,Zl],td=Ct(()=>a("i",{class:"material-icons"},"extension",-1)),ed=Ct(()=>a("span",{class:"text-block"},"Search in content packs",-1)),od=[td,ed],sd=Ct(()=>a("i",{class:"material-icons"},"extension",-1)),nd=Ct(()=>a("span",null,"Search in content packs",-1)),id=[sd,nd],rd=Ct(()=>a("i",{class:"material-icons"},"extension",-1)),ad=Ct(()=>a("span",null,"Search in content packs",-1)),ld=[rd,ad];function dd(t,e,o,s,n,i){const r=v("part-button"),l=v("d-flow"),d=v("d-fieldset");return h(),k(l,{"no-wraping":""},{default:w(()=>[a("button",{onClick:e[0]||(e[0]=c=>t.$emit("leave"))},"Back"),t.part==="head"?(h(),g("button",{key:0,onClick:e[1]||(e[1]=c=>t.$emit("show-expression-dialog",{character:t.character.characterType})),class:"icon-button"},Ql)):j("",!0),t.part==="head"?(h(),g("button",{key:1,onClick:e[2]||(e[2]=c=>t.$emit("show-dialog","type: Expressions character: "+t.charData.label)),class:"icon-button"},od)):t.part==="style"?(h(),g("button",{key:2,onClick:e[3]||(e[3]=c=>t.$emit("show-dialog","type: Styles character: "+t.charData.label)),class:"icon-button"},id)):(h(),g("button",{key:3,onClick:e[4]||(e[4]=c=>t.$emit("show-dialog","type: Poses character: "+t.charData.label)),class:"icon-button"},ld)),(h(!0),g(_,null,E(t.parts,(c,u)=>(h(),k(r,{key:u,value:u,part:c,onClick:p=>{t.choose(u),t.$emit("leave")}},null,8,["value","part","onClick"]))),128)),(h(!0),g(_,null,E(t.styleComponents,c=>(h(),k(d,{key:c.name,title:c.label},{default:w(()=>[y(l,{noWraping:""},{default:w(()=>[(h(!0),g(_,null,E(c.buttons,(u,p)=>(h(),k(r,{size:130,key:p,value:p,part:u,onClick:b=>t.choose_component(c.name,p)},null,8,["value","part","onClick"]))),128))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1})}var cd=D(Kl,[["render",dd],["__scopeId","data-v-733e7ead"]]);function St(){return function(e,o,s=!1){return{get(){return this.object[e]},set(n){this.vuexHistory.transaction(()=>{this.$store[s?"dispatch":"commit"](o,{id:this.object.id,[e]:n})})}}}}const Ks=5;class ud{constructor(e){f(this,"i",0);this.str=e}get pos(){return this.i}current(){return this.str[this.i]}get around(){return this.str.slice(Math.max(0,this.i-Ks),this.i+Ks)}get ahead(){return this.str[this.i+1]}get behind(){return this.str[this.i+1]}next(){return++this.i,this.current()}}function Js(t){const e=[],o=new ud(t);let s=ye;for(;s!==ve;)s=s(e,o);return e}function ye(t,e){return e.current()===void 0?ve:e.current()==="{"?pd:e.current()===`
`?fd:hd}function ve(){return ve}function hd(t,e){const{pos:o}=e;let s="",n=!1,i;for(;;){if(e.current()===void 0){i=ve;break}else if(n)s+=e.current(),n=!1;else if(e.current()==="\\")n=!0;else if(e.current()==="{"||e.current()===`
`){i=ye;break}else s+=e.current();e.next()}return t.push({type:"text",pos:o,content:s}),i}function yo(t,e){throw new Error(`Error at position ${t.pos}: (around: ${t.around}) ${e}`)}function pd(t,e){const{pos:o}=e;if(e.current()!=="{")throw new Error("Parser error: Command does not start with {");const s=e.next()==="/";s&&e.next();let n="",i="",r=!1;for(;e.current()===void 0&&yo(e,"Unexpected end of text inside a command"),e.current()!=="}";)r?i+=e.current():e.current().match(/[a-z]/i)?n+=e.current():e.current()==="="?(s&&yo(e,"Closing commands may not contain arguments"),r=!0):yo(e,"Unexpected character in command name."),e.next();return e.next(),s?t.push({type:"commandClose",commandName:n,pos:o}):t.push({type:"command",pos:o,argument:i,commandName:n}),ye}function fd(t,e){return t.push({type:"newline",pos:e.pos}),e.next(),ye}var gd=new Map([Wt("i",t=>S(m({},t),{isItalic:!0})),Wt("b",t=>S(m({},t),{isBold:!0})),Wt("u",t=>S(m({},t),{isUnderlined:!0})),Wt("s",t=>S(m({},t),{isStrikethrough:!0})),Wt("plain",t=>S(m({},t),{isStrikethrough:!1,isUnderlined:!1,isBold:!1,isItalic:!1})),Wt("edited",t=>S(m({},t),{fontName:"verily",strokeColor:"#000000",strokeWidth:20,letterSpacing:8})),we("k",(t,e,o)=>S(m({},t),{letterSpacing:e?t.letterSpacing+o:o})),we("size",(t,e,o)=>S(m({},t),{fontSize:e?t.fontSize+o:o})),we("alpha",(t,e,o)=>S(m({},t),{alpha:e?t.alpha+o:o})),we("stroke",(t,e,o)=>S(m({},t),{strokeWidth:e?t.strokeWidth+o:o})),["font",(t,e)=>S(m({},t),{fontName:e})],["color",(t,e)=>S(m({},t),{color:e})],["outlinecolor",(t,e)=>S(m({},t),{strokeColor:e})]]);function Wt(t,e){return[t,(o,s)=>{if(s)throw new Error(`Operator '${t}' does not take any arguments.`);return e(o)}]}function we(t,e){return[t,(o,s)=>{if(!s)throw new Error(`Operator '${t}' needs an argument.`);const n=s[0]==="+"||s[0]==="-",i=Number(s);if(isNaN(i))throw new Error(`Operator '${t}' needs a numeric argument.`);return e(o,n,i)}]}function Nt(t){throw new Error(`Unexpected value "${t}"`)}const $t=class{constructor(e,o){f(this,"renderParts");f(this,"tokens");this.str=e,this.baseStyle=o,this.tokens=Js(e),this.rebuildParts()}rebuildParts(){this.renderParts=$t.getRenderParts(this.tokens,this.baseStyle)}async loadFonts(){if(!("fonts"in document))return;const e=new Set;let o=null;for(const n of this.renderParts)"style"in n&&n.style!==o&&(o=n.style,o.fontName&&e.add(o.fontName));let s=!1;for(const n of e){const i=document,r=`8px ${n}`;i.fonts.check(r)||(s=!0,await i.fonts.load(r))}if(s){const n=Js(this.str);this.renderParts=$t.getRenderParts(n,this.baseStyle)}}render(e){e.save();let o=null;for(const s of this.renderParts)s.type!=="newline"&&(s.style!==o&&(o=s.style,wo(o,e)),o.strokeWidth>0&&o.strokeColor>""&&e.strokeText(s.character,s.x,s.y));for(const s of this.renderParts)s.type!=="newline"&&(s.style!==o&&(o=s.style,wo(o,e)),e.fillText(s.character,s.x,s.y));e.restore()}quote(){var e;(function(i){i[i.None=0]="None",i[i.ExplictQuote=1]="ExplictQuote",i[i.ImplictQuote=2]="ImplictQuote",i[i.Star=3]="Star"})(e||(e={}));let o=-1,s=0;for(let i=0;i<this.renderParts.length;++i){const r=this.renderParts[i];if(r.type==="character")switch(s){case 0:if(r.character.match(/\s/))continue;r.character==='"'?(s=1,o=i):r.character==="*"?(s=3,o=i):(this.renderParts.splice(i,0,{type:"character",x:0,y:0,style:r.style,character:'"',height:r.height,width:se(r.style,'"')}),i++,o=i,s=2);break;case 1:o=i,r.character==='"'&&(s=0);break;case 2:if(r.character.match(/\s/))continue;r.character==="*"&&(this.renderParts.splice(o+1,0,{type:"character",x:0,y:0,style:r.style,character:'"',height:r.height,width:se(r.style,'"')}),s=3,i++),o=i;break;case 3:r.character==="*"&&(s=0),o=i;break}}const n=this.renderParts[o];n&&s===3&&this.renderParts.splice(o+1,0,{type:"character",x:0,y:0,style:n.style,character:"*",height:n.height,width:se(n.style,'"')}),n&&(s===1||s===2)&&this.renderParts.splice(o+1,0,{type:"character",x:0,y:0,style:n.style,character:'"',height:n.height,width:se(n.style,'"')})}fixAlignment(e,o,s,n,i){let r=0,l=[];function d(){let x=o;e==="center"?x=o+(s-o)/2-r/2:e==="right"&&(x=s-r);for(const $ of l)$.x=x,x+=$.width}let c=this.renderParts;i>0&&(c=$t.applyLineWrapping(this.renderParts.slice(0),i));let u=n;const p=[];let b=0;for(const x of c)b=Math.max(b,x.height),x.type==="newline"&&(p.push(b),b=0);p.push(b);let T=0;for(const x of c)if(b=Math.max(b,x.height),x.y=u,l.push(x),r+=x.width,x.type==="newline")d(),u+=p[++T]||0,r=0,b=0,l=[];else if(x.type==="character"){const $=l[l.length-1];$.type==="character"&&(r+=$.style.letterSpacing,$.width+=$.style.letterSpacing)}d()}getHeight(e){let o=0,s=0;const n=e===0?this.renderParts:$t.applyLineWrapping(this.renderParts.slice(0),e);for(const i of n)o=Math.max(o,i.height),i.type==="newline"&&(s+=o,o=0);return s+=o,s}getWidth(){let e=0,o=0,s=null;for(const n of this.renderParts)e+=n.width,n.type==="newline"?(o=Math.max(o,e),e=0,s=null):n.type==="character"&&(s&&s.type==="character"&&(e+=s.style.letterSpacing),s=n);return o=Math.max(o,e),o}static getRenderParts(e,o){const s=[],n=[],i=[];let r=tn(o),l=o,d=null;for(const c of e)switch(c.type){case"command":if($t.textCommands.has(c.commandName))n.push(l),i.push(d),l=$t.textCommands.get(c.commandName)(l,c.argument),r=tn(l),d=c;else throw new Error(`There is no text command called '${c.commandName}' at position ${c.pos}.`);break;case"commandClose":if(!d)throw new Error(`Unmatched closing command at position ${c.pos}. Closed '${c.commandName}', but no commands are currently open.`);if(c.commandName!==d.commandName)throw new Error(`Unmatched closing command at position ${c.pos}. Closed '${c.commandName}', expected to close '${d}' first. (Opened at position ${d.pos})`);d=i.pop(),l=n.pop();break;case"newline":s.push({height:r,width:0,x:0,y:0,type:"newline"});break;case"text":for(const u of c.content)s.push({type:"character",character:u,height:r,width:se(l,u),style:l,x:0,y:0})}return s}static applyLineWrapping(e,o){let s=-1,n=0,i=0;const r=[];for(const l of e)l.type==="newline"?(s=-1,n=0,i=0,r.push(l)):l.type==="character"?l.character===" "?n>o?(s=-1,n=0,i=0,r.push({type:"newline",height:l.height,width:0,x:0,y:0})):(n+=l.width,i=n,s=r.length,r.push(l)):(n+=l.width,n>o&&s!==-1&&(n-=i,r.splice(s,1,{type:"newline",height:l.height,width:0,x:0,y:0}),s=-1,i=0),r.push(l)):Nt(l);return r}};let ft=$t;f(ft,"textCommands",gd);const Zs=document.createElement("canvas").getContext("2d");let Qs=null;function se(t,e){return t!==Qs&&(wo(t,Zs),Qs=t),Zs.measureText(e).width}const vo=new Map;function tn(t){const e=t.fontSize+" "+t.fontName;if(vo.has(e))return vo.get(e)*t.lineSpacing;const o=document.createElement("span");o.innerHTML="Hg",o.style.fontFamily=t.fontName,o.style.fontSize=`${t.fontSize}px`,o.style.lineHeight="1";const s=document.createElement("div");s.style.opacity="0",s.style.fontFamily=t.fontName,s.style.fontSize=`${t.fontSize}px`,s.style.lineHeight="1",s.style.position="absolute",s.style.top="0",s.style.left="0",s.appendChild(o),document.body.appendChild(s);try{const n=s.offsetHeight;return vo.set(e,n),n*t.lineSpacing}finally{s.remove()}}function wo(t,e){e.textAlign="left",e.font=(t.isItalic?"italic ":"")+(t.isBold?"bold ":"")+t.fontSize+"px "+t.fontName,e.lineJoin="round",t.strokeWidth>0&&t.strokeColor>""?(e.strokeStyle=t.strokeColor,e.lineWidth=t.strokeWidth):(e.strokeStyle="",e.lineWidth=0),e.globalAlpha=t.alpha||0,e.fillStyle=t.color}class Vt{}class Ft{constructor(e,o,s,n){f(this,"aborted",!1);this.canvas=e,this.fsCtx=o,this.hq=s,this.preview=n}static make(e,o,s){return new Ft(e,e.getContext("2d"),o,s)}static makeWithContext(e,o,s,n){return new Ft(e,o,s,n)}drawText(e){if(this.aborted)throw new Vt;this.fsCtx.save();const{font:o,align:s,x:n=0,y:i=0,text:r=""}=m({font:"20px aller",align:"left"},e);this.fsCtx.lineJoin="round",this.fsCtx.textAlign=s,this.fsCtx.font=o,e.outline&&(this.fsCtx.strokeStyle=e.outline.style,this.fsCtx.lineWidth=e.outline.width,this.fsCtx.strokeText(r,n,i)),e.fill&&(this.fsCtx.fillStyle=e.fill.style,this.fsCtx.fillText(r,n,i)),this.fsCtx.restore()}measureText(e){if(this.aborted)throw new Vt;this.fsCtx.save();const{font:o,align:s,text:n=""}=m({font:"20px aller",align:"left"},e);this.fsCtx.lineJoin="round",this.fsCtx.textAlign=s,this.fsCtx.font=o,e.outline&&(this.fsCtx.strokeStyle=e.outline.style,this.fsCtx.lineWidth=e.outline.width),e.fill&&(this.fsCtx.fillStyle=e.fill.style);const i=this.fsCtx.measureText(n);return this.fsCtx.restore(),i}drawImage(e){if(this.aborted)throw new Vt;if(e.image instanceof os)return;const{image:o,flip:s,x:n,y:i,w:r,h:l,filters:d,composite:c}=m({flip:!1,w:e.image.width,h:e.image.height,composite:"source-over"},e);if(this.fsCtx.save(),this.fsCtx.globalCompositeOperation=c,d)if("filter"in this.fsCtx){const u=[];for(const p of d)p.type==="drop-shadow"?u.push(`drop-shadow(${p.offsetX}px ${p.offsetY}px ${p.blurRadius}px ${p.color})`):p.type==="hue-rotate"?u.push(`hue-rotate(${p.value}deg)`):p.type==="blur"?u.push(`blur(${p.value}px)`):u.push(`${p.type}(${p.value*100}%)`);this.fsCtx.filter=u.join(" ")}else{let u=1;for(const p of d)p.type==="opacity"&&(u*=p.value);this.fsCtx.globalAlpha=u}if(e.shadow){const u=e.shadow;u.color&&(this.fsCtx.shadowColor=u.color),u.blur&&(this.fsCtx.shadowBlur=u.blur),u.offsetX&&(this.fsCtx.shadowOffsetX=u.offsetX),u.offsetY&&(this.fsCtx.shadowOffsetY=u.offsetY)}if(e.rotation){const u=e.rotationAnchor?e.rotationAnchor.x:0,p=e.rotationAnchor?e.rotationAnchor.y:0;e.rotationAnchor&&this.fsCtx.translate(u,p),this.fsCtx.fillRect(-10,-1,21,3),this.fsCtx.rotate(e.rotation),e.rotationAnchor&&this.fsCtx.translate(-u,-p)}this.fsCtx.translate(n+r/2,i+l/2),this.fsCtx.scale(s?-1:1,1),o instanceof Lt?o.paintOnto(this.fsCtx,{x:-r/2,y:-l/2,w:r,h:l}):this.fsCtx.drawImage(o,-r/2,-l/2,r,l),this.fsCtx.restore(),this.fsCtx.globalCompositeOperation="source-over"}drawRect({x:e,y:o,w:s,h:n,outline:i,fill:r,composition:l}){if(this.aborted)throw new Vt;this.fsCtx.save(),this.fsCtx.beginPath(),this.fsCtx.rect(e,o,s,n),l&&(this.fsCtx.globalCompositeOperation=l),r&&(this.fsCtx.fillStyle=r.style,this.fsCtx.fill()),i&&(this.fsCtx.strokeStyle=i.style,this.fsCtx.lineWidth=i.width,this.fsCtx.stroke()),this.fsCtx.restore()}drawPath({outline:e,fill:o,path:s}){if(this.aborted)throw new Vt;this.fsCtx.save(),this.fsCtx.beginPath(),s(this.fsCtx),o&&(this.fsCtx.fillStyle=o.style,this.fsCtx.fill()),e&&(this.fsCtx.strokeStyle=e.style,this.fsCtx.lineWidth=e.width,this.fsCtx.stroke()),this.fsCtx.restore()}patternFrom(e,o="repeat"){return e instanceof Lt&&(e=e.previewCanvas),this.fsCtx.createPattern(e,o)}async customTransform(e,o){this.fsCtx.save(),await e(this.fsCtx),await o(this),this.fsCtx.restore()}linearGradient(e,o,s,n){return this.fsCtx.createLinearGradient(e,o,s,n)}applyFilters(e){if(e.length===0)return;this.fsCtx.save();let o=1;for(const s of e)s.type==="opacity"&&(o*=s.value);if("filter"in this.fsCtx){const s=[];for(const n of e)n.type!=="opacity"&&(n.type==="drop-shadow"?s.push(`drop-shadow(${n.offsetX}px ${n.offsetY}px ${n.blurRadius}px ${n.color})`):n.type==="hue-rotate"?s.push(`hue-rotate(${n.value}deg)`):n.type==="blur"?s.push(`blur(${n.value}px)`):s.push(`${n.type}(${n.value*100}%)`));this.fsCtx.filter=s.join(" ")}this.fsCtx.drawImage(this.canvas,0,0),o!==1&&(this.fsCtx.globalCompositeOperation="destination-atop",this.fsCtx.fillStyle=`rgba(0,0,0,${o})`,this.fsCtx.fillRect(0,0,this.canvas.width,this.canvas.height),this.fsCtx.globalCompositeOperation="source-over"),"filter"in this.fsCtx&&(this.fsCtx.filter="none"),this.fsCtx.restore()}abort(){this.aborted=!0}}class Lt{constructor(e,o){f(this,"previewCanvas");f(this,"runningContext",null);const s=P();this.previewCanvas=document.createElement("canvas"),this.previewCanvas.width=e!=null?e:s.Base.screenWidth,this.previewCanvas.height=o!=null?o:s.Base.screenHeight}async render(e,o=!0,s=!0){this.runningContext&&this.runningContext.abort();const n=this.previewCanvas.getContext("2d");n.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height);const i=this.runningContext=Ft.makeWithContext(this.previewCanvas,n,o,s);try{await e(this.runningContext)}catch(r){if(r instanceof Vt)return!1;throw r}finally{i===this.runningContext&&(this.runningContext=null)}return!0}get width(){return this.previewCanvas.width}get height(){return this.previewCanvas.height}paintOnto(e,o){o.w&&o.h?e.drawImage(this.previewCanvas,o.x,o.y,o.w,o.h):e.drawImage(this.previewCanvas,o.x,o.y)}async download(e,o){const s=await this.drawToCanvas(e);return await R.saveToFile(s,o)}async renderToBlob(e){const o=await this.drawToCanvas(e);return await new Promise((s,n)=>{o.toBlob(i=>{i?s(i):n()})})}async drawToCanvas(e){const o=document.createElement("canvas");o.width=this.previewCanvas.width,o.height=this.previewCanvas.height;const s=o.getContext("2d");return s.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height),await e(Ft.makeWithContext(o,s,!0,!1)),o}getDataAt(e,o){return this.previewCanvas.getContext("2d").getImageData(e,o,1,1).data}}function Ce(t,e,o,s,n){const i=Math.cos(n),r=Math.sin(n),l=t-o,d=e-s,c=i*l-r*d+o,u=r*l+i*d+s;return[c,u]}class en{constructor(e){f(this,"localRenderer",null);f(this,"lastVersion",null);f(this,"hitDetectionFallback",!1);f(this,"renderable",!1);f(this,"lastHq",!1);f(this,"ready",Promise.resolve());this.obj=e}get id(){return this.obj.id}get x(){return this.obj.x}get y(){return this.obj.y}get version(){return this.obj.version}get flip(){return this.obj.flip}get rotation(){return this.obj.rotation/180*Math.PI}get composite(){return this.obj.composite}get filters(){return this.obj.filters}get width(){return this.obj.width}get height(){return this.obj.height}async updateLocalCanvas(e){await this.ready;const o=this.canvasWidth,s=this.canvasHeight;if(s===0&&o===0){this.renderable=!1;return}this.renderable=!0,this.localRenderer=new Lt(o,s),this.lastHq=e,await this.localRenderer.render(this.renderLocal.bind(this))}needsRedraw(){return this.localRenderer===null||this.lastVersion!==this.version}getRenderRotation(){return[this.flip?-this.rotation:this.rotation,{x:this.x,y:this.y+this.height/2}]}async render(e,o){if((this.lastHq!==o.hq||this.needsRedraw())&&await this.updateLocalCanvas(!o.hq),this.lastVersion=this.version,!this.renderable)return;const[n,i]=this.getRenderRotation();o.drawImage({image:this.localRenderer,x:this.canvasDrawPosX,y:this.canvasDrawPosY,w:this.canvasDrawWidth,h:this.canvasDrawHeight,rotation:n,rotationAnchor:i,flip:this.flip,shadow:e&&o.preview?{blur:20,color:"red"}:void 0,composite:this.composite,filters:this.filters})}hitTest(e,o){if(!this.localRenderer)return!1;const s=this.getHitbox(),n=s.x0+(s.x1-s.x0)/2,i=s.y0+(s.y1-s.y0)/2,[r,l]=Ce(e,o,n,i,this.flip?this.rotation:-this.rotation);if(!(r>=s.x0&&r<=s.x1&&l>=s.y0&&l<=s.y1))return!1;if(this.hitDetectionFallback)return!0;try{return this.pixelPerfectHitTest(e,o)}catch{this.hitDetectionFallback=!0}return!0}pixelPerfectHitTest(e,o){if(!this.localRenderer)return!1;const[s,n]=this.getRenderRotation(),[i,r]=n?Ce(e,o,n.x,n.y,-s):[e,o],l=Math.round(i-this.canvasDrawPosX),d=Math.round(r-this.canvasDrawPosY),c=this.canvasDrawWidth,u=this.canvasDrawHeight;if(l>=0&&l<=c&&d>=0&&d<=u){const p=this.flip?this.canvasDrawWidth-l:l,b=this.canvasWidth/this.canvasDrawWidth,T=this.canvasHeight/this.canvasDrawHeight;return this.localRenderer.getDataAt(Math.round(p*b),Math.round(d*T))[3]!==0}return!1}getHitbox(){return{x0:this.x-this.width/2,x1:this.x+this.width/2,y0:this.y,y1:this.y+this.height}}updatedContent(e,o){}}class $e extends en{constructor(e){super(e);f(this,"lastWidth",-1);f(this,"lastHeight",-1);f(this,"lastX",-1);f(this,"lastY",-1);f(this,"lastFlip",null);f(this,"canvasHeight");f(this,"canvasWidth");f(this,"canvasDrawHeight");f(this,"canvasDrawWidth");f(this,"canvasDrawPosX",0);f(this,"canvasDrawPosY",0);const o=P().Base;this.canvasHeight=o.screenHeight,this.canvasWidth=o.screenWidth,this.canvasDrawHeight=o.screenHeight,this.canvasDrawWidth=o.screenWidth}getRenderRotation(){return[0,void 0]}needsRedraw(){return super.needsRedraw()?!0:this.width!==this.lastWidth||this.height!==this.lastHeight||this.x!==this.lastX||this.y!==this.lastY||this.flip!==this.lastFlip}async updateLocalCanvas(e){this.lastWidth=this.width,this.lastHeight=this.height,this.lastX=this.x,this.lastY=this.y,this.lastFlip=this.flip,await super.updateLocalCanvas(e)}async renderLocal(e){const o=P().Base;if(this.rotation===0)return await this.draw(e);await e.customTransform(async s=>{const n=this.getHitbox(),i=n.x0+(n.x1-n.x0)/2,r=n.y0+(n.y1-n.y0)/2,l=this.flip?o.screenWidth-i:i;s.translate(l,r),s.rotate(this.rotation),s.translate(-l,-r)},this.draw.bind(this))}getHitbox(){const e=this.centeredVertically,o=this.width/2,s=this.height/2;return{x0:this.x-o,x1:this.x+o,y0:e?this.y-s:this.y,y1:e?this.y+s:this.y+this.height}}get centeredVertically(){return!1}}class Co{constructor(e){this.base=e}static get resizable(){return!1}static get defaultWidth(){return It}static get defaultHeight(){return ce}static get defaultX(){return P().Base.screenWidth/2}static get defaultY(){return P().Base.screenHeight-this.defaultHeight-it-P().TextBox.TextBoxBottomSpacing}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return no}getControlsDisabledStyle(){return ys}get textboxStyle(){return io}renderControls(e,o){const s=P(),n=this.width,i=n/2,d=(this.base.obj.flip?s.Base.screenWidth-this.base.obj.x:this.base.obj.x)-i+n/2,c=this.getControlsStyle();e.drawText(m({text:"History",x:d+Je,y:o},c)),e.drawText(m({text:"Skip",x:d+Ze,y:o},this.base.obj.skip?c:this.getControlsDisabledStyle())),e.drawText(m({text:"Auto   Save   Load   Settings",x:d+Qe,y:o},c))}}const Wo=class extends Co{constructor(){super(...arguments);f(this,"backgroundImage","textbox");f(this,"xOffset",0)}get height(){return ce+it}get width(){return It}get nameboxWidth(){return te}get nameboxHeight(){return it}get nameboxOffsetX(){return ee}get nameboxOffsetY(){return he}get nameboxStyle(){return pe}get textOffsetX(){return Qt}get textOffsetY(){return ue}async renderNamebox(e,o,s){e.drawImage({image:await dt("namebox"),x:o,y:s})}async renderBackdrop(e,o,s){o+=this.xOffset;const n=await dt(this.backgroundImage);e.drawImage({image:n,x:o,y:s})}async render(e){const o=P(),s=this.width,n=this.height,i=s/2,l=(this.obj.flip?o.Base.screenWidth-this.obj.x:this.obj.x)-i,d=this.obj.y;await this.renderBackdrop(e,l,d+this.nameboxHeight),this.obj.talkingObjId!==null&&await this.renderNamebox(e,l+this.nameboxOffsetX,d);const c=d+n,u=c-Ke;this.obj.controls&&this.renderControls(e,u),this.obj.continue&&e.drawImage({image:await dt("next"),x:l+s-to,y:c-eo})}appliesTo(e){return e===Wo.id}};let jt=Wo;f(jt,"id","normal"),f(jt,"label","Normal"),f(jt,"priority",0),f(jt,"gameMode","ddlc");const No=class extends jt{constructor(){super(...arguments);f(this,"backgroundImage","textbox_monika");f(this,"xOffset",(It-qe)/2)}appliesTo(e){return e===No.id}};let Et=No;f(Et,"id","corrupt"),f(Et,"label","Corrupted"),f(Et,"priority",1),f(Et,"gameMode","ddlc");function ke(t,e,o,s,n,i){s<0&&(s=0),n<0&&(n=0),s<2*i&&(i=s/2),n<2*i&&(i=n/2),t.moveTo(e+i,o),t.arcTo(e+s,o,e+s,o+n,i),t.arcTo(e+s,o+n,e,o+n,i),t.arcTo(e,o+n,e,o,i),t.arcTo(e,o,e+s,o,i),t.closePath()}function on(t,e,o,s,n,i){s<0&&(s=0),n<0&&(n=0),s<2*i&&(i=s/2),n<2*i&&(i=n/2),t.moveTo(e+i,o),t.arcTo(e+s,o,e+s,o+n,i),t.lineTo(e+s,o+n),t.lineTo(e,o+n),t.arcTo(e,o,e+s,o,i),t.closePath()}const Vo=class extends Co{constructor(){super(...arguments);f(this,"backgroundImage","textbox");f(this,"xOffset",0)}static get resizable(){return!0}get height(){return this.obj.height+it}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth!==null?this.obj.customNameboxWidth:te}get nameboxHeight(){return it}get nameboxOffsetX(){return ee}get nameboxOffsetY(){return he}get nameboxStyle(){return S(m({},pe),{strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"})}get textOffsetX(){return Qt}get textOffsetY(){return ue}get customColor(){return this.obj.overrideColor?this.obj.customColor:this.refObject&&this.refObject.textboxColor?this.refObject.textboxColor:ls}get nameboxOutlineColor(){return this.obj.deriveCustomColors?H.fromCss(this.customColor).toHSL().shift(ds).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?H.fromCss(this.customColor).toHSL().shift(cs).toRgb().toCss():this.obj.customNameboxColor}async renderNamebox(e,o,s){const n=this.nameboxWidth,i=this.nameboxHeight;await e.customTransform(async r=>{r.beginPath(),on(r,o,s,n,i,ps),r.clip()},async r=>{const l=r.linearGradient(o,s,o,s+i),d=H.fromCss(this.nameboxBackgroundColor),c=new H(d.r,d.g,d.b,.95),u=c.toHSL().shift(hs).toRgb();l.addColorStop(0,c.toCss()),l.addColorStop(us,c.toCss()),l.addColorStop(1,u.toCss()),r.drawRect({x:o,y:s,w:this.obj.width,h:i,fill:{style:l}})})}async renderBackdrop(e,o,s){const n=H.fromCss(this.customColor).toHSL(),i=new Lt(ut,ut);await i.render(async l=>{const d={style:n.shift(fs).toRgb().toCss()};function c(u,p){l.drawPath({path:b=>{b.ellipse(u,p,Ye,Ye,0,0,2*Math.PI)},fill:d})}c(0,0),c(ut,0),c(0,ut),c(ut,ut),c(ut/2,ut/2)},!0),await e.customTransform(async l=>{l.beginPath(),ke(l,o+ct,s+ct,this.width-ct*2,this.height-it-ct*2,Ge),l.clip()},async l=>{const d=this.obj.height,c=this.obj.width,u=l.linearGradient(o,s,o,s+d),p=H.fromHex(this.customColor);u.addColorStop(0,p.toCss()),u.addColorStop(1,`rgba(${p.r},${p.g},${p.b},0.6667)`),l.drawRect({x:o,y:s,w:c,h:d,fill:{style:u},outline:{style:"#ffdfee",width:6}}),await l.customTransform(async T=>{T.translate(o,s)},async T=>{const x=l.patternFrom(i);l.drawRect({x:0,y:0,w:c,h:d,fill:{style:x},composition:"source-atop"})});const b=l.linearGradient(o,s+d-oo,o,s+d);b.addColorStop(0,"rgba(255,255,255,0.3137)"),b.addColorStop(.5,"rgba(255,255,255,0.0627)"),b.addColorStop(1,"rgba(255,255,255,0)"),l.drawPath({path:T=>{T.ellipse(o+c/2,s+d,ms,oo,0,0,2*Math.PI)},fill:{style:b}})});const r=n.shift(gs).toRgb().toCss();e.drawPath({path:l=>{ke(l,o+ct,s+ct,this.width-ct*2,this.height-it-ct*2,Ge)},outline:{style:r,width:bs}})}async render(e){const o=P(),s=this.width,n=this.height,i=s/2,l=(this.obj.flip?o.Base.screenWidth-this.obj.x:this.obj.x)-i,d=this.obj.y;this.obj.talkingObjId!==null&&await this.renderNamebox(e,l+this.nameboxOffsetX,d),await this.renderBackdrop(e,l,d+this.nameboxHeight);const c=d+n,u=c-Ke;this.obj.controls&&this.renderControls(e,u),this.obj.continue&&e.drawImage({image:await dt("next"),x:l+s-to,y:c-eo})}appliesTo(e){return e===Vo.id}};let zt=Vo;f(zt,"id","custom"),f(zt,"label","Custom"),f(zt,"priority",0),f(zt,"gameMode","ddlc");const Fo=class extends Co{get height(){return ce+it}get width(){return It}get nameboxWidth(){return te}get nameboxHeight(){return it}get nameboxOffsetX(){return ee}get nameboxOffsetY(){return he}get nameboxStyle(){return pe}get textOffsetX(){return Qt}get textOffsetY(){return ue}get textboxStyle(){return io}async render(e){}appliesTo(e){return e===Fo.id}};let Ut=Fo;f(Ut,"id","none"),f(Ut,"label","None"),f(Ut,"priority",0),f(Ut,"gameMode","ddlc");const Lo=class{constructor(e){this.base=e}static get resizable(){return!1}static get defaultWidth(){return uo}static get defaultHeight(){return Ds}static get defaultX(){return P().Base.screenWidth/2}static get defaultY(){return P().Base.screenHeight-this.defaultHeight-Ht-P().TextBox.TextBoxBottomSpacing}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return ge}getControlsDisabledStyle(){return zs}renderControls(e,o){const s=P(),n=this.width,i=n/2,l=(this.base.obj.flip?s.Base.screenWidth-this.base.obj.x:this.base.obj.x)-i,d=this.getControlsStyle(),c=["History","Skip","Auto","Save","Load","Settings"],u=[];let p=0;for(const x of c){const $=Lo.controlWidth(e,x);u.push($),p+=$}const b=Math.min((n-p)/c.length,78);let T=l+(n-p-b*(c.length-1))/2;for(let x=0;x<c.length;++x){const $=c[x],et=u[x],V=$==="Skip"&&!this.base.obj.skip?this.getControlsDisabledStyle():d;e.drawText(m({text:$,x:T,y:o},V)),T+=et+b}}static controlWidth(e,o){if(this.widthCache[o])return this.widthCache[o];const s=e.measureText(m({text:o},ge)).width;return this.widthCache[o]=s,s}};let $o=Lo;f($o,"widthCache",{});const Eo=class extends $o{constructor(){super(...arguments);f(this,"backgroundImage","textbox");f(this,"xOffset",0)}static get resizable(){return!0}get height(){return this.obj.height+Ht}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth!==null?this.obj.customNameboxWidth:po}get nameboxHeight(){return Ht}get nameboxOffsetX(){return fo}get nameboxOffsetY(){return As}get nameboxStyle(){return S(m({},Es),{strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"})}get textOffsetX(){return ho}get textOffsetY(){return Hs}get textboxStyle(){return Us}get customColor(){return this.obj.overrideColor?this.obj.customColor:this.refObject&&this.refObject.textboxColor?this.refObject.textboxColor:ks}get nameboxOutlineColor(){return this.obj.deriveCustomColors?H.fromCss(this.customColor).toHSL().shift(xs).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?H.fromCss(this.customColor).toHSL().shift(Ss).toRgb().toCss():this.obj.customNameboxColor}async renderNamebox(e,o,s){const n=this.nameboxWidth,i=this.nameboxHeight;await e.customTransform(async r=>{r.beginPath(),on(r,o,s,n,i,Ts),r.clip()},async r=>{const l=r.linearGradient(o,s,o,s+i),d=H.fromCss(this.nameboxBackgroundColor),c=new H(d.r,d.g,d.b,.95),u=c.toHSL().shift(Ps).toRgb();l.addColorStop(0,c.toCss()),l.addColorStop(js,c.toCss()),l.addColorStop(1,u.toCss()),r.drawRect({x:o,y:s,w:this.obj.width,h:i,fill:{style:l}})})}async renderBackdrop(e,o,s){const n=H.fromCss(this.customColor).toHSL(),i=new Lt(pt,pt);await i.render(async l=>{const d={style:n.shift(_s).toRgb().toCss()};function c(u,p){l.drawPath({path:b=>{b.ellipse(u,p,co,co,0,0,2*Math.PI)},fill:d})}c(0,0),c(pt,0),c(0,pt),c(pt,pt),c(pt/2,pt/2)},!0),await e.customTransform(async l=>{l.beginPath(),ke(l,o+ht,s+ht,this.width-ht*2,this.height-Ht-ht*2,lo),l.clip()},async l=>{const d=this.obj.height,c=this.obj.width,u=l.linearGradient(o,s,o,s+d),p=H.fromHex(this.customColor);u.addColorStop(0,p.toCss()),u.addColorStop(1,`rgba(${p.r},${p.g},${p.b},0.6667)`),l.drawRect({x:o,y:s,w:c,h:d,fill:{style:u},outline:{style:"#ffdfee",width:6}}),await l.customTransform(async T=>{T.translate(o,s)},async T=>{const x=l.patternFrom(i);l.drawRect({x:0,y:0,w:c,h:d,fill:{style:x},composition:"source-atop"})});const b=l.linearGradient(o,s+d-go,o,s+d);b.addColorStop(0,"rgba(255,255,255,0.3137)"),b.addColorStop(.5,"rgba(255,255,255,0.0627)"),b.addColorStop(1,"rgba(255,255,255,0)"),l.drawPath({path:T=>{T.ellipse(o+c/2,s+d,Ls,go,0,0,2*Math.PI)},fill:{style:b}})});const r=n.shift(Bs).toRgb().toCss();e.drawPath({path:l=>{ke(l,o+ht,s+ht,this.width-ht*2,this.height-Ht-ht*2,lo)},outline:{style:r,width:Os}})}async render(e){const o=P(),s=this.width,n=this.height,i=s/2,l=(this.obj.flip?o.Base.screenWidth-this.obj.x:this.obj.x)-i,d=this.obj.y;this.obj.talkingObjId!==null&&await this.renderNamebox(e,l+this.nameboxOffsetX,d),await this.renderBackdrop(e,l,d+this.nameboxHeight);const c=d+n,u=c-Rs;this.obj.controls&&this.renderControls(e,u),this.obj.continue&&e.drawImage({image:await dt("next_plus"),x:l+s-Vs,y:c-Fs})}appliesTo(e){return e===Eo.id}};let Xt=Eo;f(Xt,"id","custom_plus"),f(Xt,"label","Custom (Plus)"),f(Xt,"priority",0),f(Xt,"gameMode","ddlc_plus");const bd=[jt,Et,zt,Ut,Xt],Gt=(()=>{const t={};for(const e of bd)t[e.id]=e;return t})();class md extends $e{constructor(){super(...arguments);f(this,"refObject",null);f(this,"_lastRenderer",null)}get y(){return this.obj.y}get width(){return this.textboxRenderer.width}get height(){return this.textboxRenderer.height}get textboxRenderer(){if(this._lastRenderer&&this._lastRenderer.appliesTo(this.obj.style))return this._lastRenderer;const e=this.forcedStyle;if(!Gt[e])throw new Error("Unknown textbox style renderer");const o=new Gt[e](this);return this._lastRenderer=o,o}get forcedStyle(){return(this.obj.style==="normal"||this.obj.style==="normal_plus")&&this.refObject&&(this.refObject.textboxColor||this.refObject.nameboxWidth!==null)?"custom":this.obj.style}updatedContent(e,o){super.updatedContent(e,o);const s=this.obj.talkingObjId;if(s!==null&&s!=="$other$"){const n=e.state.objects.objects[s];if(n){this.refObject=n;return}}this.refObject=null}async draw(e){var c;const o=P(),s=this.textboxRenderer,n=s.width,i=n/2,l=(this.flip?o.Base.screenWidth-this.obj.x:this.obj.x)-i,d=this.obj.y;if(await s.render(e),this.obj.talkingObjId!==null){const u=this.obj.talkingObjId==="$other$"?this.obj.talkingOther:((c=this.refObject)==null?void 0:c.label)||"Missing name";await this.renderName(e,l+s.nameboxOffsetX,d,u)}await this.renderText(e,l,d,this.obj.autoWrap?n:0)}async renderName(e,o,s,n){const i=this.textboxRenderer,r=i.nameboxWidth,l=i.nameboxStyle,d=new ft(n,l);await d.loadFonts(),d.fixAlignment("center",o,o+r,s+i.nameboxOffsetY,0),d.render(e.fsCtx)}async renderText(e,o,s,n){const i=new ft(this.obj.text,this.textboxRenderer.textboxStyle);this.obj.autoQuoting&&this.obj.talkingObjId!==null&&i.quote(),await i.loadFonts(),i.fixAlignment("left",o+this.textboxRenderer.textOffsetX,0,s+this.textboxRenderer.nameboxHeight+this.textboxRenderer.textOffsetY,n-this.textboxRenderer.textOffsetX*2),i.render(e.fsCtx)}}const yd=I({components:{Toggle:nt,DFieldset:rt},props:{obj:{required:!0}},computed:{freeMove:{get(){return this.obj.freeMove},set(t){this.vuexHistory.transaction(()=>{this.$store.commit("objects/setFreeMove",{id:this.obj.id,freeMove:t})})}},preserveRatio:{get(){return this.obj.preserveRatio},set(t){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/setPreserveRatio",{id:this.obj.id,preserveRatio:t})})}},pos:{get(){return me(this.obj.x)},set(t){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/setPosition",{id:this.obj.id,x:P().Base.characterPositions[t],y:this.obj.y})})}},x:{get(){return this.obj.x},set(t){this.vuexHistory.transaction(()=>{this.$store.commit("objects/setPosition",{id:this.obj.id,x:t,y:this.y})})}},y:{get(){return this.obj.y},set(t){this.vuexHistory.transaction(()=>{this.$store.commit("objects/setPosition",{id:this.obj.id,x:this.x,y:t})})}},height:{get(){return this.obj.height},set(t){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/setHeight",{id:this.obj.id,height:t})})}},width:{get(){return this.obj.width},set(t){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/setWidth",{id:this.obj.id,width:t})})}},allowSize(){const t=this.obj;return t.type==="textBox"?Gt[t.style].resizable:!(t.type==="character"&&!t.freeMove)},allowStepMove(){return"freeMove"in this.obj},positionNames(){return P().Base.positions},isFirstPos(){return this.pos===0},isLastPos(){return this.pos===P().Base.positions.length-1}}}),xe=t=>(G("data-v-d3b3c4d4"),t=t(),Y(),t),vd={colspan:"2"},wd={key:0},Cd={colspan:"2"},$d={class:"arrow-col"},kd=["disabled"],xd=["value"],Sd={class:"arrow-col"},jd=["disabled"],Pd=xe(()=>a("td",null,[a("label",{for:"sprite_x"},"X:")],-1)),Td=xe(()=>a("td",null,[a("label",{for:"sprite_y"},"Y:")],-1)),_d=xe(()=>a("td",null,[a("label",{for:"sprite_w"},"Width:")],-1)),Bd=xe(()=>a("td",null,[a("label",{for:"sprite_h"},"Height:")],-1)),Od={colspan:"2"};function Id(t,e,o,s,n,i){const r=v("toggle"),l=v("d-fieldset");return h(),k(l,{title:"Position"+(t.allowSize?"/Size":"")},{default:w(()=>[a("table",null,[a("tr",null,[a("td",vd,[t.allowStepMove?(h(),k(r,{key:0,modelValue:t.freeMove,"onUpdate:modelValue":e[0]||(e[0]=d=>t.freeMove=d),label:"Move freely?"},null,8,["modelValue"])):j("",!0)])]),t.allowStepMove&&!t.freeMove?(h(),g("tr",wd,[a("td",Cd,[a("table",null,[a("tr",null,[a("td",$d,[a("button",{onClick:e[1]||(e[1]=d=>--t.pos),disabled:t.isFirstPos},"<",8,kd)]),a("td",null,[A(a("select",{id:"current_talking","onUpdate:modelValue":e[2]||(e[2]=d=>t.pos=d)},[(h(!0),g(_,null,E(t.positionNames,(d,c)=>(h(),g("option",{key:c,value:c},F(d),9,xd))),128))],512),[[ot,t.pos,void 0,{number:!0}]])]),a("td",Sd,[a("button",{onClick:e[3]||(e[3]=d=>++t.pos),disabled:t.isLastPos},">",8,jd)])])])])])):(h(),g(_,{key:1},[a("tr",null,[Pd,a("td",null,[A(a("input",{id:"sprite_x",type:"number","onUpdate:modelValue":e[4]||(e[4]=d=>t.x=d),onKeydown:e[5]||(e[5]=O(()=>{},["stop"]))},null,544),[[z,t.x,void 0,{number:!0}]])])]),a("tr",null,[Td,a("td",null,[A(a("input",{id:"sprite_y",type:"number","onUpdate:modelValue":e[6]||(e[6]=d=>t.y=d),onKeydown:e[7]||(e[7]=O(()=>{},["stop"]))},null,544),[[z,t.y,void 0,{number:!0}]])])])],64)),t.allowSize?(h(),g(_,{key:2},[a("tr",null,[_d,a("td",null,[A(a("input",{id:"sprite_w",min:"0",type:"number","onUpdate:modelValue":e[8]||(e[8]=d=>t.width=d),onKeydown:e[9]||(e[9]=O(()=>{},["stop"]))},null,544),[[z,t.width,void 0,{number:!0}]])])]),a("tr",null,[Bd,a("td",null,[A(a("input",{id:"sprite_h",min:"0",type:"number","onUpdate:modelValue":e[10]||(e[10]=d=>t.height=d),onKeydown:e[11]||(e[11]=O(()=>{},["stop"]))},null,544),[[z,t.height,void 0,{number:!0}]])])]),a("tr",null,[a("td",Od,[y(r,{modelValue:t.preserveRatio,"onUpdate:modelValue":e[12]||(e[12]=d=>t.preserveRatio=d),label:"Lock ratio?"},null,8,["modelValue"])])])],64)):j("",!0)])]),_:1},8,["title"])}var Dd=D(yd,[["render",Id],["__scopeId","data-v-d3b3c4d4"]]);const Hd=I({components:{Toggle:nt,DFieldset:rt},props:{object:{required:!0}},computed:{onTop:St()("onTop","objects/setOnTop",!0)},methods:{shiftLayer(t){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/shiftLayer",{id:this.object.id,delta:t})})}}}),Se=t=>(G("data-v-8a60ff0c"),t=t(),Y(),t),Ad=Se(()=>a("i",{class:"material-icons"},"vertical_align_bottom",-1)),Rd=[Ad],Md=Se(()=>a("i",{class:"material-icons"},"arrow_downward",-1)),Wd=[Md],Nd=Se(()=>a("i",{class:"material-icons"},"arrow_upward",-1)),Vd=[Nd],Fd=Se(()=>a("i",{class:"material-icons"},"vertical_align_top",-1)),Ld=[Fd];function Ed(t,e,o,s,n,i){const r=v("toggle"),l=v("d-fieldset");return h(),k(l,{id:"layerfs",title:"Layer:"},{default:w(()=>[a("table",null,[a("tbody",null,[a("tr",null,[a("td",null,[a("button",{onClick:e[0]||(e[0]=d=>t.shiftLayer(-1/0)),title:"Move to back"},Rd)]),a("td",null,[a("button",{onClick:e[1]||(e[1]=d=>t.shiftLayer(-1)),title:"Move backwards"},Wd)]),a("td",null,[a("button",{onClick:e[2]||(e[2]=d=>t.shiftLayer(1)),title:"Move forwards"},Vd)]),a("td",null,[a("button",{onClick:e[3]||(e[3]=d=>t.shiftLayer(1/0)),title:"Move to front"},Ld)])])])]),y(r,{modelValue:t.onTop,"onUpdate:modelValue":e[4]||(e[4]=d=>t.onTop=d),label:"In front?"},null,8,["modelValue"])]),_:1})}var zd=D(Hd,[["render",Ed],["__scopeId","data-v-8a60ff0c"]]);const Ud=I({props:{obj:{required:!0}},methods:{onClick(){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/removeObject",{id:this.obj.id})})}}});function Xd(t,e,o,s,n,i){return h(),g("button",{onClick:e[0]||(e[0]=(...r)=>t.onClick&&t.onClick(...r))},"Delete")}var Gd=D(Ud,[["render",Xd]]);const je=255,ko=8,Yd=I({props:{label:{type:String,required:!0},gradientStops:{required:!0},modelValue:{type:Number,required:!0},maxValue:{type:Number,required:!0},shiftGradient:{type:Boolean,default:!1},noInput:{type:Boolean,default:!1}},data:()=>({slideActive:!1}),computed:{vertical(){return this.$store.state.ui.vertical},pointerPath(){const t=this.modelValue/this.maxValue*je;return`M${t} 0L${t+14} 0L${t+7} 12Z`},gradientOffset(){return!this.shiftGradient||this.modelValue===0?0:this.modelValue/this.maxValue}},methods:{enterSlide(t){this.slideActive=!0,this.moveSlide(t)},moveSlide(t){if(!this.slideActive)return;const e=this.$refs.svg;if(!e.contains(t.target)&&t.target!==e)return;if(t instanceof MouseEvent&&t.which!==1){this.slideActive=!1;return}const o=e.getBoundingClientRect(),s=o.width/(ko+je+ko),i=((t instanceof MouseEvent?t.clientX:t.touches[0].clientX)-o.x)/s;t.preventDefault();const r=Math.max(Math.min(i-ko,je),0)/je*this.maxValue;this.$emit("update:modelValue",r)},exitSlide(){this.slideActive=!1}}}),qd=["for"],Kd=["id","x1","x2"],Jd=["offset"],Zd=["fill"],Qd=["d"],tc=["id","max","value"];function ec(t,e,o,s,n,i){return h(),g("div",{class:W({slider:!0,vertical:t.vertical}),onKeydown:e[8]||(e[8]=O(()=>{},["stop"]))},[t.noInput?j("",!0):(h(),g("label",{key:0,for:t._.uid},F(t.label),9,qd)),a("div",null,[(h(),g("svg",{ref:"svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 271 24",onMousedown:e[0]||(e[0]=(...r)=>t.enterSlide&&t.enterSlide(...r)),onTouchstart:e[1]||(e[1]=(...r)=>t.enterSlide&&t.enterSlide(...r)),onMousemove:e[2]||(e[2]=(...r)=>t.moveSlide&&t.moveSlide(...r)),onTouchmove:e[3]||(e[3]=(...r)=>t.moveSlide&&t.moveSlide(...r)),onMouseup:e[4]||(e[4]=(...r)=>t.exitSlide&&t.exitSlide(...r)),onTouchend:e[5]||(e[5]=(...r)=>t.exitSlide&&t.exitSlide(...r))},[a("defs",null,[a("linearGradient",{id:`gradient${t._.uid}`,x1:t.gradientOffset*100+"%",y1:"0%",x2:(t.gradientOffset+1)*100+"%",y2:"0%",spreadMethod:"repeat"},[(h(!0),g(_,null,E(t.gradientStops,(r,l)=>(h(),g("stop",{key:l,offset:l/(t.gradientStops.length-1)*100+"%",style:K("stop-color:"+r)},null,12,Jd))),128))],8,Kd)]),a("g",null,[a("path",{d:"M7 0H262V24H7z","stroke-width":"2","paint-order":"fill stroke markers",fill:`url(#gradient${t._.uid})`},null,8,Zd),a("path",{d:t.pointerPath,"stroke-width":"2",class:"slider-pointer"},null,8,Qd)])],544))]),t.noInput?j("",!0):(h(),g("input",{key:1,id:t._.uid,class:"sliderInput",min:"0",max:t.maxValue,value:t.modelValue,type:"number",onInput:e[6]||(e[6]=r=>t.$emit("update:modelValue",parseFloat(r.target.value))),onKeydown:e[7]||(e[7]=O(()=>{},["stop"]))},null,40,tc))],34)}var sn=D(Yd,[["render",ec],["__scopeId","data-v-07768f1c"]]);const oc=I({components:{Slider:sn},props:{modelValue:{type:String,validator:t=>!!t.match(/^#[0-9a-f]{6,8}$/i)},mode:{type:String},relative:Boolean},data:()=>({lastRGBEmit:null,v1:0,v2:0,v3:0,a:0}),computed:{vertical(){return this.$store.state.ui.vertical},maxValue1(){return this.mode==="rgba"?255:360},label1(){return this.mode==="rgba"?"Red":"Hue"},stops1(){let t=[];if(this.mode==="rgba"){const e=this.relative?this.v2:0,o=this.relative?this.v3:0;t=[new H(0,e,o,1),new H(255,e,o,1)]}else{const e=this.relative?this.v2/100:1,o=this.relative?this.v3/100:.5;t=this.eightsStops(s=>new N(s,e,o,1))}return t.map(e=>e.toRgb().toCss())},maxValue2(){return this.mode==="rgba"?255:100},label2(){return this.mode==="rgba"?"Green":"Saturation"},stops2(){let t=[];if(this.mode==="rgba"){const e=this.relative?this.v1:0,o=this.relative?this.v3:0;t=[new H(e,0,o,1),new H(e,255,o,1)]}else{const e=this.relative?this.v1/360:0,o=this.relative?this.v3/100:.5;t=this.eightsStops(s=>new N(e,s,o,1))}return t.map(e=>e.toRgb().toCss())},maxValue3(){return this.mode==="rgba"?255:100},label3(){return this.mode==="rgba"?"Blue":"Luminosity"},stops3(){let t=[];if(this.mode==="rgba"){const e=this.relative?this.v1:0,o=this.relative?this.v2:0;t=[new H(e,o,0,1),new H(e,o,255,1)]}else{const e=this.relative?this.v1/360:0,o=this.relative?this.v2/100:.5;t=this.eightsStops(s=>new N(e,o,s,1))}return t.map(e=>e.toRgb().toCss())},stopsAlpha(){const t=H.fromHex(this.modelValue);return[new H(t.r,t.g,t.b,0).toCss(),new H(t.r,t.g,t.b,1).toCss()]}},created(){this.initValues()},methods:{valueChanged(){this.modelValue!==this.lastRGBEmit&&this.initValues()},updateValue(){let t;this.mode==="rgba"?t=new H(this.v1,this.v2,this.v3,this.a/255):t=new N(this.v1/360,this.v2/100,this.v3/100,this.a/255);const e=t.toRgb().toHex();if(this.lastRGBEmit!==e){if(e.length!==9)throw new Error(`Invalid color code: ${e}`);this.lastRGBEmit=e,this.$emit("update:modelValue",e)}},initValues(){const t=H.fromHex(this.modelValue);if(this.lastRGBEmit=t.toHex(),this.a=t.a*255,this.mode==="hsla"){const e=t.toHSL();this.v1=e.h*360,this.v2=e.s*100,this.v3=e.l*100}else this.v1=t.r,this.v2=t.g,this.v3=t.b},eightsStops(t){const e=[];for(let o=0;o<=8;++o)e.push(t(o/8));return e}},watch:{value(){this.valueChanged()},v1(){this.updateValue()},v2(){this.updateValue()},v3(){this.updateValue()},a(){this.updateValue()},mode(){this.initValues()}}});function sc(t,e,o,s,n,i){const r=v("slider");return h(),g("div",null,[y(r,{label:t.label1,modelValue:t.v1,"onUpdate:modelValue":e[0]||(e[0]=l=>t.v1=l),"max-value":t.maxValue1,"gradient-stops":t.stops1},null,8,["label","modelValue","max-value","gradient-stops"]),y(r,{label:t.label2,modelValue:t.v2,"onUpdate:modelValue":e[1]||(e[1]=l=>t.v2=l),"max-value":t.maxValue2,"gradient-stops":t.stops2},null,8,["label","modelValue","max-value","gradient-stops"]),y(r,{label:t.label3,modelValue:t.v3,"onUpdate:modelValue":e[2]||(e[2]=l=>t.v3=l),"max-value":t.maxValue3,"gradient-stops":t.stops3},null,8,["label","modelValue","max-value","gradient-stops"]),y(r,{label:"Alpha",modelValue:t.a,"onUpdate:modelValue":e[3]||(e[3]=l=>t.a=l),"max-value":255,"gradient-stops":t.stopsAlpha},null,8,["modelValue","gradient-stops"])])}var nc=D(oc,[["render",sc],["__scopeId","data-v-238b9279"]]);const ic="dddg.generated.colors",rc=I({components:{SliderGroup:nc,DButton:le},inheritAttrs:!1,emits:["leave","update:modelValue"],props:{modelValue:{required:!0,type:String},title:{default:""},format:{type:String,default:"hex"}},data:()=>({mode:"hsla",relative:!0}),computed:{vertical(){return this.$store.state.ui.vertical},swatches(){return this.$store.state.content.current.colors},color:{get(){return this.format==="rgb"?H.fromCss(this.modelValue).toHex():this.modelValue},set(t){if(this.format==="rgb"){const e=H.fromCss(t);this.$emit("update:modelValue",e.toCss())}else this.$emit("update:modelValue",t)}}},mounted(){U.subscribe(re,this.settingColor)},unmounted(){U.unsubscribe(re,this.settingColor)},methods:{settingColor(t){this.color=H.fromCss(t.color).toHex()},updateHex(t){const e=t.target.value;H.validHex(e)&&(e.length===7||e.length===9)&&(this.color=e)},addSwatch(){if(this.swatches.find(o=>o.color===this.color))return;const t=this.$store.state.content.contentPacks.find(o=>o.packId==="generatedPackId")||{packId:ic,packCredits:[""],dependencies:[],characters:[],fonts:[],backgrounds:[],sprites:[],poemStyles:[],poemBackgrounds:[],colors:[]},e=S(m({},t),{colors:[...t.colors,{label:this.color,color:this.color}]});this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:e,processed:!0})})},pickColor(){this.vuexHistory.transaction(()=>{this.$store.commit("ui/setColorPicker",!0)})}}}),ac={class:"column"},lc={class:"hex-selector"},dc=["for"],cc=["id","value"],uc=C("Pick color"),hc=["title","onClick"];function pc(t,e,o,s,n,i){const r=v("slider-group"),l=v("d-button");return h(),g("div",{class:W({color:!0,vertical:t.vertical})},[a("h2",null,F(t.title),1),a("button",{onClick:e[0]||(e[0]=d=>t.$emit("leave"))},"OK"),a("table",null,[a("tr",null,[a("td",null,[a("button",{onClick:e[1]||(e[1]=d=>t.mode="hsla")},"HSLA")]),a("td",null,[a("button",{onClick:e[2]||(e[2]=d=>t.mode="rgba")},"RGBA")])])]),a("div",ac,[y(r,{mode:t.mode,modelValue:t.color,"onUpdate:modelValue":e[3]||(e[3]=d=>t.color=d),relative:!0},null,8,["mode","modelValue"]),a("div",lc,[a("label",{class:"hex-label",for:`hex_${t._.uid}`},"Hex",8,dc),a("input",{id:`hex_${t._.uid}`,value:t.color,onInput:e[4]||(e[4]=(...d)=>t.updateHex&&t.updateHex(...d)),onKeydown:e[5]||(e[5]=O(()=>{},["stop"]))},null,40,cc)]),a("button",{onClick:e[6]||(e[6]=(...d)=>t.addSwatch&&t.addSwatch(...d))},"Add as swatch"),y(l,{icon:"colorize",onClick:t.pickColor},{default:w(()=>[uc]),_:1},8,["onClick"])]),a("div",{id:"color-swatches",class:W({vertical:t.vertical})},[(h(!0),g(_,null,E(t.swatches,d=>(h(),g("button",{class:"swatch",key:d.color,style:K({backgroundColor:d.color}),title:d.label,onClick:c=>{t.color=d.color,t.$emit("leave")}},null,12,hc))),128))],2)],2)}var Pe=D(rc,[["render",pc],["__scopeId","data-v-093599c4"]]);const nn=new Set(["brightness","contrast","grayscale","invert","opacity","saturate","sepia"]);function xo(t,e,o){const n=[...e(t.id).filters];let i;switch(t.type){case"hue-rotate":i={type:t.type,value:0};break;case"sepia":case"invert":case"blur":case"grayscale":case"brightness":case"contrast":case"opacity":case"saturate":i={type:t.type,value:1};break;case"drop-shadow":i={type:t.type,blurRadius:0,offsetX:10,offsetY:10,color:"#555555"};break;default:Nt(t.type)}n.splice(t.idx,0,i),o({id:t.id,filters:n})}function So(t,e,o){const n=[...e(t.id).filters];n.splice(t.idx,1),o({id:t.id,filters:n})}function jo(t,e,o){const n=[...e(t.id).filters],i=n[t.idx];n.splice(t.idx,1),n.splice(t.idx+t.moveBy,0,i),o({id:t.id,filters:n})}function Po(t,e,o){const n=[...e(t.id).filters],i=m({},n[t.idx]);n[t.idx]=i,i.type==="drop-shadow"?(t.blurRadius!==void 0&&(i.blurRadius=t.blurRadius),t.color!==void 0&&(i.color=t.color),t.offsetX!==void 0&&(i.offsetX=t.offsetX),t.offsetY!==void 0&&(i.offsetY=t.offsetY)):i.value=t.value,o({id:t.id,filters:n})}const Yt=new Map([["blur","Blur"],["brightness","Brightness"],["contrast","Contrast"],["grayscale","Grayscale"],["hue-rotate","Rotate hue"],["invert","Invert colors"],["opacity","Opacity"],["saturate","Saturate"],["sepia","Sepia"],["drop-shadow","Drop shadow"]]),fc=Array.from(Yt.keys()).sort(),gc=I({components:{DFlow:oe,DFieldset:rt,Color:Pe,Slider:sn,L:ze},props:{type:{type:String,required:!0},title:{type:String},id:{required:!0},noComposition:{type:Boolean,default:!1}},emits:["leave"],data:()=>({addEffectSelection:"",currentFilterIdx:0,showShadowColor:!1}),computed:{object(){switch(this.type){case"object":return this.$store.state.objects.objects[this.id];case"background":return this.$store.state.panels.panels[this.id].background;case"panel":return this.$store.state.panels.panels[this.id];default:return Nt(this.type),null}},compositionMode:{get(){return this.object.composite},set(t){this.vuexHistory.transaction(()=>{switch(this.type){case"object":this.$store.commit("objects/setComposition",{id:this.id,composite:t});break;case"background":break;case"panel":break;default:Nt(this.type);break}})}},filters(){return this.object.filters},filterTypes(){try{const e=document.createElement("canvas").getContext("2d");if("filter"in e)return fc}catch{}return["opacity"]},currentFilter(){return this.filters[this.currentFilterIdx]||null},isPercentFilter(){const t=this.currentFilter;return t?nn.has(t.type):!1},maxValue(){const t=this.currentFilter;if(!!t){if(t.type==="hue-rotate")return 360;if(t.type==="grayscale"||t.type==="sepia"||t.type==="opacity"||t.type==="invert")return 100}},minValue(){const t=this.currentFilter;if(!!t)switch(t.type){case"blur":case"brightness":case"contrast":case"grayscale":case"hue-rotate":case"invert":case"opacity":case"saturate":case"sepia":return 0}},shadowColor:{get(){const t=this.currentFilter;if(!!t&&"color"in t)return t.color},set(t){this.setValue({color:t})}},shadowX:{get(){const t=this.currentFilter;if(!!t&&"offsetX"in t)return t.offsetX},set(t){this.setValue({offsetX:t})}},shadowY:{get(){const t=this.currentFilter;if(!!t&&"offsetY"in t)return t.offsetY},set(t){this.setValue({offsetY:t})}},shadowBlur:{get(){const t=this.currentFilter;if(!!t&&"blurRadius"in t)return t.blurRadius},set(t){this.setValue({blurRadius:t})}},hueStops(){return this.eightsStops(e=>new N(e,1,.5,1)).map(e=>e.toRgb().toCss())}},methods:{getFilterLabel(t){return Yt.get(t)},getFilterText(t){return nn.has(t.type)?`${Yt.get(t.type)} ${(t.value*100).toFixed()}%`:t.type==="hue-rotate"?`${Yt.get(t.type)} ${t.value.toFixed()}\xB0`:t.type==="blur"?`${Yt.get(t.type)} ${t.value.toFixed()}px`:Yt.get(t.type)},objectTypeScope(t){switch(this.type){case"object":return"objects/"+t;case"background":return"panels/background"+t[0].toUpperCase()+t.slice(1);case"panel":return"panels/"+t}},addFilter(){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("addFilter"),{id:this.id,type:this.addEffectSelection,idx:this.currentFilterIdx+1})})},selectFilter(t){this.currentFilterIdx=t},removeFilter(){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("removeFilter"),{id:this.id,idx:this.currentFilterIdx})})},moveFilter(t){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("moveFilter"),{id:this.id,idx:this.currentFilterIdx,moveBy:t}),this.currentFilterIdx+=t})},setValue(t){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("setFilter"),m({id:this.id,idx:this.currentFilterIdx},t))})},eightsStops(t){const e=[];for(let o=0;o<=8;++o)e.push(t(o/8));return e}}}),M=t=>(G("data-v-07e98488"),t=t(),Y(),t),bc=M(()=>a("h2",null,"Image options",-1)),mc={class:"column ok-col"},yc={key:0,class:"column"},vc=M(()=>a("label",{for:"compositionSelect"},"Compositing Mode:",-1)),wc=C("[?] "),Cc=M(()=>a("option",{value:"source-over"},"source-over",-1)),$c=M(()=>a("option",{value:"source-atop"},"source-atop",-1)),kc=M(()=>a("option",{value:"destination-over"},"destination-over",-1)),xc=M(()=>a("option",{value:"destination-in"},"destination-in",-1)),Sc=M(()=>a("option",{value:"destination-in"},"destination-out",-1)),jc=M(()=>a("option",{value:"destination-in"},"destination-atop",-1)),Pc=M(()=>a("option",{value:"lighter"},"lighter",-1)),Tc=M(()=>a("option",{value:"xor"},"xor",-1)),_c=M(()=>a("option",{value:"multiply"},"multiply",-1)),Bc=M(()=>a("option",{value:"screen"},"screen",-1)),Oc=M(()=>a("option",{value:"overlay"},"overlay",-1)),Ic=M(()=>a("option",{value:"darken"},"darken",-1)),Dc=M(()=>a("option",{value:"lighten"},"lighten",-1)),Hc=M(()=>a("option",{value:"color-dodge"},"color-dodge",-1)),Ac=M(()=>a("option",{value:"color-burn"},"color-burn",-1)),Rc=M(()=>a("option",{value:"hard-light"},"hard-light",-1)),Mc=M(()=>a("option",{value:"soft-light"},"soft-light",-1)),Wc=M(()=>a("option",{value:"difference"},"difference",-1)),Nc=M(()=>a("option",{value:"exclusion"},"exclusion",-1)),Vc=M(()=>a("option",{value:"hue"},"hue",-1)),Fc=M(()=>a("option",{value:"saturation"},"saturation",-1)),Lc=M(()=>a("option",{value:"color"},"color",-1)),Ec=M(()=>a("option",{value:"luminosity"},"luminosity",-1)),zc=[Cc,$c,kc,xc,Sc,jc,Pc,Tc,_c,Bc,Oc,Ic,Dc,Hc,Ac,Rc,Mc,Wc,Nc,Vc,Fc,Lc,Ec],Uc=M(()=>a("label",{for:"addEffect"},"Add new effect",-1)),Xc=["value"],Gc=["disabled"],Yc=["disabled"],qc=["disabled"],Kc=["disabled"],Jc=["onClick"],Zc={key:0,class:"value-input-table"},Qc=M(()=>a("td",null,[a("label",{for:"shadow_color"},"Color:")],-1)),tu=M(()=>a("td",null,[a("label",{for:"filter_x"},"X:")],-1)),eu=M(()=>a("td",null,[a("label",{for:"filter_y"},"Y:")],-1)),ou=M(()=>a("td",null,[a("label",{for:"filter_blur"},"Blur:")],-1)),su=M(()=>a("td",null,[a("label",{for:"filter_value"},"Value:")],-1)),nu=["value","max","min"],iu=C("% "),ru={key:0},au={colspan:"2"},lu=M(()=>a("td",null,[a("label",{for:"filter_value"},"Value:")],-1)),du=["value","max","min"],cu={key:0},uu={colspan:"2"};function hu(t,e,o,s,n,i){const r=v("color"),l=v("l"),d=v("d-flow"),c=v("slider"),u=v("d-fieldset");return t.showShadowColor?(h(),k(r,{key:0,modelValue:t.shadowColor,"onUpdate:modelValue":e[0]||(e[0]=p=>t.shadowColor=p),format:"rgb",onLeave:e[1]||(e[1]=p=>t.showShadowColor=!1)},null,8,["modelValue"])):(h(),k(d,{key:1,"no-wraping":"",class:"image-options-subpanel"},{default:w(()=>[bc,a("div",mc,[a("button",{onClick:e[2]||(e[2]=p=>t.$emit("leave"))},"Back")]),t.noComposition?j("",!0):(h(),g("div",yc,[vc,y(l,{to:"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation#Types"},{default:w(()=>[wc]),_:1}),A(a("select",{id:"compositionSelect","onUpdate:modelValue":e[3]||(e[3]=p=>t.compositionMode=p),onKeydown:e[4]||(e[4]=O(()=>{},["stop"]))},zc,544),[[ot,t.compositionMode]])])),y(u,{class:"column",title:"Effects",style:{overflow:"hidden"}},{default:w(()=>[y(d,{class:"filter-flow","no-wraping":"",gap:"8px"},{default:w(()=>[y(d,{direction:"vertical","no-wraping":""},{default:w(()=>[Uc,A(a("select",{id:"addEffect","onUpdate:modelValue":e[5]||(e[5]=p=>t.addEffectSelection=p),onKeydown:e[6]||(e[6]=O(()=>{},["stop"]))},[(h(!0),g(_,null,E(t.filterTypes,p=>(h(),g("option",{key:p,value:p},F(t.getFilterLabel(p)),9,Xc))),128))],544),[[ot,t.addEffectSelection]]),a("button",{disabled:t.addEffectSelection==="",onClick:e[7]||(e[7]=(...p)=>t.addFilter&&t.addFilter(...p)),onKeydown:e[8]||(e[8]=O(()=>{},["stop"]))}," Add ",40,Gc),a("button",{disabled:!t.currentFilter,onClick:e[9]||(e[9]=(...p)=>t.removeFilter&&t.removeFilter(...p)),onKeydown:e[10]||(e[10]=O(()=>{},["stop"]))}," Remove ",40,Yc),a("button",{disabled:t.currentFilterIdx===0,onClick:e[11]||(e[11]=p=>t.moveFilter(-1)),onKeydown:e[12]||(e[12]=O(()=>{},["stop"]))}," Move up ",40,qc),a("button",{disabled:t.currentFilterIdx===t.filters.length-1||t.filters.length===0,onClick:e[13]||(e[13]=p=>t.moveFilter(1)),onKeydown:e[14]||(e[14]=O(()=>{},["stop"]))}," Move down ",40,Kc)]),_:1}),y(d,{maxSize:"100%",direction:"vertical","no-wraping":""},{default:w(()=>[(h(!0),g(_,null,E(t.filters,(p,b)=>(h(),g("div",{key:b,class:W({choiceBtn:!0,active:b===t.currentFilterIdx}),onClick:T=>t.selectFilter(b)},F(t.getFilterText(p)),11,Jc))),128))]),_:1}),t.currentFilter?(h(),g("table",Zc,[t.currentFilter.type==="drop-shadow"?(h(),g(_,{key:0},[a("tr",null,[Qc,a("td",null,[a("button",{id:"shadow_color",class:"color-button",style:K({background:t.shadowColor}),onClick:e[15]||(e[15]=p=>t.showShadowColor=!0)}," \xA0 ",4)])]),a("tr",null,[tu,a("td",null,[A(a("input",{id:"filter_x",type:"number","onUpdate:modelValue":e[16]||(e[16]=p=>t.shadowX=p),onKeydown:e[17]||(e[17]=O(()=>{},["stop"]))},null,544),[[z,t.shadowX,void 0,{number:!0}]])])]),a("tr",null,[eu,a("td",null,[A(a("input",{id:"filter_y",type:"number","onUpdate:modelValue":e[18]||(e[18]=p=>t.shadowY=p),onKeydown:e[19]||(e[19]=O(()=>{},["stop"]))},null,544),[[z,t.shadowY,void 0,{number:!0}]])])]),a("tr",null,[ou,a("td",null,[A(a("input",{id:"filter_blur",type:"number","onUpdate:modelValue":e[20]||(e[20]=p=>t.shadowBlur=p),onKeydown:e[21]||(e[21]=O(()=>{},["stop"]))},null,544),[[z,t.shadowBlur,void 0,{number:!0}]])])])],64)):t.isPercentFilter?(h(),g(_,{key:1},[a("tr",null,[su,a("td",null,[a("input",{id:"filter_value",value:(t.currentFilter.value*100).toFixed(),type:"number",max:t.maxValue,min:t.minValue,onInput:e[22]||(e[22]=p=>t.setValue({value:Number(p.target.value/100)})),onKeydown:e[23]||(e[23]=O(()=>{},["stop"]))},null,40,nu),iu])]),t.minValue===0&&t.maxValue!==void 0?(h(),g("tr",ru,[a("td",au,[y(c,{gradientStops:["#000000","#ffffff"],label:"",maxValue:t.maxValue,modelValue:t.currentFilter.value*100,"no-input":"","onUpdate:modelValue":e[24]||(e[24]=p=>t.setValue({value:Math.round(p)/100}))},null,8,["maxValue","modelValue"])])])):j("",!0)],64)):(h(),g(_,{key:2},[a("tr",null,[lu,a("td",null,[a("input",{id:"filter_value",value:t.currentFilter.value,type:"number",max:t.maxValue,min:t.minValue,onInput:e[25]||(e[25]=p=>t.setValue({value:Number(p.target.value)})),onKeydown:e[26]||(e[26]=O(()=>{},["stop"]))},null,40,du)])]),t.minValue===0&&t.maxValue!==void 0?(h(),g("tr",cu,[a("td",uu,[y(c,{gradientStops:t.hueStops,label:"",maxValue:t.maxValue,modelValue:t.currentFilter.value,"no-input":"","onUpdate:modelValue":e[27]||(e[27]=p=>t.setValue({value:Math.round(p)}))},null,8,["gradientStops","maxValue","modelValue"]),y(c,{gradientStops:t.hueStops,label:"",maxValue:t.maxValue,modelValue:t.currentFilter.value,"shift-gradient":"","no-input":"",disabled:""},null,8,["gradientStops","maxValue","modelValue"])])])):j("",!0)],64))])):j("",!0)]),_:1})]),_:1})]),_:1}))}var To=D(gc,[["render",hu],["__scopeId","data-v-07e98488"]]);const pu=I({inheritAttrs:!1,components:{Color:Pe},props:{modelValue:{type:String,required:!0},title:{type:String,default:""}},data:()=>({colorSelector:"",selectedFont:"",selectedColor:"#000000",rememberedStart:0,rememberedEnd:0,error:""}),computed:{vertical(){return this.$store.state.ui.vertical}},watch:{selectedFont(){this.selectedFont!==""&&(this.insertCommand("font",this.selectedFont),this.selectedFont="")}},methods:{onValueChanged(){const t=P(),e=this.$refs.textArea.value;try{new ft(e,t.TextBox.NameboxTextStyle),this.error=""}catch(o){this.error=o.message}this.$emit("update:modelValue",e)},selectColor(t){const e=this.$refs.textArea;this.colorSelector=t,this.rememberedStart=e.selectionStart,this.rememberedEnd=e.selectionEnd},applyColor(){const t=this.selectedColor,e=this.colorSelector,o=()=>{const s=this.$refs.textArea;if(!s){this.$nextTick(o);return}s.selectionStart=this.rememberedStart,s.selectionEnd=this.rememberedEnd,this.insertCommand(e==="text"?"color":"outlinecolor",t)};this.$nextTick(o),this.selectedColor="#000000",this.colorSelector=""},insertText(t){const e=this.$refs.textArea,o=e.value,s=e.selectionStart,n=e.selectionEnd;e.value=o.slice(0,s)+t+o.slice(n),e.selectionStart=e.selectionEnd=s+t.length,e.focus(),this.onValueChanged()},insertCommand(t,e){const o=this.$refs.textArea,s=o.value,n=o.selectionStart,i=o.selectionEnd,r=s.slice(n,i),l=s.slice(0,n),d=s.slice(i);let c=t;e&&(c+="="+e),o.value=`${l}{${c}}${r}{/${t}}${d}`,o.selectionStart=n+c.length+2,o.selectionEnd=o.selectionStart+r.length,o.focus(),this.onValueChanged()}}}),fu=t=>(G("data-v-564b8382"),t=t(),Y(),t),gu={class:"column ok-col"},bu={class:"column"},mu=["value"],yu={key:0,class:"column error-col"},vu={class:"column"},wu=fu(()=>a("p",{class:"hint-col"},"Apply style to selected text:",-1)),Cu={class:"column"},$u={class:"column"},ku={class:"column"},xu=Yo('<option value data-v-564b8382>Font</option><option value="aller" style="font-family:aller;" data-v-564b8382>Aller (Textbox) </option><option value="riffic" style="font-family:riffic;" data-v-564b8382>Riffic (Bold text) </option><option value="hashtag" style="font-family:hashtag;" data-v-564b8382>Hashtag (Sayori) </option><option value="ammy_handwriting" style="font-family:ammy_handwriting;" data-v-564b8382>Ammy&#39;s Handwriting (Natsuki) </option><option value="journal" style="font-family:journal;" data-v-564b8382>Journal (Monika) </option><option value="jp_hand_slanted" style="font-family:jp_hand_slanted;" data-v-564b8382>JP Hand Slanted (Yuri) </option><option value="damagrafik_script" style="font-family:damagrafik_script;" data-v-564b8382>Damagrafik (Yuri, Act 2) </option><option value="as_i_lay_dying" style="font-family:as_i_lay_dying;" data-v-564b8382>As I Lay Dying (Yuri, Act Unused) </option><option value="halogen" style="font-family:halogen;" data-v-564b8382>Halogen (MC) </option>',10),Su=[xu];function ju(t,e,o,s,n,i){const r=v("color");return t.colorSelector?(h(),k(r,{key:0,modelValue:t.selectedColor,"onUpdate:modelValue":e[0]||(e[0]=l=>t.selectedColor=l),onLeave:t.applyColor},null,8,["modelValue","onLeave"])):(h(),g("div",{key:1,class:W({"text-subpanel":!0,vertical:t.vertical})},[a("h2",null,F(t.title),1),a("div",gu,[a("button",{onClick:e[1]||(e[1]=l=>t.$emit("leave"))},"OK")]),a("div",bu,[a("textarea",{ref:"textArea",value:t.modelValue,onInput:e[2]||(e[2]=(...l)=>t.onValueChanged&&t.onValueChanged(...l)),onKeydown:e[3]||(e[3]=O(()=>{},["stop"])),onKeypress:e[4]||(e[4]=O(()=>{},["stop"]))},null,40,mu)]),t.error?(h(),g("div",yu,F(t.error),1)):j("",!0),a("div",vu,[a("button",{onClick:e[5]||(e[5]=l=>t.insertText("\\\\")),class:"style-button"},"Insert \\"),a("button",{onClick:e[6]||(e[6]=l=>t.insertText("\\{")),class:"style-button"},"Insert {"),a("button",{onClick:e[7]||(e[7]=l=>t.insertText("\\}")),class:"style-button"},"Insert }")]),wu,a("div",Cu,[a("button",{onClick:e[8]||(e[8]=l=>t.insertCommand("b")),class:"style-button",style:{"font-weight":"bold"}}," Bold "),a("button",{onClick:e[9]||(e[9]=l=>t.insertCommand("i")),class:"style-button",style:{"font-style":"italic"}}," Italics "),a("button",{onClick:e[10]||(e[10]=l=>t.insertCommand("plain")),class:"style-button"}," Plain "),a("button",{onClick:e[11]||(e[11]=l=>t.insertCommand("edited")),class:"style-button edited-style"}," Edited "),a("button",{onClick:e[12]||(e[12]=l=>t.insertCommand("k",2)),class:"style-button",style:{"letter-spacing":"5px"}}," Kerning ")]),a("div",$u,[a("button",{onClick:e[13]||(e[13]=l=>t.insertCommand("alpha",.5)),class:"style-button"}," Alpha ")]),a("div",ku,[a("button",{onClick:e[14]||(e[14]=l=>t.insertCommand("size",12)),class:"style-button",style:{"font-size":"20px"}}," Font size "),A(a("select",{"onUpdate:modelValue":e[15]||(e[15]=l=>t.selectedFont=l),class:"style-button"},Su,512),[[ot,t.selectedFont]]),a("button",{onClick:e[16]||(e[16]=l=>t.selectColor("text")),class:"style-button"}," Text color "),a("button",{onClick:e[17]||(e[17]=l=>t.selectColor("outline")),class:"style-button"}," Outline color ")])],2))}var Pu=D(pu,[["render",ju],["__scopeId","data-v-564b8382"]]);const _o=St(),Tu=I({mixins:[Q],components:{Toggle:nt,PositionAndSize:Dd,Layers:zd,Delete:Gd,TextEditor:Pu,ImageOptions:To,Color:Pe,ModalDialog:Ee,DFieldset:rt},props:{object:{type:Object,required:!0},title:String,textHandler:{type:Object},colorHandler:{type:Object},showAltPanel:Boolean},data:()=>({imageOptionsOpen:!1,canEdit:!0,modalNameInput:"",showRename:!1,localColorHandler:null}),computed:{flip:_o("flip","objects/setFlip"),rotation:_o("rotation","objects/setRotation"),enlargeWhenTalking:_o("enlargeWhenTalking","objects/setEnlargeWhenTalking"),nameboxWidth:{get(){const t=this.object.nameboxWidth;return t===null?"":t+""},set(t){const e=t.trim()===""?null:parseInt(t);this.vuexHistory.transaction(async()=>{this.$store.commit("objects/setObjectNameboxWidth",{id:this.object.id,nameboxWidth:e})})}},zoom:{get(){return this.object.zoom*100},set(t){this.vuexHistory.transaction(async()=>{this.$store.commit("objects/setObjectZoom",{id:this.object.id,zoom:t/100})})}},defaultNameboxWidth(){return P().TextBox.NameboxWidth},finalColorHandler(){return this.localColorHandler||this.colorHandler||null},hasLabel(){return this.object.label!==null},heading(){return console.log("heading",this.object.label,this.title,"Object"),this.object.label||this.title||"Object"},useCustomTextboxColor:{get(){return this.object.textboxColor!==null},set(t){this.vuexHistory.transaction(async()=>{this.$store.commit("objects/setTextboxColor",{id:this.object.id,textboxColor:t?P().TextBoxCustom.textboxDefaultColor:null})})}}},methods:{copy(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("objects/copyObjectToClipboard",{id:this.object.id})})},enableNameEdit(){this.modalNameInput=this.object.label||"",this.showRename=!0},renameOption(t){this.showRename=!1,t==="Apply"&&this.vuexHistory.transaction(async()=>{this.$store.commit("objects/setLabel",{id:this.object.id,label:this.modalNameInput})})},selectTextboxColor(){this.localColorHandler={title:"Textbox color",get:()=>this.object.textboxColor,set:t=>{this.vuexHistory.transaction(async()=>{this.$store.commit("objects/setTextboxColor",{id:this.object.id,textboxColor:t})})},leave:()=>{this.localColorHandler=null}}}}}),qt=t=>(G("data-v-2560a66c"),t=t(),Y(),t),_u={class:"panel"},Bu=qt(()=>a("span",{class:"icon material-icons"},"edit",-1)),Ou=qt(()=>a("p",{class:"modal-text"}," Enter the new name ",-1)),Iu={class:"modal-text"},Du={class:"input-table"},Hu=qt(()=>a("td",null,[a("label",{for:"rotation"},"Rotation: \xB0")],-1)),Au={key:0},Ru=qt(()=>a("td",null,[a("label",{for:"zoom"},"Zoom: ")],-1)),Mu={key:0},Wu=qt(()=>a("td",null,[a("label",{for:"textbox_color"},"Color:")],-1)),Nu=qt(()=>a("td",null,[a("label",{for:"namebox_width"},"Namebox width:")],-1)),Vu=["placeholder"];function Fu(t,e,o,s,n,i){const r=v("modal-dialog"),l=v("text-editor"),d=v("color"),c=v("image-options"),u=v("position-and-size"),p=v("layers"),b=v("toggle"),T=v("d-fieldset"),x=v("delete");return h(),g("div",_u,[a("h1",{style:K({fontStyle:t.hasLabel?"italic":"normal"}),onClick:e[0]||(e[0]=(...$)=>t.enableNameEdit&&t.enableNameEdit(...$))},[C(F(t.heading)+" ",1),Bu],4),(h(),k(Xo,{to:"#modal-messages"},[t.showRename?(h(),k(r,{key:0,options:["Apply","Cancel"],"no-base-size":"",class:"modal-rename",onOption:t.renameOption,onLeave:e[2]||(e[2]=$=>t.renameOption("Cancel"))},{default:w(()=>[Ou,a("p",Iu,[A(a("input",{"onUpdate:modelValue":e[1]||(e[1]=$=>t.modalNameInput=$),style:{width:"100%"}},null,512),[[z,t.modalNameInput]])])]),_:1},8,["onOption"])):j("",!0)])),t.textHandler?(h(),k(l,{key:0,title:t.textHandler.title,modelValue:t.textHandler.get(),"onUpdate:modelValue":e[3]||(e[3]=$=>t.textHandler.set($)),onLeave:e[4]||(e[4]=$=>t.textHandler.leave())},null,8,["title","modelValue"])):t.finalColorHandler?(h(),k(d,{key:1,title:t.finalColorHandler.title,modelValue:t.finalColorHandler.get(),"onUpdate:modelValue":e[5]||(e[5]=$=>t.finalColorHandler.set($)),onLeave:e[6]||(e[6]=$=>t.finalColorHandler.leave())},null,8,["title","modelValue"])):t.imageOptionsOpen?(h(),k(c,{key:2,type:"object",id:t.object.id,onLeave:e[7]||(e[7]=$=>t.imageOptionsOpen=!1)},null,8,["id"])):t.showAltPanel?bt(t.$slots,"alt-panel",{key:3},void 0,!0):(h(),g(_,{key:4},[bt(t.$slots,"default",{},void 0,!0),y(u,{obj:t.object},null,8,["obj"]),y(p,{object:t.object},null,8,["object"]),y(b,{modelValue:t.flip,"onUpdate:modelValue":e[8]||(e[8]=$=>t.flip=$),label:"Flip?"},null,8,["modelValue"]),a("table",Du,[a("tr",null,[Hu,a("td",null,[A(a("input",{id:"rotation",class:"smol",type:"number","onUpdate:modelValue":e[9]||(e[9]=$=>t.rotation=$),onKeydown:e[10]||(e[10]=O(()=>{},["stop"]))},null,544),[[z,t.rotation]])])]),t.object.type==="character"||t.object.type==="sprite"?(h(),g("tr",Au,[Ru,a("td",null,[A(a("input",{id:"zoom",type:"number",class:"smol",step:"1",min:"0","onUpdate:modelValue":e[11]||(e[11]=$=>t.zoom=$),onKeydown:e[12]||(e[12]=O(()=>{},["stop"]))},null,544),[[z,t.zoom]])])])):j("",!0)]),bt(t.$slots,"options",{},void 0,!0),t.hasLabel?(h(),k(T,{key:0,title:"Textbox settings"},{default:w(()=>[t.object.type==="character"||t.object.type==="sprite"?(h(),k(b,{key:0,label:"Enlarge when talking",modelValue:t.enlargeWhenTalking,"onUpdate:modelValue":e[13]||(e[13]=$=>t.enlargeWhenTalking=$)},null,8,["modelValue"])):j("",!0),y(b,{label:"Use custom textbox color",modelValue:t.useCustomTextboxColor,"onUpdate:modelValue":e[14]||(e[14]=$=>t.useCustomTextboxColor=$)},null,8,["modelValue"]),a("table",null,[t.useCustomTextboxColor?(h(),g("tr",Mu,[Wu,a("td",null,[a("button",{id:"textbox_color",class:"color-button",style:K({background:t.object.textboxColor}),onClick:e[15]||(e[15]=(...$)=>t.selectTextboxColor&&t.selectTextboxColor(...$))},null,4)])])):j("",!0),a("tr",null,[Nu,a("td",null,[A(a("input",{id:"namebox_width",type:"number",placeholder:t.defaultNameboxWidth,"onUpdate:modelValue":e[16]||(e[16]=$=>t.nameboxWidth=$)},null,8,Vu),[[z,t.nameboxWidth,void 0,{lazy:!0}]])])])])]),_:1})):j("",!0),a("button",{onClick:e[17]||(e[17]=$=>t.imageOptionsOpen=!0)},"Image options"),a("button",{onClick:e[18]||(e[18]=(...$)=>t.copy&&t.copy(...$))},"Copy"),y(x,{obj:t.object},null,8,["obj"])],64))])}var Kt=D(Tu,[["render",Fu],["__scopeId","data-v-2560a66c"]]);const rn=St(),Lu=I({mixins:[Q],components:{Toggle:nt,Parts:cd,DFieldset:rt,ObjectTool:Kt},data:()=>({panelForParts:null}),computed:{flip:rn("flip","objects/setFlip"),closeUp:rn("close","objects/setClose"),selection(){return this.$store.state.ui.selection},object(){const t=this.$store.state.objects.objects[this.selection];if(t.type==="character")return t},charData(){return be(this.$store,this.object)},label(){return this.charData.label||""},parts(){return Ml(this.charData,this.object)},hasMultipleStyles(){return this.charData.styleGroups[this.object.styleGroupId].styles.length>1||this.charData.styleGroups.length>1},hasMultiplePoses(){return this.charData.styleGroups[this.object.styleGroupId].styles[this.object.styleId].poses.length>1}},methods:{seekPose(t){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/seekPose",{id:this.object.id,delta:t})})},seekStyle(t){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/seekStyle",{id:this.object.id,delta:t})})},seekPart(t,e){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/seekPart",{id:this.object.id,delta:e,part:t})})},captialize(t){return t.charAt(0).toUpperCase()+t.substring(1)}},watch:{selection(){this.panelForParts=null}}}),Eu={key:0},zu={class:"arrow-col"},Uu={class:"arrow-col"},Xu={key:1},Gu={class:"arrow-col"},Yu={class:"arrow-col"},qu={class:"arrow-col"},Ku=["onClick"],Ju=["onClick"],Zu={class:"arrow-col"},Qu=["onClick"];function th(t,e,o,s,n,i){const r=v("parts"),l=v("d-fieldset"),d=v("toggle"),c=v("object-tool");return h(),k(c,{object:t.object,title:t.label,showAltPanel:t.panelForParts},{"alt-panel":w(()=>[t.panelForParts?(h(),k(r,{key:0,character:t.object,part:t.panelForParts,onLeave:e[0]||(e[0]=u=>t.panelForParts=null),onShowDialog:e[1]||(e[1]=u=>t.$emit("show-dialog",u)),onShowExpressionDialog:e[2]||(e[2]=u=>t.$emit("show-expression-dialog",u))},null,8,["character","part"])):j("",!0)]),default:w(()=>[t.hasMultiplePoses||t.parts.length>0?(h(),k(l,{key:0,class:"pose-list",title:"Pose:"},{default:w(()=>[a("table",null,[a("tbody",null,[t.hasMultipleStyles?(h(),g("tr",Eu,[a("td",zu,[a("button",{onClick:e[3]||(e[3]=u=>t.seekStyle(-1))},"<")]),a("td",null,[a("button",{class:"middle-button",onClick:e[4]||(e[4]=u=>t.panelForParts="style")}," Style ")]),a("td",Uu,[a("button",{onClick:e[5]||(e[5]=u=>t.seekStyle(1))},">")])])):j("",!0),t.hasMultiplePoses?(h(),g("tr",Xu,[a("td",Gu,[a("button",{onClick:e[6]||(e[6]=u=>t.seekPose(-1))},"<")]),a("td",null,[a("button",{class:"middle-button",onClick:e[7]||(e[7]=u=>t.panelForParts="pose")}," Pose ")]),a("td",Yu,[a("button",{onClick:e[8]||(e[8]=u=>t.seekPose(1))},">")])])):j("",!0),(h(!0),g(_,null,E(t.parts,u=>(h(),g("tr",{key:u},[a("td",qu,[a("button",{onClick:p=>t.seekPart(u,-1)},"<",8,Ku)]),a("td",null,[a("button",{class:"middle-button",onClick:p=>t.panelForParts=u},F(t.captialize(u)),9,Ju)]),a("td",Zu,[a("button",{onClick:p=>t.seekPart(u,1)},">",8,Qu)])]))),128))])])]),_:1})):j("",!0)]),options:w(()=>[y(d,{modelValue:t.closeUp,"onUpdate:modelValue":e[9]||(e[9]=u=>t.closeUp=u),label:"Close up?"},null,8,["modelValue"])]),_:1},8,["object","title","showAltPanel"])}var eh=D(Lu,[["render",th],["__scopeId","data-v-15d6dddf"]]);const oh=I({mixins:[Q],components:{ObjectTool:Kt},computed:{object(){const t=this.$store.state.objects.objects[this.$store.state.ui.selection];if(t.type==="sprite")return t}}});function sh(t,e,o,s,n,i){const r=v("object-tool");return h(),k(r,{object:t.object,title:"Custom Sprite"},null,8,["object"])}var nh=D(oh,[["render",sh]]);const st=St(),ih=I({components:{Toggle:nt,DFieldset:rt,ObjectTool:Kt,DFlow:oe},mixins:[Q],data:()=>({textEditor:"",colorSelect:""}),computed:{customizable(){return this.textBoxStyle.startsWith("custom")},nameboxWidthDefault(){return P().TextBox.NameboxWidth},object(){const t=this.$store.state.objects.objects[this.$store.state.ui.selection];if(t.type==="textBox")return t},textHandler(){if(!!this.textEditor)return{title:this.textEditorName,get:()=>this.textEditor==="name"?this.object.talkingOther:this.textEditor==="body"?this.dialog:"",set:t=>{this.textEditor==="name"?this.talkingOther=t:this.textEditor==="body"&&(this.dialog=t)},leave:()=>{this.textEditor=""}}},colorHandler(){if(!!this.colorSelect)return{title:this.colorName,get:()=>{switch(this.colorSelect){case"":return"#000000";case"base":return this.object.customColor;case"controls":return this.object.customControlsColor;case"namebox":return this.object.customNameboxColor;case"nameboxStroke":return this.object.customNameboxStroke;default:return Nt(this.colorSelect),""}},set:t=>{this.vuexHistory.transaction(()=>{switch(this.colorSelect){case"":return;case"base":this.$store.commit("objects/setCustomColor",{id:this.object.id,color:t});return;case"controls":this.$store.commit("objects/setControlsColor",{id:this.object.id,customControlsColor:t});return;case"namebox":this.$store.commit("objects/setNameboxColor",{id:this.object.id,customNameboxColor:t});return;case"nameboxStroke":this.$store.commit("objects/setNameboxStroke",{id:this.object.id,customNameboxStroke:t});return}})},leave:()=>{this.colorSelect=""}}},talkingObjId:{get(){return this.object.talkingObjId||"$null$"},set(t){this.vuexHistory.transaction(()=>{this.$store.commit("objects/setTalkingObject",{id:this.object.id,talkingObjId:t==="$null$"?null:t})})}},talkingOther:st("talkingOther","objects/setTalkingOther"),showControls:st("controls","objects/setControlsVisible"),allowSkipping:st("skip","objects/setSkipable"),autoQuoting:st("autoQuoting","objects/setAutoQuoting"),autoWrap:st("autoWrap","objects/setAutoWrapping"),showContinueArrow:st("continue","objects/setContinueArrow"),dialog:st("text","objects/setText"),textBoxStyle:st("style","objects/setStyle",!0),overrideColor:st("overrideColor","objects/setColorOverride"),deriveCustomColors:st("deriveCustomColors","objects/setDeriveCustomColors"),customNameboxWidth:st("customNameboxWidth","objects/setNameboxWidth"),nameList(){const t=this.$store.state.objects.panels[this.$store.state.panels.currentPanel],e=[];for(const o of[...t.order,...t.onTopOrder]){const s=this.$store.state.objects.objects[o];s.label!==null&&e.push([o,s.label])}return e},textEditorName(){return this.textEditor==="name"?"Name":this.textEditor==="body"?"Dialog":""},customControlsColor(){return this.object.customControlsColor},colorName(){switch(this.colorSelect){case"":return"";case"base":return"Base color";case"controls":return"Controls color";case"namebox":return"Namebox color";case"nameboxStroke":return"Namebox text stroke";default:return Nt(this.colorSelect),""}}},methods:{splitTextbox(){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/splitTextbox",{id:this.object.id})})},resetPosition(){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/resetTextboxBounds",{id:this.object.id})})},jumpToCharacter(){this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",this.talkingObjId)})}}}),q=t=>(G("data-v-e8b25ccc"),t=t(),Y(),t),rh={class:"upper-combos"},ah=q(()=>a("td",null,[a("label",{for:"text_style"},"Style:")],-1)),lh={colspan:"2"},dh=q(()=>a("option",{value:"normal"},"Normal",-1)),ch=q(()=>a("option",{value:"corrupt"},"Corrupt",-1)),uh=q(()=>a("option",{value:"custom"},"Custom",-1)),hh=q(()=>a("option",{value:"custom_plus"},"Custom (Plus)",-1)),ph=q(()=>a("option",{value:"none"},"None",-1)),fh=[dh,ch,uh,hh,ph],gh=q(()=>a("td",null,[a("label",{for:"current_talking"},"Person talking:")],-1)),bh=q(()=>a("option",{value:"$null$"},"No-one",-1)),mh=["value"],yh=q(()=>a("option",{value:"$other$"},"Other",-1)),vh=["disabled"],wh=q(()=>a("td",null,[a("label",{for:"custom_name"},"Other name:")],-1)),Ch={id:"dialog_text_wrapper"},$h=q(()=>a("label",{for:"dialog_text"},"Dialog:",-1)),kh={key:0},xh=q(()=>a("td",null,[a("label",{for:"custom_namebox_width"},"Namebox width:")],-1)),Sh=["placeholder","disabled"],jh={colspan:"2"},Ph={key:0},Th=q(()=>a("td",null,[a("label",{for:"textbox_color"},"Color:")],-1)),_h={key:1},Bh={colspan:"2"},Oh=q(()=>a("td",null,[a("label",{for:"custom_controls_color"},"Controls Color:")],-1)),Ih=q(()=>a("td",null,[a("label",{for:"custom_namebox_color"},"Namebox Color:")],-1)),Dh=q(()=>a("td",null,[a("label",{for:"custom_namebox_stroke"},"Namebox text stroke:")],-1));function Hh(t,e,o,s,n,i){const r=v("toggle"),l=v("d-flow"),d=v("d-fieldset"),c=v("object-tool");return h(),k(c,{object:t.object,title:"Textbox",textHandler:t.textHandler,colorHandler:t.colorHandler},{default:w(()=>[a("table",rh,[a("tr",null,[ah,a("td",lh,[A(a("select",{id:"text_style","onUpdate:modelValue":e[0]||(e[0]=u=>t.textBoxStyle=u),onKeydown:e[1]||(e[1]=O(()=>{},["stop"]))},fh,544),[[ot,t.textBoxStyle]])])]),a("tr",null,[gh,a("td",null,[A(a("select",{id:"current_talking","onUpdate:modelValue":e[2]||(e[2]=u=>t.talkingObjId=u),onKeydown:e[3]||(e[3]=O(()=>{},["stop"]))},[bh,(h(!0),g(_,null,E(t.nameList,([u,p])=>(h(),g("option",{key:u,value:u},F(p),9,mh))),128)),yh],544),[[ot,t.talkingObjId]])]),a("td",null,[a("button",{title:"Jump to talking character",onClick:e[4]||(e[4]=(...u)=>t.jumpToCharacter&&t.jumpToCharacter(...u)),disabled:t.talkingObjId==="$null$"||t.talkingObjId==="$other$"}," > ",8,vh)])]),a("tr",null,[wh,a("td",null,[A(a("input",{id:"custom_name","onUpdate:modelValue":e[5]||(e[5]=u=>t.talkingOther=u),onKeydown:e[6]||(e[6]=O(()=>{},["stop"]))},null,544),[[z,t.talkingOther]])]),a("td",null,[a("button",{onClick:e[7]||(e[7]=u=>t.textEditor="name")},"...")])])]),y(r,{label:"Auto quoting?",modelValue:t.autoQuoting,"onUpdate:modelValue":e[8]||(e[8]=u=>t.autoQuoting=u)},null,8,["modelValue"]),y(r,{label:"Auto line wrap?",modelValue:t.autoWrap,"onUpdate:modelValue":e[9]||(e[9]=u=>t.autoWrap=u)},null,8,["modelValue"]),a("div",Ch,[$h,A(a("textarea",{"onUpdate:modelValue":e[10]||(e[10]=u=>t.dialog=u),id:"dialog_text",onKeydown:e[11]||(e[11]=O(()=>{},["stop"]))},null,544),[[z,t.dialog]]),a("button",{onClick:e[12]||(e[12]=u=>t.textEditor="body")},"Formatting")])]),options:w(()=>[y(d,{title:"Customization:",class:W(t.customizable?"customization-set":"")},{default:w(()=>[y(l,{direction:"vertical",maxSize:"100%","no-wraping":""},{default:w(()=>[y(r,{label:"Controls visible?",modelValue:t.showControls,"onUpdate:modelValue":e[13]||(e[13]=u=>t.showControls=u)},null,8,["modelValue"]),y(r,{label:"Able to skip?",modelValue:t.allowSkipping,"onUpdate:modelValue":e[14]||(e[14]=u=>t.allowSkipping=u)},null,8,["modelValue"]),y(r,{label:"Continue arrow?",modelValue:t.showContinueArrow,"onUpdate:modelValue":e[15]||(e[15]=u=>t.showContinueArrow=u)},null,8,["modelValue"]),t.customizable?(h(),g("table",kh,[a("tr",null,[xh,a("td",null,[A(a("input",{id:"custom_namebox_width",type:"number",style:{width:"48px"},placeholder:t.nameboxWidthDefault,"onUpdate:modelValue":e[16]||(e[16]=u=>t.customNameboxWidth=u),disabled:t.overrideColor,onKeydown:e[17]||(e[17]=O(()=>{},["stop"]))},null,40,Sh),[[z,t.customNameboxWidth,void 0,{number:!0}]])])]),a("tr",null,[a("td",jh,[y(r,{modelValue:t.overrideColor,"onUpdate:modelValue":e[18]||(e[18]=u=>t.overrideColor=u),label:"Override color"},null,8,["modelValue"])])]),t.overrideColor?(h(),g("tr",Ph,[Th,a("td",null,[a("button",{id:"textbox_color",class:"color-button",style:K({background:t.object.customColor}),onClick:e[19]||(e[19]=u=>t.colorSelect="base")},null,4)])])):j("",!0),t.overrideColor?(h(),g("tr",_h,[a("td",Bh,[y(r,{id:"derive_custom_colors",modelValue:t.deriveCustomColors,"onUpdate:modelValue":e[20]||(e[20]=u=>t.deriveCustomColors=u),label:"Derive other colors"},null,8,["modelValue"])])])):j("",!0),t.overrideColor&&!t.deriveCustomColors?(h(),g(_,{key:2},[a("tr",null,[Oh,a("td",null,[a("button",{id:"custom_controls_color",class:"color-button",style:K({background:t.object.customControlsColor}),onClick:e[21]||(e[21]=u=>t.colorSelect="controls")},null,4)])]),a("tr",null,[Ih,a("td",null,[a("button",{id:"custom_namebox_color",class:"color-button",style:K({background:t.object.customNameboxColor}),onClick:e[22]||(e[22]=u=>t.colorSelect="namebox")},null,4)])]),a("tr",null,[Dh,a("td",null,[a("button",{id:"custom_namebox_stroke",class:"color-button",style:K({background:t.object.customNameboxStroke}),onClick:e[23]||(e[23]=u=>t.colorSelect="nameboxStroke")},null,4)])])],64)):j("",!0)])):j("",!0)]),_:1})]),_:1},8,["class"]),a("button",{onClick:e[24]||(e[24]=(...u)=>t.resetPosition&&t.resetPosition(...u))},"Reset position"),a("button",{onClick:e[25]||(e[25]=(...u)=>t.splitTextbox&&t.splitTextbox(...u))},"Split textbox")]),_:1},8,["object","textHandler","colorHandler"])}var Ah=D(ih,[["render",Hh],["__scopeId","data-v-e8b25ccc"]]);const Rh=St(),Mh=I({mixins:[Q],components:{Toggle:nt,DFieldset:rt,DFlow:oe,ObjectTool:Kt},data:()=>({currentIdx:0,textEditor:!1}),computed:{object(){const t=this.$store.state.objects.objects[this.$store.state.ui.selection];if(t.type==="choice")return t},autoWrap:Rh("autoWrap","objects/setAutoWrapping"),buttonText:Wh("text","objects/setChoiceText",!0),buttons(){return this.object.choices},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.buttonText,set:t=>{this.buttonText=t},leave:()=>{this.textEditor=!1}}}},methods:{select(t){this.currentIdx=t},addChoice(){this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/addChoice",{id:this.object.id,text:""})})},removeChoice(){this.vuexHistory.transaction(()=>{this.currentIdx===this.object.choices.length-1&&this.currentIdx>0&&this.select(this.currentIdx-1),this.$store.dispatch("objects/removeChoice",{id:this.object.id,choiceIdx:this.currentIdx})})}}});function Wh(t,e,o=!1){return{get(){return this.object.choices[this.currentIdx][t]},set(s){this.vuexHistory.transaction(()=>{this.$store[o?"dispatch":"commit"](e,{id:this.object.id,choiceIdx:this.currentIdx,[t]:s})})}}}const Nh=t=>(G("data-v-0f3fb6d1"),t=t(),Y(),t),Vh=["onClick"],Fh=Nh(()=>a("tr",null,[a("td",{colspan:"2"},[a("label",{for:"choice-button-input"},"Text")])],-1));function Lh(t,e,o,s,n,i){const r=v("d-flow"),l=v("d-fieldset"),d=v("toggle"),c=v("object-tool");return h(),k(c,{object:t.object,title:"Choice",textHandler:t.textHandler},{default:w(()=>[y(l,{class:"buttons",title:"Buttons:"},{default:w(()=>[y(r,{maxSize:"100%",direction:"vertical",noWraping:""},{default:w(()=>[(h(!0),g(_,null,E(t.buttons,(u,p)=>(h(),g("div",{class:W({choiceBtn:!0,active:p===t.currentIdx}),key:p,onClick:b=>t.select(p)},F(u.text.trim()===""?"[Empty]":u.text),11,Vh))),128))]),_:1})]),_:1}),y(l,{class:"current_button",title:"Current button:"},{default:w(()=>[a("table",null,[Fh,a("tr",null,[a("td",null,[A(a("input",{id:"choice-button-input","onUpdate:modelValue":e[0]||(e[0]=u=>t.buttonText=u),onKeydown:e[1]||(e[1]=O(()=>{},["stop"]))},null,544),[[z,t.buttonText]])]),a("td",null,[a("button",{onClick:e[2]||(e[2]=u=>t.textEditor=!0)},"...")])])])]),_:1}),a("button",{onClick:e[3]||(e[3]=(...u)=>t.addChoice&&t.addChoice(...u))},"Add"),a("button",{onClick:e[4]||(e[4]=(...u)=>t.removeChoice&&t.removeChoice(...u))},"Remove"),y(d,{label:"Auto line wrap?",modelValue:t.autoWrap,"onUpdate:modelValue":e[5]||(e[5]=u=>t.autoWrap=u)},null,8,["modelValue"])]),_:1},8,["object","textHandler"])}var Eh=D(Mh,[["render",Lh],["__scopeId","data-v-0f3fb6d1"]]);const zh=I({mixins:[Q],components:{L:ze}}),Bo=t=>(G("data-v-e57e6a60"),t=t(),Y(),t),Uh={class:"panel"},Xh=Bo(()=>a("h1",null,"Help and Credits",-1)),Gh=C("Help"),Yh=C("Fork me on GitHub"),qh=C("Privacy Statement"),Kh=Bo(()=>a("p",null," All assets used are IP of Team Salvato and created by them, unless noted otherwise. ",-1)),Jh=Bo(()=>a("p",null,[C(" Doki Doki Dialog Generator developed by EDave64 "),a("br"),C("Based on gemdude46's DDLC Shitpost generator ")],-1)),Zh=C(" Unused House Background by "),Qh=C(" Fatelogic "),tp=C(" Aller Font by "),ep=C("Dalton Maag Ltd"),op=C(" Riffic Bold Font by "),sp=C("InkyType"),np=C(" Verily Serif Mono Font by "),ip=C("Stephen G. Hartke"),rp=C(" F25 Bank Printer Font by "),ap=C("F25 Digital Typeface Design"),lp=C(" Journal Font by "),dp=C("Fontourist"),cp=C(" Hashtag Font by "),up=C(" TitanVex"),hp=C(" JP Hand Slanted Font by "),pp=C("Jonathan Paterson"),fp=C(" As I Lay Dying Font by "),gp=C("Moises Esqueda"),bp=C(" Damagrafik Script Font by "),mp=C("Davide Terenzi"),yp=C(" Ammy's Handwriting Font by "),vp=C("Ammy K."),wp=C(" Halogen Font by "),Cp=C("JLH Fonts"),$p=Yo("<p data-v-e57e6a60> MC Classic Sprite by Childish-N <br data-v-e57e6a60>MC Classic Chibi by GyleToTheRescue </p><p data-v-e57e6a60> MC Sprite by Childish-N <br data-v-e57e6a60>MC Casual Sprite by SlightlySimple <br data-v-e57e6a60>MC Chibi by SlightlySimple </p><p data-v-e57e6a60> MC Chad Sprite by Cylent-Nite <br data-v-e57e6a60>MC Chad Poses and expressions by SlightlySimple <br data-v-e57e6a60>MC Chad Poses and chibi by Meddy-sin </p><p data-v-e57e6a60> FeMC Sprite by Meddy-sin <br data-v-e57e6a60>FeMC Casual Sprite by SlightlySimple </p><p data-v-e57e6a60>Classic Amy Sprite by Meddy-sin</p><p data-v-e57e6a60>Amy Sprite by Meddy-sin and SlightlySimple</p><p data-v-e57e6a60>Special thanks to SlightlySimple for testing and technical help</p><p data-v-e57e6a60> Atlas421, T-Rex Harris, smearglexd and Tactical Cupcakes for suggestions and testing </p>",8);function kp(t,e,o,s,n,i){const r=v("l");return h(),g("div",Uh,[Xh,y(r,{class:"btn",to:"wiki://Dokumentation"},{default:w(()=>[Gh]),_:1}),y(r,{class:"btn",to:"github://"},{default:w(()=>[Yh]),_:1}),y(r,{class:"btn",to:"wiki://Privacy Statement"},{default:w(()=>[qh]),_:1}),Kh,Jh,a("p",null,[Zh,y(r,{to:"https://www.deviantart.com/fatelogic/art/VN-Background-Practice-295671161"},{default:w(()=>[Qh]),_:1})]),a("p",null,[tp,y(r,{to:"https://www.daltonmaag.com/library/aller"},{default:w(()=>[ep]),_:1})]),a("p",null,[op,y(r,{to:"https://www.fontspring.com/fonts/inky-type/riffic"},{default:w(()=>[sp]),_:1})]),a("p",null,[np,y(r,{to:"https://www.dafont.com/verily-serif-mono.font"},{default:w(()=>[ip]),_:1})]),a("p",null,[rp,y(r,{to:"https://www.dafont.com/f25-bank-printer.font"},{default:w(()=>[ap]),_:1})]),a("p",null,[lp,y(r,{to:"https://www.dafont.com/journal.font"},{default:w(()=>[dp]),_:1})]),a("p",null,[cp,y(r,{to:"https://www.dafont.com/hashtag.font"},{default:w(()=>[up]),_:1})]),a("p",null,[hp,y(r,{to:"https://www.dafont.com/jp-hand-slanted.font"},{default:w(()=>[pp]),_:1})]),a("p",null,[fp,y(r,{to:"https://www.dafont.com/as-i-lay-dying.font"},{default:w(()=>[gp]),_:1})]),a("p",null,[bp,y(r,{to:"https://www.dafont.com/damagrafik-script.font"},{default:w(()=>[mp]),_:1})]),a("p",null,[yp,y(r,{to:"https://www.dafont.com/ammys-handwriting.font"},{default:w(()=>[vp]),_:1})]),a("p",null,[wp,y(r,{to:"https://www.dafont.com/halogen.font"},{default:w(()=>[Cp]),_:1})]),$p])}var xp=D(zh,[["render",kp],["__scopeId","data-v-e57e6a60"]]);const Sp=I({props:{backgroundId:{type:String,required:!0}},data:()=>({isWebPSupported:null,assets:[]}),computed:{background(){const t=this.$store.state.panels.currentPanel;return this.$store.state.panels.panels[t].background},bgData(){return this.$store.getters["content/getBackgrounds"].get(this.backgroundId)||null},isActive(){return this.backgroundId===this.background.current},title(){switch(this.backgroundId){case"buildin.static-color":return"Static color";case"buildin.transparent":return"Transparent"}return this.bgData.label||""},style(){switch(this.backgroundId){case"buildin.static-color":return{"background-color":this.background.color};case"buildin.transparent":return{}}return{backgroundImage:this.assets.filter(e=>e instanceof HTMLImageElement).map(e=>`url('${e.src}')`).join(",")}}},async created(){this.bgData&&(this.assets=await Promise.all(this.bgData.variants[0].map(t=>Ot(t,!1))))}}),jp=["title"];function Pp(t,e,o,s,n,i){return h(),g("div",{class:W({background:!0,active:t.isActive}),title:t.title,style:K(t.style),onClick:e[0]||(e[0]=r=>t.$emit("input",t.backgroundId))},F(t.title),15,jp)}var Tp=D(Sp,[["render",Pp],["__scopeId","data-v-5e73a5d6"]]);const _p=I({components:{Toggle:nt,DFieldset:rt},computed:{vertical(){return this.$store.state.ui.vertical},color:{get(){return this.background.color},set(t){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundColor",{color:t,panelId:this.$store.state.panels.currentPanel})})}},flipped:{get(){return this.background.flipped},set(t){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundFlipped",{flipped:t,panelId:this.$store.state.panels.currentPanel})})}},scaling:{get(){return this.background.scaling.toString()},set(t){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundScaling",{scaling:parseInt(t,10),panelId:this.$store.state.panels.currentPanel})})}},currentBackgroundId(){return this.background.current},background(){const t=this.$store.state.panels.currentPanel;return this.$store.state.panels.panels[t].background},bgData(){return this.$store.state.content.current.backgrounds.find(t=>t.id===this.currentBackgroundId)||null},isColor(){return this.currentBackgroundId==="buildin.static-color"},isVariant(){return!!this.bgData},hasVariants(){return this.bgData?this.bgData.variants.length>1:!1}},methods:{seekVariant(t){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekBackgroundVariant",{delta:t,panelId:this.$store.state.panels.currentPanel})})}}}),ne=t=>(G("data-v-112c6096"),t=t(),Y(),t),Bp=ne(()=>a("label",{for:"bg_color"},"Color:",-1)),Op={key:1},Ip={colspan:"3"},Dp={key:0},Hp={class:"arrow-col"},Ap=ne(()=>a("td",{style:{"text-align":"center"}},"Variant",-1)),Rp={class:"arrow-col"},Mp={colspan:"3"},Wp=ne(()=>a("option",{value:"0"},"None",-1)),Np=ne(()=>a("option",{value:"1"},"Stretch",-1)),Vp=ne(()=>a("option",{value:"2"},"Cover",-1)),Fp=[Wp,Np,Vp],Lp={colspan:"3"};function Ep(t,e,o,s,n,i){const r=v("toggle"),l=v("d-fieldset");return h(),k(l,{class:W({"bg-settings":!0,vertical:t.vertical}),title:"Settings:"},{default:w(()=>[t.isColor?(h(),g(_,{key:0},[Bp,a("button",{id:"bg_color",class:"color-button",style:K({background:t.color}),onClick:e[0]||(e[0]=d=>t.$emit("change-color"))},null,4)],64)):j("",!0),t.isVariant?(h(),g("table",Op,[a("tr",null,[a("td",Ip,[y(r,{modelValue:t.flipped,"onUpdate:modelValue":e[1]||(e[1]=d=>t.flipped=d),label:"Flipped?"},null,8,["modelValue"])])]),t.hasVariants?(h(),g("tr",Dp,[a("td",Hp,[a("button",{class:"small-button",onClick:e[2]||(e[2]=d=>t.seekVariant(-1))},"<")]),Ap,a("td",Rp,[a("button",{class:"small-button",onClick:e[3]||(e[3]=d=>t.seekVariant(1))},">")])])):j("",!0),a("tr",null,[a("td",Mp,[A(a("select",{"onUpdate:modelValue":e[4]||(e[4]=d=>t.scaling=d),onKeydown:e[5]||(e[5]=O(()=>{},["stop"]))},Fp,544),[[ot,t.scaling]])])]),a("tr",null,[a("td",Lp,[a("button",{id:"image_options_button",onClick:e[6]||(e[6]=d=>t.$emit("open-image-options"))}," Image options ")])])])):j("",!0)]),_:1},8,["class"])}var zp=D(_p,[["render",Ep],["__scopeId","data-v-112c6096"]]);const an={packId:"dddg.buildin.uploadedBackgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},Up=I({mixins:[Q],components:{BackgroundButton:Tp,BackgroundSettings:zp,DropTarget:is,Color:Pe,ImageOptions:To,DButton:le},data:()=>({colorSelect:!1,imageOptions:!1}),computed:{bgColor:{get(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel].background.color},set(t){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundColor",{color:t,panelId:this.$store.state.panels.currentPanel})})}},backgrounds(){return[...this.$store.state.content.current.backgrounds.map(t=>t.id),"buildin.static-color","buildin.transparent"]},showBackgroundsFolder(){return R.supports.openableFolders.has("backgrounds")}},methods:{setBackground(t){this.$store.commit("panels/setCurrentBackground",{current:t,panelId:this.$store.state.panels.currentPanel})},onFileUpload(t){const e=this.$refs.upload;if(!!e.files)for(const o of e.files)this.addImageFile(o)},addImageFile(t){const e=URL.createObjectURL(t);this.addNewCustomBackground(t.name,t.name,e)},addByUrl(){const t=prompt("Enter the URL of the image");if(!t)return;const e=t.split("/").slice(-1)[0];this.addNewCustomBackground(e,e,t)},addNewCustomBackground(t,e,o){an.backgrounds.push({id:t,label:e,variants:[[o]],scaling:"none"}),this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:an}),this.setBackground(t)})},dragEnter(t){!t.dataTransfer||(t.dataTransfer.effectAllowed="none",!!Array.from(t.dataTransfer.items).find(e=>e.type.match(/^image.*$/))&&(t.dataTransfer.effectAllowed="link",this.$refs.dt.show()))},openBackgroundFolder(){R.openFolder("backgrounds")}}}),ln=t=>(G("data-v-10bb17be"),t=t(),Y(),t),Xp=C("Drop here to add as a new background "),Gp=ln(()=>a("h1",null,"Background",-1)),Yp=C(" Upload "),qp=ln(()=>a("i",{class:"material-icons"},"extension",-1)),Kp=C(" Search in content packs "),Jp=[qp,Kp],Zp=C(" Open sprites folder ");function Qp(t,e,o,s,n,i){const r=v("drop-target"),l=v("color"),d=v("image-options"),c=v("background-settings"),u=v("d-button"),p=v("background-button");return h(),g("div",{class:"panel",onDragenter:e[9]||(e[9]=(...b)=>t.dragEnter&&t.dragEnter(...b)),onMouseleave:e[10]||(e[10]=b=>t.$refs.dt.hide())},[y(r,{ref:"dt",class:"drop-target",onDrop:t.addImageFile},{default:w(()=>[Xp]),_:1},8,["onDrop"]),Gp,t.colorSelect?(h(),k(l,{key:0,modelValue:t.bgColor,"onUpdate:modelValue":e[0]||(e[0]=b=>t.bgColor=b),onLeave:e[1]||(e[1]=b=>t.colorSelect=!1)},null,8,["modelValue"])):t.imageOptions?(h(),k(d,{key:1,type:"background",title:"",id:t.$store.state.panels.currentPanel,"no-composition":"",onLeave:e[2]||(e[2]=b=>t.imageOptions=!1)},null,8,["id"])):(h(),g(_,{key:2},[y(c,{onChangeColor:e[3]||(e[3]=b=>t.colorSelect=!0),onOpenImageOptions:e[4]||(e[4]=b=>t.imageOptions=!0)}),a("div",{class:"btn upload-background",onClick:e[6]||(e[6]=b=>t.$refs.upload.click())},[Yp,a("input",{type:"file",ref:"upload",onChange:e[5]||(e[5]=(...b)=>t.onFileUpload&&t.onFileUpload(...b))},null,544)]),a("button",{class:"upload-background",onClick:e[7]||(e[7]=(...b)=>t.addByUrl&&t.addByUrl(...b))},"Add by URL"),a("button",{class:"upload-background",onClick:e[8]||(e[8]=b=>t.$emit("show-dialog","type: Backgrounds"))},Jp),t.showBackgroundsFolder?(h(),k(u,{key:0,icon:"folder",class:"upload-background",onClick:t.openBackgroundFolder},{default:w(()=>[Zp]),_:1},8,["onClick"])):j("",!0),(h(!0),g(_,null,E(t.backgrounds,b=>(h(),k(p,{key:b,backgroundId:b,onInput:T=>t.setBackground(b)},null,8,["backgroundId","onInput"]))),128))],64))],32)}var tf=D(Up,[["render",Qp],["__scopeId","data-v-10bb17be"]]),ie;(function(t){t[t.None=0]="None",t[t.Stretch=1]="Stretch",t[t.Cover=2]="Cover"})(ie||(ie={}));const ef="buildin.transparent";let dn=0;const Te={panelToUrl:new Map,urlToPanel:new Map,register(t,e){if(this.panelToUrl.has(t)){if(this.panelToUrl.get(t)===e)return;this.unregister(t,this.panelToUrl.get(t))}this.panelToUrl.set(t,e),this.urlToPanel.has(e)?this.urlToPanel.get(e).push(t):this.urlToPanel.set(e,[t])},unregister(t,e){if(this.urlToPanel.has(e)){const o=this.urlToPanel.get(e);o.splice(o.indexOf(t),1),o.length===0&&(this.urlToPanel.delete(e),URL.revokeObjectURL(e))}this.panelToUrl.delete(t)}};var of={namespaced:!0,state:{panels:{},panelOrder:[],currentPanel:null},mutations:{setCurrentPanel(t,{panelId:e}){t.currentPanel=e},setPanelPreview(t,{panelId:e,url:o}){t.panels[e].lastRender=o,Te.register(e,o)},createPanel(t,{panel:e}){t.panels[e.id]=e},setPanelOrder(t,{panelOrder:e}){t.panelOrder=[...e]},setCurrentBackground(t,{current:e,panelId:o}){const s=t.panels[o];s.background.current=e,s.background.variant=0},setBackgroundColor(t,{color:e,panelId:o}){const s=t.panels[o];s.background.color=e},setBackgroundFlipped(t,{flipped:e,panelId:o}){const s=t.panels[o];s.background.flipped=e},setBackgroundVariant(t,{variant:e,panelId:o}){const s=t.panels[o];s.background.variant=e},setBackgroundScaling(t,{scaling:e,panelId:o}){const s=t.panels[o];s.background.scaling=e},deletePanel(t,{panelId:e}){Te.unregister(e,Te.panelToUrl.get(e)),delete t.panels[e]},setComposition(t,e){const o=t.panels[e.id];o.composite=e.composite},setFilters(t,e){const o=t.panels[e.id];o.filters=e.filters},backgroundSetComposition(t,e){const o=t.panels[e.id];o.background.composite=e.composite},backgroundSetFilters(t,e){const o=t.panels[e.id];o.background.filters=e.filters}},actions:{createPanel({state:t,commit:e}){const o="panel"+ ++dn;e("createPanel",{panel:{id:o,background:{color:"#000000",current:ef,flipped:!1,scaling:2,variant:0,composite:"source-over",filters:[]},lastRender:"",composite:"source-over",filters:[]}}),t.panelOrder?e("setPanelOrder",{panelOrder:[...t.panelOrder,o]}):e("setPanelOrder",{panelOrder:[o]}),e("setCurrentPanel",{panelId:o})},duplicatePanel({state:t,commit:e,dispatch:o},{panelId:s}){const n=t.panels[s],i="panel"+ ++dn;Te.register(i,n.lastRender),e("createPanel",{panel:{id:i,background:JSON.parse(JSON.stringify(n.background)),lastRender:n.lastRender,composite:n.composite,filters:JSON.parse(JSON.stringify(n.filters))}}),o("objects/copyObjects",{sourcePanelId:s,targetPanelId:i},{root:!0});const r=t.panelOrder.indexOf(s);e("setPanelOrder",{panelOrder:[...t.panelOrder.slice(0,r+1),i,...t.panelOrder.slice(r+1)]}),e("setCurrentPanel",{panelId:i})},seekBackgroundVariant({state:t,rootGetters:e,commit:o},{delta:s}){const n=t.panels[t.currentPanel],r=e["content/getBackgrounds"].get(n.background.current);!r||o("setBackgroundVariant",{panelId:t.currentPanel,variant:Zt(r.variants,n.background.variant,s)})},delete({state:t,dispatch:e,commit:o},{panelId:s}){if(t.panelOrder.length<=1)return;const n=t.panelOrder.indexOf(s);let i;n===t.panelOrder.length-1?i=n-1:i=n+1,o("setCurrentPanel",{panelId:t.panelOrder[i]}),o("setPanelOrder",{panelOrder:[...t.panelOrder.slice(0,n),...t.panelOrder.slice(n+1)]}),e("objects/deleteAllOfPanel",{panelId:s},{root:!0}),o("deletePanel",{panelId:s})},async fixContentPackRemoval({state:t,rootGetters:e,commit:o,rootState:s},n){for(const i of Object.values(t.panels)){const r=n.backgrounds.find(u=>u.id===i.background.current);if(!r)return;const l=e["content/getBackgrounds"].get(i.background.current);if(!l){s.content.current.backgrounds[0]?o("setCurrentBackground",{current:s.content.current.backgrounds[0].id,panelId:i.id}):o("setCurrentBackground",{current:"buildin.transparent",panelId:i.id});return}const d=JSON.stringify(r.variants[i.background.variant]),c=l.variants.findIndex(u=>JSON.stringify(u)===d);c!==i.background.variant&&o("setBackgroundVariant",{variant:c===-1?0:c,panelId:i.id})}},move({state:t,commit:e},{panelId:o,delta:s}){const n=[...t.panelOrder],i=n.indexOf(o);n.splice(i,1);const r=Math.max(i+s,0);n.splice(r,0,o),e("setPanelOrder",{panelOrder:n})},addFilter({state:t,commit:e},o){xo(o,s=>t.panels[s],s=>e("setFilters",s))},removeFilter({state:t,commit:e},o){So(o,s=>t.panels[s],s=>e("setFilters",s))},moveFilter({state:t,commit:e},o){jo(o,s=>t.panels[s],s=>e("setFilters",s))},setFilter({state:t,commit:e},o){Po(o,s=>t.panels[s],s=>e("setFilters",s))},backgroundAddFilter({state:t,commit:e},o){xo(o,s=>t.panels[s].background,s=>e("backgroundSetFilters",s))},backgroundRemoveFilter({state:t,commit:e},o){So(o,s=>t.panels[s].background,s=>e("backgroundSetFilters",s))},backgroundMoveFilter({state:t,commit:e},o){jo(o,s=>t.panels[s].background,s=>e("backgroundSetFilters",s))},backgroundSetFilter({state:t,commit:e},o){Po(o,s=>t.panels[s].background,s=>e("backgroundSetFilters",s))}}};class sf{constructor(e,o,s,n,i,r){this.id=e,this.assets=o,this.flip=s,this.scale=n,this.compositeMode=i,this.filters=r}async render(e){const{screenWidth:o,screenHeight:s}=P().Base,n=await Promise.all(this.assets.map(i=>Ot(i,e.hq)));for(const i of n){if(!(i instanceof HTMLImageElement))return;let r=0,l=0,d=i.width,c=i.height;switch(this.scale){case ie.None:r=o/2-d/2,l=s/2-c/2;break;case ie.Stretch:d=o,c=s;break;case ie.Cover:const u=d/c,p=o/s;u>p?(c=s,d=c*u):(d=o,c=d/u),r=o/2-d/2,l=s/2-c/2}e.drawImage({image:i,x:r,y:l,w:d,h:c,flip:this.flip,composite:this.compositeMode,filters:this.filters})}}}const cn={id:"buildin.static-color",name:"Static color",color:"#000000",async render(t){const{screenWidth:e,screenHeight:o}=P().Base;t.drawRect({x:0,y:0,w:e,h:o,fill:{style:this.color}})}};class un extends en{constructor(){super(...arguments);f(this,"refTextbox",null)}get canvasDrawWidth(){return this.width*this.objZoom}get canvasDrawHeight(){return this.height*this.objZoom}get canvasDrawPosX(){return this.x-this.width/2+(this.height-this.canvasDrawHeight)/2}get canvasDrawPosY(){return this.y+(this.height-this.canvasDrawHeight)}get objZoom(){return(this.obj.enlargeWhenTalking&&this.refTextbox?1.05:1)*this.obj.zoom}getHitbox(){const e=super.getHitbox(),o=this.width*(this.objZoom-1),s=this.height*(this.objZoom-1);return{x0:e.x0-o/2,x1:e.x1+o/2,y0:e.y0-s,y1:e.y1}}updatedContent(e,o){const s=e.state.objects.panels[o],n=[...s.order,...s.onTopOrder];this.refTextbox=null;for(const i of n){const r=e.state.objects.objects[i];if(r.type==="textBox"&&r.talkingObjId===this.obj.id){this.refTextbox=r;return}}}async renderLocal(e){const o=this.getAssetList(),s=await Promise.all(o.filter(n=>n.assets).map(n=>nf(n,e.hq)));for(const n of s)for(const i of n.assets)e.drawImage({image:i,composite:n.composite,x:n.offset[0],y:n.offset[1]})}}async function nf(t,e){return"loaded"in t?t:{loaded:!0,offset:t.offset,assets:await Promise.all(t.assets.map(o=>Ot(o,e))),composite:t.composite}}class rf extends un{constructor(e){super(e);f(this,"assets");f(this,"ready");f(this,"canvasHeight",0);f(this,"canvasWidth",0);this.init()}get version(){return this.assets===null?-1:this.obj.version}async init(){let e;this.ready=new Promise((i,r)=>{e=i});const o=await Promise.all(this.obj.assets.map(i=>Ot(i)));let s=0,n=0;for(const i of o)i instanceof HTMLImageElement&&(i.height>n&&(n=i.height),i.width>s&&(s=i.width));this.canvasWidth=s,this.canvasHeight=n,this.assets=[{loaded:!0,assets:o,offset:[0,0]}],e()}getAssetList(){return this.assets||[]}}class af extends un{constructor(e,o){super(e);f(this,"scaleable",!0);this.data=o}updatedContent(e,o){super.updatedContent(e,o),this.data=be(e,this.obj)}getAssetList(){const e=wt(this.data,this.obj),o=mo(this.data,this.obj),s=[];for(const n of e.renderCommands)switch(n.type){case"head":s.push({offset:n.offset,composite:n.composite,assets:o?o.variants[this.obj.posePositions.head||0]:[]});break;case"image":s.push({offset:n.offset,composite:n.composite,assets:n.images});break;case"pose-part":const i=e.positions[n.part];if(!i||i.length===0)break;const r=i[this.obj.posePositions[n.part]||0];if(!r)break;s.push({offset:n.offset,composite:n.composite,assets:r});break}return s}get canvasHeight(){return wt(this.data,this.obj).size[1]}get canvasWidth(){return wt(this.data,this.obj).size[0]}get closeZoom(){let e=1;return this.obj.close&&(e*=2),e}get width(){return this.obj.width*this.closeZoom}get height(){return this.obj.height*this.closeZoom}}class lf extends $e{constructor(){super(...arguments);f(this,"_height",0);f(this,"choiceRenderers",[])}get height(){return this._height}get centeredVertically(){return!0}async draw(e){await this.updateChoiceBounds();const o=P(),s=this.obj.width,n=this.height,i=s/2,l=(this.flip?o.Base.screenWidth-this.obj.x:this.obj.x)-i;let d=this.obj.y-n/2;for(const c of this.choiceRenderers){await c.loadFonts();const u=c.getHeight(this.obj.autoWrap?this.obj.width:0);e.drawRect({x:l,y:d,w:s,h:u+o.Choices.ChoicePadding*2,outline:{style:o.Choices.ChoiceButtonBorderColor,width:o.Choices.Outline},fill:{style:o.Choices.ChoiceButtonColor}}),c.fixAlignment("center",l,l+s,d+o.Choices.ChoiceSpacing*1.25,this.obj.autoWrap?s:0),c.render(e.fsCtx),d+=u+o.Choices.ChoicePadding*2+o.Choices.ChoiceSpacing}}async updateChoiceBounds(){const e=P();this.choiceRenderers=this.obj.choices.map(o=>new ft(o.text||" ",e.Choices.ChoiceTextStyle)),this._height=this.choiceRenderers.reduce((o,s)=>o+s.getHeight(this.obj.autoWrap?this.obj.width:0)+e.Choices.ChoicePadding*2,0)+this.obj.choiceDistance*(this.obj.choices.length-1)}}class df extends $e{constructor(){super(...arguments);f(this,"_height",0);f(this,"_width",0)}get height(){return this._height}get width(){return this._width}get centeredVertically(){return!0}get id(){return this.obj.id}async render(e,o){const s=P();this.obj.backdrop&&o.drawRect({x:0,y:0,w:s.Base.screenWidth,h:s.Base.screenHeight,fill:{style:P().Notification.NotificationBackdropColor}}),await super.render(e,o)}async draw(e){const o=P(),s=new ft(this.obj.text,o.Notification.NotificationTextStyle),n=new ft("OK",o.Notification.NotificationOkTextStyle);await s.loadFonts(),await n.loadFonts();const i=this.obj.autoWrap?this.obj.width-o.Notification.NotificationPadding*2:0,r=this.obj.autoWrap?i:s.getWidth(),l=s.getHeight(i),d=this.obj.autoWrap?i:n.getWidth(),c=n.getHeight(i),u=this._width=Math.max(r,d)+o.Notification.NotificationPadding*2,p=this._height=l+o.Notification.NotificationPadding*2+o.Notification.NotificationSpacing+c,b=u/2,x=(this.flip?o.Base.screenWidth-this.obj.x:this.obj.x)-b,$=this.obj.y-p/2;e.drawRect({x,y:$,w:u,h:p,outline:{style:o.Choices.ChoiceButtonBorderColor,width:3},fill:{style:o.Choices.ChoiceButtonColor}}),s.fixAlignment("center",x,x+u,$+o.Notification.NotificationPadding*1.5,i),s.render(e.fsCtx),n.fixAlignment("center",x,x+u,$+p-o.Notification.NotificationPadding,i),n.render(e.fsCtx)}}const cf=-2,uf=26,hf=10,pf=10;class ff extends $e{constructor(){super(...arguments);f(this,"_height",0);f(this,"_width",0)}get height(){return this._height}get width(){return this._width}get centeredVertically(){return!0}async draw(e){const o=P(),s=o.Poem.poemBackgrounds[this.obj.background],n=this.flip?o.Base.screenWidth-this.obj.x:this.obj.x;let i=this.obj.y,r=n+pf,l=o.Poem.poemPadding,d=o.Poem.poemTopPadding,c=l*2;if(s.file==="internal:console"){const b=this._height=this.obj.height,T=this._width=this.obj.width;e.drawRect({x:n-T/2,y:this.obj.y-b/2,h:b,w:T,fill:{style:o.Poem.consoleBackgroundColor}}),l=cf,d=uf,c=hf}else if(s.file==="internal:transparent")this._height=this.obj.height,this._width=this.obj.width;else{const b=await Fe(`assets/poemBackgrounds/${s.file}`);b instanceof HTMLImageElement&&(e.drawImage({image:b,x:n-b.width/2,y:this.obj.y-b.height/2}),this._height=b.height,this._width=b.width)}i-=this.height/2,r-=this.width/2;const u=o.Poem.poemTextStyles[this.obj.font],p=new ft(this.obj.text,u);await p.loadFonts(),p.fixAlignment("left",r+l,r+l,i+d+l,this.obj.autoWrap?this.width-c:0),p.render(e.fsCtx)}}class Oo{constructor(e,o,s,n){f(this,"renderObjectCache",new Map);f(this,"lCurrentlyRendering",!1);f(this,"renderer");this.store=e,this.panelId=o,this.canvasWidth=s,this.canvasHeight=n,this.renderer=new Lt(s,n)}render(e,o){return this.panel?this.renderer.render(this.renderCallback.bind(this),e,o):Promise.resolve(!1)}download(){const e=new Date,o=`panel-${[e.getFullYear(),`${e.getMonth()+1}`.padStart(2,"0"),`${e.getDate()}`.padStart(2,"0"),`${e.getHours()}`.padStart(2,"0"),`${e.getMinutes()}`.padStart(2,"0"),`${e.getSeconds()}`.padStart(2,"0")].join("-")}.png`;return this.renderer.download(this.renderCallback.bind(this),o)}get currentlyRendering(){return this.lCurrentlyRendering}paintOnto(e,o){this.renderer.paintOnto(e,o)}objectsAt(e,o){return this.getRenderObjects().filter(s=>s.hitTest(e,o)).map(s=>s.id)}async renderCallback(e){var o;this.lCurrentlyRendering=!0;try{e.fsCtx.imageSmoothingEnabled=!0,e.fsCtx.imageSmoothingQuality=e.hq?"high":"low",await((o=this.getBackgroundRenderer())==null?void 0:o.render(e));const s=this.store.state.ui.selection;for(const n of this.getRenderObjects()){let i=!1;n.updatedContent(this.store,this.panelId),i=s===n.id,await n.render(i,e)}e.applyFilters([...this.panel.filters]),e.preview&&e.drawImage({x:0,y:0,composite:"destination-over",image:await dt("backgrounds/transparent")})}finally{this.lCurrentlyRendering=!1}}getRenderObjects(){const e=this.store.state.objects.panels[this.panelId],o=e?[...e.order,...e.onTopOrder]:[],s=this.store.state.objects.objects,n=Object.keys(this.renderObjectCache).filter(i=>!o.includes(i));for(const i of n)this.renderObjectCache.delete(i);return o.map(i=>{let r=this.renderObjectCache.get(i);if(!r){const l=s[i];switch(l.type){case"sprite":r=new rf(l);break;case"character":const d=l;r=new af(d,be(this.store,d));break;case"textBox":r=new md(l);break;case"choice":r=new lf(l);break;case"notification":r=new df(l);break;case"poem":r=new ff(l);break}this.renderObjectCache.set(i,r)}return r})}get panel(){return this.store.state.panels.panels[this.panelId]}getBackgroundRenderer(){const e=this.panel;switch(e.background.current){case"buildin.static-color":return cn.color=e.background.color,cn;default:const s=this.store.getters["content/getBackgrounds"].get(e.background.current);if(!s)return null;const n=s.variants[e.background.variant];return n?new sf(e.background.current,n,e.background.flipped,e.background.scaling,e.background.composite,e.background.filters):null}}}const gf=1.5,hn=1/4,bf=.5,Io=100,pn=90,fn=70,mf=I({mixins:[Q],components:{DFieldset:rt,DFlow:oe,DButton:le,ImageOptions:To},data:()=>({webpSupport:!1,heifSupport:!1,ppi:0,pages:"",format:"image/png",quality:pn,imageOptions:!1}),computed:{currentPanel(){return this.$store.state.panels.currentPanel},isLossy(){return this.format!=="image/png"},canDeletePanel(){return this.panelButtons.length>1},panelButtons(){return this.$store.state.panels.panelOrder.map(e=>{const o=this.$store.state.panels.panels[e],s=this.$store.state.objects.panels[e],n=s?[].concat(s.order,s.onTopOrder).map(i=>this.$store.state.objects.objects[i]).map(this.extractObjectText):[];return{id:e,image:o.lastRender,text:n.reduce((i,r)=>i.length>r.length?i:r,"")}})},canMoveAhead(){return this.$store.state.panels.panelOrder.indexOf(this.currentPanel)>0},canMoveBehind(){const t=this.$store.state.panels.panelOrder;return t.indexOf(this.currentPanel)<t.length-1}},async created(){[this.webpSupport,this.heifSupport]=await Promise.all([Bt(),Zn()])},async mounted(){this.moveFocusToActivePanel(),this.renderThumbnail().catch(()=>{})},methods:{async download(){const t=this.getPanelDistibution(),e=new Date,o=`cd-${[e.getFullYear(),`${e.getMonth()+1}`.padStart(2,"0"),`${e.getDate()}`.padStart(2,"0"),`${e.getHours()}`.padStart(2,"0"),`${e.getMinutes()}`.padStart(2,"0"),`${e.getSeconds()}`.padStart(2,"0")].join("-")}`,s=this.format.split("/")[1],n=this.format,i=this.quality;await this.renderObjects(t,!0,async(r,l)=>{await R.saveToFile(l,`${o}_${r}.${s}`,n,i/Io)})},async estimateExportSize(){const t=this.getPanelDistibution(),e=this.format||"image/png",o=this.quality||pn,n=(await this.renderObjects(t,!1,async(d,c)=>new Promise((u,p)=>{c.toBlob(b=>{if(!b){p(`Image ${d+1} could not be rendered.`);return}u(b.size)},e,o/Io)}))).map(d=>(d*gf/1024/1024).toFixed(2)+"MiB"),i=n.length>1?"files":"file",r=n.length>1?"These":"It",l=n.length>1?"sizes":"size";U.fire(new lt(`This would export ${n.length} ${i}. ${r} would have the following (aproximate) ${l}: ${n.join(",")}`))},async renderObjects(t,e,o){const s=P().Base;return await Promise.all(t.map(async(n,i)=>{const r=document.createElement("canvas");r.width=s.screenWidth,r.height=s.screenHeight*n.length;const l=r.getContext("2d");return await Promise.all(n.map(async(d,c)=>{const u=new Oo(this.$store,n[c],s.screenWidth,s.screenHeight);await u.render(e,!1),u.paintOnto(l,{x:0,y:s.screenHeight*c,w:s.screenWidth,h:s.screenHeight})})),await o(i,r)}))},getLimitedPanelList(){const t=this.$store.state.panels.panelOrder.length-1,e=0,o=this.pages.split(","),s=[];let n=!1;for(const i of o){const r=i.trim(),l=r.match(/^\s*((\d+)|(\d+)\s*-\s*(\d+))\s*$/);if(!l){r!==""&&U.fire(new lt(`Could not read '${i}' in the page list.`));continue}if(n=!0,l[2])s.push(parseInt(l[2],10)-1);else{const d=Math.max(parseInt(l[3],10)-1,e),c=Math.min(parseInt(l[4],10)-1,t);if(d==null||c==null||d>c)continue;for(let u=d;u<=c;++u)s.push(u)}}return n?s.sort((i,r)=>i-r).filter((i,r,l)=>l[r-1]!==i).map(i=>this.$store.state.panels.panelOrder[i]):this.$store.state.panels.panelOrder},getPanelDistibution(){const t=this.getLimitedPanelList();if(this.ppi===0)return[t];const e=[];for(let o=0;o<t.length/this.ppi;++o){const s=o*this.ppi,n=s+this.ppi;e.push([...t.slice(s,n)])}return e},moveFocusToActivePanel(){const t=this.$el.querySelector(".panel_button.active");t&&this.scrollIntoView(t)},scrollIntoView(t){const e=t.parentElement.parentElement,o=Array.from(t.parentElement.children).indexOf(t);this.$store.state.ui.vertical?(e.scrollTop=o*t.clientHeight-e.clientHeight/2+t.clientHeight/2,e.scrollLeft=0):(e.scrollLeft=o*t.clientWidth-e.clientWidth/2+t.clientWidth/2,e.scrollTop=0)},extractObjectText(t){switch(t.type){case"textBox":return t.text;case"notification":return t.text;case"poem":return t.text;case"choice":return t.choices.map(e=>`[${e.text}]`).join(`
`)}return""},async addNewPanel(){await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/duplicatePanel",{panelId:this.$store.state.panels.currentPanel})}),this.$nextTick(()=>{this.moveFocusToActivePanel()})},updateCurrentPanel(t){this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setCurrentPanel",{panelId:t})}),this.$nextTick(()=>{this.moveFocusToActivePanel()})},deletePanel(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/delete",{panelId:this.$store.state.panels.currentPanel})}),this.$nextTick(()=>{this.moveFocusToActivePanel()})},moveAhead(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/move",{panelId:this.currentPanel,delta:-1})})},moveBehind(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/move",{panelId:this.currentPanel,delta:1})})},async renderThumbnail(){const t=P().Base,e=new Oo(this.$store,this.currentPanel,t.screenWidth,t.screenHeight);await e.render(!1,!0);const o=document.createElement("canvas");o.width=t.screenWidth*hn,o.height=t.screenHeight*hn,e.paintOnto(o.getContext("2d"),{x:0,y:0,w:o.width,h:o.height}),o.toBlob(s=>{if(!s)return;const n=URL.createObjectURL(s);this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPanelPreview",{panelId:this.$store.state.panels.currentPanel,url:n})})},await Bt()?"image/webp":"image/jpeg",bf)}},watch:{quality(t,e){if(t===Io){U.fire(new lt("Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression."));return}if(e>fn&&t<=fn){U.fire(new lt("Note: A quality level below 70% might be very noticable and impair legibility of text."));return}}}}),Pt=t=>(G("data-v-30084f85"),t=t(),Y(),t),yf={class:"panel"},vf=Pt(()=>a("h1",null,"Panels",-1)),wf=["onClick"],Cf={class:"panel_text"},$f={class:"panel_nr"},kf={class:"column"},xf=C(" Add new "),Sf=C(" Delete panel "),jf=C(" Move ahead "),Pf=C(" Move behind "),Tf=C(" Image options "),_f=Pt(()=>a("td",null,[a("label",{for:"export_format"},"Format")],-1)),Bf=Pt(()=>a("option",{value:"image/png"},"PNG (lossless)",-1)),Of={key:0,value:"image/webp"},If={key:1,value:"image/heif"},Df=Pt(()=>a("option",{value:"image/jpeg"},"JPEG (lossy)",-1)),Hf={key:0},Af=Pt(()=>a("td",null,[a("label",{for:"export_quality"},"Quality:")],-1)),Rf=Pt(()=>a("td",null,[a("label",{for:"export_ppi"},[C(" Panels per image: "),a("br"),a("small",null,"(0 for one single image)")])],-1)),Mf=Pt(()=>a("td",null,[a("label",{for:"export_pages"},[C(" Panels to export: "),a("br"),a("small",null,"(Leave empty for all)")])],-1)),Wf=C(" Download ");function Nf(t,e,o,s,n,i){const r=v("image-options"),l=v("d-flow"),d=v("d-fieldset"),c=v("d-button");return h(),g("div",yf,[vf,t.imageOptions?(h(),k(r,{key:0,type:"panel",title:"",id:t.currentPanel,"no-composition":"",onLeave:e[0]||(e[0]=u=>{t.imageOptions=!1,t.renderThumbnail()})},null,8,["id"])):(h(),g(_,{key:1},[y(d,{class:"existing_panels_fieldset",title:"Existing Panels"},{default:w(()=>[y(l,{"no-wraping":"",maxSize:"350px"},{default:w(()=>[(h(!0),g(_,null,E(t.panelButtons,(u,p)=>(h(),g("div",{key:u.id,class:W({panel_button:!0,active:u.id===t.currentPanel}),style:K(`background-image: url('${u.image}')`),onClick:b=>t.updateCurrentPanel(u.id)},[a("div",Cf,[a("p",null,F(u.text),1)]),a("div",$f,F(p+1),1)],14,wf))),128))]),_:1})]),_:1}),a("div",kf,[y(c,{icon:"add_to_queue",onClick:t.addNewPanel},{default:w(()=>[xf]),_:1},8,["onClick"]),y(c,{icon:"remove_from_queue",onClick:t.deletePanel,disabled:!t.canDeletePanel},{default:w(()=>[Sf]),_:1},8,["onClick","disabled"]),y(c,{icon:"arrow_upward",onClick:t.moveAhead,disabled:!t.canMoveAhead},{default:w(()=>[jf]),_:1},8,["onClick","disabled"]),y(c,{icon:"arrow_downward",onClick:t.moveBehind,disabled:!t.canMoveBehind},{default:w(()=>[Pf]),_:1},8,["onClick","disabled"]),y(c,{icon:"color_lens",onClick:e[1]||(e[1]=u=>t.imageOptions=!0)},{default:w(()=>[Tf]),_:1})]),y(d,{title:"Export"},{default:w(()=>[a("table",null,[a("tr",null,[_f,a("td",null,[A(a("select",{id:"export_format","onUpdate:modelValue":e[2]||(e[2]=u=>t.format=u)},[Bf,t.webpSupport?(h(),g("option",Of,"WebP (lossy) ")):j("",!0),t.heifSupport?(h(),g("option",If,"HEIF (lossy) ")):j("",!0),Df],512),[[ot,t.format]])])]),t.isLossy?(h(),g("tr",Hf,[Af,a("td",null,[A(a("input",{id:"export_quality",type:"number",min:"0",max:"100","onUpdate:modelValue":e[3]||(e[3]=u=>t.quality=u),onKeydown:e[4]||(e[4]=O(()=>{},["stop"]))},null,544),[[z,t.quality,void 0,{number:!0}]])])])):j("",!0),a("tr",null,[Rf,a("td",null,[A(a("input",{id:"export_ppi",type:"number",min:"0","onUpdate:modelValue":e[5]||(e[5]=u=>t.ppi=u),onKeydown:e[6]||(e[6]=O(()=>{},["stop"]))},null,544),[[z,t.ppi,void 0,{number:!0}]])])]),a("tr",null,[Mf,a("td",null,[A(a("input",{id:"export_pages","onUpdate:modelValue":e[7]||(e[7]=u=>t.pages=u),placeholder:"E.g. 1-5, 8, 11-13"},null,512),[[z,t.pages]])])]),a("tr",null,[a("td",null,[y(c,{icon:"photo_camera",onClick:t.download},{default:w(()=>[Wf]),_:1},8,["onClick"])]),a("td",null,[a("button",{onClick:e[8]||(e[8]=(...u)=>t.estimateExportSize&&t.estimateExportSize(...u))},"Estimate filesizes")])])])]),_:1})],64))])}var Vf=D(mf,[["render",Nf],["__scopeId","data-v-30084f85"]]);const Do=St(),Ff=I({mixins:[Q],components:{Toggle:nt,ObjectTool:Kt},data:()=>({textEditor:!1}),computed:{object(){const t=this.$store.state.objects.objects[this.$store.state.ui.selection];if(t.type==="notification")return t},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.text,set:t=>{this.text=t},leave:()=>{this.textEditor=!1}}},text:Do("text","objects/setNotificationText"),autoWrap:Do("autoWrap","objects/setAutoWrapping"),renderBackdrop:Do("backdrop","objects/setNotificationBackdrop")}}),Lf=t=>(G("data-v-3d4404c2"),t=t(),Y(),t),Ef={id:"notification_text_wrapper"},zf=Lf(()=>a("label",{for:"notification_text"},"Text:",-1));function Uf(t,e,o,s,n,i){const r=v("toggle"),l=v("object-tool");return h(),k(l,{object:t.object,title:"Notification",textHandler:t.textHandler},{default:w(()=>[a("div",Ef,[zf,A(a("textarea",{"onUpdate:modelValue":e[0]||(e[0]=d=>t.text=d),id:"notification_text",onKeydown:e[1]||(e[1]=O(()=>{},["stop"]))},null,544),[[z,t.text]]),a("button",{onClick:e[2]||(e[2]=d=>t.textEditor=!0)},"Formatting")])]),options:w(()=>[y(r,{modelValue:t.renderBackdrop,"onUpdate:modelValue":e[3]||(e[3]=d=>t.renderBackdrop=d),label:"Show backdrop?"},null,8,["modelValue"])]),_:1},8,["object","textHandler"])}var Xf=D(Ff,[["render",Uf],["__scopeId","data-v-3d4404c2"]]);const _e=St(),Gf=I({mixins:[Q],components:{Toggle:nt,ObjectTool:Kt},data:()=>({textEditor:!1}),computed:{backgrounds(){return ws},poemTextStyles(){return Cs},object(){const t=this.$store.state.objects.objects[this.$store.state.ui.selection];if(t.type==="poem")return t},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.text,set:t=>{this.text=t},leave:()=>{this.textEditor=!1}}},text:_e("text","objects/setPoemText"),autoWrap:_e("autoWrap","objects/setAutoWrapping"),poemStyle:_e("font","objects/setPoemFont"),poemBackground:_e("background","objects/setPoemBackground")}}),Yf=t=>(G("data-v-01bdc498"),t=t(),Y(),t),qf={id:"poem_text"},Kf=Yf(()=>a("label",{for:"poem_text"},"Text:",-1)),Jf=["value"],Zf=["value"];function Qf(t,e,o,s,n,i){const r=v("toggle"),l=v("object-tool");return h(),k(l,{object:t.object,title:t.object.subType==="poem"?"Poem":"Console",textHandler:t.textHandler},{default:w(()=>[a("div",qf,[Kf,A(a("textarea",{"onUpdate:modelValue":e[0]||(e[0]=d=>t.text=d),onKeydown:e[1]||(e[1]=O(()=>{},["stop"]))},null,544),[[z,t.text]]),a("button",{onClick:e[2]||(e[2]=d=>t.textEditor=!0)},"Formatting")]),y(r,{label:"Auto line wrap?",modelValue:t.autoWrap,"onUpdate:modelValue":e[3]||(e[3]=d=>t.autoWrap=d)},null,8,["modelValue"]),t.object.subType==="poem"?(h(),g(_,{key:0},[A(a("select",{"onUpdate:modelValue":e[4]||(e[4]=d=>t.poemBackground=d),onKeydown:e[5]||(e[5]=O(()=>{},["stop"]))},[(h(!0),g(_,null,E(t.backgrounds,(d,c)=>(h(),g("option",{value:c,key:c},F(d.name),9,Jf))),128))],544),[[ot,t.poemBackground]]),A(a("select",{"onUpdate:modelValue":e[6]||(e[6]=d=>t.poemStyle=d),onKeydown:e[7]||(e[7]=O(()=>{},["stop"]))},[(h(!0),g(_,null,E(t.poemTextStyles,(d,c)=>(h(),g("option",{value:c,key:c},F(d.name),9,Zf))),128))],544),[[ot,t.poemStyle]])],64)):j("",!0)]),_:1},8,["object","title","textHandler"])}var tg=D(Gf,[["render",Qf],["__scopeId","data-v-01bdc498"]]);const eg=I({components:{SettingsPanel:Vi,AddPanel:ur,BackgroundsPanel:tf,CreditsPanel:xp,CharacterPanel:eh,TextBoxPanel:Ah,ChoicePanel:Eh,SpritePanel:nh,PanelsPanel:Vf,NotificationPanel:Xf,PoemPanel:tg},data:()=>({panelSelection:"add"}),computed:{vertical(){return this.$store.state.ui.vertical},selection(){return this.$store.state.ui.selection},panel(){if(this.panelSelection==="selection")if(this.selection===null)this.panelSelection="add";else return this.$store.state.objects.objects[this.selection].type;return this.panelSelection},hasPrevRender(){return this.$store.state.ui.lastDownload!==null}},methods:{create(){R.onPanelChange(t=>{this.panelSelection=t})},setPanel(t){if(t===this.panelSelection&&(t="add"),this.panelSelection=t,this.selection){if(this.$store.state.ui.selection===null)return;this.$store.commit("ui/setSelection",null)}}},watch:{selection(t){if(t){this.panelSelection="selection";return}this.panelSelection==="selection"&&(this.panelSelection="add")}}}),og={id:"toolbar"},sg=a("i",{class:"material-icons","aria-hidden":"true"},"add_box",-1),ng=[sg],ig=a("i",{class:"material-icons","aria-hidden":"true"},"panorama",-1),rg=[ig],ag=a("i",{class:"material-icons","aria-hidden":"true"},"view_module",-1),lg=[ag],dg=a("i",{class:"material-icons","aria-hidden":"true"},"settings_applications",-1),cg=[dg],ug={id:"toolbar-end"},hg=a("i",{class:"material-icons","aria-hidden":"true"},"help",-1),pg=[hg],fg=a("i",{class:"material-icons","aria-hidden":"true"},"extension",-1),gg=[fg],bg=["disabled"],mg=a("i",{class:"material-icons","aria-hidden":"true"},"flip_to_back",-1),yg=[mg],vg=a("i",{class:"material-icons","aria-hidden":"true"},"photo_camera",-1),wg=[vg];function Cg(t,e,o,s,n,i){const r=v("settings-panel"),l=v("backgrounds-panel"),d=v("credits-panel"),c=v("character-panel"),u=v("sprite-panel"),p=v("text-box-panel"),b=v("choice-panel"),T=v("panels-panel"),x=v("notification-panel"),$=v("poem-panel"),et=v("add-panel");return h(),g("div",{id:"panels",class:W({vertical:t.vertical})},[a("div",og,[a("button",{class:W({active:t.panel==="add"}),onClick:e[0]||(e[0]=V=>t.setPanel("add")),title:"Add new objects to the scene","aria-label":"Add new objects to the scene"},ng,2),a("button",{class:W({active:t.panel==="backgrounds"}),onClick:e[1]||(e[1]=V=>t.setPanel("backgrounds")),"aria-label":"Change the current background",title:"Change the current background"},rg,2),a("button",{class:W({active:t.panel==="panels"}),title:"Panels","aria-label":"Panels",onClick:e[2]||(e[2]=V=>t.setPanel("panels"))},lg,2),a("button",{class:W({active:t.panel==="settings"}),title:"Settings","aria-label":"Settings",onClick:e[3]||(e[3]=V=>t.setPanel("settings"))},cg,2)]),t.panel==="settings"?(h(),k(r,{key:0})):t.panel==="backgrounds"?(h(),k(l,{key:1,onShowDialog:e[4]||(e[4]=V=>t.$emit("show-dialog",V))})):t.panel==="help_credits"?(h(),k(d,{key:2})):t.panel==="character"?(h(),k(c,{key:3,onShowDialog:e[5]||(e[5]=V=>t.$emit("show-dialog",V)),onShowExpressionDialog:e[6]||(e[6]=V=>t.$emit("show-expression-dialog",V))})):t.panel==="sprite"?(h(),k(u,{key:4})):t.panel==="textBox"?(h(),k(p,{key:5})):t.panel==="choice"?(h(),k(b,{key:6})):t.panel==="panels"?(h(),k(T,{key:7})):t.panel==="notification"?(h(),k(x,{key:8})):t.panel==="poem"?(h(),k($,{key:9})):(h(),k(et,{key:10,onShowDialog:e[7]||(e[7]=V=>t.$emit("show-dialog",V))})),a("div",ug,[a("button",{class:W({active:t.panel==="help_credits"}),onClick:e[8]||(e[8]=V=>t.setPanel("help_credits")),title:"Help & Credits","aria-label":"Help & Credits"},pg,2),a("button",{class:W({active:t.panel==="packs"}),onClick:e[9]||(e[9]=V=>t.$emit("show-dialog")),title:"Content packs","aria-label":"Content packs"},gg,2),a("button",{onClick:e[10]||(e[10]=V=>t.$emit("show-prev-render")),title:"Show last downloaded panel","aria-label":"Show last downloaded panel",disabled:!t.hasPrevRender},yg,8,bg),a("button",{title:"Take a screenshot of the current scene","aria-label":"Take a screenshot of the current scene",onClick:e[11]||(e[11]=V=>t.$emit("download"))},wg)])],2)}var $g=D(eg,[["render",Cg]]);const kg=5e3,Ho=2e4,gn=100,xg=I({props:{loading:{default:!1,type:Boolean}},data:()=>({messages:[],errors:[],showLoading:!1,showLoadingTimeout:0,hideLoadingTimeout:0}),computed:{vertical(){return this.$store.state.ui.vertical}},created(){this.onLoadingChange(this.loading),U.subscribe(Ae,t=>{this.messages.push(`Failed to load asset '${t.path}'`),setTimeout(()=>{this.messages.shift()},kg)}),U.subscribe(Me,t=>{this.messages.push("Failed to load custom asset. Try to download it manually and then upload it."),setTimeout(()=>{this.messages.shift()},Ho)}),U.subscribe(Re,t=>{this.errors.push(t.message)}),U.subscribe(lt,t=>{this.messages.push(t.message),setTimeout(()=>{this.messages.shift()},Ho)}),U.subscribe(ts,t=>{this.messages.push(t.error.name),this.messages.push(JSON.stringify(t.error.stack)),this.messages.push(t.info),setTimeout(()=>{this.messages.shift(),this.messages.shift(),this.messages.shift()},Ho)})},methods:{onLoadingChange(t){t?(this.hideLoadingTimeout&&(clearTimeout(this.hideLoadingTimeout),this.hideLoadingTimeout=0),!this.showLoading&&!this.showLoadingTimeout&&(this.showLoadingTimeout=setTimeout(()=>{this.showLoading=!0,this.showLoadingTimeout=0},gn))):(this.showLoadingTimeout&&(clearTimeout(this.showLoadingTimeout),this.showLoadingTimeout=0),this.showLoading&&!this.hideLoadingTimeout&&(this.hideLoadingTimeout=setTimeout(()=>{this.showLoading=!1,this.hideLoadingTimeout=0},gn)))},dismissError(t){this.errors.splice(t,1)}},watch:{loading(t){this.onLoadingChange(t)}}}),Sg={key:0},jg=["onClick"];function Pg(t,e,o,s,n,i){return h(),g("div",{id:"messageConsole",class:W({vertical:t.vertical})},[t.showLoading?(h(),g("p",Sg,"Loading...")):j("",!0),(h(!0),g(_,null,E(t.messages,(r,l)=>(h(),g("p",{key:r+"_"+l},F(r),1))),128)),(h(!0),g(_,null,E(t.errors,(r,l)=>(h(),g("p",{class:"error",key:r+"_"+l},[C(F(r)+" ",1),a("a",{href:"#",onClick:d=>t.dismissError(l)},"[Dismiss]",8,jg)]))),128))],2)}var Tg=D(xg,[["render",Pg],["__scopeId","data-v-4ca8c332"]]);const _g=I({props:{canvasWidth:{default:0},canvasHeight:{default:0},preLoading:{type:Boolean}},data:()=>({sdCtx:null,currentlyRendering:!1,queuedRender:null,showingLast:!1,dropSpriteCount:0,dropPreventClick:!1,draggedObject:null,dragXOffset:0,dragYOffset:0,dragXOriginal:0,dragYOriginal:0}),computed:{selection(){return this.$store.state.ui.selection},lqRendering(){return this.$store.state.ui.lqRendering},sceneRender(){return new Oo(this.$store,this.$store.state.panels.currentPanel,this.bitmapWidth,this.bitmapHeight)},bitmapHeight(){return this.preLoading,P().Base.screenHeight},bitmapWidth(){return this.preLoading,P().Base.screenWidth},pickerMode(){return this.$store.state.ui.pickColor},cursor(){return this.pickerMode?"crosshair":"default"}},methods:{async download(){const t=await this.sceneRender.download();await this.vuexHistory.transaction(async()=>{const e=this.$store.state.ui.lastDownload;this.$store.commit("ui/setLastDownload",t),e&&URL.revokeObjectURL(e)})},invalidateRender(){this.queuedRender||(this.queuedRender=requestAnimationFrame(()=>this.render_()))},async render_(){this.queuedRender&&(cancelAnimationFrame(this.queuedRender),this.queuedRender=null),!this.$store.state.unsafe&&(await this.sceneRender.render(!this.lqRendering,!0),this.display())},renderLoadingScreen(){if(!this.sdCtx)return;const t=document.createElement("canvas");t.height=this.bitmapHeight,t.width=this.bitmapWidth,Ft.make(t,!0,!1).drawText({text:"Starting...",x:t.width/2,y:t.height/2,align:"center",outline:{width:5,style:"#b59"},font:"32px riffic",fill:{style:"white"}}),this.sdCtx.drawImage(t,this.canvasWidth,this.canvasHeight)},display(){!this.sdCtx||(this.showingLast=!1,this.sceneRender.paintOnto(this.sdCtx,{x:0,y:0,w:this.bitmapWidth,h:this.bitmapHeight}))},toRendererCoordinate(t,e){const o=this.$refs.sd,s=t-o.offsetLeft,n=e-o.offsetTop,i=s/o.offsetWidth*o.width,r=n/o.offsetWidth*o.width;return[i,r]},onUiClick(t){const[e,o]=this.toRendererCoordinate(t.clientX,t.clientY);if(this.pickerMode){const r=this.sdCtx.getImageData(e,o,1,1).data,l=`rgba(${r[0].toString()},${r[1].toString()},${r[2].toString()},${(r[3]/255).toString()})`;this.vuexHistory.transaction(()=>{this.$store.commit("ui/setColorPicker",!1),U.fire(new re(l))});return}if(this.dropPreventClick){this.dropPreventClick=!1;return}const s=this.sceneRender.objectsAt(e,o),n=s.findIndex(r=>r===this.selection);let i;n===0?i=null:n!==-1?i=s[n-1]:i=s[s.length-1]||null,this.$store.state.ui.selection!==i&&this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",i)})},onDragStart(t){if(t.preventDefault(),!this.selection)return;this.draggedObject=this.$store.state.objects.objects[this.selection];const[e,o]=this.toRendererCoordinate(t.clientX,t.clientY);this.dragXOffset=e-this.draggedObject.x,this.dragYOffset=o-this.draggedObject.y,this.dragXOriginal=this.draggedObject.x,this.dragYOriginal=this.draggedObject.y},onTouchStart(t){if(!this.selection)return;this.draggedObject=this.$store.state.objects.objects[this.selection];const[e,o]=this.toRendererCoordinate(t.touches[0].clientX,t.touches[0].clientY);this.dragXOffset=e-this.draggedObject.x,this.dragYOffset=o-this.draggedObject.y,this.dragXOriginal=this.draggedObject.x,this.dragYOriginal=this.draggedObject.y},onDragOver(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},onSpriteDragMove(t){if(this.draggedObject){t.preventDefault();let[e,o]=t instanceof MouseEvent?this.toRendererCoordinate(t.clientX,t.clientY):this.toRendererCoordinate(t.touches[0].clientX,t.touches[0].clientY);e-=this.dragXOffset,o-=this.dragYOffset;const s=Math.abs(e-this.dragXOriginal),n=Math.abs(o-this.dragYOriginal);s+n>1&&(this.dropPreventClick=!0),t.shiftKey&&(s>n?o=this.dragYOriginal:e=this.dragXOriginal),this.vuexHistory.transaction(()=>{this.$store.dispatch("objects/setPosition",{id:this.draggedObject.id,x:e,y:o})})}},async onDrop(t){if(t.stopPropagation(),t.preventDefault(),!!t.dataTransfer){for(const e of t.dataTransfer.items)if(e.kind==="file"&&e.type.match(/image.*/)){const o="dropCustomAsset"+ ++this.dropSpriteCount,s=ti(o,e.getAsFile());await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("objects/createSprite",{assets:[{hq:s,lq:s,sourcePack:"dddg.generated.uploaded-sprites"}]})})}}},onSpriteDrop(t){this.draggedObject&&("TouchEvent"in window&&t instanceof TouchEvent&&(this.dropPreventClick=!1),this.draggedObject=null)},onMouseEnter(t){t.buttons!==1&&(this.draggedObject=null)}},watch:{canvasWidth(){this.display()},canvasHeight(){this.display()}},async created(){U.subscribe(Qo,()=>this.invalidateRender()),this.$store.subscribe(t=>{t.type!=="panels/setPanelPreview"&&t.type!=="panels/currentPanel"&&this.invalidateRender()})},mounted(){const t=this.$refs.sd;this.sdCtx=t.getContext("2d"),this.renderLoadingScreen(),this.invalidateRender()}}),Bg=["height","width"];function Og(t,e,o,s,n,i){return h(),g("canvas",{id:"scaled_display",ref:"sd",height:t.bitmapHeight,width:t.bitmapWidth,style:K({width:t.canvasWidth+"px",height:t.canvasHeight+"px",cursor:t.cursor}),draggable:"true",onClick:e[0]||(e[0]=(...r)=>t.onUiClick&&t.onUiClick(...r)),onTouchstart:e[1]||(e[1]=(...r)=>t.onTouchStart&&t.onTouchStart(...r)),onDragstart:e[2]||(e[2]=(...r)=>t.onDragStart&&t.onDragStart(...r)),onTouchmove:e[3]||(e[3]=(...r)=>t.onSpriteDragMove&&t.onSpriteDragMove(...r)),onMousemove:e[4]||(e[4]=(...r)=>t.onSpriteDragMove&&t.onSpriteDragMove(...r)),onTouchend:e[5]||(e[5]=(...r)=>t.onSpriteDrop&&t.onSpriteDrop(...r)),onMouseup:e[6]||(e[6]=(...r)=>t.onSpriteDrop&&t.onSpriteDrop(...r)),onDragover:e[7]||(e[7]=(...r)=>t.onDragOver&&t.onDragOver(...r)),onDrop:e[8]||(e[8]=(...r)=>t.onDrop&&t.onDrop(...r)),onMouseenter:e[9]||(e[9]=(...r)=>t.onMouseEnter&&t.onMouseEnter(...r))},"HTML5 is required to use the Doki Doki Dialog Generator. ",44,Bg)}var Ig=D(_g,[["render",Og]]);const bn=16/9,Be=20,Dg=50,Hg=200,J="./",mn={"dddg.buildin.backgrounds.nsfw":`${J}packs/buildin.base.backgrounds.nsfw.json`,"dddg.buildin.sayori.nsfw":`${J}packs/buildin.base.sayori.nsfw.json`,"dddg.buildin.base.natsuki.nsfw":`${J}packs/buildin.base.natsuki.nsfw.json`,"dddg.buildin.yuri.nsfw":`${J}packs/buildin.base.yuri.nsfw.json`},Ag=new Set(Object.keys(mn)),Rg=Object.values(mn),Mg=I({components:{ToolBox:$g,MessageConsole:Tg,Render:Ig,ModalDialog:Ee,SingleBox:qo(()=>Zo(()=>import("./SingleBox.0e6917fe.js"),["assets/SingleBox.0e6917fe.js","assets/SingleBox.259db433.css","assets/vendor.cc880211.js"])),ExpressionBuilder:qo(()=>Zo(()=>import("./index.789e6179.js"),["assets/index.789e6179.js","assets/index.68199912.css","assets/vendor.cc880211.js"]))},data:()=>({canvasWidth:0,canvasHeight:0,blendOver:null,uiSize:192,currentlyRendering:!1,panel:"",dialogVisable:!1,canvasTooSmall:!1,expressionBuilderVisible:!1,expressionBuilderCharacter:"",expressionBuilderHeadGroup:void 0,systemPrefersDarkMode:!1,preLoading:!0}),computed:{isSafari(){return!1},useDarkTheme(){var t;return(t=this.userPrefersDarkMode)!=null?t:this.systemPrefersDarkMode},userPrefersDarkMode(){return this.$store.state.ui.useDarkTheme},nsfw(){return this.$store.state.ui.nsfw}},methods:{drawLastDownload(){const t=this.$store.state.ui.lastDownload;!t||this.$refs.render.blendOver(t)},setBlendOver(){this.blendOver=this.$store.state.ui.lastDownload},optimum(t,e){let o=t/bn,s=e*bn;return o>e?o=e:s=t,[s,o]},optimizeWithMenu(t,e){const o=this.optimum(t,e-this.uiSize),s=this.optimum(t-this.uiSize,e);return!this.isSafari&&o[0]*o[1]>s[0]*s[1]?[o[0],o[1],!1]:[s[0],s[1],!0]},updateArea(){const[t,e,o]=this.optimizeWithMenu(document.documentElement.clientWidth,document.documentElement.clientHeight);this.canvasWidth=t,this.canvasHeight=e,this.canvasTooSmall=Math.max(t,e)<Hg,this.$store.state.ui.vertical!==o&&this.$store.commit("ui/setVertical",o)},showDialog(t){if(this.dialogVisable=!0,t){const e=()=>{this.$refs.packDialog&&this.$refs.packDialog.$refs.packDialog?this.$refs.packDialog.$refs.packDialog.setSearch(t):setTimeout(e,Dg)};this.$nextTick(e)}},showExpressionDialog(t){this.expressionBuilderVisible=!0,this.expressionBuilderCharacter=t.character,this.expressionBuilderHeadGroup=t.headGroup},onKeydown(t){if(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement){console.log("skip keydown on potential target");return}this.vuexHistory.transaction(()=>{const e=this.$store.state.objects.objects[this.$store.state.ui.selection];if(t.ctrlKey){if(t.key==="z"){t.preventDefault();return}else if(t.key==="y"){t.preventDefault();return}else if(t.key==="v"){this.$store.dispatch("objects/pasteObjectFromClipboard",{}),t.preventDefault();return}}if(!e)return;if(t.key==="Delete"){this.$store.dispatch("objects/removeObject",{id:e.id});return}if(t.key==="c"||t.key==="x"){this.$store.dispatch("objects/copyObjectToClipboard",{id:e.id}),t.key==="x"&&this.$store.dispatch("objects/removeObject",{id:e.id}),t.preventDefault();return}if(e.type==="character"){const n=e;if(!n.freeMove){if(t.key==="ArrowLeft"){this.$store.dispatch("objects/shiftCharacterSlot",{id:n.id,delta:-1});return}if(t.key==="ArrowRight"){this.$store.dispatch("objects/shiftCharacterSlot",{id:n.id,delta:1});return}}}let{x:o,y:s}=e;if(t.key==="ArrowLeft")o-=t.shiftKey?1:Be;else if(e&&t.key==="ArrowRight")o+=t.shiftKey?1:Be;else if(e&&t.key==="ArrowUp")s-=t.shiftKey?1:Be;else if(e&&t.key==="ArrowDown")s+=t.shiftKey?1:Be;else return;this.$store.dispatch("objects/setPosition",{id:e.id,x:o,y:s})})},destroyed(){window.removeEventListener("keydown",this.onKeydown)},applyTheme(){document.body.classList.toggle("dark-theme",this.useDarkTheme)}},watch:{systemPrefersDarkMode(){this.applyTheme()},userPrefersDarkMode(){this.applyTheme()},async nsfw(t){t?await this.$store.dispatch("content/loadContentPacks",Rg):await this.$store.dispatch("removePacks",{packs:Ag})}},mounted(){if(window.addEventListener("keypress",t=>{t.key==="Escape"&&this.vuexHistory.transaction(()=>{this.$store.state.ui.selection!==null&&this.$store.commit("ui/setSelection",null)})}),window.matchMedia){const t=window.matchMedia("(prefers-color-scheme: dark)");this.systemPrefersDarkMode=t.matches,t.addListener(e=>{this.systemPrefersDarkMode=e.matches})}},async created(){this.updateArea(),mt.setStore(this.$store),window.addEventListener("resize",this.updateArea),window.removeEventListener("keydown",this.onKeydown),window.addEventListener("keydown",this.onKeydown),window.app=this,window.store=this.$store,window.env=R,document.body.addEventListener("drop",e=>{e.preventDefault()},!0),document.body.addEventListener("dragover",e=>{e.preventDefault()},!0),await R.loadGameMode(),this.preLoading=!1,R.connectToStore(this.vuexHistory,this.$store);const t=await R.loadSettings();await this.vuexHistory.transaction(async()=>{var e,o,s,n;this.$store.commit("ui/setLqRendering",(e=t.lq)!=null?e:!1),this.$store.commit("ui/setDarkTheme",(o=t.darkMode)!=null?o:null),this.$store.commit("ui/setDefaultCharacterTalkingZoom",(s=t.defaultCharacterTalkingZoom)!=null?s:!0),await this.$store.dispatch("content/loadContentPacks",[`${J}packs/buildin.base.backgrounds.json`,`${J}packs/buildin.base.monika.json`,`${J}packs/buildin.base.sayori.json`,`${J}packs/buildin.base.natsuki.json`,`${J}packs/buildin.base.yuri.json`,`${J}packs/buildin.extra.mc.json`,`${J}packs/buildin.extra.mc_chad.json`,`${J}packs/buildin.extra.mc_classic.json`,`${J}packs/buildin.extra.femc.json`,`${J}packs/buildin.extra.classic_amy.json`,`${J}packs/buildin.extra.amy.json`]),await this.$store.dispatch("panels/createPanel"),Object.keys(this.$store.state.objects.objects).length===0&&await this.$store.dispatch("objects/createTextBox",{}),await this.$store.commit("panels/setCurrentBackground",{current:"dddg.buildin.backgrounds:ddlc.clubroom",panelId:this.$store.state.panels.currentPanel}),await this.$store.commit("ui/setNsfw",(n=t.nsfw)!=null?n:!1)})}}),Wg={key:0},Ng={key:1,id:"app"},Vg={id:"container"},Fg=a("div",{id:"modal-messages"},null,-1);function Lg(t,e,o,s,n,i){const r=v("render"),l=v("message-console"),d=v("tool-box"),c=v("single-box"),u=v("modal-dialog"),p=v("expression-builder");return h(),g(_,null,[t.canvasTooSmall&&t.isSafari?(h(),g("div",Wg," Protrait mode is not supported by safari. Please turn the device sideways. ")):(h(),g("div",Ng,[a("div",Vg,[y(r,{ref:"render",canvasWidth:t.canvasWidth,canvasHeight:t.canvasHeight,preLoading:t.preLoading},null,8,["canvasWidth","canvasHeight","preLoading"])]),y(l),y(d,{onShowPrevRender:t.drawLastDownload,onDownload:e[0]||(e[0]=b=>t.$refs.render.download()),onShowDialog:t.showDialog,onShowExpressionDialog:t.showExpressionDialog},null,8,["onShowPrevRender","onShowDialog","onShowExpressionDialog"]),(h(),k(Dn,null,[t.dialogVisable?(h(),k(u,{key:0,ref:"dialog",onLeave:e[2]||(e[2]=b=>t.dialogVisable=!1)},{default:w(()=>[y(c,{ref:"packDialog",onLeave:e[1]||(e[1]=b=>t.dialogVisable=!1)},null,512)]),_:1},512)):j("",!0)],1024)),t.expressionBuilderVisible?(h(),k(u,{key:0,ref:"dialog",onLeave:e[4]||(e[4]=b=>t.expressionBuilderVisible=!1)},{default:w(()=>[y(p,{character:t.expressionBuilderCharacter,initHeadGroup:t.expressionBuilderHeadGroup,onLeave:e[3]||(e[3]=b=>t.expressionBuilderVisible=!1)},null,8,["character","initHeadGroup"])]),_:1},512)):j("",!0)])),Fg],64)}var Eg=D(Mg,[["render",Lg]]);const zg={};let Ug=0;const Xg={async createSprite({commit:t,rootState:e},o){const s=await Ot(o.assets[0],!1);s instanceof HTMLImageElement&&t("create",{object:S(m({},Rt()),{assets:o.assets,height:s.height,width:s.width,id:"sprite_"+ ++Ug,panelId:e.panels.currentPanel,onTop:!1,preserveRatio:!0,ratio:s.width/s.height,type:"sprite",y:0,enlargeWhenTalking:e.ui.defaultCharacterTalkingZoom})})}},Gg={setChoices(t,e){const o=t.objects[e.id];o.choices=e.choices,++o.version},setChoiceColor(t,e){const o=t.objects[e.id];o.customColor=e.customColor,++o.version},setChoiceDistance(t,e){const o=t.objects[e.id];o.choiceDistance=e.choiceDistance,++o.version},setAutoWrapping(t,e){const o=t.objects[e.id];o.autoWrap=e.autoWrap,++o.version}};let Yg=0;const qg={createChoice({commit:t,rootState:e},o){const s=P(),n="choice_"+ ++Yg;return t("create",{object:S(m({},Rt()),{y:s.Choices.ChoiceY,width:s.Choices.ChoiceButtonWidth,height:0,panelId:e.panels.currentPanel,id:n,onTop:!0,autoWrap:!0,type:"choice",preserveRatio:!1,ratio:s.TextBox.TextBoxWidth/s.TextBox.TextBoxHeight,choiceDistance:s.Choices.ChoiceSpacing,choices:[{selected:!1,text:"Click here to edit choice"}],customColor:s.Choices.ChoiceButtonColor})}),n},addChoice({state:t,commit:e},o){const s=t.objects[o.id];e("setChoices",{id:o.id,choices:[...s.choices,{selected:!1,text:o.text}]})},removeChoice({state:t,commit:e},o){const n=[...t.objects[o.id].choices];!n[o.choiceIdx]||(n.splice(o.choiceIdx,1),n.length===0&&n.push({selected:!1,text:""}),e("setChoices",{id:o.id,choices:n}))},setChoiceText({state:t,commit:e},o){const n=[...t.objects[o.id].choices];!n[o.choiceIdx]||(n[o.choiceIdx].text=o.text,e("setChoices",{id:o.id,choices:n}))}};function yn(t,e,o){return t>e?t:e>o?o:e}const vn=4,Kg={setText(t,e){const o=t.objects[e.id];o.text=e.text,++o.version},setTalkingObject(t,e){const o=t.objects[e.id];o.talkingObjId=e.talkingObjId,++o.version},setTalkingOther(t,e){const o=t.objects[e.id];o.talkingOther=e.talkingOther,o.talkingObjId="$other$",++o.version},setStyle(t,e){const o=t.objects[e.id];o.style=e.style,++o.version},setControlsVisible(t,e){const o=t.objects[e.id];o.controls=e.controls,++o.version},setControlsColor(t,e){const o=t.objects[e.id];o.customControlsColor=e.customControlsColor,++o.version},setDeriveCustomColors(t,e){const o=t.objects[e.id];o.deriveCustomColors=e.deriveCustomColors,++o.version},setNameboxColor(t,e){const o=t.objects[e.id];o.customNameboxColor=e.customNameboxColor,++o.version},setNameboxStroke(t,e){const o=t.objects[e.id];o.customNameboxStroke=e.customNameboxStroke,++o.version},setNameboxWidth(t,e){const o=t.objects[e.id];o.customNameboxWidth=e.customNameboxWidth,++o.version},setSkipable(t,e){const o=t.objects[e.id];o.skip=e.skip,++o.version},setContinueArrow(t,e){const o=t.objects[e.id];o.continue=e.continue,++o.version},setCustomColor(t,e){const o=t.objects[e.id];o.customColor=e.color,++o.version},setAutoQuoting(t,e){const o=t.objects[e.id];o.autoQuoting=e.autoQuoting,++o.version},setAutoWrapping(t,e){const o=t.objects[e.id];o.autoWrap=e.autoWrap,++o.version},setResetBounds(t,e){const o=t.objects[e.id];o.resetBounds=e.resetBounds,o.x=e.resetBounds.x,o.y=e.resetBounds.y,o.height=e.resetBounds.height,o.width=e.resetBounds.width,o.rotation=e.resetBounds.rotation,++o.version},setColorOverride(t,e){const o=t.objects[e.id];o.overrideColor=e.overrideColor,++o.version}};let Jg=0;const Zg={createTextBox({commit:t,rootState:e},o){const s=P(),n="textBox_"+ ++Jg,i=s.TextBox.DefaultTextboxStyle,r=Gt[i],l=o.resetBounds||{x:r.defaultX,y:r.defaultY,width:r.defaultWidth,height:r.defaultHeight,rotation:0};return t("create",{object:S(m(m({},Rt()),l),{panelId:e.panels.currentPanel,id:n,onTop:!0,type:"textBox",preserveRatio:!1,ratio:s.TextBox.TextBoxWidth/s.TextBox.TextBoxHeight,continue:!0,controls:!0,skip:!0,autoQuoting:!0,autoWrap:!0,style:i,overrideColor:!1,customColor:s.TextBoxCustom.textboxDefaultColor,deriveCustomColors:!0,customControlsColor:s.TextBoxCustom.controlsDefaultColor,customNameboxColor:s.TextBoxCustom.nameboxDefaultColor,customNameboxWidth:null,customNameboxStroke:s.TextBoxCustom.nameboxStrokeDefaultColor,talkingObjId:null,talkingOther:"",text:"",resetBounds:l})}),n},setStyle({state:t,commit:e},o){const s=P(),n=t.objects[o.id],i=Gt[n.style],r=Gt[o.style],l=10;let d=!1;const c={id:o.id,x:n.x,y:n.y};let u=!1;const p={id:o.id,width:n.width,height:n.height};r.resizable?(i.defaultWidth!==r.defaultWidth&&(u=!0,p.width=Math.max(p.width+r.defaultWidth-i.defaultWidth,l)),i.defaultHeight!==r.defaultHeight&&(u=!0,p.height=Math.max(p.height+r.defaultHeight-i.defaultHeight,l))):(u=!0,p.width=r.defaultWidth,p.height=r.defaultHeight),i.defaultX!==r.defaultX&&(d=!0,c.x=yn(-p.width+l,c.x+r.defaultX-i.defaultX,s.Base.screenWidth-l)),i.defaultY!==r.defaultY&&(d=!0,c.y=yn(-p.height+l,c.y+r.defaultY-i.defaultY,s.Base.screenHeight-l)),d&&e("setPosition",c),u&&e("setSize",p),e("setStyle",{id:o.id,style:o.style})},resetTextboxBounds({commit:t,state:e},o){const s=e.objects[o.id];t("setPosition",{id:o.id,x:s.resetBounds.x,y:s.resetBounds.y}),t("setSize",{id:o.id,height:s.resetBounds.height,width:s.resetBounds.width}),t("setRotation",{id:o.id,rotation:s.resetBounds.rotation})},async splitTextbox({commit:t,state:e,dispatch:o},s){const n=e.objects[s.id],i=(n.width-vn)/2,r=i/2+vn/2,l=[n.x,n.y];let d=[n.x-r,n.y],c=[n.x+r,n.y];n.rotation!==0&&(d=Ce(d[0],d[1],l[0],l[1],n.rotation/180*Math.PI),c=Ce(c[0],c[1],l[0],l[1],n.rotation/180*Math.PI)),t("setResetBounds",{id:s.id,resetBounds:{x:d[0],y:d[1],width:i,height:n.height,rotation:n.rotation}}),t("setStyle",{id:s.id,style:"custom"});const u=await o("createTextBox",{resetBounds:{x:c[0],y:c[1],width:i,height:n.height,rotation:n.rotation}});t("setStyle",{id:u,style:"custom"}),n.flip&&t("setFlip",{id:u,flip:n.flip})}},Qg={setNotificationColor(t,e){const o=t.objects[e.id];o.customColor=e.customColor,++o.version},setNotificationText(t,{id:e,text:o}){const s=t.objects[e];s.text=o,++s.version},setNotificationBackdrop(t,{id:e,backdrop:o}){const s=t.objects[e];s.backdrop=o,++s.version},setAutoWrapping(t,e){const o=t.objects[e.id];o.autoWrap=e.autoWrap,++o.version}};let tb=0;const eb={createNotification({commit:t,rootState:e},o){const s=P(),n="notification_"+ ++tb;return t("create",{object:S(m({},Rt()),{y:s.Base.screenHeight/2,width:s.Choices.ChoiceButtonWidth,height:0,panelId:e.panels.currentPanel,autoWrap:!1,id:n,onTop:!0,type:"notification",preserveRatio:!1,ratio:s.TextBox.TextBoxWidth/s.TextBox.TextBoxHeight,customColor:s.Choices.ChoiceButtonColor,text:"Click here to edit notification",backdrop:!0})}),n}},ob={setPoemBackground(t,{id:e,background:o}){const s=t.objects[e];s.background=o,++s.version},setPoemFont(t,{id:e,font:o}){const s=t.objects[e];s.font=o,++s.version},setPoemText(t,{id:e,text:o}){const s=t.objects[e];s.text=o,++s.version},setAutoWrapping(t,e){const o=t.objects[e.id];o.autoWrap=e.autoWrap,++o.version}};let wn=0;const sb={createPoem({commit:t,rootState:e},o){const s=P(),n="poem_"+ ++wn;return t("create",{object:{subType:"poem",x:s.Poem.defaultX,y:s.Poem.defaultY,width:s.Poem.defaultPoemWidth,height:s.Poem.defaultPoemHeight,panelId:e.panels.currentPanel,flip:!1,rotation:0,id:n,onTop:!0,opacity:100,type:"poem",version:0,preserveRatio:!1,autoWrap:!0,ratio:s.Poem.defaultPoemWidth/s.Poem.defaultPoemHeight,background:s.Poem.defaultPoemBackground,font:s.Poem.defaultPoemStyle,text:`New poem

Click here to edit poem`,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!0,nameboxWidth:null,zoom:1}}),n},createConsole({commit:t,rootState:e},o){const s=P(),n="poem_"+ ++wn;return t("create",{object:S(m({},Rt()),{subType:"console",x:s.Poem.consoleWidth/2,y:s.Poem.consoleHeight/2,width:s.Poem.consoleWidth,height:s.Poem.consoleHeight,panelId:e.panels.currentPanel,id:n,onTop:!0,type:"poem",preserveRatio:!1,ratio:s.Poem.consoleWidth/s.Poem.consoleHeight,background:s.Poem.defaultConsoleBackground,font:s.Poem.defaultConsoleStyle,text:`> _
  
  Console command
  Click here to edit`,autoWrap:!0})}),n}};let Cn=0;var nb={namespaced:!0,state:{objects:{},panels:{}},mutations:m(m(m(m(m(m({create(t,{object:e}){t.panels[e.panelId]||(t.panels[e.panelId]={id:e.panelId,onTopOrder:[],order:[]});const o=t.panels[e.panelId],s=e.onTop?o.onTopOrder:o.order;t.objects[e.id]=e,s.push(e.id)},removeFromList(t,e){const o=t.objects[e.id],s=t.panels[o.panelId],n=e.onTop?s.onTopOrder:s.order,i=n.indexOf(e.id);n.splice(i,1)},addToList(t,e){const o=t.objects[e.id],s=t.panels[o.panelId];(e.onTop?s.onTopOrder:s.order).splice(e.position,0,e.id)},setOnTop(t,e){const o=t.objects[e.id];o.onTop=e.onTop},setPosition(t,e){const o=t.objects[e.id];o.x=e.x,o.y=e.y},setFlip(t,e){const o=t.objects[e.id];o.flip=e.flip},setSize(t,e){const o=t.objects[e.id];o.width=e.width,o.height=e.height},setRatio(t,e){const o=t.objects[e.id];o.preserveRatio=e.preserveRatio,o.ratio=e.ratio},setRotation(t,e){const o=t.objects[e.id];o.rotation=e.rotation<0?360-Math.abs(e.rotation)%360:e.rotation%360},removeObject(t,e){const o=t.objects[e.id];delete t.objects[e.id];const s=t.panels[o.panelId];s.onTopOrder.length===0&&s.order.length===0&&delete t.panels[o.panelId]},setComposition(t,e){const o=t.objects[e.id];o.composite=e.composite},setFilters(t,e){const o=t.objects[e.id];o.filters=e.filters},setLabel(t,e){const o=t.objects[e.id];o.label=e.label},setTextboxColor(t,e){const o=t.objects[e.id];o.textboxColor=e.textboxColor},setEnlargeWhenTalking(t,e){const o=t.objects[e.id];o.enlargeWhenTalking=e.enlargeWhenTalking,++o.version},setObjectNameboxWidth(t,e){const o=t.objects[e.id];o.nameboxWidth=e.nameboxWidth,++o.version},setObjectZoom(t,e){const o=t.objects[e.id];o.zoom=e.zoom,++o.version}},zg),Rl),Kg),Gg),Qg),ob),actions:m(m(m(m(m(m({removeObject({state:t,commit:e,rootState:o},s){const n=t.objects[s.id],i=t.panels[n.panelId];o.ui.selection===s.id&&e("ui/setSelection",null,{root:!0});for(const r of[...i.onTopOrder,...i.order]){const l=t.objects[r];n.id===r||l.type!=="textBox"||l.talkingObjId===n.id&&e("setTalkingOther",{id:l.id,talkingOther:n.label||""})}e("removeFromList",{id:s.id,onTop:n.onTop}),e("removeObject",{id:s.id})},setPosition({state:t,commit:e,dispatch:o},s){t.objects[s.id].type==="character"?o("setCharacterPosition",s):e("setPosition",s)},setOnTop({state:t,commit:e},o){const s=t.objects[o.id],n=t.panels[s.panelId];s.onTop!==o.onTop&&(e("removeFromList",{id:o.id,onTop:s.onTop}),e("addToList",{id:o.id,position:(o.onTop?n.onTopOrder:n.order).length,onTop:o.onTop}),e("setOnTop",{id:o.id,onTop:o.onTop}))},shiftLayer({state:t,commit:e},o){const s=t.objects[o.id],n=t.panels[s.panelId],i=s.onTop?n.onTopOrder:n.order;let l=i.indexOf(s.id)+o.delta;l<0&&(l=0),l>i.length&&(l=i.length),e("removeFromList",{id:o.id,onTop:s.onTop}),e("addToList",{id:o.id,position:l,onTop:s.onTop})},setPreserveRatio({commit:t,state:e},o){const s=e.objects[o.id],n=o.preserveRatio?s.width/s.height:0;t("setRatio",{id:o.id,preserveRatio:o.preserveRatio,ratio:n})},setWidth({commit:t,state:e},o){const s=e.objects[o.id],n=s.preserveRatio?o.width/s.ratio:s.height;t("setSize",{id:o.id,height:n,width:o.width})},setHeight({commit:t,state:e},o){const s=e.objects[o.id],n=s.preserveRatio?o.height*s.ratio:s.width;t("setSize",{id:o.id,height:o.height,width:n})},fixContentPackRemoval(t,e){Object.values(t.state.objects).map(o=>{switch(o.type){case"character":Vl(t,o.id,e);return;case"sprite":return;case"textBox":return}})},copyObjects({commit:t,state:e},{sourcePanelId:o,targetPanelId:s}){const n=e.panels[o];if(!n)return;const i=[...n.onTopOrder,...n.order],r=new Map;for(const l of i){const d=`copy_${++Cn}`;r.set(l,d)}for(const l of i){const d=e.objects[l],c=JSON.parse(JSON.stringify(d));if("talkingObjId"in c){const u=c;u.talkingObjId!==null&&r.has(u.talkingObjId)&&(u.talkingObjId=r.get(u.talkingObjId))}t("create",{object:S(m({},c),{id:r.get(l),panelId:s})})}},copyObjectToClipboard({commit:t,state:e},{id:o}){const s=e.objects[o];t("ui/setClipboard",JSON.stringify(s),{root:!0})},pasteObjectFromClipboard({commit:t,rootState:e}){if(!e.ui.clipboard)return;const o=JSON.parse(e.ui.clipboard);t("create",{object:S(m({},o),{id:`copy_${++Cn}`,panelId:e.panels.currentPanel})})},deleteAllOfPanel({state:t,dispatch:e},{panelId:o}){const s=t.panels[o];for(const n of[...s.onTopOrder,...s.order])e("removeObject",{id:n})},addFilter({state:t,commit:e},o){xo(o,s=>t.objects[s],s=>e("setFilters",s))},removeFilter({state:t,commit:e},o){So(o,s=>t.objects[s],s=>e("setFilters",s))},moveFilter({state:t,commit:e},o){jo(o,s=>t.objects[s],s=>e("setFilters",s))},setFilter({state:t,commit:e},o){Po(o,s=>t.objects[s],s=>e("setFilters",s))}},Xg),Nl),Zg),qg),eb),sb)},ib={namespaced:!0,state:{vertical:!1,lqRendering:!0,nsfw:!1,selection:null,lastDownload:null,clipboard:null,useDarkTheme:null,defaultCharacterTalkingZoom:!0,pickColor:!1},mutations:{setVertical(t,e){t.vertical=e},setNsfw(t,e){t.nsfw=e},setLqRendering(t,e){t.lqRendering=e},setSelection(t,e){t.selection=e},setLastDownload(t,e){t.lastDownload=e},setClipboard(t,e){t.clipboard=e},setDarkTheme(t,e){t.useDarkTheme=e},setDefaultCharacterTalkingZoom(t,e){t.defaultCharacterTalkingZoom=e},setColorPicker(t,e){t.pickColor=e}}};function Ao(t,e){return{backgrounds:rb(t.backgrounds,e.backgrounds),characters:lb(t.characters,e.characters),dependencies:Ro(t.dependencies,e.dependencies),fonts:at(t.fonts,e.fonts,o=>o.id,(o,s)=>S(m({},o),{files:Ro(o.files,s.files)})),poemStyles:at(t.poemStyles,e.poemStyles,o=>o.label,()=>{throw new Error}),poemBackgrounds:[...t.poemBackgrounds,...e.poemBackgrounds],sprites:at(t.sprites,e.sprites,o=>o.id,(o,s)=>({id:o.id,label:o.label,variants:[...o.variants,...s.variants],defaultScale:o.defaultScale,hd:o.hd,sdVersion:o.sdVersion||s.sdVersion})),colors:at(t.colors,e.colors,o=>o.color,o=>o)}}function rb(t,e){return at(t,e,o=>o.id,ab)}function ab(t,e){return{id:t.id,label:t.label,variants:[...t.variants,...e.variants],scaling:t.scaling,sdVersion:t.sdVersion||e.sdVersion}}function lb(t,e){return at(t,e,o=>o.id,db)}function db(t,e){return{chibi:t.chibi,id:t.id,label:t.label,heads:hb(t.heads,e.heads),defaultScale:t.defaultScale,hd:t.hd,size:t.size,sdVersion:t.sdVersion,styleGroups:at(t.styleGroups,e.styleGroups,o=>o.id,(o,s)=>({id:o.id,styleComponents:at(o.styleComponents,s.styleComponents,n=>n.id,(n,i)=>({id:n.id,label:n.label,variants:cb(n.variants,i.variants)})),styles:at(o.styles,s.styles,n=>JSON.stringify(n.components),(n,i)=>({components:n.components,poses:at(n.poses,i.poses,r=>r.id,ub)}))}))}}function cb(t,e){const o=m({},t);for(const s in e)!e.hasOwnProperty(s)||o.hasOwnProperty(s)||(o[s]=e[s]);return o}function ub(t,e){const o=m({},t.positions);for(const s in e.positions)o[s]?o[s]=[...o[s],...e.positions[s]]:o[s]=e.positions[s];return{id:t.id,compatibleHeads:Ro(t.compatibleHeads,e.compatibleHeads),previewOffset:t.previewOffset,previewSize:t.previewSize,scale:t.scale,size:t.size,renderCommands:t.renderCommands,positions:o}}function hb(t,e){const o=m({},t);for(const s in e){if(!e.hasOwnProperty(s))continue;const n=e[s];if(o[s]){const i=o[s];o[s]={previewOffset:i.previewOffset,previewSize:i.previewSize,variants:[...i.variants,...n.variants]}}else o[s]=n}return o}function Ro(t,e){const o=[...t];for(const s of e)o.includes(s)||o.push(s);return o}function at(t,e,o,s){const n=[...t],i=new Map(t.map((r,l)=>[o(r),l]));for(const r of e){const l=o(r);if(i.has(l)){const d=i.get(l),c=n[d];n.splice(d,1,s(c,r))}else i.set(l,n.length),n.push(r)}return n}function $n(t){return t.split("/").slice(0,-1).join("/")+"/"}const kn=new Set(["png","gif","bmp","svg"]);var pb={namespaced:!0,state:{contentPacks:[],current:{dependencies:[],backgrounds:[],characters:[],fonts:[],poemStyles:[],poemBackgrounds:[],sprites:[],colors:[]}},mutations:{setContentPacks(t,e){t.contentPacks=e},setCurrentContent(t,e){t.current=e}},actions:{async contentPack({commit:t,state:e},o){const s=await Sn(o),n=new Set(e.contentPacks.map(i=>i.packId));for(const i of o.dependencies)if(!n.has(i))throw new Error(`Missing dependency '${i}'. Refusing to install ${o.packId}`);t("setContentPacks",[...e.contentPacks,s]),t("setCurrentContent",Ao(e.current,s))},async removeContentPacks({commit:t,state:e},o){const s=xn(e.contentPacks.filter(n=>!o.has(n.packId)));t("setContentPacks",s),t("setCurrentContent",s.reduce((n,i)=>Ao(n,i)))},async replaceContentPack({commit:t,state:e},o){const s=o.processed?o.contentPack:await Sn(o.contentPack);let n=e.contentPacks;const i=n.findIndex(r=>r.packId===o.contentPack.packId);i===-1?n.push(s):n.splice(i,1,s),n=xn(n),t("setContentPacks",n),t("setCurrentContent",n.reduce((r,l)=>Ao(r,l)))},async loadContentPacks({dispatch:t},e){typeof e=="string"&&(e=[e]);const o=await Promise.all(e.map(async s=>{const n=await fetch(s);n.ok||Mo(`Could not load content pack. Server responded with: ${n.statusText}`);let i;try{i=await n.json()}catch{Mo("Content pack is not valid json!")}let r;try{const l={"./":$n(s),"/":$n(location.href)+"assets/"};i.version==="2.0"?r=Hn(i,l):r=An(Rn(i,l),l,!1)}catch(l){Mo("Content pack is not in a valid format!",l)}return r}));for(const s of o)await t("contentPack",s);return o.map(s=>s.packId)}},getters:{getCharacters({current:t}){const e=new Map;for(const o of t.characters)e.set(o.id,o);return e},getBackgrounds({current:t}){const e=new Map;for(const o of t.backgrounds)e.set(o.id,o);return e}}};function xn(t){return t}async function Sn(t){const e=new Set(await Bt()?["webp",...kn]:kn),o=new Map([["ext","{lq:.lq:}.{format:webp:webp:png:png}"]]);return Mn(t,(s,n)=>{const i=Ko(s,o,e,!1),r=Ko(s,o,e,!0);return{hq:i,lq:r,sourcePack:t.packId||"buildIn"}})}function Mo(t,e){throw console.error(t,e),new Error(t)}var fb=Wn({state:{unsafe:!1},mutations:{setUnsafe(t,e){t.unsafe=e}},actions:{async removePacks({dispatch:t,commit:e,state:o},{packs:s}){const n=JSON.parse(JSON.stringify(o.content.current));e("setUnsafe",!0),await t("content/removeContentPacks",s),await t("panels/fixContentPackRemoval",n),await t("objects/fixContentPackRemoval",n),e("setUnsafe",!1)}},modules:{objects:nb,ui:ib,panels:of,content:pb}}),gb={install(t,e={}){if(!t.config.globalProperties.$store)throw new Error("VuexUndoRedo plugin must be installed after the Vuex plugin.");e.resetStateMutation||(e.resetStateMutation="emptyState"),e.mutations||(e.mutations={});const o=t.config.globalProperties.$store;function s(c,u){let p={};switch(typeof u.payload){case"object":u.payload instanceof Array&&(p=[]),o.commit(`${u.type}`,Object.assign(p,u.payload));break;default:o.commit(`${u.type}`,u.payload)}}async function n(c,u){return await c.transaction(()=>{u.forEach(p=>{s(c,p)})})}async function i(c){const u=c.data.done.slice(0);c.data.done=[],o.commit(e.resetStateMutation);for(let p=0;p<u.length;++p)await n(c,u[p])}const r={};function l(c){if(!r[c]){const u=c.split("/"),p={ignore:T=>!1,combinable:(T,x)=>!1,combinator:(T,x)=>x};let b="";for(const T of u)e.mutations[b+"*"]&&Object.assign(p,e.mutations[b+"*"]),b+=T+"/";e.mutations[c]&&Object.assign(p,e.mutations[c]),r[c]=p}return r[c]}const d={data:Jt({done:[],undone:[],newMutation:!0,ignoreMutations:e.ignoreMutations||[],currentTransaction:null,transactionQueue:[],initialized:!1}),initialize(){d.initialized||(d.initialized=!0,o.subscribe(c=>{const u=()=>{c.type===e.resetStateMutation||l(c.type).ignore(c)||(d.currentTransaction.push(c),d.newMutation&&(d.data.undone=[]))};d.currentTransaction?u():d.transaction(()=>{u()})}))},redo(){if(d.data.undone.length<=0)return;const c=d.data.undone.pop();d.newMutation=!1,n(d,c),d.newMutation=!0},async undo(){d.data.done.length<=0||(d.data.undone.push(d.data.done.pop()),d.newMutation=!1,await i(d),d.newMutation=!0)},transaction(c){return new Promise((u,p)=>{const b=async()=>{d.currentTransaction=[];try{await c()}catch(x){console.log("Error during transaction!: ",x)}const T=d.data.done[d.data.done.length-1];if(d.currentTransaction.length===1&&T&&T.length===1){const x=l(d.currentTransaction[0].type);if(x.combinable(T[0],d.currentTransaction[0])){const $=x.combinator(T[0],d.currentTransaction[0]);d.data.done.pop(),$?d.currentTransaction=[$]:d.currentTransaction=[]}}d.currentTransaction.length>0&&d.data.done.push(d.currentTransaction),d.currentTransaction=null,d.data.transactionQueue.length>0&&d.data.transactionQueue.pop()(),u()};d.currentTransaction?d.data.transactionQueue.push(b):b()})}};t.config.globalProperties.vuexHistory=d,d.initialize()}};Nn(Eg).use(fb).use(gb).mount("#app");export{Tp as B,af as C,is as D,ze as L,mt as R,nt as T,ts as V,D as _,U as a,De as b,rt as c,Lt as d,R as e,Fe as g};
