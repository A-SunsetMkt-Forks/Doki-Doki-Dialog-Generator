var hu=Object.defineProperty;var pu=(e,t,o)=>t in e?hu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var v=(e,t,o)=>(pu(e,typeof t!="symbol"?t+"":t,o),o);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=o(s);fetch(s.href,i)}})();function dr(e,t){const o=Object.create(null),n=e.split(",");for(let s=0;s<n.length;s++)o[n[s]]=!0;return t?s=>!!o[s.toLowerCase()]:s=>!!o[s]}const gu="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",mu=dr(gu);function Fl(e){return!!e||e===""}function Ae(e){if(U(e)){const t={};for(let o=0;o<e.length;o++){const n=e[o],s=Be(n)?vu(n):Ae(n);if(s)for(const i in s)t[i]=s[i]}return t}else{if(Be(e))return e;if(Pe(e))return e}}const bu=/;(?![^(]*\))/g,yu=/:(.+)/;function vu(e){const t={};return e.split(bu).forEach(o=>{if(o){const n=o.split(yu);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t}function le(e){let t="";if(Be(e))t=e;else if(U(e))for(let o=0;o<e.length;o++){const n=le(e[o]);n&&(t+=n+" ")}else if(Pe(e))for(const o in e)e[o]&&(t+=o+" ");return t.trim()}function wu(e,t){if(e.length!==t.length)return!1;let o=!0;for(let n=0;o&&n<e.length;n++)o=An(e[n],t[n]);return o}function An(e,t){if(e===t)return!0;let o=Sa(e),n=Sa(t);if(o||n)return o&&n?e.getTime()===t.getTime():!1;if(o=U(e),n=U(t),o||n)return o&&n?wu(e,t):!1;if(o=Pe(e),n=Pe(t),o||n){if(!o||!n)return!1;const s=Object.keys(e).length,i=Object.keys(t).length;if(s!==i)return!1;for(const r in e){const a=e.hasOwnProperty(r),l=t.hasOwnProperty(r);if(a&&!l||!a&&l||!An(e[r],t[r]))return!1}}return String(e)===String(t)}function cr(e,t){return e.findIndex(o=>An(o,t))}const he=e=>e==null?"":U(e)||Pe(e)&&(e.toString===Wl||!Q(e.toString))?JSON.stringify(e,Ll,2):String(e),Ll=(e,t)=>t&&t.__v_isRef?Ll(e,t.value):Do(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((o,[n,s])=>(o[`${n} =>`]=s,o),{})}:Go(t)?{[`Set(${t.size})`]:[...t.values()]}:Pe(t)&&!U(t)&&!Vl(t)?String(t):t,me={},Eo=[],rt=()=>{},Cu=()=>!1,$u=/^on[^a-z]/,Is=e=>$u.test(e),ur=e=>e.startsWith("onUpdate:"),Ee=Object.assign,fr=(e,t)=>{const o=e.indexOf(t);o>-1&&e.splice(o,1)},ku=Object.prototype.hasOwnProperty,ae=(e,t)=>ku.call(e,t),U=Array.isArray,Do=e=>Ts(e)==="[object Map]",Go=e=>Ts(e)==="[object Set]",Sa=e=>e instanceof Date,Q=e=>typeof e=="function",Be=e=>typeof e=="string",hr=e=>typeof e=="symbol",Pe=e=>e!==null&&typeof e=="object",Nl=e=>Pe(e)&&Q(e.then)&&Q(e.catch),Wl=Object.prototype.toString,Ts=e=>Wl.call(e),_u=e=>Ts(e).slice(8,-1),Vl=e=>Ts(e)==="[object Object]",pr=e=>Be(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,ns=dr(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Os=e=>{const t=Object.create(null);return o=>t[o]||(t[o]=e(o))},Su=/-(\w)/g,vt=Os(e=>e.replace(Su,(t,o)=>o?o.toUpperCase():"")),xu=/\B([A-Z])/g,bo=Os(e=>e.replace(xu,"-$1").toLowerCase()),Bs=Os(e=>e.charAt(0).toUpperCase()+e.slice(1)),oi=Os(e=>e?`on${Bs(e)}`:""),_n=(e,t)=>!Object.is(e,t),Ho=(e,t)=>{for(let o=0;o<e.length;o++)e[o](t)},cs=(e,t,o)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:o})},Sn=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let xa;const Pu=()=>xa||(xa=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let so;const Un=[];class ju{constructor(t=!1){this.active=!0,this.effects=[],this.cleanups=[],!t&&so&&(this.parent=so,this.index=(so.scopes||(so.scopes=[])).push(this)-1)}run(t){if(this.active)try{return this.on(),t()}finally{this.off()}}on(){this.active&&(Un.push(this),so=this)}off(){this.active&&(Un.pop(),so=Un[Un.length-1])}stop(t){if(this.active){if(this.effects.forEach(o=>o.stop()),this.cleanups.forEach(o=>o()),this.scopes&&this.scopes.forEach(o=>o.stop(!0)),this.parent&&!t){const o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.active=!1}}}function Iu(e,t){t=t||so,t&&t.active&&t.effects.push(e)}const gr=e=>{const t=new Set(e);return t.w=0,t.n=0,t},zl=e=>(e.w&Kt)>0,Ul=e=>(e.n&Kt)>0,Tu=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=Kt},Ou=e=>{const{deps:t}=e;if(t.length){let o=0;for(let n=0;n<t.length;n++){const s=t[n];zl(s)&&!Ul(s)?s.delete(e):t[o++]=s,s.w&=~Kt,s.n&=~Kt}t.length=o}},Pi=new WeakMap;let dn=0,Kt=1;const ji=30,sn=[];let uo;const fo=Symbol(""),Ii=Symbol("");class mr{constructor(t,o=null,n){this.fn=t,this.scheduler=o,this.active=!0,this.deps=[],Iu(this,n)}run(){if(!this.active)return this.fn();if(!sn.includes(this))try{return sn.push(uo=this),Bu(),Kt=1<<++dn,dn<=ji?Tu(this):Pa(this),this.fn()}finally{dn<=ji&&Ou(this),Kt=1<<--dn,yo(),sn.pop();const t=sn.length;uo=t>0?sn[t-1]:void 0}}stop(){this.active&&(Pa(this),this.onStop&&this.onStop(),this.active=!1)}}function Pa(e){const{deps:t}=e;if(t.length){for(let o=0;o<t.length;o++)t[o].delete(e);t.length=0}}let Lo=!0;const br=[];function Xo(){br.push(Lo),Lo=!1}function Bu(){br.push(Lo),Lo=!0}function yo(){const e=br.pop();Lo=e===void 0?!0:e}function Ye(e,t,o){if(!Gl())return;let n=Pi.get(e);n||Pi.set(e,n=new Map);let s=n.get(o);s||n.set(o,s=gr()),Xl(s)}function Gl(){return Lo&&uo!==void 0}function Xl(e,t){let o=!1;dn<=ji?Ul(e)||(e.n|=Kt,o=!zl(e)):o=!e.has(uo),o&&(e.add(uo),uo.deps.push(e))}function Et(e,t,o,n,s,i){const r=Pi.get(e);if(!r)return;let a=[];if(t==="clear")a=[...r.values()];else if(o==="length"&&U(e))r.forEach((l,d)=>{(d==="length"||d>=n)&&a.push(l)});else switch(o!==void 0&&a.push(r.get(o)),t){case"add":U(e)?pr(o)&&a.push(r.get("length")):(a.push(r.get(fo)),Do(e)&&a.push(r.get(Ii)));break;case"delete":U(e)||(a.push(r.get(fo)),Do(e)&&a.push(r.get(Ii)));break;case"set":Do(e)&&a.push(r.get(fo));break}if(a.length===1)a[0]&&Ti(a[0]);else{const l=[];for(const d of a)d&&l.push(...d);Ti(gr(l))}}function Ti(e,t){for(const o of U(e)?e:[...e])(o!==uo||o.allowRecurse)&&(o.scheduler?o.scheduler():o.run())}const Au=dr("__proto__,__v_isRef,__isVue"),ql=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(hr)),Eu=yr(),Du=yr(!1,!0),Hu=yr(!0),ja=Mu();function Mu(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...o){const n=ce(this);for(let i=0,r=this.length;i<r;i++)Ye(n,"get",i+"");const s=n[t](...o);return s===-1||s===!1?n[t](...o.map(ce)):s}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...o){Xo();const n=ce(this)[t].apply(this,o);return yo(),n}}),e}function yr(e=!1,t=!1){return function(n,s,i){if(s==="__v_isReactive")return!e;if(s==="__v_isReadonly")return e;if(s==="__v_raw"&&i===(e?t?Qu:Ql:t?Zl:Jl).get(n))return n;const r=U(n);if(!e&&r&&ae(ja,s))return Reflect.get(ja,s,i);const a=Reflect.get(n,s,i);return(hr(s)?ql.has(s):Au(s))||(e||Ye(n,"get",s),t)?a:Ne(a)?!r||!pr(s)?a.value:a:Pe(a)?e?ed(a):Dt(a):a}}const Ru=Yl(),Fu=Yl(!0);function Yl(e=!1){return function(o,n,s,i){let r=o[n];if(!e&&!$r(s)&&(s=ce(s),r=ce(r),!U(o)&&Ne(r)&&!Ne(s)))return r.value=s,!0;const a=U(o)&&pr(n)?Number(n)<o.length:ae(o,n),l=Reflect.set(o,n,s,i);return o===ce(i)&&(a?_n(s,r)&&Et(o,"set",n,s):Et(o,"add",n,s)),l}}function Lu(e,t){const o=ae(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&o&&Et(e,"delete",t,void 0),n}function Nu(e,t){const o=Reflect.has(e,t);return(!hr(t)||!ql.has(t))&&Ye(e,"has",t),o}function Wu(e){return Ye(e,"iterate",U(e)?"length":fo),Reflect.ownKeys(e)}const Kl={get:Eu,set:Ru,deleteProperty:Lu,has:Nu,ownKeys:Wu},Vu={get:Hu,set(e,t){return!0},deleteProperty(e,t){return!0}},zu=Ee({},Kl,{get:Du,set:Fu}),vr=e=>e,As=e=>Reflect.getPrototypeOf(e);function Gn(e,t,o=!1,n=!1){e=e.__v_raw;const s=ce(e),i=ce(t);t!==i&&!o&&Ye(s,"get",t),!o&&Ye(s,"get",i);const{has:r}=As(s),a=n?vr:o?kr:xn;if(r.call(s,t))return a(e.get(t));if(r.call(s,i))return a(e.get(i));e!==s&&e.get(t)}function Xn(e,t=!1){const o=this.__v_raw,n=ce(o),s=ce(e);return e!==s&&!t&&Ye(n,"has",e),!t&&Ye(n,"has",s),e===s?o.has(e):o.has(e)||o.has(s)}function qn(e,t=!1){return e=e.__v_raw,!t&&Ye(ce(e),"iterate",fo),Reflect.get(e,"size",e)}function Ia(e){e=ce(e);const t=ce(this);return As(t).has.call(t,e)||(t.add(e),Et(t,"add",e,e)),this}function Ta(e,t){t=ce(t);const o=ce(this),{has:n,get:s}=As(o);let i=n.call(o,e);i||(e=ce(e),i=n.call(o,e));const r=s.call(o,e);return o.set(e,t),i?_n(t,r)&&Et(o,"set",e,t):Et(o,"add",e,t),this}function Oa(e){const t=ce(this),{has:o,get:n}=As(t);let s=o.call(t,e);s||(e=ce(e),s=o.call(t,e)),n&&n.call(t,e);const i=t.delete(e);return s&&Et(t,"delete",e,void 0),i}function Ba(){const e=ce(this),t=e.size!==0,o=e.clear();return t&&Et(e,"clear",void 0,void 0),o}function Yn(e,t){return function(n,s){const i=this,r=i.__v_raw,a=ce(r),l=t?vr:e?kr:xn;return!e&&Ye(a,"iterate",fo),r.forEach((d,c)=>n.call(s,l(d),l(c),i))}}function Kn(e,t,o){return function(...n){const s=this.__v_raw,i=ce(s),r=Do(i),a=e==="entries"||e===Symbol.iterator&&r,l=e==="keys"&&r,d=s[e](...n),c=o?vr:t?kr:xn;return!t&&Ye(i,"iterate",l?Ii:fo),{next(){const{value:f,done:h}=d.next();return h?{value:f,done:h}:{value:a?[c(f[0]),c(f[1])]:c(f),done:h}},[Symbol.iterator](){return this}}}}function Ft(e){return function(...t){return e==="delete"?!1:this}}function Uu(){const e={get(i){return Gn(this,i)},get size(){return qn(this)},has:Xn,add:Ia,set:Ta,delete:Oa,clear:Ba,forEach:Yn(!1,!1)},t={get(i){return Gn(this,i,!1,!0)},get size(){return qn(this)},has:Xn,add:Ia,set:Ta,delete:Oa,clear:Ba,forEach:Yn(!1,!0)},o={get(i){return Gn(this,i,!0)},get size(){return qn(this,!0)},has(i){return Xn.call(this,i,!0)},add:Ft("add"),set:Ft("set"),delete:Ft("delete"),clear:Ft("clear"),forEach:Yn(!0,!1)},n={get(i){return Gn(this,i,!0,!0)},get size(){return qn(this,!0)},has(i){return Xn.call(this,i,!0)},add:Ft("add"),set:Ft("set"),delete:Ft("delete"),clear:Ft("clear"),forEach:Yn(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(i=>{e[i]=Kn(i,!1,!1),o[i]=Kn(i,!0,!1),t[i]=Kn(i,!1,!0),n[i]=Kn(i,!0,!0)}),[e,o,t,n]}const[Gu,Xu,qu,Yu]=Uu();function wr(e,t){const o=t?e?Yu:qu:e?Xu:Gu;return(n,s,i)=>s==="__v_isReactive"?!e:s==="__v_isReadonly"?e:s==="__v_raw"?n:Reflect.get(ae(o,s)&&s in n?o:n,s,i)}const Ku={get:wr(!1,!1)},Ju={get:wr(!1,!0)},Zu={get:wr(!0,!1)},Jl=new WeakMap,Zl=new WeakMap,Ql=new WeakMap,Qu=new WeakMap;function ef(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function tf(e){return e.__v_skip||!Object.isExtensible(e)?0:ef(_u(e))}function Dt(e){return e&&e.__v_isReadonly?e:Cr(e,!1,Kl,Ku,Jl)}function of(e){return Cr(e,!1,zu,Ju,Zl)}function ed(e){return Cr(e,!0,Vu,Zu,Ql)}function Cr(e,t,o,n,s){if(!Pe(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const i=s.get(e);if(i)return i;const r=tf(e);if(r===0)return e;const a=new Proxy(e,r===2?n:o);return s.set(e,a),a}function Mo(e){return $r(e)?Mo(e.__v_raw):!!(e&&e.__v_isReactive)}function $r(e){return!!(e&&e.__v_isReadonly)}function td(e){return Mo(e)||$r(e)}function ce(e){const t=e&&e.__v_raw;return t?ce(t):e}function od(e){return cs(e,"__v_skip",!0),e}const xn=e=>Pe(e)?Dt(e):e,kr=e=>Pe(e)?ed(e):e;function nd(e){Gl()&&(e=ce(e),e.dep||(e.dep=gr()),Xl(e.dep))}function sd(e,t){e=ce(e),e.dep&&Ti(e.dep)}function Ne(e){return Boolean(e&&e.__v_isRef===!0)}function Ro(e){return nf(e,!1)}function nf(e,t){return Ne(e)?e:new sf(e,t)}class sf{constructor(t,o){this._shallow=o,this.dep=void 0,this.__v_isRef=!0,this._rawValue=o?t:ce(t),this._value=o?t:xn(t)}get value(){return nd(this),this._value}set value(t){t=this._shallow?t:ce(t),_n(t,this._rawValue)&&(this._rawValue=t,this._value=this._shallow?t:xn(t),sd(this))}}function rf(e){return Ne(e)?e.value:e}const af={get:(e,t,o)=>rf(Reflect.get(e,t,o)),set:(e,t,o,n)=>{const s=e[t];return Ne(s)&&!Ne(o)?(s.value=o,!0):Reflect.set(e,t,o,n)}};function id(e){return Mo(e)?e:new Proxy(e,af)}class lf{constructor(t,o,n){this._setter=o,this.dep=void 0,this._dirty=!0,this.__v_isRef=!0,this.effect=new mr(t,()=>{this._dirty||(this._dirty=!0,sd(this))}),this.__v_isReadonly=n}get value(){const t=ce(this);return nd(t),t._dirty&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}function Oi(e,t){let o,n;const s=Q(e);return s?(o=e,n=rt):(o=e.get,n=e.set),new lf(o,n,s||!n)}Promise.resolve();function df(e,t,...o){const n=e.vnode.props||me;let s=o;const i=t.startsWith("update:"),r=i&&t.slice(7);if(r&&r in n){const c=`${r==="modelValue"?"model":r}Modifiers`,{number:f,trim:h}=n[c]||me;h?s=o.map(b=>b.trim()):f&&(s=o.map(Sn))}let a,l=n[a=oi(t)]||n[a=oi(vt(t))];!l&&i&&(l=n[a=oi(bo(t))]),l&&et(l,e,6,s);const d=n[a+"Once"];if(d){if(!e.emitted)e.emitted={};else if(e.emitted[a])return;e.emitted[a]=!0,et(d,e,6,s)}}function rd(e,t,o=!1){const n=t.emitsCache,s=n.get(e);if(s!==void 0)return s;const i=e.emits;let r={},a=!1;if(!Q(e)){const l=d=>{const c=rd(d,t,!0);c&&(a=!0,Ee(r,c))};!o&&t.mixins.length&&t.mixins.forEach(l),e.extends&&l(e.extends),e.mixins&&e.mixins.forEach(l)}return!i&&!a?(n.set(e,null),null):(U(i)?i.forEach(l=>r[l]=null):Ee(r,i),n.set(e,r),r)}function _r(e,t){return!e||!Is(t)?!1:(t=t.slice(2).replace(/Once$/,""),ae(e,t[0].toLowerCase()+t.slice(1))||ae(e,bo(t))||ae(e,t))}let qe=null,Es=null;function us(e){const t=qe;return qe=e,Es=e&&e.type.__scopeId||null,t}function He(e){Es=e}function Me(){Es=null}function E(e,t=qe,o){if(!t||e._n)return e;const n=(...s)=>{n._d&&za(-1);const i=us(t),r=e(...s);return us(i),n._d&&za(1),r};return n._n=!0,n._c=!0,n._d=!0,n}function ni(e){const{type:t,vnode:o,proxy:n,withProxy:s,props:i,propsOptions:[r],slots:a,attrs:l,emit:d,render:c,renderCache:f,data:h,setupState:b,ctx:y,inheritAttrs:k}=e;let T,D;const H=us(e);try{if(o.shapeFlag&4){const O=s||n;T=pt(c.call(O,O,f,i,b,h,y)),D=l}else{const O=t;T=pt(O.length>1?O(i,{attrs:l,slots:a,emit:d}):O(i,null)),D=t.props?l:cf(l)}}catch(O){vn.length=0,Dn(O,e,1),T=$(at)}let x=T;if(D&&k!==!1){const O=Object.keys(D),{shapeFlag:Z}=x;O.length&&Z&7&&(r&&O.some(ur)&&(D=uf(D,r)),x=mo(x,D))}return o.dirs&&(x.dirs=x.dirs?x.dirs.concat(o.dirs):o.dirs),o.transition&&(x.transition=o.transition),T=x,us(H),T}const cf=e=>{let t;for(const o in e)(o==="class"||o==="style"||Is(o))&&((t||(t={}))[o]=e[o]);return t},uf=(e,t)=>{const o={};for(const n in e)(!ur(n)||!(n.slice(9)in t))&&(o[n]=e[n]);return o};function ff(e,t,o){const{props:n,children:s,component:i}=e,{props:r,children:a,patchFlag:l}=t,d=i.emitsOptions;if(t.dirs||t.transition)return!0;if(o&&l>=0){if(l&1024)return!0;if(l&16)return n?Aa(n,r,d):!!r;if(l&8){const c=t.dynamicProps;for(let f=0;f<c.length;f++){const h=c[f];if(r[h]!==n[h]&&!_r(d,h))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:n===r?!1:n?r?Aa(n,r,d):!0:!!r;return!1}function Aa(e,t,o){const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!0;for(let s=0;s<n.length;s++){const i=n[s];if(t[i]!==e[i]&&!_r(o,i))return!0}return!1}function hf({vnode:e,parent:t},o){for(;t&&t.subTree===e;)(e=t.vnode).el=o,t=t.parent}const pf=e=>e.__isSuspense;function gf(e,t){t&&t.pendingBranch?U(e)?t.effects.push(...e):t.effects.push(e):gh(e)}function mf(e,t){if(Oe){let o=Oe.provides;const n=Oe.parent&&Oe.parent.provides;n===o&&(o=Oe.provides=Object.create(n)),o[e]=t}}function si(e,t,o=!1){const n=Oe||qe;if(n){const s=n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides;if(s&&e in s)return s[e];if(arguments.length>1)return o&&Q(t)?t.call(n.proxy):t}}function ad(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return xr(()=>{e.isMounted=!0}),jr(()=>{e.isUnmounting=!0}),e}const Je=[Function,Array],bf={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Je,onEnter:Je,onAfterEnter:Je,onEnterCancelled:Je,onBeforeLeave:Je,onLeave:Je,onAfterLeave:Je,onLeaveCancelled:Je,onBeforeAppear:Je,onAppear:Je,onAfterAppear:Je,onAppearCancelled:Je},setup(e,{slots:t}){const o=Ar(),n=ad();let s;return()=>{const i=t.default&&Sr(t.default(),!0);if(!i||!i.length)return;const r=ce(e),{mode:a}=r,l=i[0];if(n.isLeaving)return ii(l);const d=Ea(l);if(!d)return ii(l);const c=Pn(d,r,n,o);No(d,c);const f=o.subTree,h=f&&Ea(f);let b=!1;const{getTransitionKey:y}=d.type;if(y){const k=y();s===void 0?s=k:k!==s&&(s=k,b=!0)}if(h&&h.type!==at&&(!ao(d,h)||b)){const k=Pn(h,r,n,o);if(No(h,k),a==="out-in")return n.isLeaving=!0,k.afterLeave=()=>{n.isLeaving=!1,o.update()},ii(l);a==="in-out"&&d.type!==at&&(k.delayLeave=(T,D,H)=>{const x=ld(n,h);x[String(h.key)]=h,T._leaveCb=()=>{D(),T._leaveCb=void 0,delete c.delayedLeave},c.delayedLeave=H})}return l}}},yf=bf;function ld(e,t){const{leavingVNodes:o}=e;let n=o.get(t.type);return n||(n=Object.create(null),o.set(t.type,n)),n}function Pn(e,t,o,n){const{appear:s,mode:i,persisted:r=!1,onBeforeEnter:a,onEnter:l,onAfterEnter:d,onEnterCancelled:c,onBeforeLeave:f,onLeave:h,onAfterLeave:b,onLeaveCancelled:y,onBeforeAppear:k,onAppear:T,onAfterAppear:D,onAppearCancelled:H}=t,x=String(e.key),O=ld(o,e),Z=(G,te)=>{G&&et(G,n,9,te)},K={mode:i,persisted:r,beforeEnter(G){let te=a;if(!o.isMounted)if(s)te=k||a;else return;G._leaveCb&&G._leaveCb(!0);const oe=O[x];oe&&ao(e,oe)&&oe.el._leaveCb&&oe.el._leaveCb(),Z(te,[G])},enter(G){let te=l,oe=d,pe=c;if(!o.isMounted)if(s)te=T||l,oe=D||d,pe=H||c;else return;let fe=!1;const L=G._enterCb=ke=>{fe||(fe=!0,ke?Z(pe,[G]):Z(oe,[G]),K.delayedLeave&&K.delayedLeave(),G._enterCb=void 0)};te?(te(G,L),te.length<=1&&L()):L()},leave(G,te){const oe=String(e.key);if(G._enterCb&&G._enterCb(!0),o.isUnmounting)return te();Z(f,[G]);let pe=!1;const fe=G._leaveCb=L=>{pe||(pe=!0,te(),L?Z(y,[G]):Z(b,[G]),G._leaveCb=void 0,O[oe]===e&&delete O[oe])};O[oe]=e,h?(h(G,fe),h.length<=1&&fe()):fe()},clone(G){return Pn(G,t,o,n)}};return K}function ii(e){if(En(e))return e=mo(e),e.children=null,e}function Ea(e){return En(e)?e.children?e.children[0]:void 0:e}function No(e,t){e.shapeFlag&6&&e.component?No(e.component.subTree,t):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function Sr(e,t=!1){let o=[],n=0;for(let s=0;s<e.length;s++){const i=e[s];i.type===N?(i.patchFlag&128&&n++,o=o.concat(Sr(i.children,t))):(t||i.type!==at)&&o.push(i)}if(n>1)for(let s=0;s<o.length;s++)o[s].patchFlag=-2;return o}function ne(e){return Q(e)?{setup:e,name:e.name}:e}const fs=e=>!!e.type.__asyncLoader;function Da(e){Q(e)&&(e={loader:e});const{loader:t,loadingComponent:o,errorComponent:n,delay:s=200,timeout:i,suspensible:r=!0,onError:a}=e;let l=null,d,c=0;const f=()=>(c++,l=null,h()),h=()=>{let b;return l||(b=l=t().catch(y=>{if(y=y instanceof Error?y:new Error(String(y)),a)return new Promise((k,T)=>{a(y,()=>k(f()),()=>T(y),c+1)});throw y}).then(y=>b!==l&&l?l:(y&&(y.__esModule||y[Symbol.toStringTag]==="Module")&&(y=y.default),d=y,y)))};return ne({name:"AsyncComponentWrapper",__asyncLoader:h,get __asyncResolved(){return d},setup(){const b=Oe;if(d)return()=>ri(d,b);const y=H=>{l=null,Dn(H,b,13,!n)};if(r&&b.suspense||In)return h().then(H=>()=>ri(H,b)).catch(H=>(y(H),()=>n?$(n,{error:H}):null));const k=Ro(!1),T=Ro(),D=Ro(!!s);return s&&setTimeout(()=>{D.value=!1},s),i!=null&&setTimeout(()=>{if(!k.value&&!T.value){const H=new Error(`Async component timed out after ${i}ms.`);y(H),T.value=H}},i),h().then(()=>{k.value=!0,b.parent&&En(b.parent.vnode)&&Hr(b.parent.update)}).catch(H=>{y(H),T.value=H}),()=>{if(k.value&&d)return ri(d,b);if(T.value&&n)return $(n,{error:T.value});if(o&&!D.value)return $(o)}}})}function ri(e,{vnode:{ref:t,props:o,children:n}}){const s=$(e,o,n);return s.ref=t,s}const En=e=>e.type.__isKeepAlive,vf={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(e,{slots:t}){const o=Ar(),n=o.ctx;if(!n.renderer)return t.default;const s=new Map,i=new Set;let r=null;const a=o.suspense,{renderer:{p:l,m:d,um:c,o:{createElement:f}}}=n,h=f("div");n.activate=(H,x,O,Z,K)=>{const G=H.component;d(H,x,O,0,a),l(G.vnode,H,x,O,G,a,Z,H.slotScopeIds,K),De(()=>{G.isDeactivated=!1,G.a&&Ho(G.a);const te=H.props&&H.props.onVnodeMounted;te&&Ze(te,G.parent,H)},a)},n.deactivate=H=>{const x=H.component;d(H,h,null,1,a),De(()=>{x.da&&Ho(x.da);const O=H.props&&H.props.onVnodeUnmounted;O&&Ze(O,x.parent,H),x.isDeactivated=!0},a)};function b(H){ai(H),c(H,o,a)}function y(H){s.forEach((x,O)=>{const Z=Ri(x.type);Z&&(!H||!H(Z))&&k(O)})}function k(H){const x=s.get(H);!r||x.type!==r.type?b(x):r&&ai(r),s.delete(H),i.delete(H)}go(()=>[e.include,e.exclude],([H,x])=>{H&&y(O=>cn(H,O)),x&&y(O=>!cn(x,O))},{flush:"post",deep:!0});let T=null;const D=()=>{T!=null&&s.set(T,li(o.subTree))};return xr(D),Pr(D),jr(()=>{s.forEach(H=>{const{subTree:x,suspense:O}=o,Z=li(x);if(H.type===Z.type){ai(Z);const K=Z.component.da;K&&De(K,O);return}b(H)})}),()=>{if(T=null,!t.default)return null;const H=t.default(),x=H[0];if(H.length>1)return r=null,H;if(!jn(x)||!(x.shapeFlag&4)&&!(x.shapeFlag&128))return r=null,x;let O=li(x);const Z=O.type,K=Ri(fs(O)?O.type.__asyncResolved||{}:Z),{include:G,exclude:te,max:oe}=e;if(G&&(!K||!cn(G,K))||te&&K&&cn(te,K))return r=O,x;const pe=O.key==null?Z:O.key,fe=s.get(pe);return O.el&&(O=mo(O),x.shapeFlag&128&&(x.ssContent=O)),T=pe,fe?(O.el=fe.el,O.component=fe.component,O.transition&&No(O,O.transition),O.shapeFlag|=512,i.delete(pe),i.add(pe)):(i.add(pe),oe&&i.size>parseInt(oe,10)&&k(i.values().next().value)),O.shapeFlag|=256,r=O,x}}},wf=vf;function cn(e,t){return U(e)?e.some(o=>cn(o,t)):Be(e)?e.split(",").indexOf(t)>-1:e.test?e.test(t):!1}function Cf(e,t){dd(e,"a",t)}function $f(e,t){dd(e,"da",t)}function dd(e,t,o=Oe){const n=e.__wdc||(e.__wdc=()=>{let s=o;for(;s;){if(s.isDeactivated)return;s=s.parent}return e()});if(Ds(t,n,o),o){let s=o.parent;for(;s&&s.parent;)En(s.parent.vnode)&&kf(n,t,o,s),s=s.parent}}function kf(e,t,o,n){const s=Ds(t,e,n,!0);cd(()=>{fr(n[t],s)},o)}function ai(e){let t=e.shapeFlag;t&256&&(t-=256),t&512&&(t-=512),e.shapeFlag=t}function li(e){return e.shapeFlag&128?e.ssContent:e}function Ds(e,t,o=Oe,n=!1){if(o){const s=o[e]||(o[e]=[]),i=t.__weh||(t.__weh=(...r)=>{if(o.isUnmounted)return;Xo(),Wo(o);const a=et(t,o,e,r);return po(),yo(),a});return n?s.unshift(i):s.push(i),i}}const Ht=e=>(t,o=Oe)=>(!In||e==="sp")&&Ds(e,t,o),_f=Ht("bm"),xr=Ht("m"),Sf=Ht("bu"),Pr=Ht("u"),jr=Ht("bum"),cd=Ht("um"),xf=Ht("sp"),Pf=Ht("rtg"),jf=Ht("rtc");function If(e,t=Oe){Ds("ec",e,t)}let Bi=!0;function Tf(e){const t=fd(e),o=e.proxy,n=e.ctx;Bi=!1,t.beforeCreate&&Ha(t.beforeCreate,e,"bc");const{data:s,computed:i,methods:r,watch:a,provide:l,inject:d,created:c,beforeMount:f,mounted:h,beforeUpdate:b,updated:y,activated:k,deactivated:T,beforeDestroy:D,beforeUnmount:H,destroyed:x,unmounted:O,render:Z,renderTracked:K,renderTriggered:G,errorCaptured:te,serverPrefetch:oe,expose:pe,inheritAttrs:fe,components:L,directives:ke,filters:ze}=t;if(d&&Of(d,n,null,e.appContext.config.unwrapInjectedRef),r)for(const Se in r){const ye=r[Se];Q(ye)&&(n[Se]=ye.bind(o))}if(s){const Se=s.call(o,o);Pe(Se)&&(e.data=Dt(Se))}if(Bi=!0,i)for(const Se in i){const ye=i[Se],$t=Q(ye)?ye.bind(o,o):Q(ye.get)?ye.get.bind(o,o):rt,Qs=!Q(ye)&&Q(ye.set)?ye.set.bind(o):rt,on=Oi({get:$t,set:Qs});Object.defineProperty(n,Se,{enumerable:!0,configurable:!0,get:()=>on.value,set:Co=>on.value=Co})}if(a)for(const Se in a)ud(a[Se],n,o,Se);if(l){const Se=Q(l)?l.call(o):l;Reflect.ownKeys(Se).forEach(ye=>{mf(ye,Se[ye])})}c&&Ha(c,e,"c");function _e(Se,ye){U(ye)?ye.forEach($t=>Se($t.bind(o))):ye&&Se(ye.bind(o))}if(_e(_f,f),_e(xr,h),_e(Sf,b),_e(Pr,y),_e(Cf,k),_e($f,T),_e(If,te),_e(jf,K),_e(Pf,G),_e(jr,H),_e(cd,O),_e(xf,oe),U(pe))if(pe.length){const Se=e.exposed||(e.exposed={});pe.forEach(ye=>{Object.defineProperty(Se,ye,{get:()=>o[ye],set:$t=>o[ye]=$t})})}else e.exposed||(e.exposed={});Z&&e.render===rt&&(e.render=Z),fe!=null&&(e.inheritAttrs=fe),L&&(e.components=L),ke&&(e.directives=ke)}function Of(e,t,o=rt,n=!1){U(e)&&(e=Ai(e));for(const s in e){const i=e[s];let r;Pe(i)?"default"in i?r=si(i.from||s,i.default,!0):r=si(i.from||s):r=si(i),Ne(r)&&n?Object.defineProperty(t,s,{enumerable:!0,configurable:!0,get:()=>r.value,set:a=>r.value=a}):t[s]=r}}function Ha(e,t,o){et(U(e)?e.map(n=>n.bind(t.proxy)):e.bind(t.proxy),t,o)}function ud(e,t,o,n){const s=n.includes(".")?Bd(o,n):()=>o[n];if(Be(e)){const i=t[e];Q(i)&&go(s,i)}else if(Q(e))go(s,e.bind(o));else if(Pe(e))if(U(e))e.forEach(i=>ud(i,t,o,n));else{const i=Q(e.handler)?e.handler.bind(o):t[e.handler];Q(i)&&go(s,i,e)}}function fd(e){const t=e.type,{mixins:o,extends:n}=t,{mixins:s,optionsCache:i,config:{optionMergeStrategies:r}}=e.appContext,a=i.get(t);let l;return a?l=a:!s.length&&!o&&!n?l=t:(l={},s.length&&s.forEach(d=>hs(l,d,r,!0)),hs(l,t,r)),i.set(t,l),l}function hs(e,t,o,n=!1){const{mixins:s,extends:i}=t;i&&hs(e,i,o,!0),s&&s.forEach(r=>hs(e,r,o,!0));for(const r in t)if(!(n&&r==="expose")){const a=Bf[r]||o&&o[r];e[r]=a?a(e[r],t[r]):t[r]}return e}const Bf={data:Ma,props:io,emits:io,methods:io,computed:io,beforeCreate:Fe,created:Fe,beforeMount:Fe,mounted:Fe,beforeUpdate:Fe,updated:Fe,beforeDestroy:Fe,beforeUnmount:Fe,destroyed:Fe,unmounted:Fe,activated:Fe,deactivated:Fe,errorCaptured:Fe,serverPrefetch:Fe,components:io,directives:io,watch:Ef,provide:Ma,inject:Af};function Ma(e,t){return t?e?function(){return Ee(Q(e)?e.call(this,this):e,Q(t)?t.call(this,this):t)}:t:e}function Af(e,t){return io(Ai(e),Ai(t))}function Ai(e){if(U(e)){const t={};for(let o=0;o<e.length;o++)t[e[o]]=e[o];return t}return e}function Fe(e,t){return e?[...new Set([].concat(e,t))]:t}function io(e,t){return e?Ee(Ee(Object.create(null),e),t):t}function Ef(e,t){if(!e)return t;if(!t)return e;const o=Ee(Object.create(null),e);for(const n in t)o[n]=Fe(e[n],t[n]);return o}function Df(e,t,o,n=!1){const s={},i={};cs(i,Hs,1),e.propsDefaults=Object.create(null),hd(e,t,s,i);for(const r in e.propsOptions[0])r in s||(s[r]=void 0);o?e.props=n?s:of(s):e.type.props?e.props=s:e.props=i,e.attrs=i}function Hf(e,t,o,n){const{props:s,attrs:i,vnode:{patchFlag:r}}=e,a=ce(s),[l]=e.propsOptions;let d=!1;if((n||r>0)&&!(r&16)){if(r&8){const c=e.vnode.dynamicProps;for(let f=0;f<c.length;f++){let h=c[f];const b=t[h];if(l)if(ae(i,h))b!==i[h]&&(i[h]=b,d=!0);else{const y=vt(h);s[y]=Ei(l,a,y,b,e,!1)}else b!==i[h]&&(i[h]=b,d=!0)}}}else{hd(e,t,s,i)&&(d=!0);let c;for(const f in a)(!t||!ae(t,f)&&((c=bo(f))===f||!ae(t,c)))&&(l?o&&(o[f]!==void 0||o[c]!==void 0)&&(s[f]=Ei(l,a,f,void 0,e,!0)):delete s[f]);if(i!==a)for(const f in i)(!t||!ae(t,f))&&(delete i[f],d=!0)}d&&Et(e,"set","$attrs")}function hd(e,t,o,n){const[s,i]=e.propsOptions;let r=!1,a;if(t)for(let l in t){if(ns(l))continue;const d=t[l];let c;s&&ae(s,c=vt(l))?!i||!i.includes(c)?o[c]=d:(a||(a={}))[c]=d:_r(e.emitsOptions,l)||(!(l in n)||d!==n[l])&&(n[l]=d,r=!0)}if(i){const l=ce(o),d=a||me;for(let c=0;c<i.length;c++){const f=i[c];o[f]=Ei(s,l,f,d[f],e,!ae(d,f))}}return r}function Ei(e,t,o,n,s,i){const r=e[o];if(r!=null){const a=ae(r,"default");if(a&&n===void 0){const l=r.default;if(r.type!==Function&&Q(l)){const{propsDefaults:d}=s;o in d?n=d[o]:(Wo(s),n=d[o]=l.call(null,t),po())}else n=l}r[0]&&(i&&!a?n=!1:r[1]&&(n===""||n===bo(o))&&(n=!0))}return n}function pd(e,t,o=!1){const n=t.propsCache,s=n.get(e);if(s)return s;const i=e.props,r={},a=[];let l=!1;if(!Q(e)){const c=f=>{l=!0;const[h,b]=pd(f,t,!0);Ee(r,h),b&&a.push(...b)};!o&&t.mixins.length&&t.mixins.forEach(c),e.extends&&c(e.extends),e.mixins&&e.mixins.forEach(c)}if(!i&&!l)return n.set(e,Eo),Eo;if(U(i))for(let c=0;c<i.length;c++){const f=vt(i[c]);Ra(f)&&(r[f]=me)}else if(i)for(const c in i){const f=vt(c);if(Ra(f)){const h=i[c],b=r[f]=U(h)||Q(h)?{type:h}:h;if(b){const y=Na(Boolean,b.type),k=Na(String,b.type);b[0]=y>-1,b[1]=k<0||y<k,(y>-1||ae(b,"default"))&&a.push(f)}}}const d=[r,a];return n.set(e,d),d}function Ra(e){return e[0]!=="$"}function Fa(e){const t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:e===null?"null":""}function La(e,t){return Fa(e)===Fa(t)}function Na(e,t){return U(t)?t.findIndex(o=>La(o,e)):Q(t)&&La(t,e)?0:-1}const gd=e=>e[0]==="_"||e==="$stable",Ir=e=>U(e)?e.map(pt):[pt(e)],Mf=(e,t,o)=>{const n=E((...s)=>Ir(t(...s)),o);return n._c=!1,n},md=(e,t,o)=>{const n=e._ctx;for(const s in e){if(gd(s))continue;const i=e[s];if(Q(i))t[s]=Mf(s,i,n);else if(i!=null){const r=Ir(i);t[s]=()=>r}}},bd=(e,t)=>{const o=Ir(t);e.slots.default=()=>o},Rf=(e,t)=>{if(e.vnode.shapeFlag&32){const o=t._;o?(e.slots=ce(t),cs(t,"_",o)):md(t,e.slots={})}else e.slots={},t&&bd(e,t);cs(e.slots,Hs,1)},Ff=(e,t,o)=>{const{vnode:n,slots:s}=e;let i=!0,r=me;if(n.shapeFlag&32){const a=t._;a?o&&a===1?i=!1:(Ee(s,t),!o&&a===1&&delete s._):(i=!t.$stable,md(t,s)),r=t}else t&&(bd(e,t),r={default:1});if(i)for(const a in s)!gd(a)&&!(a in r)&&delete s[a]};function de(e,t){const o=qe;if(o===null)return e;const n=o.proxy,s=e.dirs||(e.dirs=[]);for(let i=0;i<t.length;i++){let[r,a,l,d=me]=t[i];Q(r)&&(r={mounted:r,updated:r}),r.deep&&co(a),s.push({dir:r,instance:n,value:a,oldValue:void 0,arg:l,modifiers:d})}return e}function eo(e,t,o,n){const s=e.dirs,i=t&&t.dirs;for(let r=0;r<s.length;r++){const a=s[r];i&&(a.oldValue=i[r].value);let l=a.dir[n];l&&(Xo(),et(l,o,8,[e.el,a,e,t]),yo())}}function yd(){return{app:null,config:{isNativeTag:Cu,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Lf=0;function Nf(e,t){return function(n,s=null){s!=null&&!Pe(s)&&(s=null);const i=yd(),r=new Set;let a=!1;const l=i.app={_uid:Lf++,_component:n,_props:s,_container:null,_context:i,_instance:null,version:bh,get config(){return i.config},set config(d){},use(d,...c){return r.has(d)||(d&&Q(d.install)?(r.add(d),d.install(l,...c)):Q(d)&&(r.add(d),d(l,...c))),l},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),l},component(d,c){return c?(i.components[d]=c,l):i.components[d]},directive(d,c){return c?(i.directives[d]=c,l):i.directives[d]},mount(d,c,f){if(!a){const h=$(n,s);return h.appContext=i,c&&t?t(h,d):e(h,d,f),a=!0,l._container=d,d.__vue_app__=l,Er(h.component)||h.component.proxy}},unmount(){a&&(e(null,l._container),delete l._container.__vue_app__)},provide(d,c){return i.provides[d]=c,l}};return l}}function Di(e,t,o,n,s=!1){if(U(e)){e.forEach((h,b)=>Di(h,t&&(U(t)?t[b]:t),o,n,s));return}if(fs(n)&&!s)return;const i=n.shapeFlag&4?Er(n.component)||n.component.proxy:n.el,r=s?null:i,{i:a,r:l}=e,d=t&&t.r,c=a.refs===me?a.refs={}:a.refs,f=a.setupState;if(d!=null&&d!==l&&(Be(d)?(c[d]=null,ae(f,d)&&(f[d]=null)):Ne(d)&&(d.value=null)),Q(l))Xt(l,a,12,[r,c]);else{const h=Be(l),b=Ne(l);if(h||b){const y=()=>{if(e.f){const k=h?c[l]:l.value;s?U(k)&&fr(k,i):U(k)?k.includes(i)||k.push(i):h?c[l]=[i]:(l.value=[i],e.k&&(c[e.k]=l.value))}else h?(c[l]=r,ae(f,l)&&(f[l]=r)):Ne(l)&&(l.value=r,e.k&&(c[e.k]=r))};r?(y.id=-1,De(y,o)):y()}}}const De=gf;function Wf(e){return Vf(e)}function Vf(e,t){const o=Pu();o.__VUE__=!0;const{insert:n,remove:s,patchProp:i,createElement:r,createText:a,createComment:l,setText:d,setElementText:c,parentNode:f,nextSibling:h,setScopeId:b=rt,cloneNode:y,insertStaticContent:k}=e,T=(p,g,w,S=null,_=null,B=null,R=!1,I=null,A=!!g.dynamicChildren)=>{if(p===g)return;p&&!ao(p,g)&&(S=zn(p),Rt(p,_,B,!0),p=null),g.patchFlag===-2&&(A=!1,g.dynamicChildren=null);const{type:P,ref:W,shapeFlag:F}=g;switch(P){case Or:D(p,g,w,S);break;case at:H(p,g,w,S);break;case ss:p==null&&x(g,w,S,R);break;case N:ke(p,g,w,S,_,B,R,I,A);break;default:F&1?K(p,g,w,S,_,B,R,I,A):F&6?ze(p,g,w,S,_,B,R,I,A):(F&64||F&128)&&P.process(p,g,w,S,_,B,R,I,A,$o)}W!=null&&_&&Di(W,p&&p.ref,B,g||p,!g)},D=(p,g,w,S)=>{if(p==null)n(g.el=a(g.children),w,S);else{const _=g.el=p.el;g.children!==p.children&&d(_,g.children)}},H=(p,g,w,S)=>{p==null?n(g.el=l(g.children||""),w,S):g.el=p.el},x=(p,g,w,S)=>{[p.el,p.anchor]=k(p.children,g,w,S)},O=({el:p,anchor:g},w,S)=>{let _;for(;p&&p!==g;)_=h(p),n(p,w,S),p=_;n(g,w,S)},Z=({el:p,anchor:g})=>{let w;for(;p&&p!==g;)w=h(p),s(p),p=w;s(g)},K=(p,g,w,S,_,B,R,I,A)=>{R=R||g.type==="svg",p==null?G(g,w,S,_,B,R,I,A):pe(p,g,_,B,R,I,A)},G=(p,g,w,S,_,B,R,I)=>{let A,P;const{type:W,props:F,shapeFlag:V,transition:J,patchFlag:re,dirs:Ce}=p;if(p.el&&y!==void 0&&re===-1)A=p.el=y(p.el);else{if(A=p.el=r(p.type,B,F&&F.is,F),V&8?c(A,p.children):V&16&&oe(p.children,A,null,S,_,B&&W!=="foreignObject",R,I),Ce&&eo(p,null,S,"created"),F){for(const ve in F)ve!=="value"&&!ns(ve)&&i(A,ve,null,F[ve],B,p.children,S,_,kt);"value"in F&&i(A,"value",null,F.value),(P=F.onVnodeBeforeMount)&&Ze(P,S,p)}te(A,p,p.scopeId,R,S)}Ce&&eo(p,null,S,"beforeMount");const ge=(!_||_&&!_.pendingBranch)&&J&&!J.persisted;ge&&J.beforeEnter(A),n(A,g,w),((P=F&&F.onVnodeMounted)||ge||Ce)&&De(()=>{P&&Ze(P,S,p),ge&&J.enter(A),Ce&&eo(p,null,S,"mounted")},_)},te=(p,g,w,S,_)=>{if(w&&b(p,w),S)for(let B=0;B<S.length;B++)b(p,S[B]);if(_){let B=_.subTree;if(g===B){const R=_.vnode;te(p,R,R.scopeId,R.slotScopeIds,_.parent)}}},oe=(p,g,w,S,_,B,R,I,A=0)=>{for(let P=A;P<p.length;P++){const W=p[P]=I?zt(p[P]):pt(p[P]);T(null,W,g,w,S,_,B,R,I)}},pe=(p,g,w,S,_,B,R)=>{const I=g.el=p.el;let{patchFlag:A,dynamicChildren:P,dirs:W}=g;A|=p.patchFlag&16;const F=p.props||me,V=g.props||me;let J;w&&to(w,!1),(J=V.onVnodeBeforeUpdate)&&Ze(J,w,g,p),W&&eo(g,p,w,"beforeUpdate"),w&&to(w,!0);const re=_&&g.type!=="foreignObject";if(P?fe(p.dynamicChildren,P,I,w,S,re,B):R||$t(p,g,I,null,w,S,re,B,!1),A>0){if(A&16)L(I,g,F,V,w,S,_);else if(A&2&&F.class!==V.class&&i(I,"class",null,V.class,_),A&4&&i(I,"style",F.style,V.style,_),A&8){const Ce=g.dynamicProps;for(let ge=0;ge<Ce.length;ge++){const ve=Ce[ge],st=F[ve],ko=V[ve];(ko!==st||ve==="value")&&i(I,ve,st,ko,_,p.children,w,S,kt)}}A&1&&p.children!==g.children&&c(I,g.children)}else!R&&P==null&&L(I,g,F,V,w,S,_);((J=V.onVnodeUpdated)||W)&&De(()=>{J&&Ze(J,w,g,p),W&&eo(g,p,w,"updated")},S)},fe=(p,g,w,S,_,B,R)=>{for(let I=0;I<g.length;I++){const A=p[I],P=g[I],W=A.el&&(A.type===N||!ao(A,P)||A.shapeFlag&70)?f(A.el):w;T(A,P,W,null,S,_,B,R,!0)}},L=(p,g,w,S,_,B,R)=>{if(w!==S){for(const I in S){if(ns(I))continue;const A=S[I],P=w[I];A!==P&&I!=="value"&&i(p,I,P,A,R,g.children,_,B,kt)}if(w!==me)for(const I in w)!ns(I)&&!(I in S)&&i(p,I,w[I],null,R,g.children,_,B,kt);"value"in S&&i(p,"value",w.value,S.value)}},ke=(p,g,w,S,_,B,R,I,A)=>{const P=g.el=p?p.el:a(""),W=g.anchor=p?p.anchor:a("");let{patchFlag:F,dynamicChildren:V,slotScopeIds:J}=g;J&&(I=I?I.concat(J):J),p==null?(n(P,w,S),n(W,w,S),oe(g.children,w,W,_,B,R,I,A)):F>0&&F&64&&V&&p.dynamicChildren?(fe(p.dynamicChildren,V,w,_,B,R,I),(g.key!=null||_&&g===_.subTree)&&Tr(p,g,!0)):$t(p,g,w,W,_,B,R,I,A)},ze=(p,g,w,S,_,B,R,I,A)=>{g.slotScopeIds=I,p==null?g.shapeFlag&512?_.ctx.activate(g,w,S,R,A):nt(g,w,S,_,B,R,A):_e(p,g,A)},nt=(p,g,w,S,_,B,R)=>{const I=p.component=sh(p,S,_);if(En(p)&&(I.ctx.renderer=$o),ih(I),I.asyncDep){if(_&&_.registerDep(I,Se),!p.el){const A=I.subTree=$(at);H(null,A,g,w)}return}Se(I,p,g,w,_,B,R)},_e=(p,g,w)=>{const S=g.component=p.component;if(ff(p,g,w))if(S.asyncDep&&!S.asyncResolved){ye(S,g,w);return}else S.next=g,hh(S.update),S.update();else g.component=p.component,g.el=p.el,S.vnode=g},Se=(p,g,w,S,_,B,R)=>{const I=()=>{if(p.isMounted){let{next:W,bu:F,u:V,parent:J,vnode:re}=p,Ce=W,ge;to(p,!1),W?(W.el=re.el,ye(p,W,R)):W=re,F&&Ho(F),(ge=W.props&&W.props.onVnodeBeforeUpdate)&&Ze(ge,J,W,re),to(p,!0);const ve=ni(p),st=p.subTree;p.subTree=ve,T(st,ve,f(st.el),zn(st),p,_,B),W.el=ve.el,Ce===null&&hf(p,ve.el),V&&De(V,_),(ge=W.props&&W.props.onVnodeUpdated)&&De(()=>Ze(ge,J,W,re),_)}else{let W;const{el:F,props:V}=g,{bm:J,m:re,parent:Ce}=p,ge=fs(g);if(to(p,!1),J&&Ho(J),!ge&&(W=V&&V.onVnodeBeforeMount)&&Ze(W,Ce,g),to(p,!0),F&&ti){const ve=()=>{p.subTree=ni(p),ti(F,p.subTree,p,_,null)};ge?g.type.__asyncLoader().then(()=>!p.isUnmounted&&ve()):ve()}else{const ve=p.subTree=ni(p);T(null,ve,w,S,p,_,B),g.el=ve.el}if(re&&De(re,_),!ge&&(W=V&&V.onVnodeMounted)){const ve=g;De(()=>Ze(W,Ce,ve),_)}g.shapeFlag&256&&p.a&&De(p.a,_),p.isMounted=!0,g=w=S=null}},A=p.effect=new mr(I,()=>Hr(p.update),p.scope),P=p.update=A.run.bind(A);P.id=p.uid,to(p,!0),P()},ye=(p,g,w)=>{g.component=p;const S=p.vnode.props;p.vnode=g,p.next=null,Hf(p,g.props,S,w),Ff(p,g.children,w),Xo(),Mr(void 0,p.update),yo()},$t=(p,g,w,S,_,B,R,I,A=!1)=>{const P=p&&p.children,W=p?p.shapeFlag:0,F=g.children,{patchFlag:V,shapeFlag:J}=g;if(V>0){if(V&128){on(P,F,w,S,_,B,R,I,A);return}else if(V&256){Qs(P,F,w,S,_,B,R,I,A);return}}J&8?(W&16&&kt(P,_,B),F!==P&&c(w,F)):W&16?J&16?on(P,F,w,S,_,B,R,I,A):kt(P,_,B,!0):(W&8&&c(w,""),J&16&&oe(F,w,S,_,B,R,I,A))},Qs=(p,g,w,S,_,B,R,I,A)=>{p=p||Eo,g=g||Eo;const P=p.length,W=g.length,F=Math.min(P,W);let V;for(V=0;V<F;V++){const J=g[V]=A?zt(g[V]):pt(g[V]);T(p[V],J,w,null,_,B,R,I,A)}P>W?kt(p,_,B,!0,!1,F):oe(g,w,S,_,B,R,I,A,F)},on=(p,g,w,S,_,B,R,I,A)=>{let P=0;const W=g.length;let F=p.length-1,V=W-1;for(;P<=F&&P<=V;){const J=p[P],re=g[P]=A?zt(g[P]):pt(g[P]);if(ao(J,re))T(J,re,w,null,_,B,R,I,A);else break;P++}for(;P<=F&&P<=V;){const J=p[F],re=g[V]=A?zt(g[V]):pt(g[V]);if(ao(J,re))T(J,re,w,null,_,B,R,I,A);else break;F--,V--}if(P>F){if(P<=V){const J=V+1,re=J<W?g[J].el:S;for(;P<=V;)T(null,g[P]=A?zt(g[P]):pt(g[P]),w,re,_,B,R,I,A),P++}}else if(P>V)for(;P<=F;)Rt(p[P],_,B,!0),P++;else{const J=P,re=P,Ce=new Map;for(P=re;P<=V;P++){const Ue=g[P]=A?zt(g[P]):pt(g[P]);Ue.key!=null&&Ce.set(Ue.key,P)}let ge,ve=0;const st=V-re+1;let ko=!1,$a=0;const nn=new Array(st);for(P=0;P<st;P++)nn[P]=0;for(P=J;P<=F;P++){const Ue=p[P];if(ve>=st){Rt(Ue,_,B,!0);continue}let ut;if(Ue.key!=null)ut=Ce.get(Ue.key);else for(ge=re;ge<=V;ge++)if(nn[ge-re]===0&&ao(Ue,g[ge])){ut=ge;break}ut===void 0?Rt(Ue,_,B,!0):(nn[ut-re]=P+1,ut>=$a?$a=ut:ko=!0,T(Ue,g[ut],w,null,_,B,R,I,A),ve++)}const ka=ko?zf(nn):Eo;for(ge=ka.length-1,P=st-1;P>=0;P--){const Ue=re+P,ut=g[Ue],_a=Ue+1<W?g[Ue+1].el:S;nn[P]===0?T(null,ut,w,_a,_,B,R,I,A):ko&&(ge<0||P!==ka[ge]?Co(ut,w,_a,2):ge--)}}},Co=(p,g,w,S,_=null)=>{const{el:B,type:R,transition:I,children:A,shapeFlag:P}=p;if(P&6){Co(p.component.subTree,g,w,S);return}if(P&128){p.suspense.move(g,w,S);return}if(P&64){R.move(p,g,w,$o);return}if(R===N){n(B,g,w);for(let F=0;F<A.length;F++)Co(A[F],g,w,S);n(p.anchor,g,w);return}if(R===ss){O(p,g,w);return}if(S!==2&&P&1&&I)if(S===0)I.beforeEnter(B),n(B,g,w),De(()=>I.enter(B),_);else{const{leave:F,delayLeave:V,afterLeave:J}=I,re=()=>n(B,g,w),Ce=()=>{F(B,()=>{re(),J&&J()})};V?V(B,re,Ce):Ce()}else n(B,g,w)},Rt=(p,g,w,S=!1,_=!1)=>{const{type:B,props:R,ref:I,children:A,dynamicChildren:P,shapeFlag:W,patchFlag:F,dirs:V}=p;if(I!=null&&Di(I,null,w,p,!0),W&256){g.ctx.deactivate(p);return}const J=W&1&&V,re=!fs(p);let Ce;if(re&&(Ce=R&&R.onVnodeBeforeUnmount)&&Ze(Ce,g,p),W&6)fu(p.component,w,S);else{if(W&128){p.suspense.unmount(w,S);return}J&&eo(p,null,g,"beforeUnmount"),W&64?p.type.remove(p,g,w,_,$o,S):P&&(B!==N||F>0&&F&64)?kt(P,g,w,!1,!0):(B===N&&F&384||!_&&W&16)&&kt(A,g,w),S&&wa(p)}(re&&(Ce=R&&R.onVnodeUnmounted)||J)&&De(()=>{Ce&&Ze(Ce,g,p),J&&eo(p,null,g,"unmounted")},w)},wa=p=>{const{type:g,el:w,anchor:S,transition:_}=p;if(g===N){uu(w,S);return}if(g===ss){Z(p);return}const B=()=>{s(w),_&&!_.persisted&&_.afterLeave&&_.afterLeave()};if(p.shapeFlag&1&&_&&!_.persisted){const{leave:R,delayLeave:I}=_,A=()=>R(w,B);I?I(p.el,B,A):A()}else B()},uu=(p,g)=>{let w;for(;p!==g;)w=h(p),s(p),p=w;s(g)},fu=(p,g,w)=>{const{bum:S,scope:_,update:B,subTree:R,um:I}=p;S&&Ho(S),_.stop(),B&&(B.active=!1,Rt(R,p,g,w)),I&&De(I,g),De(()=>{p.isUnmounted=!0},g),g&&g.pendingBranch&&!g.isUnmounted&&p.asyncDep&&!p.asyncResolved&&p.suspenseId===g.pendingId&&(g.deps--,g.deps===0&&g.resolve())},kt=(p,g,w,S=!1,_=!1,B=0)=>{for(let R=B;R<p.length;R++)Rt(p[R],g,w,S,_)},zn=p=>p.shapeFlag&6?zn(p.component.subTree):p.shapeFlag&128?p.suspense.next():h(p.anchor||p.el),Ca=(p,g,w)=>{p==null?g._vnode&&Rt(g._vnode,null,null,!0):T(g._vnode||null,p,g,null,null,null,w),Id(),g._vnode=p},$o={p:T,um:Rt,m:Co,r:wa,mt:nt,mc:oe,pc:$t,pbc:fe,n:zn,o:e};let ei,ti;return t&&([ei,ti]=t($o)),{render:Ca,hydrate:ei,createApp:Nf(Ca,ei)}}function to({effect:e,update:t},o){e.allowRecurse=t.allowRecurse=o}function Tr(e,t,o=!1){const n=e.children,s=t.children;if(U(n)&&U(s))for(let i=0;i<n.length;i++){const r=n[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=zt(s[i]),a.el=r.el),o||Tr(r,a))}}function zf(e){const t=e.slice(),o=[0];let n,s,i,r,a;const l=e.length;for(n=0;n<l;n++){const d=e[n];if(d!==0){if(s=o[o.length-1],e[s]<d){t[n]=s,o.push(n);continue}for(i=0,r=o.length-1;i<r;)a=i+r>>1,e[o[a]]<d?i=a+1:r=a;d<e[o[i]]&&(i>0&&(t[n]=o[i-1]),o[i]=n)}}for(i=o.length,r=o[i-1];i-- >0;)o[i]=r,r=t[r];return o}const Uf=e=>e.__isTeleport,yn=e=>e&&(e.disabled||e.disabled===""),Wa=e=>typeof SVGElement<"u"&&e instanceof SVGElement,Hi=(e,t)=>{const o=e&&e.to;return Be(o)?t?t(o):null:o},Gf={__isTeleport:!0,process(e,t,o,n,s,i,r,a,l,d){const{mc:c,pc:f,pbc:h,o:{insert:b,querySelector:y,createText:k,createComment:T}}=d,D=yn(t.props);let{shapeFlag:H,children:x,dynamicChildren:O}=t;if(e==null){const Z=t.el=k(""),K=t.anchor=k("");b(Z,o,n),b(K,o,n);const G=t.target=Hi(t.props,y),te=t.targetAnchor=k("");G&&(b(te,G),r=r||Wa(G));const oe=(pe,fe)=>{H&16&&c(x,pe,fe,s,i,r,a,l)};D?oe(o,K):G&&oe(G,te)}else{t.el=e.el;const Z=t.anchor=e.anchor,K=t.target=e.target,G=t.targetAnchor=e.targetAnchor,te=yn(e.props),oe=te?o:K,pe=te?Z:G;if(r=r||Wa(K),O?(h(e.dynamicChildren,O,oe,s,i,r,a),Tr(e,t,!0)):l||f(e,t,oe,pe,s,i,r,a,!1),D)te||Jn(t,o,Z,d,1);else if((t.props&&t.props.to)!==(e.props&&e.props.to)){const fe=t.target=Hi(t.props,y);fe&&Jn(t,fe,null,d,0)}else te&&Jn(t,K,G,d,1)}},remove(e,t,o,n,{um:s,o:{remove:i}},r){const{shapeFlag:a,children:l,anchor:d,targetAnchor:c,target:f,props:h}=e;if(f&&i(c),(r||!yn(h))&&(i(d),a&16))for(let b=0;b<l.length;b++){const y=l[b];s(y,t,o,!0,!!y.dynamicChildren)}},move:Jn,hydrate:Xf};function Jn(e,t,o,{o:{insert:n},m:s},i=2){i===0&&n(e.targetAnchor,t,o);const{el:r,anchor:a,shapeFlag:l,children:d,props:c}=e,f=i===2;if(f&&n(r,t,o),(!f||yn(c))&&l&16)for(let h=0;h<d.length;h++)s(d[h],t,o,2);f&&n(a,t,o)}function Xf(e,t,o,n,s,i,{o:{nextSibling:r,parentNode:a,querySelector:l}},d){const c=t.target=Hi(t.props,l);if(c){const f=c._lpa||c.firstChild;t.shapeFlag&16&&(yn(t.props)?(t.anchor=d(r(e),t,a(e),o,n,s,i),t.targetAnchor=f):(t.anchor=r(e),t.targetAnchor=d(f,t,c,o,n,s,i)),c._lpa=t.targetAnchor&&r(t.targetAnchor))}return t.anchor&&r(t.anchor)}const vd=Gf,wd="components";function M(e,t){return Yf(wd,e,!0,t)||e}const qf=Symbol();function Yf(e,t,o=!0,n=!1){const s=qe||Oe;if(s){const i=s.type;if(e===wd){const a=Ri(i);if(a&&(a===t||a===vt(t)||a===Bs(vt(t))))return i}const r=Va(s[e]||i[e],t)||Va(s.appContext[e],t);return!r&&n?i:r}}function Va(e,t){return e&&(e[t]||e[vt(t)]||e[Bs(vt(t))])}const N=Symbol(void 0),Or=Symbol(void 0),at=Symbol(void 0),ss=Symbol(void 0),vn=[];let ho=null;function m(e=!1){vn.push(ho=e?null:[])}function Kf(){vn.pop(),ho=vn[vn.length-1]||null}let ps=1;function za(e){ps+=e}function Cd(e){return e.dynamicChildren=ps>0?ho||Eo:null,Kf(),ps>0&&ho&&ho.push(e),e}function C(e,t,o,n,s,i){return Cd(u(e,t,o,n,s,i,!0))}function z(e,t,o,n,s){return Cd($(e,t,o,n,s,!0))}function jn(e){return e?e.__v_isVNode===!0:!1}function ao(e,t){return e.type===t.type&&e.key===t.key}const Hs="__vInternal",$d=({key:e})=>e!=null?e:null,is=({ref:e,ref_key:t,ref_for:o})=>e!=null?Be(e)||Ne(e)||Q(e)?{i:qe,r:e,k:t,f:!!o}:e:null;function u(e,t=null,o=null,n=0,s=null,i=e===N?0:1,r=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&$d(t),ref:t&&is(t),scopeId:Es,slotScopeIds:null,children:o,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:n,dynamicProps:s,dynamicChildren:null,appContext:null};return a?(Br(l,o),i&128&&e.normalize(l)):o&&(l.shapeFlag|=Be(o)?8:16),ps>0&&!r&&ho&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&ho.push(l),l}const $=Jf;function Jf(e,t=null,o=null,n=0,s=null,i=!1){if((!e||e===qf)&&(e=at),jn(e)){const a=mo(e,t,!0);return o&&Br(a,o),a}if(dh(e)&&(e=e.__vccOpts),t){t=Zf(t);let{class:a,style:l}=t;a&&!Be(a)&&(t.class=le(a)),Pe(l)&&(td(l)&&!U(l)&&(l=Ee({},l)),t.style=Ae(l))}const r=Be(e)?1:pf(e)?128:Uf(e)?64:Pe(e)?4:Q(e)?2:0;return u(e,t,o,n,s,r,i,!0)}function Zf(e){return e?td(e)||Hs in e?Ee({},e):e:null}function mo(e,t,o=!1){const{props:n,ref:s,patchFlag:i,children:r}=e,a=t?eh(n||{},t):n;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:a,key:a&&$d(a),ref:t&&t.ref?o&&s?U(s)?s.concat(is(t)):[s,is(t)]:is(t):s,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:r,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==N?i===-1?16:i|16:i,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&mo(e.ssContent),ssFallback:e.ssFallback&&mo(e.ssFallback),el:e.el,anchor:e.anchor}}function j(e=" ",t=0){return $(Or,null,e,t)}function Qf(e,t){const o=$(ss,null,e);return o.staticCount=t,o}function X(e="",t=!1){return t?(m(),z(at,null,e)):$(at,null,e)}function pt(e){return e==null||typeof e=="boolean"?$(at):U(e)?$(N,null,e.slice()):typeof e=="object"?zt(e):$(Or,null,String(e))}function zt(e){return e.el===null||e.memo?e:mo(e)}function Br(e,t){let o=0;const{shapeFlag:n}=e;if(t==null)t=null;else if(U(t))o=16;else if(typeof t=="object")if(n&65){const s=t.default;s&&(s._c&&(s._d=!1),Br(e,s()),s._c&&(s._d=!0));return}else{o=32;const s=t._;!s&&!(Hs in t)?t._ctx=qe:s===3&&qe&&(qe.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else Q(t)?(t={default:t,_ctx:qe},o=32):(t=String(t),n&64?(o=16,t=[j(t)]):o=8);e.children=t,e.shapeFlag|=o}function eh(...e){const t={};for(let o=0;o<e.length;o++){const n=e[o];for(const s in n)if(s==="class")t.class!==n.class&&(t.class=le([t.class,n.class]));else if(s==="style")t.style=Ae([t.style,n.style]);else if(Is(s)){const i=t[s],r=n[s];i!==r&&!(U(i)&&i.includes(r))&&(t[s]=i?[].concat(i,r):r)}else s!==""&&(t[s]=n[s])}return t}function Ze(e,t,o,n=null){et(e,t,7,[o,n])}function $e(e,t,o,n){let s;const i=o&&o[n];if(U(e)||Be(e)){s=new Array(e.length);for(let r=0,a=e.length;r<a;r++)s[r]=t(e[r],r,void 0,i&&i[r])}else if(typeof e=="number"){s=new Array(e);for(let r=0;r<e;r++)s[r]=t(r+1,r,void 0,i&&i[r])}else if(Pe(e))if(e[Symbol.iterator])s=Array.from(e,(r,a)=>t(r,a,void 0,i&&i[a]));else{const r=Object.keys(e);s=new Array(r.length);for(let a=0,l=r.length;a<l;a++){const d=r[a];s[a]=t(e[d],d,a,i&&i[a])}}else s=[];return o&&(o[n]=s),s}function Bt(e,t,o={},n,s){if(qe.isCE)return $("slot",t==="default"?null:{name:t},n&&n());let i=e[t];i&&i._c&&(i._d=!1),m();const r=i&&kd(i(o)),a=z(N,{key:o.key||`_${t}`},r||(n?n():[]),r&&e._===1?64:-2);return!s&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),i&&i._c&&(i._d=!0),a}function kd(e){return e.some(t=>jn(t)?!(t.type===at||t.type===N&&!kd(t.children)):!0)?e:null}const Mi=e=>e?_d(e)?Er(e)||e.proxy:Mi(e.parent):null,gs=Ee(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Mi(e.parent),$root:e=>Mi(e.root),$emit:e=>e.emit,$options:e=>fd(e),$forceUpdate:e=>()=>Hr(e.update),$nextTick:e=>uh.bind(e.proxy),$watch:e=>mh.bind(e)}),th={get({_:e},t){const{ctx:o,setupState:n,data:s,props:i,accessCache:r,type:a,appContext:l}=e;let d;if(t[0]!=="$"){const b=r[t];if(b!==void 0)switch(b){case 1:return n[t];case 2:return s[t];case 4:return o[t];case 3:return i[t]}else{if(n!==me&&ae(n,t))return r[t]=1,n[t];if(s!==me&&ae(s,t))return r[t]=2,s[t];if((d=e.propsOptions[0])&&ae(d,t))return r[t]=3,i[t];if(o!==me&&ae(o,t))return r[t]=4,o[t];Bi&&(r[t]=0)}}const c=gs[t];let f,h;if(c)return t==="$attrs"&&Ye(e,"get",t),c(e);if((f=a.__cssModules)&&(f=f[t]))return f;if(o!==me&&ae(o,t))return r[t]=4,o[t];if(h=l.config.globalProperties,ae(h,t))return h[t]},set({_:e},t,o){const{data:n,setupState:s,ctx:i}=e;if(s!==me&&ae(s,t))s[t]=o;else if(n!==me&&ae(n,t))n[t]=o;else if(ae(e.props,t))return!1;return t[0]==="$"&&t.slice(1)in e?!1:(i[t]=o,!0)},has({_:{data:e,setupState:t,accessCache:o,ctx:n,appContext:s,propsOptions:i}},r){let a;return!!o[r]||e!==me&&ae(e,r)||t!==me&&ae(t,r)||(a=i[0])&&ae(a,r)||ae(n,r)||ae(gs,r)||ae(s.config.globalProperties,r)}},oh=yd();let nh=0;function sh(e,t,o){const n=e.type,s=(t?t.appContext:e.appContext)||oh,i={uid:nh++,vnode:e,type:n,parent:t,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new ju(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:pd(n,s),emitsOptions:rd(n,s),emit:null,emitted:null,propsDefaults:me,inheritAttrs:n.inheritAttrs,ctx:me,data:me,props:me,attrs:me,slots:me,refs:me,setupState:me,setupContext:null,suspense:o,suspenseId:o?o.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=t?t.root:i,i.emit=df.bind(null,i),e.ce&&e.ce(i),i}let Oe=null;const Ar=()=>Oe||qe,Wo=e=>{Oe=e,e.scope.on()},po=()=>{Oe&&Oe.scope.off(),Oe=null};function _d(e){return e.vnode.shapeFlag&4}let In=!1;function ih(e,t=!1){In=t;const{props:o,children:n}=e.vnode,s=_d(e);Df(e,o,s,t),Rf(e,n);const i=s?rh(e,t):void 0;return In=!1,i}function rh(e,t){const o=e.type;e.accessCache=Object.create(null),e.proxy=od(new Proxy(e.ctx,th));const{setup:n}=o;if(n){const s=e.setupContext=n.length>1?lh(e):null;Wo(e),Xo();const i=Xt(n,e,0,[e.props,s]);if(yo(),po(),Nl(i)){if(i.then(po,po),t)return i.then(r=>{Ua(e,r,t)}).catch(r=>{Dn(r,e,0)});e.asyncDep=i}else Ua(e,i,t)}else Sd(e,t)}function Ua(e,t,o){Q(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:Pe(t)&&(e.setupState=id(t)),Sd(e,o)}let Ga;function Sd(e,t,o){const n=e.type;if(!e.render){if(!t&&Ga&&!n.render){const s=n.template;if(s){const{isCustomElement:i,compilerOptions:r}=e.appContext.config,{delimiters:a,compilerOptions:l}=n,d=Ee(Ee({isCustomElement:i,delimiters:a},r),l);n.render=Ga(s,d)}}e.render=n.render||rt}Wo(e),Xo(),Tf(e),yo(),po()}function ah(e){return new Proxy(e.attrs,{get(t,o){return Ye(e,"get","$attrs"),t[o]}})}function lh(e){const t=n=>{e.exposed=n||{}};let o;return{get attrs(){return o||(o=ah(e))},slots:e.slots,emit:e.emit,expose:t}}function Er(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(id(od(e.exposed)),{get(t,o){if(o in t)return t[o];if(o in gs)return gs[o](e)}}))}function Ri(e){return Q(e)&&e.displayName||e.name}function dh(e){return Q(e)&&"__vccOpts"in e}function Xt(e,t,o,n){let s;try{s=n?e(...n):e()}catch(i){Dn(i,t,o)}return s}function et(e,t,o,n){if(Q(e)){const i=Xt(e,t,o,n);return i&&Nl(i)&&i.catch(r=>{Dn(r,t,o)}),i}const s=[];for(let i=0;i<e.length;i++)s.push(et(e[i],t,o,n));return s}function Dn(e,t,o,n=!0){const s=t?t.vnode:null;if(t){let i=t.parent;const r=t.proxy,a=o;for(;i;){const d=i.ec;if(d){for(let c=0;c<d.length;c++)if(d[c](e,r,a)===!1)return}i=i.parent}const l=t.appContext.config.errorHandler;if(l){Xt(l,null,10,[e,r,a]);return}}ch(e,o,s,n)}function ch(e,t,o,n=!0){console.error(e)}let ms=!1,Fi=!1;const Xe=[];let Tt=0;const wn=[];let un=null,jo=0;const Cn=[];let Vt=null,Io=0;const xd=Promise.resolve();let Dr=null,Li=null;function uh(e){const t=Dr||xd;return e?t.then(this?e.bind(this):e):t}function fh(e){let t=Tt+1,o=Xe.length;for(;t<o;){const n=t+o>>>1;Tn(Xe[n])<e?t=n+1:o=n}return t}function Hr(e){(!Xe.length||!Xe.includes(e,ms&&e.allowRecurse?Tt+1:Tt))&&e!==Li&&(e.id==null?Xe.push(e):Xe.splice(fh(e.id),0,e),Pd())}function Pd(){!ms&&!Fi&&(Fi=!0,Dr=xd.then(Td))}function hh(e){const t=Xe.indexOf(e);t>Tt&&Xe.splice(t,1)}function jd(e,t,o,n){U(e)?o.push(...e):(!t||!t.includes(e,e.allowRecurse?n+1:n))&&o.push(e),Pd()}function ph(e){jd(e,un,wn,jo)}function gh(e){jd(e,Vt,Cn,Io)}function Mr(e,t=null){if(wn.length){for(Li=t,un=[...new Set(wn)],wn.length=0,jo=0;jo<un.length;jo++)un[jo]();un=null,jo=0,Li=null,Mr(e,t)}}function Id(e){if(Cn.length){const t=[...new Set(Cn)];if(Cn.length=0,Vt){Vt.push(...t);return}for(Vt=t,Vt.sort((o,n)=>Tn(o)-Tn(n)),Io=0;Io<Vt.length;Io++)Vt[Io]();Vt=null,Io=0}}const Tn=e=>e.id==null?1/0:e.id;function Td(e){Fi=!1,ms=!0,Mr(e),Xe.sort((o,n)=>Tn(o)-Tn(n));const t=rt;try{for(Tt=0;Tt<Xe.length;Tt++){const o=Xe[Tt];o&&o.active!==!1&&Xt(o,null,14)}}finally{Tt=0,Xe.length=0,Id(),ms=!1,Dr=null,(Xe.length||wn.length||Cn.length)&&Td(e)}}const Xa={};function go(e,t,o){return Od(e,t,o)}function Od(e,t,{immediate:o,deep:n,flush:s,onTrack:i,onTrigger:r}=me){const a=Oe;let l,d=!1,c=!1;if(Ne(e)?(l=()=>e.value,d=!!e._shallow):Mo(e)?(l=()=>e,n=!0):U(e)?(c=!0,d=e.some(Mo),l=()=>e.map(D=>{if(Ne(D))return D.value;if(Mo(D))return co(D);if(Q(D))return Xt(D,a,2)})):Q(e)?t?l=()=>Xt(e,a,2):l=()=>{if(!(a&&a.isUnmounted))return f&&f(),et(e,a,3,[h])}:l=rt,t&&n){const D=l;l=()=>co(D())}let f,h=D=>{f=T.onStop=()=>{Xt(D,a,4)}};if(In)return h=rt,t?o&&et(t,a,3,[l(),c?[]:void 0,h]):l(),rt;let b=c?[]:Xa;const y=()=>{if(!!T.active)if(t){const D=T.run();(n||d||(c?D.some((H,x)=>_n(H,b[x])):_n(D,b)))&&(f&&f(),et(t,a,3,[D,b===Xa?void 0:b,h]),b=D)}else T.run()};y.allowRecurse=!!t;let k;s==="sync"?k=y:s==="post"?k=()=>De(y,a&&a.suspense):k=()=>{!a||a.isMounted?ph(y):y()};const T=new mr(l,k);return t?o?y():b=T.run():s==="post"?De(T.run.bind(T),a&&a.suspense):T.run(),()=>{T.stop(),a&&a.scope&&fr(a.scope.effects,T)}}function mh(e,t,o){const n=this.proxy,s=Be(e)?e.includes(".")?Bd(n,e):()=>n[e]:e.bind(n,n);let i;Q(t)?i=t:(i=t.handler,o=t);const r=Oe;Wo(this);const a=Od(s,i.bind(n),o);return r?Wo(r):po(),a}function Bd(e,t){const o=t.split(".");return()=>{let n=e;for(let s=0;s<o.length&&n;s++)n=n[o[s]];return n}}function co(e,t){if(!Pe(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),Ne(e))co(e.value,t);else if(U(e))for(let o=0;o<e.length;o++)co(e[o],t);else if(Go(e)||Do(e))e.forEach(o=>{co(o,t)});else if(Vl(e))for(const o in e)co(e[o],t);return e}function qa(e,t,o){const n=arguments.length;return n===2?Pe(t)&&!U(t)?jn(t)?$(e,null,[t]):$(e,t):$(e,null,t):(n>3?o=Array.prototype.slice.call(arguments,2):n===3&&jn(o)&&(o=[o]),$(e,t,o))}const bh="3.2.26",yh="http://www.w3.org/2000/svg",_o=typeof document<"u"?document:null,Ya=new Map,vh={insert:(e,t,o)=>{t.insertBefore(e,o||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,o,n)=>{const s=t?_o.createElementNS(yh,e):_o.createElement(e,o?{is:o}:void 0);return e==="select"&&n&&n.multiple!=null&&s.setAttribute("multiple",n.multiple),s},createText:e=>_o.createTextNode(e),createComment:e=>_o.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>_o.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},cloneNode(e){const t=e.cloneNode(!0);return"_value"in e&&(t._value=e._value),t},insertStaticContent(e,t,o,n){const s=o?o.previousSibling:t.lastChild;let i=Ya.get(e);if(!i){const r=_o.createElement("template");if(r.innerHTML=n?`<svg>${e}</svg>`:e,i=r.content,n){const a=i.firstChild;for(;a.firstChild;)i.appendChild(a.firstChild);i.removeChild(a)}Ya.set(e,i)}return t.insertBefore(i.cloneNode(!0),o),[s?s.nextSibling:t.firstChild,o?o.previousSibling:t.lastChild]}};function wh(e,t,o){const n=e._vtc;n&&(t=(t?[t,...n]:[...n]).join(" ")),t==null?e.removeAttribute("class"):o?e.setAttribute("class",t):e.className=t}function Ch(e,t,o){const n=e.style,s=Be(o);if(o&&!s){for(const i in o)Ni(n,i,o[i]);if(t&&!Be(t))for(const i in t)o[i]==null&&Ni(n,i,"")}else{const i=n.display;s?t!==o&&(n.cssText=o):t&&e.removeAttribute("style"),"_vod"in e&&(n.display=i)}}const Ka=/\s*!important$/;function Ni(e,t,o){if(U(o))o.forEach(n=>Ni(e,t,n));else if(t.startsWith("--"))e.setProperty(t,o);else{const n=$h(e,t);Ka.test(o)?e.setProperty(bo(n),o.replace(Ka,""),"important"):e[n]=o}}const Ja=["Webkit","Moz","ms"],di={};function $h(e,t){const o=di[t];if(o)return o;let n=vt(t);if(n!=="filter"&&n in e)return di[t]=n;n=Bs(n);for(let s=0;s<Ja.length;s++){const i=Ja[s]+n;if(i in e)return di[t]=i}return t}const Za="http://www.w3.org/1999/xlink";function kh(e,t,o,n,s){if(n&&t.startsWith("xlink:"))o==null?e.removeAttributeNS(Za,t.slice(6,t.length)):e.setAttributeNS(Za,t,o);else{const i=mu(t);o==null||i&&!Fl(o)?e.removeAttribute(t):e.setAttribute(t,i?"":o)}}function _h(e,t,o,n,s,i,r){if(t==="innerHTML"||t==="textContent"){n&&r(n,s,i),e[t]=o==null?"":o;return}if(t==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=o;const a=o==null?"":o;(e.value!==a||e.tagName==="OPTION")&&(e.value=a),o==null&&e.removeAttribute(t);return}if(o===""||o==null){const a=typeof e[t];if(a==="boolean"){e[t]=Fl(o);return}else if(o==null&&a==="string"){e[t]="",e.removeAttribute(t);return}else if(a==="number"){try{e[t]=0}catch{}e.removeAttribute(t);return}}try{e[t]=o}catch{}}let bs=Date.now,Ad=!1;if(typeof window<"u"){bs()>document.createEvent("Event").timeStamp&&(bs=()=>performance.now());const e=navigator.userAgent.match(/firefox\/(\d+)/i);Ad=!!(e&&Number(e[1])<=53)}let Wi=0;const Sh=Promise.resolve(),xh=()=>{Wi=0},Ph=()=>Wi||(Sh.then(xh),Wi=bs());function Gt(e,t,o,n){e.addEventListener(t,o,n)}function jh(e,t,o,n){e.removeEventListener(t,o,n)}function Ih(e,t,o,n,s=null){const i=e._vei||(e._vei={}),r=i[t];if(n&&r)r.value=n;else{const[a,l]=Th(t);if(n){const d=i[t]=Oh(n,s);Gt(e,a,d,l)}else r&&(jh(e,a,r,l),i[t]=void 0)}}const Qa=/(?:Once|Passive|Capture)$/;function Th(e){let t;if(Qa.test(e)){t={};let o;for(;o=e.match(Qa);)e=e.slice(0,e.length-o[0].length),t[o[0].toLowerCase()]=!0}return[bo(e.slice(2)),t]}function Oh(e,t){const o=n=>{const s=n.timeStamp||bs();(Ad||s>=o.attached-1)&&et(Bh(n,o.value),t,5,[n])};return o.value=e,o.attached=Ph(),o}function Bh(e,t){if(U(t)){const o=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{o.call(e),e._stopped=!0},t.map(n=>s=>!s._stopped&&n(s))}else return t}const el=/^on[a-z]/,Ah=(e,t,o,n,s=!1,i,r,a,l)=>{t==="class"?wh(e,n,s):t==="style"?Ch(e,o,n):Is(t)?ur(t)||Ih(e,t,o,n,r):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Eh(e,t,n,s))?_h(e,t,n,i,r,a,l):(t==="true-value"?e._trueValue=n:t==="false-value"&&(e._falseValue=n),kh(e,t,n,s))};function Eh(e,t,o,n){return n?!!(t==="innerHTML"||t==="textContent"||t in e&&el.test(t)&&Q(o)):t==="spellcheck"||t==="draggable"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||el.test(t)&&Be(o)?!1:t in e}const Lt="transition",rn="animation",Ed={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Dh=Ee({},yf.props,Ed),oo=(e,t=[])=>{U(e)?e.forEach(o=>o(...t)):e&&e(...t)},tl=e=>e?U(e)?e.some(t=>t.length>1):e.length>1:!1;function Hh(e){const t={};for(const L in e)L in Ed||(t[L]=e[L]);if(e.css===!1)return t;const{name:o="v",type:n,duration:s,enterFromClass:i=`${o}-enter-from`,enterActiveClass:r=`${o}-enter-active`,enterToClass:a=`${o}-enter-to`,appearFromClass:l=i,appearActiveClass:d=r,appearToClass:c=a,leaveFromClass:f=`${o}-leave-from`,leaveActiveClass:h=`${o}-leave-active`,leaveToClass:b=`${o}-leave-to`}=e,y=Mh(s),k=y&&y[0],T=y&&y[1],{onBeforeEnter:D,onEnter:H,onEnterCancelled:x,onLeave:O,onLeaveCancelled:Z,onBeforeAppear:K=D,onAppear:G=H,onAppearCancelled:te=x}=t,oe=(L,ke,ze)=>{ro(L,ke?c:a),ro(L,ke?d:r),ze&&ze()},pe=(L,ke)=>{ro(L,b),ro(L,h),ke&&ke()},fe=L=>(ke,ze)=>{const nt=L?G:H,_e=()=>oe(ke,L,ze);oo(nt,[ke,_e]),ol(()=>{ro(ke,L?l:i),St(ke,L?c:a),tl(nt)||nl(ke,n,k,_e)})};return Ee(t,{onBeforeEnter(L){oo(D,[L]),St(L,i),St(L,r)},onBeforeAppear(L){oo(K,[L]),St(L,l),St(L,d)},onEnter:fe(!1),onAppear:fe(!0),onLeave(L,ke){const ze=()=>pe(L,ke);St(L,f),Hd(),St(L,h),ol(()=>{ro(L,f),St(L,b),tl(O)||nl(L,n,T,ze)}),oo(O,[L,ze])},onEnterCancelled(L){oe(L,!1),oo(x,[L])},onAppearCancelled(L){oe(L,!0),oo(te,[L])},onLeaveCancelled(L){pe(L),oo(Z,[L])}})}function Mh(e){if(e==null)return null;if(Pe(e))return[ci(e.enter),ci(e.leave)];{const t=ci(e);return[t,t]}}function ci(e){return Sn(e)}function St(e,t){t.split(/\s+/).forEach(o=>o&&e.classList.add(o)),(e._vtc||(e._vtc=new Set)).add(t)}function ro(e,t){t.split(/\s+/).forEach(n=>n&&e.classList.remove(n));const{_vtc:o}=e;o&&(o.delete(t),o.size||(e._vtc=void 0))}function ol(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Rh=0;function nl(e,t,o,n){const s=e._endId=++Rh,i=()=>{s===e._endId&&n()};if(o)return setTimeout(i,o);const{type:r,timeout:a,propCount:l}=Dd(e,t);if(!r)return n();const d=r+"end";let c=0;const f=()=>{e.removeEventListener(d,h),i()},h=b=>{b.target===e&&++c>=l&&f()};setTimeout(()=>{c<l&&f()},a+1),e.addEventListener(d,h)}function Dd(e,t){const o=window.getComputedStyle(e),n=y=>(o[y]||"").split(", "),s=n(Lt+"Delay"),i=n(Lt+"Duration"),r=sl(s,i),a=n(rn+"Delay"),l=n(rn+"Duration"),d=sl(a,l);let c=null,f=0,h=0;t===Lt?r>0&&(c=Lt,f=r,h=i.length):t===rn?d>0&&(c=rn,f=d,h=l.length):(f=Math.max(r,d),c=f>0?r>d?Lt:rn:null,h=c?c===Lt?i.length:l.length:0);const b=c===Lt&&/\b(transform|all)(,|$)/.test(o[Lt+"Property"]);return{type:c,timeout:f,propCount:h,hasTransform:b}}function sl(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((o,n)=>il(o)+il(e[n])))}function il(e){return Number(e.slice(0,-1).replace(",","."))*1e3}function Hd(){return document.body.offsetHeight}const Md=new WeakMap,Rd=new WeakMap,Fh={name:"TransitionGroup",props:Ee({},Dh,{tag:String,moveClass:String}),setup(e,{slots:t}){const o=Ar(),n=ad();let s,i;return Pr(()=>{if(!s.length)return;const r=e.moveClass||`${e.name||"v"}-move`;if(!Vh(s[0].el,o.vnode.el,r))return;s.forEach(Lh),s.forEach(Nh);const a=s.filter(Wh);Hd(),a.forEach(l=>{const d=l.el,c=d.style;St(d,r),c.transform=c.webkitTransform=c.transitionDuration="";const f=d._moveCb=h=>{h&&h.target!==d||(!h||/transform$/.test(h.propertyName))&&(d.removeEventListener("transitionend",f),d._moveCb=null,ro(d,r))};d.addEventListener("transitionend",f)})}),()=>{const r=ce(e),a=Hh(r);let l=r.tag||N;s=i,i=t.default?Sr(t.default()):[];for(let d=0;d<i.length;d++){const c=i[d];c.key!=null&&No(c,Pn(c,a,n,o))}if(s)for(let d=0;d<s.length;d++){const c=s[d];No(c,Pn(c,a,n,o)),Md.set(c,c.el.getBoundingClientRect())}return $(l,null,i)}}},vS=Fh;function Lh(e){const t=e.el;t._moveCb&&t._moveCb(),t._enterCb&&t._enterCb()}function Nh(e){Rd.set(e,e.el.getBoundingClientRect())}function Wh(e){const t=Md.get(e),o=Rd.get(e),n=t.left-o.left,s=t.top-o.top;if(n||s){const i=e.el.style;return i.transform=i.webkitTransform=`translate(${n}px,${s}px)`,i.transitionDuration="0s",e}}function Vh(e,t,o){const n=e.cloneNode();e._vtc&&e._vtc.forEach(r=>{r.split(/\s+/).forEach(a=>a&&n.classList.remove(a))}),o.split(/\s+/).forEach(r=>r&&n.classList.add(r)),n.style.display="none";const s=t.nodeType===1?t:t.parentNode;s.appendChild(n);const{hasTransform:i}=Dd(n);return s.removeChild(n),i}const Vo=e=>{const t=e.props["onUpdate:modelValue"];return U(t)?o=>Ho(t,o):t};function zh(e){e.target.composing=!0}function rl(e){const t=e.target;t.composing&&(t.composing=!1,Uh(t,"input"))}function Uh(e,t){const o=document.createEvent("HTMLEvents");o.initEvent(t,!0,!0),e.dispatchEvent(o)}const je={created(e,{modifiers:{lazy:t,trim:o,number:n}},s){e._assign=Vo(s);const i=n||s.props&&s.props.type==="number";Gt(e,t?"change":"input",r=>{if(r.target.composing)return;let a=e.value;o?a=a.trim():i&&(a=Sn(a)),e._assign(a)}),o&&Gt(e,"change",()=>{e.value=e.value.trim()}),t||(Gt(e,"compositionstart",zh),Gt(e,"compositionend",rl),Gt(e,"change",rl))},mounted(e,{value:t}){e.value=t==null?"":t},beforeUpdate(e,{value:t,modifiers:{lazy:o,trim:n,number:s}},i){if(e._assign=Vo(i),e.composing||document.activeElement===e&&(o||n&&e.value.trim()===t||(s||e.type==="number")&&Sn(e.value)===t))return;const r=t==null?"":t;e.value!==r&&(e.value=r)}},Gh={deep:!0,created(e,t,o){e._assign=Vo(o),Gt(e,"change",()=>{const n=e._modelValue,s=On(e),i=e.checked,r=e._assign;if(U(n)){const a=cr(n,s),l=a!==-1;if(i&&!l)r(n.concat(s));else if(!i&&l){const d=[...n];d.splice(a,1),r(d)}}else if(Go(n)){const a=new Set(n);i?a.add(s):a.delete(s),r(a)}else r(Fd(e,i))})},mounted:al,beforeUpdate(e,t,o){e._assign=Vo(o),al(e,t,o)}};function al(e,{value:t,oldValue:o},n){e._modelValue=t,U(t)?e.checked=cr(t,n.props.value)>-1:Go(t)?e.checked=t.has(n.props.value):t!==o&&(e.checked=An(t,Fd(e,!0)))}const lt={deep:!0,created(e,{value:t,modifiers:{number:o}},n){const s=Go(t);Gt(e,"change",()=>{const i=Array.prototype.filter.call(e.options,r=>r.selected).map(r=>o?Sn(On(r)):On(r));e._assign(e.multiple?s?new Set(i):i:i[0])}),e._assign=Vo(n)},mounted(e,{value:t}){ll(e,t)},beforeUpdate(e,t,o){e._assign=Vo(o)},updated(e,{value:t}){ll(e,t)}};function ll(e,t){const o=e.multiple;if(!(o&&!U(t)&&!Go(t))){for(let n=0,s=e.options.length;n<s;n++){const i=e.options[n],r=On(i);if(o)U(t)?i.selected=cr(t,r)>-1:i.selected=t.has(r);else if(An(On(i),t)){e.selectedIndex!==n&&(e.selectedIndex=n);return}}!o&&e.selectedIndex!==-1&&(e.selectedIndex=-1)}}function On(e){return"_value"in e?e._value:e.value}function Fd(e,t){const o=t?"_trueValue":"_falseValue";return o in e?e[o]:t}const Xh=["ctrl","shift","alt","meta"],qh={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>Xh.some(o=>e[`${o}Key`]&&!t.includes(o))},q=(e,t)=>(o,...n)=>{for(let s=0;s<t.length;s++){const i=qh[t[s]];if(i&&i(o,t))return}return e(o,...n)},Yh={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Ke=(e,t)=>o=>{if(!("key"in o))return;const n=bo(o.key);if(t.some(s=>s===n||Yh[s]===n))return e(o)},Kh=Ee({patchProp:Ah},vh);let dl;function Jh(){return dl||(dl=Wf(Kh))}const Zh=(...e)=>{const t=Jh().createApp(...e),{mount:o}=t;return t.mount=n=>{const s=Qh(n);if(!s)return;const i=t._component;!Q(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.innerHTML="";const r=o(s,!1,s instanceof SVGElement);return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),r},t};function Qh(e){return Be(e)?document.querySelector(e):e}const ep="modulepreload",tp=function(e,t){return new URL(e,t).href},cl={},ul=function(t,o,n){return!o||o.length===0?t():Promise.all(o.map(s=>{if(s=tp(s,n),s in cl)return;cl[s]=!0;const i=s.endsWith(".css"),r=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${r}`))return;const a=document.createElement("link");if(a.rel=i?"stylesheet":ep,i||(a.as="script",a.crossOrigin=""),a.href=s,document.head.appendChild(a),i)return new Promise((l,d)=>{a.addEventListener("load",l),a.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())};function op(e){return{all:e=e||new Map,on:function(t,o){var n=e.get(t);n?n.push(o):e.set(t,[o])},off:function(t,o){var n=e.get(t);n&&(o?n.splice(n.indexOf(o)>>>0,1):e.set(t,[]))},emit:function(t,o){var n=e.get(t);n&&n.slice().map(function(s){s(o)}),(n=e.get("*"))&&n.slice().map(function(s){s(t,o)})}}}const ui=op(),we={fire(e){ui.emit(e.kind,e)},subscribe(e,t){ui.on(e.kind,t)},unsubscribe(e,t){ui.off(e.kind,t)}};class ys{constructor(t){v(this,"kind","AssetFailureEvent");this.path=t}}v(ys,"kind","AssetFailureEvent");class Rr{constructor(t){v(this,"kind","FailureEvent");this.message=t}}v(Rr,"kind","FailureEvent");class Fr{constructor(t){v(this,"kind","CustomAssetFailureEvent");this.error=t}}v(Fr,"kind","CustomAssetFailureEvent");class Lr{constructor(){v(this,"kind","InvalidateRenderEvent")}}v(Lr,"kind","InvalidateRenderEvent");class it{constructor(t){v(this,"kind","ShowMessageEvent");this.message=t}}v(it,"kind","ShowMessageEvent");class Nr{constructor(t,o){v(this,"kind","ResolvableErrorEvent");this.message=t,this.actions=o}}v(Nr,"kind","ResolvableErrorEvent");class vs{constructor(t){v(this,"kind","ColorPickedEvent");this.color=t}}v(vs,"kind","ColorPickedEvent");class Ld{constructor(t,o){v(this,"kind","VueErrorEvent");this.error=t,this.info=o}}v(Ld,"kind","VueErrorEvent");const np="https://edave64.github.io/Doki-Doki-Dialog-Generator-Packs/",Ge=class{constructor(t,o,n){v(this,"onlineRepo");v(this,"localRepo");v(this,"tempRepo",Dt({authors:{},packs:[]}));v(this,"combinedList");v(this,"authors");this.$store=n,window.repo=this,t||(t={authors:{},packs:[]},we.fire(new it("Couldn't load remote repository."))),o||(o={authors:{},packs:[]},ee.supports.localRepo&&we.fire(new it("Couldn't load local repository."))),this.onlineRepo=Ro(t),this.localRepo=Ro(o),this.combinedList=Oi(()=>{var D,H;const s=this.onlineRepo.value,i=(D=s==null?void 0:s.packs)!=null?D:[],r=new Map(i.map(x=>[x.id,x])),a=this.localRepo.value,l=(H=a==null?void 0:a.packs)!=null?H:[],d=new Map(l.map(x=>[x.id,x])),f=this.tempRepo.packs,h=new Map(f.map(x=>[x.id,x])),b=new Set(ee.state.autoAdd),y=this.$store.state.content.contentPacks.map(x=>x.packId).filter(x=>x!=null),k=new Set(y),T=new Set;return[...y,...l.map(x=>x.id),...i.map(x=>x.id),...f.map(x=>x.id)].filter(x=>x.startsWith("dddg.buildin.")||x.startsWith("dddg.desktop.")||x==="concept_femc.shido_draws.edave64"||x==="mc.storm_blaze.edave64"||T.has(x)?!1:(T.add(x),!0)).map(x=>{var O,Z,K;return{...(O=r.get(x))!=null?O:{characters:[],kind:[],authors:[]},...(Z=d.get(x))!=null?Z:{},...(K=h.get(x))!=null?K:{},autoloading:b.has(x),installed:d.has(x),online:r.has(x)||h.has(x),loaded:k.has(x)}})}),this.authors=Oi(()=>{var l,d;const s=this.onlineRepo.value,i=(l=s==null?void 0:s.authors)!=null?l:{},r=this.localRepo.value,a=(d=r==null?void 0:r.authors)!=null?d:{};return{...i,...a}}),Object.freeze(this)}static getInstance(){return Ge.instance||(Ge.instance=this.createInstance()),Ge.instance}static async createInstance(){const t=Ge.loadRepo(np),o=ee.supports.localRepo?await Ge.loadRepo(ee.localRepositoryUrl):null,[n,s,i]=await Promise.all([t,o,Ge.$store]);return new Ge(n,s,i)}static async loadRepo(t){try{const[o,n]=await Promise.all([Ge.fetchJSON(t+"repo.json"),Ge.fetchJSON(t+"people.json")]);return{packs:o,authors:n}}catch{return null}}static async fetchJSON(t){const o=await fetch(t);if(!o.ok)throw new Error("Could not load json");return await o.json()}async reloadLocalRepo(){this.localRepo.value=ee.supports.localRepo?await Ge.loadRepo(ee.localRepositoryUrl):null}getPacks(){return this.combinedList.value}hasPack(t,o=!1){var n;return o?!!((n=this.onlineRepo.value)!=null&&n.packs.find(s=>s.id===t)):!!this.getPacks().find(s=>s.id===t)}getPack(t){var o;return(o=this.getPacks().find(n=>n.id===t))!=null?o:null}getAuthor(t){return this.authors.value[t]||null}getAuthors(){return this.authors.value}async loadTempPack(t){const o=fetch(t);let n;try{n=await o}catch{throw new Error(`Failed to load '${t}'`)}let s;try{s=await n.json()}catch(r){throw new Error(`The contents of '${t}' is not a valid JSON: ${r.message}`)}if(!s.pack)throw new Error(`The json file '${t}' does not contain any packages`);if(s.authors)for(const r in s.authors)this.tempRepo.authors[r]&&(this.tempRepo.authors[r]=s.authors[r]);const i=s.pack;return i.repoUrl=t,this.tempRepo.packs.find(r=>r.id===i.id)||this.tempRepo.packs.push(i),i.id}};let Ot=Ge;v(Ot,"instance"),v(Ot,"setStore"),v(Ot,"$store",new Promise((t,o)=>{Ge.setStore=t}));const ws=navigator.userAgent,sp=!!ws.match(/iPad/i)||!!ws.match(/iPhone/i),ip=!!ws.match(/WebKit/i),rp=sp&&ip&&!ws.match(/CriOS/i);class Nd{constructor(){v(this,"state",Dt({looseTextParsing:!0,autoAdd:[],downloadLocation:"Default download folder"}));v(this,"supports");v(this,"_gameMode",null);v(this,"vuexHistory",null);v(this,"$store",null);v(this,"isSavingEnabled",Ro(!1));v(this,"localRepositoryUrl","");v(this,"loading");v(this,"creatingDB");v(this,"loadingContentPacksAllowed");v(this,"loadContentPacks");const t=this,o=Te.canSave();window.addEventListener("beforeunload",function(n){n.preventDefault(),n.returnValue="Are you sure you want to leave? All your progress will be lost!"}),this.loadingContentPacksAllowed=new Promise((n,s)=>{this.loadContentPacks=()=>n()}),this.supports=Dt({optionalSaving:o,get autoLoading(){return o&&t.isSavingEnabled.value},backgroundInstall:!1,localRepo:!1,lq:!0,setDownloadFolder:!1,openableFolders:new Set([]),assetCaching:!rp}),o?this.loading=(async()=>{this.savingEnabled=await Te.doesDbExists()})():this.loading=Promise.resolve(),this.loading.then(async()=>{var n;if(await this.loadingContentPacksAllowed,this.creatingDB&&await this.creatingDB,this.savingEnabled){const s=(n=await Te.loadAutoload())!=null?n:[];this.state.autoAdd=s;const i=await Ot.getInstance(),r=await Promise.all(s.map(async a=>{var f;const[l,d]=a.split(";",2);d!=null&&!i.hasPack(l)&&await i.loadTempPack(d);const c=i.getPack(l);return(f=c.dddg2Path)!=null?f:c.dddg1Path}));await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/loadContentPacks",r)})}})}get gameMode(){return this._gameMode}get savingEnabled(){return this.isSavingEnabled.value}set savingEnabled(t){t?(localStorage.setItem("saving","true"),this.creatingDB=Te.createDB(),this.creatingDB.then(()=>{this.creatingDB=void 0,this.isSavingEnabled.value=!0}).catch(()=>{})):(localStorage.clear(),this.isSavingEnabled.value=!1,this.creatingDB=Te.clearDB().then(()=>{this.creatingDB=void 0}).catch(()=>{}))}async loadGameMode(){const o=new URLSearchParams(location.search).get("mode");if(o==="ddlc"||o==="ddlc_plus"){this._gameMode=o;return}await this.loading,await this.creatingDB;let n="";this.isSavingEnabled.value&&(n=await Te.loadGameMode());let s="ddlc";(n==="ddlc"||n==="ddlc_plus")&&(s=n),this._gameMode=s}async setGameMode(t){this.isSavingEnabled.value&&await Te.saveGameMode(t);const o=`${location.protocol}//${location.host}${location.pathname}`;location.href=`${o}?mode=${t}`}updateDownloadFolder(){throw new Error("Method not implemented.")}openFolder(t){throw new Error("Method not implemented.")}connectToStore(t,o){this.vuexHistory=t,this.$store=o}async saveToFile(t,o,n="image/png",s=1){const i=document.createElement("a");i.setAttribute("download",o);const r=await this.createObjectURL(t,n,s);return i.setAttribute("href",r),document.body.appendChild(i),i.click(),document.body.removeChild(i),r}installBackground(t){throw new Error("This environment does not support installing backgrounds")}uninstallBackground(t){throw new Error("This environment does not support uninstalling backgrounds")}localRepoInstall(t,o,n){throw new Error("This environment does not support a local repository")}localRepoUninstall(t){throw new Error("This environment does not support a local repository")}async autoLoadAdd(t){await this.loading,await this.creatingDB,await Te.saveAutoload([...this.state.autoAdd,t]),this.state.autoAdd.push(t)}async autoLoadRemove(t){await this.loading,await this.creatingDB;const o=this.normalizePackId(t);await Te.saveAutoload(this.state.autoAdd.filter(s=>this.normalizePackId(s)!=o));const n=this.state.autoAdd.indexOf(t);this.state.autoAdd.splice(n,1)}normalizePackId(t){const o=t.split(";");return o.length===1?o[0]:o[o.length-1]}async loadSettings(){await this.loading,await this.creatingDB;const t={darkMode:void 0,lq:!0,nsfw:!1,defaultCharacterTalkingZoom:!0,looseTextParsing:!0};return this.isSavingEnabled.value?{...t,...await Te.loadSettings()}:t}async saveSettings(t){await this.loading,await this.creatingDB,this.isSavingEnabled.value&&await Te.saveSettings(t)}async isInitialized(){await this.loading,await this.creatingDB}prompt(t,o){return new Promise((n,s)=>{n(prompt(t,o))})}onPanelChange(t){}createObjectURL(t,o,n){return new Promise((s,i)=>{if(!(window.URL!=null&&window.URL.createObjectURL!=null))return s(t.toDataURL(o,n));if(t.toBlob!=null)t.toBlob(a=>{if(!a){i();return}s(URL.createObjectURL(a))},o,n);else{const a=t.toDataURL(o,n),l=this.dataURItoBlob(a,o);s(URL.createObjectURL(l))}})}dataURItoBlob(t,o){const n=atob(t.split(",")[1]),s=n.length,i=new Uint8Array(s);for(let r=0;r<s;r++)i[r]=n.charCodeAt(r);return new Blob([i],{type:o})}}const Te={indexedDB:(()=>{var e,t,o;try{return(o=(t=(e=window.indexedDB)!=null?e:window.mozIndexedDB)!=null?t:window.webkitIndexedDB)!=null?o:window.msIndexedDB}catch{return null}})(),transaction:(()=>{try{return window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction}catch{return null}})(),db:null,canSave(){return!!(Te.indexedDB&&window.localStorage!=null)},doesDbExists(){return localStorage.getItem("saving")==="true"?Promise.resolve(!0):Promise.resolve(!1)},createDB(){return Te.db?Te.db:Te.db=new Promise((e,t)=>{const o=Te.indexedDB.open("dddg",3);o.onerror=n=>{t(n)},o.onupgradeneeded=n=>{var r;const s=n.target.result,i=(r=n.oldVersion)!=null?r:n.version;i<1&&s.createObjectStore("settings"),i===1&&(s.deleteObjectStore("settings"),s.createObjectStore("settings"))},o.onsuccess=n=>{e(o.result)}})},clearDB(){return new Promise((e,t)=>{if(!Te.db){e();return}const o=Te.indexedDB.deleteDatabase("dddg");Te.db=null,o.onerror=n=>{t(n)},o.onsuccess=n=>{e()}})},loadAutoload(){return this.objectStorePromise("readonly",async e=>await this.reqPromise(e.get("autoload")))},saveAutoload(e){return this.objectStorePromise("readwrite",async t=>{await this.reqPromise(t.put([...e],"autoload"))})},loadGameMode(){return this.objectStorePromise("readonly",async e=>await this.reqPromise(e.get("gameMode")))},saveGameMode(e){return this.objectStorePromise("readwrite",async t=>{await this.reqPromise(t.put(e,"gameMode"))})},saveSettings(e){return this.objectStorePromise("readwrite",async t=>{await this.reqPromise(t.put({...e},"settings"))})},loadSettings(){return this.objectStorePromise("readonly",async e=>await this.reqPromise(e.get("settings")))},objectStorePromise(e,t){return this.db?new Promise(async(o,n)=>{const i=(await this.db).transaction(["settings"],e).objectStore("settings");try{o(await t(i))}catch(r){n(r)}}):Promise.reject(new Error("No database"))},reqPromise(e){return new Promise((t,o)=>{e.onerror=n=>{o(n)},e.onsuccess=n=>{t(e.result)}})}};class ap extends Nd{async saveToFile(t,o,n="image/png",s=1){let i=t.toDataURL(n,s);const r=this.dataURItoBlob(i,n);return window.URL!=null&&window.URL.createObjectURL!=null&&(i=URL.createObjectURL(r)),window.navigator.msSaveBlob(r,o),i}}class Vi{constructor(){v(this,"width",0);v(this,"height",0)}paintOnto(t){}}class Hn{constructor(t){v(this,"width");v(this,"height");this.html=t,this.width=t.width,this.height=t.height}paintOnto(t,o={}){const{w:n,h:s}={w:this.width,h:this.height,...o},{x:i,y:r}={x:-n/2,y:-s/2,...o};t.drawImage(this.html,i,r,n,s)}}let fi;function zo(){return fi||(fi=new Promise((e,t)=>{const o="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=",n=document.createElement("img");n.addEventListener("load",()=>{e(n.width===2&&n.height===1)}),n.addEventListener("error",()=>{e(!1)}),n.src=o}))}let hi;function lp(){return hi||(hi=new Promise((e,t)=>{const o="data:image/heic;base64,AAAAGGZ0eXBoZWljAAAAAG1pZjFoZWljAAAAsW1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAHBpY3QAXABjAGMAcwBsAGEAAAAADnBpdG0AAAAAAAEAAAAQaWxvYwAAAABEQAAAAAAAI2lpbmYAAAAAAAEAAAAVaW5mZQIAAAAAAQAAaHZjMQAAAABDaXBycAAAACdpcGNvAAAAH2h2Y0NmzGx1ci0AAAAAAABv9HP+//v9bjr3AAAAABRpcG1hAAAAAAAAAAEAAQGBAAAACG1kYXQ=",n=document.createElement("img");n.addEventListener("load",()=>{console.log("Heif no error. "+(n.width===2&&n.height===1)),e(n.width===2&&n.height===1)}),n.addEventListener("error",()=>{console.log("Heif not supported"),e(!1)}),n.src=o}))}const an={},Cs={};function qo(e,t=!0){return Wr(ee.supports.lq&&!t?e.lq:e.hq)}async function Wr(e){return an[e]?an[e]:an[e]=(async()=>{try{return await fl(e)}catch{if(e.endsWith(".webp"))try{return await fl(e.replace(/\.webp$/,".png"))}catch{return we.fire(new ys(e)),an[e]=void 0,new Vi}else return we.fire(new ys(e)),an[e]=void 0,new Vi}})()}const dp="./";async function At(e,t=!0){if(Cs[e])return Cs[e];const o=`${dp}/assets/${e}${t?"":".lq"}${await zo()?".webp":".png"}`.replace(/\/+/,"/");return await Wr(o)}function cp(e,t){const o=URL.createObjectURL(t);return zi(e,o),o}function zi(e,t){return Cs[e]=new Promise((o,n)=>{const s=new Image;s.addEventListener("load",()=>{o(new Hn(s))}),s.addEventListener("error",i=>{we.fire(new Fr(i)),n(`Failed to load "${t}"`)}),s.crossOrigin="Anonymous",s.src=t,s.style.display="none",ee.supports.assetCaching?document.body.appendChild(s):Cs[e]=void 0})}function fl(e){return new Promise((t,o)=>{const n=new Image;n.addEventListener("load",()=>{t(new Hn(n))}),n.addEventListener("error",s=>{o(s)}),n.crossOrigin="Anonymous",n.src=e,n.style.display="none",document.body.appendChild(n)})}const hl={packId:"dddg.buildin.installedBackgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]};class up{constructor(){v(this,"state",Dt({looseTextParsing:!0,autoAdd:[],downloadLocation:""}));v(this,"localRepositoryUrl","/repo/");v(this,"_gameMode",null);v(this,"electron",window);v(this,"vuexHistory",null);v(this,"$store",null);v(this,"bgInvalidation",null);v(this,"pendingContentPacks",[]);v(this,"pendingContentPacksReplace",[]);v(this,"loadingContentPacksAllowed");v(this,"loadContentPacks");v(this,"supports",{autoLoading:!0,backgroundInstall:!0,localRepo:!0,lq:!1,optionalSaving:!1,setDownloadFolder:!0,openableFolders:new Set(["downloads","backgrounds","sprites"]),assetCaching:!0});v(this,"savingEnabled",!0);this.loadingContentPacksAllowed=new Promise((o,n)=>{this.loadContentPacks=()=>o()}),this.electron.ipcRenderer.on("add-persistent-content-pack",async o=>{if(await this.loadingContentPacksAllowed,!this.$store||!this.vuexHistory){this.pendingContentPacks.push(o);return}await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/loadContentPacks",o)})}),this.electron.ipcRenderer.on("add-persistent-background",async o=>{const n="persistentBg-"+o,s=o.split("/");await zi(n,o),hl.backgrounds.push({id:n,variants:[[n]],label:s[s.length-1],scaling:"none"}),this.invalidateInstalledBGs()}),this.electron.ipcRenderer.on("push-message",async o=>{we.fire(new it(o))}),this.electron.ipcRenderer.on("config.downloadFolderUpdate",async o=>{this.state.downloadLocation=o}),this.electron.ipcRenderer.onConversation("load-packs",async o=>{const n=await Ot.getInstance(),s=await Promise.all(o.map(async i=>{const[r,a]=i.split(";",2);a!=null&&!n.hasPack(r)&&await n.loadTempPack(a);const l=n.getPack(r);return l.dddg2Path||l.dddg1Path}));if(!this.$store||!this.vuexHistory){s.forEach(i=>this.pendingContentPacks.push(i));return}await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/loadContentPacks",s)})}),this.electron.ipcRenderer.onConversation("auto-load.changed",async o=>{this.state.autoAdd=o}),this.electron.ipcRenderer.onConversation("reload-repo",async()=>{await(await Ot.getInstance()).reloadLocalRepo()}),this.electron.ipcRenderer.onConversation("replace-pack",async o=>{const n={processed:!1,contentPack:o};!this.$store||!this.vuexHistory?this.pendingContentPacksReplace.push(n):await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/replaceContentPack",n)})}),this.electron.ipcRenderer.onConversation("resolvable-error",(o,n)=>new Promise((s,i)=>{we.fire(new Nr(o,n.map(r=>({exec:()=>s(r),name:r}))))}));let t=!1;this.electron.ipcRenderer.on("update.progress",o=>{o==="done"?(t=!1,we.fire(new it("An update is ready and will be installed once DDDG closes."))):t||(t=!0,we.fire(new it("An update is ready and will be installed once DDDG closes.")))}),this.electron.ipcRenderer.send("init-dddg")}get gameMode(){return this._gameMode}updateDownloadFolder(){this.electron.ipcRenderer.send("config.newDownloadFolder")}openFolder(t){this.electron.ipcRenderer.send("open-folder",t)}onPanelChange(t){}async saveSettings(t){var o;await this.electron.ipcRenderer.sendConvo("config.set","nsfw",t.nsfw),await this.electron.ipcRenderer.sendConvo("config.set","darkMode",(o=t.darkMode)!=null?o:void 0),await this.electron.ipcRenderer.sendConvo("config.set","defaultCharacterTalkingZoom",t.defaultCharacterTalkingZoom)}async loadGameMode(){this._gameMode=await this.electron.ipcRenderer.sendConvo("config.get","gameMode")||"ddlc"}async setGameMode(t){await this.electron.ipcRenderer.sendConvo("config.set","gameMode",t),this.electron.ipcRenderer.send("reload")}async loadSettings(){var t,o,n;return{lq:!1,nsfw:(t=await this.electron.ipcRenderer.sendConvo("config.get","nsfw"))!=null?t:!1,darkMode:(o=await this.electron.ipcRenderer.sendConvo("config.get","darkMode"))!=null?o:void 0,defaultCharacterTalkingZoom:(n=await this.electron.ipcRenderer.sendConvo("config.get","defaultCharacterTalkingZoom"))!=null?n:void 0}}async localRepoInstall(t,o,n){await this.electron.ipcRenderer.sendConvo("repo.install",t,o,n)}async localRepoUninstall(t){await this.electron.ipcRenderer.sendConvo("repo.uninstall",t)}async autoLoadAdd(t){await this.electron.ipcRenderer.sendConvo("auto-load.add",t)}async autoLoadRemove(t){await this.electron.ipcRenderer.sendConvo("auto-load.remove",t)}saveToFile(t,o,n="image/png",s=1){return new Promise((i,r)=>{t.toBlob(async a=>{if(!a){r();return}const l=await a.arrayBuffer();await this.electron.ipcRenderer.sendConvo("save-file",o,new Uint8Array(l)),i(URL.createObjectURL(a))},n,s)})}async installBackground(t){if(t.assets.length!==1||t.assets[0].sourcePack!=="dddg.buildin.uploadedBackgrounds")return;const o=await At(t.assets[0].hq,!0);if(!(o instanceof HTMLImageElement))return;const n=await fetch(o.src),s=new Uint8Array(await n.arrayBuffer());this.electron.ipcRenderer.send("install-background",s)}async uninstallBackground(t){if(t.assets.length!==1||t.assets[0].sourcePack!=="dddg.buildin.installedBackgrounds")return;const o=await At(t.assets[0].hq,!0);if(o instanceof HTMLImageElement){if(!o.src.startsWith("blob:")){const s=await(await fetch(o.src)).blob(),i=URL.createObjectURL(s);await zi(t.assets[0].hq,i)}this.electron.ipcRenderer.send("uninstall-background",t.id)}}async prompt(t,o){return await this.electron.ipcRenderer.sendConvo("show-prompt",t,o)}connectToStore(t,o){this.vuexHistory=t,this.$store=o,this.invalidateInstalledBGs(),this.vuexHistory.transaction(async()=>{if(this.pendingContentPacks.length>0&&await this.$store.dispatch("content/loadContentPacks",this.pendingContentPacks),this.pendingContentPacksReplace.length>0)for(const n of this.pendingContentPacksReplace)await this.$store.dispatch("content/replaceContentPack",n)})}invalidateInstalledBGs(){!this.vuexHistory||!this.$store||this.bgInvalidation===null&&(this.bgInvalidation=requestAnimationFrame(()=>{this.updateInstalledBGs()}))}updateInstalledBGs(){this.bgInvalidation!=null&&(cancelAnimationFrame(this.bgInvalidation),this.bgInvalidation=null),!(!this.vuexHistory||!this.$store)&&this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/replaceContentPack",{contentPack:hl})})}}function fp(){return window.isElectron?new up:"msSaveOrOpenBlob"in window.navigator?new ap:new Nd}const Wd=fp();window.toast=Wd;const ee=Wd,hp=ne({props:{label:String,modelValue:{type:Boolean,default:!1}},computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},checkbox(){return this.$refs.checkbox}}});const se=(e,t)=>{const o=e.__vccOpts||e;for(const[n,s]of t)o[n]=s;return o},pp={class:"toggle_box"},gp=["id"],mp=["for"],bp=["for"];function yp(e,t,o,n,s,i){return m(),C("div",pp,[de(u("input",{id:e._.uid,type:"checkbox",ref:"checkbox","onUpdate:modelValue":t[0]||(t[0]=r=>e.value=r)},null,8,gp),[[Gh,e.value]]),u("label",{for:e._.uid,class:"switch"},null,8,mp),u("label",{for:e._.uid,class:"toggle_label"},he(e.label),9,bp)])}const wt=se(hp,[["render",yp]]),Vr={methods:{verticalScrollRedirect(e){if(e.type!=="wheel"||!e.currentTarget)return;const t=e.currentTarget,o=getComputedStyle(t),n=e;if(n.deltaY===0)return;if(o.overflowY==="auto"){if(n.deltaY>0){if(t.scrollHeight>t.scrollTop+t.clientHeight){e.stopPropagation();return}}else if(t.scrollTop>0){e.stopPropagation();return}}const s=t.scrollLeft;t.scrollLeft+=n.deltaY,t.scrollLeft!==s&&e.stopPropagation()}}},tt={mixins:[Vr],computed:{vertical(){return this.$store.state.ui.vertical}},mounted(){this.updateVertical(),this.$el.addEventListener("wheel",e=>{this.vertical||this.verticalScrollRedirect(e)},{passive:!0})},methods:{updateVertical(){!this.$el||(this.vertical?this.$el.classList.add("vertical"):this.$el.classList.remove("vertical"))}},watch:{vertical(){this.updateVertical()}}},vp=window.HTMLDialogElement!=null,wp=ne({props:{noBaseSize:Boolean,options:{type:Array,default:[]}},computed:{nativeDialogs(){return vp}},methods:{open(){if(this.nativeDialogs){const e=this.$refs.dialog;e&&!e.open&&e.showModal()}window.addEventListener("click",this.clickSomewhere)},close(){if(this.nativeDialogs){const e=this.$refs.dialog;e&&e.open&&e.close(),this.$emit("leave")}window.removeEventListener("click",this.clickSomewhere)},clickSomewhere(e){const t=this.$refs.dialog;t&&t.open?e.target===t&&(this.close(),e.preventDefault(),e.stopPropagation()):window.removeEventListener("click",this.clickSomewhere)}},mounted(){this.open()},activated(){this.open()},deactivated(){this.close()},unmounted(){this.close()}});const Cp={key:0,id:"submit-options"},$p=["onClick"],kp={key:0,id:"submit-options"},_p=["onClick"];function Sp(e,t,o,n,s,i){return e.nativeDialogs?(m(),C("dialog",{key:0,ref:"dialog",class:le(["native",{"base-size":!e.noBaseSize}]),onCancel:t[0]||(t[0]=(...r)=>e.close&&e.close(...r))},[Bt(e.$slots,"default",{},void 0,!0),e.options.length>0?(m(),C("div",Cp,[(m(!0),C(N,null,$e(e.options,r=>(m(),C("button",{key:r,class:"option",onClick:a=>e.$emit("option",r)},he(r),9,$p))),128))])):X("",!0)],34)):(m(),C("div",{key:1,class:"dialog-wrapper",onClick:t[2]||(t[2]=r=>e.$emit("leave"))},[u("dialog",{ref:"dialog",open:"",class:le({"base-size":!e.noBaseSize}),onClick:t[1]||(t[1]=q(()=>{},["stop"]))},[Bt(e.$slots,"default",{},void 0,!0),e.options.length>0?(m(),C("div",kp,[(m(!0),C(N,null,$e(e.options,r=>(m(),C("button",{key:r,class:"option",onClick:a=>e.$emit("option",r)},he(r),9,_p))),128))])):X("",!0)],2)]))}const zr=se(wp,[["render",Sp],["__scopeId","data-v-dfb4ac8d"]]),xp=ne({mixins:[Vr],props:{to:{type:String,required:!0}},computed:{href(){let e=this.to;return e=e.replace(/^github:\/\//,"https://github.com/edave64/Doki-Doki-Dialog-Generator/"),e=e.replace(/^wiki:\/\/(.*)/,(t,o)=>"https://github.com/edave64/Doki-Doki-Dialog-Generator/wiki/Version-2:-"+o.replaceAll(" ","-")),e}}}),Pp=["href"];function jp(e,t,o,n,s,i){return m(),C("a",{target:"_blank",rel:"noopener noreferrer",href:e.href},[Bt(e.$slots,"default")],8,Pp)}const Ur=se(xp,[["render",jp]]);async function Vd(e,t){try{await t()}catch(o){console.error("Error in promise",e,o),we.fire(new Rr("Unexpected error! Please copy the following message and send it to /u/edave64: Error in '"+e+'", '+Ip(o)))}}function Ip(e){if(e instanceof Error){if(e.stack!=null){const t=e.stack.split(`
`);return t[0].includes(e.name)&&t[0].includes(e.message)?t[0]+`
<br />`+t[1]:e.name+": "+e.message+`
<br />`+t[0]}return e.name+": "+e.message}return e instanceof Object?JSON.stringify(e):""+e}const Tp=ne({mixins:[tt],components:{Toggle:wt,ModalDialog:zr,L:Ur},data:()=>({allowSavesModal:!1,denySavesModal:!1,waitOnSaveChange:!1,showModeDialog:!1}),computed:{savesAllowed:{get(){return ee.savingEnabled},set(e){this.waitOnSaveChange=!0,ee.savingEnabled=e,this.saveSettings()}},inPlusMode(){return ee.gameMode==="ddlc_plus"},savesEnabledInEnv(){return ee.supports.optionalSaving},lqAllowed(){return ee.supports.lq},looseTextParsing:{get(){return ee.state.looseTextParsing},set(e){ee.state.looseTextParsing=e,this.saveSettings()}},lqRendering:{get(){return this.$store.state.ui.lqRendering},set(e){this.vuexHistory.transaction(async()=>{await this.$store.commit("ui/setLqRendering",e)}),this.saveSettings()}},nsfw:{get(){return!!this.$store.state.ui.nsfw},set(e){this.vuexHistory.transaction(async()=>{await this.$store.commit("ui/setNsfw",e),this.saveSettings()})}},defaultCharacterTalkingZoom:{get(){return!!this.$store.state.ui.defaultCharacterTalkingZoom},set(e){this.vuexHistory.transaction(async()=>{await this.$store.commit("ui/setDefaultCharacterTalkingZoom",e),this.saveSettings()})}},theme:{get(){return this.$store.state.ui.useDarkTheme},set(e){this.vuexHistory.transaction(async()=>{await this.$store.commit("ui/setDarkTheme",e),this.saveSettings()})}},showDownloadFolder(){return ee.supports.setDownloadFolder},downloadFolder(){return ee.state.downloadLocation}},watch:{savesAllowed(){this.waitOnSaveChange=!1}},methods:{allowSaves(e){this.allowSavesModal=!1,e==="Allow"&&(this.savesAllowed=!0)},denySaves(e){this.denySavesModal=!1,e==="Deny"&&(this.savesAllowed=!1)},modeChange(e){Vd("changing modes",async()=>{e==="Enter Classic Mode"?await ee.setGameMode("ddlc"):e==="Enter Plus mode"?await ee.setGameMode("ddlc_plus"):this.showModeDialog=!1})},saveSettings(){var e;ee.saveSettings({lq:this.$store.state.ui.lqRendering,nsfw:this.$store.state.ui.nsfw,darkMode:(e=this.$store.state.ui.useDarkTheme)!=null?e:void 0,looseTextParsing:ee.state.looseTextParsing,defaultCharacterTalkingZoom:this.$store.state.ui.defaultCharacterTalkingZoom})},setDownloadFolder(){ee.updateDownloadFolder()},openDownloadFolder(){ee.openFolder("downloads")}}});const ot=e=>(He("data-v-11f6d92f"),e=e(),Me(),e),Op={class:"panel"},Bp=ot(()=>u("h1",null,"Settings",-1)),Ap={class:"modal-scroll-area"},Ep=ot(()=>u("p",null,"Do you want to allow DDDG to save settings on your device?",-1)),Dp=ot(()=>u("p",null," By choosing to enable saving settings, DDDG can save data to your device, and nowhere else. However, your browser and any installed browser extensions might possibly read and send this data to other servers, e.g. to sync between devices. This is outside of our control. But in general, we recommend only using browsers and browser extensions that you trust with your personal data. ",-1)),Hp=ot(()=>u("p",null,"You can revoke this permission at any time.",-1)),Mp=j(" Our usual "),Rp=j("privacy policy"),Fp=j(" still applies. "),Lp={class:"modal-scroll-area"},Np=ot(()=>u("p",null,"Do you want to deny DDDG from saving settings on your device?",-1)),Wp=ot(()=>u("p",null," This will cause all your settings to reset when leaving the page. ",-1)),Vp=j(" Our usual "),zp=j("privacy policy"),Up=j(" still applies. "),Gp=ot(()=>u("div",{class:"modal-scroll-area"},[u("p",null," WARNING: Swiching modes will discard everything you have done in this session. All dialouge will be lost! ")],-1)),Xp={key:0,disabled:""},qp=j(" Enter Classic Mode "),Yp=j(" Enter DDLC Plus Mode "),Kp=ot(()=>u("td",null,[u("label",null,"Theme:")],-1)),Jp=ot(()=>u("option",{value:null},"System",-1)),Zp=ot(()=>u("option",{value:!1},"Light",-1)),Qp=ot(()=>u("option",{value:!0},"Dark",-1)),eg=[Jp,Zp,Qp],tg={key:4,class:"downloadTable"},og=ot(()=>u("td",null,[u("label",null,"Download folder:")],-1));function ng(e,t,o,n,s,i){const r=M("l"),a=M("modal-dialog"),l=M("toggle");return m(),C("div",Op,[Bp,(m(),z(vd,{to:"#modal-messages"},[e.allowSavesModal?(m(),z(a,{key:0,options:["Allow","Deny"],onLeave:t[0]||(t[0]=d=>e.allowSaves("Deny")),onOption:e.allowSaves,"no-base-size":""},{default:E(()=>[u("div",Ap,[Ep,Dp,Hp,u("p",null,[Mp,$(r,{to:"wiki://Privacy Statement"},{default:E(()=>[Rp]),_:1}),Fp])])]),_:1},8,["onOption"])):X("",!0),e.denySavesModal?(m(),z(a,{key:1,options:["Deny","Cancle"],onLeave:t[1]||(t[1]=d=>e.denySaves("Cancle")),onOption:e.denySaves,"no-base-size":""},{default:E(()=>[u("div",Lp,[Np,Wp,u("p",null,[Vp,$(r,{to:"wiki://Privacy Statement"},{default:E(()=>[zp]),_:1}),Up])])]),_:1},8,["onOption"])):X("",!0),e.showModeDialog?(m(),z(a,{key:2,options:[e.inPlusMode?"Enter Classic Mode":"Enter Plus mode","Stay"],onLeave:t[2]||(t[2]=d=>e.showModeDialog=!1),onOption:e.modeChange,"no-base-size":""},{default:E(()=>[Gp]),_:1},8,["options","onOption"])):X("",!0)])),e.waitOnSaveChange?(m(),C("button",Xp,"Applying...")):!e.savesAllowed&&e.savesEnabledInEnv?(m(),C("button",{key:1,onClick:t[3]||(t[3]=d=>e.allowSavesModal=!0)}," Allow saving options ")):e.savesAllowed&&e.savesEnabledInEnv?(m(),C("button",{key:2,onClick:t[4]||(t[4]=d=>e.denySavesModal=!0)}," Deny saving options ")):X("",!0),u("button",{onClick:t[5]||(t[5]=d=>e.showModeDialog=!0)},[e.inPlusMode?(m(),C(N,{key:0},[qp],64)):(m(),C(N,{key:1},[Yp],64))]),e.lqAllowed?(m(),z(l,{key:3,label:"Low quality preview?",title:"Reduces the quality of the preview images to speed up the user experience and consume less data. Does not effect final render.",modelValue:e.lqRendering,"onUpdate:modelValue":t[6]||(t[6]=d=>e.lqRendering=d)},null,8,["modelValue"])):X("",!0),$(l,{label:"NSFW Mode?",modelValue:e.nsfw,"onUpdate:modelValue":t[7]||(t[7]=d=>e.nsfw=d)},null,8,["modelValue"]),$(l,{label:"Enlarge talking objects? (Default value)",modelValue:e.defaultCharacterTalkingZoom,"onUpdate:modelValue":t[8]||(t[8]=d=>e.defaultCharacterTalkingZoom=d)},null,8,["modelValue"]),$(l,{label:"Fault tolerant text parsing",title:"Silently ignore parse errors in texts. (Like unexpected '{' characters) Prevents beginners from getting stuck working with textboxes, but also makes it harder to understand what you are doing wrong.",modelValue:e.looseTextParsing,"onUpdate:modelValue":t[9]||(t[9]=d=>e.looseTextParsing=d)},null,8,["modelValue"]),u("table",null,[u("tr",null,[Kp,u("td",null,[de(u("select",{"onUpdate:modelValue":t[10]||(t[10]=d=>e.theme=d)},eg,512),[[lt,e.theme]])])])]),e.showDownloadFolder?(m(),C("table",tg,[u("tr",null,[og,u("td",null,he(e.downloadFolder),1),u("td",null,[u("button",{onClick:t[11]||(t[11]=(...d)=>e.setDownloadFolder&&e.setDownloadFolder(...d))},"Set"),u("button",{onClick:t[12]||(t[12]=(...d)=>e.openDownloadFolder&&e.openDownloadFolder(...d))},"Open")])])])):X("",!0)])}const sg=se(Tp,[["render",ng],["__scopeId","data-v-11f6d92f"]]),ig=ne({computed:{vertical(){return this.$store.state.ui.vertical}},data:()=>({visible:!1}),methods:{show(){this.visible=!0},hide(){this.visible=!1},drop(e){if(this.hide(),e.stopPropagation(),e.preventDefault(),!!e.dataTransfer)for(const t of e.dataTransfer.items)t.kind==="file"&&t.type.match(/image.*/)&&this.$emit("drop",t.getAsFile())}}});function rg(e,t,o,n,s,i){return e.visible?(m(),C("div",{key:0,onDragleave:t[0]||(t[0]=r=>e.visible=!1),onDrop:t[1]||(t[1]=(...r)=>e.drop&&e.drop(...r)),class:le({vertical:e.vertical})},[Bt(e.$slots,"default",{},void 0,!0)],34)):X("",!0)}const zd=se(ig,[["render",rg],["__scopeId","data-v-ac1f253b"]]),ag=ne({props:{icon:{type:String,required:!0},iconPos:{type:String,default:"left"},disabled:{type:Boolean,default:!1},shortcut:{type:String,default:null}},computed:{showPopup(){return this.shortcut!=null&&!this.shortcut.startsWith("!")},popupText(){const e=this.shortcut;return e==null?"":e.startsWith("!")?e.substring(1):e}}});const lg=["disabled"],dg={class:"material-icons","aria-hidden":"true"},cg={class:"content"},ug={key:0,class:"shortcut-popup"};function fg(e,t,o,n,s,i){return m(),C("button",{class:le([e.iconPos]),disabled:e.disabled},[u("div",dg,he(e.icon),1),u("div",cg,[Bt(e.$slots,"default",{},void 0,!0)]),e.showPopup?(m(),C("div",ug,he(e.popupText),1)):X("",!0)],10,lg)}const Ms=se(ag,[["render",fg],["__scopeId","data-v-b2a4f97d"]]),pl={packId:"dddg.buildin.uploadedSprites",packCredits:[""],dependencies:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},hg=ne({mixins:[tt],components:{DropTarget:zd,DButton:Ms},data:()=>({isWebPSupported:null,customAssetCount:0,group:"characters"}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},characters(){return this.$store.state.content.current.characters},sprites(){return this.$store.state.content.current.sprites},hasClipboardContent(){return this.$store.state.ui.clipboard!=null},showSpritesFolder(){return ee.supports.openableFolders.has("sprites")}},methods:{assetSpriteBackground(e){return e.variants[0].map(t=>`url('${t.lq}')`).join(",")},assetPath(e){return e.chibi?ee.supports.lq?e.chibi.lq:e.chibi.hq:""},showDropTarget(e){!e.dataTransfer||(e.dataTransfer.effectAllowed="none",Array.from(e.dataTransfer.items).find(t=>t.type.match(/^image.*$/))&&(e.dataTransfer.effectAllowed="link",this.group==="sprites"&&this.$refs.spriteDt.show()))},hideDropTarget(){this.group==="sprites"&&this.$refs.spriteDt.hide()},onSpriteFileUpload(){const e=this.$refs.spriteUpload;if(!!e.files)for(const t of e.files)this.addCustomSpriteFile(t)},async uploadFromURL(){const e=prompt("Enter the URL of the image");if(e==null)return;const t=e.split("/").slice(-1)[0];this.addNewCustomSprite(t,e)},async addSpriteToScene(e){await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createSprite",{panelId:this.currentPanel.id,assets:e.variants[0]})})},addTextBox(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createTextBox",{panelId:this.currentPanel.id})})},addChoice(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createChoice",{panelId:this.currentPanel.id})})},addDialog(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createNotification",{panelId:this.currentPanel.id})})},addPoem(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createPoem",{panelId:this.currentPanel.id})})},addConsole(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createConsole",{panelId:this.currentPanel.id})})},paste(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/pasteObjectFromClipboard",{panelId:this.currentPanel.id})})},onChosen(e){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createCharacters",{characterType:e,panelId:this.currentPanel.id})})},addCustomSpriteFile(e){const t=URL.createObjectURL(e);this.addNewCustomSprite(e.name,t)},addNewCustomSprite(e,t){pl.sprites.push({id:t,label:e,variants:[[t]],defaultScale:[1,1],hd:null}),this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:pl,processed:!1})})},openSpritesFolder(){ee.openFolder("sprites")}},async created(){this.isWebPSupported=await zo()}});const pg=e=>(He("data-v-4d8353a6"),e=e(),Me(),e),gg=j("Drop here to add as a new sprite "),mg=pg(()=>u("h1",null,"Add",-1)),bg=j(" Char\xADacters "),yg=j(" Sprites "),vg=j(" UI "),wg=["title","onClick","onKeypress"],Cg=["src","alt"],$g=j(" Search in content packs "),kg=["title","onClick"],_g=j(" Upload new sprite "),Sg=j(" New sprite from URL "),xg=j(" Search in content packs "),Pg=j(" Open sprites folder "),jg=["disabled"];function Ig(e,t,o,n,s,i){const r=M("drop-target"),a=M("d-button");return e.isWebPSupported!==void 0?(m(),C("div",{key:0,class:"panel",onDragenter:t[13]||(t[13]=(...l)=>e.showDropTarget&&e.showDropTarget(...l)),onMouseleave:t[14]||(t[14]=(...l)=>e.hideDropTarget&&e.hideDropTarget(...l))},[$(r,{ref:"spriteDt",class:"drop-target",onDrop:e.addCustomSpriteFile},{default:E(()=>[gg]),_:1},8,["onDrop"]),mg,u("div",{class:le({"group-selector":!0,vertical:e.vertical})},[$(a,{class:le({active:e.group==="characters"}),"icon-pos":"top",icon:"emoji_people",onClick:t[0]||(t[0]=l=>e.group="characters")},{default:E(()=>[bg]),_:1},8,["class"]),$(a,{class:le({active:e.group==="sprites"}),"icon-pos":"top",icon:"change_history",onClick:t[1]||(t[1]=l=>e.group="sprites")},{default:E(()=>[yg]),_:1},8,["class"]),$(a,{class:le({active:e.group==="ui"}),"icon-pos":"top",icon:"view_quilt",onClick:t[2]||(t[2]=l=>e.group="ui")},{default:E(()=>[vg]),_:1},8,["class"])],2),u("div",{class:le({"item-grid":!0,vertical:e.vertical})},[e.group==="characters"?(m(),C(N,{key:0},[(m(!0),C(N,null,$e(e.characters,l=>(m(),C("div",{class:"character",tabindex:"0",key:l.id,title:l.label,onClick:q(d=>e.onChosen(l.id.toLowerCase()),["left"]),onKeypress:[Ke(d=>e.onChosen(l.id.toLowerCase()),["enter"]),Ke(d=>e.onChosen(l.id.toLowerCase()),["space"])]},[u("img",{src:e.assetPath(l),alt:l.label},null,8,Cg)],40,wg))),128)),$(a,{class:"custom-sprite",icon:"extension",onClick:t[3]||(t[3]=l=>e.$emit("show-dialog","type: Characters"))},{default:E(()=>[$g]),_:1})],64)):X("",!0),e.group==="sprites"?(m(),C(N,{key:1},[(m(!0),C(N,null,$e(e.sprites,l=>(m(),C("div",{class:"sprite",key:l.label,title:l.label,style:Ae({background:e.assetSpriteBackground(l)}),onClick:d=>e.addSpriteToScene(l)},he(l.label),13,kg))),128)),$(a,{class:"custom-sprite",icon:"publish",onClick:t[5]||(t[5]=l=>e.$refs.spriteUpload.click())},{default:E(()=>[_g,u("input",{type:"file",ref:"spriteUpload",onChange:t[4]||(t[4]=(...l)=>e.onSpriteFileUpload&&e.onSpriteFileUpload(...l))},null,544)]),_:1}),$(a,{icon:"insert_link",onClick:e.uploadFromURL},{default:E(()=>[Sg]),_:1},8,["onClick"]),$(a,{icon:"extension",onClick:t[6]||(t[6]=l=>e.$emit("show-dialog","type: Sprites"))},{default:E(()=>[xg]),_:1}),e.showSpritesFolder?(m(),z(a,{key:0,icon:"folder",onClick:e.openSpritesFolder},{default:E(()=>[Pg]),_:1},8,["onClick"])):X("",!0)],64)):X("",!0),e.group==="ui"?(m(),C(N,{key:2},[u("button",{onClick:t[7]||(t[7]=(...l)=>e.addTextBox&&e.addTextBox(...l))},"Textbox"),u("button",{onClick:t[8]||(t[8]=(...l)=>e.addPoem&&e.addPoem(...l))},"Poem"),u("button",{onClick:t[9]||(t[9]=(...l)=>e.addDialog&&e.addDialog(...l))},"Notification"),u("button",{onClick:t[10]||(t[10]=(...l)=>e.addChoice&&e.addChoice(...l))},"Choice"),u("button",{onClick:t[11]||(t[11]=(...l)=>e.addConsole&&e.addConsole(...l))},"Console")],64)):X("",!0),u("button",{onClick:t[12]||(t[12]=(...l)=>e.paste&&e.paste(...l)),disabled:!e.hasClipboardContent},"Paste",8,jg)],2)],32)):X("",!0)}const Tg=se(hg,[["render",Ig],["__scopeId","data-v-4d8353a6"]]);function fn(e,t,o){let n=t+o;const s=e.length;return n<0&&(n+=s),n>=s&&(n-=s),n}const Rs=1280,Gr=720,Og=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],Bg=1,Ag=1/1.5,Eg=-74,Dg=-26,Hg=[200,240,400,493,640,786,880,1040,1080],Mg=Object.freeze(Object.defineProperty({__proto__:null,screenWidth:Rs,screenHeight:Gr,positions:Og,sdCharacterScaleFactor:Bg,hdCharacterScaleFactor:Ag,CloseUpYOffset:Eg,BaseCharacterYPos:Dg,characterPositions:Hg},Symbol.toStringTag,{value:"Module"})),lo=class{constructor(t,o,n,s){this.r=t,this.g=o,this.b=n,this.a=s}static validCss(t){return this.validCssRgb(t)||this.validHex(t)}static fromCss(t){if(this.validCssRgb(t))return this.fromCssRgb(t);if(this.validHex(t))return this.fromHex(t);throw new Error("Invalid RGB color format")}static validCssRgb(t){return this.rgbEx.test(t)||this.rgbaEx.test(t)}static fromCssRgb(t){if(!this.validCssRgb(t))throw new Error("Invalid RGB color format");const o=t.slice(0,-1),n=o.indexOf("("),i=o.slice(n+1).split(",").map(r=>parseFloat(r.trim()));return new lo(i[0],i[1],i[2],i.length===4?i[3]:1)}static validHex(t){return this.hexShortEx.test(t)||this.hexLongEx.test(t)}static fromHex(t){if(!this.validHex(t))throw new Error("Invalid Hex color format");const o=t.slice(1);if(o.length===3)return new lo(parseInt(o[0]+o[0],16),parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),1);if(o.length===4)return new lo(parseInt(o[0]+o[0],16),parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)/255);if(o.length===6)return new lo(parseInt(o[0]+o[1],16),parseInt(o[2]+o[3],16),parseInt(o[4]+o[5],16),1);if(o.length===8)return new lo(parseInt(o[0]+o[1],16),parseInt(o[2]+o[3],16),parseInt(o[4]+o[5],16),parseInt(o[6]+o[7],16)/255);throw new Error("Invalid Hex color format length")}toCss(){return this.a>1?`rgb(${this.r},${this.g},${this.b})`:`rgba(${this.r},${this.g},${this.b},${this.a})`}toHex(){return`#${Math.round(this.r).toString(16).padStart(2,"0")}${Math.round(this.g).toString(16).padStart(2,"0")}${Math.round(this.b).toString(16).padStart(2,"0")}${Math.round(this.a*255).toString(16).padStart(2,"0")}`}toRgb(){return this}toHSL(){let{r:t,g:o,b:n}=this;const{a:s}=this;t/=255,o/=255,n/=255;const i=Math.max(t,o,n),r=Math.min(t,o,n);let a,l;const d=(i+r)/2;if(i===r)a=l=0;else{const c=i-r;switch(l=d>.5?c/(2-i-r):c/(i+r),i){case t:a=(o-n)/c+(o<n?6:0);break;case o:a=(n-t)/c+2;break;case n:a=(t-o)/c+4;break}a/=6}return new be(a,l,d,s)}get luminance(){return Math.sqrt(Math.pow(.299*(this.r/255),2)+Math.pow(.587*(this.g/255),2)+Math.pow(.114*(this.b/255),2))}};let ie=lo;v(ie,"rgbEx",/^rgb\((\d*?),(\d*?),(\d*?)\)$/i),v(ie,"rgbaEx",/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([\d.]+)\)$/i),v(ie,"hexShortEx",/^#[0-9A-Z]{3,4}$/i),v(ie,"hexLongEx",/^#[0-9A-Z]{6,8}$/i);class be{constructor(t,o,n,s){this.h=t,this.s=o,this.l=n,this.a=s,Object.freeze(this)}toCss(){return this.a>=1?`hsl(${this.h}, ${this.s}, ${this.l})`:`hsla(${this.h}, ${this.s}, ${this.l}, ${this.a})`}shift(t){let{h:o,s:n,l:s,a:i}=this;return o+=t.h,o>=1?o-=1:o<0&&(o+=1),n+t.s>1?n-=t.s:(n+=t.s,n<0&&(n=0)),s+t.l>1||s+t.l<0?s-=t.l:s+=t.l,i+t.a>1||i+t.a<0?i-=t.a:i+=t.a,new be(o,n,s,i)}toRgb(){const{h:t,s:o,l:n,a:s}=this;let i,r,a;if(o===0)i=r=a=n;else{const l=n<.5?n*(1+o):n+o-n*o,d=2*n-l;i=be.hue2rgb(d,l,t+1/3),r=be.hue2rgb(d,l,t),a=be.hue2rgb(d,l,t-1/3)}return new ie(Math.round(i*255),Math.round(r*255),Math.round(a*255),s)}toHSL(){return this}static hue2rgb(t,o,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(o-t)*6*n:n<1/2?o:n<2/3?t+(o-t)*(2/3-n)*6:t}}const Rg=new be(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Fg="#ffe6f4",Lg="#ffbde1",Ng=420,Wg=22,Vg=640,Ud=270,zg=7,Ug=3,Gg=(Gr-Ud)/2,Xg={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},qg=Object.freeze(Object.defineProperty({__proto__:null,nameboxTextOutlineDelta:Rg,ChoiceButtonColor:Fg,ChoiceButtonBorderColor:Lg,ChoiceButtonWidth:Ng,ChoiceSpacing:Wg,ChoiceX:Vg,ChoiceYOffset:Ud,ChoicePadding:zg,Outline:Ug,ChoiceY:Gg,ChoiceTextStyle:Xg},Symbol.toStringTag,{value:"Module"})),Gd="#ffa8d2",Yg="#552222",Kg="#ffeef6",Xr="#bb5599",Xd=new be(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),qd=new be(.002028397565922768,0,.13725490196078438,0),Yd=.82,Kd=new be(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),Jd=12,Jg=1.5,Ui=12,xt=1.5,Zg=.6,Qg=new be(.08045977011494243,-.5714285714285714,-.5960784313725489,0),em=new be(0,-.14285714285714296,.3,0),Zd=new be(.004269293924466178,-.01869158878504662,-.039215686274509665,0),Gi=9.5,Pt=47,Qd=new be(.0023347701149424305,0,.10784313725490202,0),ec=3,tm=Object.freeze(Object.defineProperty({__proto__:null,textboxDefaultColor:Gd,controlsDefaultColor:Yg,nameboxDefaultColor:Kg,nameboxStrokeDefaultColor:Xr,nameboxTextOutlineDelta:Xd,nameboxBackgroundDelta:qd,nameboxGradientMiddleStopPosition:Yd,nameboxGradientEndDelta:Kd,nameboxRounding:Jd,nameboxRoundingBuffer:Jg,textboxRounding:Ui,textboxRoundingBuffer:xt,nameColorThreshold:Zg,controlColorDelta:Qg,controlDisableColorDelta:em,dotColorDelta:Zd,dotRadius:Gi,dotPatternSize:Pt,textboxOutlineColorDelta:Qd,textboxOutlineWidth:ec},Symbol.toStringTag,{value:"Module"})),Yo=816,qr=900,Fs=146,om=0,nm=29,sm=8,Mn=38,Ls=44,im=6,rm=93,am=404,lm=9,dm=9,gt=39,Rn=168,Fn=34,Ns=29,Yr=12,Kr=-126,Jr=-72,Zr=-38,Qr=30.75,ea=26,tc=426,Xi=58,ta={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},Ws={...ta,fontName:"riffic",fontSize:24,strokeColor:Xr,strokeWidth:6,color:"white",letterSpacing:1},oa={align:"left",font:"13px aller",fill:{style:"#522"}},oc={...oa,fill:{style:"#a66"}},cm={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},na={alpha:1,color:"#ffffff",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:4,lineSpacing:1.2},Ko=Rs/2-Yo/2,um=Rs/2-qr/2,fm=Ko+Mn,nc=Ko+Fn,hm=nc+Rn/2,pm=Ko+Kr,gm=Ko+Jr,mm=Ko+Zr,bm="normal",ym=Object.freeze(Object.defineProperty({__proto__:null,TextBoxWidth:Yo,TextBoxCorruptedWidth:qr,TextBoxHeight:Fs,TextBoxKerning:om,TextBoxLineHeight:nm,TextBoxCorruptedKerning:sm,TextBoxTextXOffset:Mn,TextBoxTextYOffset:Ls,TextBoxBottomSpacing:im,HdSpacing:rm,HdSideMargin:am,TextBoxTextCorruptedXOffset:lm,TextBoxTextCorruptedYOffset:dm,NameboxHeight:gt,NameboxWidth:Rn,NameboxXOffset:Fn,NameboxTextYOffset:Ns,ControlsYBottomOffset:Yr,ControlsXHistoryOffset:Kr,ControlsXSkipOffset:Jr,ControlsXStuffOffset:Zr,ArrowXRightOffset:Qr,ArrowYBottomOffset:ea,GlowRX:tc,GlowRY:Xi,BaseTextStyle:ta,NameboxTextStyle:Ws,ControlsTextStyle:oa,ControlsTextDisabledStyle:oc,TextBoxCorruptedStyle:cm,TextBoxStyle:na,TextBoxX:Ko,TextBoxCorruptedX:um,TextBoxTextX:fm,NameboxX:nc,NameboxTextX:hm,ControlsXHistory:pm,ControlsXSkip:gm,ControlsXStuff:mm,DefaultTextboxStyle:bm},Symbol.toStringTag,{value:"Module"})),vm="#ffe6f4",wm="#ffbde1",Cm="rgba(255,255,255,0.6)",$m=40,km=30,_m={...ta,fontName:"riffic",fontSize:24,strokeColor:Xr,strokeWidth:8,letterSpacing:1,color:"white"},Sm={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0},xm=Object.freeze(Object.defineProperty({__proto__:null,NotificationBackgroundColor:vm,NotificationBorderColor:wm,NotificationBackdropColor:Cm,NotificationPadding:$m,NotificationSpacing:km,NotificationOkTextStyle:_m,NotificationTextStyle:Sm},Symbol.toStringTag,{value:"Module"})),sc=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],Pm=0,jm=0,Im=Rs/2,Tm=Gr/2,Om=33,Bm=100,Am=30,Em=800,Dm=720,Hm="rgba(51,51,51,0.75)",Mm=480,Rm=180,Fm=3,Lm=7,Nt={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:12},ic=[{...Nt,name:"Sayori",fontName:"hashtag",fontSize:34,lineSpacing:1.05,letterSpacing:0},{...Nt,name:"Natsuki",fontName:"ammy_handwriting",fontSize:28},{...Nt,name:"Monika",fontName:"journal",fontSize:34},{...Nt,name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.5,fontSize:32},{...Nt,name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:18,letterSpacing:-8},{...Nt,name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:40},{...Nt,name:"MC",fontName:"halogen",fontSize:30,lineSpacing:1.53},{...Nt,name:"Console",fontName:"f25_bank_printer",fontSize:18,color:"white",lineSpacing:1.1}],Nm=Object.freeze(Object.defineProperty({__proto__:null,poemBackgrounds:sc,defaultPoemBackground:Pm,defaultPoemStyle:jm,defaultX:Im,defaultY:Tm,poemTopPadding:Om,poemBottomPadding:Bm,poemPadding:Am,defaultPoemWidth:Em,defaultPoemHeight:Dm,consoleBackgroundColor:Hm,consoleWidth:Mm,consoleHeight:Rm,defaultConsoleBackground:Fm,defaultConsoleStyle:Lm,poemTextStyles:ic},Symbol.toStringTag,{value:"Module"})),Wm={Base:Mg,Choices:qg,Notification:xm,Poem:Nm,TextBox:ym,TextBoxCustom:tm},Vs=1920,sa=1080,Vm=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],zm=1.5,Um=1,Gm=-111,Xm=-39,qm=[300,360,600,740,960,1180,1320,1560,1620],Ym=Object.freeze(Object.defineProperty({__proto__:null,screenWidth:Vs,screenHeight:sa,positions:Vm,sdCharacterScaleFactor:zm,hdCharacterScaleFactor:Um,CloseUpYOffset:Gm,BaseCharacterYPos:Xm,characterPositions:qm},Symbol.toStringTag,{value:"Module"})),Km=new be(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Jm="#ffe6f4",Zm="#ffbde1",Qm=630,eb=33,tb=960,rc=405,ob=10.5,nb=4.5,sb=(sa-rc)/2,ib={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},rb=Object.freeze(Object.defineProperty({__proto__:null,nameboxTextOutlineDelta:Km,ChoiceButtonColor:Jm,ChoiceButtonBorderColor:Zm,ChoiceButtonWidth:Qm,ChoiceSpacing:eb,ChoiceX:tb,ChoiceYOffset:rc,ChoicePadding:ob,Outline:nb,ChoiceY:sb,ChoiceTextStyle:ib},Symbol.toStringTag,{value:"Module"})),ac="#ffa8d2",ab="#552222",lb="#ffeef6",ia="#bb5599",lc=new be(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),dc=new be(.002028397565922768,0,.13725490196078438,0),cc=.82,uc=new be(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),fc=15,db=1.5,qi=19,jt=1.5,cb=.6,ub=new be(.08045977011494243,-.5714285714285714,-.5960784313725489,0),fb=new be(0,-.14285714285714296,.3,0),hc=new be(.004269293924466178,-.01869158878504662,-.039215686274509665,0),Yi=9.5*1.5,It=47*1.5,pc=new be(.0023347701149424305,0,.10784313725490202,0),gc=5,hb=Object.freeze(Object.defineProperty({__proto__:null,textboxDefaultColor:ac,controlsDefaultColor:ab,nameboxDefaultColor:lb,nameboxStrokeDefaultColor:ia,nameboxTextOutlineDelta:lc,nameboxBackgroundDelta:dc,nameboxGradientMiddleStopPosition:cc,nameboxGradientEndDelta:uc,nameboxRounding:fc,nameboxRoundingBuffer:db,textboxRounding:qi,textboxRoundingBuffer:jt,nameColorThreshold:cb,controlColorDelta:ub,controlDisableColorDelta:fb,dotColorDelta:hc,dotRadius:Yi,dotPatternSize:It,textboxOutlineColorDelta:pc,textboxOutlineWidth:gc},Symbol.toStringTag,{value:"Module"})),ra=1220,mc=900,bc=219,pb=0,gb=29,mb=8,aa=57,yc=68,bb=54,yb=9,vb=9,Bo=59,la=252,da=49,vc=43,wc=12*1.5,Cc=-126*1.5,$c=-72*1.5,kc=-38*1.5,_c=30.75*1.5,Sc=26*1.5,xc=426*1.5,Ki=58*1.5,ca={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:1,lineSpacing:1.2,strokeColor:"",strokeWidth:0},Pc={...ca,fontName:"riffic",fontSize:36,strokeColor:ia,strokeWidth:9,color:"white",letterSpacing:2},$s={align:"left",font:"24px aller",fill:{style:"#522"}},jc={...$s,fill:{style:"#a66"}},Ic={alpha:1,color:"#ffffff",fontName:"aller",fontSize:30,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:5,lineSpacing:1.2},wb={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},Jo=Vs/2-ra/2,Cb=Vs/2-mc/2,$b=Jo+aa,Tc=Jo+da,kb=Tc+la/2,_b=Jo+Cc,Sb=Jo+$c,xb=Jo+kc,Pb="custom_plus",jb=Object.freeze(Object.defineProperty({__proto__:null,TextBoxWidth:ra,TextBoxCorruptedWidth:mc,TextBoxHeight:bc,TextBoxKerning:pb,TextBoxLineHeight:gb,TextBoxCorruptedKerning:mb,TextBoxTextXOffset:aa,TextBoxTextYOffset:yc,TextBoxBottomSpacing:bb,TextBoxTextCorruptedXOffset:yb,TextBoxTextCorruptedYOffset:vb,NameboxHeight:Bo,NameboxWidth:la,NameboxXOffset:da,NameboxTextYOffset:vc,ControlsYBottomOffset:wc,ControlsXHistoryOffset:Cc,ControlsXSkipOffset:$c,ControlsXStuffOffset:kc,ArrowXRightOffset:_c,ArrowYBottomOffset:Sc,GlowRX:xc,GlowRY:Ki,BaseTextStyle:ca,NameboxTextStyle:Pc,ControlsTextStyle:$s,ControlsTextDisabledStyle:jc,TextBoxStyle:Ic,TextBoxCorruptedStyle:wb,TextBoxX:Jo,TextBoxCorruptedX:Cb,TextBoxTextX:$b,NameboxX:Tc,NameboxTextX:kb,ControlsXHistory:_b,ControlsXSkip:Sb,ControlsXStuff:xb,DefaultTextboxStyle:Pb},Symbol.toStringTag,{value:"Module"})),Ib="#ffe6f4",Tb="#ffbde1",Ob="rgba(255,255,255,0.6)",Bb=60,Ab=45,Eb={...ca,fontName:"riffic",fontSize:36,strokeColor:ia,strokeWidth:12,letterSpacing:1,color:"white"},Db={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0},Hb=Object.freeze(Object.defineProperty({__proto__:null,NotificationBackgroundColor:Ib,NotificationBorderColor:Tb,NotificationBackdropColor:Ob,NotificationPadding:Bb,NotificationSpacing:Ab,NotificationOkTextStyle:Eb,NotificationTextStyle:Db},Symbol.toStringTag,{value:"Module"})),Mb=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],Rb=0,Fb=0,Lb=Vs/2,Nb=sa/2,Wb=33,Vb=100,zb=30,Ub=800,Gb=720,Xb="rgba(51,51,51,0.75)",qb=480,Yb=180,Kb=3,Jb=7,Wt={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:12},Zb=[{...Wt,name:"Sayori",fontName:"hashtag",fontSize:34,lineSpacing:1.05,letterSpacing:0},{...Wt,name:"Natsuki",fontName:"ammy_handwriting",fontSize:28},{...Wt,name:"Monika",fontName:"journal",fontSize:34},{...Wt,name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.5,fontSize:32},{...Wt,name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:18,letterSpacing:-8},{...Wt,name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:40},{...Wt,name:"MC",fontName:"halogen",fontSize:30,lineSpacing:1.53},{...Wt,name:"Console",fontName:"f25_bank_printer",fontSize:18,color:"white",lineSpacing:1.1}],Qb=Object.freeze(Object.defineProperty({__proto__:null,poemBackgrounds:Mb,defaultPoemBackground:Rb,defaultPoemStyle:Fb,defaultX:Lb,defaultY:Nb,poemTopPadding:Wb,poemBottomPadding:Vb,poemPadding:zb,defaultPoemWidth:Ub,defaultPoemHeight:Gb,consoleBackgroundColor:Xb,consoleWidth:qb,consoleHeight:Yb,defaultConsoleBackground:Kb,defaultConsoleStyle:Jb,poemTextStyles:Zb},Symbol.toStringTag,{value:"Module"})),ey={Base:Ym,Choices:rb,Notification:Hb,Poem:Qb,TextBox:jb,TextBoxCustom:hb};function Y(){return ee.gameMode==="ddlc_plus"?ey:Wm}function Zo(){return{flip:!1,rotation:0,version:0,opacity:100,x:Y().Base.screenWidth/2,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!1,nameboxWidth:null,zoom:1}}const ty={setPose(e,t){const o=e.panels[t.panelId].objects[t.id];o.poseId=t.poseId,++o.version},setCharStyleGroup(e,{id:t,panelId:o,styleGroupId:n}){const s=e.panels[o].objects[t];s.styleGroupId=n,++s.version},setCharStyle(e,{id:t,panelId:o,styleId:n}){const s=e.panels[o].objects[t];s.styleId=n,++s.version},setClose(e,t){const o=e.panels[t.panelId].objects[t.id];o.close=t.close,++o.version},setPosePosition(e,t){const o=e.panels[t.panelId].objects[t.id];o.posePositions={...o.posePositions,...t.posePositions},++o.version},setFreeMove(e,t){const o=e.panels[t.panelId].objects[t.id];if(o.freeMove=t.freeMove,!o.freeMove){const n=Y();o.x=n.Base.characterPositions[ks(o.x)],o.y=n.Base.BaseCharacterYPos}}};function zs(e,t){return e.getters["content/getCharacters"].get(t.characterType)}function no(e,t){return e["content/getCharacters"].get(t)}function qt(e,t){return e.styleGroups[t.styleGroupId].styles[t.styleId].poses[t.poseId]}function oy(e,t){const o=qt(e,t),n=[...Object.keys(o.positions).filter(s=>o.positions[s].length>1)];return o.compatibleHeads.length>0&&n.unshift("head"),n}function Ji(e,t,o=t.posePositions.headType||0){const n=qt(e,t).compatibleHeads;return n.length===0?null:e.heads[n[o]]}function ks(e){return Y().Base.characterPositions.map((n,s)=>({pos:Math.abs(e-n),idx:s})).sort((n,s)=>n.pos-s.pos)[0].idx}const ny={createCharacters({rootState:e,rootGetters:t,commit:o,state:n},s){var d;const i=n.panels[s.panelId].lastObjId+1,r=Y(),a=no(t,s.characterType),l=a.hd?r.Base.hdCharacterScaleFactor:r.Base.sdCharacterScaleFactor;return o("create",{object:{...Zo(),id:i,panelId:e.panels.currentPanel,onTop:!1,type:"character",y:r.Base.BaseCharacterYPos,preserveRatio:!0,ratio:1,width:a.size[0]*a.defaultScale[0]*l,height:a.size[1]*a.defaultScale[1]*l,characterType:s.characterType,close:!1,freeMove:!1,poseId:0,styleId:0,styleGroupId:0,posePositions:{},label:(d=a.label)!=null?d:a.id,enlargeWhenTalking:e.ui.defaultCharacterTalkingZoom}}),i},seekPart({state:e,commit:t,dispatch:o,rootGetters:n},{delta:s,id:i,panelId:r,part:a}){if(a==="head"){o("seekHead",{id:i,panelId:r,delta:s});return}const l=e.panels[r].objects[i],d=qt(no(n,l.characterType),l);!d.positions[a]||t("setPosePosition",{id:i,panelId:r,posePositions:{[a]:fn(d.positions[a],l.posePositions[a]||0,s)}})},seekPose({state:e,commit:t,rootGetters:o},{id:n,panelId:s,delta:i}){const r=e.panels[s].objects[n],a=no(o,r.characterType),l=a.styleGroups[r.styleGroupId].styles[r.styleId].poses;So(t,r,a,d=>{d.poseId=fn(l,d.poseId,i)})},seekStyle({state:e,commit:t,rootGetters:o},{id:n,panelId:s,delta:i}){const r=e.panels[s].objects[n],a=no(o,r.characterType),l=a.styleGroups.flatMap((c,f)=>c.styles.map((h,b)=>({styleGroupIdx:f,styleIdx:b,styleGroupJson:JSON.stringify(h.components)}))).sort((c,f)=>c.styleGroupJson.localeCompare(f.styleGroupJson)),d=l.findIndex(c=>c.styleGroupIdx===r.styleGroupId&&c.styleIdx===r.styleId);So(t,r,a,c=>{const f=fn(l,d,i),h=l[f];c.styleGroupId=h.styleGroupIdx,c.styleId=h.styleIdx})},seekHead({state:e,commit:t,rootGetters:o},{id:n,panelId:s,delta:i}){const r=e.panels[s].objects[n],a=no(o,r.characterType),l=qt(a,r);let d=Ji(a,r);if(!d)return;let c=(r.posePositions.head||0)+i,f=r.posePositions.headType||0;(c<0||c>=d.variants.length)&&(f=fn(l.compatibleHeads.map(h=>a.heads[h]),f,i),d=Ji(a,r,f),c=i===1?0:d.variants.length-1),t("setPosePosition",{id:n,panelId:s,posePositions:{head:c,headType:f}})},setPart({state:e,commit:t,rootGetters:o},{panelId:n,id:s,part:i,val:r}){const a=e.panels[n].objects[s],l=no(o,a.characterType);i==="pose"?So(t,a,l,d=>{d.poseId=r}):i==="style"?So(t,a,l,d=>{d.styleId=r}):So(t,a,l,d=>{d.posePositions[i]=r})},setCharStyle({state:e,commit:t,rootGetters:o},{panelId:n,id:s,styleGroupId:i,styleId:r}){const a=e.panels[n].objects[s],l=no(o,a.characterType);So(t,a,l,d=>{d.styleGroupId=i,d.styleId=r})},setCharacterPosition({state:e,commit:t},{panelId:o,id:n,x:s,y:i}){const r=e.panels[o].objects[n];if(r.freeMove)t("setPosition",{panelId:o,id:n,x:s,y:i});else{const a=Y();t("setPosition",{panelId:o,id:n,x:a.Base.characterPositions[ks(s)],y:a.Base.BaseCharacterYPos+(r.close?a.Base.CloseUpYOffset:0)})}},shiftCharacterSlot({state:e,commit:t},{panelId:o,id:n,delta:s}){const i=e.panels[o].objects[n],r=Y();let l=ks(i.x)+s;l<0&&(l=0),l>=r.Base.characterPositions.length&&(l=r.Base.characterPositions.length-1),t("setPosition",{panelId:o,id:n,x:r.Base.characterPositions[l],y:i.y})}};async function sy(e,t,o,n){const s=e.state.panels[t].objects[o],i=n.characters.find(O=>O.id===s.characterType);if(!i){console.error("Character data is missing. Dropping the character."),await e.dispatch("removeObject",{id:o,panelId:t});return}const r=Oc(s),a=i.styleGroups[s.styleGroupId],l=a.styles[r.styleId],d=l.poses[r.poseId],c=e.rootState.content.current.characters.find(O=>O.id===i.id);if(!c){console.error("Character data is missing. Dropping the character."),await e.dispatch("removeObject",{id:o,panelId:t});return}const f=c.styleGroups.findIndex(O=>O.id===a.id);r.styleGroupId=f===-1?0:f;const h=c.styleGroups[r.styleGroupId],b=JSON.stringify(l.components),y=h.styles.findIndex(O=>JSON.stringify(O.components)===b);r.styleId=y===-1?0:y;const k=h.styles[r.styleId],T=k.poses.findIndex(O=>O.id===d.id);r.poseId=T===-1?0:T;const D=k.poses[r.poseId];for(const O in D.positions){if(!D.positions.hasOwnProperty(O))continue;const Z=D.positions[O];if(d.positions[O]){const K=r.posePositions[O];K>=0&&K<Z.length}}const H=d.compatibleHeads[s.posePositions.headType],x=D.compatibleHeads.indexOf(H);if(x===-1)r.posePositions.headType=0,r.posePositions.head=0;else{x!==s.posePositions.headType&&(r.posePositions.headType=x);const O=JSON.stringify(i.heads[H].variants[s.posePositions.head]),Z=c.heads[H].variants.findIndex(K=>JSON.stringify(K)===O);Z===-1?r.posePositions.head=0:r.posePositions.head=Z}Bc(e.commit,s,r)}function Oc(e){return{styleGroupId:e.styleGroupId,styleId:e.styleId,poseId:e.poseId,posePositions:{...e.posePositions}}}function Bc(e,t,o){o.styleGroupId!==t.styleGroupId&&e("setCharStyleGroup",{id:t.id,panelId:t.panelId,styleGroupId:o.styleGroupId}),o.styleId!==t.styleId&&(console.log(`Setting style of ${t.id} to ${o.styleId}`),e("setCharStyle",{id:t.id,panelId:t.panelId,styleId:o.styleId})),o.poseId!==t.poseId&&e("setPose",{id:t.id,panelId:t.panelId,poseId:o.poseId}),JSON.stringify(o.posePositions)!==JSON.stringify(t.posePositions)&&e("setPosePosition",{id:t.id,panelId:t.panelId,posePositions:o.posePositions})}function So(e,t,o,n){const s=Oc(t);n(s),o.styleGroups[s.styleGroupId]||(s.styleGroupId=0);const i=o.styleGroups[s.styleGroupId];i.styles[s.styleId]||(s.styleId=0);const r=i.styles[s.styleId];r.poses[s.poseId]||(s.poseId=0);const a=r.poses[s.poseId];for(const f in a.positions)!a.positions[f]||a.positions[f][s.posePositions[f]]||(s.posePositions[f]=0);const d=o.styleGroups[t.styleGroupId].styles[t.styleId].poses[t.poseId].compatibleHeads[t.posePositions.headType||0],c=a.compatibleHeads.indexOf(d);c>=0?s.posePositions.headType=c:(s.posePositions.headType=0,s.posePositions.head=0),Bc(e,t,s)}const iy=ne({props:{title:{required:!0,type:String}}});const ry={class:"fieldset_wrapper"},ay={key:0},ly={class:"fieldset_contents"};function dy(e,t,o,n,s,i){return m(),C("div",ry,[u("fieldset",null,[e.title>""?(m(),C("legend",ay,he(e.title),1)):X("",!0),u("div",ly,[Bt(e.$slots,"default",{},void 0,!0)])])])}const Ct=se(iy,[["render",dy],["__scopeId","data-v-d714a009"]]),gl=960,cy=ne({props:{part:{required:!0},value:{required:!0},size:{type:Number,default:150}},data:()=>({lookups:[],loaded:!1}),computed:{scaleX(){return this.size/this.part.size[0]},scaleY(){return this.size/this.part.size[1]},backgroundSize(){return`${Math.floor(gl*this.scaleX)}px ${Math.floor(gl*this.scaleY)}px`},backgroundPosition(){return`${Math.floor(this.part.offset[0]*-this.scaleX)}px ${Math.floor(this.part.offset[1]*-this.scaleY)}px`},background(){var n,s;let e="";const t=this.backgroundSize,o=(n=this.part.offset)!=null?n:[0,0];for(let i=0;i<this.part.images.length;++i){const r=this.part.images[i],a=this.lookups[i];if(!(a instanceof Hn))continue;i>0&&(e+=", ");const l=(s=r.offset)!=null?s:[0,0],d=`${Math.floor((o[0]-l[0])*-this.scaleX)}px ${Math.floor((o[1]-l[1])*-this.scaleY)}px`;e+=`url('${a.html.src.replace("'","\\'")}') ${d} / ${t}`}return e},style(){return{height:this.size+"px",width:this.size+"px",background:this.background}}},async created(){this.lookups=await Promise.all(this.part.images.map(e=>typeof e.asset=="string"?At(e.asset,!1):qo(e.asset,!1)))},methods:{quickClick(e){e.preventDefault(),this.$emit("quick-click")}}});function uy(e,t,o,n,s,i){var r;return m(),C("div",{class:le({part:!0,active:(r=e.part)==null?void 0:r.active}),style:Ae(e.style),tabindex:"0",onClick:t[0]||(t[0]=a=>e.$emit("click")),onContextmenu:t[1]||(t[1]=(...a)=>e.quickClick&&e.quickClick(...a)),onKeydown:[t[2]||(t[2]=Ke(q(a=>e.$emit("click"),["prevent"]),["enter"])),t[3]||(t[3]=Ke(q((...a)=>e.quickClick&&e.quickClick(...a),["prevent"]),["space"]))]},null,38)}const fy=se(cy,[["render",uy],["__scopeId","data-v-d8843028"]]),hy=ne({mixins:[Vr],props:{noWraping:{type:Boolean,default:!1},direction:{type:String,default:"global"},maxSize:{},gap:{type:String,default:"0px"}},computed:{finalDirection(){return this.direction==="global"?this.$store.state.ui.vertical?"vertical":"horizontal":this.direction==="inverted"?this.$store.state.ui.vertical?"horizontal":"vertical":this.direction}},render(){const e=this.noWraping?"no-wraping":"wraping",o=qa("div",{...{},class:["d-flow",this.finalDirection,e],style:{gap:this.gap}},this.$slots.default());if(this.maxSize!==void 0){const n=this.maxSize instanceof Array?this.maxSize[this.finalDirection==="horizontal"?0:1]:this.maxSize;return qa("div",{ref:"scrollContainer",class:["d-flow-scroll-container",this.finalDirection],style:{[this.finalDirection==="horizontal"?"maxWidth":"maxHeight"]:n}},[o])}return o},mounted(){this.$refs.scrollContainer&&this.$refs.scrollContainer.addEventListener("wheel",this.verticalScrollRedirect)}});const Ln=se(hy,[["__scopeId","data-v-f45f382d"]]),py=ne({components:{PartButton:fy,DFieldset:Ct,DFlow:Ln},props:{character:{type:Object,required:!0},part:{required:!0,type:String}},data:()=>({isWebPSupported:null,stylePriorities:[]}),computed:{vertical(){return this.$store.state.ui.vertical},styleComponents(){if(this.part!=="style")return[];const e=this.charData.styleGroups[this.character.styleGroupId];return e.styleComponents.map(t=>{const o={};for(const n in t.variants){if(!t.variants.hasOwnProperty(n))continue;const s=t.variants[n];o[n]={size:e.styles[0].poses[0].size,offset:[0,0],images:[{offset:[0,0],asset:s}],active:!1}}return{label:t.label,name:t.id,buttons:o}})},parts(){const e={};let t,o,n;const s=this.charData,i=qt(s,this.character);switch(this.part){case"head":const r=this.character.posePositions.headType||0,a=this.character.posePositions.head||0;for(let d=0;d<i.compatibleHeads.length;++d){const c=i.compatibleHeads[d],f=s.heads[c];for(let h=0;h<f.variants.length;++h){const b=f.variants[h];e[`${d}_${h}`]={size:f.previewSize,offset:f.previewOffset,images:b.map(y=>({asset:y,offset:[0,0]})),active:a===h&&r===d}}}return e;case"pose":const l=s.styleGroups[this.character.styleGroupId].styles[this.character.styleId];for(let d=0;d<l.poses.length;++d){const c=l.poses[d];e[d]=this.generatePosePreview(c),e[d].active=d===this.character.poseId}return e;case"style":for(let d=0;d<s.styleGroups.length;++d){const c=s.styleGroups[d];e[c.id]=this.generatePosePreview(c.styles[0].poses[0]),e[c.id].active=d===this.character.styleGroupId}return e;default:t=i.positions[this.part],n=i.previewSize,o=i.previewOffset;break}for(let r=0;r<t.length;++r){const a=t[r];e[r]={images:a.map(l=>({offset:[0,0],asset:l})),size:n,offset:o,active:r===(this.character.posePositions[this.part]||0)}}return e},charData(){return zs(this.$store,this.character)}},methods:{updateStyleData(){const e=this.charData.styleGroups[this.character.styleGroupId].styles[this.character.styleId];this.stylePriorities=Object.keys(e.components).map(t=>[t,e.components[t]])},generatePosePreview(e){const t=this.charData;let o=[];for(const n of e.renderCommands)switch(n.type){case"pose-part":const s=e.positions[n.part];if(s==null||s.length===0)break;o=o.concat(s[0].map(a=>({asset:a,offset:n.offset})));break;case"head":const i=t.heads[e.compatibleHeads[0]];if(e.compatibleHeads.length===0)break;const r=i.variants[0];o=o.concat(r.map(a=>({asset:a,offset:n.offset})));break;case"image":o=o.concat(n.images.map(a=>({asset:a,offset:n.offset})));break}return{images:o,size:e.previewSize,offset:e.previewOffset,active:!1}},updatePose(e){e==null&&(e=this.character.styleGroupId);const o=this.charData.styleGroups[e];let n=o.styles;for(const s of this.stylePriorities){const i=n.filter(r=>r.components[s[0]]===s[1]);i.length>0&&(n=i)}this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/setCharStyle",{id:this.character.id,panelId:this.character.panelId,styleGroupId:e,styleId:o.styles.indexOf(n[0])})})},choose(e){if(this.part==="style")this.updatePose(this.charData.styleGroups.findIndex(t=>t.id===e));else if(this.part==="head"){const[t,o]=e.split("_",2).map(n=>parseInt(n,10));this.$store.commit("panels/setPosePosition",{id:this.character.id,panelId:this.character.panelId,posePositions:{headType:t,head:o}})}else this.setPart(this.part,parseInt(e,10))},choose_component(e,t){const o=this.stylePriorities.findIndex(n=>n[0]===e);this.stylePriorities.splice(o,1),this.stylePriorities.unshift([e,t]),this.updatePose()},onKeydown(e){(e.key==="Backspace"||e.key==="Escape")&&(this.$emit("leave"),e.preventDefault(),e.stopPropagation())},setPart(e,t){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPart",{id:this.character.id,panelId:this.character.panelId,part:e,val:t})})}},async created(){this.updateStyleData(),this.isWebPSupported=await zo()},watch:{character(){this.updateStyleData()}}});const Qt=e=>(He("data-v-15457ce1"),e=e(),Me(),e),gy=Qt(()=>u("i",{class:"material-icons"},"extension",-1)),my=Qt(()=>u("span",{class:"text-block"},"Create new expressions",-1)),by=[gy,my],yy=Qt(()=>u("i",{class:"material-icons"},"extension",-1)),vy=Qt(()=>u("span",{class:"text-block"},"Search in content packs",-1)),wy=[yy,vy],Cy=Qt(()=>u("i",{class:"material-icons"},"extension",-1)),$y=Qt(()=>u("span",null,"Search in content packs",-1)),ky=[Cy,$y],_y=Qt(()=>u("i",{class:"material-icons"},"extension",-1)),Sy=Qt(()=>u("span",null,"Search in content packs",-1)),xy=[_y,Sy];function Py(e,t,o,n,s,i){const r=M("part-button"),a=M("d-flow"),l=M("d-fieldset");return m(),z(a,{"no-wraping":"",onKeydown:e.onKeydown},{default:E(()=>[u("button",{onClick:t[0]||(t[0]=d=>e.$emit("leave"))},"Back"),e.part==="head"?(m(),C("button",{key:0,onClick:t[1]||(t[1]=d=>e.$emit("show-expression-dialog",{character:e.character.characterType})),class:"icon-button"},by)):X("",!0),e.part==="head"?(m(),C("button",{key:1,onClick:t[2]||(t[2]=d=>e.$emit("show-dialog","type: Expressions character: "+e.charData.label)),class:"icon-button"},wy)):e.part==="style"?(m(),C("button",{key:2,onClick:t[3]||(t[3]=d=>e.$emit("show-dialog","type: Styles character: "+e.charData.label)),class:"icon-button"},ky)):(m(),C("button",{key:3,onClick:t[4]||(t[4]=d=>e.$emit("show-dialog","type: Poses character: "+e.charData.label)),class:"icon-button"},xy)),(m(!0),C(N,null,$e(e.parts,(d,c)=>(m(),z(r,{key:c,value:c,part:d,onClick:f=>{e.choose(c),e.$emit("leave")},onQuickClick:f=>e.choose(c)},null,8,["value","part","onClick","onQuickClick"]))),128)),(m(!0),C(N,null,$e(e.styleComponents,d=>(m(),z(l,{key:d.name,title:d.label},{default:E(()=>[$(a,{noWraping:""},{default:E(()=>[(m(!0),C(N,null,$e(d.buttons,(c,f)=>(m(),z(r,{size:130,key:f,value:f,part:c,onClick:h=>e.choose_component(d.name,f)},null,8,["value","part","onClick"]))),128))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["onKeydown"])}const jy=se(py,[["render",Py],["__scopeId","data-v-15457ce1"]]);function Nn(){return function(t,o,n=!1){return{get(){return this.object[t]},set(s){this.vuexHistory.transaction(()=>{this.$store[n?"dispatch":"commit"](o,{panelId:this.object.panelId,id:this.object.id,[t]:s})})}}}}function ua(e){return function(o){return{get(){return this.object[o]},set(n){this.vuexHistory.transaction(()=>{this.$store.commit(e,{panelId:this.object.panelId,id:this.object.id,key:o,value:n})})}}}}const ml=5;class Iy{constructor(t){v(this,"pos",0);this.str=t}current(){return this.str[this.pos]}get around(){return this.str.slice(Math.max(0,this.pos-ml),this.pos+ml)}get ahead(){return this.str[this.pos+1]}get behind(){return this.str[this.pos+1]}next(){return++this.pos,this.current()}}function bl(e,t=!0){const o=[],n=new Iy(e);let s=Us;for(;s!==Gs;){const i=n.pos;try{s=s(o,n)}catch(r){if(t&&s!==Zi)n.pos=i,s=(a,l)=>Zi(a,l,!0);else throw r}}return o}function Us(e,t){return t.current()===void 0?Gs:t.current()==="{"?Ty:t.current()===`
`?Oy:Zi}function Gs(){return Gs}function Zi(e,t,o=!1){const{pos:n}=t;let s="",i=o,r;for(;;){if(t.current()===void 0){r=Gs;break}else if(i)s+=t.current(),i=!1;else if(t.current()==="\\")i=!0;else if(t.current()==="{"||t.current()===`
`){r=Us;break}else s+=t.current();t.next()}return e.push({type:"text",pos:n,content:s}),r}function pi(e,t){throw new Error(`Error when parsing text at position ${e.pos}: (around: "${e.around}") ${t}`)}function Ty(e,t){const{pos:o}=t;if(t.current()!=="{")throw new Error("Parser error: Command does not start with {");const n=t.next()==="/";n&&t.next();let s="",i="",r=!1;for(;t.current()===void 0&&pi(t,"Unexpected end of text inside a command"),t.current()!=="}";)r?i+=t.current():t.current().match(/[a-z]/i)?s+=t.current():t.current()==="="?(n&&pi(t,"Closing commands may not contain arguments"),r=!0):pi(t,`Unexpected character '${t.current()}' in command name.`),t.next();return t.next(),n?e.push({type:"commandClose",commandName:s,pos:o}):e.push({type:"command",pos:o,argument:i,commandName:s}),Us}function Oy(e,t){return e.push({type:"newline",pos:t.pos}),t.next(),Us}const By=new Map([xo("i",e=>({...e,isItalic:!0})),xo("b",e=>({...e,isBold:!0})),xo("u",e=>({...e,isUnderlined:!0})),xo("s",e=>({...e,isStrikethrough:!0})),xo("plain",e=>({...e,isStrikethrough:!1,isUnderlined:!1,isBold:!1,isItalic:!1})),xo("edited",e=>({...e,fontName:"verily",strokeColor:"#000000",strokeWidth:20,letterSpacing:8})),Zn("k",(e,t,o)=>({...e,letterSpacing:t?e.letterSpacing+o:o})),Zn("size",(e,t,o)=>({...e,fontSize:t?e.fontSize+o:o})),Zn("alpha",(e,t,o)=>({...e,alpha:t?e.alpha+o:o})),Zn("stroke",(e,t,o)=>({...e,strokeWidth:t?e.strokeWidth+o:o})),["font",(e,t)=>({...e,fontName:t})],["color",(e,t)=>({...e,color:t})],["outlinecolor",(e,t)=>({...e,strokeColor:t})]]);function xo(e,t){return[e,(o,n)=>{if(n!=null)throw new Error(`Operator '${e}' does not take any arguments.`);return t(o)}]}function Zn(e,t){return[e,(o,n)=>{if(n==null||n=="")throw new Error(`Operator '${e}' needs an argument.`);const s=n[0]==="+"||n[0]==="-",i=Number(n);if(isNaN(i))throw new Error(`Operator '${e}' needs a numeric argument.`);return t(o,s,i)}]}var Ie=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},bt={},Ac={};Object.defineProperty(Ac,"__esModule",{value:!0});var Qe={};Object.defineProperty(Qe,"__esModule",{value:!0});Qe.createFactoryWithConstraint=Qe.isExact=Qe.noop=Qe.assert=Qe.UnreachableCaseError=void 0;class Ay extends Error{constructor(t){super(`Unreachable case: ${t}`)}}Qe.UnreachableCaseError=Ay;function Ey(e,t="no additional info provided"){if(!e)throw new Error("Assertion Error: "+t)}Qe.assert=Ey;function Dy(...e){}Qe.noop=Dy;const Hy=()=>e=>e;Qe.isExact=Hy;const My=()=>e=>e;Qe.createFactoryWithConstraint=My;var Ec={};Object.defineProperty(Ec,"__esModule",{value:!0});(function(e){var t=Ie&&Ie.__createBinding||(Object.create?function(n,s,i,r){r===void 0&&(r=i);var a=Object.getOwnPropertyDescriptor(s,i);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[i]}}),Object.defineProperty(n,r,a)}:function(n,s,i,r){r===void 0&&(r=i),n[r]=s[i]}),o=Ie&&Ie.__exportStar||function(n,s){for(var i in n)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&t(s,n,i)};Object.defineProperty(e,"__esModule",{value:!0}),o(Ac,e),o(Qe,e),o(Ec,e)})(bt);const Ut=class{constructor(t,o){v(this,"renderParts");v(this,"tokens");v(this,"loose");this.str=t,this.baseStyle=o,this.loose=ee.state.looseTextParsing;try{this.tokens=bl(t,this.loose)}catch(n){if(n instanceof Error)this.tokens=[{type:"text",pos:0,content:n.message}];else throw n}this.rebuildParts()}rebuildParts(){this.renderParts=Ut.getRenderParts(this.tokens,this.baseStyle,this.loose)}async loadFonts(){if(!("fonts"in document))return;const t=new Set;let o=null;for(const s of this.renderParts)"style"in s&&s.style!==o&&(o=s.style,o.fontName&&t.add(o.fontName));let n=!1;for(const s of t){const i=document,r=`8px ${s}`;i.fonts.check(r)||(n=!0,await i.fonts.load(r))}if(n){const s=bl(this.str);this.renderParts=Ut.getRenderParts(s,this.baseStyle,this.loose)}}render(t){t.save();let o=null;for(const n of this.renderParts)n.type!=="newline"&&(n.style!==o&&(o=n.style,Qi(o,t)),o.strokeWidth>0&&o.strokeColor>""&&t.strokeText(n.character,n.x,n.y));for(const n of this.renderParts)n.type!=="newline"&&(n.style!==o&&(o=n.style,Qi(o,t)),t.fillText(n.character,n.x,n.y));t.restore()}quote(){let t;(i=>{i[i.None=0]="None",i[i.ExplictQuote=1]="ExplictQuote",i[i.ImplictQuote=2]="ImplictQuote",i[i.Star=3]="Star"})(t||(t={}));let o=-1,n=0;for(let i=0;i<this.renderParts.length;++i){const r=this.renderParts[i];if(r.type==="character")switch(n){case 0:if(r.character.match(/\s/))continue;r.character==='"'?(n=1,o=i):r.character==="*"?(n=3,o=i):(this.renderParts.splice(i,0,{type:"character",x:0,y:0,style:r.style,character:'"',height:r.height,width:ln(r.style,'"')}),i++,o=i,n=2);break;case 1:o=i,r.character==='"'&&(n=0);break;case 2:if(r.character.match(/\s/))continue;r.character==="*"&&(this.renderParts.splice(o+1,0,{type:"character",x:0,y:0,style:r.style,character:'"',height:r.height,width:ln(r.style,'"')}),n=3,i++),o=i;break;case 3:r.character==="*"&&(n=0),o=i;break;default:throw new bt.UnreachableCaseError(n)}}const s=this.renderParts[o];s&&n===3&&this.renderParts.splice(o+1,0,{type:"character",x:0,y:0,style:s.style,character:"*",height:s.height,width:ln(s.style,'"')}),s&&(n===1||n===2)&&this.renderParts.splice(o+1,0,{type:"character",x:0,y:0,style:s.style,character:'"',height:s.height,width:ln(s.style,'"')})}fixAlignment(t,o,n,s,i){let r=0,a=[];function l(){let y=o;t==="center"?y=o+(n-o)/2-r/2:t==="right"&&(y=n-r);for(const k of a)k.x=y,y+=k.width}let d=this.renderParts;i>0&&(d=Ut.applyLineWrapping(this.renderParts.slice(0),i));let c=s;const f=[];let h=0;for(const y of d)h=Math.max(h,y.height),y.type==="newline"&&(f.push(h),h=0);f.push(h);let b=0;for(const y of d)if(h=Math.max(h,y.height),y.y=c,a.push(y),r+=y.width,y.type==="newline")l(),c+=f[++b]||0,r=0,h=0,a=[];else if(y.type==="character"){const k=a[a.length-1];k.type==="character"&&(r+=k.style.letterSpacing,k.width+=k.style.letterSpacing)}l()}getHeight(t){let o=0,n=0;const s=t===0?this.renderParts:Ut.applyLineWrapping(this.renderParts.slice(0),t);for(const i of s)o=Math.max(o,i.height),i.type==="newline"&&(n+=o,o=0);return n+=o,n}getWidth(){let t=0,o=0,n=null;for(const s of this.renderParts)t+=s.width,s.type==="newline"?(o=Math.max(o,t),t=0,n=null):s.type==="character"&&(n&&n.type==="character"&&(t+=n.style.letterSpacing),n=s);return o=Math.max(o,t),o}static getRenderParts(t,o,n){const s=[],i=[],r=[];let a=wl(o),l=o,d=null;function c(f){for(const h of f)s.push({type:"character",character:h,height:a,width:ln(l,h),style:l,x:0,y:0})}for(const f of t){const h=f.type;switch(h){case"command":if(Ut.textCommands.has(f.commandName))i.push(l),r.push(d),l=Ut.textCommands.get(f.commandName)(l,f.argument),a=wl(l),d=f;else if(n)c("{"+f.commandName+"}");else throw new Error(`There is no text command called '${f.commandName}' at position ${f.pos}.`);break;case"commandClose":if(!d)if(n){c("{/"+f.commandName+"}");break}else throw new Error(`Unmatched closing command at position ${f.pos}. Closed '${f.commandName}', but no commands are currently open.`);if(f.commandName!==d.commandName)if(n){c("{/"+f.commandName+"}");break}else throw new Error(`Unmatched closing command at position ${f.pos}. Closed '${f.commandName}', expected to close '${d}' first. (Opened at position ${d.pos})`);d=r.pop(),l=i.pop();break;case"newline":s.push({height:a,width:0,x:0,y:0,type:"newline"});break;case"text":c(f.content);break;default:throw new bt.UnreachableCaseError(h)}}return s}static applyLineWrapping(t,o){let n=-1,s=0,i=0;const r=[];for(const a of t)if(a.type==="newline")n=-1,s=0,i=0,r.push(a);else if(a.type==="character")a.character===" "?s>o?(n=-1,s=0,i=0,r.push({type:"newline",height:a.height,width:0,x:0,y:0})):(s+=a.width,i=s,n=r.length,r.push(a)):(s+=a.width,s>o&&n!==-1&&(s-=i,r.splice(n,1,{type:"newline",height:a.height,width:0,x:0,y:0}),n=-1,i=0),r.push(a));else throw new bt.UnreachableCaseError(a);return r}};let yt=Ut;v(yt,"textCommands",By);const yl=document.createElement("canvas").getContext("2d");let vl=null;function ln(e,t){return e!==vl&&(Qi(e,yl),vl=e),yl.measureText(t).width}const gi=new Map;function wl(e){const t=e.fontSize+" "+e.fontName;if(gi.has(t))return gi.get(t)*e.lineSpacing;const o=document.createElement("span");o.innerHTML="Hg",o.style.fontFamily=e.fontName,o.style.fontSize=`${e.fontSize}px`,o.style.lineHeight="1";const n=document.createElement("div");n.style.opacity="0",n.style.fontFamily=e.fontName,n.style.fontSize=`${e.fontSize}px`,n.style.lineHeight="1",n.style.position="absolute",n.style.top="0",n.style.left="0",n.appendChild(o),document.body.appendChild(n);try{const s=n.offsetHeight;return gi.set(t,s),s*e.lineSpacing}finally{n.remove()}}function Qi(e,t){t.textAlign="left",t.font=(e.isItalic?"italic ":"")+(e.isBold?"bold ":"")+e.fontSize+"px "+e.fontName,t.lineJoin="round",e.strokeWidth>0&&e.strokeColor>""?(t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeWidth):(t.strokeStyle="",t.lineWidth=0),t.globalAlpha=e.alpha||0,t.fillStyle=e.color}class To{}class Uo{constructor(t,o,n,s){v(this,"aborted",!1);this.canvas=t,this.fsCtx=o,this.hq=n,this.preview=s}static make(t,o,n){return new Uo(t,t.getContext("2d"),o,n)}static makeWithContext(t,o,n,s){return new Uo(t,o,n,s)}drawText(t){if(this.aborted)throw new To;this.fsCtx.save();const{font:o,align:n,x:s=0,y:i=0,text:r=""}={font:"20px aller",align:"left",...t};this.fsCtx.lineJoin="round",this.fsCtx.textAlign=n,this.fsCtx.font=o,t.outline&&(this.fsCtx.strokeStyle=t.outline.style,this.fsCtx.lineWidth=t.outline.width,this.fsCtx.strokeText(r,s,i)),t.fill&&(this.fsCtx.fillStyle=t.fill.style,this.fsCtx.fillText(r,s,i)),this.fsCtx.restore()}measureText(t){if(this.aborted)throw new To;this.fsCtx.save();const{font:o,align:n,text:s=""}={font:"20px aller",align:"left",...t};this.fsCtx.lineJoin="round",this.fsCtx.textAlign=n,this.fsCtx.font=o,t.outline&&(this.fsCtx.strokeStyle=t.outline.style,this.fsCtx.lineWidth=t.outline.width),t.fill&&(this.fsCtx.fillStyle=t.fill.style);const i=this.fsCtx.measureText(s);return this.fsCtx.restore(),i}drawImage(t){if(this.aborted)throw new To;if(t.image instanceof Vi)return;const{image:o,flip:n,x:s,y:i,w:r,h:a,filters:l,composite:d}={flip:!1,w:t.image.width,h:t.image.height,composite:"source-over",...t};if(this.fsCtx.save(),this.fsCtx.globalCompositeOperation=d,l)if("filter"in this.fsCtx){const c=[];for(const f of l)f.type==="drop-shadow"?c.push(`drop-shadow(${f.offsetX}px ${f.offsetY}px ${f.blurRadius}px ${f.color})`):f.type==="hue-rotate"?c.push(`hue-rotate(${f.value}deg)`):f.type==="blur"?c.push(`blur(${f.value}px)`):c.push(`${f.type}(${f.value*100}%)`);this.fsCtx.filter=c.join(" ")}else{let c=1;for(const f of l)f.type==="opacity"&&(c*=f.value);this.fsCtx.globalAlpha=c}if(t.shadow){const c=t.shadow;c.color!=null&&(this.fsCtx.shadowColor=c.color),c.blur!=null&&(this.fsCtx.shadowBlur=c.blur),c.offsetX!=null&&(this.fsCtx.shadowOffsetX=c.offsetX),c.offsetY!=null&&(this.fsCtx.shadowOffsetY=c.offsetY)}if(t.rotation!=null&&t.rotation!==0){const c=t.rotationAnchor?t.rotationAnchor.x:0,f=t.rotationAnchor?t.rotationAnchor.y:0;t.rotationAnchor&&this.fsCtx.translate(c,f),this.fsCtx.rotate(t.rotation),t.rotationAnchor&&this.fsCtx.translate(-c,-f)}this.fsCtx.translate(s+r/2,i+a/2),this.fsCtx.scale(n?-1:1,1),o.paintOnto(this.fsCtx,{x:-r/2,y:-a/2,w:r,h:a}),this.fsCtx.restore(),this.fsCtx.globalCompositeOperation="source-over"}drawRect({x:t,y:o,w:n,h:s,outline:i,fill:r,composition:a}){if(this.aborted)throw new To;this.fsCtx.save(),this.fsCtx.beginPath(),this.fsCtx.rect(t,o,n,s),a&&(this.fsCtx.globalCompositeOperation=a),r&&(this.fsCtx.fillStyle=r.style,this.fsCtx.fill()),i&&(this.fsCtx.strokeStyle=i.style,this.fsCtx.lineWidth=i.width,this.fsCtx.stroke()),this.fsCtx.restore()}drawPath({outline:t,fill:o,path:n}){if(this.aborted)throw new To;this.fsCtx.save(),this.fsCtx.beginPath(),n(this.fsCtx),o&&(this.fsCtx.fillStyle=o.style,this.fsCtx.fill()),t&&(this.fsCtx.strokeStyle=t.style,this.fsCtx.lineWidth=t.width,this.fsCtx.stroke()),this.fsCtx.restore()}patternFrom(t,o="repeat"){return t instanceof Wn&&(t=t.previewCanvas),this.fsCtx.createPattern(t,o)}async customTransform(t,o){this.fsCtx.save(),await t(this.fsCtx),await o(this),this.fsCtx.restore()}linearGradient(t,o,n,s){return this.fsCtx.createLinearGradient(t,o,n,s)}applyFilters(t){if(t.length===0)return;this.fsCtx.save();let o=1;for(const n of t)n.type==="opacity"&&(o*=n.value);if("filter"in this.fsCtx){const n=[];for(const s of t)s.type!=="opacity"&&(s.type==="drop-shadow"?n.push(`drop-shadow(${s.offsetX}px ${s.offsetY}px ${s.blurRadius}px ${s.color})`):s.type==="hue-rotate"?n.push(`hue-rotate(${s.value}deg)`):s.type==="blur"?n.push(`blur(${s.value}px)`):n.push(`${s.type}(${s.value*100}%)`));this.fsCtx.filter=n.join(" ")}this.fsCtx.drawImage(this.canvas,0,0),o!==1&&(this.fsCtx.globalCompositeOperation="destination-atop",this.fsCtx.fillStyle=`rgba(0,0,0,${o})`,this.fsCtx.fillRect(0,0,this.canvas.width,this.canvas.height),this.fsCtx.globalCompositeOperation="source-over"),"filter"in this.fsCtx&&(this.fsCtx.filter="none"),this.fsCtx.restore()}abort(){this.aborted=!0}}class Wn{constructor(t,o){v(this,"previewCanvas");v(this,"runningContext",null);const n=Y();this.previewCanvas=document.createElement("canvas"),this.previewCanvas.width=t!=null?t:n.Base.screenWidth,this.previewCanvas.height=o!=null?o:n.Base.screenHeight}async render(t,o=!0,n=!0){this.runningContext&&this.runningContext.abort();const s=this.previewCanvas.getContext("2d");s.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height);const i=this.runningContext=Uo.makeWithContext(this.previewCanvas,s,o,n);try{await t(this.runningContext)}catch(r){if(r instanceof To)return!1;throw r}finally{i===this.runningContext&&(this.runningContext=null)}return!0}get width(){return this.previewCanvas.width}get height(){return this.previewCanvas.height}paintOnto(t,o){o.w!=null&&o.h!=null?t.drawImage(this.previewCanvas,o.x,o.y,o.w,o.h):t.drawImage(this.previewCanvas,o.x,o.y)}async download(t,o){const n=await this.drawToCanvas(t);return await ee.saveToFile(n,o)}async renderToBlob(t){const o=await this.drawToCanvas(t);return await new Promise((n,s)=>{o.toBlob(i=>{i?n(i):s()})})}async drawToCanvas(t){const o=document.createElement("canvas");o.width=this.previewCanvas.width,o.height=this.previewCanvas.height;const n=o.getContext("2d");return n.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height),await t(Uo.makeWithContext(o,n,!0,!1)),o}getDataAt(t,o){return this.previewCanvas.getContext("2d").getImageData(t,o,1,1).data}}function _s(e,t,o,n,s){const i=Math.cos(s),r=Math.sin(s),a=e-o,l=t-n,d=i*a-r*l+o,c=r*a+i*l+n;return[d,c]}var hn=(e=>(e[e.None=0]="None",e[e.Selected=1]="Selected",e[e.Focused=2]="Focused",e[e.Both=3]="Both",e))(hn||{});class Dc{constructor(t){v(this,"localRenderer",null);v(this,"lastVersion",null);v(this,"hitDetectionFallback",!1);v(this,"renderable",!1);v(this,"lastHq",!1);v(this,"ready",Promise.resolve());this.obj=t}get id(){return this.obj.id}get x(){return this.obj.x}get y(){return this.obj.y}get version(){return this.obj.version}get flip(){return this.obj.flip}get rotation(){return this.obj.rotation/180*Math.PI}get composite(){return this.obj.composite}get filters(){return this.obj.filters}get width(){return this.obj.width}get height(){return this.obj.height}async updateLocalCanvas(t){await this.ready;const o=this.canvasWidth,n=this.canvasHeight;if(n===0&&o===0){this.renderable=!1;return}this.renderable=!0,this.localRenderer=new Wn(o,n),this.lastHq=t,await this.localRenderer.render(this.renderLocal.bind(this))}needsRedraw(){return this.localRenderer===null||this.lastVersion!==this.version}getRenderRotation(){return[this.flip?-this.rotation:this.rotation,{x:this.x,y:this.y+this.height/2}]}async render(t,o){if((this.lastHq!==o.hq||this.needsRedraw())&&await this.updateLocalCanvas(!o.hq),this.lastVersion=this.version,!this.renderable)return;const[s,i]=this.getRenderRotation();let r;switch(t){case 0:r=void 0;break;case 1:r={blur:20,color:"red"};break;case 2:r={blur:20,color:"blue"};break;case 3:r={blur:20,color:"purple"};break}o.drawImage({image:this.localRenderer,x:this.canvasDrawPosX,y:this.canvasDrawPosY,w:this.canvasDrawWidth,h:this.canvasDrawHeight,rotation:s,rotationAnchor:i,flip:this.flip,shadow:t&&o.preview?r:void 0,composite:this.composite,filters:this.filters})}hitTest(t,o){if(!this.localRenderer)return!1;const n=this.getHitbox(),s=n.x0+(n.x1-n.x0)/2,i=n.y0+(n.y1-n.y0)/2,[r,a]=_s(t,o,s,i,this.flip?this.rotation:-this.rotation);if(!(r>=n.x0&&r<=n.x1&&a>=n.y0&&a<=n.y1))return!1;if(this.hitDetectionFallback)return!0;try{return this.pixelPerfectHitTest(t,o)}catch{this.hitDetectionFallback=!0}return!0}pixelPerfectHitTest(t,o){if(!this.localRenderer)return!1;const[n,s]=this.getRenderRotation(),[i,r]=s?_s(t,o,s.x,s.y,-n):[t,o],a=Math.round(i-this.canvasDrawPosX),l=Math.round(r-this.canvasDrawPosY),d=this.canvasDrawWidth,c=this.canvasDrawHeight;if(a>=0&&a<=d&&l>=0&&l<=c){const f=this.flip?this.canvasDrawWidth-a:a,h=this.canvasWidth/this.canvasDrawWidth,b=this.canvasHeight/this.canvasDrawHeight;return this.localRenderer.getDataAt(Math.round(f*h),Math.round(l*b))[3]!==0}return!1}getHitbox(){return{x0:this.x-this.width/2,x1:this.x+this.width/2,y0:this.y,y1:this.y+this.height}}updatedContent(t,o){}}class Xs extends Dc{constructor(o){super(o);v(this,"lastWidth",-1);v(this,"lastHeight",-1);v(this,"lastX",-1);v(this,"lastY",-1);v(this,"lastFlip",null);v(this,"canvasHeight");v(this,"canvasWidth");v(this,"canvasDrawHeight");v(this,"canvasDrawWidth");v(this,"canvasDrawPosX",0);v(this,"canvasDrawPosY",0);const n=Y().Base;this.canvasHeight=n.screenHeight,this.canvasWidth=n.screenWidth,this.canvasDrawHeight=n.screenHeight,this.canvasDrawWidth=n.screenWidth}getRenderRotation(){return[0,void 0]}needsRedraw(){return super.needsRedraw()?!0:this.width!==this.lastWidth||this.height!==this.lastHeight||this.x!==this.lastX||this.y!==this.lastY||this.flip!==this.lastFlip}async updateLocalCanvas(o){this.lastWidth=this.width,this.lastHeight=this.height,this.lastX=this.x,this.lastY=this.y,this.lastFlip=this.flip,await super.updateLocalCanvas(o)}async renderLocal(o){const n=Y().Base;if(this.rotation===0)return await this.draw(o);await o.customTransform(async s=>{const i=this.getHitbox(),r=i.x0+(i.x1-i.x0)/2,a=i.y0+(i.y1-i.y0)/2,l=this.flip?n.screenWidth-r:r;s.translate(l,a),s.rotate(this.rotation),s.translate(-l,-a)},this.draw.bind(this))}getHitbox(){const o=this.centeredVertically,n=this.width/2,s=this.height/2;return{x0:this.x-n,x1:this.x+n,y0:o?this.y-s:this.y,y1:o?this.y+s:this.y+this.height}}get centeredVertically(){return!1}}class fa{constructor(t){this.base=t}static get resizable(){return!1}static get defaultWidth(){return Yo}static get defaultHeight(){return Fs}static get defaultX(){return Y().Base.screenWidth/2}static get defaultY(){return Y().Base.screenHeight-this.defaultHeight-gt-Y().TextBox.TextBoxBottomSpacing}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return oa}getControlsDisabledStyle(){return oc}get textboxStyle(){return na}renderControls(t,o){const n=Y(),s=this.width,i=s/2,l=(this.base.obj.flip?n.Base.screenWidth-this.base.obj.x:this.base.obj.x)-i+s/2,d=this.getControlsStyle();t.drawText({text:"History",x:l+Kr,y:o,...d}),t.drawText({text:"Skip",x:l+Jr,y:o,...this.base.obj.skip?d:this.getControlsDisabledStyle()}),t.drawText({text:"Auto   Save   Load   Settings",x:l+Zr,y:o,...d})}}class Ao extends fa{constructor(){super(...arguments);v(this,"backgroundImage","textbox");v(this,"xOffset",0)}get height(){return Fs+gt}get width(){return Yo}get nameboxWidth(){return Rn}get nameboxHeight(){return gt}get nameboxOffsetX(){return Fn}get nameboxOffsetY(){return Ns}get nameboxStyle(){return Ws}get textOffsetX(){return Mn}get textOffsetY(){return Ls}async renderNamebox(o,n,s){o.drawImage({image:await At("namebox"),x:n,y:s})}async renderBackdrop(o,n,s){n+=this.xOffset;const i=await At(this.backgroundImage);o.drawImage({image:i,x:n,y:s})}async render(o){const n=Y(),s=this.width,i=this.height,r=s/2,l=(this.obj.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r,d=this.obj.y;await this.renderBackdrop(o,l,d+this.nameboxHeight),this.obj.talkingObjId!==null&&await this.renderNamebox(o,l+this.nameboxOffsetX,d);const c=d+i,f=c-Yr;this.obj.controls&&this.renderControls(o,f),this.obj.continue&&o.drawImage({image:await At("next"),x:l+s-Qr,y:c-ea})}}v(Ao,"id","normal"),v(Ao,"label","Normal"),v(Ao,"priority",0),v(Ao,"gameMode","ddlc");class pn extends Ao{constructor(){super(...arguments);v(this,"backgroundImage","textbox_monika");v(this,"xOffset",(Yo-qr)/2)}}v(pn,"id","corrupt"),v(pn,"label","Corrupted"),v(pn,"priority",1),v(pn,"gameMode","ddlc");function Ss(e,t,o,n,s,i){n<0&&(n=0),s<0&&(s=0),n<2*i&&(i=n/2),s<2*i&&(i=s/2),e.moveTo(t+i,o),e.arcTo(t+n,o,t+n,o+s,i),e.arcTo(t+n,o+s,t,o+s,i),e.arcTo(t,o+s,t,o,i),e.arcTo(t,o,t+n,o,i),e.closePath()}function Hc(e,t,o,n,s,i){n<0&&(n=0),s<0&&(s=0),n<2*i&&(i=n/2),s<2*i&&(i=s/2),e.moveTo(t+i,o),e.arcTo(t+n,o,t+n,o+s,i),e.lineTo(t+n,o+s),e.lineTo(t,o+s),e.arcTo(t,o,t+n,o,i),e.closePath()}class gn extends fa{constructor(){super(...arguments);v(this,"backgroundImage","textbox");v(this,"xOffset",0)}static get resizable(){return!0}get height(){return this.obj.height+gt}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth!==null?this.obj.customNameboxWidth:Rn}get nameboxHeight(){return gt}get nameboxOffsetX(){return Fn}get nameboxOffsetY(){return Ns}get nameboxStyle(){return{...Ws,strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"}}get textOffsetX(){return Mn}get textOffsetY(){return Ls}get customColor(){if(this.obj.overrideColor)return this.obj.customColor;const o=this.refObject;return o!=null&&o.textboxColor!=null?o.textboxColor:Gd}get nameboxOutlineColor(){return this.obj.deriveCustomColors?ie.fromCss(this.customColor).toHSL().shift(Xd).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?ie.fromCss(this.customColor).toHSL().shift(qd).toRgb().toCss():this.obj.customNameboxColor}async renderNamebox(o,n,s){const i=this.nameboxWidth,r=this.nameboxHeight;await o.customTransform(async a=>{a.beginPath(),Hc(a,n,s,i,r,Jd),a.clip()},async a=>{const l=a.linearGradient(n,s,n,s+r),d=ie.fromCss(this.nameboxBackgroundColor),c=new ie(d.r,d.g,d.b,.95),f=c.toHSL().shift(Kd).toRgb();l.addColorStop(0,c.toCss()),l.addColorStop(Yd,c.toCss()),l.addColorStop(1,f.toCss()),a.drawRect({x:n,y:s,w:this.obj.width,h:r,fill:{style:l}})})}async renderBackdrop(o,n,s){const i=ie.fromCss(this.customColor).toHSL(),r=new Wn(Pt,Pt);await r.render(async l=>{const d={style:i.shift(Zd).toRgb().toCss()};function c(f,h){l.drawPath({path:b=>{b.ellipse(f,h,Gi,Gi,0,0,2*Math.PI)},fill:d})}c(0,0),c(Pt,0),c(0,Pt),c(Pt,Pt),c(Pt/2,Pt/2)},!0),await o.customTransform(async l=>{l.beginPath(),Ss(l,n+xt,s+xt,this.width-xt*2,this.height-gt-xt*2,Ui),l.clip()},async l=>{const d=this.obj.height,c=this.obj.width,f=l.linearGradient(n,s,n,s+d),h=ie.fromHex(this.customColor);f.addColorStop(0,h.toCss()),f.addColorStop(1,`rgba(${h.r},${h.g},${h.b},0.6667)`),l.drawRect({x:n,y:s,w:c,h:d,fill:{style:f},outline:{style:"#ffdfee",width:6}}),await l.customTransform(async y=>{y.translate(n,s)},async y=>{const k=l.patternFrom(r);l.drawRect({x:0,y:0,w:c,h:d,fill:{style:k},composition:"source-atop"})});const b=l.linearGradient(n,s+d-Xi,n,s+d);b.addColorStop(0,"rgba(255,255,255,0.3137)"),b.addColorStop(.5,"rgba(255,255,255,0.0627)"),b.addColorStop(1,"rgba(255,255,255,0)"),l.drawPath({path:y=>{y.ellipse(n+c/2,s+d,tc,Xi,0,0,2*Math.PI)},fill:{style:b}})});const a=i.shift(Qd).toRgb().toCss();o.drawPath({path:l=>{Ss(l,n+xt,s+xt,this.width-xt*2,this.height-gt-xt*2,Ui)},outline:{style:a,width:ec}})}async render(o){const n=Y(),s=this.width,i=this.height,r=s/2,l=(this.obj.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r,d=this.obj.y;this.obj.talkingObjId!==null&&await this.renderNamebox(o,l+this.nameboxOffsetX,d),await this.renderBackdrop(o,l,d+this.nameboxHeight);const c=d+i,f=c-Yr;this.obj.controls&&this.renderControls(o,f),this.obj.continue&&o.drawImage({image:await At("next"),x:l+s-Qr,y:c-ea})}}v(gn,"id","custom"),v(gn,"label","Custom"),v(gn,"priority",0),v(gn,"gameMode","ddlc");class mn extends fa{get height(){return Fs+gt}get width(){return Yo}get nameboxWidth(){return Rn}get nameboxHeight(){return gt}get nameboxOffsetX(){return Fn}get nameboxOffsetY(){return Ns}get nameboxStyle(){return Ws}get textOffsetX(){return Mn}get textOffsetY(){return Ls}get textboxStyle(){return na}async render(t){}}v(mn,"id","none"),v(mn,"label","None"),v(mn,"priority",0),v(mn,"gameMode","ddlc");const ya=class{constructor(t){this.base=t}static get resizable(){return!1}static get defaultWidth(){return ra}static get defaultHeight(){return bc}static get defaultX(){return Y().Base.screenWidth/2}static get defaultY(){return Y().Base.screenHeight-this.defaultHeight-Bo-Y().TextBox.TextBoxBottomSpacing}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return $s}getControlsDisabledStyle(){return jc}renderControls(t,o){const n=Y(),s=this.width,i=s/2,a=(this.base.obj.flip?n.Base.screenWidth-this.base.obj.x:this.base.obj.x)-i,l=this.getControlsStyle(),d=["History","Skip","Auto","Save","Load","Settings"],c=[];let f=0;for(const y of d){const k=ya.controlWidth(t,y);c.push(k),f+=k}const h=Math.min((s-f)/(d.length+2),78);let b=a+(s-f-h*(d.length-1))/2;for(let y=0;y<d.length;++y){const k=d[y],T=c[y],D=k==="Skip"&&!this.base.obj.skip?this.getControlsDisabledStyle():l;t.drawText({text:k,x:b,y:o,...D}),b+=T+h}}static controlWidth(t,o){if(this.widthCache[o])return this.widthCache[o];const n=t.measureText({text:o,...$s}).width;return this.widthCache[o]=n,n}};let rs=ya;v(rs,"widthCache",{});class bn extends rs{constructor(){super(...arguments);v(this,"backgroundImage","textbox");v(this,"xOffset",0)}static get resizable(){return!0}get height(){return this.obj.height+Bo}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth!==null?this.obj.customNameboxWidth:la}get nameboxHeight(){return Bo}get nameboxOffsetX(){return da}get nameboxOffsetY(){return vc}get nameboxStyle(){return{...Pc,strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"}}get textOffsetX(){return aa}get textOffsetY(){return yc}get textboxStyle(){return Ic}get customColor(){if(this.obj.overrideColor)return this.obj.customColor;const o=this.refObject;return o!=null&&o.textboxColor!=null?o.textboxColor:ac}get nameboxOutlineColor(){return this.obj.deriveCustomColors?ie.fromCss(this.customColor).toHSL().shift(lc).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?ie.fromCss(this.customColor).toHSL().shift(dc).toRgb().toCss():this.obj.customNameboxColor}async renderNamebox(o,n,s){const i=this.nameboxWidth,r=this.nameboxHeight;await o.customTransform(async a=>{a.beginPath(),Hc(a,n,s,i,r,fc),a.clip()},async a=>{const l=a.linearGradient(n,s,n,s+r),d=ie.fromCss(this.nameboxBackgroundColor),c=new ie(d.r,d.g,d.b,.95),f=c.toHSL().shift(uc).toRgb();l.addColorStop(0,c.toCss()),l.addColorStop(cc,c.toCss()),l.addColorStop(1,f.toCss()),a.drawRect({x:n,y:s,w:this.obj.width,h:r,fill:{style:l}})})}async renderBackdrop(o,n,s){const i=ie.fromCss(this.customColor).toHSL(),r=new Wn(It,It);await r.render(async l=>{const d={style:i.shift(hc).toRgb().toCss()};function c(f,h){l.drawPath({path:b=>{b.ellipse(f,h,Yi,Yi,0,0,2*Math.PI)},fill:d})}c(0,0),c(It,0),c(0,It),c(It,It),c(It/2,It/2)},!0),await o.customTransform(async l=>{l.beginPath(),Ss(l,n+jt,s+jt,this.width-jt*2,this.height-Bo-jt*2,qi),l.clip()},async l=>{const d=this.obj.height,c=this.obj.width,f=l.linearGradient(n,s,n,s+d),h=ie.fromHex(this.customColor);f.addColorStop(0,h.toCss()),f.addColorStop(1,`rgba(${h.r},${h.g},${h.b},0.6667)`),l.drawRect({x:n,y:s,w:c,h:d,fill:{style:f},outline:{style:"#ffdfee",width:6}}),await l.customTransform(async y=>{y.translate(n,s)},async y=>{const k=l.patternFrom(r);l.drawRect({x:0,y:0,w:c,h:d,fill:{style:k},composition:"source-atop"})});const b=l.linearGradient(n,s+d-Ki,n,s+d);b.addColorStop(0,"rgba(255,255,255,0.3137)"),b.addColorStop(.5,"rgba(255,255,255,0.0627)"),b.addColorStop(1,"rgba(255,255,255,0)"),l.drawPath({path:y=>{y.ellipse(n+c/2,s+d,xc,Ki,0,0,2*Math.PI)},fill:{style:b}})});const a=i.shift(pc).toRgb().toCss();o.drawPath({path:l=>{Ss(l,n+jt,s+jt,this.width-jt*2,this.height-Bo-jt*2,qi)},outline:{style:a,width:gc}})}async render(o){const n=Y(),s=this.width,i=this.height,r=s/2,l=(this.obj.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r,d=this.obj.y;this.obj.talkingObjId!==null&&await this.renderNamebox(o,l+this.nameboxOffsetX,d),await this.renderBackdrop(o,l,d+this.nameboxHeight);const c=d+i,f=c-wc;this.obj.controls&&this.renderControls(o,f),this.obj.continue&&o.drawImage({image:await At("next_plus"),x:l+s-_c,y:c-Sc})}}v(bn,"id","custom_plus"),v(bn,"label","Custom (Plus)"),v(bn,"priority",0),v(bn,"gameMode","ddlc_plus");const Ry=[Ao,pn,gn,mn,bn],$n=(()=>{const e={};for(const t of Ry)e[t.id]=t;return e})();class Fy extends Xs{constructor(){super(...arguments);v(this,"refObject",null);v(this,"_lastRenderer",null)}get y(){return this.obj.y}get width(){return this.textboxRenderer.width}get height(){return this.textboxRenderer.height}get textboxRenderer(){const o=this.forcedStyle,n=$n[o];if(this._lastRenderer&&this._lastRenderer.constructor===n)return this._lastRenderer;const s=new n(this);return this._lastRenderer=s,s}get forcedStyle(){const o=this.refObject;return(this.obj.style==="normal"||this.obj.style==="normal_plus")&&o&&(o.textboxColor!=null||o.nameboxWidth!=null)?"custom":this.obj.style}updatedContent(o,n){super.updatedContent(o,n);const s=this.obj.talkingObjId;if(s!==null&&s!=="$other$"){const i=o.state.panels.panels[n].objects[s];this.refObject=i!=null?i:null;return}this.refObject=null}async draw(o){var c,f;const n=Y(),s=this.textboxRenderer,i=s.width,r=i/2,l=(this.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r,d=this.obj.y;if(await s.render(o),this.obj.talkingObjId!==null){const h=this.obj.talkingObjId==="$other$"?this.obj.talkingOther:(f=(c=this.refObject)==null?void 0:c.label)!=null?f:"Missing name";await this.renderName(o,l+s.nameboxOffsetX,d,h)}await this.renderText(o,l,d,this.obj.autoWrap?i:0)}async renderName(o,n,s,i){const r=this.textboxRenderer,a=r.nameboxWidth,l=r.nameboxStyle,d=new yt(i,l);await d.loadFonts(),d.fixAlignment("center",n,n+a,s+r.nameboxOffsetY,0),d.render(o.fsCtx)}async renderText(o,n,s,i){const r=this.textboxRenderer,a=new yt(this.obj.text,r.textboxStyle);this.obj.autoQuoting&&this.obj.talkingObjId!==null&&a.quote(),await a.loadFonts(),a.fixAlignment("left",n+r.textOffsetX,0,s+r.nameboxHeight+r.textOffsetY,i-r.textOffsetX*2),a.render(o.fsCtx)}}const Ly=ne({components:{Toggle:wt,DFieldset:Ct},props:{obj:{required:!0}},computed:{freeMove:{get(){return this.obj.freeMove},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setFreeMove",{id:this.obj.id,panelId:this.obj.panelId,freeMove:e})})}},preserveRatio:{get(){return this.obj.preserveRatio},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPreserveRatio",{id:this.obj.id,panelId:this.obj.panelId,preserveRatio:e})})}},pos:{get(){return ks(this.obj.x)},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPosition",{id:this.obj.id,panelId:this.obj.panelId,x:Y().Base.characterPositions[e],y:this.obj.y})})}},x:{get(){return this.obj.x},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPosition",{id:this.obj.id,panelId:this.obj.panelId,x:e,y:this.y})})}},y:{get(){return this.obj.y},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPosition",{id:this.obj.id,panelId:this.obj.panelId,x:this.x,y:e})})}},height:{get(){return this.obj.height},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setHeight",{id:this.obj.id,panelId:this.obj.panelId,height:e})})}},width:{get(){return this.obj.width},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setWidth",{id:this.obj.id,panelId:this.obj.panelId,width:e})})}},allowSize(){const e=this.obj;return e.type==="textBox"?$n[e.style].resizable:!(e.type==="character"&&!e.freeMove)},allowStepMove(){return"freeMove"in this.obj},positionNames(){return Y().Base.positions},isFirstPos(){return this.pos===0},isLastPos(){return this.pos===Y().Base.positions.length-1}}});const qs=e=>(He("data-v-c33846f6"),e=e(),Me(),e),Ny={colspan:"2"},Wy={key:0},Vy={colspan:"2"},zy={class:"arrow-col"},Uy=["disabled"],Gy=["value"],Xy={class:"arrow-col"},qy=["disabled"],Yy=qs(()=>u("td",null,[u("label",{for:"sprite_x"},"X:")],-1)),Ky=qs(()=>u("td",null,[u("label",{for:"sprite_y"},"Y:")],-1)),Jy=qs(()=>u("td",null,[u("label",{for:"sprite_w"},"Width:")],-1)),Zy=qs(()=>u("td",null,[u("label",{for:"sprite_h"},"Height:")],-1)),Qy={colspan:"2"};function ev(e,t,o,n,s,i){const r=M("toggle"),a=M("d-fieldset");return m(),z(a,{title:"Position"+(e.allowSize?"/Size":"")},{default:E(()=>[u("table",null,[u("tr",null,[u("td",Ny,[e.allowStepMove?(m(),z(r,{key:0,modelValue:e.freeMove,"onUpdate:modelValue":t[0]||(t[0]=l=>e.freeMove=l),label:"Move freely?"},null,8,["modelValue"])):X("",!0)])]),e.allowStepMove&&!e.freeMove?(m(),C("tr",Wy,[u("td",Vy,[u("table",null,[u("tr",null,[u("td",zy,[u("button",{onClick:t[1]||(t[1]=l=>--e.pos),disabled:e.isFirstPos},"<",8,Uy)]),u("td",null,[de(u("select",{id:"current_talking","onUpdate:modelValue":t[2]||(t[2]=l=>e.pos=l)},[(m(!0),C(N,null,$e(e.positionNames,(l,d)=>(m(),C("option",{key:d,value:d},he(l),9,Gy))),128))],512),[[lt,e.pos,void 0,{number:!0}]])]),u("td",Xy,[u("button",{onClick:t[3]||(t[3]=l=>++e.pos),disabled:e.isLastPos},">",8,qy)])])])])])):(m(),C(N,{key:1},[u("tr",null,[Yy,u("td",null,[de(u("input",{id:"sprite_x",type:"number","onUpdate:modelValue":t[4]||(t[4]=l=>e.x=l),onKeydown:t[5]||(t[5]=q(()=>{},["stop"]))},null,544),[[je,e.x,void 0,{number:!0}]])])]),u("tr",null,[Ky,u("td",null,[de(u("input",{id:"sprite_y",type:"number","onUpdate:modelValue":t[6]||(t[6]=l=>e.y=l),onKeydown:t[7]||(t[7]=q(()=>{},["stop"]))},null,544),[[je,e.y,void 0,{number:!0}]])])])],64)),e.allowSize?(m(),C(N,{key:2},[u("tr",null,[Jy,u("td",null,[de(u("input",{id:"sprite_w",min:"0",type:"number","onUpdate:modelValue":t[8]||(t[8]=l=>e.width=l),onKeydown:t[9]||(t[9]=q(()=>{},["stop"]))},null,544),[[je,e.width,void 0,{number:!0}]])])]),u("tr",null,[Zy,u("td",null,[de(u("input",{id:"sprite_h",min:"0",type:"number","onUpdate:modelValue":t[10]||(t[10]=l=>e.height=l),onKeydown:t[11]||(t[11]=q(()=>{},["stop"]))},null,544),[[je,e.height,void 0,{number:!0}]])])]),u("tr",null,[u("td",Qy,[$(r,{modelValue:e.preserveRatio,"onUpdate:modelValue":t[12]||(t[12]=l=>e.preserveRatio=l),label:"Lock ratio?"},null,8,["modelValue"])])])],64)):X("",!0)])]),_:1},8,["title"])}const tv=se(Ly,[["render",ev],["__scopeId","data-v-c33846f6"]]),ov=ne({components:{Toggle:wt,DFieldset:Ct},props:{object:{required:!0}},computed:{onTop:Nn()("onTop","panels/setOnTop",!0)},methods:{shiftLayer(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/shiftLayer",{id:this.object.id,panelId:this.object.panelId,delta:e})})}}});const Ys=e=>(He("data-v-d80e9416"),e=e(),Me(),e),nv=Ys(()=>u("i",{class:"material-icons"},"vertical_align_bottom",-1)),sv=[nv],iv=Ys(()=>u("i",{class:"material-icons"},"arrow_downward",-1)),rv=[iv],av=Ys(()=>u("i",{class:"material-icons"},"arrow_upward",-1)),lv=[av],dv=Ys(()=>u("i",{class:"material-icons"},"vertical_align_top",-1)),cv=[dv];function uv(e,t,o,n,s,i){const r=M("toggle"),a=M("d-fieldset");return m(),z(a,{id:"layerfs",title:"Layer:"},{default:E(()=>[u("table",null,[u("tbody",null,[u("tr",null,[u("td",null,[u("button",{onClick:t[0]||(t[0]=l=>e.shiftLayer(-1/0)),title:"Move to back"},sv)]),u("td",null,[u("button",{onClick:t[1]||(t[1]=l=>e.shiftLayer(-1)),title:"Move backwards"},rv)]),u("td",null,[u("button",{onClick:t[2]||(t[2]=l=>e.shiftLayer(1)),title:"Move forwards"},lv)]),u("td",null,[u("button",{onClick:t[3]||(t[3]=l=>e.shiftLayer(1/0)),title:"Move to front"},cv)])])])]),$(r,{modelValue:e.onTop,"onUpdate:modelValue":t[4]||(t[4]=l=>e.onTop=l),label:"In front?"},null,8,["modelValue"])]),_:1})}const fv=se(ov,[["render",uv],["__scopeId","data-v-d80e9416"]]),hv=ne({props:{obj:{required:!0}},methods:{onClick(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/removeObject",{panelId:this.obj.panelId,id:this.obj.id})})}}});function pv(e,t,o,n,s,i){return m(),C("button",{onClick:t[0]||(t[0]=(...r)=>e.onClick&&e.onClick(...r))},"Delete")}const gv=se(hv,[["render",pv]]),Qn=255,mi=8,mv=ne({props:{label:{type:String,required:!0},gradientStops:{required:!0},modelValue:{type:Number,required:!0},maxValue:{type:Number,required:!0},shiftGradient:{type:Boolean,default:!1},noInput:{type:Boolean,default:!1}},data:()=>({slideActive:!1}),computed:{vertical(){return this.$store.state.ui.vertical},pointerPath(){const e=this.modelValue/this.maxValue*Qn;return`M${e} 0L${e+14} 0L${e+7} 12Z`},gradientOffset(){return!this.shiftGradient||this.modelValue===0?0:this.modelValue/this.maxValue}},methods:{enterSlide(e){this.slideActive=!0,this.moveSlide(e)},moveSlide(e){if(!this.slideActive)return;const t=this.$refs.svg;if(!t.contains(e.target)&&e.target!==t)return;if(e instanceof MouseEvent&&e.which!==1){this.slideActive=!1;return}const o=t.getBoundingClientRect(),n=o.width/(mi+Qn+mi),i=((e instanceof MouseEvent?e.clientX:e.touches[0].clientX)-o.x)/n;e.preventDefault();const r=Math.max(Math.min(i-mi,Qn),0)/Qn*this.maxValue;this.$emit("update:modelValue",r)},exitSlide(){this.slideActive=!1}}});const bv=["for"],yv=["id","x1","x2"],vv=["offset"],wv=["fill"],Cv=["d"],$v=["id","max","value"];function kv(e,t,o,n,s,i){return m(),C("div",{class:le({slider:!0,vertical:e.vertical}),onKeydown:t[8]||(t[8]=q(()=>{},["stop"]))},[e.noInput?X("",!0):(m(),C("label",{key:0,for:e._.uid},he(e.label),9,bv)),u("div",null,[(m(),C("svg",{ref:"svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 271 24",onMousedown:t[0]||(t[0]=(...r)=>e.enterSlide&&e.enterSlide(...r)),onTouchstart:t[1]||(t[1]=(...r)=>e.enterSlide&&e.enterSlide(...r)),onMousemove:t[2]||(t[2]=(...r)=>e.moveSlide&&e.moveSlide(...r)),onTouchmove:t[3]||(t[3]=(...r)=>e.moveSlide&&e.moveSlide(...r)),onMouseup:t[4]||(t[4]=(...r)=>e.exitSlide&&e.exitSlide(...r)),onTouchend:t[5]||(t[5]=(...r)=>e.exitSlide&&e.exitSlide(...r))},[u("defs",null,[u("linearGradient",{id:`gradient${e._.uid}`,x1:e.gradientOffset*100+"%",y1:"0%",x2:(e.gradientOffset+1)*100+"%",y2:"0%",spreadMethod:"repeat"},[(m(!0),C(N,null,$e(e.gradientStops,(r,a)=>(m(),C("stop",{key:a,offset:a/(e.gradientStops.length-1)*100+"%",style:Ae("stop-color:"+r)},null,12,vv))),128))],8,yv)]),u("g",null,[u("path",{d:"M7 0H262V24H7z","stroke-width":"2","paint-order":"fill stroke markers",fill:`url(#gradient${e._.uid})`},null,8,wv),u("path",{d:e.pointerPath,"stroke-width":"2",class:"slider-pointer"},null,8,Cv)])],544))]),e.noInput?X("",!0):(m(),C("input",{key:1,id:e._.uid,class:"sliderInput",min:"0",max:e.maxValue,value:e.modelValue,type:"number",onInput:t[6]||(t[6]=r=>e.$emit("update:modelValue",parseFloat(r.target.value))),onKeydown:t[7]||(t[7]=q(()=>{},["stop"]))},null,40,$v))],34)}const Mc=se(mv,[["render",kv],["__scopeId","data-v-7a5dc4a7"]]),_v=ne({components:{Slider:Mc},props:{modelValue:{type:String,validator:e=>!!e.match(/^#[0-9a-f]{6,8}$/i)},mode:{type:String},relative:Boolean},data:()=>({lastRGBEmit:null,v1:0,v2:0,v3:0,a:0}),computed:{vertical(){return this.$store.state.ui.vertical},maxValue1(){return this.mode==="rgba"?255:360},label1(){return this.mode==="rgba"?"Red":"Hue"},stops1(){let e=[];if(this.mode==="rgba"){const t=this.relative?this.v2:0,o=this.relative?this.v3:0;e=[new ie(0,t,o,1),new ie(255,t,o,1)]}else{const t=this.relative?this.v2/100:1,o=this.relative?this.v3/100:.5;e=this.eightsStops(n=>new be(n,t,o,1))}return e.map(t=>t.toRgb().toCss())},maxValue2(){return this.mode==="rgba"?255:100},label2(){return this.mode==="rgba"?"Green":"Saturation"},stops2(){let e=[];if(this.mode==="rgba"){const t=this.relative?this.v1:0,o=this.relative?this.v3:0;e=[new ie(t,0,o,1),new ie(t,255,o,1)]}else{const t=this.relative?this.v1/360:0,o=this.relative?this.v3/100:.5;e=this.eightsStops(n=>new be(t,n,o,1))}return e.map(t=>t.toRgb().toCss())},maxValue3(){return this.mode==="rgba"?255:100},label3(){return this.mode==="rgba"?"Blue":"Luminosity"},stops3(){let e=[];if(this.mode==="rgba"){const t=this.relative?this.v1:0,o=this.relative?this.v2:0;e=[new ie(t,o,0,1),new ie(t,o,255,1)]}else{const t=this.relative?this.v1/360:0,o=this.relative?this.v2/100:.5;e=this.eightsStops(n=>new be(t,o,n,1))}return e.map(t=>t.toRgb().toCss())},stopsAlpha(){const e=ie.fromHex(this.modelValue);return[new ie(e.r,e.g,e.b,0).toCss(),new ie(e.r,e.g,e.b,1).toCss()]}},created(){this.initValues()},methods:{valueChanged(){this.modelValue!==this.lastRGBEmit&&this.initValues()},updateValue(){let e;this.mode==="rgba"?e=new ie(this.v1,this.v2,this.v3,this.a/255):e=new be(this.v1/360,this.v2/100,this.v3/100,this.a/255);const t=e.toRgb().toHex();if(this.lastRGBEmit!==t){if(t.length!==9)throw new Error(`Invalid color code: ${t}`);this.lastRGBEmit=t,this.$emit("update:modelValue",t)}},initValues(){const e=ie.fromHex(this.modelValue);if(this.lastRGBEmit=e.toHex(),this.a=e.a*255,this.mode==="hsla"){const t=e.toHSL();this.v1=t.h*360,this.v2=t.s*100,this.v3=t.l*100}else this.v1=e.r,this.v2=e.g,this.v3=e.b},eightsStops(e){const t=[];for(let o=0;o<=8;++o)t.push(e(o/8));return t}},watch:{value(){this.valueChanged()},v1(){this.updateValue()},v2(){this.updateValue()},v3(){this.updateValue()},a(){this.updateValue()},mode(){this.initValues()}}});function Sv(e,t,o,n,s,i){const r=M("slider");return m(),C("div",null,[$(r,{label:e.label1,modelValue:e.v1,"onUpdate:modelValue":t[0]||(t[0]=a=>e.v1=a),"max-value":e.maxValue1,"gradient-stops":e.stops1},null,8,["label","modelValue","max-value","gradient-stops"]),$(r,{label:e.label2,modelValue:e.v2,"onUpdate:modelValue":t[1]||(t[1]=a=>e.v2=a),"max-value":e.maxValue2,"gradient-stops":e.stops2},null,8,["label","modelValue","max-value","gradient-stops"]),$(r,{label:e.label3,modelValue:e.v3,"onUpdate:modelValue":t[2]||(t[2]=a=>e.v3=a),"max-value":e.maxValue3,"gradient-stops":e.stops3},null,8,["label","modelValue","max-value","gradient-stops"]),$(r,{label:"Alpha",modelValue:e.a,"onUpdate:modelValue":t[3]||(t[3]=a=>e.a=a),"max-value":255,"gradient-stops":e.stopsAlpha},null,8,["modelValue","gradient-stops"])])}const xv=se(_v,[["render",Sv],["__scopeId","data-v-f8c6e84c"]]),Pv="dddg.generated.colors",jv=ne({components:{SliderGroup:xv,DButton:Ms},inheritAttrs:!1,emits:["leave","update:modelValue"],props:{modelValue:{required:!0,type:String},title:{default:""},format:{type:String,default:"hex"}},data:()=>({mode:"hsla",relative:!0}),computed:{vertical(){return this.$store.state.ui.vertical},swatches(){return this.$store.state.content.current.colors},color:{get(){return this.format==="rgb"?ie.fromCss(this.modelValue).toHex():this.modelValue},set(e){if(this.format==="rgb"){const t=ie.fromCss(e);this.$emit("update:modelValue",t.toCss())}else this.$emit("update:modelValue",e)}}},mounted(){we.subscribe(vs,this.settingColor)},unmounted(){we.unsubscribe(vs,this.settingColor)},methods:{settingColor(e){this.color=ie.fromCss(e.color).toHex()},updateHex(e){const t=e.target.value;ie.validHex(t)&&(t.length===7||t.length===9)&&(this.color=t)},addSwatch(){if(this.swatches.find(o=>o.color===this.color))return;const e=this.$store.state.content.contentPacks.find(o=>o.packId==="generatedPackId")||{packId:Pv,packCredits:[""],dependencies:[],characters:[],fonts:[],backgrounds:[],sprites:[],poemStyles:[],poemBackgrounds:[],colors:[]},t={...e,colors:[...e.colors,{label:this.color,color:this.color}]};this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:t,processed:!0})})},pickColor(){this.vuexHistory.transaction(()=>{this.$store.commit("ui/setColorPicker",!0)})}}});const Iv={class:"column"},Tv={class:"hex-selector"},Ov=["for"],Bv=["id","value"],Av=j("Pick color"),Ev=["title","onClick"];function Dv(e,t,o,n,s,i){const r=M("slider-group"),a=M("d-button");return m(),C("div",{class:le({color:!0,vertical:e.vertical})},[u("h2",null,he(e.title),1),u("button",{onClick:t[0]||(t[0]=l=>e.$emit("leave"))},"OK"),u("table",null,[u("tr",null,[u("td",null,[u("button",{onClick:t[1]||(t[1]=l=>e.mode="hsla")},"HSLA")]),u("td",null,[u("button",{onClick:t[2]||(t[2]=l=>e.mode="rgba")},"RGBA")])])]),u("div",Iv,[$(r,{mode:e.mode,modelValue:e.color,"onUpdate:modelValue":t[3]||(t[3]=l=>e.color=l),relative:!0},null,8,["mode","modelValue"]),u("div",Tv,[u("label",{class:"hex-label",for:`hex_${e._.uid}`},"Hex",8,Ov),u("input",{id:`hex_${e._.uid}`,value:e.color,onInput:t[4]||(t[4]=(...l)=>e.updateHex&&e.updateHex(...l)),onKeydown:t[5]||(t[5]=q(()=>{},["stop"]))},null,40,Bv)]),u("button",{onClick:t[6]||(t[6]=(...l)=>e.addSwatch&&e.addSwatch(...l))},"Add as swatch"),$(a,{icon:"colorize",onClick:e.pickColor},{default:E(()=>[Av]),_:1},8,["onClick"])]),u("div",{id:"color-swatches",class:le({vertical:e.vertical})},[(m(!0),C(N,null,$e(e.swatches,l=>(m(),C("button",{class:"swatch",key:l.color,style:Ae({backgroundColor:l.color}),title:l.label,onClick:d=>{e.color=l.color,e.$emit("leave")}},null,12,Ev))),128))],2)],2)}const Ks=se(jv,[["render",Dv],["__scopeId","data-v-4896b45d"]]),Cl=new Set(["brightness","contrast","grayscale","invert","opacity","saturate","sepia"]);function er(e,t,o){const s=[...t().filters];let i;switch(e.type){case"hue-rotate":i={type:e.type,value:0};break;case"sepia":case"invert":case"blur":case"grayscale":case"brightness":case"contrast":case"opacity":case"saturate":i={type:e.type,value:1};break;case"drop-shadow":i={type:e.type,blurRadius:0,offsetX:10,offsetY:10,color:"#555555"};break;default:throw new bt.UnreachableCaseError(e.type)}s.splice(e.idx,0,i),o({panelId:e.panelId,id:e.id,filters:s})}function tr(e,t,o){const s=[...t().filters];s.splice(e.idx,1),o({id:e.id,panelId:e.panelId,filters:s})}function or(e,t,o){const s=[...t().filters],i=s[e.idx];s.splice(e.idx,1),s.splice(e.idx+e.moveBy,0,i),o({id:e.id,panelId:e.panelId,filters:s})}function nr(e,t,o){const s=[...t().filters],i={...s[e.idx]};s[e.idx]=i,i.type==="drop-shadow"?(e.blurRadius!==void 0&&(i.blurRadius=e.blurRadius),e.color!==void 0&&(i.color=e.color),e.offsetX!==void 0&&(i.offsetX=e.offsetX),e.offsetY!==void 0&&(i.offsetY=e.offsetY)):i.value=e.value,o({id:e.id,panelId:e.panelId,filters:s})}const Oo=new Map([["blur","Blur"],["brightness","Brightness"],["contrast","Contrast"],["grayscale","Grayscale"],["hue-rotate","Rotate hue"],["invert","Invert colors"],["opacity","Opacity"],["saturate","Saturate"],["sepia","Sepia"],["drop-shadow","Drop shadow"]]),Hv=Array.from(Oo.keys()).sort(),Mv=ne({components:{DFlow:Ln,DFieldset:Ct,Color:Ks,Slider:Mc,L:Ur},props:{type:{type:String,required:!0},title:{type:String},id:{},panelId:{required:!0},noComposition:{type:Boolean,default:!1}},emits:["leave"],data:()=>({addEffectSelection:"",currentFilterIdx:0,showShadowColor:!1}),computed:{object(){switch(this.type){case"object":return this.$store.state.panels.panels[this.panelId].objects[this.id];case"background":return this.$store.state.panels.panels[this.panelId].background;case"panel":return this.$store.state.panels.panels[this.panelId];default:throw new bt.UnreachableCaseError(this.type)}},compositionMode:{get(){return this.object.composite},set(e){this.vuexHistory.transaction(()=>{switch(this.type){case"object":this.$store.commit("panels/setComposition",{id:this.id,panelId:this.panelId,composite:e});break;case"background":break;case"panel":break;default:throw new bt.UnreachableCaseError(this.type)}})}},filters(){return this.object.filters},filterTypes(){try{if("filter"in document.createElement("canvas").getContext("2d"))return Hv}catch{}return["opacity"]},currentFilter(){var e;return(e=this.filters[this.currentFilterIdx])!=null?e:null},isPercentFilter(){const e=this.currentFilter;return e?Cl.has(e.type):!1},maxValue(){const e=this.currentFilter;if(!!e){if(e.type==="hue-rotate")return 360;if(e.type==="grayscale"||e.type==="sepia"||e.type==="opacity"||e.type==="invert")return 100}},minValue(){const e=this.currentFilter;if(!!e)switch(e.type){case"blur":case"brightness":case"contrast":case"grayscale":case"hue-rotate":case"invert":case"opacity":case"saturate":case"sepia":return 0}},shadowColor:{get(){const e=this.currentFilter;if(!!e&&"color"in e)return e.color},set(e){this.setValue({color:e})}},shadowX:{get(){const e=this.currentFilter;if(!!e&&"offsetX"in e)return e.offsetX},set(e){this.setValue({offsetX:e})}},shadowY:{get(){const e=this.currentFilter;if(!!e&&"offsetY"in e)return e.offsetY},set(e){this.setValue({offsetY:e})}},shadowBlur:{get(){const e=this.currentFilter;if(!!e&&"blurRadius"in e)return e.blurRadius},set(e){this.setValue({blurRadius:e})}},hueStops(){return this.eightsStops(t=>new be(t,1,.5,1)).map(t=>t.toRgb().toCss())}},methods:{getFilterLabel(e){return Oo.get(e)},getFilterText(e){return Cl.has(e.type)?`${Oo.get(e.type)} ${(e.value*100).toFixed()}%`:e.type==="hue-rotate"?`${Oo.get(e.type)} ${e.value.toFixed()}\xB0`:e.type==="blur"?`${Oo.get(e.type)} ${e.value.toFixed()}px`:Oo.get(e.type)},objectTypeScope(e){switch(this.type){case"object":return"panels/object_"+e;case"background":return"panels/background"+e[0].toUpperCase()+e.slice(1);case"panel":return"panels/"+e}},addFilter(){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("addFilter"),{id:this.id,panelId:this.panelId,type:this.addEffectSelection,idx:this.currentFilterIdx+1})})},selectFilter(e){this.currentFilterIdx=e},removeFilter(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch(this.objectTypeScope("removeFilter"),{id:this.id,panelId:this.panelId,idx:this.currentFilterIdx}),this.currentFilterIdx>=this.object.filters.length&&(this.currentFilterIdx=this.object.filters.length-1)})},moveFilter(e){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("moveFilter"),{id:this.id,panelId:this.panelId,idx:this.currentFilterIdx,moveBy:e}),this.currentFilterIdx+=e})},setValue(e){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("setFilter"),{id:this.id,panelId:this.panelId,idx:this.currentFilterIdx,...e})})},eightsStops(e){const t=[];for(let o=0;o<=8;++o)t.push(e(o/8));return t}}});const ue=e=>(He("data-v-4df302c6"),e=e(),Me(),e),Rv=ue(()=>u("h2",null,"Image options",-1)),Fv={class:"column ok-col"},Lv={key:0,class:"column"},Nv=ue(()=>u("label",{for:"compositionSelect"},"Compositing Mode:",-1)),Wv=j("[?] "),Vv=ue(()=>u("option",{value:"source-over"},"source-over",-1)),zv=ue(()=>u("option",{value:"source-atop"},"source-atop",-1)),Uv=ue(()=>u("option",{value:"destination-over"},"destination-over",-1)),Gv=ue(()=>u("option",{value:"destination-in"},"destination-in",-1)),Xv=ue(()=>u("option",{value:"destination-in"},"destination-out",-1)),qv=ue(()=>u("option",{value:"destination-in"},"destination-atop",-1)),Yv=ue(()=>u("option",{value:"lighter"},"lighter",-1)),Kv=ue(()=>u("option",{value:"xor"},"xor",-1)),Jv=ue(()=>u("option",{value:"multiply"},"multiply",-1)),Zv=ue(()=>u("option",{value:"screen"},"screen",-1)),Qv=ue(()=>u("option",{value:"overlay"},"overlay",-1)),ew=ue(()=>u("option",{value:"darken"},"darken",-1)),tw=ue(()=>u("option",{value:"lighten"},"lighten",-1)),ow=ue(()=>u("option",{value:"color-dodge"},"color-dodge",-1)),nw=ue(()=>u("option",{value:"color-burn"},"color-burn",-1)),sw=ue(()=>u("option",{value:"hard-light"},"hard-light",-1)),iw=ue(()=>u("option",{value:"soft-light"},"soft-light",-1)),rw=ue(()=>u("option",{value:"difference"},"difference",-1)),aw=ue(()=>u("option",{value:"exclusion"},"exclusion",-1)),lw=ue(()=>u("option",{value:"hue"},"hue",-1)),dw=ue(()=>u("option",{value:"saturation"},"saturation",-1)),cw=ue(()=>u("option",{value:"color"},"color",-1)),uw=ue(()=>u("option",{value:"luminosity"},"luminosity",-1)),fw=[Vv,zv,Uv,Gv,Xv,qv,Yv,Kv,Jv,Zv,Qv,ew,tw,ow,nw,sw,iw,rw,aw,lw,dw,cw,uw],hw=ue(()=>u("label",{for:"addEffect"},"Add new effect",-1)),pw=["value"],gw=["disabled"],mw=["disabled"],bw=["disabled"],yw=["disabled"],vw=["onClick","onKeydown"],ww={key:0,class:"value-input-table"},Cw=ue(()=>u("td",null,[u("label",{for:"shadow_color"},"Color:")],-1)),$w=ue(()=>u("td",null,[u("label",{for:"filter_x"},"X:")],-1)),kw=ue(()=>u("td",null,[u("label",{for:"filter_y"},"Y:")],-1)),_w=ue(()=>u("td",null,[u("label",{for:"filter_blur"},"Blur:")],-1)),Sw=ue(()=>u("td",null,[u("label",{for:"filter_value"},"Value:")],-1)),xw=["value","max","min"],Pw=j("% "),jw={key:0},Iw={colspan:"2"},Tw=ue(()=>u("td",null,[u("label",{for:"filter_value"},"Value:")],-1)),Ow=["value","max","min"],Bw={key:0},Aw={colspan:"2"};function Ew(e,t,o,n,s,i){const r=M("color"),a=M("l"),l=M("d-flow"),d=M("slider"),c=M("d-fieldset");return e.showShadowColor?(m(),z(r,{key:0,modelValue:e.shadowColor,"onUpdate:modelValue":t[0]||(t[0]=f=>e.shadowColor=f),format:"rgb",onLeave:t[1]||(t[1]=f=>e.showShadowColor=!1)},null,8,["modelValue"])):(m(),z(l,{key:1,"no-wraping":"",class:"image-options-subpanel"},{default:E(()=>[Rv,u("div",Fv,[u("button",{onClick:t[2]||(t[2]=f=>e.$emit("leave"))},"Back")]),e.noComposition?X("",!0):(m(),C("div",Lv,[Nv,$(a,{to:"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation#Types"},{default:E(()=>[Wv]),_:1}),de(u("select",{id:"compositionSelect","onUpdate:modelValue":t[3]||(t[3]=f=>e.compositionMode=f),onKeydown:t[4]||(t[4]=q(()=>{},["stop"]))},fw,544),[[lt,e.compositionMode]])])),$(c,{class:"column",title:"Effects",style:{overflow:"hidden"}},{default:E(()=>[$(l,{class:"filter-flow","no-wraping":"",gap:"8px"},{default:E(()=>[$(l,{direction:"vertical","no-wraping":""},{default:E(()=>[hw,de(u("select",{id:"addEffect","onUpdate:modelValue":t[5]||(t[5]=f=>e.addEffectSelection=f),onKeydown:t[6]||(t[6]=q(()=>{},["stop"]))},[(m(!0),C(N,null,$e(e.filterTypes,f=>(m(),C("option",{key:f,value:f},he(e.getFilterLabel(f)),9,pw))),128))],544),[[lt,e.addEffectSelection]]),u("button",{disabled:e.addEffectSelection==="",onClick:t[7]||(t[7]=(...f)=>e.addFilter&&e.addFilter(...f)),onKeydown:t[8]||(t[8]=q(()=>{},["stop"]))}," Add ",40,gw),u("button",{disabled:!e.currentFilter,onClick:t[9]||(t[9]=(...f)=>e.removeFilter&&e.removeFilter(...f)),onKeydown:t[10]||(t[10]=q(()=>{},["stop"]))}," Remove ",40,mw),u("button",{disabled:e.currentFilterIdx===0,onClick:t[11]||(t[11]=f=>e.moveFilter(-1)),onKeydown:t[12]||(t[12]=q(()=>{},["stop"]))}," Move up ",40,bw),u("button",{disabled:e.currentFilterIdx===e.filters.length-1||e.filters.length===0,onClick:t[13]||(t[13]=f=>e.moveFilter(1)),onKeydown:t[14]||(t[14]=q(()=>{},["stop"]))}," Move down ",40,yw)]),_:1}),$(l,{maxSize:"100%",direction:"vertical","no-wraping":""},{default:E(()=>[(m(!0),C(N,null,$e(e.filters,(f,h)=>(m(),C("div",{key:h,class:le({choiceBtn:!0,active:h===e.currentFilterIdx}),tabindex:"0",onClick:b=>e.selectFilter(h),onKeydown:[Ke(b=>e.selectFilter(h),["enter"]),Ke(q(b=>e.selectFilter(h),["prevent"]),["space"])]},he(e.getFilterText(f)),43,vw))),128))]),_:1}),e.currentFilter?(m(),C("table",ww,[e.currentFilter.type==="drop-shadow"?(m(),C(N,{key:0},[u("tr",null,[Cw,u("td",null,[u("button",{id:"shadow_color",class:"color-button",style:Ae({background:e.shadowColor}),onClick:t[15]||(t[15]=f=>e.showShadowColor=!0)}," \xA0 ",4)])]),u("tr",null,[$w,u("td",null,[de(u("input",{id:"filter_x",type:"number","onUpdate:modelValue":t[16]||(t[16]=f=>e.shadowX=f),onKeydown:t[17]||(t[17]=q(()=>{},["stop"]))},null,544),[[je,e.shadowX,void 0,{number:!0}]])])]),u("tr",null,[kw,u("td",null,[de(u("input",{id:"filter_y",type:"number","onUpdate:modelValue":t[18]||(t[18]=f=>e.shadowY=f),onKeydown:t[19]||(t[19]=q(()=>{},["stop"]))},null,544),[[je,e.shadowY,void 0,{number:!0}]])])]),u("tr",null,[_w,u("td",null,[de(u("input",{id:"filter_blur",type:"number","onUpdate:modelValue":t[20]||(t[20]=f=>e.shadowBlur=f),onKeydown:t[21]||(t[21]=q(()=>{},["stop"]))},null,544),[[je,e.shadowBlur,void 0,{number:!0}]])])])],64)):e.isPercentFilter?(m(),C(N,{key:1},[u("tr",null,[Sw,u("td",null,[u("input",{id:"filter_value",value:(e.currentFilter.value*100).toFixed(),type:"number",max:e.maxValue,min:e.minValue,onInput:t[22]||(t[22]=f=>e.setValue({value:Number(f.target.value/100)})),onKeydown:t[23]||(t[23]=q(()=>{},["stop"]))},null,40,xw),Pw])]),e.minValue===0&&e.maxValue!==void 0?(m(),C("tr",jw,[u("td",Iw,[$(d,{gradientStops:["#000000","#ffffff"],label:"",maxValue:e.maxValue,modelValue:e.currentFilter.value*100,"no-input":"","onUpdate:modelValue":t[24]||(t[24]=f=>e.setValue({value:Math.round(f)/100}))},null,8,["maxValue","modelValue"])])])):X("",!0)],64)):(m(),C(N,{key:2},[u("tr",null,[Tw,u("td",null,[u("input",{id:"filter_value",value:e.currentFilter.value,type:"number",max:e.maxValue,min:e.minValue,onInput:t[25]||(t[25]=f=>e.setValue({value:Number(f.target.value)})),onKeydown:t[26]||(t[26]=q(()=>{},["stop"]))},null,40,Ow)])]),e.minValue===0&&e.maxValue!==void 0?(m(),C("tr",Bw,[u("td",Aw,[$(d,{gradientStops:e.hueStops,label:"",maxValue:e.maxValue,modelValue:e.currentFilter.value,"no-input":"","onUpdate:modelValue":t[27]||(t[27]=f=>e.setValue({value:Math.round(f)}))},null,8,["gradientStops","maxValue","modelValue"]),$(d,{gradientStops:e.hueStops,label:"",maxValue:e.maxValue,modelValue:e.currentFilter.value,"shift-gradient":"","no-input":"",disabled:""},null,8,["gradientStops","maxValue","modelValue"])])])):X("",!0)],64))])):X("",!0)]),_:1})]),_:1})]),_:1}))}const ha=se(Mv,[["render",Ew],["__scopeId","data-v-4df302c6"]]),Dw=ne({inheritAttrs:!1,components:{Color:Ks},props:{modelValue:{type:String,required:!0},title:{type:String,default:""}},data:()=>({colorSelector:"",selectedFont:"",selectedColor:"#000000",rememberedStart:0,rememberedEnd:0,error:""}),computed:{vertical(){return this.$store.state.ui.vertical}},watch:{selectedFont(){this.selectedFont!==""&&(this.insertCommand("font",this.selectedFont),this.selectedFont="")}},methods:{onValueChanged(){const e=Y(),t=this.$refs.textArea.value;try{new yt(t,e.TextBox.NameboxTextStyle),this.error=""}catch(o){this.error=o.message}this.$emit("update:modelValue",t)},selectColor(e){const t=this.$refs.textArea;this.colorSelector=e,this.rememberedStart=t.selectionStart,this.rememberedEnd=t.selectionEnd},applyColor(){const e=this.selectedColor,t=this.colorSelector,o=()=>{const n=this.$refs.textArea;if(!n){this.$nextTick(o);return}n.selectionStart=this.rememberedStart,n.selectionEnd=this.rememberedEnd,this.insertCommand(t==="text"?"color":"outlinecolor",e)};this.$nextTick(o),this.selectedColor="#000000",this.colorSelector=""},insertText(e){const t=this.$refs.textArea,o=t.value,n=t.selectionStart,s=t.selectionEnd;t.value=o.slice(0,n)+e+o.slice(s),t.selectionStart=t.selectionEnd=n+e.length,t.focus(),this.onValueChanged()},insertCommand(e,t){const o=this.$refs.textArea,n=o.value,s=o.selectionStart,i=o.selectionEnd,r=n.slice(s,i),a=n.slice(0,s),l=n.slice(i);let d=e;t&&(d+="="+t),o.value=`${a}{${d}}${r}{/${e}}${l}`,o.selectionStart=s+d.length+2,o.selectionEnd=o.selectionStart+r.length,o.focus(),this.onValueChanged()}}});const Hw=e=>(He("data-v-61424637"),e=e(),Me(),e),Mw={class:"column ok-col"},Rw={class:"column"},Fw=["value"],Lw={key:0,class:"column error-col"},Nw={class:"column"},Ww=Hw(()=>u("p",{class:"hint-col"},"Apply style to selected text:",-1)),Vw={class:"column"},zw={class:"column"},Uw={class:"column"},Gw=Qf('<option value data-v-61424637>Font</option><option value="aller" style="font-family:aller;" data-v-61424637> Aller (Textbox) </option><option value="riffic" style="font-family:riffic;" data-v-61424637> Riffic (Bold text) </option><option value="hashtag" style="font-family:hashtag;" data-v-61424637> Hashtag (Sayori) </option><option value="ammy_handwriting" style="font-family:ammy_handwriting;" data-v-61424637> Ammy&#39;s Handwriting (Natsuki) </option><option value="journal" style="font-family:journal;" data-v-61424637> Journal (Monika) </option><option value="jp_hand_slanted" style="font-family:jp_hand_slanted;" data-v-61424637> JP Hand Slanted (Yuri) </option><option value="damagrafik_script" style="font-family:damagrafik_script;" data-v-61424637> Damagrafik (Yuri, Act 2) </option><option value="as_i_lay_dying" style="font-family:as_i_lay_dying;" data-v-61424637> As I Lay Dying (Yuri, Act Unused) </option><option value="halogen" style="font-family:halogen;" data-v-61424637> Halogen (MC) </option>',10),Xw=[Gw];function qw(e,t,o,n,s,i){const r=M("color");return e.colorSelector?(m(),z(r,{key:0,modelValue:e.selectedColor,"onUpdate:modelValue":t[0]||(t[0]=a=>e.selectedColor=a),onLeave:e.applyColor},null,8,["modelValue","onLeave"])):(m(),C("div",{key:1,class:le({"text-subpanel":!0,vertical:e.vertical})},[u("h2",null,he(e.title),1),u("div",Mw,[u("button",{onClick:t[1]||(t[1]=a=>e.$emit("leave"))},"OK")]),u("div",Rw,[u("textarea",{ref:"textArea",value:e.modelValue,onInput:t[2]||(t[2]=(...a)=>e.onValueChanged&&e.onValueChanged(...a)),onKeydown:t[3]||(t[3]=q(()=>{},["stop"])),onKeypress:t[4]||(t[4]=q(()=>{},["stop"]))},null,40,Fw)]),e.error?(m(),C("div",Lw,he(e.error),1)):X("",!0),u("div",Nw,[u("button",{onClick:t[5]||(t[5]=a=>e.insertText("\\\\")),class:"style-button"},"Insert \\"),u("button",{onClick:t[6]||(t[6]=a=>e.insertText("\\{")),class:"style-button"},"Insert {"),u("button",{onClick:t[7]||(t[7]=a=>e.insertText("\\}")),class:"style-button"},"Insert }")]),Ww,u("div",Vw,[u("button",{onClick:t[8]||(t[8]=a=>e.insertCommand("b")),class:"style-button",style:{"font-weight":"bold"}}," Bold "),u("button",{onClick:t[9]||(t[9]=a=>e.insertCommand("i")),class:"style-button",style:{"font-style":"italic"}}," Italics "),u("button",{onClick:t[10]||(t[10]=a=>e.insertCommand("plain")),class:"style-button"}," Plain "),u("button",{onClick:t[11]||(t[11]=a=>e.insertCommand("edited")),class:"style-button edited-style"}," Edited "),u("button",{onClick:t[12]||(t[12]=a=>e.insertCommand("k",2)),class:"style-button",style:{"letter-spacing":"5px"}}," Kerning ")]),u("div",zw,[u("button",{onClick:t[13]||(t[13]=a=>e.insertCommand("alpha",.5)),class:"style-button"}," Alpha ")]),u("div",Uw,[u("button",{onClick:t[14]||(t[14]=a=>e.insertCommand("size",12)),class:"style-button",style:{"font-size":"20px"}}," Font size "),de(u("select",{"onUpdate:modelValue":t[15]||(t[15]=a=>e.selectedFont=a),class:"style-button"},Xw,512),[[lt,e.selectedFont]]),u("button",{onClick:t[16]||(t[16]=a=>e.selectColor("text")),class:"style-button"}," Text color "),u("button",{onClick:t[17]||(t[17]=a=>e.selectColor("outline")),class:"style-button"}," Outline color ")])],2))}const Yw=se(Dw,[["render",qw],["__scopeId","data-v-61424637"]]),bi=Nn(),Kw=ne({mixins:[tt],components:{Toggle:wt,PositionAndSize:tv,Layers:fv,Delete:gv,TextEditor:Yw,ImageOptions:ha,Color:Ks,ModalDialog:zr,DFieldset:Ct},props:{object:{type:Object,required:!0},title:String,textHandler:{type:Object},colorHandler:{type:Object},showAltPanel:Boolean},data:()=>({imageOptionsOpen:!1,canEdit:!0,modalNameInput:"",showRename:!1,localColorHandler:null}),computed:{flip:bi("flip","panels/setFlip"),rotation:bi("rotation","panels/setRotation"),enlargeWhenTalking:bi("enlargeWhenTalking","panels/setEnlargeWhenTalking"),currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},nameboxWidth:{get(){const e=this.object.nameboxWidth;return e===null?"":e+""},set(e){const t=e.trim()===""?null:parseInt(e);this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setObjectNameboxWidth",{id:this.object.id,panelId:this.object.panelId,nameboxWidth:t})})}},zoom:{get(){return this.object.zoom*100},set(e){this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setObjectZoom",{id:this.object.id,panelId:this.object.panelId,zoom:e/100})})}},defaultNameboxWidth(){return Y().TextBox.NameboxWidth},finalColorHandler(){return this.localColorHandler||this.colorHandler||null},hasLabel(){return this.object.label!==null},heading(){var e,t;return(t=(e=this.object.label)!=null?e:this.title)!=null?t:"Object"},useCustomTextboxColor:{get(){return this.object.textboxColor!==null},set(e){this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setTextboxColor",{panelId:this.object.panelId,id:this.object.id,textboxColor:e?Y().TextBoxCustom.textboxDefaultColor:null})})}}},methods:{copy(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/copyObjectToClipboard",{panelId:this.object.panelId,id:this.object.id})})},enableNameEdit(){var e;this.modalNameInput=(e=this.object.label)!=null?e:"",this.showRename=!0},renameOption(e){this.showRename=!1,e==="Apply"&&this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setLabel",{panelId:this.object.panelId,id:this.object.id,label:this.modalNameInput})})},selectTextboxColor(){this.localColorHandler={title:"Textbox color",get:()=>this.object.textboxColor,set:e=>{this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setTextboxColor",{panelId:this.object.panelId,id:this.object.id,textboxColor:e})})},leave:()=>{this.localColorHandler=null}}}}});const Qo=e=>(He("data-v-96a1ac72"),e=e(),Me(),e),Jw={class:"panel"},Zw=Qo(()=>u("span",{class:"icon material-icons"},"edit",-1)),Qw=Qo(()=>u("p",{class:"modal-text"},"Enter the new name",-1)),e0={class:"modal-text"},t0={class:"input-table"},o0=Qo(()=>u("td",null,[u("label",{for:"rotation"},"Rotation: \xB0")],-1)),n0={key:0},s0=Qo(()=>u("td",null,[u("label",{for:"zoom"},"Zoom: ")],-1)),i0={key:0},r0=Qo(()=>u("td",null,[u("label",{for:"textbox_color"},"Color:")],-1)),a0=Qo(()=>u("td",null,[u("label",{for:"namebox_width"},"Namebox width:")],-1)),l0=["placeholder"];function d0(e,t,o,n,s,i){const r=M("modal-dialog"),a=M("text-editor"),l=M("color"),d=M("image-options"),c=M("position-and-size"),f=M("layers"),h=M("toggle"),b=M("d-fieldset"),y=M("delete");return m(),C("div",Jw,[u("h1",{style:Ae({fontStyle:e.hasLabel?"italic":"normal"}),onClick:t[0]||(t[0]=(...k)=>e.enableNameEdit&&e.enableNameEdit(...k))},[j(he(e.heading)+" ",1),Zw],4),(m(),z(vd,{to:"#modal-messages"},[e.showRename?(m(),z(r,{key:0,options:["Apply","Cancel"],"no-base-size":"",class:"modal-rename",onOption:e.renameOption,onLeave:t[3]||(t[3]=k=>e.renameOption("Cancel"))},{default:E(()=>[Qw,u("p",e0,[de(u("input",{"onUpdate:modelValue":t[1]||(t[1]=k=>e.modalNameInput=k),style:{width:"100%"},onKeydown:t[2]||(t[2]=Ke(q(k=>e.renameOption("Apply"),["prevent","stop"]),["enter"]))},null,544),[[je,e.modalNameInput]])])]),_:1},8,["onOption"])):X("",!0)])),e.textHandler?(m(),z(a,{key:0,title:e.textHandler.title,modelValue:e.textHandler.get(),"onUpdate:modelValue":t[4]||(t[4]=k=>e.textHandler.set(k)),onLeave:t[5]||(t[5]=k=>e.textHandler.leave())},null,8,["title","modelValue"])):e.finalColorHandler?(m(),z(l,{key:1,title:e.finalColorHandler.title,modelValue:e.finalColorHandler.get(),"onUpdate:modelValue":t[6]||(t[6]=k=>e.finalColorHandler.set(k)),onLeave:t[7]||(t[7]=k=>e.finalColorHandler.leave())},null,8,["title","modelValue"])):e.imageOptionsOpen?(m(),z(d,{key:2,type:"object","panel-id":e.object.panelId,id:e.object.id,onLeave:t[8]||(t[8]=k=>e.imageOptionsOpen=!1)},null,8,["panel-id","id"])):e.showAltPanel?Bt(e.$slots,"alt-panel",{key:3},void 0,!0):(m(),C(N,{key:4},[Bt(e.$slots,"default",{},void 0,!0),$(c,{obj:e.object},null,8,["obj"]),$(f,{object:e.object},null,8,["object"]),$(h,{modelValue:e.flip,"onUpdate:modelValue":t[9]||(t[9]=k=>e.flip=k),label:"Flip?"},null,8,["modelValue"]),u("table",t0,[u("tr",null,[o0,u("td",null,[de(u("input",{id:"rotation",class:"smol",type:"number","onUpdate:modelValue":t[10]||(t[10]=k=>e.rotation=k),onKeydown:t[11]||(t[11]=q(()=>{},["stop"]))},null,544),[[je,e.rotation]])])]),e.object.type==="character"||e.object.type==="sprite"?(m(),C("tr",n0,[s0,u("td",null,[de(u("input",{id:"zoom",type:"number",class:"smol",step:"1",min:"0","onUpdate:modelValue":t[12]||(t[12]=k=>e.zoom=k),onKeydown:t[13]||(t[13]=q(()=>{},["stop"]))},null,544),[[je,e.zoom]])])])):X("",!0)]),Bt(e.$slots,"options",{},void 0,!0),e.hasLabel?(m(),z(b,{key:0,title:"Textbox settings"},{default:E(()=>[e.object.type==="character"||e.object.type==="sprite"?(m(),z(h,{key:0,label:"Enlarge when talking",modelValue:e.enlargeWhenTalking,"onUpdate:modelValue":t[14]||(t[14]=k=>e.enlargeWhenTalking=k)},null,8,["modelValue"])):X("",!0),$(h,{label:"Use custom textbox color",modelValue:e.useCustomTextboxColor,"onUpdate:modelValue":t[15]||(t[15]=k=>e.useCustomTextboxColor=k)},null,8,["modelValue"]),u("table",null,[e.useCustomTextboxColor?(m(),C("tr",i0,[r0,u("td",null,[u("button",{id:"textbox_color",class:"color-button",style:Ae({background:e.object.textboxColor}),onClick:t[16]||(t[16]=(...k)=>e.selectTextboxColor&&e.selectTextboxColor(...k))},null,4)])])):X("",!0),u("tr",null,[a0,u("td",null,[de(u("input",{id:"namebox_width",type:"number",placeholder:e.defaultNameboxWidth,"onUpdate:modelValue":t[17]||(t[17]=k=>e.nameboxWidth=k)},null,8,l0),[[je,e.nameboxWidth,void 0,{lazy:!0}]])])])])]),_:1})):X("",!0),u("button",{onClick:t[18]||(t[18]=k=>e.imageOptionsOpen=!0)},"Image options"),u("button",{onClick:t[19]||(t[19]=(...k)=>e.copy&&e.copy(...k))},"Copy"),$(y,{obj:e.object},null,8,["obj"])],64))])}const en=se(Kw,[["render",d0],["__scopeId","data-v-96a1ac72"]]),$l=Nn(),c0=ne({mixins:[tt],components:{Toggle:wt,Parts:jy,DFieldset:Ct,ObjectTool:en},data:()=>({panelForParts:null}),computed:{flip:$l("flip","panels/setFlip"),closeUp:$l("close","panels/setClose"),selection(){return this.$store.state.ui.selection},currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.selection];if(e.type==="character")return e},charData(){return zs(this.$store,this.object)},label(){var e;return(e=this.charData.label)!=null?e:""},parts(){return oy(this.charData,this.object)},hasMultipleStyles(){return this.charData.styleGroups[this.object.styleGroupId].styles.length>1||this.charData.styleGroups.length>1},hasMultiplePoses(){return this.charData.styleGroups[this.object.styleGroupId].styles[this.object.styleId].poses.length>1}},methods:{seekPose(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekPose",{id:this.object.id,panelId:this.object.panelId,delta:e})})},seekStyle(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekStyle",{id:this.object.id,panelId:this.object.panelId,delta:e})})},seekPart(e,t){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekPart",{id:this.object.id,panelId:this.object.panelId,delta:t,part:e})})},captialize(e){return e.charAt(0).toUpperCase()+e.substring(1)}},watch:{selection(){this.panelForParts=null}}});const u0={key:0},f0={class:"arrow-col"},h0={class:"arrow-col"},p0={key:1},g0={class:"arrow-col"},m0={class:"arrow-col"},b0={class:"arrow-col"},y0=["onClick"],v0=["onClick"],w0={class:"arrow-col"},C0=["onClick"];function $0(e,t,o,n,s,i){const r=M("parts"),a=M("d-fieldset"),l=M("toggle"),d=M("object-tool");return m(),z(d,{object:e.object,title:e.label,showAltPanel:!!e.panelForParts},{"alt-panel":E(()=>[e.panelForParts?(m(),z(r,{key:0,character:e.object,part:e.panelForParts,onLeave:t[0]||(t[0]=c=>e.panelForParts=null),onShowDialog:t[1]||(t[1]=c=>e.$emit("show-dialog",c)),onShowExpressionDialog:t[2]||(t[2]=c=>e.$emit("show-expression-dialog",c))},null,8,["character","part"])):X("",!0)]),default:E(()=>[e.hasMultiplePoses||e.parts.length>0||e.hasMultipleStyles?(m(),z(a,{key:0,class:"pose-list",title:"Pose:"},{default:E(()=>[u("table",null,[u("tbody",null,[e.hasMultipleStyles?(m(),C("tr",u0,[u("td",f0,[u("button",{onClick:t[3]||(t[3]=c=>e.seekStyle(-1))},"<")]),u("td",null,[u("button",{class:"middle-button",onClick:t[4]||(t[4]=c=>e.panelForParts="style")}," Style ")]),u("td",h0,[u("button",{onClick:t[5]||(t[5]=c=>e.seekStyle(1))},">")])])):X("",!0),e.hasMultiplePoses?(m(),C("tr",p0,[u("td",g0,[u("button",{onClick:t[6]||(t[6]=c=>e.seekPose(-1))},"<")]),u("td",null,[u("button",{class:"middle-button",onClick:t[7]||(t[7]=c=>e.panelForParts="pose")}," Pose ")]),u("td",m0,[u("button",{onClick:t[8]||(t[8]=c=>e.seekPose(1))},">")])])):X("",!0),(m(!0),C(N,null,$e(e.parts,c=>(m(),C("tr",{key:c},[u("td",b0,[u("button",{onClick:f=>e.seekPart(c,-1)},"<",8,y0)]),u("td",null,[u("button",{class:"middle-button",onClick:f=>e.panelForParts=c},he(e.captialize(c)),9,v0)]),u("td",w0,[u("button",{onClick:f=>e.seekPart(c,1)},">",8,C0)])]))),128))])])]),_:1})):X("",!0)]),options:E(()=>[$(l,{modelValue:e.closeUp,"onUpdate:modelValue":t[9]||(t[9]=c=>e.closeUp=c),label:"Close up?"},null,8,["modelValue"])]),_:1},8,["object","title","showAltPanel"])}const k0=se(c0,[["render",$0],["__scopeId","data-v-599c8729"]]),_0=ne({mixins:[tt],components:{ObjectTool:en},computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="sprite")return e}}});function S0(e,t,o,n,s,i){const r=M("object-tool");return m(),z(r,{object:e.object,title:"Custom Sprite"},null,8,["object"])}const x0=se(_0,[["render",S0]]);function kl(e,t,o){return e>t?e:t>o?o:t}const _l=4,P0={setTalkingObject(e,t){const o=e.panels[t.panelId].objects[t.id];o.talkingObjId=t.talkingObjId,++o.version},setTalkingOther(e,t){const o=e.panels[t.panelId].objects[t.id];o.talkingOther=t.talkingOther,o.talkingObjId="$other$",++o.version},setResetBounds(e,t){const o=e.panels[t.panelId].objects[t.id];o.resetBounds=t.resetBounds,o.x=t.resetBounds.x,o.y=t.resetBounds.y,o.height=t.resetBounds.height,o.width=t.resetBounds.width,o.rotation=t.resetBounds.rotation,++o.version},setTextBoxProperty(e,t){const o=e.panels[t.panelId].objects[t.id];o[t.key]=t.value,++o.version}},j0={createTextBox({commit:e,state:t,rootState:o},n){var d;const s=Y(),i=t.panels[n.panelId].lastObjId+1,r=s.TextBox.DefaultTextboxStyle,a=$n[r],l=n.resetBounds||{x:a.defaultX,y:a.defaultY,width:a.defaultWidth,height:a.defaultHeight,rotation:0};return e("create",{object:{...Zo(),...l,panelId:o.panels.currentPanel,id:i,onTop:!0,type:"textBox",preserveRatio:!1,ratio:s.TextBox.TextBoxWidth/s.TextBox.TextBoxHeight,continue:!0,controls:!0,skip:!0,autoQuoting:!0,autoWrap:!0,style:r,overrideColor:!1,customColor:s.TextBoxCustom.textboxDefaultColor,deriveCustomColors:!0,customControlsColor:s.TextBoxCustom.controlsDefaultColor,customNameboxColor:s.TextBoxCustom.nameboxDefaultColor,customNameboxWidth:null,customNameboxStroke:s.TextBoxCustom.nameboxStrokeDefaultColor,talkingObjId:null,talkingOther:"",text:(d=n.text)!=null?d:"Click here to edit the textbox",resetBounds:l}}),i},setStyle({state:e,commit:t},o){const n=Y(),s=e.panels[o.panelId].objects[o.id],i=$n[s.style],r=$n[o.style],a=10;let l=!1;const d={panelId:o.panelId,id:o.id,x:s.x,y:s.y};let c=!1;const f={panelId:o.panelId,id:o.id,width:s.width,height:s.height};r.resizable?(i.defaultWidth!==r.defaultWidth&&(c=!0,f.width=Math.max(f.width+r.defaultWidth-i.defaultWidth,a)),i.defaultHeight!==r.defaultHeight&&(c=!0,f.height=Math.max(f.height+r.defaultHeight-i.defaultHeight,a))):(c=!0,f.width=r.defaultWidth,f.height=r.defaultHeight),i.defaultX!==r.defaultX&&(l=!0,d.x=kl(-f.width+a,d.x+r.defaultX-i.defaultX,n.Base.screenWidth-a)),i.defaultY!==r.defaultY&&(l=!0,d.y=kl(-f.height+a,d.y+r.defaultY-i.defaultY,n.Base.screenHeight-a)),l&&t("setPosition",d),c&&t("setSize",f),t("setTextBoxProperty",as(o.panelId,o.id,"style",o.style))},resetTextboxBounds({commit:e,state:t},o){const n=t.panels[o.panelId].objects[o.id];e("setPosition",{panelId:o.panelId,id:o.id,x:n.resetBounds.x,y:n.resetBounds.y}),e("setSize",{panelId:o.panelId,id:o.id,height:n.resetBounds.height,width:n.resetBounds.width}),e("setRotation",{panelId:o.panelId,id:o.id,rotation:n.resetBounds.rotation})},async splitTextbox({commit:e,state:t,dispatch:o},n){const s=t.panels[n.panelId].objects[n.id];if(s.type!=="textBox")return;const i=(s.width-_l)/2,r=i/2+_l/2,a=[s.x,s.y];let l=[s.x-r,s.y],d=[s.x+r,s.y];s.rotation!==0&&(l=_s(l[0],l[1],a[0],a[1],s.rotation/180*Math.PI),d=_s(d[0],d[1],a[0],a[1],s.rotation/180*Math.PI)),e("setResetBounds",{id:n.id,resetBounds:{x:l[0],y:l[1],width:i,height:s.height,rotation:s.rotation}});const c=s.style==="custom_plus"?"custom_plus":"custom";s.style!==c&&e("setStyle",as(n.panelId,n.id,"style",c));const f=await o("createTextBox",{resetBounds:{x:d[0],y:d[1],width:i,height:s.height,rotation:s.rotation}});e("setStyle",as(n.panelId,f,"style",c)),s.flip&&e("setFlip",{id:f,flip:s.flip})}};function as(e,t,o,n){return{id:t,panelId:e,key:o,value:n}}const Sl=Nn(),_t=ua("panels/setTextBoxProperty"),I0=ne({components:{Toggle:wt,DFieldset:Ct,ObjectTool:en,DFlow:Ln},mixins:[tt],data:()=>({textEditor:"",colorSelect:""}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},customizable(){return this.textBoxStyle.startsWith("custom")},nameboxWidthDefault(){return Y().TextBox.NameboxWidth},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="textBox")return e},textHandler(){if(!!this.textEditor)return{title:this.textEditorName,get:()=>this.textEditor==="name"?this.object.talkingOther:this.textEditor==="body"?this.dialog:"",set:e=>{this.textEditor==="name"?this.talkingOther=e:this.textEditor==="body"&&(this.dialog=e)},leave:()=>{this.textEditor=""}}},colorHandler(){if(!!this.colorSelect)return{title:this.colorName,get:()=>{switch(this.colorSelect){case"":return"#000000";case"base":return this.object.customColor;case"controls":return this.object.customControlsColor;case"namebox":return this.object.customNameboxColor;case"nameboxStroke":return this.object.customNameboxStroke;default:throw new bt.UnreachableCaseError(this.colorSelect)}},set:e=>{this.vuexHistory.transaction(()=>{const t=this.currentPanel.id,o=this.object.id;let n={base:"customColor",controls:"customControlsColor",namebox:"customNameboxColor",nameboxStroke:"customNameboxStroke","":void 0}[this.colorSelect];e!==void 0&&this.$store.commit("panels/setTextBoxProperty",as(t,o,"customNameboxStroke",n))})},leave:()=>{this.colorSelect=""}}},talkingObjId:{get(){var e;return(e=this.object.talkingObjId)!=null?e:"$null$"},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setTalkingObject",{id:this.object.id,panelId:this.object.panelId,talkingObjId:e==="$null$"?null:e})})}},talkingOther:Sl("talkingOther","panels/setTalkingOther"),textBoxStyle:Sl("style","panels/setStyle",!0),showControls:_t("controls"),allowSkipping:_t("skip"),autoQuoting:_t("autoQuoting"),autoWrap:_t("autoWrap"),showContinueArrow:_t("continue"),dialog:_t("text"),overrideColor:_t("overrideColor"),deriveCustomColors:_t("deriveCustomColors"),customNameboxWidth:_t("customNameboxWidth"),nameList(){const e=this.currentPanel,t=[];for(const o of[...e.order,...e.onTopOrder]){const n=e.objects[o];n.label!==null&&t.push([o,n.label])}return t},textEditorName(){return this.textEditor==="name"?"Name":this.textEditor==="body"?"Dialog":""},customControlsColor(){return this.object.customControlsColor},colorName(){switch(this.colorSelect){case"":return"";case"base":return"Base color";case"controls":return"Controls color";case"namebox":return"Namebox color";case"nameboxStroke":return"Namebox text stroke";default:throw new bt.UnreachableCaseError(this.colorSelect)}}},methods:{splitTextbox(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/splitTextbox",{id:this.object.id,panelId:this.object.panelId})})},resetPosition(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/resetTextboxBounds",{id:this.object.id,panelId:this.object.panelId})})},jumpToCharacter(){this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",this.talkingObjId)})}}});const Re=e=>(He("data-v-95864fe4"),e=e(),Me(),e),T0={class:"upper-combos"},O0=Re(()=>u("td",null,[u("label",{for:"text_style"},"Style:")],-1)),B0={colspan:"2"},A0=Re(()=>u("option",{value:"normal"},"Normal",-1)),E0=Re(()=>u("option",{value:"corrupt"},"Corrupt",-1)),D0=Re(()=>u("option",{value:"custom"},"Custom",-1)),H0=Re(()=>u("option",{value:"custom_plus"},"Custom (Plus)",-1)),M0=Re(()=>u("option",{value:"none"},"None",-1)),R0=[A0,E0,D0,H0,M0],F0=Re(()=>u("td",null,[u("label",{for:"current_talking"},"Person talking:")],-1)),L0=Re(()=>u("option",{value:"$null$"},"No-one",-1)),N0=["value"],W0=Re(()=>u("option",{value:"$other$"},"Other",-1)),V0=["disabled"],z0=Re(()=>u("td",null,[u("label",{for:"custom_name"},"Other name:")],-1)),U0={id:"dialog_text_wrapper"},G0=Re(()=>u("label",{for:"dialog_text"},"Dialog:",-1)),X0={key:0},q0=Re(()=>u("td",null,[u("label",{for:"custom_namebox_width"},"Namebox width:")],-1)),Y0=["placeholder","disabled"],K0={colspan:"2"},J0={key:0},Z0=Re(()=>u("td",null,[u("label",{for:"textbox_color"},"Color:")],-1)),Q0={key:1},eC={colspan:"2"},tC=Re(()=>u("td",null,[u("label",{for:"custom_controls_color"},"Controls Color:")],-1)),oC=Re(()=>u("td",null,[u("label",{for:"custom_namebox_color"},"Namebox Color:")],-1)),nC=Re(()=>u("td",null,[u("label",{for:"custom_namebox_stroke"},"Namebox text stroke:")],-1));function sC(e,t,o,n,s,i){const r=M("toggle"),a=M("d-flow"),l=M("d-fieldset"),d=M("object-tool");return m(),z(d,{object:e.object,title:"Textbox",textHandler:e.textHandler,colorHandler:e.colorHandler},{default:E(()=>[u("table",T0,[u("tr",null,[O0,u("td",B0,[de(u("select",{id:"text_style","onUpdate:modelValue":t[0]||(t[0]=c=>e.textBoxStyle=c),onKeydown:t[1]||(t[1]=q(()=>{},["stop"]))},R0,544),[[lt,e.textBoxStyle]])])]),u("tr",null,[F0,u("td",null,[de(u("select",{id:"current_talking","onUpdate:modelValue":t[2]||(t[2]=c=>e.talkingObjId=c),onKeydown:t[3]||(t[3]=q(()=>{},["stop"]))},[L0,(m(!0),C(N,null,$e(e.nameList,([c,f])=>(m(),C("option",{key:c,value:c},he(f),9,N0))),128)),W0],544),[[lt,e.talkingObjId]])]),u("td",null,[u("button",{title:"Jump to talking character",onClick:t[4]||(t[4]=(...c)=>e.jumpToCharacter&&e.jumpToCharacter(...c)),disabled:e.talkingObjId==="$null$"||e.talkingObjId==="$other$"}," > ",8,V0)])]),u("tr",null,[z0,u("td",null,[de(u("input",{id:"custom_name","onUpdate:modelValue":t[5]||(t[5]=c=>e.talkingOther=c),onKeydown:t[6]||(t[6]=q(()=>{},["stop"]))},null,544),[[je,e.talkingOther]])]),u("td",null,[u("button",{onClick:t[7]||(t[7]=c=>e.textEditor="name")},"...")])])]),$(r,{label:"Auto quoting?",modelValue:e.autoQuoting,"onUpdate:modelValue":t[8]||(t[8]=c=>e.autoQuoting=c)},null,8,["modelValue"]),$(r,{label:"Auto line wrap?",modelValue:e.autoWrap,"onUpdate:modelValue":t[9]||(t[9]=c=>e.autoWrap=c)},null,8,["modelValue"]),u("div",U0,[G0,de(u("textarea",{"onUpdate:modelValue":t[10]||(t[10]=c=>e.dialog=c),id:"dialog_text",onKeydown:t[11]||(t[11]=q(()=>{},["stop"]))},null,544),[[je,e.dialog]]),u("button",{onClick:t[12]||(t[12]=c=>e.textEditor="body")},"Formatting")])]),options:E(()=>[$(l,{title:"Customization:",class:le(e.customizable?"customization-set":"")},{default:E(()=>[$(a,{direction:"vertical",maxSize:"100%","no-wraping":""},{default:E(()=>[$(r,{label:"Controls visible?",modelValue:e.showControls,"onUpdate:modelValue":t[13]||(t[13]=c=>e.showControls=c)},null,8,["modelValue"]),$(r,{label:"Able to skip?",modelValue:e.allowSkipping,"onUpdate:modelValue":t[14]||(t[14]=c=>e.allowSkipping=c)},null,8,["modelValue"]),$(r,{label:"Continue arrow?",modelValue:e.showContinueArrow,"onUpdate:modelValue":t[15]||(t[15]=c=>e.showContinueArrow=c)},null,8,["modelValue"]),e.customizable?(m(),C("table",X0,[u("tr",null,[q0,u("td",null,[de(u("input",{id:"custom_namebox_width",type:"number",style:{width:"48px"},placeholder:e.nameboxWidthDefault,"onUpdate:modelValue":t[16]||(t[16]=c=>e.customNameboxWidth=c),disabled:e.overrideColor,onKeydown:t[17]||(t[17]=q(()=>{},["stop"]))},null,40,Y0),[[je,e.customNameboxWidth,void 0,{number:!0}]])])]),u("tr",null,[u("td",K0,[$(r,{modelValue:e.overrideColor,"onUpdate:modelValue":t[18]||(t[18]=c=>e.overrideColor=c),label:"Override color"},null,8,["modelValue"])])]),e.overrideColor?(m(),C("tr",J0,[Z0,u("td",null,[u("button",{id:"textbox_color",class:"color-button",style:Ae({background:e.object.customColor}),onClick:t[19]||(t[19]=c=>e.colorSelect="base")},null,4)])])):X("",!0),e.overrideColor?(m(),C("tr",Q0,[u("td",eC,[$(r,{id:"derive_custom_colors",modelValue:e.deriveCustomColors,"onUpdate:modelValue":t[20]||(t[20]=c=>e.deriveCustomColors=c),label:"Derive other colors"},null,8,["modelValue"])])])):X("",!0),e.overrideColor&&!e.deriveCustomColors?(m(),C(N,{key:2},[u("tr",null,[tC,u("td",null,[u("button",{id:"custom_controls_color",class:"color-button",style:Ae({background:e.object.customControlsColor}),onClick:t[21]||(t[21]=c=>e.colorSelect="controls")},null,4)])]),u("tr",null,[oC,u("td",null,[u("button",{id:"custom_namebox_color",class:"color-button",style:Ae({background:e.object.customNameboxColor}),onClick:t[22]||(t[22]=c=>e.colorSelect="namebox")},null,4)])]),u("tr",null,[nC,u("td",null,[u("button",{id:"custom_namebox_stroke",class:"color-button",style:Ae({background:e.object.customNameboxStroke}),onClick:t[23]||(t[23]=c=>e.colorSelect="nameboxStroke")},null,4)])])],64)):X("",!0)])):X("",!0)]),_:1})]),_:1},8,["class"]),u("button",{onClick:t[24]||(t[24]=(...c)=>e.resetPosition&&e.resetPosition(...c))},"Reset position"),u("button",{onClick:t[25]||(t[25]=(...c)=>e.splitTextbox&&e.splitTextbox(...c))},"Split textbox")]),_:1},8,["object","textHandler","colorHandler"])}const iC=se(I0,[["render",sC],["__scopeId","data-v-95864fe4"]]),rC=Nn(),aC=ne({mixins:[tt],components:{Toggle:wt,DFieldset:Ct,DFlow:Ln,ObjectTool:en},data:()=>({currentIdx:0,textEditor:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="choice")return e},autoWrap:rC("autoWrap","panels/setAutoWrapping"),buttonText:lC("text"),buttons(){return this.object.choices},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.buttonText,set:e=>{this.buttonText=e},leave:()=>{this.textEditor=!1}}}},methods:{select(e){this.currentIdx=e},addChoice(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/addChoice",{id:this.object.id,panelId:this.object.panelId,text:""})})},removeChoice(){this.vuexHistory.transaction(()=>{this.currentIdx===this.object.choices.length-1&&this.currentIdx>0&&this.select(this.currentIdx-1),this.$store.dispatch("panels/removeChoice",{id:this.object.id,panelId:this.object.panelId,choiceIdx:this.currentIdx})})}}});function lC(e){return{get(){return this.object.choices[this.currentIdx][e]},set(t){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setChoiceProperty",{id:this.object.id,panelId:this.object.panelId,choiceIdx:this.currentIdx,key:e,value:t})})}}}const dC=e=>(He("data-v-60e50bc5"),e=e(),Me(),e),cC=["onClick"],uC=dC(()=>u("tr",null,[u("td",{colspan:"2"},[u("label",{for:"choice-button-input"},"Text")])],-1));function fC(e,t,o,n,s,i){const r=M("d-flow"),a=M("d-fieldset"),l=M("toggle"),d=M("object-tool");return m(),z(d,{object:e.object,title:"Choice",textHandler:e.textHandler},{default:E(()=>[$(a,{class:"buttons",title:"Buttons:"},{default:E(()=>[$(r,{maxSize:"100%",direction:"vertical",noWraping:""},{default:E(()=>[(m(!0),C(N,null,$e(e.buttons,(c,f)=>(m(),C("div",{class:le({choiceBtn:!0,active:f===e.currentIdx}),key:f,onClick:h=>e.select(f)},he(c.text.trim()===""?"[Empty]":c.text),11,cC))),128))]),_:1})]),_:1}),$(a,{class:"current_button",title:"Current button:"},{default:E(()=>[u("table",null,[uC,u("tr",null,[u("td",null,[de(u("input",{id:"choice-button-input","onUpdate:modelValue":t[0]||(t[0]=c=>e.buttonText=c),onKeydown:t[1]||(t[1]=q(()=>{},["stop"]))},null,544),[[je,e.buttonText]])]),u("td",null,[u("button",{onClick:t[2]||(t[2]=c=>e.textEditor=!0)},"...")])])])]),_:1}),u("button",{onClick:t[3]||(t[3]=(...c)=>e.addChoice&&e.addChoice(...c))},"Add"),u("button",{onClick:t[4]||(t[4]=(...c)=>e.removeChoice&&e.removeChoice(...c))},"Remove"),$(l,{label:"Auto line wrap?",modelValue:e.autoWrap,"onUpdate:modelValue":t[5]||(t[5]=c=>e.autoWrap=c)},null,8,["modelValue"])]),_:1},8,["object","textHandler"])}const hC=se(aC,[["render",fC],["__scopeId","data-v-60e50bc5"]]),pC=ne({mixins:[tt],components:{L:Ur}});const Mt=e=>(He("data-v-8073b468"),e=e(),Me(),e),gC={class:"panel"},mC=Mt(()=>u("h1",null,"Help and Credits",-1)),bC=j("Help"),yC=j("Fork me on GitHub"),vC=j("Privacy Statement"),wC=Mt(()=>u("p",null," All assets used are IP of Team Salvato and created by them, unless noted otherwise. ",-1)),CC=Mt(()=>u("p",null,[j(" Doki Doki Dialog Generator developed by EDave64 "),u("br"),j("Based on gemdude46's DDLC Shitpost generator ")],-1)),$C=j(" Unused House Background by "),kC=j(" Fatelogic "),_C=j(" Aller Font by "),SC=j("Dalton Maag Ltd"),xC=j(" Riffic Bold Font by "),PC=j("InkyType"),jC=j(" Verily Serif Mono Font by "),IC=j("Stephen G. Hartke"),TC=j(" F25 Bank Printer Font by "),OC=j("F25 Digital Typeface Design"),BC=j(" Journal Font by "),AC=j("Fontourist"),EC=j(" Hashtag Font by "),DC=j(" TitanVex"),HC=j(" JP Hand Slanted Font by "),MC=j("Jonathan Paterson"),RC=j(" As I Lay Dying Font by "),FC=j("Moises Esqueda"),LC=j(" Damagrafik Script Font by "),NC=j("Davide Terenzi"),WC=j(" Ammy's Handwriting Font by "),VC=j("Ammy K."),zC=j(" Halogen Font by "),UC=j("JLH Fonts"),GC=Mt(()=>u("p",null,[j(" MC Sprite by Childish-N "),u("br"),j("MC Casual Sprite by SlightlySimple "),u("br"),j("MC Chibi by SlightlySimple ")],-1)),XC=j("Concept MC"),qC=j(" by StormBlazed76, "),YC=j("red"),KC=j(" and "),JC=j("yellow"),ZC=j(" eyes by YinuS_WinneR, "),QC=j("chibi"),e1=j(" by Hadrosaur838 "),t1=Mt(()=>u("p",null,[j(" MC Chad Sprite by Cylent-Nite "),u("br"),j("MC Chad Poses and expressions by SlightlySimple "),u("br"),j("MC Chad Poses and chibi by Meddy-sin ")],-1)),o1=Mt(()=>u("p",null,[j(" FeMC Sprite by Meddy-sin "),u("br"),j("FeMC Casual Sprite by SlightlySimple ")],-1)),n1=j("Concept FeMC"),s1=j(" by ShidoDraws, "),i1=j("additional poses, expressions and chibi"),r1=j(" by SlightlySimple "),a1=Mt(()=>u("p",null,"Amy Sprite by Meddy-sin and SlightlySimple",-1)),l1=Mt(()=>u("p",null,"Special thanks to SlightlySimple for testing and technical help",-1)),d1=Mt(()=>u("p",null," Atlas421, T-Rex Harris, smearglexd and Tactical Cupcakes for suggestions and testing ",-1));function c1(e,t,o,n,s,i){const r=M("l");return m(),C("div",gC,[mC,$(r,{class:"btn",to:"wiki://Dokumentation"},{default:E(()=>[bC]),_:1}),$(r,{class:"btn",to:"github://"},{default:E(()=>[yC]),_:1}),$(r,{class:"btn",to:"wiki://Privacy Statement"},{default:E(()=>[vC]),_:1}),wC,CC,u("p",null,[$C,$(r,{to:"https://www.deviantart.com/fatelogic/art/VN-Background-Practice-295671161"},{default:E(()=>[kC]),_:1})]),u("p",null,[_C,$(r,{to:"https://www.daltonmaag.com/library/aller"},{default:E(()=>[SC]),_:1})]),u("p",null,[xC,$(r,{to:"https://www.fontspring.com/fonts/inky-type/riffic"},{default:E(()=>[PC]),_:1})]),u("p",null,[jC,$(r,{to:"https://www.dafont.com/verily-serif-mono.font"},{default:E(()=>[IC]),_:1})]),u("p",null,[TC,$(r,{to:"https://www.dafont.com/f25-bank-printer.font"},{default:E(()=>[OC]),_:1})]),u("p",null,[BC,$(r,{to:"https://www.dafont.com/journal.font"},{default:E(()=>[AC]),_:1})]),u("p",null,[EC,$(r,{to:"https://www.dafont.com/hashtag.font"},{default:E(()=>[DC]),_:1})]),u("p",null,[HC,$(r,{to:"https://www.dafont.com/jp-hand-slanted.font"},{default:E(()=>[MC]),_:1})]),u("p",null,[RC,$(r,{to:"https://www.dafont.com/as-i-lay-dying.font"},{default:E(()=>[FC]),_:1})]),u("p",null,[LC,$(r,{to:"https://www.dafont.com/damagrafik-script.font"},{default:E(()=>[NC]),_:1})]),u("p",null,[WC,$(r,{to:"https://www.dafont.com/ammys-handwriting.font"},{default:E(()=>[VC]),_:1})]),u("p",null,[zC,$(r,{to:"https://www.dafont.com/halogen.font"},{default:E(()=>[UC]),_:1})]),GC,u("p",null,[$(r,{to:"https://www.reddit.com/ofkg59"},{default:E(()=>[XC]),_:1}),qC,$(r,{to:"https://www.reddit.com/og6shh"},{default:E(()=>[YC]),_:1}),KC,$(r,{to:"https://www.reddit.com/oft3vb"},{default:E(()=>[JC]),_:1}),ZC,$(r,{to:"https://www.reddit.com/ofof3o"},{default:E(()=>[QC]),_:1}),e1]),t1,o1,u("p",null,[$(r,{to:"https://www.reddit.com/oizaow"},{default:E(()=>[n1]),_:1}),s1,$(r,{to:"https://www.reddit.com/oosuxu"},{default:E(()=>[i1]),_:1}),r1]),a1,l1,d1])}const u1=se(pC,[["render",c1],["__scopeId","data-v-8073b468"]]),f1=ne({props:{backgroundId:{type:String,required:!0}},data:()=>({isWebPSupported:null,assets:[]}),computed:{background(){const e=this.$store.state.panels.currentPanel;return this.$store.state.panels.panels[e].background},bgData(){return this.$store.getters["content/getBackgrounds"].get(this.backgroundId)||null},isActive(){return this.backgroundId===this.background.current},title(){var e;switch(this.backgroundId){case"buildin.static-color":return"Static color";case"buildin.transparent":return"Transparent"}return(e=this.bgData.label)!=null?e:""},style(){switch(this.backgroundId){case"buildin.static-color":return{"background-color":this.background.color};case"buildin.transparent":return{}}return{backgroundImage:this.assets.filter(t=>t instanceof Hn).map(t=>`url('${t.html.src}')`).join(",")}}},async created(){this.bgData&&(this.assets=await Promise.all(this.bgData.variants[0].map(e=>qo(e,!1))))}});const h1=["title"];function p1(e,t,o,n,s,i){return m(),C("div",{class:le({background:!0,active:e.isActive}),title:e.title,style:Ae(e.style),tabindex:"0",onClick:t[0]||(t[0]=r=>e.$emit("input",e.backgroundId)),onKeydown:[t[1]||(t[1]=Ke(r=>e.$emit("input",e.backgroundId),["enter"])),t[2]||(t[2]=Ke(q(r=>e.$emit("input",e.backgroundId),["prevent"]),["space"]))]},he(e.title),47,h1)}const g1=se(f1,[["render",p1],["__scopeId","data-v-ea8d7586"]]),m1=ne({components:{Toggle:wt,DFieldset:Ct},computed:{vertical(){return this.$store.state.ui.vertical},color:{get(){return this.background.color},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundColor",{color:e,panelId:this.$store.state.panels.currentPanel})})}},flipped:{get(){return this.background.flipped},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundFlipped",{flipped:e,panelId:this.$store.state.panels.currentPanel})})}},scaling:{get(){return this.background.scaling.toString()},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundScaling",{scaling:parseInt(e,10),panelId:this.$store.state.panels.currentPanel})})}},currentBackgroundId(){return this.background.current},background(){const e=this.$store.state.panels.currentPanel;return this.$store.state.panels.panels[e].background},bgData(){return this.$store.state.content.current.backgrounds.find(e=>e.id===this.currentBackgroundId)||null},isColor(){return this.currentBackgroundId==="buildin.static-color"},isVariant(){return!!this.bgData},hasVariants(){return this.bgData?this.bgData.variants.length>1:!1}},methods:{seekVariant(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekBackgroundVariant",{delta:e,panelId:this.$store.state.panels.currentPanel})})}}});const Vn=e=>(He("data-v-c3bc3296"),e=e(),Me(),e),b1=Vn(()=>u("label",{for:"bg_color"},"Color:",-1)),y1={key:1},v1={colspan:"3"},w1={key:0},C1={class:"arrow-col"},$1=Vn(()=>u("td",{style:{"text-align":"center"}},"Variant",-1)),k1={class:"arrow-col"},_1={colspan:"3"},S1=Vn(()=>u("option",{value:"0"},"None",-1)),x1=Vn(()=>u("option",{value:"1"},"Stretch",-1)),P1=Vn(()=>u("option",{value:"2"},"Cover",-1)),j1=[S1,x1,P1],I1={colspan:"3"};function T1(e,t,o,n,s,i){const r=M("toggle"),a=M("d-fieldset");return m(),z(a,{class:le({"bg-settings":!0,vertical:e.vertical}),title:"Settings:"},{default:E(()=>[e.isColor?(m(),C(N,{key:0},[b1,u("button",{id:"bg_color",class:"color-button",style:Ae({background:e.color}),onClick:t[0]||(t[0]=l=>e.$emit("change-color"))},null,4)],64)):X("",!0),e.isVariant?(m(),C("table",y1,[u("tr",null,[u("td",v1,[$(r,{modelValue:e.flipped,"onUpdate:modelValue":t[1]||(t[1]=l=>e.flipped=l),label:"Flipped?"},null,8,["modelValue"])])]),e.hasVariants?(m(),C("tr",w1,[u("td",C1,[u("button",{class:"small-button",onClick:t[2]||(t[2]=l=>e.seekVariant(-1))},"<")]),$1,u("td",k1,[u("button",{class:"small-button",onClick:t[3]||(t[3]=l=>e.seekVariant(1))},">")])])):X("",!0),u("tr",null,[u("td",_1,[de(u("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>e.scaling=l),onKeydown:t[5]||(t[5]=q(()=>{},["stop"]))},j1,544),[[lt,e.scaling]])])]),u("tr",null,[u("td",I1,[u("button",{id:"image_options_button",onClick:t[6]||(t[6]=l=>e.$emit("open-image-options"))}," Image options ")])])])):X("",!0)]),_:1},8,["class"])}const O1=se(m1,[["render",T1],["__scopeId","data-v-c3bc3296"]]),xl={packId:"dddg.buildin.uploadedBackgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},B1=ne({mixins:[tt],components:{BackgroundButton:g1,BackgroundSettings:O1,DropTarget:zd,Color:Ks,ImageOptions:ha,DButton:Ms},data:()=>({colorSelect:!1,imageOptions:!1}),computed:{bgColor:{get(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel].background.color},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundColor",{color:e,panelId:this.$store.state.panels.currentPanel})})}},backgrounds(){return[...this.$store.state.content.current.backgrounds.map(e=>e.id),"buildin.static-color","buildin.transparent"]},showBackgroundsFolder(){return ee.supports.openableFolders.has("backgrounds")}},methods:{setBackground(e){this.$store.commit("panels/setCurrentBackground",{current:e,panelId:this.$store.state.panels.currentPanel})},onFileUpload(e){const t=this.$refs.upload;if(!!t.files)for(const o of t.files)this.addImageFile(o)},addImageFile(e){const t=URL.createObjectURL(e);this.addNewCustomBackground(e.name,e.name,t)},addByUrl(){const e=prompt("Enter the URL of the image");if(e==null)return;const t=e.split("/").slice(-1)[0];this.addNewCustomBackground(t,t,e)},addNewCustomBackground(e,t,o){xl.backgrounds.push({id:e,label:t,variants:[[o]],scaling:"none"}),this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:xl}),this.setBackground(e)})},dragEnter(e){!e.dataTransfer||(e.dataTransfer.effectAllowed="none",Array.from(e.dataTransfer.items).find(t=>t.type.match(/^image.*$/))&&(e.dataTransfer.effectAllowed="link",this.$refs.dt.show()))},openBackgroundFolder(){ee.openFolder("backgrounds")}}});const Rc=e=>(He("data-v-da16fda2"),e=e(),Me(),e),A1=j("Drop here to add as a new background "),E1=Rc(()=>u("h1",null,"Background",-1)),D1=j(" Upload "),H1=Rc(()=>u("i",{class:"material-icons"},"extension",-1)),M1=j(" Search in content packs "),R1=[H1,M1],F1=j(" Open backgrounds folder ");function L1(e,t,o,n,s,i){const r=M("drop-target"),a=M("color"),l=M("image-options"),d=M("background-settings"),c=M("d-button"),f=M("background-button");return m(),C("div",{class:"panel",onDragenter:t[9]||(t[9]=(...h)=>e.dragEnter&&e.dragEnter(...h)),onMouseleave:t[10]||(t[10]=h=>e.$refs.dt.hide())},[$(r,{ref:"dt",class:"drop-target",onDrop:e.addImageFile},{default:E(()=>[A1]),_:1},8,["onDrop"]),E1,e.colorSelect?(m(),z(a,{key:0,modelValue:e.bgColor,"onUpdate:modelValue":t[0]||(t[0]=h=>e.bgColor=h),onLeave:t[1]||(t[1]=h=>e.colorSelect=!1)},null,8,["modelValue"])):e.imageOptions?(m(),z(l,{key:1,type:"background",title:"","panel-id":e.$store.state.panels.currentPanel,"no-composition":"",onLeave:t[2]||(t[2]=h=>e.imageOptions=!1)},null,8,["panel-id"])):(m(),C(N,{key:2},[$(d,{onChangeColor:t[3]||(t[3]=h=>e.colorSelect=!0),onOpenImageOptions:t[4]||(t[4]=h=>e.imageOptions=!0)}),u("button",{class:"btn upload-background",onClick:t[6]||(t[6]=h=>e.$refs.upload.click())},[D1,u("input",{type:"file",ref:"upload",onChange:t[5]||(t[5]=(...h)=>e.onFileUpload&&e.onFileUpload(...h))},null,544)]),u("button",{class:"upload-background",onClick:t[7]||(t[7]=(...h)=>e.addByUrl&&e.addByUrl(...h))},"Add by URL"),u("button",{class:"upload-background",onClick:t[8]||(t[8]=h=>e.$emit("show-dialog","type: Backgrounds"))},R1),e.showBackgroundsFolder?(m(),z(c,{key:0,icon:"folder",class:"upload-background",onClick:e.openBackgroundFolder},{default:E(()=>[F1]),_:1},8,["onClick"])):X("",!0),(m(!0),C(N,null,$e(e.backgrounds,h=>(m(),z(f,{key:h,backgroundId:h,onInput:b=>e.setBackground(h)},null,8,["backgroundId","onInput"]))),128))],64))],32)}const N1=se(B1,[["render",L1],["__scopeId","data-v-da16fda2"]]),W1={},V1={async createSprite({commit:e,rootState:t,state:o},n){const s=await qo(n.assets[0],!1);if(!(s instanceof Hn))return;const i=o.panels[n.panelId].lastObjId+1;return e("create",{object:{...Zo(),assets:n.assets,height:s.height,width:s.width,id:i,panelId:t.panels.currentPanel,onTop:!1,preserveRatio:!0,ratio:s.width/s.height,type:"sprite",y:0,enlargeWhenTalking:t.ui.defaultCharacterTalkingZoom}}),i}},z1={setChoicesProperty(e,t){const o=e.panels[t.panelId].objects[t.id];o[t.key]=t.value,++o.version},setChoiceProperty(e,t){const o=e.panels[t.panelId].objects[t.id];o.choices[t.choiceIdx][t.key]=t.value,++o.version},setChoices(e,t){const o=e.panels[t.panelId].objects[t.id];o.choices=t.choices,++o.version}},U1={createChoice({commit:e,rootState:t,state:o},n){const s=Y(),i=o.panels[n.panelId].lastObjId+1;return e("create",{object:{...Zo(),y:s.Choices.ChoiceY,width:s.Choices.ChoiceButtonWidth,height:0,panelId:t.panels.currentPanel,id:i,onTop:!0,autoWrap:!0,type:"choice",preserveRatio:!1,ratio:s.TextBox.TextBoxWidth/s.TextBox.TextBoxHeight,choiceDistance:s.Choices.ChoiceSpacing,choices:[{selected:!1,text:"Click here to edit choice"}],customColor:s.Choices.ChoiceButtonColor}}),i},addChoice({state:e,commit:t},o){const n=e.panels[o.panelId].objects[o.id];t("setChoices",{id:o.id,panelId:o.panelId,choices:[...n.choices,{selected:!1,text:o.text}]})},removeChoice({state:e,commit:t},o){const s=[...e.panels[o.panelId].objects[o.id].choices];s.splice(o.choiceIdx,1),s.length===0&&s.push({selected:!1,text:""}),t("setChoices",{id:o.id,panelId:o.panelId,choices:s})}},G1={setNotificationProperty(e,t){const o=e.panels[t.panelId].objects[t.id];o[t.key]=t.value,++o.version}},X1={createNotification({commit:e,rootState:t,state:o},n){const s=Y(),i=o.panels[n.panelId].lastObjId+1;return e("create",{object:{...Zo(),y:s.Base.screenHeight/2,width:s.Choices.ChoiceButtonWidth,height:0,panelId:t.panels.currentPanel,autoWrap:!1,id:i,onTop:!0,type:"notification",preserveRatio:!1,ratio:s.TextBox.TextBoxWidth/s.TextBox.TextBoxHeight,customColor:s.Choices.ChoiceButtonColor,text:"Click here to edit notification",backdrop:!0}}),i}},q1={setPoemProperty(e,t){const o=e.panels[t.panelId].objects[t.id];o[t.key]=t.value,++o.version}},Y1={createPoem({commit:e,rootState:t,state:o},n){const s=Y(),i=o.panels[n.panelId].lastObjId+1;return e("create",{object:{subType:"poem",x:s.Poem.defaultX,y:s.Poem.defaultY,width:s.Poem.defaultPoemWidth,height:s.Poem.defaultPoemHeight,panelId:t.panels.currentPanel,flip:!1,rotation:0,id:i,onTop:!0,opacity:100,type:"poem",version:0,preserveRatio:!1,autoWrap:!0,ratio:s.Poem.defaultPoemWidth/s.Poem.defaultPoemHeight,background:s.Poem.defaultPoemBackground,font:s.Poem.defaultPoemStyle,text:`New poem

Click here to edit poem`,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!0,nameboxWidth:null,zoom:1}}),i},createConsole({commit:e,rootState:t,state:o},n){const s=Y(),i=o.panels[n.panelId].lastObjId+1;return e("create",{object:{...Zo(),subType:"console",x:s.Poem.consoleWidth/2,y:s.Poem.consoleHeight/2,width:s.Poem.consoleWidth,height:s.Poem.consoleHeight,panelId:t.panels.currentPanel,id:i,onTop:!0,type:"poem",preserveRatio:!1,ratio:s.Poem.consoleWidth/s.Poem.consoleHeight,background:s.Poem.defaultConsoleBackground,font:s.Poem.defaultConsoleStyle,text:`> _
  
  Console command
  Click here to edit`,autoWrap:!0}}),i}},K1={create(e,{object:t}){const o=e.panels[t.panelId];t.id>o.lastObjId&&(o.lastObjId=t.id),o.objects[t.id]=t,(t.onTop?o.onTopOrder:o.order).push(t.id)},removeFromList(e,t){const o=e.panels[t.panelId],n=t.onTop?o.onTopOrder:o.order,s=n.indexOf(t.id);n.splice(s,1)},addToList(e,t){const o=e.panels[t.panelId];(t.onTop?o.onTopOrder:o.order).splice(t.position,0,t.id)},setOnTop(e,t){const n=e.panels[t.panelId].objects[t.id];n.onTop=t.onTop},setPosition(e,t){const n=e.panels[t.panelId].objects[t.id];n.x=t.x,n.y=t.y},setFlip(e,t){const n=e.panels[t.panelId].objects[t.id];n.flip=t.flip},setSize(e,t){const n=e.panels[t.panelId].objects[t.id];n.width=t.width,n.height=t.height},setRatio(e,t){const n=e.panels[t.panelId].objects[t.id];n.preserveRatio=t.preserveRatio,n.ratio=t.ratio},setRotation(e,t){const n=e.panels[t.panelId].objects[t.id];n.rotation=t.rotation<0?360-Math.abs(t.rotation)%360:t.rotation%360},removeObject(e,t){const o=e.panels[t.panelId];delete o.objects[t.id]},setComposition(e,t){const n=e.panels[t.panelId].objects[t.id];n.composite=t.composite},object_setFilters(e,t){const n=e.panels[t.panelId].objects[t.id];n.filters=t.filters},setLabel(e,t){const n=e.panels[t.panelId].objects[t.id];n.label=t.label},setTextboxColor(e,t){const n=e.panels[t.panelId].objects[t.id];n.textboxColor=t.textboxColor},setEnlargeWhenTalking(e,t){const n=e.panels[t.panelId].objects[t.id];n.enlargeWhenTalking=t.enlargeWhenTalking,++n.version},setObjectNameboxWidth(e,t){const n=e.panels[t.panelId].objects[t.id];n.nameboxWidth=t.nameboxWidth,++n.version},setObjectZoom(e,t){const n=e.panels[t.panelId].objects[t.id];n.zoom=t.zoom,++n.version},...W1,...ty,...P0,...z1,...G1,...q1},J1={removeObject({state:e,commit:t,rootState:o},n){var r;const s=e.panels[n.panelId],i=s.objects[n.id];o.ui.selection===n.id&&t("ui/setSelection",null,{root:!0});for(const a of[...s.onTopOrder,...s.order]){const l=s.objects[a];i.id===a||l.type!=="textBox"||l.talkingObjId===i.id&&t("setTalkingOther",{id:l.id,talkingOther:(r=i.label)!=null?r:"",panelId:n.panelId})}t("removeFromList",{id:n.id,panelId:n.panelId,onTop:i.onTop}),t("removeObject",{id:n.id,panelId:n.panelId})},setPosition({state:e,commit:t,dispatch:o},n){e.panels[n.panelId].objects[n.id].type==="character"?o("setCharacterPosition",n):t("setPosition",n)},setOnTop({state:e,commit:t},o){const n=e.panels[o.panelId],s=n.objects[o.id];s.onTop!==o.onTop&&(t("removeFromList",{panelId:o.panelId,id:o.id,onTop:s.onTop}),t("addToList",{id:o.id,panelId:o.panelId,position:(o.onTop?n.onTopOrder:n.order).length,onTop:o.onTop}),t("setOnTop",{panelId:o.panelId,id:o.id,onTop:o.onTop}))},shiftLayer({state:e,commit:t},o){const n=e.panels[o.panelId],s=n.objects[o.id],i=s.onTop?n.onTopOrder:n.order;let a=i.indexOf(s.id)+o.delta;a<0&&(a=0),a>i.length&&(a=i.length),t("removeFromList",{panelId:o.panelId,id:o.id,onTop:s.onTop}),t("addToList",{panelId:o.panelId,id:o.id,position:a,onTop:s.onTop})},setPreserveRatio({commit:e,state:t},o){const s=t.panels[o.panelId].objects[o.id],i=o.preserveRatio?s.width/s.height:0;e("setRatio",{panelId:o.panelId,id:o.id,preserveRatio:o.preserveRatio,ratio:i})},setWidth({commit:e,state:t},o){const s=t.panels[o.panelId].objects[o.id],i=s.preserveRatio?o.width/s.ratio:s.height;e("setSize",{panelId:o.panelId,id:o.id,height:i,width:o.width})},setHeight({commit:e,state:t},o){const s=t.panels[o.panelId].objects[o.id],i=s.preserveRatio?o.height*s.ratio:s.width;e("setSize",{panelId:o.panelId,id:o.id,height:o.height,width:i})},copyObjects({commit:e,state:t},{sourcePanelId:o,targetPanelId:n}){const s=t.panels[o],i=t.panels[n],r=[...s.onTopOrder,...s.order],a=new Map;let l=i.lastObjId;for(const d of r){const c=++l;a.set(d,c)}for(const d of r){const c=s.objects[d],f=JSON.parse(JSON.stringify(c));if("talkingObjId"in f){const h=f;h.talkingObjId!==null&&h.talkingObjId!=="$other$"&&a.has(h.talkingObjId)&&(h.talkingObjId=a.get(h.talkingObjId))}e("create",{object:{...f,id:a.get(d),panelId:n}})}},copyObjectToClipboard({commit:e,state:t},{id:o,panelId:n}){const s=t.panels[n].objects[o];e("ui/setClipboard",JSON.stringify(s),{root:!0})},pasteObjectFromClipboard({commit:e,state:t,rootState:o}){if(o.ui.clipboard==null)return;const n=JSON.parse(o.ui.clipboard);e("create",{object:{...n,id:t.panels[t.currentPanel].lastObjId+1,panelId:t.currentPanel}})},object_addFilter({state:e,commit:t},o){er(o,()=>e.panels[o.panelId].objects[o.id],n=>t("object_setFilters",n))},object_removeFilter({state:e,commit:t},o){tr(o,()=>e.panels[o.panelId].objects[o.id],n=>t("object_setFilters",n))},object_moveFilter({state:e,commit:t},o){or(o,()=>e.panels[o.panelId].objects[o.id],n=>t("object_setFilters",n))},object_setFilter({state:e,commit:t},o){nr(o,()=>e.panels[o.panelId].objects[o.id],n=>t("object_setFilters",n))},...V1,...ny,...j0,...U1,...X1,...Y1};function Z1(e,t){const o=e.state.panels;for(const n in o){const s=o[n];for(const i in s.objects){const r=s.objects[i];if(r.type==="character"){sy(e,r.panelId,r.id,t);return}}}}var ls=(e=>(e[e.None=0]="None",e[e.Stretch=1]="Stretch",e[e.Cover=2]="Cover",e))(ls||{});const Q1="buildin.transparent",es={panelToUrl:new Map,urlToPanel:new Map,register(e,t){if(this.panelToUrl.has(e)){if(this.panelToUrl.get(e)===t)return;this.unregister(e,this.panelToUrl.get(e))}this.panelToUrl.set(e,t),this.urlToPanel.has(t)?this.urlToPanel.get(t).push(e):this.urlToPanel.set(t,[e])},unregister(e,t){if(this.urlToPanel.has(t)){const o=this.urlToPanel.get(t);o.splice(o.indexOf(e),1),o.length===0&&(this.urlToPanel.delete(t),URL.revokeObjectURL(t))}this.panelToUrl.delete(e)}},e$={namespaced:!0,state:{lastPanelId:-1,panels:{},panelOrder:[],currentPanel:null},mutations:{setCurrentPanel(e,{panelId:t}){e.currentPanel=t},setPanelPreview(e,{panelId:t,url:o}){e.panels[t].lastRender=o,es.register(t,o)},createPanel(e,{panel:t}){e.lastPanelId=t.id,e.panels[t.id]=t},setPanelOrder(e,{panelOrder:t}){e.panelOrder=[...t]},setCurrentBackground(e,{current:t,panelId:o}){const n=e.panels[o];n.background.current=t,n.background.variant=0},setBackgroundColor(e,{color:t,panelId:o}){const n=e.panels[o];n.background.color=t},setBackgroundFlipped(e,{flipped:t,panelId:o}){const n=e.panels[o];n.background.flipped=t},setBackgroundVariant(e,{variant:t,panelId:o}){const n=e.panels[o];n.background.variant=t},setBackgroundScaling(e,{scaling:t,panelId:o}){const n=e.panels[o];n.background.scaling=t},deletePanel(e,{panelId:t}){es.unregister(t,es.panelToUrl.get(t)),delete e.panels[t]},setComposition(e,t){const o=e.panels[t.panelId];o.composite=t.composite},setFilters(e,t){const o=e.panels[t.panelId];o.filters=t.filters},backgroundSetComposition(e,t){const o=e.panels[t.panelId];o.background.composite=t.composite},backgroundSetFilters(e,t){const o=e.panels[t.panelId];o.background.filters=t.filters},...K1},actions:{createPanel({state:e,commit:t}){const o=e.lastPanelId+1;return t("createPanel",{panel:{id:o,background:{color:"#000000",current:Q1,flipped:!1,scaling:2,variant:0,composite:"source-over",filters:[]},lastRender:"",composite:"source-over",filters:[],objects:{},onTopOrder:[],order:[],lastObjId:-1}}),t("setPanelOrder",{panelOrder:[...e.panelOrder,o]}),t("setCurrentPanel",{panelId:o}),o},duplicatePanel({state:e,commit:t},{panelId:o}){const n=e.panels[o],s=e.lastPanelId+1;es.register(s,n.lastRender);const i=JSON.parse(JSON.stringify(n));let r=-1;const a=new Map,l={};for(const c in i.objects)a.set(+c,++r);for(const c in i.objects){const f=i.objects[c],h=a.get(+c);if(l[h]=f,f.panelId=s,f.id=h,"talkingObjId"in f){const b=f;b.talkingObjId!==null&&b.talkingObjId!=="$other$"&&a.has(b.talkingObjId)&&(b.talkingObjId=a.get(b.talkingObjId))}}t("createPanel",{panel:{...i,id:s,lastObjId:r,objects:l,order:i.order.map(c=>a.get(c)),onTopOrder:i.onTopOrder.map(c=>a.get(c))}});const d=e.panelOrder.indexOf(o);t("setPanelOrder",{panelOrder:[...e.panelOrder.slice(0,d+1),s,...e.panelOrder.slice(d+1)]}),t("setCurrentPanel",{panelId:s})},seekBackgroundVariant({state:e,rootGetters:t,commit:o},{delta:n}){const s=e.panels[e.currentPanel],r=t["content/getBackgrounds"].get(s.background.current);!r||o("setBackgroundVariant",{panelId:e.currentPanel,variant:fn(r.variants,s.background.variant,n)})},delete({state:e,commit:t},{panelId:o}){if(e.panelOrder.length<=1)return;const n=e.panelOrder.indexOf(o);let s;n===e.panelOrder.length-1?s=n-1:s=n+1,t("setCurrentPanel",{panelId:e.panelOrder[s]}),t("setPanelOrder",{panelOrder:[...e.panelOrder.slice(0,n),...e.panelOrder.slice(n+1)]}),t("deletePanel",{panelId:o})},fixContentPackRemoval(e,t){const{state:o,rootGetters:n,commit:s,rootState:i}=e;for(const r of Object.values(o.panels)){const a=t.backgrounds.find(f=>f.id===r.background.current);if(!a)return;const l=n["content/getBackgrounds"].get(r.background.current);if(!l){i.content.current.backgrounds.length>0?s("setCurrentBackground",{current:i.content.current.backgrounds[0].id,panelId:r.id}):s("setCurrentBackground",{current:"buildin.transparent",panelId:r.id});return}const d=JSON.stringify(a.variants[r.background.variant]),c=l.variants.findIndex(f=>JSON.stringify(f)===d);c!==r.background.variant&&s("setBackgroundVariant",{variant:c===-1?0:c,panelId:r.id})}Z1(e,t)},move({state:e,commit:t},{panelId:o,delta:n}){const s=[...e.panelOrder],i=s.indexOf(o);s.splice(i,1);const r=Math.max(i+n,0);s.splice(r,0,o),t("setPanelOrder",{panelOrder:s})},addFilter({state:e,commit:t},o){er(o,()=>e.panels[o.panelId],n=>t("setFilters",n))},removeFilter({state:e,commit:t},o){tr(o,()=>e.panels[o.panelId],n=>t("setFilters",n))},moveFilter({state:e,commit:t},o){or(o,()=>e.panels[o.panelId],n=>t("setFilters",n))},setFilter({state:e,commit:t},o){nr(o,()=>e.panels[o.panelId],n=>t("setFilters",n))},backgroundAddFilter({state:e,commit:t},o){er(o,()=>e.panels[o.panelId].background,n=>t("backgroundSetFilters",n))},backgroundRemoveFilter({state:e,commit:t},o){tr(o,()=>e.panels[o.panelId].background,n=>t("backgroundSetFilters",n))},backgroundMoveFilter({state:e,commit:t},o){or(o,()=>e.panels[o.panelId].background,n=>t("backgroundSetFilters",n))},backgroundSetFilter({state:e,commit:t},o){nr(o,()=>e.panels[o.panelId].background,n=>t("backgroundSetFilters",n))},...J1}};class t${constructor(t,o,n,s,i,r){this.id=t,this.assets=o,this.flip=n,this.scale=s,this.compositeMode=i,this.filters=r}async render(t){const{screenWidth:o,screenHeight:n}=Y().Base,s=await Promise.all(this.assets.map(i=>qo(i,t.hq)));for(const i of s){let r=0,a=0,l=i.width,d=i.height;switch(this.scale){case ls.None:r=o/2-l/2,a=n/2-d/2;break;case ls.Stretch:l=o,d=n;break;case ls.Cover:const c=l/d,f=o/n;c>f?(d=n,l=d*c):(l=o,d=l/c),r=o/2-l/2,a=n/2-d/2}t.drawImage({image:i,x:r,y:a,w:l,h:d,flip:this.flip,composite:this.compositeMode,filters:this.filters})}}}const Pl={id:"buildin.static-color",name:"Static color",color:"#000000",async render(e){const{screenWidth:t,screenHeight:o}=Y().Base;e.drawRect({x:0,y:0,w:t,h:o,fill:{style:this.color}})}};class Fc extends Dc{constructor(){super(...arguments);v(this,"refTextbox",null)}get canvasDrawWidth(){return this.width*this.objZoom}get canvasDrawHeight(){return this.height*this.objZoom}get canvasDrawPosX(){return this.x-this.width/2+(this.height-this.canvasDrawHeight)/2}get canvasDrawPosY(){return this.y+(this.height-this.canvasDrawHeight)}get objZoom(){return(this.obj.enlargeWhenTalking&&this.refTextbox?1.05:1)*this.obj.zoom}getHitbox(){const o=super.getHitbox(),n=this.width*(this.objZoom-1),s=this.height*(this.objZoom-1);return{x0:o.x0-n/2,x1:o.x1+n/2,y0:o.y0-s,y1:o.y1}}updatedContent(o,n){const s=o.state.panels.panels[n],i=[...s.order,...s.onTopOrder];this.refTextbox=null;for(const r of i){const a=o.state.panels.panels[n].objects[r];if(a.type==="textBox"&&a.talkingObjId===this.obj.id){this.refTextbox=a;return}}}async renderLocal(o){const n=this.getAssetList(),s=await Promise.all(n.filter(i=>i.assets).map(i=>o$(i,o.hq)));for(const i of s)for(const r of i.assets)o.drawImage({image:r,composite:i.composite,x:i.offset[0],y:i.offset[1]})}}async function o$(e,t){return"loaded"in e?e:{loaded:!0,offset:e.offset,assets:await Promise.all(e.assets.map(o=>qo(o,t))),composite:e.composite}}class n$ extends Fc{constructor(o){super(o);v(this,"assets");v(this,"ready",null);v(this,"canvasHeight",0);v(this,"canvasWidth",0);this.init()}get version(){return this.assets===null?-1:this.obj.version}async init(){let o;this.ready=new Promise((r,a)=>{o=r});const n=await Promise.all(this.obj.assets.map(r=>qo(r)));let s=0,i=0;for(const r of n)r.height>i&&(i=r.height),r.width>s&&(s=r.width);this.canvasWidth=s,this.canvasHeight=i,this.assets=[{loaded:!0,assets:n,offset:[0,0]}],o()}getAssetList(){var o;return(o=this.assets)!=null?o:[]}}class s$ extends Fc{constructor(o,n){super(o);v(this,"scaleable",!0);this.data=n}updatedContent(o,n){super.updatedContent(o,n),this.data=zs(o,this.obj)}getAssetList(){const o=qt(this.data,this.obj),n=Ji(this.data,this.obj),s=[];for(const i of o.renderCommands)switch(i.type){case"head":s.push({offset:i.offset,composite:i.composite,assets:n?n.variants[this.obj.posePositions.head||0]:[]});break;case"image":s.push({offset:i.offset,composite:i.composite,assets:i.images});break;case"pose-part":const r=o.positions[i.part];if(!r||r.length===0)break;const a=r[this.obj.posePositions[i.part]||0];if(!a)break;s.push({offset:i.offset,composite:i.composite,assets:a});break}return s}get canvasHeight(){return qt(this.data,this.obj).size[1]}get canvasWidth(){return qt(this.data,this.obj).size[0]}get closeZoom(){let o=1;return this.obj.close&&(o*=2),o}get width(){return this.obj.width*this.closeZoom}get height(){return this.obj.height*this.closeZoom}}class i$ extends Xs{constructor(){super(...arguments);v(this,"_height",0);v(this,"choiceRenderers",[])}get height(){return this._height}get centeredVertically(){return!0}async draw(o){await this.updateChoiceBounds();const n=Y(),s=this.obj.width,i=this.height,r=s/2,l=(this.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r;let d=this.obj.y-i/2;for(const c of this.choiceRenderers){await c.loadFonts();const f=c.getHeight(this.obj.autoWrap?this.obj.width:0);o.drawRect({x:l,y:d,w:s,h:f+n.Choices.ChoicePadding*2,outline:{style:n.Choices.ChoiceButtonBorderColor,width:n.Choices.Outline},fill:{style:n.Choices.ChoiceButtonColor}}),c.fixAlignment("center",l,l+s,d+n.Choices.ChoiceSpacing*1.25,this.obj.autoWrap?s:0),c.render(o.fsCtx),d+=f+n.Choices.ChoicePadding*2+n.Choices.ChoiceSpacing}}async updateChoiceBounds(){const o=Y();this.choiceRenderers=this.obj.choices.map(n=>new yt(n.text||" ",o.Choices.ChoiceTextStyle)),this._height=this.choiceRenderers.reduce((n,s)=>n+s.getHeight(this.obj.autoWrap?this.obj.width:0)+o.Choices.ChoicePadding*2,0)+this.obj.choiceDistance*(this.obj.choices.length-1)}}class r$ extends Xs{constructor(){super(...arguments);v(this,"_height",0);v(this,"_width",0)}get height(){return this._height}get width(){return this._width}get centeredVertically(){return!0}get id(){return this.obj.id}async render(o,n){const s=Y();this.obj.backdrop&&n.drawRect({x:0,y:0,w:s.Base.screenWidth,h:s.Base.screenHeight,fill:{style:Y().Notification.NotificationBackdropColor}}),await super.render(o,n)}async draw(o){const n=Y(),s=new yt(this.obj.text,n.Notification.NotificationTextStyle),i=new yt("OK",n.Notification.NotificationOkTextStyle);await s.loadFonts(),await i.loadFonts();const r=this.obj.autoWrap?this.obj.width-n.Notification.NotificationPadding*2:0,a=this.obj.autoWrap?r:s.getWidth(),l=s.getHeight(r),d=this.obj.autoWrap?r:i.getWidth(),c=i.getHeight(r),f=this._width=Math.max(a,d)+n.Notification.NotificationPadding*2,h=this._height=l+n.Notification.NotificationPadding*2+n.Notification.NotificationSpacing+c,b=f/2,k=(this.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-b,T=this.obj.y-h/2;o.drawRect({x:k,y:T,w:f,h,outline:{style:n.Choices.ChoiceButtonBorderColor,width:3},fill:{style:n.Choices.ChoiceButtonColor}}),s.fixAlignment("center",k,k+f,T+n.Notification.NotificationPadding*1.5,r),s.render(o.fsCtx),i.fixAlignment("center",k,k+f,T+h-n.Notification.NotificationPadding,r),i.render(o.fsCtx)}}const a$=-2,l$=26,d$=10,c$=10;class u$ extends Xs{constructor(){super(...arguments);v(this,"_height",0);v(this,"_width",0)}get height(){return this._height}get width(){return this._width}get centeredVertically(){return!0}async draw(o){const n=Y(),s=n.Poem.poemBackgrounds[this.obj.background],i=this.flip?n.Base.screenWidth-this.obj.x:this.obj.x;let r=this.obj.y,a=i+c$,l=n.Poem.poemPadding,d=n.Poem.poemTopPadding,c=l*2;if(s.file==="internal:console"){const b=this._height=this.obj.height,y=this._width=this.obj.width;o.drawRect({x:i-y/2,y:this.obj.y-b/2,h:b,w:y,fill:{style:n.Poem.consoleBackgroundColor}}),l=a$,d=l$,c=d$}else if(s.file==="internal:transparent")this._height=this.obj.height,this._width=this.obj.width;else{const b=await Wr(`assets/poemBackgrounds/${s.file}`);o.drawImage({image:b,x:i-b.width/2,y:this.obj.y-b.height/2}),this._height=b.height,this._width=b.width}r-=this.height/2,a-=this.width/2;const f=n.Poem.poemTextStyles[this.obj.font],h=new yt(this.obj.text,f);await h.loadFonts(),h.fixAlignment("left",a+l,a+l,r+d+l,this.obj.autoWrap?this.width-c:0),h.render(o.fsCtx)}}const va=class{constructor(t,o,n,s){v(this,"renderObjectCache",new Map);v(this,"renderer");this.store=t,this.panelId=o,this.canvasWidth=n,this.canvasHeight=s,this.renderer=new Wn(n,s)}render(t,o){return this.panel?this.renderer.render(this.renderCallback.bind(this),t,o):Promise.resolve(!1)}download(){const t=new Date,o=`panel-${[t.getFullYear(),`${t.getMonth()+1}`.padStart(2,"0"),`${t.getDate()}`.padStart(2,"0"),`${t.getHours()}`.padStart(2,"0"),`${t.getMinutes()}`.padStart(2,"0"),`${t.getSeconds()}`.padStart(2,"0")].join("-")}.png`;return this.renderer.download(this.renderCallback.bind(this),o)}paintOnto(t,o){this.renderer.paintOnto(t,o)}objectsAt(t,o){return this.getRenderObjects().filter(n=>n.hitTest(t,o)).map(n=>n.id)}async renderCallback(t){var n;t.fsCtx.imageSmoothingEnabled=!0,t.fsCtx.imageSmoothingQuality=t.hq?"high":"low",await((n=this.getBackgroundRenderer())==null?void 0:n.render(t));const o=this.store.state.ui.selection;for(const s of this.getRenderObjects()){s.updatedContent(this.store,this.panelId);const i=o===s.id,r=document.querySelector(va.FocusProp),a=(r==null?void 0:r.getAttribute("data-obj-id"))===""+s.id;await s.render((i?hn.Selected:hn.None)+(a?hn.Focused:hn.None),t)}t.applyFilters([...this.panel.filters]),t.preview&&t.drawImage({x:0,y:0,h:this.canvasHeight,w:this.canvasWidth,composite:"destination-over",image:await At("backgrounds/transparent")})}getRenderObjects(){const t=this.store.state.panels.panels[this.panelId],o=[...t.order,...t.onTopOrder],n=t.objects,s=Array.from(this.renderObjectCache.keys()).filter(i=>!o.includes(i));for(const i of s)this.renderObjectCache.delete(i);return o.map(i=>{let r=this.renderObjectCache.get(i);if(!r){const a=n[i],l=a.type;switch(l){case"sprite":r=new n$(a);break;case"character":const d=a;r=new s$(d,zs(this.store,d));break;case"textBox":r=new Fy(a);break;case"choice":r=new i$(a);break;case"notification":r=new r$(a);break;case"poem":r=new u$(a);break;default:throw new bt.UnreachableCaseError(l)}this.renderObjectCache.set(i,r)}return r})}get panel(){return this.store.state.panels.panels[this.panelId]}getBackgroundRenderer(){const t=this.panel;switch(t.background.current){case"buildin.static-color":return Pl.color=t.background.color,Pl;default:const n=this.store.getters["content/getBackgrounds"].get(t.background.current);if(!n)return null;const s=n.variants[t.background.variant];return new t$(t.background.current,s,t.background.flipped,t.background.scaling,t.background.composite,t.background.filters)}}};let Fo=va;v(Fo,"FocusProp",typeof CSS<"u"&&CSS.supports("selector(:focus-visible)")?":focus-visible":":focus");const f$=1.5,jl=1/4,h$=.5,yi=100,Il=90,Tl=70,p$=ne({mixins:[tt],components:{DFieldset:Ct,DFlow:Ln,DButton:Ms,ImageOptions:ha},data:()=>({webpSupport:!1,heifSupport:!1,ppi:0,pages:"",format:"image/png",quality:Il,imageOptions:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},isLossy(){return this.format!=="image/png"},canDeletePanel(){return this.panelButtons.length>1},panelButtons(){return this.$store.state.panels.panelOrder.map(t=>{const o=this.$store.state.panels.panels[t],n=this.$store.state.panels.panels[t],s=[...n.order,...n.onTopOrder].map(i=>this.$store.state.panels.panels[t].objects[i]).map(this.extractObjectText);return{id:t,image:o.lastRender,text:s.reduce((i,r)=>i.length>r.length?i:r,"")}})},canMoveAhead(){return this.$store.state.panels.panelOrder.indexOf(this.currentPanel.id)>0},canMoveBehind(){const e=this.$store.state.panels.panelOrder;return e.indexOf(this.currentPanel.id)<e.length-1}},async created(){[this.webpSupport,this.heifSupport]=await Promise.all([zo(),lp()])},async mounted(){this.moveFocusToActivePanel(),this.renderThumbnail().catch(()=>{})},methods:{async download(){const e=this.getPanelDistibution(),t=new Date,o=`cd-${[t.getFullYear(),`${t.getMonth()+1}`.padStart(2,"0"),`${t.getDate()}`.padStart(2,"0"),`${t.getHours()}`.padStart(2,"0"),`${t.getMinutes()}`.padStart(2,"0"),`${t.getSeconds()}`.padStart(2,"0")].join("-")}`,n=this.format.split("/")[1],s=this.format,i=this.quality;await this.renderObjects(e,!0,async(r,a)=>{await ee.saveToFile(a,`${o}_${r}.${n}`,s,i/yi)})},async estimateExportSize(){const e=this.getPanelDistibution(),t=this.format||"image/png",o=this.quality||Il,s=(await this.renderObjects(e,!1,async(l,d)=>new Promise((c,f)=>{d.toBlob(h=>{if(!h){f(`Image ${l+1} could not be rendered.`);return}c(h.size)},t,o/yi)}))).map(l=>(l*f$/1024/1024).toFixed(2)+"MiB"),i=s.length>1?"files":"file",r=s.length>1?"These":"It",a=s.length>1?"sizes":"size";we.fire(new it(`This would export ${s.length} ${i}. ${r} would have the following (aproximate) ${a}: ${s.join(",")}`))},async renderObjects(e,t,o){const n=Y().Base;return await Promise.all(e.map(async(s,i)=>{const r=document.createElement("canvas");r.width=n.screenWidth,r.height=n.screenHeight*s.length;const a=r.getContext("2d");return await Promise.all(s.map(async(l,d)=>{const c=new Fo(this.$store,s[d],n.screenWidth,n.screenHeight);await c.render(t,!1),c.paintOnto(a,{x:0,y:n.screenHeight*d,w:n.screenWidth,h:n.screenHeight})})),await o(i,r)}))},getLimitedPanelList(){const e=this.$store.state.panels.panelOrder.length-1,t=0,o=this.pages.split(","),n=[];let s=!1;for(const i of o){const r=i.trim(),a=r.match(/^\s*((\d+)|(\d+)\s*-\s*(\d+))\s*$/);if(!a){r!==""&&we.fire(new it(`Could not read '${i}' in the page list.`));continue}if(s=!0,a[2])n.push(parseInt(a[2],10)-1);else{const l=Math.max(parseInt(a[3],10)-1,t),d=Math.min(parseInt(a[4],10)-1,e);if(l==null||d==null||l>d)continue;for(let c=l;c<=d;++c)n.push(c)}}return s?n.sort((i,r)=>i-r).filter((i,r,a)=>a[r-1]!==i).map(i=>this.$store.state.panels.panelOrder[i]):this.$store.state.panels.panelOrder},getPanelDistibution(){const e=this.getLimitedPanelList();if(isNaN(this.ppi)&&(this.ppi=0),this.ppi===0)return[e];const t=[];for(let o=0;o<e.length/this.ppi;++o){const n=o*this.ppi,s=n+this.ppi;t.push([...e.slice(n,s)])}return t},moveFocusToActivePanel(){const e=this.$el.querySelector(".panel_button.active");e&&this.scrollIntoView(e)},scrollIntoView(e){const t=e.parentElement.parentElement;this.$store.state.ui.vertical?(t.scrollTop=e.offsetTop-t.clientHeight/2,t.scrollLeft=0):(t.scrollLeft=e.offsetLeft-t.clientWidth/2,t.scrollTop=0)},extractObjectText(e){switch(e.type){case"textBox":return e.text;case"notification":return e.text;case"poem":return e.text;case"choice":return e.choices.map(t=>`[${t.text}]`).join(`
`)}return""},async addNewPanel(){await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/duplicatePanel",{panelId:this.$store.state.panels.currentPanel})}),await this.$nextTick(),this.moveFocusToActivePanel()},updateCurrentPanel(e){this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setCurrentPanel",{panelId:e})}),this.$nextTick(()=>{this.moveFocusToActivePanel()})},deletePanel(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/delete",{panelId:this.$store.state.panels.currentPanel})}),this.$nextTick(()=>{this.moveFocusToActivePanel()})},moveAhead(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/move",{panelId:this.currentPanel.id,delta:-1})})},moveBehind(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/move",{panelId:this.currentPanel.id,delta:1})})},async renderThumbnail(){await Vd("render thumbnail",async()=>{const e=Y().Base,t=new Fo(this.$store,this.currentPanel.id,e.screenWidth,e.screenHeight);await t.render(!1,!0);const o=document.createElement("canvas");o.width=e.screenWidth*jl,o.height=e.screenHeight*jl,t.paintOnto(o.getContext("2d"),{x:0,y:0,w:o.width,h:o.height}),o.toBlob(n=>{if(!n)return;const s=URL.createObjectURL(n);this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPanelPreview",{panelId:this.$store.state.panels.currentPanel,url:s})})},await zo()?"image/webp":"image/jpeg",h$)})}},watch:{quality(e,t){if(e===yi){we.fire(new it("Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression."));return}if(t>Tl&&e<=Tl){we.fire(new it("Note: A quality level below 70% might be very noticable and impair legibility of text."));return}}}});const vo=e=>(He("data-v-d009d57d"),e=e(),Me(),e),g$={class:"panel"},m$=vo(()=>u("h1",null,"Panels",-1)),b$=["onClick","onKeydown"],y$={class:"panel_text"},v$={class:"panel_nr"},w$={class:"column"},C$=j(" Add new"),$$=j(" Delete panel "),k$=j(" Move ahead "),_$=j(" Move behind "),S$=j(" Image options "),x$=vo(()=>u("td",null,[u("label",{for:"export_format"},"Format")],-1)),P$=vo(()=>u("option",{value:"image/png"},"PNG (lossless)",-1)),j$={key:0,value:"image/webp"},I$={key:1,value:"image/heif"},T$=vo(()=>u("option",{value:"image/jpeg"},"JPEG (lossy)",-1)),O$={key:0},B$=vo(()=>u("td",null,[u("label",{for:"export_quality"},"Quality:")],-1)),A$=vo(()=>u("td",null,[u("label",{for:"export_ppi"},[j(" Panels per image: "),u("br"),u("small",null,"(0 for one single image)")])],-1)),E$=vo(()=>u("td",null,[u("label",{for:"export_pages"},[j(" Panels to export: "),u("br"),u("small",null,"(Leave empty for all)")])],-1)),D$=j(" Download ");function H$(e,t,o,n,s,i){const r=M("image-options"),a=M("d-flow"),l=M("d-fieldset"),d=M("d-button");return m(),C("div",g$,[m$,e.imageOptions?(m(),z(r,{key:0,type:"panel",title:"","panel-id":e.currentPanel.id,"no-composition":"",onLeave:t[0]||(t[0]=c=>{e.imageOptions=!1,e.renderThumbnail()})},null,8,["panel-id"])):(m(),C(N,{key:1},[$(l,{class:"existing_panels_fieldset",title:"Existing Panels"},{default:E(()=>[$(a,{"no-wraping":"",maxSize:"350px"},{default:E(()=>[(m(!0),C(N,null,$e(e.panelButtons,(c,f)=>(m(),C("div",{key:c.id,class:le({panel_button:!0,active:c.id===e.currentPanel.id}),style:Ae(`background-image: url('${c.image}')`),tabindex:"0",onClick:h=>e.updateCurrentPanel(c.id),onKeydown:[Ke(h=>e.updateCurrentPanel(c.id),["enter"]),Ke(q(h=>e.updateCurrentPanel(c.id),["prevent"]),["space"])]},[u("div",y$,[u("p",null,he(c.text),1)]),u("div",v$,he(f+1),1)],46,b$))),128))]),_:1})]),_:1}),u("div",w$,[$(d,{icon:"add_to_queue",onClick:e.addNewPanel},{default:E(()=>[C$]),_:1},8,["onClick"]),$(d,{icon:"remove_from_queue",onClick:e.deletePanel,disabled:!e.canDeletePanel},{default:E(()=>[$$]),_:1},8,["onClick","disabled"]),$(d,{icon:"arrow_upward",onClick:e.moveAhead,disabled:!e.canMoveAhead},{default:E(()=>[k$]),_:1},8,["onClick","disabled"]),$(d,{icon:"arrow_downward",onClick:e.moveBehind,disabled:!e.canMoveBehind},{default:E(()=>[_$]),_:1},8,["onClick","disabled"]),$(d,{icon:"color_lens",onClick:t[1]||(t[1]=c=>e.imageOptions=!0)},{default:E(()=>[S$]),_:1})]),$(l,{title:"Export"},{default:E(()=>[u("table",null,[u("tr",null,[x$,u("td",null,[de(u("select",{id:"export_format","onUpdate:modelValue":t[2]||(t[2]=c=>e.format=c)},[P$,e.webpSupport?(m(),C("option",j$," WebP (lossy) ")):X("",!0),e.heifSupport?(m(),C("option",I$," HEIF (lossy) ")):X("",!0),T$],512),[[lt,e.format]])])]),e.isLossy?(m(),C("tr",O$,[B$,u("td",null,[de(u("input",{id:"export_quality",type:"number",min:"0",max:"100","onUpdate:modelValue":t[3]||(t[3]=c=>e.quality=c),onKeydown:t[4]||(t[4]=q(()=>{},["stop"]))},null,544),[[je,e.quality,void 0,{number:!0}]])])])):X("",!0),u("tr",null,[A$,u("td",null,[de(u("input",{id:"export_ppi",type:"number",min:"0","onUpdate:modelValue":t[5]||(t[5]=c=>e.ppi=c),onKeydown:t[6]||(t[6]=q(()=>{},["stop"])),onBlur:t[7]||(t[7]=c=>{e.ppi===""&&(e.ppi=0)})},null,544),[[je,e.ppi,void 0,{number:!0}]])])]),u("tr",null,[E$,u("td",null,[de(u("input",{id:"export_pages","onUpdate:modelValue":t[8]||(t[8]=c=>e.pages=c),placeholder:"E.g. 1-5, 8, 11-13"},null,512),[[je,e.pages]])])]),u("tr",null,[u("td",null,[$(d,{icon:"photo_camera",onClick:e.download},{default:E(()=>[D$]),_:1},8,["onClick"])]),u("td",null,[u("button",{onClick:t[9]||(t[9]=(...c)=>e.estimateExportSize&&e.estimateExportSize(...c))},"Estimate filesizes")])])])]),_:1})],64))])}const M$=se(p$,[["render",H$],["__scopeId","data-v-d009d57d"]]),vi=ua("panels/setNotificationProperty"),R$=ne({mixins:[tt],components:{Toggle:wt,ObjectTool:en},data:()=>({textEditor:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="notification")return e},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.text,set:e=>{this.text=e},leave:()=>{this.textEditor=!1}}},text:vi("text"),autoWrap:vi("autoWrap"),renderBackdrop:vi("backdrop")}});const F$=e=>(He("data-v-cd3c38a2"),e=e(),Me(),e),L$={id:"notification_text_wrapper"},N$=F$(()=>u("label",{for:"notification_text"},"Text:",-1));function W$(e,t,o,n,s,i){const r=M("toggle"),a=M("object-tool");return m(),z(a,{object:e.object,title:"Notification",textHandler:e.textHandler},{default:E(()=>[u("div",L$,[N$,de(u("textarea",{"onUpdate:modelValue":t[0]||(t[0]=l=>e.text=l),id:"notification_text",onKeydown:t[1]||(t[1]=q(()=>{},["stop"]))},null,544),[[je,e.text]]),u("button",{onClick:t[2]||(t[2]=l=>e.textEditor=!0)},"Formatting")])]),options:E(()=>[$(r,{modelValue:e.renderBackdrop,"onUpdate:modelValue":t[3]||(t[3]=l=>e.renderBackdrop=l),label:"Show backdrop?"},null,8,["modelValue"])]),_:1},8,["object","textHandler"])}const V$=se(R$,[["render",W$],["__scopeId","data-v-cd3c38a2"]]),ts=ua("panels/setPoemProperty"),z$=ne({mixins:[tt],components:{Toggle:wt,ObjectTool:en},data:()=>({textEditor:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},backgrounds(){return sc},poemTextStyles(){return ic},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="poem")return e},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.text,set:e=>{this.text=e},leave:()=>{this.textEditor=!1}}},text:ts("text"),autoWrap:ts("autoWrap"),poemStyle:ts("font"),poemBackground:ts("background")}});const U$=e=>(He("data-v-47525611"),e=e(),Me(),e),G$={id:"poem_text"},X$=U$(()=>u("label",{for:"poem_text"},"Text:",-1)),q$=["value"],Y$=["value"];function K$(e,t,o,n,s,i){const r=M("toggle"),a=M("object-tool");return m(),z(a,{object:e.object,title:e.object.subType==="poem"?"Poem":"Console",textHandler:e.textHandler},{default:E(()=>[u("div",G$,[X$,de(u("textarea",{"onUpdate:modelValue":t[0]||(t[0]=l=>e.text=l),onKeydown:t[1]||(t[1]=q(()=>{},["stop"]))},null,544),[[je,e.text]]),u("button",{onClick:t[2]||(t[2]=l=>e.textEditor=!0)},"Formatting")]),$(r,{label:"Auto line wrap?",modelValue:e.autoWrap,"onUpdate:modelValue":t[3]||(t[3]=l=>e.autoWrap=l)},null,8,["modelValue"]),e.object.subType==="poem"?(m(),C(N,{key:0},[de(u("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>e.poemBackground=l),onKeydown:t[5]||(t[5]=q(()=>{},["stop"]))},[(m(!0),C(N,null,$e(e.backgrounds,(l,d)=>(m(),C("option",{value:d,key:d},he(l.name),9,q$))),128))],544),[[lt,e.poemBackground]]),de(u("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>e.poemStyle=l),onKeydown:t[7]||(t[7]=q(()=>{},["stop"]))},[(m(!0),C(N,null,$e(e.poemTextStyles,(l,d)=>(m(),C("option",{value:d,key:d},he(l.name),9,Y$))),128))],544),[[lt,e.poemStyle]])],64)):X("",!0)]),_:1},8,["object","title","textHandler"])}const J$=se(z$,[["render",K$],["__scopeId","data-v-47525611"]]),Z$={a:"add",s:"backgrounds",d:"panels",f:"settings"},Q$=ne({components:{SettingsPanel:sg,AddPanel:Tg,BackgroundsPanel:N1,CreditsPanel:u1,CharacterPanel:k0,TextBoxPanel:iC,ChoicePanel:hC,SpritePanel:x0,PanelsPanel:M$,NotificationPanel:V$,PoemPanel:J$},data:()=>({panelSelection:"add"}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},vertical(){return this.$store.state.ui.vertical},selection(){return this.$store.state.ui.selection},panel(){if(this.panelSelection==="selection")if(this.selection===null)this.panelSelection="add";else return this.currentPanel.objects[this.selection].type;return this.panelSelection},hasPrevRender(){return this.$store.state.ui.lastDownload!==null}},methods:{setPanel(e){e===this.panelSelection&&(e="add"),this.panelSelection=e,this.selection!==null&&this.$store.commit("ui/setSelection",null)},resetScroll(){console.log("resetting scrolls"),this.$refs.panels instanceof HTMLElement&&(this.$refs.panels.scrollTop=0,this.$refs.panels.scrollLeft=0)},onKeydown(e){if(e.ctrlKey){const t=Z$[e.key];t&&(this.setPanel(t),e.preventDefault(),e.stopPropagation())}}},watch:{selection(e){if(e!=null){this.panelSelection="selection";return}this.panelSelection==="selection"&&(this.panelSelection="add")}},created(){ee.onPanelChange(e=>{this.panelSelection=e}),window.removeEventListener("keydown",this.onKeydown),window.addEventListener("keydown",this.onKeydown)}});const ek={id:"toolbar"},tk=u("i",{class:"material-icons","aria-hidden":"true"},"add_box",-1),ok=u("div",{class:"shortcut-popup"},"A",-1),nk=[tk,ok],sk=u("i",{class:"material-icons","aria-hidden":"true"},"panorama",-1),ik=u("div",{class:"shortcut-popup"},"S",-1),rk=[sk,ik],ak=u("i",{class:"material-icons","aria-hidden":"true"},"view_module",-1),lk=u("div",{class:"shortcut-popup"},"D",-1),dk=[ak,lk],ck=u("i",{class:"material-icons","aria-hidden":"true"},"settings_applications",-1),uk=u("div",{class:"shortcut-popup"},"F",-1),fk=[ck,uk],hk={id:"toolbar-end"},pk=u("i",{class:"material-icons","aria-hidden":"true"},"help",-1),gk=[pk],mk=u("i",{class:"material-icons","aria-hidden":"true"},"extension",-1),bk=[mk],yk=["disabled"],vk=u("i",{class:"material-icons","aria-hidden":"true"},"flip_to_back",-1),wk=[vk],Ck=u("i",{class:"material-icons","aria-hidden":"true"},"photo_camera",-1),$k=[Ck];function kk(e,t,o,n,s,i){const r=M("settings-panel"),a=M("backgrounds-panel"),l=M("credits-panel"),d=M("character-panel"),c=M("sprite-panel"),f=M("text-box-panel"),h=M("choice-panel"),b=M("panels-panel"),y=M("notification-panel"),k=M("poem-panel"),T=M("add-panel");return m(),C("div",{id:"panels",class:le({vertical:e.vertical}),onScroll:t[12]||(t[12]=(...D)=>e.resetScroll&&e.resetScroll(...D)),ref:"panels"},[u("div",ek,[u("button",{class:le({active:e.panel==="add"}),onClick:t[0]||(t[0]=D=>e.setPanel("add")),title:"Add new objects to the scene","aria-label":"Add new objects to the scene"},nk,2),u("button",{class:le({active:e.panel==="backgrounds"}),onClick:t[1]||(t[1]=D=>e.setPanel("backgrounds")),"aria-label":"Change the current background",title:"Change the current background"},rk,2),u("button",{class:le({active:e.panel==="panels"}),title:"Panels","aria-label":"Panels",onClick:t[2]||(t[2]=D=>e.setPanel("panels"))},dk,2),u("button",{class:le({active:e.panel==="settings"}),title:"Settings","aria-label":"Settings",onClick:t[3]||(t[3]=D=>e.setPanel("settings"))},fk,2)]),e.panel==="settings"?(m(),z(r,{key:0})):e.panel==="backgrounds"?(m(),z(a,{key:1,onShowDialog:t[4]||(t[4]=D=>e.$emit("show-dialog",D))})):e.panel==="help_credits"?(m(),z(l,{key:2})):e.panel==="character"?(m(),z(d,{key:3,onShowDialog:t[5]||(t[5]=D=>e.$emit("show-dialog",D)),onShowExpressionDialog:t[6]||(t[6]=D=>e.$emit("show-expression-dialog",D))})):e.panel==="sprite"?(m(),z(c,{key:4})):e.panel==="textBox"?(m(),z(f,{key:5})):e.panel==="choice"?(m(),z(h,{key:6})):e.panel==="panels"?(m(),z(b,{key:7})):e.panel==="notification"?(m(),z(y,{key:8})):e.panel==="poem"?(m(),z(k,{key:9})):(m(),z(T,{key:10,onShowDialog:t[7]||(t[7]=D=>e.$emit("show-dialog",D))})),u("div",hk,[u("button",{class:le({active:e.panel==="help_credits"}),onClick:t[8]||(t[8]=D=>e.setPanel("help_credits")),title:"Help & Credits","aria-label":"Help & Credits"},gk,2),u("button",{class:le({active:e.panel==="packs"}),onClick:t[9]||(t[9]=D=>e.$emit("show-dialog")),title:"Content packs","aria-label":"Content packs"},bk,2),u("button",{onClick:t[10]||(t[10]=D=>e.$emit("show-prev-render")),title:"Show last downloaded panel","aria-label":"Show last downloaded panel",disabled:!e.hasPrevRender},wk,8,yk),u("button",{title:"Take a screenshot of the current scene","aria-label":"Take a screenshot of the current scene",onClick:t[11]||(t[11]=D=>e.$emit("download"))},$k)])],34)}const _k=se(Q$,[["render",kk]]),Sk=5e3,wi=2e4,Ol=100,xk=ne({props:{loading:{default:!1,type:Boolean}},data:()=>({messages:[],errors:[],resolvableErrors:[],showLoading:!1,showLoadingTimeout:0,hideLoadingTimeout:0}),computed:{vertical(){return this.$store.state.ui.vertical}},created(){this.onLoadingChange(this.loading),we.subscribe(ys,e=>{this.messages.push(`Failed to load asset '${e.path}'`),setTimeout(()=>{this.messages.shift()},Sk)}),we.subscribe(Fr,e=>{this.messages.push("Failed to load custom asset. Try to download it manually and then upload it."),setTimeout(()=>{this.messages.shift()},wi)}),we.subscribe(Rr,e=>{this.errors.push(e.message)}),we.subscribe(Nr,e=>{this.resolvableErrors.push(e)}),we.subscribe(it,e=>{this.messages.push(e.message),setTimeout(()=>{this.messages.shift()},wi)}),we.subscribe(Ld,e=>{this.messages.push(e.error.name),this.messages.push(JSON.stringify(e.error.stack)),this.messages.push(e.info),setTimeout(()=>{this.messages.shift(),this.messages.shift(),this.messages.shift()},wi)})},methods:{onLoadingChange(e){e?(this.hideLoadingTimeout&&(clearTimeout(this.hideLoadingTimeout),this.hideLoadingTimeout=0),!this.showLoading&&!this.showLoadingTimeout&&(this.showLoadingTimeout=setTimeout(()=>{this.showLoading=!0,this.showLoadingTimeout=0},Ol))):(this.showLoadingTimeout&&(clearTimeout(this.showLoadingTimeout),this.showLoadingTimeout=0),this.showLoading&&!this.hideLoadingTimeout&&(this.hideLoadingTimeout=setTimeout(()=>{this.showLoading=!1,this.hideLoadingTimeout=0},Ol)))},dismissError(e){this.errors.splice(e,1)},async resolvableAction(e,t){const o=this.resolvableErrors[e];this.resolvableErrors.splice(e,1),await o.actions.find(s=>s.name===t).exec()}},watch:{loading(e){this.onLoadingChange(e)}}});const Pk={key:0},jk=["onClick"],Ik=["onClick"];function Tk(e,t,o,n,s,i){return m(),C("div",{id:"messageConsole",class:le({vertical:e.vertical})},[e.showLoading?(m(),C("p",Pk,"Loading...")):X("",!0),(m(!0),C(N,null,$e(e.messages,(r,a)=>(m(),C("p",{key:r+"_"+a},he(r),1))),128)),(m(!0),C(N,null,$e(e.resolvableErrors,(r,a)=>(m(),C("p",{class:"error",key:"resolvableError_"+a},[j(he(r.message)+" ",1),(m(!0),C(N,null,$e(r.actions,l=>(m(),C("a",{href:"#",key:"resolvableError_"+a+l.name,onClick:d=>e.resolvableAction(a,l.name)},"["+he(l.name)+"]",9,jk))),128))]))),128)),(m(!0),C(N,null,$e(e.errors,(r,a)=>(m(),C("p",{class:"error",key:"error_"+a},[j(he(r)+" ",1),u("a",{href:"#",onClick:l=>e.dismissError(a)},"[Dismiss]",8,Ik)]))),128))],2)}const Ok=se(xk,[["render",Tk],["__scopeId","data-v-935b4cd3"]]),Bk=ne({props:{canvasWidth:{default:0},canvasHeight:{default:0},preLoading:{type:Boolean}},data:()=>({sdCtx:null,currentlyRendering:!1,queuedRender:null,showingLast:!1,dropSpriteCount:0,dropPreventClick:!1,draggedObject:null,dragXOffset:0,dragYOffset:0,dragXOriginal:0,dragYOriginal:0}),computed:{selection(){var e;return(e=this.$store.state.ui.selection)!=null?e:null},currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},lqRendering(){return this.$store.state.ui.lqRendering},sceneRender(){return new Fo(this.$store,this.$store.state.panels.currentPanel,this.bitmapWidth,this.bitmapHeight)},bitmapHeight(){return this.preLoading,Y().Base.screenHeight},bitmapWidth(){return this.preLoading,Y().Base.screenWidth},pickerMode(){return this.$store.state.ui.pickColor},cursor(){return this.pickerMode?"crosshair":"default"}},methods:{async download(){const e=await this.sceneRender.download();await this.vuexHistory.transaction(async()=>{const t=this.$store.state.ui.lastDownload;this.$store.commit("ui/setLastDownload",e),t!=null&&URL.revokeObjectURL(t)})},invalidateRender(){this.queuedRender==null&&(this.queuedRender=requestAnimationFrame(()=>this.render_()))},async render_(){this.queuedRender!=null&&(cancelAnimationFrame(this.queuedRender),this.queuedRender=null),!this.$store.state.unsafe&&(await this.sceneRender.render(!this.lqRendering,!0),this.display())},renderLoadingScreen(){const e=document.createElement("canvas");e.height=this.bitmapHeight,e.width=this.bitmapWidth,Uo.make(e,!0,!1).drawText({text:"Starting...",x:e.width/2,y:e.height/2,align:"center",outline:{width:5,style:"#b59"},font:"32px riffic",fill:{style:"white"}}),this.sdCtx.drawImage(e,this.canvasWidth,this.canvasHeight)},display(){this.showingLast=!1,this.sceneRender.paintOnto(this.sdCtx,{x:0,y:0,w:this.bitmapWidth,h:this.bitmapHeight})},toRendererCoordinate(e,t){const o=this.$refs.sd,n=e-o.offsetLeft,s=t-o.offsetTop,i=n/o.offsetWidth*o.width,r=s/o.offsetWidth*o.width;return[i,r]},onUiClick(e){var r;const[t,o]=this.toRendererCoordinate(e.clientX,e.clientY);if(this.pickerMode){const a=this.sdCtx.getImageData(t,o,1,1).data,l=`rgba(${a[0].toString()},${a[1].toString()},${a[2].toString()},${(a[3]/255).toString()})`;this.vuexHistory.transaction(()=>{this.$store.commit("ui/setColorPicker",!1),we.fire(new vs(l))});return}if(this.dropPreventClick){this.dropPreventClick=!1;return}const n=this.sceneRender.objectsAt(t,o),s=n.findIndex(a=>a===this.selection);let i;s===0?i=null:s!==-1?i=n[s-1]:i=(r=n[n.length-1])!=null?r:null,this.$store.state.ui.selection!==i&&this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",i)})},onDragStart(e){if(e.preventDefault(),this.selection===null)return;this.draggedObject=this.currentPanel.objects[this.selection];const[t,o]=this.toRendererCoordinate(e.clientX,e.clientY);this.dragXOffset=t-this.draggedObject.x,this.dragYOffset=o-this.draggedObject.y,this.dragXOriginal=this.draggedObject.x,this.dragYOriginal=this.draggedObject.y},onTouchStart(e){if(this.selection===null)return;this.draggedObject=this.currentPanel.objects[this.selection];const[t,o]=this.toRendererCoordinate(e.touches[0].clientX,e.touches[0].clientY);this.dragXOffset=t-this.draggedObject.x,this.dragYOffset=o-this.draggedObject.y,this.dragXOriginal=this.draggedObject.x,this.dragYOriginal=this.draggedObject.y},onDragOver(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},onSpriteDragMove(e){if(!this.draggedObject)return;e.preventDefault();let[t,o]=e instanceof MouseEvent?this.toRendererCoordinate(e.clientX,e.clientY):this.toRendererCoordinate(e.touches[0].clientX,e.touches[0].clientY);t-=this.dragXOffset,o-=this.dragYOffset;const n=Math.abs(t-this.dragXOriginal),s=Math.abs(o-this.dragYOriginal);n+s>1&&(this.dropPreventClick=!0),e.shiftKey&&(n>s?o=this.dragYOriginal:t=this.dragXOriginal),this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPosition",{panelId:this.draggedObject.panelId,id:this.draggedObject.id,x:t,y:o})})},async onDrop(e){if(e.stopPropagation(),e.preventDefault(),!!e.dataTransfer){for(const t of e.dataTransfer.items)if(t.kind==="file"&&t.type.match(/image.*/)){const o="dropCustomAsset"+ ++this.dropSpriteCount,n=cp(o,t.getAsFile());await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createSprite",{assets:[{hq:n,lq:n,sourcePack:"dddg.generated.uploaded-sprites"}]})})}}},onSpriteDrop(e){this.draggedObject&&("TouchEvent"in window&&e instanceof TouchEvent&&(this.dropPreventClick=!1),this.draggedObject=null)},onMouseEnter(e){e.buttons!==1&&(this.draggedObject=null)}},watch:{canvasWidth(){this.display()},canvasHeight(){this.display()}},async created(){we.subscribe(Lr,()=>this.invalidateRender()),this.$store.subscribe(e=>{e.type!=="panels/setPanelPreview"&&e.type!=="panels/currentPanel"&&this.invalidateRender()})},mounted(){const e=this.$refs.sd;this.sdCtx=e.getContext("2d"),this.renderLoadingScreen(),this.invalidateRender()}});const Ak=["height","width"];function Ek(e,t,o,n,s,i){return m(),C("canvas",{id:"scaled_display",ref:"sd",height:e.bitmapHeight,width:e.bitmapWidth,style:Ae({width:e.canvasWidth+"px",height:e.canvasHeight+"px",cursor:e.cursor}),draggable:"true",onClick:t[0]||(t[0]=(...r)=>e.onUiClick&&e.onUiClick(...r)),onTouchstart:t[1]||(t[1]=(...r)=>e.onTouchStart&&e.onTouchStart(...r)),onDragstart:t[2]||(t[2]=(...r)=>e.onDragStart&&e.onDragStart(...r)),onTouchmove:t[3]||(t[3]=(...r)=>e.onSpriteDragMove&&e.onSpriteDragMove(...r)),onMousemove:t[4]||(t[4]=(...r)=>e.onSpriteDragMove&&e.onSpriteDragMove(...r)),onTouchend:t[5]||(t[5]=(...r)=>e.onSpriteDrop&&e.onSpriteDrop(...r)),onMouseup:t[6]||(t[6]=(...r)=>e.onSpriteDrop&&e.onSpriteDrop(...r)),onDragover:t[7]||(t[7]=(...r)=>e.onDragOver&&e.onDragOver(...r)),onDrop:t[8]||(t[8]=(...r)=>e.onDrop&&e.onDrop(...r)),onMouseenter:t[9]||(t[9]=(...r)=>e.onMouseEnter&&e.onMouseEnter(...r)),onContextmenu:t[10]||(t[10]=q(()=>{},["prevent"]))},"HTML5 is required to use the Doki Doki Dialog Generator. ",44,Ak)}const Dk=se(Bk,[["render",Ek]]),Bl=16/9,os=20,Hk=50,Mk=200,Le="./",Lc={"dddg.buildin.backgrounds.nsfw":`${Le}packs/buildin.base.backgrounds.nsfw.json`,"dddg.buildin.sayori.nsfw":`${Le}packs/buildin.base.sayori.nsfw.json`,"dddg.buildin.base.natsuki.nsfw":`${Le}packs/buildin.base.natsuki.nsfw.json`,"dddg.buildin.yuri.nsfw":`${Le}packs/buildin.base.yuri.nsfw.json`},Rk=new Set(Object.keys(Lc)),Fk=Object.values(Lc),Lk=ne({components:{ToolBox:_k,MessageConsole:Ok,Render:Dk,ModalDialog:zr,SingleBox:Da(()=>ul(()=>import("./SingleBox.9cf382c7.js"),["SingleBox.9cf382c7.js","SingleBox.88c268b6.css"],import.meta.url)),ExpressionBuilder:Da(()=>ul(()=>import("./index.f2ef4965.js"),["index.f2ef4965.js","index.a7c7b885.css"],import.meta.url))},data:()=>({canvasWidth:0,canvasHeight:0,blendOver:null,uiSize:192,currentlyRendering:!1,panel:"",dialogVisable:!1,canvasTooSmall:!1,expressionBuilderVisible:!1,expressionBuilderCharacter:"",expressionBuilderHeadGroup:void 0,systemPrefersDarkMode:!1,preLoading:!0,classes:new Set,classTimeout:null,queuedRerender:null}),computed:{isSafari(){return!1},useDarkTheme(){var e;return(e=this.userPrefersDarkMode)!=null?e:this.systemPrefersDarkMode},userPrefersDarkMode(){return this.$store.state.ui.useDarkTheme},nsfw(){return this.$store.state.ui.nsfw},objects(){const e=this.$store.state.panels,t=e.panels[e.currentPanel];return t==null?[]:[...t.order,...t.onTopOrder]}},methods:{drawLastDownload(){const e=this.$store.state.ui.lastDownload;e!=null&&this.$refs.render.blendOver(e)},setBlendOver(){this.blendOver=this.$store.state.ui.lastDownload},optimum(e,t){let o=e/Bl,n=t*Bl;return o>t?o=t:n=e,[n,o]},optimizeWithMenu(e,t){const o=this.optimum(e,t-this.uiSize),n=this.optimum(e-this.uiSize,t);return!this.isSafari&&o[0]*o[1]>n[0]*n[1]?[o[0],o[1],!1]:[n[0],n[1],!0]},updateArea(){const[e,t,o]=this.optimizeWithMenu(document.documentElement.clientWidth,document.documentElement.clientHeight);this.canvasWidth=e,this.canvasHeight=t,this.canvasTooSmall=Math.max(e,t)<Mk,this.$store.state.ui.vertical!==o&&this.$store.commit("ui/setVertical",o)},showDialog(e){if(this.dialogVisable=!0,e==null)return;const t=()=>{this.$refs.packDialog?this.$refs.packDialog.setSearch(e):setTimeout(t,Hk)};this.$nextTick(t)},showExpressionDialog(e){this.expressionBuilderVisible=!0,this.expressionBuilderCharacter=e.character,this.expressionBuilderHeadGroup=e.headGroup},rerender(){this.queuedRerender==null&&(this.queuedRerender=requestAnimationFrame(()=>{this.queuedRerender=null,we.fire(new Lr)}))},onKeydown(e){if(e.key==="Control"){this.classTimeout===null&&(this.classTimeout=setTimeout(()=>{this.classTimeout=null,this.classes.add("ctrl-key")},500));return}if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement){console.log("skip keydown on potential target");return}this.vuexHistory.transaction(()=>{if(e.ctrlKey){if(e.key==="z"){e.preventDefault();return}else if(e.key==="y"){e.preventDefault();return}else if(e.key==="v"){this.$store.dispatch("panels/pasteObjectFromClipboard",{}),e.preventDefault();return}}const o=this.$store.state.panels.panels[this.$store.state.panels.currentPanel].objects[this.$store.state.ui.selection];if(o==null)return;if(e.key==="Delete"){this.$store.dispatch("panels/removeObject",{id:o.id,panelId:o.panelId});return}if(e.key==="c"||e.key==="x"){this.$store.dispatch("panels/copyObjectToClipboard",{id:o.id,panelId:o.panelId}),e.key==="x"&&this.$store.dispatch("panels/removeObject",{id:o.id,panelId:o.panelId}),e.preventDefault();return}if(o.type==="character"){const i=o;if(!i.freeMove){if(e.key==="ArrowLeft"){this.$store.dispatch("panels/shiftCharacterSlot",{id:i.id,panelId:i.panelId,delta:-1});return}if(e.key==="ArrowRight"){this.$store.dispatch("panels/shiftCharacterSlot",{id:i.id,panelId:i.panelId,delta:1});return}}}let{x:n,y:s}=o;if(e.key==="ArrowLeft")n-=e.shiftKey?1:os;else if(e.key==="ArrowRight")n+=e.shiftKey?1:os;else if(e.key==="ArrowUp")s-=e.shiftKey?1:os;else if(e.key==="ArrowDown")s+=e.shiftKey?1:os;else return;this.$store.dispatch("panels/setPosition",{id:o.id,panelId:o.panelId,x:n,y:s})})},onKeyup(e){if(e.key==="Control"){this.classTimeout!=null&&clearTimeout(this.classTimeout),this.classTimeout=null,this.classes.delete("ctrl-key");return}},applyTheme(){document.body.classList.toggle("dark-theme",this.useDarkTheme)},select(e){this.$store.state.ui.selection!==e&&this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",e)})}},watch:{systemPrefersDarkMode(){this.applyTheme()},userPrefersDarkMode(){this.applyTheme()},async nsfw(e){e?await this.$store.dispatch("content/loadContentPacks",Fk):await this.$store.dispatch("removePacks",{packs:Rk})}},mounted(){if(window.addEventListener("keypress",e=>{e.key==="Escape"&&this.vuexHistory.transaction(()=>{this.$store.state.ui.selection!==null&&this.$store.commit("ui/setSelection",null)})}),window.addEventListener("resize",this.updateArea),window.removeEventListener("keydown",this.onKeydown),window.addEventListener("keydown",this.onKeydown),window.addEventListener("keyup",this.onKeyup),window.matchMedia!=null){const e=window.matchMedia("(prefers-color-scheme: dark)");this.systemPrefersDarkMode=e.matches,e.addListener(t=>{this.systemPrefersDarkMode=t.matches})}},async created(){this.updateArea(),Ot.setStore(this.$store),window.app=this,window.store=this.$store,window.env=ee,go(()=>this.$store.state.ui.selection,t=>{var o,n;((o=document.activeElement)==null?void 0:o.getAttribute("data-obj-id"))!==""+t&&((n=document.querySelector(`*[data-obj-id='${t}']`))==null||n.focus({focusVisible:!1,preventScroll:!0}))}),document.body.addEventListener("drop",t=>{t.preventDefault()},!0),document.body.addEventListener("dragover",t=>{t.preventDefault()},!0),await ee.loadGameMode(),this.preLoading=!1,ee.connectToStore(this.vuexHistory,this.$store);const e=await ee.loadSettings();await this.vuexHistory.transaction(async()=>{var o,n,s,i;ee.state.looseTextParsing=e.looseTextParsing||!0,this.$store.commit("ui/setLqRendering",(o=e.lq)!=null?o:!1),this.$store.commit("ui/setDarkTheme",(n=e.darkMode)!=null?n:null),this.$store.commit("ui/setDefaultCharacterTalkingZoom",(s=e.defaultCharacterTalkingZoom)!=null?s:!0),await this.$store.dispatch("content/loadContentPacks",[`${Le}packs/buildin.base.backgrounds.json`,`${Le}packs/buildin.base.monika.json`,`${Le}packs/buildin.base.sayori.json`,`${Le}packs/buildin.base.natsuki.json`,`${Le}packs/buildin.base.yuri.json`,`${Le}packs/buildin.extra.mc.json`,`${Le}packs/buildin.extra.concept_mc.json`,`${Le}packs/buildin.extra.mc_chad.json`,`${Le}packs/buildin.extra.femc.json`,`${Le}packs/buildin.extra.concept_femc.json`,`${Le}packs/buildin.extra.amy.json`]),await ee.loadContentPacks();const t=await this.$store.dispatch("panels/createPanel");Object.keys(this.$store.state.panels.panels[t].objects).length===0&&await this.$store.dispatch("panels/createTextBox",{panelId:t,text:`Hi! Click here to edit this textbox! ${this.$store.state.ui.vertical?"To the right":"At the bottom"} you find the toolbox. There you can add things (try clicking the chibis), change backgrounds and more!`}),await this.$store.commit("panels/setCurrentBackground",{current:"dddg.buildin.backgrounds:ddlc.clubroom",panelId:this.$store.state.panels.currentPanel}),await this.$store.commit("ui/setNsfw",(i=e.nsfw)!=null?i:!1)})},unmounted(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("keyup",this.onKeyup)}});const Nk={key:0},Wk={class:"hidden-selectors"},Vk=["data-obj-id","onKeydown"],zk={id:"container"},Uk=u("div",{id:"modal-messages"},null,-1);function Gk(e,t,o,n,s,i){const r=M("render"),a=M("message-console"),l=M("tool-box"),d=M("single-box"),c=M("modal-dialog"),f=M("expression-builder");return m(),C(N,null,[e.canvasTooSmall&&e.isSafari?(m(),C("div",Nk," Protrait mode is not supported by safari. Please turn the device sideways. ")):(m(),C("div",{key:1,id:"app",class:le(Array.from(e.classes))},[u("div",Wk,[(m(!0),C(N,null,$e(e.objects,h=>(m(),C("div",{key:h,tabindex:"0","data-obj-id":h,onFocus:t[0]||(t[0]=b=>e.rerender()),onBlur:t[1]||(t[1]=b=>e.rerender()),onKeydown:[Ke(q(b=>e.select(h),["prevent"]),["enter"]),Ke(q(b=>e.select(h),["prevent"]),["space"])]},null,40,Vk))),128))]),u("div",zk,[$(r,{ref:"render",canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,preLoading:e.preLoading},null,8,["canvasWidth","canvasHeight","preLoading"])]),$(a),$(l,{onShowPrevRender:e.drawLastDownload,onDownload:t[2]||(t[2]=h=>e.$refs.render.download()),onShowDialog:e.showDialog,onShowExpressionDialog:e.showExpressionDialog},null,8,["onShowPrevRender","onShowDialog","onShowExpressionDialog"]),(m(),z(wf,null,[e.dialogVisable?(m(),z(c,{key:0,ref:"dialog",onLeave:t[4]||(t[4]=h=>e.dialogVisable=!1)},{default:E(()=>[$(d,{ref:"packDialog",onLeave:t[3]||(t[3]=h=>e.dialogVisable=!1)},null,512)]),_:1},512)):X("",!0)],1024)),e.expressionBuilderVisible?(m(),z(c,{key:0,ref:"dialog",onLeave:t[6]||(t[6]=h=>e.expressionBuilderVisible=!1)},{default:E(()=>[$(f,{character:e.expressionBuilderCharacter,initHeadGroup:e.expressionBuilderHeadGroup,onLeave:t[5]||(t[5]=h=>e.expressionBuilderVisible=!1)},null,8,["character","initHeadGroup"])]),_:1},512)):X("",!0)],2)),Uk],64)}const Xk=se(Lk,[["render",Gk]]);function qk(){return Nc().__VUE_DEVTOOLS_GLOBAL_HOOK__}function Nc(){return typeof navigator<"u"&&typeof window<"u"?window:typeof global<"u"?global:{}}const Yk=typeof Proxy=="function",Kk="devtools-plugin:setup",Jk="plugin:settings:set";class Zk{constructor(t,o){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=t,this.hook=o;const n={};if(t.settings)for(const r in t.settings){const a=t.settings[r];n[r]=a.defaultValue}const s=`__vue-devtools-plugin-settings__${t.id}`;let i=Object.assign({},n);try{const r=localStorage.getItem(s),a=JSON.parse(r);Object.assign(i,a)}catch{}this.fallbacks={getSettings(){return i},setSettings(r){try{localStorage.setItem(s,JSON.stringify(r))}catch{}i=r}},o&&o.on(Jk,(r,a)=>{r===this.plugin.id&&this.fallbacks.setSettings(a)}),this.proxiedOn=new Proxy({},{get:(r,a)=>this.target?this.target.on[a]:(...l)=>{this.onQueue.push({method:a,args:l})}}),this.proxiedTarget=new Proxy({},{get:(r,a)=>this.target?this.target[a]:a==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(a)?(...l)=>(this.targetQueue.push({method:a,args:l,resolve:()=>{}}),this.fallbacks[a](...l)):(...l)=>new Promise(d=>{this.targetQueue.push({method:a,args:l,resolve:d})})})}async setRealTarget(t){this.target=t;for(const o of this.onQueue)this.target.on[o.method](...o.args);for(const o of this.targetQueue)o.resolve(await this.target[o.method](...o.args))}}function Qk(e,t){const o=Nc(),n=qk(),s=Yk&&e.enableEarlyProxy;if(n&&(o.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!s))n.emit(Kk,e,t);else{const i=s?new Zk(e,n):null;(o.__VUE_DEVTOOLS_PLUGINS__=o.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:e,setupFn:t,proxy:i}),i&&t(i.proxiedTarget)}}/*!
 * vuex v4.0.2
 * (c) 2021 Evan You
 * @license MIT
 */var e_="store";function tn(e,t){Object.keys(e).forEach(function(o){return t(e[o],o)})}function t_(e){return e!==null&&typeof e=="object"}function o_(e){return e&&typeof e.then=="function"}function n_(e,t){return function(){return e(t)}}function Wc(e,t,o){return t.indexOf(e)<0&&(o&&o.prepend?t.unshift(e):t.push(e)),function(){var n=t.indexOf(e);n>-1&&t.splice(n,1)}}function Vc(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var o=e.state;Js(e,o,[],e._modules.root,!0),pa(e,o,t)}function pa(e,t,o){var n=e._state;e.getters={},e._makeLocalGettersCache=Object.create(null);var s=e._wrappedGetters,i={};tn(s,function(r,a){i[a]=n_(r,e),Object.defineProperty(e.getters,a,{get:function(){return i[a]()},enumerable:!0})}),e._state=Dt({data:t}),e.strict&&l_(e),n&&o&&e._withCommit(function(){n.data=null})}function Js(e,t,o,n,s){var i=!o.length,r=e._modules.getNamespace(o);if(n.namespaced&&(e._modulesNamespaceMap[r],e._modulesNamespaceMap[r]=n),!i&&!s){var a=ga(t,o.slice(0,-1)),l=o[o.length-1];e._withCommit(function(){a[l]=n.state})}var d=n.context=s_(e,r,o);n.forEachMutation(function(c,f){var h=r+f;i_(e,h,c,d)}),n.forEachAction(function(c,f){var h=c.root?f:r+f,b=c.handler||c;r_(e,h,b,d)}),n.forEachGetter(function(c,f){var h=r+f;a_(e,h,c,d)}),n.forEachChild(function(c,f){Js(e,t,o.concat(f),c,s)})}function s_(e,t,o){var n=t==="",s={dispatch:n?e.dispatch:function(i,r,a){var l=xs(i,r,a),d=l.payload,c=l.options,f=l.type;return(!c||!c.root)&&(f=t+f),e.dispatch(f,d)},commit:n?e.commit:function(i,r,a){var l=xs(i,r,a),d=l.payload,c=l.options,f=l.type;(!c||!c.root)&&(f=t+f),e.commit(f,d,c)}};return Object.defineProperties(s,{getters:{get:n?function(){return e.getters}:function(){return zc(e,t)}},state:{get:function(){return ga(e.state,o)}}}),s}function zc(e,t){if(!e._makeLocalGettersCache[t]){var o={},n=t.length;Object.keys(e.getters).forEach(function(s){if(s.slice(0,n)===t){var i=s.slice(n);Object.defineProperty(o,i,{get:function(){return e.getters[s]},enumerable:!0})}}),e._makeLocalGettersCache[t]=o}return e._makeLocalGettersCache[t]}function i_(e,t,o,n){var s=e._mutations[t]||(e._mutations[t]=[]);s.push(function(r){o.call(e,n.state,r)})}function r_(e,t,o,n){var s=e._actions[t]||(e._actions[t]=[]);s.push(function(r){var a=o.call(e,{dispatch:n.dispatch,commit:n.commit,getters:n.getters,state:n.state,rootGetters:e.getters,rootState:e.state},r);return o_(a)||(a=Promise.resolve(a)),e._devtoolHook?a.catch(function(l){throw e._devtoolHook.emit("vuex:error",l),l}):a})}function a_(e,t,o,n){e._wrappedGetters[t]||(e._wrappedGetters[t]=function(i){return o(n.state,n.getters,i.state,i.getters)})}function l_(e){go(function(){return e._state.data},function(){},{deep:!0,flush:"sync"})}function ga(e,t){return t.reduce(function(o,n){return o[n]},e)}function xs(e,t,o){return t_(e)&&e.type&&(o=t,t=e,e=e.type),{type:e,payload:t,options:o}}var d_="vuex bindings",Al="vuex:mutations",Ci="vuex:actions",Po="vuex",c_=0;function u_(e,t){Qk({id:"org.vuejs.vuex",app:e,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[d_]},function(o){o.addTimelineLayer({id:Al,label:"Vuex Mutations",color:El}),o.addTimelineLayer({id:Ci,label:"Vuex Actions",color:El}),o.addInspector({id:Po,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),o.on.getInspectorTree(function(n){if(n.app===e&&n.inspectorId===Po)if(n.filter){var s=[];qc(s,t._modules.root,n.filter,""),n.rootNodes=s}else n.rootNodes=[Xc(t._modules.root,"")]}),o.on.getInspectorState(function(n){if(n.app===e&&n.inspectorId===Po){var s=n.nodeId;zc(t,s),n.state=p_(m_(t._modules,s),s==="root"?t.getters:t._makeLocalGettersCache,s)}}),o.on.editInspectorState(function(n){if(n.app===e&&n.inspectorId===Po){var s=n.nodeId,i=n.path;s!=="root"&&(i=s.split("/").filter(Boolean).concat(i)),t._withCommit(function(){n.set(t._state.data,i,n.state.value)})}}),t.subscribe(function(n,s){var i={};n.payload&&(i.payload=n.payload),i.state=s,o.notifyComponentUpdate(),o.sendInspectorTree(Po),o.sendInspectorState(Po),o.addTimelineEvent({layerId:Al,event:{time:Date.now(),title:n.type,data:i}})}),t.subscribeAction({before:function(n,s){var i={};n.payload&&(i.payload=n.payload),n._id=c_++,n._time=Date.now(),i.state=s,o.addTimelineEvent({layerId:Ci,event:{time:n._time,title:n.type,groupId:n._id,subtitle:"start",data:i}})},after:function(n,s){var i={},r=Date.now()-n._time;i.duration={_custom:{type:"duration",display:r+"ms",tooltip:"Action duration",value:r}},n.payload&&(i.payload=n.payload),i.state=s,o.addTimelineEvent({layerId:Ci,event:{time:Date.now(),title:n.type,groupId:n._id,subtitle:"end",data:i}})}})})}var El=8702998,f_=6710886,h_=16777215,Uc={label:"namespaced",textColor:h_,backgroundColor:f_};function Gc(e){return e&&e!=="root"?e.split("/").slice(-2,-1)[0]:"Root"}function Xc(e,t){return{id:t||"root",label:Gc(t),tags:e.namespaced?[Uc]:[],children:Object.keys(e._children).map(function(o){return Xc(e._children[o],t+o+"/")})}}function qc(e,t,o,n){n.includes(o)&&e.push({id:n||"root",label:n.endsWith("/")?n.slice(0,n.length-1):n||"Root",tags:t.namespaced?[Uc]:[]}),Object.keys(t._children).forEach(function(s){qc(e,t._children[s],o,n+s+"/")})}function p_(e,t,o){t=o==="root"?t:t[o];var n=Object.keys(t),s={state:Object.keys(e.state).map(function(r){return{key:r,editable:!0,value:e.state[r]}})};if(n.length){var i=g_(t);s.getters=Object.keys(i).map(function(r){return{key:r.endsWith("/")?Gc(r):r,editable:!1,value:sr(function(){return i[r]})}})}return s}function g_(e){var t={};return Object.keys(e).forEach(function(o){var n=o.split("/");if(n.length>1){var s=t,i=n.pop();n.forEach(function(r){s[r]||(s[r]={_custom:{value:{},display:r,tooltip:"Module",abstract:!0}}),s=s[r]._custom.value}),s[i]=sr(function(){return e[o]})}else t[o]=sr(function(){return e[o]})}),t}function m_(e,t){var o=t.split("/").filter(function(n){return n});return o.reduce(function(n,s,i){var r=n[s];if(!r)throw new Error('Missing module "'+s+'" for path "'+t+'".');return i===o.length-1?r:r._children},t==="root"?e:e.root._children)}function sr(e){try{return e()}catch(t){return t}}var ct=function(t,o){this.runtime=o,this._children=Object.create(null),this._rawModule=t;var n=t.state;this.state=(typeof n=="function"?n():n)||{}},Yc={namespaced:{configurable:!0}};Yc.namespaced.get=function(){return!!this._rawModule.namespaced};ct.prototype.addChild=function(t,o){this._children[t]=o};ct.prototype.removeChild=function(t){delete this._children[t]};ct.prototype.getChild=function(t){return this._children[t]};ct.prototype.hasChild=function(t){return t in this._children};ct.prototype.update=function(t){this._rawModule.namespaced=t.namespaced,t.actions&&(this._rawModule.actions=t.actions),t.mutations&&(this._rawModule.mutations=t.mutations),t.getters&&(this._rawModule.getters=t.getters)};ct.prototype.forEachChild=function(t){tn(this._children,t)};ct.prototype.forEachGetter=function(t){this._rawModule.getters&&tn(this._rawModule.getters,t)};ct.prototype.forEachAction=function(t){this._rawModule.actions&&tn(this._rawModule.actions,t)};ct.prototype.forEachMutation=function(t){this._rawModule.mutations&&tn(this._rawModule.mutations,t)};Object.defineProperties(ct.prototype,Yc);var wo=function(t){this.register([],t,!1)};wo.prototype.get=function(t){return t.reduce(function(o,n){return o.getChild(n)},this.root)};wo.prototype.getNamespace=function(t){var o=this.root;return t.reduce(function(n,s){return o=o.getChild(s),n+(o.namespaced?s+"/":"")},"")};wo.prototype.update=function(t){Kc([],this.root,t)};wo.prototype.register=function(t,o,n){var s=this;n===void 0&&(n=!0);var i=new ct(o,n);if(t.length===0)this.root=i;else{var r=this.get(t.slice(0,-1));r.addChild(t[t.length-1],i)}o.modules&&tn(o.modules,function(a,l){s.register(t.concat(l),a,n)})};wo.prototype.unregister=function(t){var o=this.get(t.slice(0,-1)),n=t[t.length-1],s=o.getChild(n);!s||!s.runtime||o.removeChild(n)};wo.prototype.isRegistered=function(t){var o=this.get(t.slice(0,-1)),n=t[t.length-1];return o?o.hasChild(n):!1};function Kc(e,t,o){if(t.update(o),o.modules)for(var n in o.modules){if(!t.getChild(n))return;Kc(e.concat(n),t.getChild(n),o.modules[n])}}function b_(e){return new Ve(e)}var Ve=function(t){var o=this;t===void 0&&(t={});var n=t.plugins;n===void 0&&(n=[]);var s=t.strict;s===void 0&&(s=!1);var i=t.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new wo(t),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._devtools=i;var r=this,a=this,l=a.dispatch,d=a.commit;this.dispatch=function(h,b){return l.call(r,h,b)},this.commit=function(h,b,y){return d.call(r,h,b,y)},this.strict=s;var c=this._modules.root.state;Js(this,c,[],this._modules.root),pa(this,c),n.forEach(function(f){return f(o)})},ma={state:{configurable:!0}};Ve.prototype.install=function(t,o){t.provide(o||e_,this),t.config.globalProperties.$store=this;var n=this._devtools!==void 0?this._devtools:!1;n&&u_(t,this)};ma.state.get=function(){return this._state.data};ma.state.set=function(e){};Ve.prototype.commit=function(t,o,n){var s=this,i=xs(t,o,n),r=i.type,a=i.payload,l={type:r,payload:a},d=this._mutations[r];!d||(this._withCommit(function(){d.forEach(function(f){f(a)})}),this._subscribers.slice().forEach(function(c){return c(l,s.state)}))};Ve.prototype.dispatch=function(t,o){var n=this,s=xs(t,o),i=s.type,r=s.payload,a={type:i,payload:r},l=this._actions[i];if(!!l){try{this._actionSubscribers.slice().filter(function(c){return c.before}).forEach(function(c){return c.before(a,n.state)})}catch{}var d=l.length>1?Promise.all(l.map(function(c){return c(r)})):l[0](r);return new Promise(function(c,f){d.then(function(h){try{n._actionSubscribers.filter(function(b){return b.after}).forEach(function(b){return b.after(a,n.state)})}catch{}c(h)},function(h){try{n._actionSubscribers.filter(function(b){return b.error}).forEach(function(b){return b.error(a,n.state,h)})}catch{}f(h)})})}};Ve.prototype.subscribe=function(t,o){return Wc(t,this._subscribers,o)};Ve.prototype.subscribeAction=function(t,o){var n=typeof t=="function"?{before:t}:t;return Wc(n,this._actionSubscribers,o)};Ve.prototype.watch=function(t,o,n){var s=this;return go(function(){return t(s.state,s.getters)},o,Object.assign({},n))};Ve.prototype.replaceState=function(t){var o=this;this._withCommit(function(){o._state.data=t})};Ve.prototype.registerModule=function(t,o,n){n===void 0&&(n={}),typeof t=="string"&&(t=[t]),this._modules.register(t,o),Js(this,this.state,t,this._modules.get(t),n.preserveState),pa(this,this.state)};Ve.prototype.unregisterModule=function(t){var o=this;typeof t=="string"&&(t=[t]),this._modules.unregister(t),this._withCommit(function(){var n=ga(o.state,t.slice(0,-1));delete n[t[t.length-1]]}),Vc(this)};Ve.prototype.hasModule=function(t){return typeof t=="string"&&(t=[t]),this._modules.isRegistered(t)};Ve.prototype.hotUpdate=function(t){this._modules.update(t),Vc(this,!0)};Ve.prototype._withCommit=function(t){var o=this._committing;this._committing=!0,t(),this._committing=o};Object.defineProperties(Ve.prototype,ma);const y_={namespaced:!0,state:{vertical:!1,lqRendering:!0,nsfw:!1,selection:null,lastDownload:null,clipboard:null,useDarkTheme:null,defaultCharacterTalkingZoom:!0,pickColor:!1},mutations:{setVertical(e,t){e.vertical=t},setNsfw(e,t){e.nsfw=t},setLqRendering(e,t){e.lqRendering=t},setSelection(e,t){e.selection=t},setLastDownload(e,t){e.lastDownload=t},setClipboard(e,t){e.clipboard=t},setDarkTheme(e,t){e.useDarkTheme=t},setDefaultCharacterTalkingZoom(e,t){e.defaultCharacterTalkingZoom=t},setColorPicker(e,t){e.pickColor=t}}};var Yt={},Ps=Ie&&Ie.__assign||function(){return Ps=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++){t=arguments[o];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Ps.apply(this,arguments)},Jc=Ie&&Ie.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,o=t&&e[t],n=0;if(o)return o.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},v_=Ie&&Ie.__read||function(e,t){var o=typeof Symbol=="function"&&e[Symbol.iterator];if(!o)return e;var n=o.call(e),s,i=[],r;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){r={error:a}}finally{try{s&&!s.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}return i},w_=Ie&&Ie.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(v_(arguments[t]));return e};Object.defineProperty(Yt,"__esModule",{value:!0});Yt.mapObject=Zc=Yt.assetWalker=ir=Yt.normalizePath=void 0;var C_=10;function $_(e,t,o,n){for(var s,i,r="",a=0,l=new Map(Array.from(t.entries()).map(function(h){return[new RegExp("{"+h[0]+"}","g"),h[1]]}));r!==e;){if(r=e,++a>C_)throw new Error("Maximum replacement recursion exceeded!");try{for(var d=(s=void 0,Jc(l.entries())),c=d.next();!c.done;c=d.next()){var f=c.value;e=e.replace(f[0],f[1])}}catch(h){s={error:h}}finally{try{c&&!c.done&&(i=d.return)&&i.call(d)}finally{if(s)throw s.error}}e=e.replace(/{format(:.*?:.*?)+}/gi,function(h){h=h.slice(8,-1);for(var b=h.split(":"),y=0;y<b.length;y+=2)if(o.has(b[y]))return b[y+1];return""}),e=e.replace(/{lq:(.*?):(.*?)}/gi,function(h){return h.slice(4,-1).split(":")[n?0:1]})}return e}var ir=Yt.normalizePath=$_;function k_(e,t){return{packId:e.packId,packCredits:e.packCredits,dependencies:e.dependencies,characters:e.characters.map(function(o){return __(o,t)}),backgrounds:e.backgrounds.map(function(o){return B_(o,t)}),fonts:e.fonts.map(function(o){return A_(o,t)}),poemStyles:w_(e.poemStyles),poemBackgrounds:e.poemBackgrounds.map(function(o){return E_(o,t)}),sprites:e.sprites.map(function(o){return D_(o,t)}),colors:e.colors}}var Zc=Yt.assetWalker=k_;function __(e,t){return{id:e.id,label:e.label,chibi:e.chibi?t(e.chibi,"image"):void 0,heads:T_(e.heads,t),styleGroups:e.styleGroups.map(function(o){return S_(o,t)}),defaultScale:e.defaultScale,hd:e.hd,size:e.size,sdVersion:e.sdVersion}}function S_(e,t){return{id:e.id,styleComponents:e.styleComponents.map(function(o){return P_(o,t)}),styles:e.styles.map(function(o){return x_(o,t)})}}function x_(e,t){return{components:e.components,poses:e.poses.map(function(o){return I_(o,t)})}}function P_(e,t){return Ps(Ps({},e),{variants:j_(e.variants,t)})}function j_(e,t){var o={};for(var n in e)!e.hasOwnProperty(n)||(o[n]=t(e[n],"image"));return o}function I_(e,t){var o,n,s={};try{for(var i=Jc(Object.keys(e.positions)),r=i.next();!r.done;r=i.next()){var a=r.value,l=e.positions[a];s[a]=l.map(function(d){return d.map(function(c){return t(c,"image")})})}}catch(d){o={error:d}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return{compatibleHeads:e.compatibleHeads,id:e.id,previewOffset:e.previewOffset,previewSize:e.previewSize,renderCommands:e.renderCommands.map(function(d){return d.type==="image"?{type:"image",offset:d.offset,images:d.images.map(function(c){return t(c,"image")})}:d}),size:e.size,scale:e.scale,positions:s}}function T_(e,t){var o={};for(var n in e)!e.hasOwnProperty(n)||(o[n]=O_(e[n],t));return o}function O_(e,t){return{previewOffset:e.previewOffset,previewSize:e.previewSize,variants:e.variants.map(function(o){return o.map(function(n){return t(n,"image")})})}}function B_(e,t){return{id:e.id,label:e.label,variants:e.variants.map(function(o){return o.map(function(n){return t(n,"image")})}),scaling:e.scaling,sdVersion:e.sdVersion}}function A_(e,t){return{id:e.id,label:e.label,files:e.files.map(function(o){return t(o,"font")})}}function E_(e,t){return{id:e.id,fontColor:e.fontColor,label:e.label,images:e.images.map(function(o){return t(o,"image")}),sdVersion:e.sdVersion}}function D_(e,t){return{id:e.id,label:e.label,variants:e.variants.map(function(o){return o.map(function(n){return t(n,"image")})}),defaultScale:e.defaultScale,hd:e.hd,sdVersion:e.sdVersion}}function H_(e,t){var o={};for(var n in e)!e.hasOwnProperty(n)||(o[n]=t(e[n],n));return o}Yt.mapObject=H_;var xe={},js=Ie&&Ie.__assign||function(){return js=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++){t=arguments[o];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},js.apply(this,arguments)};Object.defineProperty(xe,"__esModule",{value:!0});xe.expandId=xe.normalizeStyleComponent=xe.normalizeColor=xe.normalizeBackground=xe.normalizeFont=xe.normalizePoemBackground=xe.normalizePoemStyles=xe.normalizeSprite=xe.mapNormalize=Qc=xe.normalizeContentPack=void 0;var M_=Yt;function R_(e,t){var o={paths:t,packId:e.packId},n=We("",e.folder||"/",o);return{packId:e.packId,packCredits:e.packCredits,dependencies:e.dependencies||[],characters:ht(F_,e.characters,n,o),backgrounds:ht(su,e.backgrounds,n,o),fonts:ht(nu,e.fonts,n,o),poemStyles:ht(tu,e.poemStyles,n,o),poemBackgrounds:ht(ou,e.poemBackgrounds,n,o),sprites:ht(eu,e.sprites,n,o),colors:ht(iu,e.colors,n,o)}}var Qc=xe.normalizeContentPack=R_;function ht(e,t,o,n){return t?t.map(function(s){return e(s,o,n)}):[]}xe.mapNormalize=ht;function eu(e,t,o){var n,s=We(t,e.folder,o);return{id:dt(o.packId,e.id),label:e.label||e.variants[0][0],variants:e.variants.map(function(i){return Zs(i,s,o)}),defaultScale:e.defaultScale||[1,1],sdVersion:e.sdVersion,hd:(n=e.hd)!==null&&n!==void 0?n:null}}xe.normalizeSprite=eu;function tu(e){return{label:e.label,defaultFont:e.defaultFont||"Aller",fontSize:e.fontSize!==void 0?e.fontSize:30,letterSpacing:e.letterSpacing!==void 0?e.letterSpacing:1,lineSpacing:e.lineSpacing!==void 0?e.lineSpacing:1.2}}xe.normalizePoemStyles=tu;function ou(e,t,o){var n=We(t,e.folder,o);return{id:e.id,label:e.label,images:Zs(e.images,n,o),fontColor:e.fontColor||"black",sdVersion:e.sdVersion}}xe.normalizePoemBackground=ou;function nu(e,t,o){var n=We(t,e.folder,o);return{id:dt(o.packId,e.id?e.id:e.label?e.label:e.files[0]),label:e.label?e.label:e.id?e.id:e.files[0],files:Zs(e.files,n,o)}}xe.normalizeFont=nu;function su(e,t,o){var n,s=We(t,e.folder,o);return{id:dt(o.packId,e.id),label:e.label?e.label:e.variants[0][0],variants:e.variants.map(function(i){return Zs(i,s,o)}),scaling:["none","strech","cover"].includes((n=e.scaling)===null||n===void 0?void 0:n.toLowerCase())?e.scaling.toLowerCase():"cover",sdVersion:e.sdVersion}}xe.normalizeBackground=su;function iu(e){return{label:e.label||e.color,color:e.color}}xe.normalizeColor=iu;function Zs(e,t,o){return e.map(function(n){return We(t,n,o)})}function F_(e,t,o){var n,s,i,r=We(t,e.folder,o);return{id:dt(o.packId,e.id),label:e.label,chibi:e.chibi?We(r,e.chibi,o):void 0,heads:V_(e.heads,r,o),defaultScale:(n=e.defaultScale)!==null&&n!==void 0?n:[.8,.8],size:(s=e.size)!==null&&s!==void 0?s:[960,960],hd:(i=e.hd)!==null&&i!==void 0?i:!1,sdVersion:e.sdVersion,styleGroups:ht(L_,e.styleGroups,r,o)}}function L_(e,t,o){var n=We(t,e.folder,o);return{id:dt(o.packId,e.id),styleComponents:ht(ru,e.styleComponents,n,o),styles:e.styles.map(function(s){return N_(s,n,o)})}}function N_(e,t,o){var n=We(t,e.folder,o),s={};if(e.components)for(var i in e.components)!e.components.hasOwnProperty(i)||(s[dt(o.packId,i)]=e.components[i]);return{components:s,poses:e.poses.map(function(r){return z_(r,n,o)})}}function ru(e,t,o){return{id:dt(o.packId,e.id),label:e.label,variants:W_(e.variants,t,o)}}xe.normalizeStyleComponent=ru;function W_(e,t,o){if(!e)return{};var n={};for(var s in e)!e.hasOwnProperty(s)||(n[s]=We(t,e[s],o));return n}function V_(e,t,o){var n={};if(!e)return n;for(var s in e)if(!!e.hasOwnProperty(s)){var i=e[s],r=void 0;if(i instanceof Array)r={variants:rr(i,t,o),previewOffset:[290,70],previewSize:[380,380]};else{var a=We(t,i.folder,o);r={variants:rr(i.variants,a,o),previewOffset:i.previewOffset||[290,70],previewSize:i.previewSize||[380,380]}}n[dt(o.packId,s)]=r}return n}function z_(e,t,o){var n,s,i=We(t,e.folder,o);return{compatibleHeads:((n=e.compatibleHeads)===null||n===void 0?void 0:n.map(function(r){return dt(o.packId,r)}))||[],id:dt(o.packId,e.id),previewOffset:e.previewOffset||[0,0],previewSize:e.previewSize||[960,960],size:e.size||[960,960],scale:e.scale||.8,positions:M_.mapObject(e.positions||{},function(r){return rr(r,i,o)}),renderCommands:((s=e.renderCommands)===null||s===void 0?void 0:s.map(function(r){return U_(r,t,o)}))||[{type:"head",offset:[0,0]},{type:"pose-part",part:"Left",offset:[0,0]},{type:"pose-part",part:"Right",offset:[0,0]},{type:"pose-part",part:"Variant",offset:[0,0]}]}}function U_(e,t,o){if(e.type==="image"){var n=We(t,e.folder,o);return{type:"image",composite:e.composite,offset:e.offset||[0,0],images:au(e.images,n,o)}}else return js(js({},e),{offset:e.offset||[0,0]})}function rr(e,t,o){return e.map(function(n){return au(n,t,o)})}function au(e,t,o){return e.map(function(n){return We(t,n,o)})}function G_(e){return e.startsWith("blob:")||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("://")}function We(e,t,o){if(!t)return e;for(var n in o.paths)if(t.startsWith(n))return o.paths[n]+t.slice(n.length);return G_(t)?t:e+t}function dt(e,t){return t.indexOf(":")!==-1?t:e+":"+t}xe.expandId=dt;var Bn={},ds=Ie&&Ie.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,o=t&&e[t],n=0;if(o)return o.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},X_=Ie&&Ie.__read||function(e,t){var o=typeof Symbol=="function"&&e[Symbol.iterator];if(!o)return e;var n=o.call(e),s,i=[],r;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){r={error:a}}finally{try{s&&!s.done&&(o=n.return)&&o.call(n)}finally{if(r)throw r.error}}return i},$i=Ie&&Ie.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(X_(arguments[t]));return e};Object.defineProperty(Bn,"__esModule",{value:!0});Bn.expandOrTranslateId=lu=Bn.convert=void 0;var ar=xe;function q_(e,t,o){if(!e.packId)throw new Error("");return{packId:e.packId,packCredits:e.packCredits?[e.packCredits]:[],dependencies:Y_(e.id),backgrounds:[],fonts:[],poemStyles:[],poemBackgrounds:[],sprites:[],characters:[K_(e,t,o)],colors:[]}}var lu=Bn.convert=q_,du={"ddlc.monika":ft("dddg.buildin.base.monika","ddlc.monika",{heads:["straight","sideways"],poses:["normal","leaned","old","glitch"],styleGroups:["uniform","old","glitch"]}),"ddlc.natsuki":ft("dddg.buildin.base.natsuki","ddlc.natsuki",{heads:["straight","straight_nsfw","sideways","turnedAway"],poses:["normal","crossed_arms","vomit","glitch"],styleGroups:["uniform","casual","old"],extraPoseAssoc:[["normal_causal","normal"],["crossed_arms_casual","crossed_arms"]],extraHeadAssoc:[["straight_nsfw","straight"]]}),"ddlc.sayori":ft("dddg.buildin.sayori","ddlc.sayori",{heads:["straight","sideways"],poses:["normal","sideways","old","glitch","dead"],styleGroups:["uniform","casual","old","glitch","hanging"],extraPoseAssoc:[["normal_casual","normal"]]}),"ddlc.yuri":ft("dddg.buildin.yuri","ddlc.yuri",{heads:["straight","sideways"],poses:["normal","sideways","stabbing","glitching","dragon"],styleGroups:["uniform","casual","glitch"],extraPoseAssoc:[["normal_causal","normal"],["hairplay_casual","hairplay"]]}),"ddlc.fan.mc1":ft("dddg.buildin.mc_classic","ddlc.fan.mc1",{heads:["straight"],poses:["normal"],styleGroups:[],extraStyleGroupAssoc:[["uniform-yellow","uniform"]]}),"ddlc.fan.mc2":ft("dddg.buildin.mc","ddlc.fan.mc2",{heads:["straight","straight_red"],poses:["normal","crossed_arms","casual","glitching","dragon"],styleGroups:["uniform","casual"],extraPoseAssoc:[["crossed_arms_casual","crossed_arms"],["crossed_arms_red","crossed_arms"],["normal_red","normal"],["casual_red","casual"],["casual_crossed_arms_red","crossed_arms"]],defaultStyleComponents:[{id:"eyes",label:"Eyes",variants:{yellow:"/parts/mc/yellow-eyes{ext}",red:"/parts/mc/red-eyes{ext}"}}]}),"ddlc.fan.mc_chad":ft("dddg.buildin.mc_chad","ddlc.fan.mc_chad",{heads:["straight","straight_closed","straight_red"],poses:["normal","youknowihadto"],styleGroups:["uniform","casual"],extraPoseAssoc:[["normal_casual","normal"],["youknowihadto_casual","youknowihadto"],["normal_red","normal"],["youknowihadto_red","youknowihadto"],["normal_casual_red","normal"],["youknowihadto_casual_red","youknowihadto"]],defaultStyleComponents:[{label:"Eyes",id:"eyes",variants:{yellow:"/parts/chad/yellow-eyes{ext}",red:"/parts/chad/red-eyes{ext}"}}]}),"ddlc.fan.femc":ft("dddg.buildin.femc","ddlc.fan.femc",{heads:["straight","straight_lh","straight_closed","straight_hetero","straight_hetero_lh"],poses:["normal","crossed_arms"],styleGroups:["uniform","casual","uniform_strict"],extraPoseAssoc:[["casual_normal","normal"],["casual_crossed_arms","crossed_arms"],["uniform_normal","normal"],["uniform_crossed_arms","crossed_arms"],["normal_long_hair","normal"],["crossed_arms_long_hair","crossed_arms"],["casual_normal_long_hair","normal"],["casual_crossed_arms_long_hair","crossed_arms"],["uniform_normal_long_hair","normal"],["uniform_crossed_arms_long_hair","crossed_arms"],["normal_hetero","normal"],["crossed_arms_hetero","crossed_arms"],["casual_normal_hetero","normal"],["casual_crossed_arms_hetero","crossed_arms"],["uniform_normal_hetero","normal"],["uniform_crossed_arms_hetero","crossed_arms"],["normal_long_hair_hetero","normal"],["crossed_arms_long_hair_hetero","crossed_arms"],["casual_normal_long_hair_hetero","normal"],["casual_crossed_arms_long_hair_hetero","crossed_arms"],["uniform_normal_long_hair_hetero","normal"],["uniform_crossed_arms_long_hair_hetero","crossed_arms"]],defaultStyleComponents:[{label:"Eyes",id:"eyes",variants:{yellow:"/parts/femc/yellow-eyes{ext}",hetero:"/parts/femc/hetero-eyes{ext}"}},{label:"Hairs",id:"hairs",variants:{sh:"/parts/femc/short-hair{ext}",lh:"/parts/femc/long-hair{ext}"}}]}),"ddlc.fan.amy1":ft("dddg.buildin.amy1","ddlc.fan.amy1",{heads:["straight"],poses:["normal","crossed_arms"],styleGroups:["uniform"]}),"ddlc.fan.amy2":ft("dddg.buildin.amy2","ddlc.fan.amy2",{heads:["straight","straight_closed","straight_red"],poses:["normal","folded_hands_up","folded_hands_down","hands_on_glasses"],styleGroups:["uniform","casual"],extraPoseAssoc:[["normal-casual","normal"],["folded_hands_up-casual","folded_hands_up"],["folded_hands_down-casual","folded_hands_down"],["hands_on_glasses-casual","hands_on_glasses"]]})};function Y_(e){return[]}function K_(e,t,o){var n={characterId:e.id,packId:e.packId,paths:t};return{id:Jt("character",e.id,n),chibi:e.chibi,label:e.name,heads:tS(e.heads,n,o),styleGroups:J_(e,n,o),defaultScale:[.8,.8],size:[960,960],hd:!1}}function J_(e,t,o){var n,s,i=du[t.characterId],r=[],a=new Map,l=oS(e,t),d=l.length===0?i&&i.defaultStyleComponents?Z_(i.defaultStyleComponents,t):[]:l,c=e.poses.map(function(T){return T.style}).filter(function(T,D,H){return H.indexOf(T)===D}),f=new Map(e.styles.map(function(T){return[T.name,T]})),h=function(T){var D,H,x,O,Z=f.get(T);if(Z&&Z.nsfw&&!o)return"continue";var K=T,G={};try{for(var te=(D=void 0,ds(d)),oe=te.next();!oe.done;oe=te.next()){var pe=oe.value;try{for(var fe=(x=void 0,ds(Object.keys(pe.variants))),L=fe.next();!L.done;L=fe.next()){var ke=L.value,ze=new RegExp("-"+ke+"\\b");if(K.match(ze)){G[pe.id]=ke,K=K.replace(ze,"");break}}}catch(_e){x={error:_e}}finally{try{L&&!L.done&&(O=fe.return)&&O.call(fe)}finally{if(x)throw x.error}}}}catch(_e){D={error:_e}}finally{try{oe&&!oe.done&&(H=te.return)&&H.call(te)}finally{if(D)throw D.error}}K=Jt("styleGroups",K,t);var nt=a.get(K);nt||(nt={id:K,styleComponents:d,styles:[]},a.set(K,nt),r.push(K)),nt.styles.push({components:G,poses:eS(e.poses.filter(function(_e){return _e.style===T}),t,o)})};try{for(var b=ds(c),y=b.next();!y.done;y=b.next()){var k=y.value;h(k)}}catch(T){n={error:T}}finally{try{y&&!y.done&&(s=b.return)&&s.call(b)}finally{if(n)throw n.error}}return r.map(function(T){return a.get(T)})}function Z_(e,t){return ar.mapNormalize(ar.normalizeStyleComponent,e,"",{packId:t.packId,paths:t.paths})}function Q_(e,t){return e?[{type:"pose-part",offset:[0,0],part:"Static"},{type:"pose-part",offset:[0,0],part:"Variant"},{type:"pose-part",offset:[0,0],part:"Left"},{type:"pose-part",offset:[0,0],part:"Right"},{type:"head",offset:t}]:[{type:"head",offset:t},{type:"pose-part",offset:[0,0],part:"Static"},{type:"pose-part",offset:[0,0],part:"Variant"},{type:"pose-part",offset:[0,0],part:"Left"},{type:"pose-part",offset:[0,0],part:"Right"}]}function eS(e,t,o){return e.map(function(n){return{compatibleHeads:n.compatibleHeads.map(function(s){return Jt("heads",s.toString(),t)}),id:Jt("poses",n.name,t),renderCommands:Q_(n.headInForeground,n.headAnchor),previewOffset:n.offset,previewSize:n.size,size:[960,960],scale:.8,positions:{Static:"static"in n?[[n.static]]:[],Left:"left"in n?ki(n.left,o):[],Right:"right"in n?ki(n.right,o):[],Variant:"variant"in n?ki(n.variant,o):[]}}})}function ki(e,t){return e.filter(function(o){return!o.nsfw||t}).map(function(o){return[o.img]})}function tS(e,t,o){var n,s,i={};try{for(var r=ds(Object.keys(e)),a=r.next();!a.done;a=r.next()){var l=a.value,d=e[l];d.nsfw&&!o||(i[Jt("heads",l,t)]={previewOffset:d.offset,previewSize:d.size,variants:d.all.filter(function(c){return!c.nsfw||o}).map(function(c){return[c.img]})})}}catch(c){n={error:c}}finally{try{a&&!a.done&&(s=r.return)&&s.call(r)}finally{if(n)throw n.error}}return i}function oS(e,t){var o=[],n=[];return Object.keys(e.eyes).length>0&&(Object.keys(e.eyes).forEach(function(s){return n.push(s)}),o.push({label:"Eyes",id:Jt("eyes","eyes",t),variants:e.eyes})),Object.keys(e.hairs).length>0&&(Object.keys(e.hairs).forEach(function(s){return n.push(s)}),o.push({label:"Hairs",id:Jt("hairs","hairs",t),variants:e.hairs})),o}function _i(e,t){return new Map(t.map(function(o){return[o,e+":"+o]}))}function ft(e,t,o){return o.extraHeadAssoc?o.extraHeadAssoc=o.extraHeadAssoc.map(function(n){return[n[0],e+":"+n[1]]}):o.extraHeadAssoc=[],o.extraPoseAssoc?o.extraPoseAssoc=o.extraPoseAssoc.map(function(n){return[n[0],e+":"+n[1]]}):o.extraPoseAssoc=[],o.extraStyleGroupAssoc?o.extraStyleGroupAssoc=o.extraStyleGroupAssoc.map(function(n){return[n[0],e+":"+n[1]]}):o.extraStyleGroupAssoc=[],{character:e+":"+t,eyes:e+":eyes",hairs:e+":hair",defaultStyleComponents:o.defaultStyleComponents||[],heads:new Map($i(_i(e,o.heads),o.extraHeadAssoc)),poses:new Map($i(_i(e,o.poses),o.extraPoseAssoc)),styleGroups:new Map($i(_i(e,o.styleGroups),o.extraStyleGroupAssoc))}}function Jt(e,t,o){var n=du[o.characterId];if(n){if(e==="character"||e==="hairs"||e==="eyes")return n[e];var s=n[e].get(t);if(s)return s}return ar.expandId(o.packId,t)}Bn.expandOrTranslateId=Jt;var ba={};Object.defineProperty(ba,"__esModule",{value:!0});var cu=ba.normalizeCharacter=void 0;function nS(e,t){var o=Zt("",e.folder||"/",t),n=void 0;return e.chibi&&(n=Zt(o,e.chibi,t)),n===void 0&&e.internalId&&(n=(t["/"]||"")+"chibis/"+e.internalId),{id:e.id,packId:e.packId,packCredits:e.packCredits,name:e.name,nsfw:!!e.nsfw,chibi:n,eyes:Dl(e.eyes,o,t),hairs:Dl(e.hairs,o,t),styles:rS(e.styles),heads:sS(e.heads,o,t),poses:iS(e.poses,o,t)}}cu=ba.normalizeCharacter=nS;function Dl(e,t,o){if(!e)return{};var n={};for(var s in e)!e.hasOwnProperty(s)||(n[s]=Zt(t,e[s],o));return n}function sS(e,t,o){var n={};if(!e)return n;for(var s in e)if(!!e.hasOwnProperty(s)){var i=e[s],r=void 0;if(i instanceof Array)r={all:kn(i,t,o),nsfw:!1,offset:[290,70],size:[380,380]};else{var a=Zt(t,i.folder,o);r={all:kn(i.all,a,o),nsfw:!!i.nsfw,offset:i.offset||[290,70],size:i.size||[380,380]}}n[s]=r}return n}function iS(e,t,o){return e?e.map(function(n){var s=Zt(t,n.folder,o),i={compatibleHeads:n.compatibleHeads||[],headAnchor:n.headAnchor||[0,0],headInForeground:!!n.headInForeground,name:n.name,nsfw:!!n.nsfw,style:n.style,offset:[0,0],size:[960,960]};if("static"in n)i.static=Zt(s,n.static,o);else if("variant"in n)i.variant=kn(n.variant,s,o);else if("left"in n)i.left=kn(n.left,s,o),i.right=kn(n.right,s,o);else throw new Error("Invalid pose");return i}):[]}function kn(e,t,o){return e.map(function(n){return typeof n=="string"?{img:Zt(t,n,o),nsfw:!1}:{img:Zt(t,n.img,o),nsfw:n.nsfw||!1}})}function rS(e){return e?e.map(function(t){return{name:t.name,label:t.label,nsfw:t.nsfw||!1}}):[]}function aS(e){return e.startsWith("blob:")||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("://")}function Zt(e,t,o){if(!t)return e;for(var n in o)if(t.startsWith(n))return o[n]+t.slice(n.length);return aS(t)?t:e+t}function Si(e,t){return{backgrounds:lS(e.backgrounds,t.backgrounds),characters:cS(e.characters,t.characters),dependencies:lr(e.dependencies,t.dependencies),fonts:mt(e.fonts,t.fonts,o=>o.id,(o,n)=>({...o,files:lr(o.files,n.files)})),poemStyles:mt(e.poemStyles,t.poemStyles,o=>o.label,()=>{throw new Error}),poemBackgrounds:[...e.poemBackgrounds,...t.poemBackgrounds],sprites:mt(e.sprites,t.sprites,o=>o.id,(o,n)=>{var s;return{id:o.id,label:o.label,variants:[...o.variants,...n.variants],defaultScale:o.defaultScale,hd:o.hd,sdVersion:(s=o.sdVersion)!=null?s:n.sdVersion}}),colors:mt(e.colors,t.colors,o=>o.color,o=>o)}}function lS(e,t){return mt(e,t,o=>o.id,dS)}function dS(e,t){var o;return{id:e.id,label:e.label,variants:[...e.variants,...t.variants],scaling:e.scaling,sdVersion:(o=e.sdVersion)!=null?o:t.sdVersion}}function cS(e,t){return mt(e,t,o=>o.id,uS)}function uS(e,t){return{chibi:e.chibi,id:e.id,label:e.label,heads:pS(e.heads,t.heads),defaultScale:e.defaultScale,hd:e.hd,size:e.size,sdVersion:e.sdVersion,styleGroups:mt(e.styleGroups,t.styleGroups,o=>o.id,(o,n)=>({id:o.id,styleComponents:mt(o.styleComponents,n.styleComponents,s=>s.id,(s,i)=>({id:s.id,label:s.label,variants:fS(s.variants,i.variants)})),styles:mt(o.styles,n.styles,s=>JSON.stringify(s.components),(s,i)=>({components:s.components,poses:mt(s.poses,i.poses,r=>r.id,hS)}))}))}}function fS(e,t){const o={...e};for(const n in t)!t.hasOwnProperty(n)||o.hasOwnProperty(n)||(o[n]=t[n]);return o}function hS(e,t){const o={...e.positions};for(const n in t.positions)o[n]?o[n]=[...o[n],...t.positions[n]]:o[n]=t.positions[n];return{id:e.id,compatibleHeads:lr(e.compatibleHeads,t.compatibleHeads),previewOffset:e.previewOffset,previewSize:e.previewSize,scale:e.scale,size:e.size,renderCommands:e.renderCommands,positions:o}}function pS(e,t){const o={...e};for(const n in t){if(!t.hasOwnProperty(n))continue;const s=t[n];if(o[n]){const i=o[n];o[n]={previewOffset:i.previewOffset,previewSize:i.previewSize,variants:[...i.variants,...s.variants]}}else o[n]=s}return o}function lr(e,t){const o=[...e];for(const n of t)o.includes(n)||o.push(n);return o}function mt(e,t,o,n){const s=[...e],i=new Map(e.map((r,a)=>[o(r),a]));for(const r of t){const a=o(r);if(i.has(a)){const l=i.get(a),d=s[l];s.splice(l,1,n(d,r))}else i.set(a,s.length),s.push(r)}return s}function Hl(e){return e.split("/").slice(0,-1).join("/")+"/"}const Ml=new Set(["png","gif","bmp","svg"]),gS={namespaced:!0,state:{contentPacks:[],current:{dependencies:[],backgrounds:[],characters:[],fonts:[],poemStyles:[],poemBackgrounds:[],sprites:[],colors:[]}},mutations:{setContentPacks(e,t){e.contentPacks=t},setCurrentContent(e,t){e.current=t}},actions:{removeContentPacks({commit:e,state:t,dispatch:o},n){const s=JSON.parse(JSON.stringify(t.current)),i=t.contentPacks.filter(r=>!n.has(r.packId));e("setContentPacks",i),e("setCurrentContent",i.reduce((r,a)=>Si(r,a))),o("panels/fixContentPackRemoval",s,{root:!0})},async replaceContentPack({commit:e,state:t},o){const n=o.processed?o.contentPack:await Rl(o.contentPack);let s=t.contentPacks;const i=s.findIndex(r=>r.packId===o.contentPack.packId);i===-1?s.push(n):s.splice(i,1,n),s=s,e("setContentPacks",s),e("setCurrentContent",s.reduce((r,a)=>Si(r,a)))},async loadContentPacks({commit:e,state:t},o){typeof o=="string"&&(o=[o]);const n=await Promise.all(o.map(async a=>{const l=await fetch(a);l.ok||xi(`Could not load content pack. Server responded with: ${l.statusText}`);let d;try{d=await l.json()}catch{xi("Content pack is not valid json!")}let c;try{const f={"./":Hl(a),"/":Hl(location.href)+"assets/"};d.version==="2.0"?c=Qc(d,f):c=lu(cu(d,f),f,!1)}catch(f){xi("Content pack is not in a valid format!",f)}return c})),s=await Promise.all(n.map(a=>Rl(a))),i=new Set(t.contentPacks.map(a=>a.packId));let r=t.current;for(const a of s){for(const l of a.dependencies)if(!i.has(l))throw new Error(`Missing dependency '${l}'. Refusing to install ${a.packId}`);r=Si(r,a)}return e("setContentPacks",[...t.contentPacks,...s]),e("setCurrentContent",r),n.map(a=>a.packId)}},getters:{getCharacters({current:e}){const t=new Map;for(const o of e.characters)t.set(o.id,o);return t},getBackgrounds({current:e}){const t=new Map;for(const o of e.backgrounds)t.set(o.id,o);return t}}};async function Rl(e){const t=new Set(await zo()?["webp",...Ml]:Ml),o=new Map([["ext","{lq:.lq:}.{format:webp:webp:png:png}"]]);return Zc(e,(n,s)=>{var a;const i=ir(n,o,t,!1),r=ir(n,o,t,!0);return{hq:i,lq:r,sourcePack:(a=e.packId)!=null?a:"buildIn"}})}function xi(e,t){throw console.error(e,t),new Error(e)}const mS=b_({state:{unsafe:!1},mutations:{setUnsafe(e,t){e.unsafe=t}},actions:{async removePacks({dispatch:e,commit:t},{packs:o}){t("setUnsafe",!0),e("content/removeContentPacks",o),t("setUnsafe",!1)},getSave({state:e},t){return JSON.stringify(e,(o,n)=>{if(o!=="ui"&&o!=="lastRender")return o==="content"&&t?n.contentPacks.map(s=>s.packId).filter(s=>s==null?void 0:s.startsWith("dddg.buildin.")):n},2)}},modules:{ui:y_,panels:e$,content:gS}}),bS={install(e,t={}){if(!e.config.globalProperties.$store)throw new Error("VuexUndoRedo plugin must be installed after the Vuex plugin.");t.resetStateMutation||(t.resetStateMutation="emptyState"),t.mutations||(t.mutations={});const o=e.config.globalProperties.$store;function n(d,c){let f={};switch(typeof c.payload){case"object":c.payload instanceof Array&&(f=[]),o.commit(`${c.type}`,Object.assign(f,c.payload));break;default:o.commit(`${c.type}`,c.payload)}}async function s(d,c){return await d.transaction(()=>{c.forEach(f=>{n(d,f)})})}async function i(d){const c=d.data.done.slice(0);d.data.done=[],o.commit(t.resetStateMutation);for(let f=0;f<c.length;++f)await s(d,c[f])}const r={};function a(d){if(!r[d]){const c=d.split("/"),f={ignore:b=>!1,combinable:(b,y)=>!1,combinator:(b,y)=>y};let h="";for(const b of c)t.mutations[h+"*"]&&Object.assign(f,t.mutations[h+"*"]),h+=b+"/";t.mutations[d]&&Object.assign(f,t.mutations[d]),r[d]=f}return r[d]}const l={data:Dt({done:[],undone:[],snapshots:[],transactionsSinceSnapshot:0,newMutation:!0,ignoreMutations:t.ignoreMutations||[],currentTransaction:null,transactionQueue:[],initialized:!1}),initialize(){l.initialized||(l.initialized=!0,o.subscribe(d=>{const c=()=>{d.type===t.resetStateMutation||a(d.type).ignore(d)||(l.currentTransaction.push(d),l.newMutation&&(l.data.undone=[]))};l.currentTransaction?c():l.transaction(()=>{c()})}))},async redo(){if(l.data.undone.length<=0)return;const d=l.data.undone.pop();l.newMutation=!1,await s(l,d),l.newMutation=!0},async undo(){l.data.done.length<=0||(l.data.undone.push(l.data.done.pop()),l.newMutation=!1,await i(l),l.newMutation=!0)},clearHistory(){return new Promise((d,c)=>{const f=async()=>{l.currentTransaction=[],l.transactionsSinceSnapshot=0,l.data.undone=[],l.data.done=[],d(),l.currentTransaction=null,l.data.transactionQueue.length>0&&l.data.transactionQueue.shift()()};l.currentTransaction?l.data.transactionQueue.push(f):f()})},transaction(d){return new Promise((c,f)=>{const h=async()=>{l.currentTransaction=[],l.transactionsSinceSnapshot++;try{await d()}catch(b){console.log("Error during transaction!: ",b)}l.currentTransaction=null,l.data.transactionQueue.length>0&&l.data.transactionQueue.shift()(),c()};l.currentTransaction?l.data.transactionQueue.push(h):h()})}};window.storeHistory=l,e.config.globalProperties.vuexHistory=l,l.initialize()}};Zh(Xk).use(mS).use(bS).mount("#main_wrapper");export{Ct as A,Wr as B,Wn as C,zd as D,s$ as E,N as F,lt as G,Ur as L,Ot as R,hn as S,vS as T,Ld as V,se as _,u as a,q as b,C as c,ne as d,X as e,Qf as f,Me as g,$ as h,E as i,wt as j,ee as k,M as l,j as m,le as n,m as o,He as p,z as q,$e as r,Ae as s,he as t,we as u,je as v,de as w,Dt as x,Bt as y,Vr as z};
