var _n=Object.defineProperty,Bn=Object.defineProperties;var On=Object.getOwnPropertyDescriptors;var Jo=Object.getOwnPropertySymbols;var Dn=Object.prototype.hasOwnProperty,Hn=Object.prototype.propertyIsEnumerable;var Wt=(e,t,o)=>t in e?_n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,m=(e,t)=>{for(var o in t||(t={}))Dn.call(t,o)&&Wt(e,o,t[o]);if(Jo)for(var o of Jo(t))Hn.call(t,o)&&Wt(e,o,t[o]);return e},k=(e,t)=>Bn(e,On(t));var g=(e,t,o)=>(Wt(e,typeof t!="symbol"?t+"":t,o),o);import{m as An,r as Et,c as Zo,a as Ye,d as D,b,w as R,v as Rn,e as a,t as V,o as p,f as ye,F as _,g as L,h as S,n as F,i as I,j as C,k as x,l as w,T as Qo,p as y,q as oe,s as G,u as Y,x as v,y as Q,z as K,A as es,B as de,C as z,D as Mn,E as ts,G as Fn,K as Nn,H as Vn,I as Wn,J as En,L as Ln,M as os,N as Un,O as zn}from"./vendor.25918e1f.js";const Xn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}};Xn();const Gn="modulepreload",ss={},Yn="./",ns=function(t,o){return!o||o.length===0?t():Promise.all(o.map(s=>{if(s=`${Yn}${s}`,s in ss)return;ss[s]=!0;const n=s.endsWith(".css"),r=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${r}`))return;const i=document.createElement("link");if(i.rel=n?"stylesheet":Gn,n||(i.as="script",i.crossOrigin=""),i.href=s,document.head.appendChild(i),n)return new Promise((l,d)=>{i.addEventListener("load",l),i.addEventListener("error",d)})})).then(()=>t())},Lt=An();var E={fire(e){Lt.emit(e.kind,e)},subscribe(e,t){Lt.on(e.kind,t)},unsubscribe(e,t){Lt.off(e.kind,t)}};class pt{constructor(t){g(this,"kind","AssetFailureEvent");this.path=t}}g(pt,"kind","AssetFailureEvent");class Ut{constructor(t){g(this,"kind","FailureEvent");this.message=t}}g(Ut,"kind","FailureEvent");class zt{constructor(t){g(this,"kind","CustomAssetFailureEvent");this.error=t}}g(zt,"kind","CustomAssetFailureEvent");class Xt{constructor(){g(this,"kind","InvalidateRenderEvent")}}g(Xt,"kind","InvalidateRenderEvent");class se{constructor(t){g(this,"kind","ShowMessageEvent");this.message=t}}g(se,"kind","ShowMessageEvent");class Gt{constructor(t,o){g(this,"kind","ResolvableErrorEvent");this.message=t,this.actions=o}}g(Gt,"kind","ResolvableErrorEvent");class ft{constructor(t){g(this,"kind","ColorPickedEvent");this.color=t}}g(ft,"kind","ColorPickedEvent");class is{constructor(t,o){g(this,"kind","VueErrorEvent");this.error=t,this.info=o}}g(is,"kind","VueErrorEvent");const qn="https://edave64.github.io/Doki-Doki-Dialog-Generator-Packs/",Z=class{constructor(t,o,s){g(this,"onlineRepo");g(this,"localRepo");g(this,"tempRepo",Ye({authors:{},packs:[]}));g(this,"combinedList");g(this,"authors");this.$store=s,window.repo=this,t||(t={authors:{},packs:[]},E.fire(new se("Couldn't load remote repository."))),o||(o={authors:{},packs:[]},B.supports.localRepo&&E.fire(new se("Couldn't load local repository."))),this.onlineRepo=Et(t),this.localRepo=Et(o),this.combinedList=Zo(()=>{var N,Ie;const n=this.onlineRepo.value,r=(N=n==null?void 0:n.packs)!=null?N:[],i=new Map(r.map(O=>[O.id,O])),l=this.localRepo.value,d=(Ie=l==null?void 0:l.packs)!=null?Ie:[],c=new Map(d.map(O=>[O.id,O])),h=this.tempRepo.packs,f=new Map(h.map(O=>[O.id,O])),P=new Set(B.state.autoAdd),j=this.$store.state.content.contentPacks.map(O=>O.packId).filter(O=>!!O),$=new Set(j),le=new Set;return[...j,...d.map(O=>O.id),...r.map(O=>O.id),...h.map(O=>O.id)].filter(O=>O.startsWith("dddg.buildin.")||O.startsWith("dddg.desktop.")||O==="concept_femc.shido_draws.edave64"||O==="mc.storm_blaze.edave64"||le.has(O)?!1:(le.add(O),!0)).map(O=>{var _e,U,Se;return k(m(m(m({},(_e=i.get(O))!=null?_e:{characters:[],kind:[],authors:[]}),(U=c.get(O))!=null?U:{}),(Se=f.get(O))!=null?Se:{}),{autoloading:P.has(O),installed:c.has(O),online:i.has(O)||f.has(O),loaded:$.has(O)})})}),this.authors=Zo(()=>{var d,c;const n=this.onlineRepo.value,r=(d=n==null?void 0:n.authors)!=null?d:{},i=this.localRepo.value,l=(c=i==null?void 0:i.authors)!=null?c:{};return m(m({},r),l)}),Object.freeze(this)}static getInstance(){return Z.instance||(Z.instance=this.createInstance()),Z.instance}static async createInstance(){const t=Z.loadRepo(qn),o=B.supports.localRepo?await Z.loadRepo(B.localRepositoryUrl):null,[s,n,r]=await Promise.all([t,o,Z.$store]);return new Z(s,n,r)}static async loadRepo(t){try{const[o,s]=await Promise.all([Z.fetchJSON(t+"repo.json"),Z.fetchJSON(t+"people.json")]);return{packs:o,authors:s}}catch{return null}}static async fetchJSON(t){const o=await fetch(t);if(!o.ok)throw new Error("Could not load json");return await o.json()}async reloadLocalRepo(){this.localRepo.value=B.supports.localRepo?await Z.loadRepo(B.localRepositoryUrl):null}getPacks(){return this.combinedList.value}hasPack(t,o=!1){var s;return o?!!((s=this.onlineRepo.value)==null?void 0:s.packs.find(n=>n.id===t)):!!this.getPacks().find(n=>n.id===t)}getPack(t){return this.getPacks().find(o=>o.id===t)}getAuthor(t){return this.authors.value[t]||null}getAuthors(){return this.authors.value}async loadTempPack(t){const o=fetch(t);let s;try{s=await o}catch{throw new Error(`Failed to load '${t}'`)}let n;try{n=await s.json()}catch(l){throw new Error(`The contents of '${t}' is not a valid JSON: ${l.message}`)}if(!n.pack)throw new Error(`The json file '${t}' does not contain any packages`);if(n.authors)for(const l in n.authors)this.tempRepo.authors[l]&&(this.tempRepo.authors[l]=n.authors[l]);const r=n.pack;let i=r.id;return r.repoUrl=t,this.tempRepo.packs.find(l=>l.id===r.id)||this.tempRepo.packs.push(r),i}};let ve=Z;g(ve,"instance"),g(ve,"setStore"),g(ve,"$store",new Promise((t,o)=>{Z.setStore=t}));const gt=navigator.userAgent;var Kn=!!gt.match(/iPad/i)||!!gt.match(/iPhone/i),Jn=!!gt.match(/WebKit/i);const Zn=Kn&&Jn&&!gt.match(/CriOS/i);class rs{constructor(){g(this,"state",Ye({looseTextParsing:!0,autoAdd:[],downloadLocation:"Default download folder"}));g(this,"supports");g(this,"_gameMode",null);g(this,"vuexHistory",null);g(this,"$store",null);g(this,"isSavingEnabled",Et(!1));g(this,"localRepositoryUrl","");g(this,"loading");g(this,"creatingDB");g(this,"loadingContentPacksAllowed");g(this,"loadContentPacks");const t=this,o=X.canSave();window.addEventListener("beforeunload",function(s){s.preventDefault(),s.returnValue="Are you sure you want to leave? All your progress will be lost!"}),this.loadingContentPacksAllowed=new Promise((s,n)=>{this.loadContentPacks=()=>s()}),this.supports=Ye({optionalSaving:o,get autoLoading(){return o&&t.isSavingEnabled.value},backgroundInstall:!1,localRepo:!1,lq:!0,setDownloadFolder:!1,openableFolders:new Set([]),assetCaching:!Zn}),o?this.loading=(async()=>{this.savingEnabled=await X.doesDbExists()})():this.loading=Promise.resolve(),this.loading.then(async()=>{if(await this.loadingContentPacksAllowed,this.creatingDB&&await this.creatingDB,this.savingEnabled){const s=await X.loadAutoload()||[];this.state.autoAdd=s;const n=await ve.getInstance(),r=await Promise.all(s.map(async i=>{const[l,d]=i.split(";",2);d&&!n.hasPack(l)&&await n.loadTempPack(d);const c=n.getPack(l);return c.dddg2Path||c.dddg1Path}));await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/loadContentPacks",r)})}})}get gameMode(){return this._gameMode}get savingEnabled(){return this.isSavingEnabled.value}set savingEnabled(t){t?(localStorage.setItem("saving","true"),this.creatingDB=X.createDB(),this.creatingDB.then(()=>{this.creatingDB=void 0,this.isSavingEnabled.value=!0}).catch(()=>{})):(localStorage.clear(),this.isSavingEnabled.value=!1,this.creatingDB=X.clearDB().then(()=>{this.creatingDB=void 0}).catch(()=>{}))}async loadGameMode(){const o=new URLSearchParams(location.search).get("mode");if(o==="ddlc"||o==="ddlc_plus"){this._gameMode=o;return}await this.loading,await this.creatingDB;let s="";this.isSavingEnabled.value&&(s=await X.loadGameMode());let n="ddlc";(s==="ddlc"||s==="ddlc_plus")&&(n=s),this._gameMode=n}async setGameMode(t){this.isSavingEnabled.value&&await X.saveGameMode(t);const o=`${location.protocol}//${location.host}${location.pathname}`;location.href=`${o}?mode=${t}`}updateDownloadFolder(){throw new Error("Method not implemented.")}openFolder(t){throw new Error("Method not implemented.")}connectToStore(t,o){this.vuexHistory=t,this.$store=o}async saveToFile(t,o,s="image/png",n=1){const r=document.createElement("a");r.setAttribute("download",o);const i=await this.createObjectURL(t,s,n);return r.setAttribute("href",i),document.body.appendChild(r),r.click(),document.body.removeChild(r),i}installBackground(t){throw new Error("This environment does not support installing backgrounds")}uninstallBackground(t){throw new Error("This environment does not support uninstalling backgrounds")}localRepoInstall(t,o,s){throw new Error("This environment does not support a local repository")}localRepoUninstall(t){throw new Error("This environment does not support a local repository")}async autoLoadAdd(t){await this.loading,await this.creatingDB,await X.saveAutoload([...this.state.autoAdd,t]),this.state.autoAdd.push(t)}async autoLoadRemove(t){await this.loading,await this.creatingDB;const o=this.normalizePackId(t);await X.saveAutoload(this.state.autoAdd.filter(n=>this.normalizePackId(n)!=o));const s=this.state.autoAdd.indexOf(t);this.state.autoAdd.splice(s,1)}normalizePackId(t){const o=t.split(";");return o.length===1?o[0]:o[o.length-1]}async loadSettings(){await this.loading,await this.creatingDB;const t={darkMode:void 0,lq:!0,nsfw:!1,defaultCharacterTalkingZoom:!0,looseTextParsing:!0};return this.isSavingEnabled.value?m(m({},t),await X.loadSettings()):t}async saveSettings(t){await this.loading,await this.creatingDB,!!this.isSavingEnabled.value&&await X.saveSettings(t)}async isInitialized(){await this.loading,await this.creatingDB}prompt(t,o){return new Promise((s,n)=>{s(prompt(t,o))})}onPanelChange(t){}createObjectURL(t,o,s){return new Promise((n,r)=>{if(!!!(window.URL&&window.URL.createObjectURL))return n(t.toDataURL(o,s));if(t.toBlob)t.toBlob(l=>{if(!l){r();return}n(URL.createObjectURL(l))},o,s);else{const l=t.toDataURL(o,s),d=this.dataURItoBlob(l,o);n(URL.createObjectURL(d))}})}dataURItoBlob(t,o){const s=atob(t.split(",")[1]),n=s.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=s.charCodeAt(i);return new Blob([r],{type:o})}}const X={indexedDB:(()=>{try{return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB}catch{return null}})(),transaction:(()=>{try{return window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction}catch{return null}})(),db:null,canSave(){return!!(X.indexedDB&&window.localStorage)},doesDbExists(){return localStorage.getItem("saving")==="true"?Promise.resolve(!0):Promise.resolve(!1)},createDB(){return X.db?X.db:X.db=new Promise((e,t)=>{const o=X.indexedDB.open("dddg",3);o.onerror=s=>{t(s)},o.onupgradeneeded=s=>{var i;const n=s.target.result,r=(i=s.oldVersion)!=null?i:s.version;r<1&&n.createObjectStore("settings"),r===1&&(n.deleteObjectStore("settings"),n.createObjectStore("settings"))},o.onsuccess=s=>{e(o.result)}})},clearDB(){return new Promise((e,t)=>{if(!X.db){e();return}const o=X.indexedDB.deleteDatabase("dddg");X.db=null,o.onerror=s=>{t(s)},o.onsuccess=s=>{e()}})},loadAutoload(){return this.objectStorePromise("readonly",async e=>await this.reqPromise(e.get("autoload")))},saveAutoload(e){return this.objectStorePromise("readwrite",async t=>{await this.reqPromise(t.put([...e],"autoload"))})},loadGameMode(){return this.objectStorePromise("readonly",async e=>await this.reqPromise(e.get("gameMode")))},saveGameMode(e){return this.objectStorePromise("readwrite",async t=>{await this.reqPromise(t.put(e,"gameMode"))})},saveSettings(e){return this.objectStorePromise("readwrite",async t=>{await this.reqPromise(t.put(m({},e),"settings"))})},loadSettings(){return this.objectStorePromise("readonly",async e=>await this.reqPromise(e.get("settings")))},objectStorePromise(e,t){return this.db?new Promise(async(o,s)=>{const r=(await this.db).transaction(["settings"],e).objectStore("settings");try{o(await t(r))}catch(i){s(i)}}):Promise.reject(new Error("No database"))},reqPromise(e){return new Promise((t,o)=>{e.onerror=s=>{o(s)},e.onsuccess=s=>{t(e.result)}})}};class Qn extends rs{async saveToFile(t,o,s="image/png",n=1){let r=t.toDataURL(s,n);const i=this.dataURItoBlob(r,s);return window.URL&&window.URL.createObjectURL&&(r=URL.createObjectURL(i)),window.navigator.msSaveBlob(i,o),r}}class Yt{constructor(){g(this,"width",0);g(this,"height",0)}paintOnto(t){}}class qe{constructor(t){g(this,"width");g(this,"height");this.html=t,this.width=t.width,this.height=t.height}paintOnto(t,o={}){const{w:s,h:n}=m({w:this.width,h:this.height},o),{x:r,y:i}=m({x:-s/2,y:-n/2},o);t.drawImage(this.html,r,i,s,n)}}let qt;function Be(){return qt||(qt=new Promise((e,t)=>{const o="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=",s=document.createElement("img");s.addEventListener("load",()=>{e(s.width===2&&s.height===1)}),s.addEventListener("error",()=>{e(!1)}),s.src=o}))}let Kt;function ei(){return Kt||(Kt=new Promise((e,t)=>{const o="data:image/heic;base64,AAAAGGZ0eXBoZWljAAAAAG1pZjFoZWljAAAAsW1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAHBpY3QAXABjAGMAcwBsAGEAAAAADnBpdG0AAAAAAAEAAAAQaWxvYwAAAABEQAAAAAAAI2lpbmYAAAAAAAEAAAAVaW5mZQIAAAAAAQAAaHZjMQAAAABDaXBycAAAACdpcGNvAAAAH2h2Y0NmzGx1ci0AAAAAAABv9HP+//v9bjr3AAAAABRpcG1hAAAAAAAAAAEAAQGBAAAACG1kYXQ=",s=document.createElement("img");s.addEventListener("load",()=>{console.log("Heif no error. "+(s.width===2&&s.height===1)),e(s.width===2&&s.height===1)}),s.addEventListener("error",()=>{console.log("Heif not supported"),e(!1)}),s.src=o}))}const Ke={},bt={};function Oe(e,t=!0){return Jt(B.supports.lq&&!t?e.lq:e.hq)}async function Jt(e){return Ke[e]?Ke[e]:Ke[e]=(async()=>{try{return await as(e)}catch{if(e.endsWith(".webp"))try{return await as(e.replace(/\.webp$/,".png"))}catch{return E.fire(new pt(e)),Ke[e]=void 0,new Yt}else return E.fire(new pt(e)),Ke[e]=void 0,new Yt}})()}const ti="./";async function ce(e,t=!0){if(bt[e])return bt[e];const o=`${ti}/assets/${e}${t?"":".lq"}${await Be()?".webp":".png"}`.replace(/\/+/,"/");return await Jt(o)}function oi(e,t){const o=URL.createObjectURL(t);return Zt(e,o),o}function Zt(e,t){return bt[e]=new Promise((o,s)=>{const n=new Image;n.addEventListener("load",()=>{o(new qe(n))}),n.addEventListener("error",r=>{E.fire(new zt(r)),s(`Failed to load "${t}"`)}),n.crossOrigin="Anonymous",n.src=t,n.style.display="none",B.supports.assetCaching?document.body.appendChild(n):bt[e]=void 0})}function as(e){return new Promise((t,o)=>{const s=new Image;s.addEventListener("load",()=>{t(new qe(s))}),s.addEventListener("error",n=>{o(n)}),s.crossOrigin="Anonymous",s.src=e,s.style.display="none",document.body.appendChild(s)})}const ls={packId:"dddg.buildin.installedBackgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]};class si{constructor(){g(this,"state",Ye({looseTextParsing:!0,autoAdd:[],downloadLocation:""}));g(this,"localRepositoryUrl","/repo/");g(this,"_gameMode",null);g(this,"electron",window);g(this,"vuexHistory",null);g(this,"$store",null);g(this,"bgInvalidation",null);g(this,"pendingContentPacks",[]);g(this,"pendingContentPacksReplace",[]);g(this,"loadingContentPacksAllowed");g(this,"loadContentPacks");g(this,"supports",{autoLoading:!0,backgroundInstall:!0,localRepo:!0,lq:!1,optionalSaving:!1,setDownloadFolder:!0,openableFolders:new Set(["downloads","backgrounds","sprites"]),assetCaching:!0});g(this,"savingEnabled",!0);this.loadingContentPacksAllowed=new Promise((o,s)=>{this.loadContentPacks=()=>o()}),this.electron.ipcRenderer.on("add-persistent-content-pack",async o=>{if(await this.loadingContentPacksAllowed,!this.$store||!this.vuexHistory){this.pendingContentPacks.push(o);return}await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/loadContentPacks",o)})}),this.electron.ipcRenderer.on("add-persistent-background",async o=>{const s="persistentBg-"+o,n=o.split("/");await Zt(s,o),ls.backgrounds.push({id:s,variants:[[s]],label:n[n.length-1],scaling:"none"}),this.invalidateInstalledBGs()}),this.electron.ipcRenderer.on("push-message",async o=>{E.fire(new se(o))}),this.electron.ipcRenderer.on("config.downloadFolderUpdate",async o=>{this.state.downloadLocation=o}),this.electron.ipcRenderer.onConversation("load-packs",async o=>{const s=await ve.getInstance(),n=await Promise.all(o.map(async r=>{const[i,l]=r.split(";",2);l&&!s.hasPack(i)&&await s.loadTempPack(l);const d=s.getPack(i);return d.dddg2Path||d.dddg1Path}));if(!this.$store||!this.vuexHistory){n.forEach(r=>this.pendingContentPacks.push(r));return}await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/loadContentPacks",n)})}),this.electron.ipcRenderer.onConversation("auto-load.changed",async o=>{this.state.autoAdd=o}),this.electron.ipcRenderer.onConversation("reload-repo",async()=>{await(await ve.getInstance()).reloadLocalRepo()}),this.electron.ipcRenderer.onConversation("replace-pack",async o=>{const s={processed:!1,contentPack:o};!this.$store||!this.vuexHistory?this.pendingContentPacksReplace.push(s):await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/replaceContentPack",s)})}),this.electron.ipcRenderer.onConversation("resolvable-error",(o,s)=>new Promise((n,r)=>{E.fire(new Gt(o,s.map(i=>({exec:()=>n(i),name:i}))))}));let t=!1;this.electron.ipcRenderer.on("update.progress",o=>{o==="done"?(t=!1,E.fire(new se("An update is ready and will be installed once DDDG closes."))):t||(t=!0,E.fire(new se("An update is ready and will be installed once DDDG closes.")))}),this.electron.ipcRenderer.send("init-dddg")}get gameMode(){return this._gameMode}updateDownloadFolder(){this.electron.ipcRenderer.send("config.newDownloadFolder")}openFolder(t){this.electron.ipcRenderer.send("open-folder",t)}onPanelChange(t){}async saveSettings(t){var o;await this.electron.ipcRenderer.sendConvo("config.set","nsfw",t.nsfw),await this.electron.ipcRenderer.sendConvo("config.set","darkMode",(o=t.darkMode)!=null?o:void 0),await this.electron.ipcRenderer.sendConvo("config.set","defaultCharacterTalkingZoom",t.defaultCharacterTalkingZoom)}async loadGameMode(){this._gameMode=await this.electron.ipcRenderer.sendConvo("config.get","gameMode")||"ddlc"}async setGameMode(t){await this.electron.ipcRenderer.sendConvo("config.set","gameMode",t),this.electron.ipcRenderer.send("reload")}async loadSettings(){var t,o,s;return{lq:!1,nsfw:(t=await this.electron.ipcRenderer.sendConvo("config.get","nsfw"))!=null?t:!1,darkMode:(o=await this.electron.ipcRenderer.sendConvo("config.get","darkMode"))!=null?o:void 0,defaultCharacterTalkingZoom:(s=await this.electron.ipcRenderer.sendConvo("config.get","defaultCharacterTalkingZoom"))!=null?s:void 0}}async localRepoInstall(t,o,s){await this.electron.ipcRenderer.sendConvo("repo.install",t,o,s)}async localRepoUninstall(t){await this.electron.ipcRenderer.sendConvo("repo.uninstall",t)}async autoLoadAdd(t){await this.electron.ipcRenderer.sendConvo("auto-load.add",t)}async autoLoadRemove(t){await this.electron.ipcRenderer.sendConvo("auto-load.remove",t)}saveToFile(t,o,s="image/png",n=1){return new Promise((r,i)=>{t.toBlob(async l=>{if(!l){i();return}const d=await l.arrayBuffer();await this.electron.ipcRenderer.sendConvo("save-file",o,new Uint8Array(d)),r(URL.createObjectURL(l))},s,n)})}async installBackground(t){if(t.assets.length!==1||t.assets[0].sourcePack!=="dddg.buildin.uploadedBackgrounds")return;const o=await ce(t.assets[0].hq,!0);if(!(o instanceof HTMLImageElement))return;const s=await fetch(o.src),n=new Uint8Array(await s.arrayBuffer());this.electron.ipcRenderer.send("install-background",n)}async uninstallBackground(t){if(t.assets.length!==1||t.assets[0].sourcePack!=="dddg.buildin.installedBackgrounds")return;const o=await ce(t.assets[0].hq,!0);if(o instanceof HTMLImageElement){if(!o.src.startsWith("blob:")){const n=await(await fetch(o.src)).blob(),r=URL.createObjectURL(n);await Zt(t.assets[0].hq,r)}this.electron.ipcRenderer.send("uninstall-background",t.id)}}async prompt(t,o){return await this.electron.ipcRenderer.sendConvo("show-prompt",t,o)}connectToStore(t,o){this.vuexHistory=t,this.$store=o,this.invalidateInstalledBGs(),this.vuexHistory.transaction(async()=>{if(this.pendingContentPacks.length>0&&await this.$store.dispatch("content/loadContentPacks",this.pendingContentPacks),this.pendingContentPacksReplace.length>0)for(const s of this.pendingContentPacksReplace)await this.$store.dispatch("content/replaceContentPack",s)})}invalidateInstalledBGs(){!this.vuexHistory||!this.$store||this.bgInvalidation===null&&(this.bgInvalidation=requestAnimationFrame(()=>{this.updateInstalledBGs()}))}updateInstalledBGs(){this.bgInvalidation&&(cancelAnimationFrame(this.bgInvalidation),this.bgInvalidation=null),!(!this.vuexHistory||!this.$store)&&this.vuexHistory.transaction(async()=>{await this.$store.dispatch("content/replaceContentPack",{contentPack:ls})})}}function ni(){return window.isElectron?new si:"msSaveOrOpenBlob"in window.navigator?new Qn:new rs}const ds=ni();window.toast=ds;var B=ds;var H=(e,t)=>{const o=e.__vccOpts||e;for(const[s,n]of t)o[s]=n;return o};const ii=D({props:{label:String,modelValue:{type:Boolean,default:!1}},computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},checkbox(){return this.$refs.checkbox}}}),ri={class:"toggle_box"},ai=["id"],li=["for"],di=["for"];function ci(e,t,o,s,n,r){return p(),b("div",ri,[R(a("input",{id:e._.uid,type:"checkbox",ref:"checkbox","onUpdate:modelValue":t[0]||(t[0]=i=>e.value=i)},null,8,ai),[[Rn,e.value]]),a("label",{for:e._.uid,class:"switch"},null,8,li),a("label",{for:e._.uid,class:"toggle_label"},V(e.label),9,di)])}var ne=H(ii,[["render",ci]]);const Qt={methods:{verticalScrollRedirect(e){if(e.type!=="wheel"||!e.currentTarget)return;const t=e.currentTarget,o=getComputedStyle(t),s=e;if(s.deltaY===0)return;if(o.overflowY==="auto"){if(s.deltaY>0){if(t.scrollHeight>t.scrollTop+t.clientHeight){e.stopPropagation();return}}else if(t.scrollTop>0){e.stopPropagation();return}}const n=t.scrollLeft;t.scrollLeft+=s.deltaY,t.scrollLeft!==n&&e.stopPropagation()}}},ee={mixins:[Qt],computed:{vertical(){return this.$store.state.ui.vertical}},mounted(){this.updateVertical(),this.$el.addEventListener("wheel",e=>{this.vertical||this.verticalScrollRedirect(e)},{passive:!0})},methods:{updateVertical(){!this.$el||(this.vertical?this.$el.classList.add("vertical"):this.$el.classList.remove("vertical"))}},watch:{vertical(){this.updateVertical()}}};const ui=D({props:{noBaseSize:Boolean,options:{type:Array,default:[]}}}),hi={key:0,id:"submit-options"},pi=["onClick"];function fi(e,t,o,s,n,r){return p(),b("div",{class:"dialog-wrapper",onClick:t[1]||(t[1]=i=>e.$emit("leave"))},[a("dialog",{open:"",class:F({"base-size":!e.noBaseSize}),onClick:t[0]||(t[0]=I(()=>{},["stop"]))},[ye(e.$slots,"default",{},void 0,!0),e.options.length>0?(p(),b("div",hi,[(p(!0),b(_,null,L(e.options,i=>(p(),b("button",{key:i,class:"option",onClick:l=>e.$emit("option",i)},V(i),9,pi))),128))])):S("",!0)],2)])}var eo=H(ui,[["render",fi],["__scopeId","data-v-0c0fb71e"]]);const gi=D({mixins:[Qt],props:{to:{type:String,required:!0}},computed:{href(){let e=this.to;return e=e.replace(/^github:\/\//,"https://github.com/edave64/Doki-Doki-Dialog-Generator/"),e=e.replace(/^wiki:\/\/(.*)/,(t,o)=>"https://github.com/edave64/Doki-Doki-Dialog-Generator/wiki/Version-2:-"+o.replaceAll(" ","-")),e}}}),bi=["href"];function mi(e,t,o,s,n,r){return p(),b("a",{target:"_blank",rel:"noopener noreferrer",href:e.href},[ye(e.$slots,"default")],8,bi)}var to=H(gi,[["render",mi]]);async function cs(e,t){try{await t()}catch(o){console.error("Error in promise",e,o),E.fire(new Ut("Unexpected error! Please copy the following message and send it to /u/edave64: Error in '"+e+'", '+yi(o)))}}function yi(e){if(e instanceof Error){if(e.stack){const t=e.stack.split(`
`);return t[0].includes(e.name)&&t[0].includes(e.message)?t[0]+`
<br />`+t[1]:e.name+": "+e.message+`
<br />`+t[0]}return e.name+": "+e.message}return e instanceof Object?JSON.stringify(e):""+e}const vi=D({mixins:[ee],components:{Toggle:ne,ModalDialog:eo,L:to},data:()=>({allowSavesModal:!1,denySavesModal:!1,waitOnSaveChange:!1,showModeDialog:!1}),computed:{savesAllowed:{get(){return B.savingEnabled},set(e){this.waitOnSaveChange=!0,B.savingEnabled=e,this.saveSettings()}},inPlusMode(){return B.gameMode==="ddlc_plus"},savesEnabledInEnv(){return B.supports.optionalSaving},lqAllowed(){return B.supports.lq},looseTextParsing:{get(){return B.state.looseTextParsing},set(e){B.state.looseTextParsing=e,this.saveSettings()}},lqRendering:{get(){return this.$store.state.ui.lqRendering},set(e){this.vuexHistory.transaction(async()=>{await this.$store.commit("ui/setLqRendering",e)}),this.saveSettings()}},nsfw:{get(){return!!this.$store.state.ui.nsfw},set(e){this.vuexHistory.transaction(async()=>{await this.$store.commit("ui/setNsfw",e),this.saveSettings()})}},defaultCharacterTalkingZoom:{get(){return!!this.$store.state.ui.defaultCharacterTalkingZoom},set(e){this.vuexHistory.transaction(async()=>{await this.$store.commit("ui/setDefaultCharacterTalkingZoom",e),this.saveSettings()})}},theme:{get(){return this.$store.state.ui.useDarkTheme},set(e){this.vuexHistory.transaction(async()=>{await this.$store.commit("ui/setDarkTheme",e),this.saveSettings()})}},showDownloadFolder(){return B.supports.setDownloadFolder},downloadFolder(){return B.state.downloadLocation}},watch:{savesAllowed(){this.waitOnSaveChange=!1}},methods:{allowSaves(e){this.allowSavesModal=!1,e==="Allow"&&(this.savesAllowed=!0)},denySaves(e){this.denySavesModal=!1,e==="Deny"&&(this.savesAllowed=!1)},modeChange(e){cs("changing modes",async()=>{e==="Enter Classic Mode"?await B.setGameMode("ddlc"):e==="Enter Plus mode"?await B.setGameMode("ddlc_plus"):this.showModeDialog=!1})},saveSettings(){var e;B.saveSettings({lq:this.$store.state.ui.lqRendering,nsfw:this.$store.state.ui.nsfw,darkMode:(e=this.$store.state.ui.useDarkTheme)!=null?e:void 0,looseTextParsing:B.state.looseTextParsing,defaultCharacterTalkingZoom:this.$store.state.ui.defaultCharacterTalkingZoom})},setDownloadFolder(){B.updateDownloadFolder()},openDownloadFolder(){B.openFolder("downloads")}}}),te=e=>(G("data-v-64357afe"),e=e(),Y(),e),wi={class:"panel"},Ci=te(()=>a("h1",null,"Settings",-1)),$i={class:"modal-scroll-area"},ki=te(()=>a("p",null,"Do you want to allow DDDG to save settings on your device?",-1)),xi=te(()=>a("p",null," By choosing to enable saving settings, DDDG can save data to your device, and nowhere else. However, your browser and any installed browser extensions might possibly read and send this data to other servers, e.g. to sync between devices. This is outside of our control. But in general, we recommend only using browsers and browser extensions that you trust with your personal data. ",-1)),Si=te(()=>a("p",null,"You can revoke this permission at any time.",-1)),Pi=v(" Our usual "),ji=v("privacy policy"),Ti=v(" still applies. "),Ii={class:"modal-scroll-area"},_i=te(()=>a("p",null,"Do you want to deny DDDG from saving settings on your device?",-1)),Bi=te(()=>a("p",null," This will cause all your settings to reset when leaving the page. ",-1)),Oi=v(" Our usual "),Di=v("privacy policy"),Hi=v(" still applies. "),Ai=te(()=>a("div",{class:"modal-scroll-area"},[a("p",null," WARNING: Swiching modes will discard everything you have done in this session. All dialouge will be lost! ")],-1)),Ri={key:0,disabled:""},Mi=v(" Enter Classic Mode "),Fi=v(" Enter DDLC Plus Mode "),Ni=te(()=>a("td",null,[a("label",null,"Theme:")],-1)),Vi=te(()=>a("option",{value:null},"System",-1)),Wi=te(()=>a("option",{value:!1},"Light",-1)),Ei=te(()=>a("option",{value:!0},"Dark",-1)),Li=[Vi,Wi,Ei],Ui={key:4,class:"downloadTable"},zi=te(()=>a("td",null,[a("label",null,"Download folder:")],-1));function Xi(e,t,o,s,n,r){const i=C("l"),l=C("modal-dialog"),d=C("toggle");return p(),b("div",wi,[Ci,(p(),x(Qo,{to:"#modal-messages"},[e.allowSavesModal?(p(),x(l,{key:0,options:["Allow","Deny"],onLeave:t[0]||(t[0]=c=>e.allowSaves("Deny")),onOption:e.allowSaves,"no-base-size":""},{default:w(()=>[a("div",$i,[ki,xi,Si,a("p",null,[Pi,y(i,{to:"wiki://Privacy Statement"},{default:w(()=>[ji]),_:1}),Ti])])]),_:1},8,["onOption"])):S("",!0),e.denySavesModal?(p(),x(l,{key:1,options:["Deny","Cancle"],onLeave:t[1]||(t[1]=c=>e.denySaves("Cancle")),onOption:e.denySaves,"no-base-size":""},{default:w(()=>[a("div",Ii,[_i,Bi,a("p",null,[Oi,y(i,{to:"wiki://Privacy Statement"},{default:w(()=>[Di]),_:1}),Hi])])]),_:1},8,["onOption"])):S("",!0),e.showModeDialog?(p(),x(l,{key:2,options:[e.inPlusMode?"Enter Classic Mode":"Enter Plus mode","Stay"],onLeave:t[2]||(t[2]=c=>e.showModeDialog=!1),onOption:e.modeChange,"no-base-size":""},{default:w(()=>[Ai]),_:1},8,["options","onOption"])):S("",!0)])),e.waitOnSaveChange?(p(),b("button",Ri,"Applying...")):!e.savesAllowed&&e.savesEnabledInEnv?(p(),b("button",{key:1,onClick:t[3]||(t[3]=c=>e.allowSavesModal=!0)}," Allow saving options ")):e.savesAllowed&&e.savesEnabledInEnv?(p(),b("button",{key:2,onClick:t[4]||(t[4]=c=>e.denySavesModal=!0)}," Deny saving options ")):S("",!0),a("button",{onClick:t[5]||(t[5]=c=>e.showModeDialog=!0)},[e.inPlusMode?(p(),b(_,{key:0},[Mi],64)):(p(),b(_,{key:1},[Fi],64))]),e.lqAllowed?(p(),x(d,{key:3,label:"Low quality preview?",title:"Reduces the quality of the preview images to speed up the user experience and consume less data. Does not effect final render.",modelValue:e.lqRendering,"onUpdate:modelValue":t[6]||(t[6]=c=>e.lqRendering=c)},null,8,["modelValue"])):S("",!0),y(d,{label:"NSFW Mode?",modelValue:e.nsfw,"onUpdate:modelValue":t[7]||(t[7]=c=>e.nsfw=c)},null,8,["modelValue"]),y(d,{label:"Enlarge talking objects? (Default value)",modelValue:e.defaultCharacterTalkingZoom,"onUpdate:modelValue":t[8]||(t[8]=c=>e.defaultCharacterTalkingZoom=c)},null,8,["modelValue"]),y(d,{label:"Fault tolerant text parsing",title:"Silently ignore parse errors in texts. (Like unexpected '{' characters) Prevents beginners from getting stuck working with textboxes, but also makes it harder to understand what you are doing wrong.",modelValue:e.looseTextParsing,"onUpdate:modelValue":t[9]||(t[9]=c=>e.looseTextParsing=c)},null,8,["modelValue"]),a("table",null,[a("tr",null,[Ni,a("td",null,[R(a("select",{"onUpdate:modelValue":t[10]||(t[10]=c=>e.theme=c)},Li,512),[[oe,e.theme]])])])]),e.showDownloadFolder?(p(),b("table",Ui,[a("tr",null,[zi,a("td",null,V(e.downloadFolder),1),a("td",null,[a("button",{onClick:t[11]||(t[11]=(...c)=>e.setDownloadFolder&&e.setDownloadFolder(...c))},"Set"),a("button",{onClick:t[12]||(t[12]=(...c)=>e.openDownloadFolder&&e.openDownloadFolder(...c))},"Open")])])])):S("",!0)])}var Gi=H(vi,[["render",Xi],["__scopeId","data-v-64357afe"]]);const Yi=D({computed:{vertical(){return this.$store.state.ui.vertical}},data:()=>({visible:!1}),methods:{show(){this.visible=!0},hide(){this.visible=!1},drop(e){if(this.hide(),e.stopPropagation(),e.preventDefault(),!!e.dataTransfer)for(const t of e.dataTransfer.items)t.kind==="file"&&t.type.match(/image.*/)&&this.$emit("drop",t.getAsFile())}}});function qi(e,t,o,s,n,r){return e.visible?(p(),b("div",{key:0,onDragleave:t[0]||(t[0]=i=>e.visible=!1),onDrop:t[1]||(t[1]=(...i)=>e.drop&&e.drop(...i)),class:F({vertical:e.vertical})},[ye(e.$slots,"default",{},void 0,!0)],34)):S("",!0)}var us=H(Yi,[["render",qi],["__scopeId","data-v-5ea72163"]]);const Ki=D({props:{icon:{type:String,required:!0},iconPos:{type:String,default:"left"},disabled:{type:Boolean,default:!1},shortcut:{type:String,default:null}},computed:{showPopup(){return!!this.shortcut&&!this.shortcut.startsWith("!")},popupText(){const e=this.shortcut;return e?e.startsWith("!")?e.substring(1):e:""}}}),Ji=["disabled"],Zi={class:"material-icons","aria-hidden":"true"},Qi={class:"content"},er={key:0,class:"shortcut-popup"};function tr(e,t,o,s,n,r){return p(),b("button",{class:F([e.iconPos]),disabled:e.disabled},[a("div",Zi,V(e.icon),1),a("div",Qi,[ye(e.$slots,"default",{},void 0,!0)]),e.showPopup?(p(),b("div",er,V(e.popupText),1)):S("",!0)],10,Ji)}var mt=H(Ki,[["render",tr],["__scopeId","data-v-444de4eb"]]);const hs={packId:"dddg.buildin.uploadedSprites",packCredits:[""],dependencies:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},or=D({mixins:[ee],components:{DropTarget:us,DButton:mt},data:()=>({isWebPSupported:null,customAssetCount:0,group:"characters"}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},characters(){return this.$store.state.content.current.characters},sprites(){return this.$store.state.content.current.sprites},hasClipboardContent(){return!!this.$store.state.ui.clipboard},showSpritesFolder(){return B.supports.openableFolders.has("sprites")}},methods:{assetSpriteBackground(e){return e.variants[0].map(t=>`url('${t.lq}')`).join(",")},assetPath(e){return e.chibi?B.supports.lq?e.chibi.lq:e.chibi.hq:""},showDropTarget(e){!e.dataTransfer||(e.dataTransfer.effectAllowed="none",!!Array.from(e.dataTransfer.items).find(t=>t.type.match(/^image.*$/))&&(e.dataTransfer.effectAllowed="link",this.group==="sprites"&&this.$refs.spriteDt.show()))},hideDropTarget(){this.group==="sprites"&&this.$refs.spriteDt.hide()},onSpriteFileUpload(){const e=this.$refs.spriteUpload;if(!!e.files)for(const t of e.files)this.addCustomSpriteFile(t)},async uploadFromURL(){const e=prompt("Enter the URL of the image");if(!e)return;const t=e.split("/").slice(-1)[0];this.addNewCustomSprite(t,e)},async addSpriteToScene(e){await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createSprite",{panelId:this.currentPanel.id,assets:e.variants[0]})})},addTextBox(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createTextBox",{panelId:this.currentPanel.id})})},addChoice(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createChoice",{panelId:this.currentPanel.id})})},addDialog(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createNotification",{panelId:this.currentPanel.id})})},addPoem(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createPoem",{panelId:this.currentPanel.id})})},addConsole(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createConsole",{panelId:this.currentPanel.id})})},paste(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/pasteObjectFromClipboard",{panelId:this.currentPanel.id})})},onChosen(e){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createCharacters",{characterType:e,panelId:this.currentPanel.id})})},addCustomSpriteFile(e){const t=URL.createObjectURL(e);this.addNewCustomSprite(e.name,t)},addNewCustomSprite(e,t){hs.sprites.push({id:t,label:e,variants:[[t]],defaultScale:[1,1],hd:null}),this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:hs,processed:!1})})},openSpritesFolder(){B.openFolder("sprites")}},async created(){this.isWebPSupported=await Be()}}),sr=e=>(G("data-v-410ce66a"),e=e(),Y(),e),nr=v("Drop here to add as a new sprite "),ir=sr(()=>a("h1",null,"Add",-1)),rr=v(" Char\xADacters "),ar=v(" Sprites "),lr=v(" UI "),dr=["title","onClick","onKeypress"],cr=["src","alt"],ur=v(" Search in content packs "),hr=["title","onClick"],pr=v(" Upload new sprite "),fr=v(" New sprite from URL "),gr=v(" Search in content packs "),br=v(" Open sprites folder "),mr=["disabled"];function yr(e,t,o,s,n,r){const i=C("drop-target"),l=C("d-button");return e.isWebPSupported!==void 0?(p(),b("div",{key:0,class:"panel",onDragenter:t[13]||(t[13]=(...d)=>e.showDropTarget&&e.showDropTarget(...d)),onMouseleave:t[14]||(t[14]=(...d)=>e.hideDropTarget&&e.hideDropTarget(...d))},[y(i,{ref:"spriteDt",class:"drop-target",onDrop:e.addCustomSpriteFile},{default:w(()=>[nr]),_:1},8,["onDrop"]),ir,a("div",{class:F({"group-selector":!0,vertical:e.vertical})},[y(l,{class:F({active:e.group==="characters"}),"icon-pos":"top",icon:"emoji_people",onClick:t[0]||(t[0]=d=>e.group="characters")},{default:w(()=>[rr]),_:1},8,["class"]),y(l,{class:F({active:e.group==="sprites"}),"icon-pos":"top",icon:"change_history",onClick:t[1]||(t[1]=d=>e.group="sprites")},{default:w(()=>[ar]),_:1},8,["class"]),y(l,{class:F({active:e.group==="ui"}),"icon-pos":"top",icon:"view_quilt",onClick:t[2]||(t[2]=d=>e.group="ui")},{default:w(()=>[lr]),_:1},8,["class"])],2),a("div",{class:F({"item-grid":!0,vertical:e.vertical})},[e.group==="characters"?(p(),b(_,{key:0},[(p(!0),b(_,null,L(e.characters,d=>(p(),b("div",{class:"character",tabindex:"0",key:d.id,title:d.label,onClick:I(c=>e.onChosen(d.id.toLowerCase()),["left"]),onKeypress:[Q(c=>e.onChosen(d.id.toLowerCase()),["enter"]),Q(c=>e.onChosen(d.id.toLowerCase()),["space"])]},[a("img",{src:e.assetPath(d),alt:d.label},null,8,cr)],40,dr))),128)),y(l,{class:"custom-sprite",icon:"extension",onClick:t[3]||(t[3]=d=>e.$emit("show-dialog","type: Characters"))},{default:w(()=>[ur]),_:1})],64)):S("",!0),e.group==="sprites"?(p(),b(_,{key:1},[(p(!0),b(_,null,L(e.sprites,d=>(p(),b("div",{class:"sprite",key:d.label,title:d.label,style:K({background:e.assetSpriteBackground(d)}),onClick:c=>e.addSpriteToScene(d)},V(d.label),13,hr))),128)),y(l,{class:"custom-sprite",icon:"publish",onClick:t[5]||(t[5]=d=>e.$refs.spriteUpload.click())},{default:w(()=>[pr,a("input",{type:"file",ref:"spriteUpload",onChange:t[4]||(t[4]=(...d)=>e.onSpriteFileUpload&&e.onSpriteFileUpload(...d))},null,544)]),_:1}),y(l,{icon:"insert_link",onClick:e.uploadFromURL},{default:w(()=>[fr]),_:1},8,["onClick"]),y(l,{icon:"extension",onClick:t[6]||(t[6]=d=>e.$emit("show-dialog","type: Sprites"))},{default:w(()=>[gr]),_:1}),e.showSpritesFolder?(p(),x(l,{key:0,icon:"folder",onClick:e.openSpritesFolder},{default:w(()=>[br]),_:1},8,["onClick"])):S("",!0)],64)):S("",!0),e.group==="ui"?(p(),b(_,{key:2},[a("button",{onClick:t[7]||(t[7]=(...d)=>e.addTextBox&&e.addTextBox(...d))},"Textbox"),a("button",{onClick:t[8]||(t[8]=(...d)=>e.addPoem&&e.addPoem(...d))},"Poem"),a("button",{onClick:t[9]||(t[9]=(...d)=>e.addDialog&&e.addDialog(...d))},"Notification"),a("button",{onClick:t[10]||(t[10]=(...d)=>e.addChoice&&e.addChoice(...d))},"Choice"),a("button",{onClick:t[11]||(t[11]=(...d)=>e.addConsole&&e.addConsole(...d))},"Console")],64)):S("",!0),a("button",{onClick:t[12]||(t[12]=(...d)=>e.paste&&e.paste(...d)),disabled:!e.hasClipboardContent},"Paste",8,mr)],2)],32)):S("",!0)}var vr=H(or,[["render",yr],["__scopeId","data-v-410ce66a"]]);function Je(e,t,o){let s=t+o;const n=e.length;return s<0&&(s+=n),s>=n&&(s-=n),s}const yt=1280,oo=720,wr=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],Cr=1,$r=1/1.5,kr=-74,xr=-26,Sr=[200,240,400,493,640,786,880,1040,1080];var Pr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",screenWidth:yt,screenHeight:oo,positions:wr,sdCharacterScaleFactor:Cr,hdCharacterScaleFactor:$r,CloseUpYOffset:kr,BaseCharacterYPos:xr,characterPositions:Sr});const Te=class{constructor(t,o,s,n){this.r=t,this.g=o,this.b=s,this.a=n}static validCss(t){return this.validCssRgb(t)||this.validHex(t)}static fromCss(t){if(this.validCssRgb(t))return this.fromCssRgb(t);if(this.validHex(t))return this.fromHex(t);throw new Error("Invalid RGB color format")}static validCssRgb(t){return this.rgbEx.test(t)||this.rgbaEx.test(t)}static fromCssRgb(t){if(!this.validCssRgb(t))throw new Error("Invalid RGB color format");const o=t.slice(0,-1),s=o.indexOf("("),r=o.slice(s+1).split(",").map(i=>parseFloat(i.trim()));return new Te(r[0],r[1],r[2],r.length===4?r[3]:1)}static validHex(t){return this.hexShortEx.test(t)||this.hexLongEx.test(t)}static fromHex(t){if(!this.validHex(t))throw new Error("Invalid Hex color format");const o=t.slice(1);if(o.length===3)return new Te(parseInt(o[0]+o[0],16),parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),1);if(o.length===4)return new Te(parseInt(o[0]+o[0],16),parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)/255);if(o.length===6)return new Te(parseInt(o[0]+o[1],16),parseInt(o[2]+o[3],16),parseInt(o[4]+o[5],16),1);if(o.length===8)return new Te(parseInt(o[0]+o[1],16),parseInt(o[2]+o[3],16),parseInt(o[4]+o[5],16),parseInt(o[6]+o[7],16)/255);throw new Error("Invalid Hex color format length")}toCss(){return this.a>1?`rgb(${this.r},${this.g},${this.b})`:`rgba(${this.r},${this.g},${this.b},${this.a})`}toHex(){return`#${Math.round(this.r).toString(16).padStart(2,"0")}${Math.round(this.g).toString(16).padStart(2,"0")}${Math.round(this.b).toString(16).padStart(2,"0")}${Math.round(this.a*255).toString(16).padStart(2,"0")}`}toRgb(){return this}toHSL(){let{r:t,g:o,b:s}=this;const{a:n}=this;t/=255,o/=255,s/=255;const r=Math.max(t,o,s),i=Math.min(t,o,s);let l,d;const c=(r+i)/2;if(r===i)l=d=0;else{const u=r-i;switch(d=c>.5?u/(2-r-i):u/(r+i),r){case t:l=(o-s)/u+(o<s?6:0);break;case o:l=(s-t)/u+2;break;case s:l=(t-o)/u+4;break}l/=6}return new W(l,d,c,n)}get luminance(){return Math.sqrt(Math.pow(.299*(this.r/255),2)+Math.pow(.587*(this.g/255),2)+Math.pow(.114*(this.b/255),2))}};let A=Te;g(A,"rgbEx",/^rgb\((\d*?),(\d*?),(\d*?)\)$/i),g(A,"rgbaEx",/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([\d.]+)\)$/i),g(A,"hexShortEx",/^#[0-9A-Z]{3,4}$/i),g(A,"hexLongEx",/^#[0-9A-Z]{6,8}$/i);class W{constructor(t,o,s,n){this.h=t,this.s=o,this.l=s,this.a=n,Object.freeze(this)}toCss(){return this.a>=1?`hsl(${this.h}, ${this.s}, ${this.l})`:`hsla(${this.h}, ${this.s}, ${this.l}, ${this.a})`}shift(t){let{h:o,s,l:n,a:r}=this;return o+=t.h,o>=1?o-=1:o<0&&(o+=1),s+t.s>1?s-=t.s:(s+=t.s,s<0&&(s=0)),n+t.l>1||n+t.l<0?n-=t.l:n+=t.l,r+t.a>1||r+t.a<0?r-=t.a:r+=t.a,new W(o,s,n,r)}toRgb(){const{h:t,s:o,l:s,a:n}=this;let r,i,l;if(o===0)r=i=l=s;else{const d=s<.5?s*(1+o):s+o-s*o,c=2*s-d;r=W.hue2rgb(c,d,t+1/3),i=W.hue2rgb(c,d,t),l=W.hue2rgb(c,d,t-1/3)}return new A(Math.round(r*255),Math.round(i*255),Math.round(l*255),n)}toHSL(){return this}static hue2rgb(t,o,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+(o-t)*6*s:s<1/2?o:s<2/3?t+(o-t)*(2/3-s)*6:t}}const jr=new W(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Tr="#ffe6f4",Ir="#ffbde1",_r=420,Br=22,Or=640,ps=270,Dr=7,Hr=3,Ar=(oo-ps)/2,Rr={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0};var Mr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",nameboxTextOutlineDelta:jr,ChoiceButtonColor:Tr,ChoiceButtonBorderColor:Ir,ChoiceButtonWidth:_r,ChoiceSpacing:Br,ChoiceX:Or,ChoiceYOffset:ps,ChoicePadding:Dr,Outline:Hr,ChoiceY:Ar,ChoiceTextStyle:Rr});const fs="#ffa8d2",Fr="#552222",Nr="#ffeef6",so="#bb5599",gs=new W(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),bs=new W(.002028397565922768,0,.13725490196078438,0),ms=.82,ys=new W(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),vs=12,Vr=1.5,no=12,ue=1.5,Wr=.6,Er=new W(.08045977011494243,-.5714285714285714,-.5960784313725489,0),Lr=new W(0,-.14285714285714296,.3,0),ws=new W(.004269293924466178,-.01869158878504662,-.039215686274509665,0),io=9.5,he=47,Cs=new W(.0023347701149424305,0,.10784313725490202,0),$s=3;var Ur=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",textboxDefaultColor:fs,controlsDefaultColor:Fr,nameboxDefaultColor:Nr,nameboxStrokeDefaultColor:so,nameboxTextOutlineDelta:gs,nameboxBackgroundDelta:bs,nameboxGradientMiddleStopPosition:ms,nameboxGradientEndDelta:ys,nameboxRounding:vs,nameboxRoundingBuffer:Vr,textboxRounding:no,textboxRoundingBuffer:ue,nameColorThreshold:Wr,controlColorDelta:Er,controlDisableColorDelta:Lr,dotColorDelta:ws,dotRadius:io,dotPatternSize:he,textboxOutlineColorDelta:Cs,textboxOutlineWidth:$s});const De=816,ro=900,vt=146,zr=0,Xr=29,Gr=8,Ze=38,wt=44,Yr=6,qr=93,Kr=404,Jr=9,Zr=9,ie=39,Qe=168,et=34,Ct=29,ao=12,lo=-126,co=-72,uo=-38,ho=30.75,po=26,ks=426,fo=58,go={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},$t=k(m({},go),{fontName:"riffic",fontSize:24,strokeColor:so,strokeWidth:6,color:"white",letterSpacing:1}),bo={align:"left",font:"13px aller",fill:{style:"#522"}},xs=k(m({},bo),{fill:{style:"#a66"}}),Qr={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},mo={alpha:1,color:"#ffffff",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:4,lineSpacing:1.2},He=yt/2-De/2,ea=yt/2-ro/2,ta=He+Ze,Ss=He+et,oa=Ss+Qe/2,sa=He+lo,na=He+co,ia=He+uo,ra="normal";var aa=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",TextBoxWidth:De,TextBoxCorruptedWidth:ro,TextBoxHeight:vt,TextBoxKerning:zr,TextBoxLineHeight:Xr,TextBoxCorruptedKerning:Gr,TextBoxTextXOffset:Ze,TextBoxTextYOffset:wt,TextBoxBottomSpacing:Yr,HdSpacing:qr,HdSideMargin:Kr,TextBoxTextCorruptedXOffset:Jr,TextBoxTextCorruptedYOffset:Zr,NameboxHeight:ie,NameboxWidth:Qe,NameboxXOffset:et,NameboxTextYOffset:Ct,ControlsYBottomOffset:ao,ControlsXHistoryOffset:lo,ControlsXSkipOffset:co,ControlsXStuffOffset:uo,ArrowXRightOffset:ho,ArrowYBottomOffset:po,GlowRX:ks,GlowRY:fo,BaseTextStyle:go,NameboxTextStyle:$t,ControlsTextStyle:bo,ControlsTextDisabledStyle:xs,TextBoxCorruptedStyle:Qr,TextBoxStyle:mo,TextBoxX:He,TextBoxCorruptedX:ea,TextBoxTextX:ta,NameboxX:Ss,NameboxTextX:oa,ControlsXHistory:sa,ControlsXSkip:na,ControlsXStuff:ia,DefaultTextboxStyle:ra});const la="#ffe6f4",da="#ffbde1",ca="rgba(255,255,255,0.6)",ua=40,ha=30,pa=k(m({},go),{fontName:"riffic",fontSize:24,strokeColor:so,strokeWidth:8,letterSpacing:1,color:"white"}),fa={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0};var ga=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",NotificationBackgroundColor:la,NotificationBorderColor:da,NotificationBackdropColor:ca,NotificationPadding:ua,NotificationSpacing:ha,NotificationOkTextStyle:pa,NotificationTextStyle:fa});const Ps=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],ba=0,ma=0,ya=yt/2,va=oo/2,wa=33,Ca=100,$a=30,ka=800,xa=720,Sa="rgba(51,51,51,0.75)",Pa=480,ja=180,Ta=3,Ia=7,we={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:12},js=[k(m({},we),{name:"Sayori",fontName:"hashtag",fontSize:34,lineSpacing:1.05,letterSpacing:0}),k(m({},we),{name:"Natsuki",fontName:"ammy_handwriting",fontSize:28}),k(m({},we),{name:"Monika",fontName:"journal",fontSize:34}),k(m({},we),{name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.5,fontSize:32}),k(m({},we),{name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:18,letterSpacing:-8}),k(m({},we),{name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:40}),k(m({},we),{name:"MC",fontName:"halogen",fontSize:30,lineSpacing:1.53}),k(m({},we),{name:"Console",fontName:"f25_bank_printer",fontSize:18,color:"white",lineSpacing:1.1})];var _a=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",poemBackgrounds:Ps,defaultPoemBackground:ba,defaultPoemStyle:ma,defaultX:ya,defaultY:va,poemTopPadding:wa,poemBottomPadding:Ca,poemPadding:$a,defaultPoemWidth:ka,defaultPoemHeight:xa,consoleBackgroundColor:Sa,consoleWidth:Pa,consoleHeight:ja,defaultConsoleBackground:Ta,defaultConsoleStyle:Ia,poemTextStyles:js}),Ba={Base:Pr,Choices:Mr,Notification:ga,Poem:_a,TextBox:aa,TextBoxCustom:Ur};const kt=1920,yo=1080,Oa=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],Da=1.5,Ha=1,Aa=-111,Ra=-39,Ma=[300,360,600,740,960,1180,1320,1560,1620];var Fa=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",screenWidth:kt,screenHeight:yo,positions:Oa,sdCharacterScaleFactor:Da,hdCharacterScaleFactor:Ha,CloseUpYOffset:Aa,BaseCharacterYPos:Ra,characterPositions:Ma});const Na=new W(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Va="#ffe6f4",Wa="#ffbde1",Ea=630,La=33,Ua=960,Ts=405,za=10.5,Xa=4.5,Ga=(yo-Ts)/2,Ya={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0};var qa=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",nameboxTextOutlineDelta:Na,ChoiceButtonColor:Va,ChoiceButtonBorderColor:Wa,ChoiceButtonWidth:Ea,ChoiceSpacing:La,ChoiceX:Ua,ChoiceYOffset:Ts,ChoicePadding:za,Outline:Xa,ChoiceY:Ga,ChoiceTextStyle:Ya});const Is="#ffa8d2",Ka="#552222",Ja="#ffeef6",vo="#bb5599",_s=new W(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Bs=new W(.002028397565922768,0,.13725490196078438,0),Os=.82,Ds=new W(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),Hs=15,Za=1.5,wo=19,pe=1.5,Qa=.6,el=new W(.08045977011494243,-.5714285714285714,-.5960784313725489,0),tl=new W(0,-.14285714285714296,.3,0),As=new W(.004269293924466178,-.01869158878504662,-.039215686274509665,0),Co=9.5*1.5,fe=47*1.5,Rs=new W(.0023347701149424305,0,.10784313725490202,0),Ms=5;var ol=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",textboxDefaultColor:Is,controlsDefaultColor:Ka,nameboxDefaultColor:Ja,nameboxStrokeDefaultColor:vo,nameboxTextOutlineDelta:_s,nameboxBackgroundDelta:Bs,nameboxGradientMiddleStopPosition:Os,nameboxGradientEndDelta:Ds,nameboxRounding:Hs,nameboxRoundingBuffer:Za,textboxRounding:wo,textboxRoundingBuffer:pe,nameColorThreshold:Qa,controlColorDelta:el,controlDisableColorDelta:tl,dotColorDelta:As,dotRadius:Co,dotPatternSize:fe,textboxOutlineColorDelta:Rs,textboxOutlineWidth:Ms});const $o=1220,Fs=900,Ns=219,sl=0,nl=29,il=8,ko=57,Vs=68,rl=54,al=9,ll=9,Ae=59,xo=252,So=49,Ws=43,Es=12*1.5,Ls=-126*1.5,Us=-72*1.5,zs=-38*1.5,Xs=30.75*1.5,Gs=26*1.5,Ys=426*1.5,Po=58*1.5,jo={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:1,lineSpacing:1.2,strokeColor:"",strokeWidth:0},qs=k(m({},jo),{fontName:"riffic",fontSize:36,strokeColor:vo,strokeWidth:9,color:"white",letterSpacing:2}),xt={align:"left",font:"24px aller",fill:{style:"#522"}},Ks=k(m({},xt),{fill:{style:"#a66"}}),Js={alpha:1,color:"#ffffff",fontName:"aller",fontSize:30,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:5,lineSpacing:1.2},dl={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},Re=kt/2-$o/2,cl=kt/2-Fs/2,ul=Re+ko,Zs=Re+So,hl=Zs+xo/2,pl=Re+Ls,fl=Re+Us,gl=Re+zs,bl="custom_plus";var ml=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",TextBoxWidth:$o,TextBoxCorruptedWidth:Fs,TextBoxHeight:Ns,TextBoxKerning:sl,TextBoxLineHeight:nl,TextBoxCorruptedKerning:il,TextBoxTextXOffset:ko,TextBoxTextYOffset:Vs,TextBoxBottomSpacing:rl,TextBoxTextCorruptedXOffset:al,TextBoxTextCorruptedYOffset:ll,NameboxHeight:Ae,NameboxWidth:xo,NameboxXOffset:So,NameboxTextYOffset:Ws,ControlsYBottomOffset:Es,ControlsXHistoryOffset:Ls,ControlsXSkipOffset:Us,ControlsXStuffOffset:zs,ArrowXRightOffset:Xs,ArrowYBottomOffset:Gs,GlowRX:Ys,GlowRY:Po,BaseTextStyle:jo,NameboxTextStyle:qs,ControlsTextStyle:xt,ControlsTextDisabledStyle:Ks,TextBoxStyle:Js,TextBoxCorruptedStyle:dl,TextBoxX:Re,TextBoxCorruptedX:cl,TextBoxTextX:ul,NameboxX:Zs,NameboxTextX:hl,ControlsXHistory:pl,ControlsXSkip:fl,ControlsXStuff:gl,DefaultTextboxStyle:bl});const yl="#ffe6f4",vl="#ffbde1",wl="rgba(255,255,255,0.6)",Cl=60,$l=45,kl=k(m({},jo),{fontName:"riffic",fontSize:36,strokeColor:vo,strokeWidth:12,letterSpacing:1,color:"white"}),xl={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0};var Sl=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",NotificationBackgroundColor:yl,NotificationBorderColor:vl,NotificationBackdropColor:wl,NotificationPadding:Cl,NotificationSpacing:$l,NotificationOkTextStyle:kl,NotificationTextStyle:xl});const Pl=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],jl=0,Tl=0,Il=kt/2,_l=yo/2,Bl=33,Ol=100,Dl=30,Hl=800,Al=720,Rl="rgba(51,51,51,0.75)",Ml=480,Fl=180,Nl=3,Vl=7,Ce={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:12},Wl=[k(m({},Ce),{name:"Sayori",fontName:"hashtag",fontSize:34,lineSpacing:1.05,letterSpacing:0}),k(m({},Ce),{name:"Natsuki",fontName:"ammy_handwriting",fontSize:28}),k(m({},Ce),{name:"Monika",fontName:"journal",fontSize:34}),k(m({},Ce),{name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.5,fontSize:32}),k(m({},Ce),{name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:18,letterSpacing:-8}),k(m({},Ce),{name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:40}),k(m({},Ce),{name:"MC",fontName:"halogen",fontSize:30,lineSpacing:1.53}),k(m({},Ce),{name:"Console",fontName:"f25_bank_printer",fontSize:18,color:"white",lineSpacing:1.1})];var El=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",poemBackgrounds:Pl,defaultPoemBackground:jl,defaultPoemStyle:Tl,defaultX:Il,defaultY:_l,poemTopPadding:Bl,poemBottomPadding:Ol,poemPadding:Dl,defaultPoemWidth:Hl,defaultPoemHeight:Al,consoleBackgroundColor:Rl,consoleWidth:Ml,consoleHeight:Fl,defaultConsoleBackground:Nl,defaultConsoleStyle:Vl,poemTextStyles:Wl}),Ll={Base:Fa,Choices:qa,Notification:Sl,Poem:El,TextBox:ml,TextBoxCustom:ol};function T(){return B.gameMode==="ddlc_plus"?Ll:Ba}function Me(){return{flip:!1,rotation:0,version:0,opacity:100,x:T().Base.screenWidth/2,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!1,nameboxWidth:null,zoom:1}}const Ul={setPose(e,t){const o=e.panels[t.panelId].objects[t.id];o.poseId=t.poseId,++o.version},setCharStyleGroup(e,{id:t,panelId:o,styleGroupId:s}){const n=e.panels[o].objects[t];n.styleGroupId=s,++n.version},setCharStyle(e,{id:t,panelId:o,styleId:s}){const n=e.panels[o].objects[t];n.styleId=s,++n.version},setClose(e,t){const o=e.panels[t.panelId].objects[t.id];o.close=t.close,++o.version},setPosePosition(e,t){const o=e.panels[t.panelId].objects[t.id];o.posePositions=m(m({},o.posePositions),t.posePositions),++o.version},setFreeMove(e,t){const o=e.panels[t.panelId].objects[t.id];if(o.freeMove=t.freeMove,!o.freeMove){const s=T();o.x=s.Base.characterPositions[Pt(o.x)],o.y=s.Base.BaseCharacterYPos}}};function St(e,t){return e.getters["content/getCharacters"].get(t.characterType)}function Pe(e,t){return e["content/getCharacters"].get(t)}function $e(e,t){return e.styleGroups[t.styleGroupId].styles[t.styleId].poses[t.poseId]}function zl(e,t){const o=$e(e,t),s=[...Object.keys(o.positions).filter(n=>o.positions[n].length>1)];return o.compatibleHeads.length>0&&s.unshift("head"),s}function To(e,t,o=t.posePositions.headType||0){const s=$e(e,t).compatibleHeads;return!s||s.length===0?null:e.heads[s[o]]}function Pt(e){return T().Base.characterPositions.map((s,n)=>({pos:Math.abs(e-s),idx:n})).sort((s,n)=>s.pos-n.pos)[0].idx}const Xl={createCharacters({rootState:e,rootGetters:t,commit:o,state:s},n){const r=s.panels[n.panelId].lastObjId+1,i=T(),l=Pe(t,n.characterType),d=l.hd?i.Base.hdCharacterScaleFactor:i.Base.sdCharacterScaleFactor;return o("create",{object:k(m({},Me()),{id:r,panelId:e.panels.currentPanel,onTop:!1,type:"character",y:i.Base.BaseCharacterYPos,preserveRatio:!0,ratio:1,width:l.size[0]*l.defaultScale[0]*d,height:l.size[1]*l.defaultScale[1]*d,characterType:n.characterType,close:!1,freeMove:!1,poseId:0,styleId:0,styleGroupId:0,posePositions:{},label:l.label||l.id,enlargeWhenTalking:e.ui.defaultCharacterTalkingZoom})}),r},seekPart({state:e,commit:t,dispatch:o,rootGetters:s},{delta:n,id:r,panelId:i,part:l}){if(l==="head"){o("seekHead",{id:r,panelId:i,delta:n});return}const d=e.panels[i].objects[r],c=$e(Pe(s,d.characterType),d);!c.positions[l]||t("setPosePosition",{id:r,panelId:i,posePositions:{[l]:Je(c.positions[l],d.posePositions[l]||0,n)}})},seekPose({state:e,commit:t,rootGetters:o},{id:s,panelId:n,delta:r}){const i=e.panels[n].objects[s],l=Pe(o,i.characterType),d=l.styleGroups[i.styleGroupId].styles[i.styleId].poses;Fe(t,i,l,c=>{c.poseId=Je(d,c.poseId,r)})},seekStyle({state:e,commit:t,rootGetters:o},{id:s,panelId:n,delta:r}){const i=e.panels[n].objects[s],l=Pe(o,i.characterType),d=l.styleGroups.flatMap((u,h)=>u.styles.map((f,P)=>({styleGroupIdx:h,styleIdx:P,styleGroupJson:JSON.stringify(f.components)}))).sort((u,h)=>u.styleGroupJson.localeCompare(h.styleGroupJson)),c=d.findIndex(u=>u.styleGroupIdx===i.styleGroupId&&u.styleIdx===i.styleId);Fe(t,i,l,u=>{const h=Je(d,c,r),f=d[h];u.styleGroupId=f.styleGroupIdx,u.styleId=f.styleIdx})},seekHead({state:e,commit:t,rootGetters:o},{id:s,panelId:n,delta:r}){const i=e.panels[n].objects[s],l=Pe(o,i.characterType),d=$e(l,i);let c=To(l,i);if(!c)return;let u=(i.posePositions.head||0)+r,h=i.posePositions.headType||0;(u<0||u>=c.variants.length)&&(h=Je(d.compatibleHeads.map(f=>l.heads[f]),h,r),c=To(l,i,h),u=r===1?0:c.variants.length-1),t("setPosePosition",{id:s,panelId:n,posePositions:{head:u,headType:h}})},setPart({state:e,commit:t,rootGetters:o},{panelId:s,id:n,part:r,val:i}){const l=e.panels[s].objects[n],d=Pe(o,l.characterType);r==="pose"?Fe(t,l,d,c=>{c.poseId=i}):r==="style"?Fe(t,l,d,c=>{c.styleId=i}):Fe(t,l,d,c=>{c.posePositions[r]=i})},setCharStyle({state:e,commit:t,rootGetters:o},{panelId:s,id:n,styleGroupId:r,styleId:i}){const l=e.panels[s].objects[n],d=Pe(o,l.characterType);Fe(t,l,d,c=>{c.styleGroupId=r,c.styleId=i})},setCharacterPosition({state:e,commit:t},{panelId:o,id:s,x:n,y:r}){const i=e.panels[o].objects[s];if(i.freeMove)t("setPosition",{panelId:o,id:s,x:n,y:r});else{const l=T();t("setPosition",{panelId:o,id:s,x:l.Base.characterPositions[Pt(n)],y:l.Base.BaseCharacterYPos+(i.close?l.Base.CloseUpYOffset:0)})}},shiftCharacterSlot({state:e,commit:t},{panelId:o,id:s,delta:n}){const r=e.panels[o].objects[s],i=T();let d=Pt(r.x)+n;d<0&&(d=0),d>=i.Base.characterPositions.length&&(d=i.Base.characterPositions.length-1),t("setPosition",{panelId:o,id:s,x:i.Base.characterPositions[d],y:r.y})}};async function Gl(e,t,o,s){const n=e.state.panels[t].objects[o],r=s.characters.find(U=>U.id===n.characterType);if(!r){console.error("Character data is missing. Dropping the character."),await e.dispatch("removeObject",{id:o,panelId:t});return}const i=Qs(n),l=r.styleGroups[n.styleGroupId],d=l.styles[i.styleId],c=d.poses[i.poseId],u=e.rootState.content.current.characters.find(U=>U.id===r.id);if(!u){console.error("Character data is missing. Dropping the character."),await e.dispatch("removeObject",{id:o,panelId:t});return}const h=u.styleGroups.findIndex(U=>U.id===l.id);i.styleGroupId=h===-1?0:h;const f=u.styleGroups[i.styleGroupId],P=JSON.stringify(d.components),j=f.styles.findIndex(U=>JSON.stringify(U.components)===P);i.styleId=j===-1?0:j;const $=f.styles[i.styleId],le=$.poses.findIndex(U=>U.id===c.id);i.poseId=le===-1?0:le;const N=$.poses[i.poseId],Ie={};for(const U in N.positions){if(!N.positions.hasOwnProperty(U))continue;const Se=N.positions[U];if(c.positions[U]){const Ge=i.posePositions[U];Ge>=0&&Ge<Se.length?Ie[U]=Ge:Ie[U]=0}else Ie[U]=0}const O=c.compatibleHeads[n.posePositions.headType],_e=N.compatibleHeads.indexOf(O);if(_e===-1)i.posePositions.headType=0,i.posePositions.head=0;else{_e!==n.posePositions.headType&&(i.posePositions.headType=_e);const U=JSON.stringify(r.heads[O].variants[n.posePositions.head]),Se=u.heads[O].variants.findIndex(Ge=>JSON.stringify(Ge)===U);Se===-1?i.posePositions.head=0:i.posePositions.head=Se}en(e.commit,n,i)}function Qs(e){return{styleGroupId:e.styleGroupId,styleId:e.styleId,poseId:e.poseId,posePositions:m({},e.posePositions)}}function en(e,t,o){o.styleGroupId!==t.styleGroupId&&e("setCharStyleGroup",{id:t.id,panelId:t.panelId,styleGroupId:o.styleGroupId}),o.styleId!==t.styleId&&(console.log(`Setting style of ${t.id} to ${o.styleId}`),e("setCharStyle",{id:t.id,panelId:t.panelId,styleId:o.styleId})),o.poseId!==t.poseId&&e("setPose",{id:t.id,panelId:t.panelId,poseId:o.poseId}),JSON.stringify(o.posePositions)!==JSON.stringify(t.posePositions)&&e("setPosePosition",{id:t.id,panelId:t.panelId,posePositions:o.posePositions})}function Fe(e,t,o,s){const n=Qs(t);s(n),o.styleGroups[n.styleGroupId]||(n.styleGroupId=0);const r=o.styleGroups[n.styleGroupId];r.styles[n.styleId]||(n.styleId=0);const i=r.styles[n.styleId];i.poses[n.poseId]||(n.poseId=0);const l=i.poses[n.poseId];for(const h in l.positions)!l.positions[h]||l.positions[h][n.posePositions[h]]||(n.posePositions[h]=0);const c=o.styleGroups[t.styleGroupId].styles[t.styleId].poses[t.poseId].compatibleHeads[t.posePositions.headType||0],u=l.compatibleHeads.indexOf(c);u>=0?n.posePositions.headType=u:(n.posePositions.headType=0,n.posePositions.head=0),en(e,t,n)}const Yl=D({props:{title:{required:!0,type:String}}}),ql={class:"fieldset_wrapper"},Kl={key:0},Jl={class:"fieldset_contents"};function Zl(e,t,o,s,n,r){return p(),b("div",ql,[a("fieldset",null,[e.title>""?(p(),b("legend",Kl,V(e.title),1)):S("",!0),a("div",Jl,[ye(e.$slots,"default",{},void 0,!0)])])])}var re=H(Yl,[["render",Zl],["__scopeId","data-v-6781d4a8"]]);const tn=960,Ql=D({props:{part:{required:!0},value:{required:!0},size:{type:Number,default:150}},data:()=>({lookups:[],loaded:!1}),computed:{scaleX(){return this.size/this.part.size[0]},scaleY(){return this.size/this.part.size[1]},backgroundSize(){return`${Math.floor(tn*this.scaleX)}px ${Math.floor(tn*this.scaleY)}px`},backgroundPosition(){return`${Math.floor(this.part.offset[0]*-this.scaleX)}px ${Math.floor(this.part.offset[1]*-this.scaleY)}px`},background(){let e="";const t=this.backgroundSize,o=this.part.offset||[0,0];for(let s=0;s<this.part.images.length;++s){const n=this.part.images[s],r=this.lookups[s];if(!(r instanceof qe))continue;s>0&&(e+=", ");const i=n.offset||[0,0],l=`${Math.floor((o[0]-i[0])*-this.scaleX)}px ${Math.floor((o[1]-i[1])*-this.scaleY)}px`;e+=`url('${r.html.src.replace("'","\\'")}') ${l} / ${t}`}return e},style(){return{height:this.size+"px",width:this.size+"px",background:this.background}}},async created(){this.lookups=await Promise.all(this.part.images.map(e=>typeof e.asset=="string"?ce(e.asset,!1):Oe(e.asset,!1)))},methods:{quickClick(e){e.preventDefault(),this.$emit("quick-click")}}});function ed(e,t,o,s,n,r){var i;return p(),b("div",{class:F({part:!0,active:(i=e.part)==null?void 0:i.active}),style:K(e.style),tabindex:"0",onClick:t[0]||(t[0]=l=>e.$emit("click")),onContextmenu:t[1]||(t[1]=(...l)=>e.quickClick&&e.quickClick(...l)),onKeydown:[t[2]||(t[2]=Q(I(l=>e.$emit("click"),["prevent"]),["enter"])),t[3]||(t[3]=Q(I((...l)=>e.quickClick&&e.quickClick(...l),["prevent"]),["space"]))]},null,38)}var td=H(Ql,[["render",ed],["__scopeId","data-v-3cf59240"]]);const od=D({mixins:[Qt],props:{noWraping:{type:Boolean,default:!1},direction:{type:String,default:"global"},maxSize:{},gap:{type:String,default:"0px"}},computed:{finalDirection(){return this.direction==="global"?this.$store.state.ui.vertical?"vertical":"horizontal":this.direction==="inverted"?this.$store.state.ui.vertical?"horizontal":"vertical":this.direction}},render(){const e=this.noWraping?"no-wraping":"wraping",o=es("div",k(m({},{}),{class:["d-flow",this.finalDirection,e],style:{gap:this.gap}}),this.$slots.default());if(this.maxSize){const s=this.maxSize instanceof Array?this.maxSize[this.finalDirection==="horizontal"?0:1]:this.maxSize;return es("div",{ref:"scrollContainer",class:["d-flow-scroll-container",this.finalDirection],style:{[this.finalDirection==="horizontal"?"maxWidth":"maxHeight"]:s}},[o])}return o},mounted(){this.$refs.scrollContainer&&this.$refs.scrollContainer.addEventListener("wheel",this.verticalScrollRedirect)}});var tt=H(od,[["__scopeId","data-v-d6cdab54"]]);const sd=D({components:{PartButton:td,DFieldset:re,DFlow:tt},props:{character:{type:Object,required:!0},part:{required:!0,type:String}},data:()=>({isWebPSupported:null,stylePriorities:[]}),computed:{vertical(){return this.$store.state.ui.vertical},styleComponents(){if(this.part!=="style")return[];const e=this.charData.styleGroups[this.character.styleGroupId];return e.styleComponents.map(t=>{const o={};for(const s in t.variants){if(!t.variants.hasOwnProperty(s))continue;const n=t.variants[s];o[s]={size:e.styles[0].poses[0].size,offset:[0,0],images:[{offset:[0,0],asset:n}],active:!1}}return{label:t.label,name:t.id,buttons:o}})},parts(){const e={};let t,o,s;const n=this.charData,r=$e(n,this.character);switch(this.part){case"head":const i=this.character.posePositions.headType||0,l=this.character.posePositions.head||0;for(let c=0;c<r.compatibleHeads.length;++c){const u=r.compatibleHeads[c],h=n.heads[u];for(let f=0;f<h.variants.length;++f){const P=h.variants[f];e[`${c}_${f}`]={size:h.previewSize,offset:h.previewOffset,images:P.map(j=>({asset:j,offset:[0,0]})),active:l===f&&i===c}}}return e;case"pose":const d=n.styleGroups[this.character.styleGroupId].styles[this.character.styleId];for(let c=0;c<d.poses.length;++c){const u=d.poses[c];e[c]=this.generatePosePreview(u),e[c].active=c===this.character.poseId}return e;case"style":for(let c=0;c<n.styleGroups.length;++c){const u=n.styleGroups[c];e[u.id]=this.generatePosePreview(u.styles[0].poses[0]),e[u.id].active=c===this.character.styleGroupId}return e;default:t=r.positions[this.part],s=r.previewSize,o=r.previewOffset;break}for(let i=0;i<t.length;++i){const l=t[i];e[i]={images:l.map(d=>({offset:[0,0],asset:d})),size:s,offset:o,active:i===(this.character.posePositions[this.part]||0)}}return e},charData(){return St(this.$store,this.character)}},methods:{updateStyleData(){const e=this.charData.styleGroups[this.character.styleGroupId].styles[this.character.styleId];this.stylePriorities=Object.keys(e.components).map(t=>[t,e.components[t]])},generatePosePreview(e){const o=this.charData.heads[e.compatibleHeads[0]],s=o?o.variants[0]:null;let n=[];for(const r of e.renderCommands)switch(r.type){case"pose-part":const i=e.positions[r.part];if(!i||i.length===0)break;n=n.concat(i[0].map(l=>({asset:l,offset:r.offset})));break;case"head":s&&(n=n.concat(s.map(l=>({asset:l,offset:r.offset}))));break;case"image":n=n.concat(r.images.map(l=>({asset:l,offset:r.offset})));break}return{images:n,size:e.previewSize,offset:e.previewOffset,active:!1}},updatePose(e){e==null&&(e=this.character.styleGroupId);const o=this.charData.styleGroups[e];let s=o.styles;for(const n of this.stylePriorities){const r=s.filter(i=>i.components[n[0]]===n[1]);r.length>0&&(s=r)}this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/setCharStyle",{id:this.character.id,panelId:this.character.panelId,styleGroupId:e,styleId:o.styles.indexOf(s[0])})})},choose(e){if(this.part==="style")this.updatePose(this.charData.styleGroups.findIndex(t=>t.id===e));else if(this.part==="head"){const[t,o]=e.split("_",2).map(s=>parseInt(s,10));this.$store.commit("panels/setPosePosition",{id:this.character.id,panelId:this.character.panelId,posePositions:{headType:t,head:o}})}else this.setPart(this.part,parseInt(e,10))},choose_component(e,t){const o=this.stylePriorities.findIndex(s=>s[0]===e);this.stylePriorities.splice(o,1),this.stylePriorities.unshift([e,t]),this.updatePose()},onKeydown(e){(e.key==="Backspace"||e.key==="Escape")&&(this.$emit("leave"),e.preventDefault(),e.stopPropagation())},setPart(e,t){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPart",{id:this.character.id,panelId:this.character.panelId,part:e,val:t})})}},async created(){this.updateStyleData(),this.isWebPSupported=await Be()},watch:{character(){this.updateStyleData()}}}),ke=e=>(G("data-v-2f8f189f"),e=e(),Y(),e),nd=ke(()=>a("i",{class:"material-icons"},"extension",-1)),id=ke(()=>a("span",{class:"text-block"},"Create new expressions",-1)),rd=[nd,id],ad=ke(()=>a("i",{class:"material-icons"},"extension",-1)),ld=ke(()=>a("span",{class:"text-block"},"Search in content packs",-1)),dd=[ad,ld],cd=ke(()=>a("i",{class:"material-icons"},"extension",-1)),ud=ke(()=>a("span",null,"Search in content packs",-1)),hd=[cd,ud],pd=ke(()=>a("i",{class:"material-icons"},"extension",-1)),fd=ke(()=>a("span",null,"Search in content packs",-1)),gd=[pd,fd];function bd(e,t,o,s,n,r){const i=C("part-button"),l=C("d-flow"),d=C("d-fieldset");return p(),x(l,{"no-wraping":"",onKeydown:e.onKeydown},{default:w(()=>[a("button",{onClick:t[0]||(t[0]=c=>e.$emit("leave"))},"Back"),e.part==="head"?(p(),b("button",{key:0,onClick:t[1]||(t[1]=c=>e.$emit("show-expression-dialog",{character:e.character.characterType})),class:"icon-button"},rd)):S("",!0),e.part==="head"?(p(),b("button",{key:1,onClick:t[2]||(t[2]=c=>e.$emit("show-dialog","type: Expressions character: "+e.charData.label)),class:"icon-button"},dd)):e.part==="style"?(p(),b("button",{key:2,onClick:t[3]||(t[3]=c=>e.$emit("show-dialog","type: Styles character: "+e.charData.label)),class:"icon-button"},hd)):(p(),b("button",{key:3,onClick:t[4]||(t[4]=c=>e.$emit("show-dialog","type: Poses character: "+e.charData.label)),class:"icon-button"},gd)),(p(!0),b(_,null,L(e.parts,(c,u)=>(p(),x(i,{key:u,value:u,part:c,onClick:h=>{e.choose(u),e.$emit("leave")},onQuickClick:h=>e.choose(u)},null,8,["value","part","onClick","onQuickClick"]))),128)),(p(!0),b(_,null,L(e.styleComponents,c=>(p(),x(d,{key:c.name,title:c.label},{default:w(()=>[y(l,{noWraping:""},{default:w(()=>[(p(!0),b(_,null,L(c.buttons,(u,h)=>(p(),x(i,{size:130,key:h,value:h,part:u,onClick:f=>e.choose_component(c.name,h)},null,8,["value","part","onClick"]))),128))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["onKeydown"])}var md=H(sd,[["render",bd],["__scopeId","data-v-2f8f189f"]]);function ot(){return function(t,o,s=!1){return{get(){return this.object[t]},set(n){this.vuexHistory.transaction(()=>{this.$store[s?"dispatch":"commit"](o,{panelId:this.object.panelId,id:this.object.id,[t]:n})})}}}}function Io(e){return function(o){return{get(){return this.object[o]},set(s){this.vuexHistory.transaction(()=>{this.$store.commit(e,{panelId:this.object.panelId,id:this.object.id,key:o,value:s})})}}}}const on=5;class yd{constructor(t){g(this,"pos",0);this.str=t}current(){return this.str[this.pos]}get around(){return this.str.slice(Math.max(0,this.pos-on),this.pos+on)}get ahead(){return this.str[this.pos+1]}get behind(){return this.str[this.pos+1]}next(){return++this.pos,this.current()}}function sn(e,t=!0){const o=[],s=new yd(e);let n=jt;for(;n!==Tt;){const r=s.pos;try{n=n(o,s)}catch(i){if(t&&n!==_o)s.pos=r,n=(l,d)=>_o(l,d,!0);else throw i}}return o}function jt(e,t){return t.current()===void 0?Tt:t.current()==="{"?vd:t.current()===`
`?wd:_o}function Tt(){return Tt}function _o(e,t,o=!1){const{pos:s}=t;let n="",r=o,i;for(;;){if(t.current()===void 0){i=Tt;break}else if(r)n+=t.current(),r=!1;else if(t.current()==="\\")r=!0;else if(t.current()==="{"||t.current()===`
`){i=jt;break}else n+=t.current();t.next()}return e.push({type:"text",pos:s,content:n}),i}function Bo(e,t){throw new Error(`Error when parsing text at position ${e.pos}: (around: "${e.around}") ${t}`)}function vd(e,t){const{pos:o}=t;if(t.current()!=="{")throw new Error("Parser error: Command does not start with {");const s=t.next()==="/";s&&t.next();let n="",r="",i=!1;for(;t.current()===void 0&&Bo(t,"Unexpected end of text inside a command"),t.current()!=="}";)i?r+=t.current():t.current().match(/[a-z]/i)?n+=t.current():t.current()==="="?(s&&Bo(t,"Closing commands may not contain arguments"),i=!0):Bo(t,`Unexpected character '${t.current()}' in command name.`),t.next();return t.next(),s?e.push({type:"commandClose",commandName:n,pos:o}):e.push({type:"command",pos:o,argument:r,commandName:n}),jt}function wd(e,t){return e.push({type:"newline",pos:t.pos}),t.next(),jt}var Cd=new Map([Ne("i",e=>k(m({},e),{isItalic:!0})),Ne("b",e=>k(m({},e),{isBold:!0})),Ne("u",e=>k(m({},e),{isUnderlined:!0})),Ne("s",e=>k(m({},e),{isStrikethrough:!0})),Ne("plain",e=>k(m({},e),{isStrikethrough:!1,isUnderlined:!1,isBold:!1,isItalic:!1})),Ne("edited",e=>k(m({},e),{fontName:"verily",strokeColor:"#000000",strokeWidth:20,letterSpacing:8})),It("k",(e,t,o)=>k(m({},e),{letterSpacing:t?e.letterSpacing+o:o})),It("size",(e,t,o)=>k(m({},e),{fontSize:t?e.fontSize+o:o})),It("alpha",(e,t,o)=>k(m({},e),{alpha:t?e.alpha+o:o})),It("stroke",(e,t,o)=>k(m({},e),{strokeWidth:t?e.strokeWidth+o:o})),["font",(e,t)=>k(m({},e),{fontName:t})],["color",(e,t)=>k(m({},e),{color:t})],["outlinecolor",(e,t)=>k(m({},e),{strokeColor:t})]]);function Ne(e,t){return[e,(o,s)=>{if(s)throw new Error(`Operator '${e}' does not take any arguments.`);return t(o)}]}function It(e,t){return[e,(o,s)=>{if(!s)throw new Error(`Operator '${e}' needs an argument.`);const n=s[0]==="+"||s[0]==="-",r=Number(s);if(isNaN(r))throw new Error(`Operator '${e}' needs a numeric argument.`);return t(o,n,r)}]}const xe=class{constructor(t,o){g(this,"renderParts");g(this,"tokens");g(this,"loose");this.str=t,this.baseStyle=o,this.loose=B.state.looseTextParsing;try{this.tokens=sn(t,this.loose)}catch(s){if(s instanceof Error)this.tokens=[{type:"text",pos:0,content:s.message}];else throw s}this.rebuildParts()}rebuildParts(){this.renderParts=xe.getRenderParts(this.tokens,this.baseStyle,this.loose)}async loadFonts(){if(!("fonts"in document))return;const t=new Set;let o=null;for(const n of this.renderParts)"style"in n&&n.style!==o&&(o=n.style,o.fontName&&t.add(o.fontName));let s=!1;for(const n of t){const r=document,i=`8px ${n}`;r.fonts.check(i)||(s=!0,await r.fonts.load(i))}if(s){const n=sn(this.str);this.renderParts=xe.getRenderParts(n,this.baseStyle,this.loose)}}render(t){t.save();let o=null;for(const s of this.renderParts)s.type!=="newline"&&(s.style!==o&&(o=s.style,Do(o,t)),o.strokeWidth>0&&o.strokeColor>""&&t.strokeText(s.character,s.x,s.y));for(const s of this.renderParts)s.type!=="newline"&&(s.style!==o&&(o=s.style,Do(o,t)),t.fillText(s.character,s.x,s.y));t.restore()}quote(){var t;(function(r){r[r.None=0]="None",r[r.ExplictQuote=1]="ExplictQuote",r[r.ImplictQuote=2]="ImplictQuote",r[r.Star=3]="Star"})(t||(t={}));let o=-1,s=0;for(let r=0;r<this.renderParts.length;++r){const i=this.renderParts[r];if(i.type==="character")switch(s){case 0:if(i.character.match(/\s/))continue;i.character==='"'?(s=1,o=r):i.character==="*"?(s=3,o=r):(this.renderParts.splice(r,0,{type:"character",x:0,y:0,style:i.style,character:'"',height:i.height,width:st(i.style,'"')}),r++,o=r,s=2);break;case 1:o=r,i.character==='"'&&(s=0);break;case 2:if(i.character.match(/\s/))continue;i.character==="*"&&(this.renderParts.splice(o+1,0,{type:"character",x:0,y:0,style:i.style,character:'"',height:i.height,width:st(i.style,'"')}),s=3,r++),o=r;break;case 3:i.character==="*"&&(s=0),o=r;break;default:throw new de.UnreachableCaseError(s)}}const n=this.renderParts[o];n&&s===3&&this.renderParts.splice(o+1,0,{type:"character",x:0,y:0,style:n.style,character:"*",height:n.height,width:st(n.style,'"')}),n&&(s===1||s===2)&&this.renderParts.splice(o+1,0,{type:"character",x:0,y:0,style:n.style,character:'"',height:n.height,width:st(n.style,'"')})}fixAlignment(t,o,s,n,r){let i=0,l=[];function d(){let j=o;t==="center"?j=o+(s-o)/2-i/2:t==="right"&&(j=s-i);for(const $ of l)$.x=j,j+=$.width}let c=this.renderParts;r>0&&(c=xe.applyLineWrapping(this.renderParts.slice(0),r));let u=n;const h=[];let f=0;for(const j of c)f=Math.max(f,j.height),j.type==="newline"&&(h.push(f),f=0);h.push(f);let P=0;for(const j of c)if(f=Math.max(f,j.height),j.y=u,l.push(j),i+=j.width,j.type==="newline")d(),u+=h[++P]||0,i=0,f=0,l=[];else if(j.type==="character"){const $=l[l.length-1];$.type==="character"&&(i+=$.style.letterSpacing,$.width+=$.style.letterSpacing)}d()}getHeight(t){let o=0,s=0;const n=t===0?this.renderParts:xe.applyLineWrapping(this.renderParts.slice(0),t);for(const r of n)o=Math.max(o,r.height),r.type==="newline"&&(s+=o,o=0);return s+=o,s}getWidth(){let t=0,o=0,s=null;for(const n of this.renderParts)t+=n.width,n.type==="newline"?(o=Math.max(o,t),t=0,s=null):n.type==="character"&&(s&&s.type==="character"&&(t+=s.style.letterSpacing),s=n);return o=Math.max(o,t),o}static getRenderParts(t,o,s){const n=[],r=[],i=[];let l=an(o),d=o,c=null;function u(h){for(const f of h)n.push({type:"character",character:f,height:l,width:st(d,f),style:d,x:0,y:0})}for(const h of t){const f=h.type;switch(f){case"command":if(xe.textCommands.has(h.commandName))r.push(d),i.push(c),d=xe.textCommands.get(h.commandName)(d,h.argument),l=an(d),c=h;else if(s)u("{"+h.commandName+"}");else throw new Error(`There is no text command called '${h.commandName}' at position ${h.pos}.`);break;case"commandClose":if(!c)if(s){u("{/"+h.commandName+"}");break}else throw new Error(`Unmatched closing command at position ${h.pos}. Closed '${h.commandName}', but no commands are currently open.`);if(h.commandName!==c.commandName)if(s){u("{/"+h.commandName+"}");break}else throw new Error(`Unmatched closing command at position ${h.pos}. Closed '${h.commandName}', expected to close '${c}' first. (Opened at position ${c.pos})`);c=i.pop(),d=r.pop();break;case"newline":n.push({height:l,width:0,x:0,y:0,type:"newline"});break;case"text":u(h.content);break;default:throw new de.UnreachableCaseError(f)}}return n}static applyLineWrapping(t,o){let s=-1,n=0,r=0;const i=[];for(const l of t)if(l.type==="newline")s=-1,n=0,r=0,i.push(l);else if(l.type==="character")l.character===" "?n>o?(s=-1,n=0,r=0,i.push({type:"newline",height:l.height,width:0,x:0,y:0})):(n+=l.width,r=n,s=i.length,i.push(l)):(n+=l.width,n>o&&s!==-1&&(n-=r,i.splice(s,1,{type:"newline",height:l.height,width:0,x:0,y:0}),s=-1,r=0),i.push(l));else throw new de.UnreachableCaseError(l);return i}};let ge=xe;g(ge,"textCommands",Cd);const nn=document.createElement("canvas").getContext("2d");let rn=null;function st(e,t){return e!==rn&&(Do(e,nn),rn=e),nn.measureText(t).width}const Oo=new Map;function an(e){const t=e.fontSize+" "+e.fontName;if(Oo.has(t))return Oo.get(t)*e.lineSpacing;const o=document.createElement("span");o.innerHTML="Hg",o.style.fontFamily=e.fontName,o.style.fontSize=`${e.fontSize}px`,o.style.lineHeight="1";const s=document.createElement("div");s.style.opacity="0",s.style.fontFamily=e.fontName,s.style.fontSize=`${e.fontSize}px`,s.style.lineHeight="1",s.style.position="absolute",s.style.top="0",s.style.left="0",s.appendChild(o),document.body.appendChild(s);try{const n=s.offsetHeight;return Oo.set(t,n),n*e.lineSpacing}finally{s.remove()}}function Do(e,t){t.textAlign="left",t.font=(e.isItalic?"italic ":"")+(e.isBold?"bold ":"")+e.fontSize+"px "+e.fontName,t.lineJoin="round",e.strokeWidth>0&&e.strokeColor>""?(t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeWidth):(t.strokeStyle="",t.lineWidth=0),t.globalAlpha=e.alpha||0,t.fillStyle=e.color}class Ve{}class We{constructor(t,o,s,n){g(this,"aborted",!1);this.canvas=t,this.fsCtx=o,this.hq=s,this.preview=n}static make(t,o,s){return new We(t,t.getContext("2d"),o,s)}static makeWithContext(t,o,s,n){return new We(t,o,s,n)}drawText(t){if(this.aborted)throw new Ve;this.fsCtx.save();const{font:o,align:s,x:n=0,y:r=0,text:i=""}=m({font:"20px aller",align:"left"},t);this.fsCtx.lineJoin="round",this.fsCtx.textAlign=s,this.fsCtx.font=o,t.outline&&(this.fsCtx.strokeStyle=t.outline.style,this.fsCtx.lineWidth=t.outline.width,this.fsCtx.strokeText(i,n,r)),t.fill&&(this.fsCtx.fillStyle=t.fill.style,this.fsCtx.fillText(i,n,r)),this.fsCtx.restore()}measureText(t){if(this.aborted)throw new Ve;this.fsCtx.save();const{font:o,align:s,text:n=""}=m({font:"20px aller",align:"left"},t);this.fsCtx.lineJoin="round",this.fsCtx.textAlign=s,this.fsCtx.font=o,t.outline&&(this.fsCtx.strokeStyle=t.outline.style,this.fsCtx.lineWidth=t.outline.width),t.fill&&(this.fsCtx.fillStyle=t.fill.style);const r=this.fsCtx.measureText(n);return this.fsCtx.restore(),r}drawImage(t){if(this.aborted)throw new Ve;if(t.image instanceof Yt)return;const{image:o,flip:s,x:n,y:r,w:i,h:l,filters:d,composite:c}=m({flip:!1,w:t.image.width,h:t.image.height,composite:"source-over"},t);if(this.fsCtx.save(),this.fsCtx.globalCompositeOperation=c,d)if("filter"in this.fsCtx){const u=[];for(const h of d)h.type==="drop-shadow"?u.push(`drop-shadow(${h.offsetX}px ${h.offsetY}px ${h.blurRadius}px ${h.color})`):h.type==="hue-rotate"?u.push(`hue-rotate(${h.value}deg)`):h.type==="blur"?u.push(`blur(${h.value}px)`):u.push(`${h.type}(${h.value*100}%)`);this.fsCtx.filter=u.join(" ")}else{let u=1;for(const h of d)h.type==="opacity"&&(u*=h.value);this.fsCtx.globalAlpha=u}if(t.shadow){const u=t.shadow;u.color&&(this.fsCtx.shadowColor=u.color),u.blur&&(this.fsCtx.shadowBlur=u.blur),u.offsetX&&(this.fsCtx.shadowOffsetX=u.offsetX),u.offsetY&&(this.fsCtx.shadowOffsetY=u.offsetY)}if(t.rotation){const u=t.rotationAnchor?t.rotationAnchor.x:0,h=t.rotationAnchor?t.rotationAnchor.y:0;t.rotationAnchor&&this.fsCtx.translate(u,h),this.fsCtx.rotate(t.rotation),t.rotationAnchor&&this.fsCtx.translate(-u,-h)}this.fsCtx.translate(n+i/2,r+l/2),this.fsCtx.scale(s?-1:1,1),o.paintOnto(this.fsCtx,{x:-i/2,y:-l/2,w:i,h:l}),this.fsCtx.restore(),this.fsCtx.globalCompositeOperation="source-over"}drawRect({x:t,y:o,w:s,h:n,outline:r,fill:i,composition:l}){if(this.aborted)throw new Ve;this.fsCtx.save(),this.fsCtx.beginPath(),this.fsCtx.rect(t,o,s,n),l&&(this.fsCtx.globalCompositeOperation=l),i&&(this.fsCtx.fillStyle=i.style,this.fsCtx.fill()),r&&(this.fsCtx.strokeStyle=r.style,this.fsCtx.lineWidth=r.width,this.fsCtx.stroke()),this.fsCtx.restore()}drawPath({outline:t,fill:o,path:s}){if(this.aborted)throw new Ve;this.fsCtx.save(),this.fsCtx.beginPath(),s(this.fsCtx),o&&(this.fsCtx.fillStyle=o.style,this.fsCtx.fill()),t&&(this.fsCtx.strokeStyle=t.style,this.fsCtx.lineWidth=t.width,this.fsCtx.stroke()),this.fsCtx.restore()}patternFrom(t,o="repeat"){return t instanceof nt&&(t=t.previewCanvas),this.fsCtx.createPattern(t,o)}async customTransform(t,o){this.fsCtx.save(),await t(this.fsCtx),await o(this),this.fsCtx.restore()}linearGradient(t,o,s,n){return this.fsCtx.createLinearGradient(t,o,s,n)}applyFilters(t){if(t.length===0)return;this.fsCtx.save();let o=1;for(const s of t)s.type==="opacity"&&(o*=s.value);if("filter"in this.fsCtx){const s=[];for(const n of t)n.type!=="opacity"&&(n.type==="drop-shadow"?s.push(`drop-shadow(${n.offsetX}px ${n.offsetY}px ${n.blurRadius}px ${n.color})`):n.type==="hue-rotate"?s.push(`hue-rotate(${n.value}deg)`):n.type==="blur"?s.push(`blur(${n.value}px)`):s.push(`${n.type}(${n.value*100}%)`));this.fsCtx.filter=s.join(" ")}this.fsCtx.drawImage(this.canvas,0,0),o!==1&&(this.fsCtx.globalCompositeOperation="destination-atop",this.fsCtx.fillStyle=`rgba(0,0,0,${o})`,this.fsCtx.fillRect(0,0,this.canvas.width,this.canvas.height),this.fsCtx.globalCompositeOperation="source-over"),"filter"in this.fsCtx&&(this.fsCtx.filter="none"),this.fsCtx.restore()}abort(){this.aborted=!0}}class nt{constructor(t,o){g(this,"previewCanvas");g(this,"runningContext",null);const s=T();this.previewCanvas=document.createElement("canvas"),this.previewCanvas.width=t!=null?t:s.Base.screenWidth,this.previewCanvas.height=o!=null?o:s.Base.screenHeight}async render(t,o=!0,s=!0){this.runningContext&&this.runningContext.abort();const n=this.previewCanvas.getContext("2d");n.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height);const r=this.runningContext=We.makeWithContext(this.previewCanvas,n,o,s);try{await t(this.runningContext)}catch(i){if(i instanceof Ve)return!1;throw i}finally{r===this.runningContext&&(this.runningContext=null)}return!0}get width(){return this.previewCanvas.width}get height(){return this.previewCanvas.height}paintOnto(t,o){o.w&&o.h?t.drawImage(this.previewCanvas,o.x,o.y,o.w,o.h):t.drawImage(this.previewCanvas,o.x,o.y)}async download(t,o){const s=await this.drawToCanvas(t);return await B.saveToFile(s,o)}async renderToBlob(t){const o=await this.drawToCanvas(t);return await new Promise((s,n)=>{o.toBlob(r=>{r?s(r):n()})})}async drawToCanvas(t){const o=document.createElement("canvas");o.width=this.previewCanvas.width,o.height=this.previewCanvas.height;const s=o.getContext("2d");return s.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height),await t(We.makeWithContext(o,s,!0,!1)),o}getDataAt(t,o){return this.previewCanvas.getContext("2d").getImageData(t,o,1,1).data}}function _t(e,t,o,s,n){const r=Math.cos(n),i=Math.sin(n),l=e-o,d=t-s,c=r*l-i*d+o,u=i*l+r*d+s;return[c,u]}var Ee;(function(e){e[e.None=0]="None",e[e.Selected=1]="Selected",e[e.Focused=2]="Focused",e[e.Both=3]="Both"})(Ee||(Ee={}));class ln{constructor(t){g(this,"localRenderer",null);g(this,"lastVersion",null);g(this,"hitDetectionFallback",!1);g(this,"renderable",!1);g(this,"lastHq",!1);g(this,"ready",Promise.resolve());this.obj=t}get id(){return this.obj.id}get x(){return this.obj.x}get y(){return this.obj.y}get version(){return this.obj.version}get flip(){return this.obj.flip}get rotation(){return this.obj.rotation/180*Math.PI}get composite(){return this.obj.composite}get filters(){return this.obj.filters}get width(){return this.obj.width}get height(){return this.obj.height}async updateLocalCanvas(t){await this.ready;const o=this.canvasWidth,s=this.canvasHeight;if(s===0&&o===0){this.renderable=!1;return}this.renderable=!0,this.localRenderer=new nt(o,s),this.lastHq=t,await this.localRenderer.render(this.renderLocal.bind(this))}needsRedraw(){return this.localRenderer===null||this.lastVersion!==this.version}getRenderRotation(){return[this.flip?-this.rotation:this.rotation,{x:this.x,y:this.y+this.height/2}]}async render(t,o){if((this.lastHq!==o.hq||this.needsRedraw())&&await this.updateLocalCanvas(!o.hq),this.lastVersion=this.version,!this.renderable)return;const[n,r]=this.getRenderRotation();let i;switch(t){case 0:i=void 0;break;case 1:i={blur:20,color:"red"};break;case 2:i={blur:20,color:"blue"};break;case 3:i={blur:20,color:"purple"};break}o.drawImage({image:this.localRenderer,x:this.canvasDrawPosX,y:this.canvasDrawPosY,w:this.canvasDrawWidth,h:this.canvasDrawHeight,rotation:n,rotationAnchor:r,flip:this.flip,shadow:t&&o.preview?i:void 0,composite:this.composite,filters:this.filters})}hitTest(t,o){if(!this.localRenderer)return!1;const s=this.getHitbox(),n=s.x0+(s.x1-s.x0)/2,r=s.y0+(s.y1-s.y0)/2,[i,l]=_t(t,o,n,r,this.flip?this.rotation:-this.rotation);if(!(i>=s.x0&&i<=s.x1&&l>=s.y0&&l<=s.y1))return!1;if(this.hitDetectionFallback)return!0;try{return this.pixelPerfectHitTest(t,o)}catch{this.hitDetectionFallback=!0}return!0}pixelPerfectHitTest(t,o){if(!this.localRenderer)return!1;const[s,n]=this.getRenderRotation(),[r,i]=n?_t(t,o,n.x,n.y,-s):[t,o],l=Math.round(r-this.canvasDrawPosX),d=Math.round(i-this.canvasDrawPosY),c=this.canvasDrawWidth,u=this.canvasDrawHeight;if(l>=0&&l<=c&&d>=0&&d<=u){const h=this.flip?this.canvasDrawWidth-l:l,f=this.canvasWidth/this.canvasDrawWidth,P=this.canvasHeight/this.canvasDrawHeight;return this.localRenderer.getDataAt(Math.round(h*f),Math.round(d*P))[3]!==0}return!1}getHitbox(){return{x0:this.x-this.width/2,x1:this.x+this.width/2,y0:this.y,y1:this.y+this.height}}updatedContent(t,o){}}class Bt extends ln{constructor(t){super(t);g(this,"lastWidth",-1);g(this,"lastHeight",-1);g(this,"lastX",-1);g(this,"lastY",-1);g(this,"lastFlip",null);g(this,"canvasHeight");g(this,"canvasWidth");g(this,"canvasDrawHeight");g(this,"canvasDrawWidth");g(this,"canvasDrawPosX",0);g(this,"canvasDrawPosY",0);const o=T().Base;this.canvasHeight=o.screenHeight,this.canvasWidth=o.screenWidth,this.canvasDrawHeight=o.screenHeight,this.canvasDrawWidth=o.screenWidth}getRenderRotation(){return[0,void 0]}needsRedraw(){return super.needsRedraw()?!0:this.width!==this.lastWidth||this.height!==this.lastHeight||this.x!==this.lastX||this.y!==this.lastY||this.flip!==this.lastFlip}async updateLocalCanvas(t){this.lastWidth=this.width,this.lastHeight=this.height,this.lastX=this.x,this.lastY=this.y,this.lastFlip=this.flip,await super.updateLocalCanvas(t)}async renderLocal(t){const o=T().Base;if(this.rotation===0)return await this.draw(t);await t.customTransform(async s=>{const n=this.getHitbox(),r=n.x0+(n.x1-n.x0)/2,i=n.y0+(n.y1-n.y0)/2,l=this.flip?o.screenWidth-r:r;s.translate(l,i),s.rotate(this.rotation),s.translate(-l,-i)},this.draw.bind(this))}getHitbox(){const t=this.centeredVertically,o=this.width/2,s=this.height/2;return{x0:this.x-o,x1:this.x+o,y0:t?this.y-s:this.y,y1:t?this.y+s:this.y+this.height}}get centeredVertically(){return!1}}class Ho{constructor(t){this.base=t}static get resizable(){return!1}static get defaultWidth(){return De}static get defaultHeight(){return vt}static get defaultX(){return T().Base.screenWidth/2}static get defaultY(){return T().Base.screenHeight-this.defaultHeight-ie-T().TextBox.TextBoxBottomSpacing}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return bo}getControlsDisabledStyle(){return xs}get textboxStyle(){return mo}renderControls(t,o){const s=T(),n=this.width,r=n/2,d=(this.base.obj.flip?s.Base.screenWidth-this.base.obj.x:this.base.obj.x)-r+n/2,c=this.getControlsStyle();t.drawText(m({text:"History",x:d+lo,y:o},c)),t.drawText(m({text:"Skip",x:d+co,y:o},this.base.obj.skip?c:this.getControlsDisabledStyle())),t.drawText(m({text:"Auto   Save   Load   Settings",x:d+uo,y:o},c))}}class Le extends Ho{constructor(){super(...arguments);g(this,"backgroundImage","textbox");g(this,"xOffset",0)}get height(){return vt+ie}get width(){return De}get nameboxWidth(){return Qe}get nameboxHeight(){return ie}get nameboxOffsetX(){return et}get nameboxOffsetY(){return Ct}get nameboxStyle(){return $t}get textOffsetX(){return Ze}get textOffsetY(){return wt}async renderNamebox(t,o,s){t.drawImage({image:await ce("namebox"),x:o,y:s})}async renderBackdrop(t,o,s){o+=this.xOffset;const n=await ce(this.backgroundImage);t.drawImage({image:n,x:o,y:s})}async render(t){const o=T(),s=this.width,n=this.height,r=s/2,l=(this.obj.flip?o.Base.screenWidth-this.obj.x:this.obj.x)-r,d=this.obj.y;await this.renderBackdrop(t,l,d+this.nameboxHeight),this.obj.talkingObjId!==null&&await this.renderNamebox(t,l+this.nameboxOffsetX,d);const c=d+n,u=c-ao;this.obj.controls&&this.renderControls(t,u),this.obj.continue&&t.drawImage({image:await ce("next"),x:l+s-ho,y:c-po})}}g(Le,"id","normal"),g(Le,"label","Normal"),g(Le,"priority",0),g(Le,"gameMode","ddlc");class it extends Le{constructor(){super(...arguments);g(this,"backgroundImage","textbox_monika");g(this,"xOffset",(De-ro)/2)}}g(it,"id","corrupt"),g(it,"label","Corrupted"),g(it,"priority",1),g(it,"gameMode","ddlc");function Ot(e,t,o,s,n,r){s<0&&(s=0),n<0&&(n=0),s<2*r&&(r=s/2),n<2*r&&(r=n/2),e.moveTo(t+r,o),e.arcTo(t+s,o,t+s,o+n,r),e.arcTo(t+s,o+n,t,o+n,r),e.arcTo(t,o+n,t,o,r),e.arcTo(t,o,t+s,o,r),e.closePath()}function dn(e,t,o,s,n,r){s<0&&(s=0),n<0&&(n=0),s<2*r&&(r=s/2),n<2*r&&(r=n/2),e.moveTo(t+r,o),e.arcTo(t+s,o,t+s,o+n,r),e.lineTo(t+s,o+n),e.lineTo(t,o+n),e.arcTo(t,o,t+s,o,r),e.closePath()}class rt extends Ho{constructor(){super(...arguments);g(this,"backgroundImage","textbox");g(this,"xOffset",0)}static get resizable(){return!0}get height(){return this.obj.height+ie}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth!==null?this.obj.customNameboxWidth:Qe}get nameboxHeight(){return ie}get nameboxOffsetX(){return et}get nameboxOffsetY(){return Ct}get nameboxStyle(){return k(m({},$t),{strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"})}get textOffsetX(){return Ze}get textOffsetY(){return wt}get customColor(){return this.obj.overrideColor?this.obj.customColor:this.refObject&&this.refObject.textboxColor?this.refObject.textboxColor:fs}get nameboxOutlineColor(){return this.obj.deriveCustomColors?A.fromCss(this.customColor).toHSL().shift(gs).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?A.fromCss(this.customColor).toHSL().shift(bs).toRgb().toCss():this.obj.customNameboxColor}async renderNamebox(t,o,s){const n=this.nameboxWidth,r=this.nameboxHeight;await t.customTransform(async i=>{i.beginPath(),dn(i,o,s,n,r,vs),i.clip()},async i=>{const l=i.linearGradient(o,s,o,s+r),d=A.fromCss(this.nameboxBackgroundColor),c=new A(d.r,d.g,d.b,.95),u=c.toHSL().shift(ys).toRgb();l.addColorStop(0,c.toCss()),l.addColorStop(ms,c.toCss()),l.addColorStop(1,u.toCss()),i.drawRect({x:o,y:s,w:this.obj.width,h:r,fill:{style:l}})})}async renderBackdrop(t,o,s){const n=A.fromCss(this.customColor).toHSL(),r=new nt(he,he);await r.render(async l=>{const d={style:n.shift(ws).toRgb().toCss()};function c(u,h){l.drawPath({path:f=>{f.ellipse(u,h,io,io,0,0,2*Math.PI)},fill:d})}c(0,0),c(he,0),c(0,he),c(he,he),c(he/2,he/2)},!0),await t.customTransform(async l=>{l.beginPath(),Ot(l,o+ue,s+ue,this.width-ue*2,this.height-ie-ue*2,no),l.clip()},async l=>{const d=this.obj.height,c=this.obj.width,u=l.linearGradient(o,s,o,s+d),h=A.fromHex(this.customColor);u.addColorStop(0,h.toCss()),u.addColorStop(1,`rgba(${h.r},${h.g},${h.b},0.6667)`),l.drawRect({x:o,y:s,w:c,h:d,fill:{style:u},outline:{style:"#ffdfee",width:6}}),await l.customTransform(async P=>{P.translate(o,s)},async P=>{const j=l.patternFrom(r);l.drawRect({x:0,y:0,w:c,h:d,fill:{style:j},composition:"source-atop"})});const f=l.linearGradient(o,s+d-fo,o,s+d);f.addColorStop(0,"rgba(255,255,255,0.3137)"),f.addColorStop(.5,"rgba(255,255,255,0.0627)"),f.addColorStop(1,"rgba(255,255,255,0)"),l.drawPath({path:P=>{P.ellipse(o+c/2,s+d,ks,fo,0,0,2*Math.PI)},fill:{style:f}})});const i=n.shift(Cs).toRgb().toCss();t.drawPath({path:l=>{Ot(l,o+ue,s+ue,this.width-ue*2,this.height-ie-ue*2,no)},outline:{style:i,width:$s}})}async render(t){const o=T(),s=this.width,n=this.height,r=s/2,l=(this.obj.flip?o.Base.screenWidth-this.obj.x:this.obj.x)-r,d=this.obj.y;this.obj.talkingObjId!==null&&await this.renderNamebox(t,l+this.nameboxOffsetX,d),await this.renderBackdrop(t,l,d+this.nameboxHeight);const c=d+n,u=c-ao;this.obj.controls&&this.renderControls(t,u),this.obj.continue&&t.drawImage({image:await ce("next"),x:l+s-ho,y:c-po})}}g(rt,"id","custom"),g(rt,"label","Custom"),g(rt,"priority",0),g(rt,"gameMode","ddlc");class at extends Ho{get height(){return vt+ie}get width(){return De}get nameboxWidth(){return Qe}get nameboxHeight(){return ie}get nameboxOffsetX(){return et}get nameboxOffsetY(){return Ct}get nameboxStyle(){return $t}get textOffsetX(){return Ze}get textOffsetY(){return wt}get textboxStyle(){return mo}async render(t){}}g(at,"id","none"),g(at,"label","None"),g(at,"priority",0),g(at,"gameMode","ddlc");const qo=class{constructor(t){this.base=t}static get resizable(){return!1}static get defaultWidth(){return $o}static get defaultHeight(){return Ns}static get defaultX(){return T().Base.screenWidth/2}static get defaultY(){return T().Base.screenHeight-this.defaultHeight-Ae-T().TextBox.TextBoxBottomSpacing}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return xt}getControlsDisabledStyle(){return Ks}renderControls(t,o){const s=T(),n=this.width,r=n/2,l=(this.base.obj.flip?s.Base.screenWidth-this.base.obj.x:this.base.obj.x)-r,d=this.getControlsStyle(),c=["History","Skip","Auto","Save","Load","Settings"],u=[];let h=0;for(const j of c){const $=qo.controlWidth(t,j);u.push($),h+=$}const f=Math.min((n-h)/(c.length+2),78);let P=l+(n-h-f*(c.length-1))/2;for(let j=0;j<c.length;++j){const $=c[j],le=u[j],N=$==="Skip"&&!this.base.obj.skip?this.getControlsDisabledStyle():d;t.drawText(m({text:$,x:P,y:o},N)),P+=le+f}}static controlWidth(t,o){if(this.widthCache[o])return this.widthCache[o];const s=t.measureText(m({text:o},xt)).width;return this.widthCache[o]=s,s}};let Ao=qo;g(Ao,"widthCache",{});class lt extends Ao{constructor(){super(...arguments);g(this,"backgroundImage","textbox");g(this,"xOffset",0)}static get resizable(){return!0}get height(){return this.obj.height+Ae}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth!==null?this.obj.customNameboxWidth:xo}get nameboxHeight(){return Ae}get nameboxOffsetX(){return So}get nameboxOffsetY(){return Ws}get nameboxStyle(){return k(m({},qs),{strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"})}get textOffsetX(){return ko}get textOffsetY(){return Vs}get textboxStyle(){return Js}get customColor(){return this.obj.overrideColor?this.obj.customColor:this.refObject&&this.refObject.textboxColor?this.refObject.textboxColor:Is}get nameboxOutlineColor(){return this.obj.deriveCustomColors?A.fromCss(this.customColor).toHSL().shift(_s).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?A.fromCss(this.customColor).toHSL().shift(Bs).toRgb().toCss():this.obj.customNameboxColor}async renderNamebox(t,o,s){const n=this.nameboxWidth,r=this.nameboxHeight;await t.customTransform(async i=>{i.beginPath(),dn(i,o,s,n,r,Hs),i.clip()},async i=>{const l=i.linearGradient(o,s,o,s+r),d=A.fromCss(this.nameboxBackgroundColor),c=new A(d.r,d.g,d.b,.95),u=c.toHSL().shift(Ds).toRgb();l.addColorStop(0,c.toCss()),l.addColorStop(Os,c.toCss()),l.addColorStop(1,u.toCss()),i.drawRect({x:o,y:s,w:this.obj.width,h:r,fill:{style:l}})})}async renderBackdrop(t,o,s){const n=A.fromCss(this.customColor).toHSL(),r=new nt(fe,fe);await r.render(async l=>{const d={style:n.shift(As).toRgb().toCss()};function c(u,h){l.drawPath({path:f=>{f.ellipse(u,h,Co,Co,0,0,2*Math.PI)},fill:d})}c(0,0),c(fe,0),c(0,fe),c(fe,fe),c(fe/2,fe/2)},!0),await t.customTransform(async l=>{l.beginPath(),Ot(l,o+pe,s+pe,this.width-pe*2,this.height-Ae-pe*2,wo),l.clip()},async l=>{const d=this.obj.height,c=this.obj.width,u=l.linearGradient(o,s,o,s+d),h=A.fromHex(this.customColor);u.addColorStop(0,h.toCss()),u.addColorStop(1,`rgba(${h.r},${h.g},${h.b},0.6667)`),l.drawRect({x:o,y:s,w:c,h:d,fill:{style:u},outline:{style:"#ffdfee",width:6}}),await l.customTransform(async P=>{P.translate(o,s)},async P=>{const j=l.patternFrom(r);l.drawRect({x:0,y:0,w:c,h:d,fill:{style:j},composition:"source-atop"})});const f=l.linearGradient(o,s+d-Po,o,s+d);f.addColorStop(0,"rgba(255,255,255,0.3137)"),f.addColorStop(.5,"rgba(255,255,255,0.0627)"),f.addColorStop(1,"rgba(255,255,255,0)"),l.drawPath({path:P=>{P.ellipse(o+c/2,s+d,Ys,Po,0,0,2*Math.PI)},fill:{style:f}})});const i=n.shift(Rs).toRgb().toCss();t.drawPath({path:l=>{Ot(l,o+pe,s+pe,this.width-pe*2,this.height-Ae-pe*2,wo)},outline:{style:i,width:Ms}})}async render(t){const o=T(),s=this.width,n=this.height,r=s/2,l=(this.obj.flip?o.Base.screenWidth-this.obj.x:this.obj.x)-r,d=this.obj.y;this.obj.talkingObjId!==null&&await this.renderNamebox(t,l+this.nameboxOffsetX,d),await this.renderBackdrop(t,l,d+this.nameboxHeight);const c=d+n,u=c-Es;this.obj.controls&&this.renderControls(t,u),this.obj.continue&&t.drawImage({image:await ce("next_plus"),x:l+s-Xs,y:c-Gs})}}g(lt,"id","custom_plus"),g(lt,"label","Custom (Plus)"),g(lt,"priority",0),g(lt,"gameMode","ddlc_plus");const $d=[Le,it,rt,at,lt],dt=(()=>{const e={};for(const t of $d)e[t.id]=t;return e})();class kd extends Bt{constructor(){super(...arguments);g(this,"refObject",null);g(this,"_lastRenderer",null)}get y(){return this.obj.y}get width(){return this.textboxRenderer.width}get height(){return this.textboxRenderer.height}get textboxRenderer(){const t=this.forcedStyle,o=dt[t];if(!o)throw new Error("Unknown textbox style renderer");if(this._lastRenderer&&this._lastRenderer.constructor===o)return this._lastRenderer;const s=new o(this);return this._lastRenderer=s,s}get forcedStyle(){const t=this.refObject;return(this.obj.style==="normal"||this.obj.style==="normal_plus")&&t&&(t.textboxColor||t.nameboxWidth!==null)?"custom":this.obj.style}updatedContent(t,o){super.updatedContent(t,o);const s=this.obj.talkingObjId;if(s!==null&&s!=="$other$"){const n=t.state.panels.panels[o].objects[s];if(n){this.refObject=n;return}}this.refObject=null}async draw(t){var c;const o=T(),s=this.textboxRenderer,n=s.width,r=n/2,l=(this.flip?o.Base.screenWidth-this.obj.x:this.obj.x)-r,d=this.obj.y;if(await s.render(t),this.obj.talkingObjId!==null){const u=this.obj.talkingObjId==="$other$"?this.obj.talkingOther:((c=this.refObject)==null?void 0:c.label)||"Missing name";await this.renderName(t,l+s.nameboxOffsetX,d,u)}await this.renderText(t,l,d,this.obj.autoWrap?n:0)}async renderName(t,o,s,n){const r=this.textboxRenderer,i=r.nameboxWidth,l=r.nameboxStyle,d=new ge(n,l);await d.loadFonts(),d.fixAlignment("center",o,o+i,s+r.nameboxOffsetY,0),d.render(t.fsCtx)}async renderText(t,o,s,n){const r=this.textboxRenderer,i=new ge(this.obj.text,r.textboxStyle);this.obj.autoQuoting&&this.obj.talkingObjId!==null&&i.quote(),await i.loadFonts(),i.fixAlignment("left",o+r.textOffsetX,0,s+r.nameboxHeight+r.textOffsetY,n-r.textOffsetX*2),i.render(t.fsCtx)}}const xd=D({components:{Toggle:ne,DFieldset:re},props:{obj:{required:!0}},computed:{freeMove:{get(){return this.obj.freeMove},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setFreeMove",{id:this.obj.id,panelId:this.obj.panelId,freeMove:e})})}},preserveRatio:{get(){return this.obj.preserveRatio},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPreserveRatio",{id:this.obj.id,panelId:this.obj.panelId,preserveRatio:e})})}},pos:{get(){return Pt(this.obj.x)},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPosition",{id:this.obj.id,panelId:this.obj.panelId,x:T().Base.characterPositions[e],y:this.obj.y})})}},x:{get(){return this.obj.x},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPosition",{id:this.obj.id,panelId:this.obj.panelId,x:e,y:this.y})})}},y:{get(){return this.obj.y},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPosition",{id:this.obj.id,panelId:this.obj.panelId,x:this.x,y:e})})}},height:{get(){return this.obj.height},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setHeight",{id:this.obj.id,panelId:this.obj.panelId,height:e})})}},width:{get(){return this.obj.width},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setWidth",{id:this.obj.id,panelId:this.obj.panelId,width:e})})}},allowSize(){const e=this.obj;return e.type==="textBox"?dt[e.style].resizable:!(e.type==="character"&&!e.freeMove)},allowStepMove(){return"freeMove"in this.obj},positionNames(){return T().Base.positions},isFirstPos(){return this.pos===0},isLastPos(){return this.pos===T().Base.positions.length-1}}}),Dt=e=>(G("data-v-5578f23c"),e=e(),Y(),e),Sd={colspan:"2"},Pd={key:0},jd={colspan:"2"},Td={class:"arrow-col"},Id=["disabled"],_d=["value"],Bd={class:"arrow-col"},Od=["disabled"],Dd=Dt(()=>a("td",null,[a("label",{for:"sprite_x"},"X:")],-1)),Hd=Dt(()=>a("td",null,[a("label",{for:"sprite_y"},"Y:")],-1)),Ad=Dt(()=>a("td",null,[a("label",{for:"sprite_w"},"Width:")],-1)),Rd=Dt(()=>a("td",null,[a("label",{for:"sprite_h"},"Height:")],-1)),Md={colspan:"2"};function Fd(e,t,o,s,n,r){const i=C("toggle"),l=C("d-fieldset");return p(),x(l,{title:"Position"+(e.allowSize?"/Size":"")},{default:w(()=>[a("table",null,[a("tr",null,[a("td",Sd,[e.allowStepMove?(p(),x(i,{key:0,modelValue:e.freeMove,"onUpdate:modelValue":t[0]||(t[0]=d=>e.freeMove=d),label:"Move freely?"},null,8,["modelValue"])):S("",!0)])]),e.allowStepMove&&!e.freeMove?(p(),b("tr",Pd,[a("td",jd,[a("table",null,[a("tr",null,[a("td",Td,[a("button",{onClick:t[1]||(t[1]=d=>--e.pos),disabled:e.isFirstPos},"<",8,Id)]),a("td",null,[R(a("select",{id:"current_talking","onUpdate:modelValue":t[2]||(t[2]=d=>e.pos=d)},[(p(!0),b(_,null,L(e.positionNames,(d,c)=>(p(),b("option",{key:c,value:c},V(d),9,_d))),128))],512),[[oe,e.pos,void 0,{number:!0}]])]),a("td",Bd,[a("button",{onClick:t[3]||(t[3]=d=>++e.pos),disabled:e.isLastPos},">",8,Od)])])])])])):(p(),b(_,{key:1},[a("tr",null,[Dd,a("td",null,[R(a("input",{id:"sprite_x",type:"number","onUpdate:modelValue":t[4]||(t[4]=d=>e.x=d),onKeydown:t[5]||(t[5]=I(()=>{},["stop"]))},null,544),[[z,e.x,void 0,{number:!0}]])])]),a("tr",null,[Hd,a("td",null,[R(a("input",{id:"sprite_y",type:"number","onUpdate:modelValue":t[6]||(t[6]=d=>e.y=d),onKeydown:t[7]||(t[7]=I(()=>{},["stop"]))},null,544),[[z,e.y,void 0,{number:!0}]])])])],64)),e.allowSize?(p(),b(_,{key:2},[a("tr",null,[Ad,a("td",null,[R(a("input",{id:"sprite_w",min:"0",type:"number","onUpdate:modelValue":t[8]||(t[8]=d=>e.width=d),onKeydown:t[9]||(t[9]=I(()=>{},["stop"]))},null,544),[[z,e.width,void 0,{number:!0}]])])]),a("tr",null,[Rd,a("td",null,[R(a("input",{id:"sprite_h",min:"0",type:"number","onUpdate:modelValue":t[10]||(t[10]=d=>e.height=d),onKeydown:t[11]||(t[11]=I(()=>{},["stop"]))},null,544),[[z,e.height,void 0,{number:!0}]])])]),a("tr",null,[a("td",Md,[y(i,{modelValue:e.preserveRatio,"onUpdate:modelValue":t[12]||(t[12]=d=>e.preserveRatio=d),label:"Lock ratio?"},null,8,["modelValue"])])])],64)):S("",!0)])]),_:1},8,["title"])}var Nd=H(xd,[["render",Fd],["__scopeId","data-v-5578f23c"]]);const Vd=D({components:{Toggle:ne,DFieldset:re},props:{object:{required:!0}},computed:{onTop:ot()("onTop","panels/setOnTop",!0)},methods:{shiftLayer(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/shiftLayer",{id:this.object.id,panelId:this.object.panelId,delta:e})})}}}),Ht=e=>(G("data-v-4fcffae2"),e=e(),Y(),e),Wd=Ht(()=>a("i",{class:"material-icons"},"vertical_align_bottom",-1)),Ed=[Wd],Ld=Ht(()=>a("i",{class:"material-icons"},"arrow_downward",-1)),Ud=[Ld],zd=Ht(()=>a("i",{class:"material-icons"},"arrow_upward",-1)),Xd=[zd],Gd=Ht(()=>a("i",{class:"material-icons"},"vertical_align_top",-1)),Yd=[Gd];function qd(e,t,o,s,n,r){const i=C("toggle"),l=C("d-fieldset");return p(),x(l,{id:"layerfs",title:"Layer:"},{default:w(()=>[a("table",null,[a("tbody",null,[a("tr",null,[a("td",null,[a("button",{onClick:t[0]||(t[0]=d=>e.shiftLayer(-1/0)),title:"Move to back"},Ed)]),a("td",null,[a("button",{onClick:t[1]||(t[1]=d=>e.shiftLayer(-1)),title:"Move backwards"},Ud)]),a("td",null,[a("button",{onClick:t[2]||(t[2]=d=>e.shiftLayer(1)),title:"Move forwards"},Xd)]),a("td",null,[a("button",{onClick:t[3]||(t[3]=d=>e.shiftLayer(1/0)),title:"Move to front"},Yd)])])])]),y(i,{modelValue:e.onTop,"onUpdate:modelValue":t[4]||(t[4]=d=>e.onTop=d),label:"In front?"},null,8,["modelValue"])]),_:1})}var Kd=H(Vd,[["render",qd],["__scopeId","data-v-4fcffae2"]]);const Jd=D({props:{obj:{required:!0}},methods:{onClick(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/removeObject",{panelId:this.obj.panelId,id:this.obj.id})})}}});function Zd(e,t,o,s,n,r){return p(),b("button",{onClick:t[0]||(t[0]=(...i)=>e.onClick&&e.onClick(...i))},"Delete")}var Qd=H(Jd,[["render",Zd]]);const At=255,Ro=8,ec=D({props:{label:{type:String,required:!0},gradientStops:{required:!0},modelValue:{type:Number,required:!0},maxValue:{type:Number,required:!0},shiftGradient:{type:Boolean,default:!1},noInput:{type:Boolean,default:!1}},data:()=>({slideActive:!1}),computed:{vertical(){return this.$store.state.ui.vertical},pointerPath(){const e=this.modelValue/this.maxValue*At;return`M${e} 0L${e+14} 0L${e+7} 12Z`},gradientOffset(){return!this.shiftGradient||this.modelValue===0?0:this.modelValue/this.maxValue}},methods:{enterSlide(e){this.slideActive=!0,this.moveSlide(e)},moveSlide(e){if(!this.slideActive)return;const t=this.$refs.svg;if(!t.contains(e.target)&&e.target!==t)return;if(e instanceof MouseEvent&&e.which!==1){this.slideActive=!1;return}const o=t.getBoundingClientRect(),s=o.width/(Ro+At+Ro),r=((e instanceof MouseEvent?e.clientX:e.touches[0].clientX)-o.x)/s;e.preventDefault();const i=Math.max(Math.min(r-Ro,At),0)/At*this.maxValue;this.$emit("update:modelValue",i)},exitSlide(){this.slideActive=!1}}}),tc=["for"],oc=["id","x1","x2"],sc=["offset"],nc=["fill"],ic=["d"],rc=["id","max","value"];function ac(e,t,o,s,n,r){return p(),b("div",{class:F({slider:!0,vertical:e.vertical}),onKeydown:t[8]||(t[8]=I(()=>{},["stop"]))},[e.noInput?S("",!0):(p(),b("label",{key:0,for:e._.uid},V(e.label),9,tc)),a("div",null,[(p(),b("svg",{ref:"svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 271 24",onMousedown:t[0]||(t[0]=(...i)=>e.enterSlide&&e.enterSlide(...i)),onTouchstart:t[1]||(t[1]=(...i)=>e.enterSlide&&e.enterSlide(...i)),onMousemove:t[2]||(t[2]=(...i)=>e.moveSlide&&e.moveSlide(...i)),onTouchmove:t[3]||(t[3]=(...i)=>e.moveSlide&&e.moveSlide(...i)),onMouseup:t[4]||(t[4]=(...i)=>e.exitSlide&&e.exitSlide(...i)),onTouchend:t[5]||(t[5]=(...i)=>e.exitSlide&&e.exitSlide(...i))},[a("defs",null,[a("linearGradient",{id:`gradient${e._.uid}`,x1:e.gradientOffset*100+"%",y1:"0%",x2:(e.gradientOffset+1)*100+"%",y2:"0%",spreadMethod:"repeat"},[(p(!0),b(_,null,L(e.gradientStops,(i,l)=>(p(),b("stop",{key:l,offset:l/(e.gradientStops.length-1)*100+"%",style:K("stop-color:"+i)},null,12,sc))),128))],8,oc)]),a("g",null,[a("path",{d:"M7 0H262V24H7z","stroke-width":"2","paint-order":"fill stroke markers",fill:`url(#gradient${e._.uid})`},null,8,nc),a("path",{d:e.pointerPath,"stroke-width":"2",class:"slider-pointer"},null,8,ic)])],544))]),e.noInput?S("",!0):(p(),b("input",{key:1,id:e._.uid,class:"sliderInput",min:"0",max:e.maxValue,value:e.modelValue,type:"number",onInput:t[6]||(t[6]=i=>e.$emit("update:modelValue",parseFloat(i.target.value))),onKeydown:t[7]||(t[7]=I(()=>{},["stop"]))},null,40,rc))],34)}var cn=H(ec,[["render",ac],["__scopeId","data-v-07768f1c"]]);const lc=D({components:{Slider:cn},props:{modelValue:{type:String,validator:e=>!!e.match(/^#[0-9a-f]{6,8}$/i)},mode:{type:String},relative:Boolean},data:()=>({lastRGBEmit:null,v1:0,v2:0,v3:0,a:0}),computed:{vertical(){return this.$store.state.ui.vertical},maxValue1(){return this.mode==="rgba"?255:360},label1(){return this.mode==="rgba"?"Red":"Hue"},stops1(){let e=[];if(this.mode==="rgba"){const t=this.relative?this.v2:0,o=this.relative?this.v3:0;e=[new A(0,t,o,1),new A(255,t,o,1)]}else{const t=this.relative?this.v2/100:1,o=this.relative?this.v3/100:.5;e=this.eightsStops(s=>new W(s,t,o,1))}return e.map(t=>t.toRgb().toCss())},maxValue2(){return this.mode==="rgba"?255:100},label2(){return this.mode==="rgba"?"Green":"Saturation"},stops2(){let e=[];if(this.mode==="rgba"){const t=this.relative?this.v1:0,o=this.relative?this.v3:0;e=[new A(t,0,o,1),new A(t,255,o,1)]}else{const t=this.relative?this.v1/360:0,o=this.relative?this.v3/100:.5;e=this.eightsStops(s=>new W(t,s,o,1))}return e.map(t=>t.toRgb().toCss())},maxValue3(){return this.mode==="rgba"?255:100},label3(){return this.mode==="rgba"?"Blue":"Luminosity"},stops3(){let e=[];if(this.mode==="rgba"){const t=this.relative?this.v1:0,o=this.relative?this.v2:0;e=[new A(t,o,0,1),new A(t,o,255,1)]}else{const t=this.relative?this.v1/360:0,o=this.relative?this.v2/100:.5;e=this.eightsStops(s=>new W(t,o,s,1))}return e.map(t=>t.toRgb().toCss())},stopsAlpha(){const e=A.fromHex(this.modelValue);return[new A(e.r,e.g,e.b,0).toCss(),new A(e.r,e.g,e.b,1).toCss()]}},created(){this.initValues()},methods:{valueChanged(){this.modelValue!==this.lastRGBEmit&&this.initValues()},updateValue(){let e;this.mode==="rgba"?e=new A(this.v1,this.v2,this.v3,this.a/255):e=new W(this.v1/360,this.v2/100,this.v3/100,this.a/255);const t=e.toRgb().toHex();if(this.lastRGBEmit!==t){if(t.length!==9)throw new Error(`Invalid color code: ${t}`);this.lastRGBEmit=t,this.$emit("update:modelValue",t)}},initValues(){const e=A.fromHex(this.modelValue);if(this.lastRGBEmit=e.toHex(),this.a=e.a*255,this.mode==="hsla"){const t=e.toHSL();this.v1=t.h*360,this.v2=t.s*100,this.v3=t.l*100}else this.v1=e.r,this.v2=e.g,this.v3=e.b},eightsStops(e){const t=[];for(let o=0;o<=8;++o)t.push(e(o/8));return t}},watch:{value(){this.valueChanged()},v1(){this.updateValue()},v2(){this.updateValue()},v3(){this.updateValue()},a(){this.updateValue()},mode(){this.initValues()}}});function dc(e,t,o,s,n,r){const i=C("slider");return p(),b("div",null,[y(i,{label:e.label1,modelValue:e.v1,"onUpdate:modelValue":t[0]||(t[0]=l=>e.v1=l),"max-value":e.maxValue1,"gradient-stops":e.stops1},null,8,["label","modelValue","max-value","gradient-stops"]),y(i,{label:e.label2,modelValue:e.v2,"onUpdate:modelValue":t[1]||(t[1]=l=>e.v2=l),"max-value":e.maxValue2,"gradient-stops":e.stops2},null,8,["label","modelValue","max-value","gradient-stops"]),y(i,{label:e.label3,modelValue:e.v3,"onUpdate:modelValue":t[2]||(t[2]=l=>e.v3=l),"max-value":e.maxValue3,"gradient-stops":e.stops3},null,8,["label","modelValue","max-value","gradient-stops"]),y(i,{label:"Alpha",modelValue:e.a,"onUpdate:modelValue":t[3]||(t[3]=l=>e.a=l),"max-value":255,"gradient-stops":e.stopsAlpha},null,8,["modelValue","gradient-stops"])])}var cc=H(lc,[["render",dc],["__scopeId","data-v-ba854b8a"]]);const uc="dddg.generated.colors",hc=D({components:{SliderGroup:cc,DButton:mt},inheritAttrs:!1,emits:["leave","update:modelValue"],props:{modelValue:{required:!0,type:String},title:{default:""},format:{type:String,default:"hex"}},data:()=>({mode:"hsla",relative:!0}),computed:{vertical(){return this.$store.state.ui.vertical},swatches(){return this.$store.state.content.current.colors},color:{get(){return this.format==="rgb"?A.fromCss(this.modelValue).toHex():this.modelValue},set(e){if(this.format==="rgb"){const t=A.fromCss(e);this.$emit("update:modelValue",t.toCss())}else this.$emit("update:modelValue",e)}}},mounted(){E.subscribe(ft,this.settingColor)},unmounted(){E.unsubscribe(ft,this.settingColor)},methods:{settingColor(e){this.color=A.fromCss(e.color).toHex()},updateHex(e){const t=e.target.value;A.validHex(t)&&(t.length===7||t.length===9)&&(this.color=t)},addSwatch(){if(this.swatches.find(o=>o.color===this.color))return;const e=this.$store.state.content.contentPacks.find(o=>o.packId==="generatedPackId")||{packId:uc,packCredits:[""],dependencies:[],characters:[],fonts:[],backgrounds:[],sprites:[],poemStyles:[],poemBackgrounds:[],colors:[]},t=k(m({},e),{colors:[...e.colors,{label:this.color,color:this.color}]});this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:t,processed:!0})})},pickColor(){this.vuexHistory.transaction(()=>{this.$store.commit("ui/setColorPicker",!0)})}}}),pc={class:"column"},fc={class:"hex-selector"},gc=["for"],bc=["id","value"],mc=v("Pick color"),yc=["title","onClick"];function vc(e,t,o,s,n,r){const i=C("slider-group"),l=C("d-button");return p(),b("div",{class:F({color:!0,vertical:e.vertical})},[a("h2",null,V(e.title),1),a("button",{onClick:t[0]||(t[0]=d=>e.$emit("leave"))},"OK"),a("table",null,[a("tr",null,[a("td",null,[a("button",{onClick:t[1]||(t[1]=d=>e.mode="hsla")},"HSLA")]),a("td",null,[a("button",{onClick:t[2]||(t[2]=d=>e.mode="rgba")},"RGBA")])])]),a("div",pc,[y(i,{mode:e.mode,modelValue:e.color,"onUpdate:modelValue":t[3]||(t[3]=d=>e.color=d),relative:!0},null,8,["mode","modelValue"]),a("div",fc,[a("label",{class:"hex-label",for:`hex_${e._.uid}`},"Hex",8,gc),a("input",{id:`hex_${e._.uid}`,value:e.color,onInput:t[4]||(t[4]=(...d)=>e.updateHex&&e.updateHex(...d)),onKeydown:t[5]||(t[5]=I(()=>{},["stop"]))},null,40,bc)]),a("button",{onClick:t[6]||(t[6]=(...d)=>e.addSwatch&&e.addSwatch(...d))},"Add as swatch"),y(l,{icon:"colorize",onClick:e.pickColor},{default:w(()=>[mc]),_:1},8,["onClick"])]),a("div",{id:"color-swatches",class:F({vertical:e.vertical})},[(p(!0),b(_,null,L(e.swatches,d=>(p(),b("button",{class:"swatch",key:d.color,style:K({backgroundColor:d.color}),title:d.label,onClick:c=>{e.color=d.color,e.$emit("leave")}},null,12,yc))),128))],2)],2)}var Rt=H(hc,[["render",vc],["__scopeId","data-v-0d0ca91b"]]);const un=new Set(["brightness","contrast","grayscale","invert","opacity","saturate","sepia"]);function Mo(e,t,o){const n=[...t().filters];let r;switch(e.type){case"hue-rotate":r={type:e.type,value:0};break;case"sepia":case"invert":case"blur":case"grayscale":case"brightness":case"contrast":case"opacity":case"saturate":r={type:e.type,value:1};break;case"drop-shadow":r={type:e.type,blurRadius:0,offsetX:10,offsetY:10,color:"#555555"};break;default:throw new de.UnreachableCaseError(e.type)}n.splice(e.idx,0,r),o({panelId:e.panelId,id:e.id,filters:n})}function Fo(e,t,o){const n=[...t().filters];n.splice(e.idx,1),o({id:e.id,panelId:e.panelId,filters:n})}function No(e,t,o){const n=[...t().filters],r=n[e.idx];n.splice(e.idx,1),n.splice(e.idx+e.moveBy,0,r),o({id:e.id,panelId:e.panelId,filters:n})}function Vo(e,t,o){const n=[...t().filters],r=m({},n[e.idx]);n[e.idx]=r,r.type==="drop-shadow"?(e.blurRadius!==void 0&&(r.blurRadius=e.blurRadius),e.color!==void 0&&(r.color=e.color),e.offsetX!==void 0&&(r.offsetX=e.offsetX),e.offsetY!==void 0&&(r.offsetY=e.offsetY)):r.value=e.value,o({id:e.id,panelId:e.panelId,filters:n})}const Ue=new Map([["blur","Blur"],["brightness","Brightness"],["contrast","Contrast"],["grayscale","Grayscale"],["hue-rotate","Rotate hue"],["invert","Invert colors"],["opacity","Opacity"],["saturate","Saturate"],["sepia","Sepia"],["drop-shadow","Drop shadow"]]),wc=Array.from(Ue.keys()).sort(),Cc=D({components:{DFlow:tt,DFieldset:re,Color:Rt,Slider:cn,L:to},props:{type:{type:String,required:!0},title:{type:String},id:{},panelId:{required:!0},noComposition:{type:Boolean,default:!1}},emits:["leave"],data:()=>({addEffectSelection:"",currentFilterIdx:0,showShadowColor:!1}),computed:{object(){switch(this.type){case"object":return this.$store.state.panels.panels[this.panelId].objects[this.id];case"background":return this.$store.state.panels.panels[this.panelId].background;case"panel":return this.$store.state.panels.panels[this.panelId];default:throw new de.UnreachableCaseError(this.type)}},compositionMode:{get(){return this.object.composite},set(e){this.vuexHistory.transaction(()=>{switch(this.type){case"object":this.$store.commit("panels/setComposition",{id:this.id,panelId:this.panelId,composite:e});break;case"background":break;case"panel":break;default:throw new de.UnreachableCaseError(this.type)}})}},filters(){return this.object.filters},filterTypes(){try{const t=document.createElement("canvas").getContext("2d");if("filter"in t)return wc}catch{}return["opacity"]},currentFilter(){return this.filters[this.currentFilterIdx]||null},isPercentFilter(){const e=this.currentFilter;return e?un.has(e.type):!1},maxValue(){const e=this.currentFilter;if(!!e){if(e.type==="hue-rotate")return 360;if(e.type==="grayscale"||e.type==="sepia"||e.type==="opacity"||e.type==="invert")return 100}},minValue(){const e=this.currentFilter;if(!!e)switch(e.type){case"blur":case"brightness":case"contrast":case"grayscale":case"hue-rotate":case"invert":case"opacity":case"saturate":case"sepia":return 0}},shadowColor:{get(){const e=this.currentFilter;if(!!e&&"color"in e)return e.color},set(e){this.setValue({color:e})}},shadowX:{get(){const e=this.currentFilter;if(!!e&&"offsetX"in e)return e.offsetX},set(e){this.setValue({offsetX:e})}},shadowY:{get(){const e=this.currentFilter;if(!!e&&"offsetY"in e)return e.offsetY},set(e){this.setValue({offsetY:e})}},shadowBlur:{get(){const e=this.currentFilter;if(!!e&&"blurRadius"in e)return e.blurRadius},set(e){this.setValue({blurRadius:e})}},hueStops(){return this.eightsStops(t=>new W(t,1,.5,1)).map(t=>t.toRgb().toCss())}},methods:{getFilterLabel(e){return Ue.get(e)},getFilterText(e){return un.has(e.type)?`${Ue.get(e.type)} ${(e.value*100).toFixed()}%`:e.type==="hue-rotate"?`${Ue.get(e.type)} ${e.value.toFixed()}\xB0`:e.type==="blur"?`${Ue.get(e.type)} ${e.value.toFixed()}px`:Ue.get(e.type)},objectTypeScope(e){switch(this.type){case"object":return"panels/object_"+e;case"background":return"panels/background"+e[0].toUpperCase()+e.slice(1);case"panel":return"panels/"+e}},addFilter(){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("addFilter"),{id:this.id,panelId:this.panelId,type:this.addEffectSelection,idx:this.currentFilterIdx+1})})},selectFilter(e){this.currentFilterIdx=e},removeFilter(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch(this.objectTypeScope("removeFilter"),{id:this.id,panelId:this.panelId,idx:this.currentFilterIdx}),this.currentFilterIdx>=this.object.filters.length&&(this.currentFilterIdx=this.object.filters.length-1)})},moveFilter(e){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("moveFilter"),{id:this.id,panelId:this.panelId,idx:this.currentFilterIdx,moveBy:e}),this.currentFilterIdx+=e})},setValue(e){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("setFilter"),m({id:this.id,panelId:this.panelId,idx:this.currentFilterIdx},e))})},eightsStops(e){const t=[];for(let o=0;o<=8;++o)t.push(e(o/8));return t}}}),M=e=>(G("data-v-769464d0"),e=e(),Y(),e),$c=M(()=>a("h2",null,"Image options",-1)),kc={class:"column ok-col"},xc={key:0,class:"column"},Sc=M(()=>a("label",{for:"compositionSelect"},"Compositing Mode:",-1)),Pc=v("[?] "),jc=M(()=>a("option",{value:"source-over"},"source-over",-1)),Tc=M(()=>a("option",{value:"source-atop"},"source-atop",-1)),Ic=M(()=>a("option",{value:"destination-over"},"destination-over",-1)),_c=M(()=>a("option",{value:"destination-in"},"destination-in",-1)),Bc=M(()=>a("option",{value:"destination-in"},"destination-out",-1)),Oc=M(()=>a("option",{value:"destination-in"},"destination-atop",-1)),Dc=M(()=>a("option",{value:"lighter"},"lighter",-1)),Hc=M(()=>a("option",{value:"xor"},"xor",-1)),Ac=M(()=>a("option",{value:"multiply"},"multiply",-1)),Rc=M(()=>a("option",{value:"screen"},"screen",-1)),Mc=M(()=>a("option",{value:"overlay"},"overlay",-1)),Fc=M(()=>a("option",{value:"darken"},"darken",-1)),Nc=M(()=>a("option",{value:"lighten"},"lighten",-1)),Vc=M(()=>a("option",{value:"color-dodge"},"color-dodge",-1)),Wc=M(()=>a("option",{value:"color-burn"},"color-burn",-1)),Ec=M(()=>a("option",{value:"hard-light"},"hard-light",-1)),Lc=M(()=>a("option",{value:"soft-light"},"soft-light",-1)),Uc=M(()=>a("option",{value:"difference"},"difference",-1)),zc=M(()=>a("option",{value:"exclusion"},"exclusion",-1)),Xc=M(()=>a("option",{value:"hue"},"hue",-1)),Gc=M(()=>a("option",{value:"saturation"},"saturation",-1)),Yc=M(()=>a("option",{value:"color"},"color",-1)),qc=M(()=>a("option",{value:"luminosity"},"luminosity",-1)),Kc=[jc,Tc,Ic,_c,Bc,Oc,Dc,Hc,Ac,Rc,Mc,Fc,Nc,Vc,Wc,Ec,Lc,Uc,zc,Xc,Gc,Yc,qc],Jc=M(()=>a("label",{for:"addEffect"},"Add new effect",-1)),Zc=["value"],Qc=["disabled"],eu=["disabled"],tu=["disabled"],ou=["disabled"],su=["onClick","onKeydown"],nu={key:0,class:"value-input-table"},iu=M(()=>a("td",null,[a("label",{for:"shadow_color"},"Color:")],-1)),ru=M(()=>a("td",null,[a("label",{for:"filter_x"},"X:")],-1)),au=M(()=>a("td",null,[a("label",{for:"filter_y"},"Y:")],-1)),lu=M(()=>a("td",null,[a("label",{for:"filter_blur"},"Blur:")],-1)),du=M(()=>a("td",null,[a("label",{for:"filter_value"},"Value:")],-1)),cu=["value","max","min"],uu=v("% "),hu={key:0},pu={colspan:"2"},fu=M(()=>a("td",null,[a("label",{for:"filter_value"},"Value:")],-1)),gu=["value","max","min"],bu={key:0},mu={colspan:"2"};function yu(e,t,o,s,n,r){const i=C("color"),l=C("l"),d=C("d-flow"),c=C("slider"),u=C("d-fieldset");return e.showShadowColor?(p(),x(i,{key:0,modelValue:e.shadowColor,"onUpdate:modelValue":t[0]||(t[0]=h=>e.shadowColor=h),format:"rgb",onLeave:t[1]||(t[1]=h=>e.showShadowColor=!1)},null,8,["modelValue"])):(p(),x(d,{key:1,"no-wraping":"",class:"image-options-subpanel"},{default:w(()=>[$c,a("div",kc,[a("button",{onClick:t[2]||(t[2]=h=>e.$emit("leave"))},"Back")]),e.noComposition?S("",!0):(p(),b("div",xc,[Sc,y(l,{to:"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation#Types"},{default:w(()=>[Pc]),_:1}),R(a("select",{id:"compositionSelect","onUpdate:modelValue":t[3]||(t[3]=h=>e.compositionMode=h),onKeydown:t[4]||(t[4]=I(()=>{},["stop"]))},Kc,544),[[oe,e.compositionMode]])])),y(u,{class:"column",title:"Effects",style:{overflow:"hidden"}},{default:w(()=>[y(d,{class:"filter-flow","no-wraping":"",gap:"8px"},{default:w(()=>[y(d,{direction:"vertical","no-wraping":""},{default:w(()=>[Jc,R(a("select",{id:"addEffect","onUpdate:modelValue":t[5]||(t[5]=h=>e.addEffectSelection=h),onKeydown:t[6]||(t[6]=I(()=>{},["stop"]))},[(p(!0),b(_,null,L(e.filterTypes,h=>(p(),b("option",{key:h,value:h},V(e.getFilterLabel(h)),9,Zc))),128))],544),[[oe,e.addEffectSelection]]),a("button",{disabled:e.addEffectSelection==="",onClick:t[7]||(t[7]=(...h)=>e.addFilter&&e.addFilter(...h)),onKeydown:t[8]||(t[8]=I(()=>{},["stop"]))}," Add ",40,Qc),a("button",{disabled:!e.currentFilter,onClick:t[9]||(t[9]=(...h)=>e.removeFilter&&e.removeFilter(...h)),onKeydown:t[10]||(t[10]=I(()=>{},["stop"]))}," Remove ",40,eu),a("button",{disabled:e.currentFilterIdx===0,onClick:t[11]||(t[11]=h=>e.moveFilter(-1)),onKeydown:t[12]||(t[12]=I(()=>{},["stop"]))}," Move up ",40,tu),a("button",{disabled:e.currentFilterIdx===e.filters.length-1||e.filters.length===0,onClick:t[13]||(t[13]=h=>e.moveFilter(1)),onKeydown:t[14]||(t[14]=I(()=>{},["stop"]))}," Move down ",40,ou)]),_:1}),y(d,{maxSize:"100%",direction:"vertical","no-wraping":""},{default:w(()=>[(p(!0),b(_,null,L(e.filters,(h,f)=>(p(),b("div",{key:f,class:F({choiceBtn:!0,active:f===e.currentFilterIdx}),tabindex:"0",onClick:P=>e.selectFilter(f),onKeydown:[Q(P=>e.selectFilter(f),["enter"]),Q(I(P=>e.selectFilter(f),["prevent"]),["space"])]},V(e.getFilterText(h)),43,su))),128))]),_:1}),e.currentFilter?(p(),b("table",nu,[e.currentFilter.type==="drop-shadow"?(p(),b(_,{key:0},[a("tr",null,[iu,a("td",null,[a("button",{id:"shadow_color",class:"color-button",style:K({background:e.shadowColor}),onClick:t[15]||(t[15]=h=>e.showShadowColor=!0)}," \xA0 ",4)])]),a("tr",null,[ru,a("td",null,[R(a("input",{id:"filter_x",type:"number","onUpdate:modelValue":t[16]||(t[16]=h=>e.shadowX=h),onKeydown:t[17]||(t[17]=I(()=>{},["stop"]))},null,544),[[z,e.shadowX,void 0,{number:!0}]])])]),a("tr",null,[au,a("td",null,[R(a("input",{id:"filter_y",type:"number","onUpdate:modelValue":t[18]||(t[18]=h=>e.shadowY=h),onKeydown:t[19]||(t[19]=I(()=>{},["stop"]))},null,544),[[z,e.shadowY,void 0,{number:!0}]])])]),a("tr",null,[lu,a("td",null,[R(a("input",{id:"filter_blur",type:"number","onUpdate:modelValue":t[20]||(t[20]=h=>e.shadowBlur=h),onKeydown:t[21]||(t[21]=I(()=>{},["stop"]))},null,544),[[z,e.shadowBlur,void 0,{number:!0}]])])])],64)):e.isPercentFilter?(p(),b(_,{key:1},[a("tr",null,[du,a("td",null,[a("input",{id:"filter_value",value:(e.currentFilter.value*100).toFixed(),type:"number",max:e.maxValue,min:e.minValue,onInput:t[22]||(t[22]=h=>e.setValue({value:Number(h.target.value/100)})),onKeydown:t[23]||(t[23]=I(()=>{},["stop"]))},null,40,cu),uu])]),e.minValue===0&&e.maxValue!==void 0?(p(),b("tr",hu,[a("td",pu,[y(c,{gradientStops:["#000000","#ffffff"],label:"",maxValue:e.maxValue,modelValue:e.currentFilter.value*100,"no-input":"","onUpdate:modelValue":t[24]||(t[24]=h=>e.setValue({value:Math.round(h)/100}))},null,8,["maxValue","modelValue"])])])):S("",!0)],64)):(p(),b(_,{key:2},[a("tr",null,[fu,a("td",null,[a("input",{id:"filter_value",value:e.currentFilter.value,type:"number",max:e.maxValue,min:e.minValue,onInput:t[25]||(t[25]=h=>e.setValue({value:Number(h.target.value)})),onKeydown:t[26]||(t[26]=I(()=>{},["stop"]))},null,40,gu)])]),e.minValue===0&&e.maxValue!==void 0?(p(),b("tr",bu,[a("td",mu,[y(c,{gradientStops:e.hueStops,label:"",maxValue:e.maxValue,modelValue:e.currentFilter.value,"no-input":"","onUpdate:modelValue":t[27]||(t[27]=h=>e.setValue({value:Math.round(h)}))},null,8,["gradientStops","maxValue","modelValue"]),y(c,{gradientStops:e.hueStops,label:"",maxValue:e.maxValue,modelValue:e.currentFilter.value,"shift-gradient":"","no-input":"",disabled:""},null,8,["gradientStops","maxValue","modelValue"])])])):S("",!0)],64))])):S("",!0)]),_:1})]),_:1})]),_:1}))}var Wo=H(Cc,[["render",yu],["__scopeId","data-v-769464d0"]]);const vu=D({inheritAttrs:!1,components:{Color:Rt},props:{modelValue:{type:String,required:!0},title:{type:String,default:""}},data:()=>({colorSelector:"",selectedFont:"",selectedColor:"#000000",rememberedStart:0,rememberedEnd:0,error:""}),computed:{vertical(){return this.$store.state.ui.vertical}},watch:{selectedFont(){this.selectedFont!==""&&(this.insertCommand("font",this.selectedFont),this.selectedFont="")}},methods:{onValueChanged(){const e=T(),t=this.$refs.textArea.value;try{new ge(t,e.TextBox.NameboxTextStyle),this.error=""}catch(o){this.error=o.message}this.$emit("update:modelValue",t)},selectColor(e){const t=this.$refs.textArea;this.colorSelector=e,this.rememberedStart=t.selectionStart,this.rememberedEnd=t.selectionEnd},applyColor(){const e=this.selectedColor,t=this.colorSelector,o=()=>{const s=this.$refs.textArea;if(!s){this.$nextTick(o);return}s.selectionStart=this.rememberedStart,s.selectionEnd=this.rememberedEnd,this.insertCommand(t==="text"?"color":"outlinecolor",e)};this.$nextTick(o),this.selectedColor="#000000",this.colorSelector=""},insertText(e){const t=this.$refs.textArea,o=t.value,s=t.selectionStart,n=t.selectionEnd;t.value=o.slice(0,s)+e+o.slice(n),t.selectionStart=t.selectionEnd=s+e.length,t.focus(),this.onValueChanged()},insertCommand(e,t){const o=this.$refs.textArea,s=o.value,n=o.selectionStart,r=o.selectionEnd,i=s.slice(n,r),l=s.slice(0,n),d=s.slice(r);let c=e;t&&(c+="="+t),o.value=`${l}{${c}}${i}{/${e}}${d}`,o.selectionStart=n+c.length+2,o.selectionEnd=o.selectionStart+i.length,o.focus(),this.onValueChanged()}}}),wu=e=>(G("data-v-22d14270"),e=e(),Y(),e),Cu={class:"column ok-col"},$u={class:"column"},ku=["value"],xu={key:0,class:"column error-col"},Su={class:"column"},Pu=wu(()=>a("p",{class:"hint-col"},"Apply style to selected text:",-1)),ju={class:"column"},Tu={class:"column"},Iu={class:"column"},_u=Mn('<option value data-v-22d14270>Font</option><option value="aller" style="font-family:aller;" data-v-22d14270> Aller (Textbox) </option><option value="riffic" style="font-family:riffic;" data-v-22d14270> Riffic (Bold text) </option><option value="hashtag" style="font-family:hashtag;" data-v-22d14270> Hashtag (Sayori) </option><option value="ammy_handwriting" style="font-family:ammy_handwriting;" data-v-22d14270> Ammy&#39;s Handwriting (Natsuki) </option><option value="journal" style="font-family:journal;" data-v-22d14270> Journal (Monika) </option><option value="jp_hand_slanted" style="font-family:jp_hand_slanted;" data-v-22d14270> JP Hand Slanted (Yuri) </option><option value="damagrafik_script" style="font-family:damagrafik_script;" data-v-22d14270> Damagrafik (Yuri, Act 2) </option><option value="as_i_lay_dying" style="font-family:as_i_lay_dying;" data-v-22d14270> As I Lay Dying (Yuri, Act Unused) </option><option value="halogen" style="font-family:halogen;" data-v-22d14270> Halogen (MC) </option>',10),Bu=[_u];function Ou(e,t,o,s,n,r){const i=C("color");return e.colorSelector?(p(),x(i,{key:0,modelValue:e.selectedColor,"onUpdate:modelValue":t[0]||(t[0]=l=>e.selectedColor=l),onLeave:e.applyColor},null,8,["modelValue","onLeave"])):(p(),b("div",{key:1,class:F({"text-subpanel":!0,vertical:e.vertical})},[a("h2",null,V(e.title),1),a("div",Cu,[a("button",{onClick:t[1]||(t[1]=l=>e.$emit("leave"))},"OK")]),a("div",$u,[a("textarea",{ref:"textArea",value:e.modelValue,onInput:t[2]||(t[2]=(...l)=>e.onValueChanged&&e.onValueChanged(...l)),onKeydown:t[3]||(t[3]=I(()=>{},["stop"])),onKeypress:t[4]||(t[4]=I(()=>{},["stop"]))},null,40,ku)]),e.error?(p(),b("div",xu,V(e.error),1)):S("",!0),a("div",Su,[a("button",{onClick:t[5]||(t[5]=l=>e.insertText("\\\\")),class:"style-button"},"Insert \\"),a("button",{onClick:t[6]||(t[6]=l=>e.insertText("\\{")),class:"style-button"},"Insert {"),a("button",{onClick:t[7]||(t[7]=l=>e.insertText("\\}")),class:"style-button"},"Insert }")]),Pu,a("div",ju,[a("button",{onClick:t[8]||(t[8]=l=>e.insertCommand("b")),class:"style-button",style:{"font-weight":"bold"}}," Bold "),a("button",{onClick:t[9]||(t[9]=l=>e.insertCommand("i")),class:"style-button",style:{"font-style":"italic"}}," Italics "),a("button",{onClick:t[10]||(t[10]=l=>e.insertCommand("plain")),class:"style-button"}," Plain "),a("button",{onClick:t[11]||(t[11]=l=>e.insertCommand("edited")),class:"style-button edited-style"}," Edited "),a("button",{onClick:t[12]||(t[12]=l=>e.insertCommand("k",2)),class:"style-button",style:{"letter-spacing":"5px"}}," Kerning ")]),a("div",Tu,[a("button",{onClick:t[13]||(t[13]=l=>e.insertCommand("alpha",.5)),class:"style-button"}," Alpha ")]),a("div",Iu,[a("button",{onClick:t[14]||(t[14]=l=>e.insertCommand("size",12)),class:"style-button",style:{"font-size":"20px"}}," Font size "),R(a("select",{"onUpdate:modelValue":t[15]||(t[15]=l=>e.selectedFont=l),class:"style-button"},Bu,512),[[oe,e.selectedFont]]),a("button",{onClick:t[16]||(t[16]=l=>e.selectColor("text")),class:"style-button"}," Text color "),a("button",{onClick:t[17]||(t[17]=l=>e.selectColor("outline")),class:"style-button"}," Outline color ")])],2))}var Du=H(vu,[["render",Ou],["__scopeId","data-v-22d14270"]]);const Eo=ot(),Hu=D({mixins:[ee],components:{Toggle:ne,PositionAndSize:Nd,Layers:Kd,Delete:Qd,TextEditor:Du,ImageOptions:Wo,Color:Rt,ModalDialog:eo,DFieldset:re},props:{object:{type:Object,required:!0},title:String,textHandler:{type:Object},colorHandler:{type:Object},showAltPanel:Boolean},data:()=>({imageOptionsOpen:!1,canEdit:!0,modalNameInput:"",showRename:!1,localColorHandler:null}),computed:{flip:Eo("flip","panels/setFlip"),rotation:Eo("rotation","panels/setRotation"),enlargeWhenTalking:Eo("enlargeWhenTalking","panels/setEnlargeWhenTalking"),currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},nameboxWidth:{get(){const e=this.object.nameboxWidth;return e===null?"":e+""},set(e){const t=e.trim()===""?null:parseInt(e);this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setObjectNameboxWidth",{id:this.object.id,panelId:this.object.panelId,nameboxWidth:t})})}},zoom:{get(){return this.object.zoom*100},set(e){this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setObjectZoom",{id:this.object.id,panelId:this.object.panelId,zoom:e/100})})}},defaultNameboxWidth(){return T().TextBox.NameboxWidth},finalColorHandler(){return this.localColorHandler||this.colorHandler||null},hasLabel(){return this.object.label!==null},heading(){return this.object.label||this.title||"Object"},useCustomTextboxColor:{get(){return this.object.textboxColor!==null},set(e){this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setTextboxColor",{panelId:this.object.panelId,id:this.object.id,textboxColor:e?T().TextBoxCustom.textboxDefaultColor:null})})}}},methods:{copy(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/copyObjectToClipboard",{panelId:this.object.panelId,id:this.object.id})})},enableNameEdit(){this.modalNameInput=this.object.label||"",this.showRename=!0},renameOption(e){this.showRename=!1,e==="Apply"&&this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setLabel",{panelId:this.object.panelId,id:this.object.id,label:this.modalNameInput})})},selectTextboxColor(){this.localColorHandler={title:"Textbox color",get:()=>this.object.textboxColor,set:e=>{this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setTextboxColor",{panelId:this.object.panelId,id:this.object.id,textboxColor:e})})},leave:()=>{this.localColorHandler=null}}}}}),ze=e=>(G("data-v-72a4afec"),e=e(),Y(),e),Au={class:"panel"},Ru=ze(()=>a("span",{class:"icon material-icons"},"edit",-1)),Mu=ze(()=>a("p",{class:"modal-text"},"Enter the new name",-1)),Fu={class:"modal-text"},Nu={class:"input-table"},Vu=ze(()=>a("td",null,[a("label",{for:"rotation"},"Rotation: \xB0")],-1)),Wu={key:0},Eu=ze(()=>a("td",null,[a("label",{for:"zoom"},"Zoom: ")],-1)),Lu={key:0},Uu=ze(()=>a("td",null,[a("label",{for:"textbox_color"},"Color:")],-1)),zu=ze(()=>a("td",null,[a("label",{for:"namebox_width"},"Namebox width:")],-1)),Xu=["placeholder"];function Gu(e,t,o,s,n,r){const i=C("modal-dialog"),l=C("text-editor"),d=C("color"),c=C("image-options"),u=C("position-and-size"),h=C("layers"),f=C("toggle"),P=C("d-fieldset"),j=C("delete");return p(),b("div",Au,[a("h1",{style:K({fontStyle:e.hasLabel?"italic":"normal"}),onClick:t[0]||(t[0]=(...$)=>e.enableNameEdit&&e.enableNameEdit(...$))},[v(V(e.heading)+" ",1),Ru],4),(p(),x(Qo,{to:"#modal-messages"},[e.showRename?(p(),x(i,{key:0,options:["Apply","Cancel"],"no-base-size":"",class:"modal-rename",onOption:e.renameOption,onLeave:t[2]||(t[2]=$=>e.renameOption("Cancel"))},{default:w(()=>[Mu,a("p",Fu,[R(a("input",{"onUpdate:modelValue":t[1]||(t[1]=$=>e.modalNameInput=$),style:{width:"100%"}},null,512),[[z,e.modalNameInput]])])]),_:1},8,["onOption"])):S("",!0)])),e.textHandler?(p(),x(l,{key:0,title:e.textHandler.title,modelValue:e.textHandler.get(),"onUpdate:modelValue":t[3]||(t[3]=$=>e.textHandler.set($)),onLeave:t[4]||(t[4]=$=>e.textHandler.leave())},null,8,["title","modelValue"])):e.finalColorHandler?(p(),x(d,{key:1,title:e.finalColorHandler.title,modelValue:e.finalColorHandler.get(),"onUpdate:modelValue":t[5]||(t[5]=$=>e.finalColorHandler.set($)),onLeave:t[6]||(t[6]=$=>e.finalColorHandler.leave())},null,8,["title","modelValue"])):e.imageOptionsOpen?(p(),x(c,{key:2,type:"object","panel-id":e.object.panelId,id:e.object.id,onLeave:t[7]||(t[7]=$=>e.imageOptionsOpen=!1)},null,8,["panel-id","id"])):e.showAltPanel?ye(e.$slots,"alt-panel",{key:3},void 0,!0):(p(),b(_,{key:4},[ye(e.$slots,"default",{},void 0,!0),y(u,{obj:e.object},null,8,["obj"]),y(h,{object:e.object},null,8,["object"]),y(f,{modelValue:e.flip,"onUpdate:modelValue":t[8]||(t[8]=$=>e.flip=$),label:"Flip?"},null,8,["modelValue"]),a("table",Nu,[a("tr",null,[Vu,a("td",null,[R(a("input",{id:"rotation",class:"smol",type:"number","onUpdate:modelValue":t[9]||(t[9]=$=>e.rotation=$),onKeydown:t[10]||(t[10]=I(()=>{},["stop"]))},null,544),[[z,e.rotation]])])]),e.object.type==="character"||e.object.type==="sprite"?(p(),b("tr",Wu,[Eu,a("td",null,[R(a("input",{id:"zoom",type:"number",class:"smol",step:"1",min:"0","onUpdate:modelValue":t[11]||(t[11]=$=>e.zoom=$),onKeydown:t[12]||(t[12]=I(()=>{},["stop"]))},null,544),[[z,e.zoom]])])])):S("",!0)]),ye(e.$slots,"options",{},void 0,!0),e.hasLabel?(p(),x(P,{key:0,title:"Textbox settings"},{default:w(()=>[e.object.type==="character"||e.object.type==="sprite"?(p(),x(f,{key:0,label:"Enlarge when talking",modelValue:e.enlargeWhenTalking,"onUpdate:modelValue":t[13]||(t[13]=$=>e.enlargeWhenTalking=$)},null,8,["modelValue"])):S("",!0),y(f,{label:"Use custom textbox color",modelValue:e.useCustomTextboxColor,"onUpdate:modelValue":t[14]||(t[14]=$=>e.useCustomTextboxColor=$)},null,8,["modelValue"]),a("table",null,[e.useCustomTextboxColor?(p(),b("tr",Lu,[Uu,a("td",null,[a("button",{id:"textbox_color",class:"color-button",style:K({background:e.object.textboxColor}),onClick:t[15]||(t[15]=(...$)=>e.selectTextboxColor&&e.selectTextboxColor(...$))},null,4)])])):S("",!0),a("tr",null,[zu,a("td",null,[R(a("input",{id:"namebox_width",type:"number",placeholder:e.defaultNameboxWidth,"onUpdate:modelValue":t[16]||(t[16]=$=>e.nameboxWidth=$)},null,8,Xu),[[z,e.nameboxWidth,void 0,{lazy:!0}]])])])])]),_:1})):S("",!0),a("button",{onClick:t[17]||(t[17]=$=>e.imageOptionsOpen=!0)},"Image options"),a("button",{onClick:t[18]||(t[18]=(...$)=>e.copy&&e.copy(...$))},"Copy"),y(j,{obj:e.object},null,8,["obj"])],64))])}var Xe=H(Hu,[["render",Gu],["__scopeId","data-v-72a4afec"]]);const hn=ot(),Yu=D({mixins:[ee],components:{Toggle:ne,Parts:md,DFieldset:re,ObjectTool:Xe},data:()=>({panelForParts:null}),computed:{flip:hn("flip","panels/setFlip"),closeUp:hn("close","panels/setClose"),selection(){return this.$store.state.ui.selection},currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.selection];if(e.type==="character")return e},charData(){return St(this.$store,this.object)},label(){return this.charData.label||""},parts(){return zl(this.charData,this.object)},hasMultipleStyles(){return this.charData.styleGroups[this.object.styleGroupId].styles.length>1||this.charData.styleGroups.length>1},hasMultiplePoses(){return this.charData.styleGroups[this.object.styleGroupId].styles[this.object.styleId].poses.length>1}},methods:{seekPose(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekPose",{id:this.object.id,panelId:this.object.panelId,delta:e})})},seekStyle(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekStyle",{id:this.object.id,panelId:this.object.panelId,delta:e})})},seekPart(e,t){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekPart",{id:this.object.id,panelId:this.object.panelId,delta:t,part:e})})},captialize(e){return e.charAt(0).toUpperCase()+e.substring(1)}},watch:{selection(){this.panelForParts=null}}}),qu={key:0},Ku={class:"arrow-col"},Ju={class:"arrow-col"},Zu={key:1},Qu={class:"arrow-col"},eh={class:"arrow-col"},th={class:"arrow-col"},oh=["onClick"],sh=["onClick"],nh={class:"arrow-col"},ih=["onClick"];function rh(e,t,o,s,n,r){const i=C("parts"),l=C("d-fieldset"),d=C("toggle"),c=C("object-tool");return p(),x(c,{object:e.object,title:e.label,showAltPanel:!!e.panelForParts},{"alt-panel":w(()=>[e.panelForParts?(p(),x(i,{key:0,character:e.object,part:e.panelForParts,onLeave:t[0]||(t[0]=u=>e.panelForParts=null),onShowDialog:t[1]||(t[1]=u=>e.$emit("show-dialog",u)),onShowExpressionDialog:t[2]||(t[2]=u=>e.$emit("show-expression-dialog",u))},null,8,["character","part"])):S("",!0)]),default:w(()=>[e.hasMultiplePoses||e.parts.length>0||e.hasMultipleStyles?(p(),x(l,{key:0,class:"pose-list",title:"Pose:"},{default:w(()=>[a("table",null,[a("tbody",null,[e.hasMultipleStyles?(p(),b("tr",qu,[a("td",Ku,[a("button",{onClick:t[3]||(t[3]=u=>e.seekStyle(-1))},"<")]),a("td",null,[a("button",{class:"middle-button",onClick:t[4]||(t[4]=u=>e.panelForParts="style")}," Style ")]),a("td",Ju,[a("button",{onClick:t[5]||(t[5]=u=>e.seekStyle(1))},">")])])):S("",!0),e.hasMultiplePoses?(p(),b("tr",Zu,[a("td",Qu,[a("button",{onClick:t[6]||(t[6]=u=>e.seekPose(-1))},"<")]),a("td",null,[a("button",{class:"middle-button",onClick:t[7]||(t[7]=u=>e.panelForParts="pose")}," Pose ")]),a("td",eh,[a("button",{onClick:t[8]||(t[8]=u=>e.seekPose(1))},">")])])):S("",!0),(p(!0),b(_,null,L(e.parts,u=>(p(),b("tr",{key:u},[a("td",th,[a("button",{onClick:h=>e.seekPart(u,-1)},"<",8,oh)]),a("td",null,[a("button",{class:"middle-button",onClick:h=>e.panelForParts=u},V(e.captialize(u)),9,sh)]),a("td",nh,[a("button",{onClick:h=>e.seekPart(u,1)},">",8,ih)])]))),128))])])]),_:1})):S("",!0)]),options:w(()=>[y(d,{modelValue:e.closeUp,"onUpdate:modelValue":t[9]||(t[9]=u=>e.closeUp=u),label:"Close up?"},null,8,["modelValue"])]),_:1},8,["object","title","showAltPanel"])}var ah=H(Yu,[["render",rh],["__scopeId","data-v-28567f20"]]);const lh=D({mixins:[ee],components:{ObjectTool:Xe},computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="sprite")return e}}});function dh(e,t,o,s,n,r){const i=C("object-tool");return p(),x(i,{object:e.object,title:"Custom Sprite"},null,8,["object"])}var ch=H(lh,[["render",dh]]);function pn(e,t,o){return e>t?e:t>o?o:t}const fn=4,uh={setTalkingObject(e,t){const o=e.panels[t.panelId].objects[t.id];o.talkingObjId=t.talkingObjId,++o.version},setTalkingOther(e,t){const o=e.panels[t.panelId].objects[t.id];o.talkingOther=t.talkingOther,o.talkingObjId="$other$",++o.version},setResetBounds(e,t){const o=e.panels[t.panelId].objects[t.id];o.resetBounds=t.resetBounds,o.x=t.resetBounds.x,o.y=t.resetBounds.y,o.height=t.resetBounds.height,o.width=t.resetBounds.width,o.rotation=t.resetBounds.rotation,++o.version},setTextBoxProperty(e,t){const o=e.panels[t.panelId].objects[t.id];o[t.key]=t.value,++o.version}},hh={createTextBox({commit:e,state:t,rootState:o},s){var c;const n=T(),r=t.panels[s.panelId].lastObjId+1,i=n.TextBox.DefaultTextboxStyle,l=dt[i],d=s.resetBounds||{x:l.defaultX,y:l.defaultY,width:l.defaultWidth,height:l.defaultHeight,rotation:0};return e("create",{object:k(m(m({},Me()),d),{panelId:o.panels.currentPanel,id:r,onTop:!0,type:"textBox",preserveRatio:!1,ratio:n.TextBox.TextBoxWidth/n.TextBox.TextBoxHeight,continue:!0,controls:!0,skip:!0,autoQuoting:!0,autoWrap:!0,style:i,overrideColor:!1,customColor:n.TextBoxCustom.textboxDefaultColor,deriveCustomColors:!0,customControlsColor:n.TextBoxCustom.controlsDefaultColor,customNameboxColor:n.TextBoxCustom.nameboxDefaultColor,customNameboxWidth:null,customNameboxStroke:n.TextBoxCustom.nameboxStrokeDefaultColor,talkingObjId:null,talkingOther:"",text:(c=s.text)!=null?c:"Click here to edit the textbox",resetBounds:d})}),r},setStyle({state:e,commit:t},o){const s=T(),n=e.panels[o.panelId].objects[o.id],r=dt[n.style],i=dt[o.style],l=10;let d=!1;const c={panelId:o.panelId,id:o.id,x:n.x,y:n.y};let u=!1;const h={panelId:o.panelId,id:o.id,width:n.width,height:n.height};i.resizable?(r.defaultWidth!==i.defaultWidth&&(u=!0,h.width=Math.max(h.width+i.defaultWidth-r.defaultWidth,l)),r.defaultHeight!==i.defaultHeight&&(u=!0,h.height=Math.max(h.height+i.defaultHeight-r.defaultHeight,l))):(u=!0,h.width=i.defaultWidth,h.height=i.defaultHeight),r.defaultX!==i.defaultX&&(d=!0,c.x=pn(-h.width+l,c.x+i.defaultX-r.defaultX,s.Base.screenWidth-l)),r.defaultY!==i.defaultY&&(d=!0,c.y=pn(-h.height+l,c.y+i.defaultY-r.defaultY,s.Base.screenHeight-l)),d&&t("setPosition",c),u&&t("setSize",h),t("setTextBoxProperty",Mt(o.panelId,o.id,"style",o.style))},resetTextboxBounds({commit:e,state:t},o){const s=t.panels[o.panelId].objects[o.id];e("setPosition",{panelId:o.panelId,id:o.id,x:s.resetBounds.x,y:s.resetBounds.y}),e("setSize",{panelId:o.panelId,id:o.id,height:s.resetBounds.height,width:s.resetBounds.width}),e("setRotation",{panelId:o.panelId,id:o.id,rotation:s.resetBounds.rotation})},async splitTextbox({commit:e,state:t,dispatch:o},s){const n=t.panels[s.panelId].objects[s.id];if(n.type!=="textBox")return;const r=(n.width-fn)/2,i=r/2+fn/2,l=[n.x,n.y];let d=[n.x-i,n.y],c=[n.x+i,n.y];n.rotation!==0&&(d=_t(d[0],d[1],l[0],l[1],n.rotation/180*Math.PI),c=_t(c[0],c[1],l[0],l[1],n.rotation/180*Math.PI)),e("setResetBounds",{id:s.id,resetBounds:{x:d[0],y:d[1],width:r,height:n.height,rotation:n.rotation}});const u=n.style==="custom_plus"?"custom_plus":"custom";n.style!==u&&e("setStyle",Mt(s.panelId,s.id,"style",u));const h=await o("createTextBox",{resetBounds:{x:c[0],y:c[1],width:r,height:n.height,rotation:n.rotation}});e("setStyle",Mt(s.panelId,h,"style",u)),n.flip&&e("setFlip",{id:h,flip:n.flip})}};function Mt(e,t,o,s){return{id:t,panelId:e,key:o,value:s}}const gn=ot(),be=Io("panels/setTextBoxProperty"),ph=D({components:{Toggle:ne,DFieldset:re,ObjectTool:Xe,DFlow:tt},mixins:[ee],data:()=>({textEditor:"",colorSelect:""}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},customizable(){return this.textBoxStyle.startsWith("custom")},nameboxWidthDefault(){return T().TextBox.NameboxWidth},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="textBox")return e},textHandler(){if(!!this.textEditor)return{title:this.textEditorName,get:()=>this.textEditor==="name"?this.object.talkingOther:this.textEditor==="body"?this.dialog:"",set:e=>{this.textEditor==="name"?this.talkingOther=e:this.textEditor==="body"&&(this.dialog=e)},leave:()=>{this.textEditor=""}}},colorHandler(){if(!!this.colorSelect)return{title:this.colorName,get:()=>{switch(this.colorSelect){case"":return"#000000";case"base":return this.object.customColor;case"controls":return this.object.customControlsColor;case"namebox":return this.object.customNameboxColor;case"nameboxStroke":return this.object.customNameboxStroke;default:throw new de.UnreachableCaseError(this.colorSelect)}},set:e=>{this.vuexHistory.transaction(()=>{const t=this.currentPanel.id,o=this.object.id;let s={base:"customColor",controls:"customControlsColor",namebox:"customNameboxColor",nameboxStroke:"customNameboxStroke","":void 0}[this.colorSelect];e!==void 0&&this.$store.commit("panels/setTextBoxProperty",Mt(t,o,"customNameboxStroke",s))})},leave:()=>{this.colorSelect=""}}},talkingObjId:{get(){return this.object.talkingObjId||"$null$"},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setTalkingObject",{id:this.object.id,panelId:this.object.panelId,talkingObjId:e==="$null$"?null:e})})}},talkingOther:gn("talkingOther","panels/setTalkingOther"),textBoxStyle:gn("style","panels/setStyle",!0),showControls:be("controls"),allowSkipping:be("skip"),autoQuoting:be("autoQuoting"),autoWrap:be("autoWrap"),showContinueArrow:be("continue"),dialog:be("text"),overrideColor:be("overrideColor"),deriveCustomColors:be("deriveCustomColors"),customNameboxWidth:be("customNameboxWidth"),nameList(){const e=this.currentPanel,t=[];for(const o of[...e.order,...e.onTopOrder]){const s=e.objects[o];s.label!==null&&t.push([o,s.label])}return t},textEditorName(){return this.textEditor==="name"?"Name":this.textEditor==="body"?"Dialog":""},customControlsColor(){return this.object.customControlsColor},colorName(){switch(this.colorSelect){case"":return"";case"base":return"Base color";case"controls":return"Controls color";case"namebox":return"Namebox color";case"nameboxStroke":return"Namebox text stroke";default:throw new de.UnreachableCaseError(this.colorSelect)}}},methods:{splitTextbox(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/splitTextbox",{id:this.object.id,panelId:this.object.panelId})})},resetPosition(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/resetTextboxBounds",{id:this.object.id,panelId:this.object.panelId})})},jumpToCharacter(){this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",this.talkingObjId)})}}}),q=e=>(G("data-v-4a56d15d"),e=e(),Y(),e),fh={class:"upper-combos"},gh=q(()=>a("td",null,[a("label",{for:"text_style"},"Style:")],-1)),bh={colspan:"2"},mh=q(()=>a("option",{value:"normal"},"Normal",-1)),yh=q(()=>a("option",{value:"corrupt"},"Corrupt",-1)),vh=q(()=>a("option",{value:"custom"},"Custom",-1)),wh=q(()=>a("option",{value:"custom_plus"},"Custom (Plus)",-1)),Ch=q(()=>a("option",{value:"none"},"None",-1)),$h=[mh,yh,vh,wh,Ch],kh=q(()=>a("td",null,[a("label",{for:"current_talking"},"Person talking:")],-1)),xh=q(()=>a("option",{value:"$null$"},"No-one",-1)),Sh=["value"],Ph=q(()=>a("option",{value:"$other$"},"Other",-1)),jh=["disabled"],Th=q(()=>a("td",null,[a("label",{for:"custom_name"},"Other name:")],-1)),Ih={id:"dialog_text_wrapper"},_h=q(()=>a("label",{for:"dialog_text"},"Dialog:",-1)),Bh={key:0},Oh=q(()=>a("td",null,[a("label",{for:"custom_namebox_width"},"Namebox width:")],-1)),Dh=["placeholder","disabled"],Hh={colspan:"2"},Ah={key:0},Rh=q(()=>a("td",null,[a("label",{for:"textbox_color"},"Color:")],-1)),Mh={key:1},Fh={colspan:"2"},Nh=q(()=>a("td",null,[a("label",{for:"custom_controls_color"},"Controls Color:")],-1)),Vh=q(()=>a("td",null,[a("label",{for:"custom_namebox_color"},"Namebox Color:")],-1)),Wh=q(()=>a("td",null,[a("label",{for:"custom_namebox_stroke"},"Namebox text stroke:")],-1));function Eh(e,t,o,s,n,r){const i=C("toggle"),l=C("d-flow"),d=C("d-fieldset"),c=C("object-tool");return p(),x(c,{object:e.object,title:"Textbox",textHandler:e.textHandler,colorHandler:e.colorHandler},{default:w(()=>[a("table",fh,[a("tr",null,[gh,a("td",bh,[R(a("select",{id:"text_style","onUpdate:modelValue":t[0]||(t[0]=u=>e.textBoxStyle=u),onKeydown:t[1]||(t[1]=I(()=>{},["stop"]))},$h,544),[[oe,e.textBoxStyle]])])]),a("tr",null,[kh,a("td",null,[R(a("select",{id:"current_talking","onUpdate:modelValue":t[2]||(t[2]=u=>e.talkingObjId=u),onKeydown:t[3]||(t[3]=I(()=>{},["stop"]))},[xh,(p(!0),b(_,null,L(e.nameList,([u,h])=>(p(),b("option",{key:u,value:u},V(h),9,Sh))),128)),Ph],544),[[oe,e.talkingObjId]])]),a("td",null,[a("button",{title:"Jump to talking character",onClick:t[4]||(t[4]=(...u)=>e.jumpToCharacter&&e.jumpToCharacter(...u)),disabled:e.talkingObjId==="$null$"||e.talkingObjId==="$other$"}," > ",8,jh)])]),a("tr",null,[Th,a("td",null,[R(a("input",{id:"custom_name","onUpdate:modelValue":t[5]||(t[5]=u=>e.talkingOther=u),onKeydown:t[6]||(t[6]=I(()=>{},["stop"]))},null,544),[[z,e.talkingOther]])]),a("td",null,[a("button",{onClick:t[7]||(t[7]=u=>e.textEditor="name")},"...")])])]),y(i,{label:"Auto quoting?",modelValue:e.autoQuoting,"onUpdate:modelValue":t[8]||(t[8]=u=>e.autoQuoting=u)},null,8,["modelValue"]),y(i,{label:"Auto line wrap?",modelValue:e.autoWrap,"onUpdate:modelValue":t[9]||(t[9]=u=>e.autoWrap=u)},null,8,["modelValue"]),a("div",Ih,[_h,R(a("textarea",{"onUpdate:modelValue":t[10]||(t[10]=u=>e.dialog=u),id:"dialog_text",onKeydown:t[11]||(t[11]=I(()=>{},["stop"]))},null,544),[[z,e.dialog]]),a("button",{onClick:t[12]||(t[12]=u=>e.textEditor="body")},"Formatting")])]),options:w(()=>[y(d,{title:"Customization:",class:F(e.customizable?"customization-set":"")},{default:w(()=>[y(l,{direction:"vertical",maxSize:"100%","no-wraping":""},{default:w(()=>[y(i,{label:"Controls visible?",modelValue:e.showControls,"onUpdate:modelValue":t[13]||(t[13]=u=>e.showControls=u)},null,8,["modelValue"]),y(i,{label:"Able to skip?",modelValue:e.allowSkipping,"onUpdate:modelValue":t[14]||(t[14]=u=>e.allowSkipping=u)},null,8,["modelValue"]),y(i,{label:"Continue arrow?",modelValue:e.showContinueArrow,"onUpdate:modelValue":t[15]||(t[15]=u=>e.showContinueArrow=u)},null,8,["modelValue"]),e.customizable?(p(),b("table",Bh,[a("tr",null,[Oh,a("td",null,[R(a("input",{id:"custom_namebox_width",type:"number",style:{width:"48px"},placeholder:e.nameboxWidthDefault,"onUpdate:modelValue":t[16]||(t[16]=u=>e.customNameboxWidth=u),disabled:e.overrideColor,onKeydown:t[17]||(t[17]=I(()=>{},["stop"]))},null,40,Dh),[[z,e.customNameboxWidth,void 0,{number:!0}]])])]),a("tr",null,[a("td",Hh,[y(i,{modelValue:e.overrideColor,"onUpdate:modelValue":t[18]||(t[18]=u=>e.overrideColor=u),label:"Override color"},null,8,["modelValue"])])]),e.overrideColor?(p(),b("tr",Ah,[Rh,a("td",null,[a("button",{id:"textbox_color",class:"color-button",style:K({background:e.object.customColor}),onClick:t[19]||(t[19]=u=>e.colorSelect="base")},null,4)])])):S("",!0),e.overrideColor?(p(),b("tr",Mh,[a("td",Fh,[y(i,{id:"derive_custom_colors",modelValue:e.deriveCustomColors,"onUpdate:modelValue":t[20]||(t[20]=u=>e.deriveCustomColors=u),label:"Derive other colors"},null,8,["modelValue"])])])):S("",!0),e.overrideColor&&!e.deriveCustomColors?(p(),b(_,{key:2},[a("tr",null,[Nh,a("td",null,[a("button",{id:"custom_controls_color",class:"color-button",style:K({background:e.object.customControlsColor}),onClick:t[21]||(t[21]=u=>e.colorSelect="controls")},null,4)])]),a("tr",null,[Vh,a("td",null,[a("button",{id:"custom_namebox_color",class:"color-button",style:K({background:e.object.customNameboxColor}),onClick:t[22]||(t[22]=u=>e.colorSelect="namebox")},null,4)])]),a("tr",null,[Wh,a("td",null,[a("button",{id:"custom_namebox_stroke",class:"color-button",style:K({background:e.object.customNameboxStroke}),onClick:t[23]||(t[23]=u=>e.colorSelect="nameboxStroke")},null,4)])])],64)):S("",!0)])):S("",!0)]),_:1})]),_:1},8,["class"]),a("button",{onClick:t[24]||(t[24]=(...u)=>e.resetPosition&&e.resetPosition(...u))},"Reset position"),a("button",{onClick:t[25]||(t[25]=(...u)=>e.splitTextbox&&e.splitTextbox(...u))},"Split textbox")]),_:1},8,["object","textHandler","colorHandler"])}var Lh=H(ph,[["render",Eh],["__scopeId","data-v-4a56d15d"]]);const Uh=ot(),zh=D({mixins:[ee],components:{Toggle:ne,DFieldset:re,DFlow:tt,ObjectTool:Xe},data:()=>({currentIdx:0,textEditor:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="choice")return e},autoWrap:Uh("autoWrap","panels/setAutoWrapping"),buttonText:Xh("text"),buttons(){return this.object.choices},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.buttonText,set:e=>{this.buttonText=e},leave:()=>{this.textEditor=!1}}}},methods:{select(e){this.currentIdx=e},addChoice(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/addChoice",{id:this.object.id,panelId:this.object.panelId,text:""})})},removeChoice(){this.vuexHistory.transaction(()=>{this.currentIdx===this.object.choices.length-1&&this.currentIdx>0&&this.select(this.currentIdx-1),this.$store.dispatch("panels/removeChoice",{id:this.object.id,panelId:this.object.panelId,choiceIdx:this.currentIdx})})}}});function Xh(e){return{get(){return this.object.choices[this.currentIdx][e]},set(t){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setChoiceProperty",{id:this.object.id,panelId:this.object.panelId,choiceIdx:this.currentIdx,key:e,value:t})})}}}const Gh=e=>(G("data-v-0171b764"),e=e(),Y(),e),Yh=["onClick"],qh=Gh(()=>a("tr",null,[a("td",{colspan:"2"},[a("label",{for:"choice-button-input"},"Text")])],-1));function Kh(e,t,o,s,n,r){const i=C("d-flow"),l=C("d-fieldset"),d=C("toggle"),c=C("object-tool");return p(),x(c,{object:e.object,title:"Choice",textHandler:e.textHandler},{default:w(()=>[y(l,{class:"buttons",title:"Buttons:"},{default:w(()=>[y(i,{maxSize:"100%",direction:"vertical",noWraping:""},{default:w(()=>[(p(!0),b(_,null,L(e.buttons,(u,h)=>(p(),b("div",{class:F({choiceBtn:!0,active:h===e.currentIdx}),key:h,onClick:f=>e.select(h)},V(u.text.trim()===""?"[Empty]":u.text),11,Yh))),128))]),_:1})]),_:1}),y(l,{class:"current_button",title:"Current button:"},{default:w(()=>[a("table",null,[qh,a("tr",null,[a("td",null,[R(a("input",{id:"choice-button-input","onUpdate:modelValue":t[0]||(t[0]=u=>e.buttonText=u),onKeydown:t[1]||(t[1]=I(()=>{},["stop"]))},null,544),[[z,e.buttonText]])]),a("td",null,[a("button",{onClick:t[2]||(t[2]=u=>e.textEditor=!0)},"...")])])])]),_:1}),a("button",{onClick:t[3]||(t[3]=(...u)=>e.addChoice&&e.addChoice(...u))},"Add"),a("button",{onClick:t[4]||(t[4]=(...u)=>e.removeChoice&&e.removeChoice(...u))},"Remove"),y(d,{label:"Auto line wrap?",modelValue:e.autoWrap,"onUpdate:modelValue":t[5]||(t[5]=u=>e.autoWrap=u)},null,8,["modelValue"])]),_:1},8,["object","textHandler"])}var Jh=H(zh,[["render",Kh],["__scopeId","data-v-0171b764"]]);const Zh=D({mixins:[ee],components:{L:to}}),me=e=>(G("data-v-b040f784"),e=e(),Y(),e),Qh={class:"panel"},ep=me(()=>a("h1",null,"Help and Credits",-1)),tp=v("Help"),op=v("Fork me on GitHub"),sp=v("Privacy Statement"),np=me(()=>a("p",null," All assets used are IP of Team Salvato and created by them, unless noted otherwise. ",-1)),ip=me(()=>a("p",null,[v(" Doki Doki Dialog Generator developed by EDave64 "),a("br"),v("Based on gemdude46's DDLC Shitpost generator ")],-1)),rp=v(" Unused House Background by "),ap=v(" Fatelogic "),lp=v(" Aller Font by "),dp=v("Dalton Maag Ltd"),cp=v(" Riffic Bold Font by "),up=v("InkyType"),hp=v(" Verily Serif Mono Font by "),pp=v("Stephen G. Hartke"),fp=v(" F25 Bank Printer Font by "),gp=v("F25 Digital Typeface Design"),bp=v(" Journal Font by "),mp=v("Fontourist"),yp=v(" Hashtag Font by "),vp=v(" TitanVex"),wp=v(" JP Hand Slanted Font by "),Cp=v("Jonathan Paterson"),$p=v(" As I Lay Dying Font by "),kp=v("Moises Esqueda"),xp=v(" Damagrafik Script Font by "),Sp=v("Davide Terenzi"),Pp=v(" Ammy's Handwriting Font by "),jp=v("Ammy K."),Tp=v(" Halogen Font by "),Ip=v("JLH Fonts"),_p=me(()=>a("p",null,[v(" MC Sprite by Childish-N "),a("br"),v("MC Casual Sprite by SlightlySimple "),a("br"),v("MC Chibi by SlightlySimple ")],-1)),Bp=v("Concept MC"),Op=v(" by StormBlazed76, "),Dp=v("red"),Hp=v(" and "),Ap=v("yellow"),Rp=v(" eyes by YinuS_WinneR, "),Mp=v("chibi"),Fp=v(" by Hadrosaur838 "),Np=me(()=>a("p",null,[v(" MC Chad Sprite by Cylent-Nite "),a("br"),v("MC Chad Poses and expressions by SlightlySimple "),a("br"),v("MC Chad Poses and chibi by Meddy-sin ")],-1)),Vp=me(()=>a("p",null,[v(" FeMC Sprite by Meddy-sin "),a("br"),v("FeMC Casual Sprite by SlightlySimple ")],-1)),Wp=v("Concept FeMC"),Ep=v(" by ShidoDraws, "),Lp=v("additional poses, expressions and chibi"),Up=v(" by SlightlySimple "),zp=me(()=>a("p",null,"Amy Sprite by Meddy-sin and SlightlySimple",-1)),Xp=me(()=>a("p",null,"Special thanks to SlightlySimple for testing and technical help",-1)),Gp=me(()=>a("p",null," Atlas421, T-Rex Harris, smearglexd and Tactical Cupcakes for suggestions and testing ",-1));function Yp(e,t,o,s,n,r){const i=C("l");return p(),b("div",Qh,[ep,y(i,{class:"btn",to:"wiki://Dokumentation"},{default:w(()=>[tp]),_:1}),y(i,{class:"btn",to:"github://"},{default:w(()=>[op]),_:1}),y(i,{class:"btn",to:"wiki://Privacy Statement"},{default:w(()=>[sp]),_:1}),np,ip,a("p",null,[rp,y(i,{to:"https://www.deviantart.com/fatelogic/art/VN-Background-Practice-295671161"},{default:w(()=>[ap]),_:1})]),a("p",null,[lp,y(i,{to:"https://www.daltonmaag.com/library/aller"},{default:w(()=>[dp]),_:1})]),a("p",null,[cp,y(i,{to:"https://www.fontspring.com/fonts/inky-type/riffic"},{default:w(()=>[up]),_:1})]),a("p",null,[hp,y(i,{to:"https://www.dafont.com/verily-serif-mono.font"},{default:w(()=>[pp]),_:1})]),a("p",null,[fp,y(i,{to:"https://www.dafont.com/f25-bank-printer.font"},{default:w(()=>[gp]),_:1})]),a("p",null,[bp,y(i,{to:"https://www.dafont.com/journal.font"},{default:w(()=>[mp]),_:1})]),a("p",null,[yp,y(i,{to:"https://www.dafont.com/hashtag.font"},{default:w(()=>[vp]),_:1})]),a("p",null,[wp,y(i,{to:"https://www.dafont.com/jp-hand-slanted.font"},{default:w(()=>[Cp]),_:1})]),a("p",null,[$p,y(i,{to:"https://www.dafont.com/as-i-lay-dying.font"},{default:w(()=>[kp]),_:1})]),a("p",null,[xp,y(i,{to:"https://www.dafont.com/damagrafik-script.font"},{default:w(()=>[Sp]),_:1})]),a("p",null,[Pp,y(i,{to:"https://www.dafont.com/ammys-handwriting.font"},{default:w(()=>[jp]),_:1})]),a("p",null,[Tp,y(i,{to:"https://www.dafont.com/halogen.font"},{default:w(()=>[Ip]),_:1})]),_p,a("p",null,[y(i,{to:"https://www.reddit.com/ofkg59"},{default:w(()=>[Bp]),_:1}),Op,y(i,{to:"https://www.reddit.com/og6shh"},{default:w(()=>[Dp]),_:1}),Hp,y(i,{to:"https://www.reddit.com/oft3vb"},{default:w(()=>[Ap]),_:1}),Rp,y(i,{to:"https://www.reddit.com/ofof3o"},{default:w(()=>[Mp]),_:1}),Fp]),Np,Vp,a("p",null,[y(i,{to:"https://www.reddit.com/oizaow"},{default:w(()=>[Wp]),_:1}),Ep,y(i,{to:"https://www.reddit.com/oosuxu"},{default:w(()=>[Lp]),_:1}),Up]),zp,Xp,Gp])}var qp=H(Zh,[["render",Yp],["__scopeId","data-v-b040f784"]]);const Kp=D({props:{backgroundId:{type:String,required:!0}},data:()=>({isWebPSupported:null,assets:[]}),computed:{background(){const e=this.$store.state.panels.currentPanel;return this.$store.state.panels.panels[e].background},bgData(){return this.$store.getters["content/getBackgrounds"].get(this.backgroundId)||null},isActive(){return this.backgroundId===this.background.current},title(){switch(this.backgroundId){case"buildin.static-color":return"Static color";case"buildin.transparent":return"Transparent"}return this.bgData.label||""},style(){switch(this.backgroundId){case"buildin.static-color":return{"background-color":this.background.color};case"buildin.transparent":return{}}return{backgroundImage:this.assets.filter(t=>t instanceof qe).map(t=>`url('${t.html.src}')`).join(",")}}},async created(){this.bgData&&(this.assets=await Promise.all(this.bgData.variants[0].map(e=>Oe(e,!1))))}}),Jp=["title"];function Zp(e,t,o,s,n,r){return p(),b("div",{class:F({background:!0,active:e.isActive}),title:e.title,style:K(e.style),tabindex:"0",onClick:t[0]||(t[0]=i=>e.$emit("input",e.backgroundId)),onKeydown:[t[1]||(t[1]=Q(i=>e.$emit("input",e.backgroundId),["enter"])),t[2]||(t[2]=Q(I(i=>e.$emit("input",e.backgroundId),["prevent"]),["space"]))]},V(e.title),47,Jp)}var Qp=H(Kp,[["render",Zp],["__scopeId","data-v-4cdc2af0"]]);const ef=D({components:{Toggle:ne,DFieldset:re},computed:{vertical(){return this.$store.state.ui.vertical},color:{get(){return this.background.color},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundColor",{color:e,panelId:this.$store.state.panels.currentPanel})})}},flipped:{get(){return this.background.flipped},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundFlipped",{flipped:e,panelId:this.$store.state.panels.currentPanel})})}},scaling:{get(){return this.background.scaling.toString()},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundScaling",{scaling:parseInt(e,10),panelId:this.$store.state.panels.currentPanel})})}},currentBackgroundId(){return this.background.current},background(){const e=this.$store.state.panels.currentPanel;return this.$store.state.panels.panels[e].background},bgData(){return this.$store.state.content.current.backgrounds.find(e=>e.id===this.currentBackgroundId)||null},isColor(){return this.currentBackgroundId==="buildin.static-color"},isVariant(){return!!this.bgData},hasVariants(){return this.bgData?this.bgData.variants.length>1:!1}},methods:{seekVariant(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekBackgroundVariant",{delta:e,panelId:this.$store.state.panels.currentPanel})})}}}),ct=e=>(G("data-v-50397f46"),e=e(),Y(),e),tf=ct(()=>a("label",{for:"bg_color"},"Color:",-1)),of={key:1},sf={colspan:"3"},nf={key:0},rf={class:"arrow-col"},af=ct(()=>a("td",{style:{"text-align":"center"}},"Variant",-1)),lf={class:"arrow-col"},df={colspan:"3"},cf=ct(()=>a("option",{value:"0"},"None",-1)),uf=ct(()=>a("option",{value:"1"},"Stretch",-1)),hf=ct(()=>a("option",{value:"2"},"Cover",-1)),pf=[cf,uf,hf],ff={colspan:"3"};function gf(e,t,o,s,n,r){const i=C("toggle"),l=C("d-fieldset");return p(),x(l,{class:F({"bg-settings":!0,vertical:e.vertical}),title:"Settings:"},{default:w(()=>[e.isColor?(p(),b(_,{key:0},[tf,a("button",{id:"bg_color",class:"color-button",style:K({background:e.color}),onClick:t[0]||(t[0]=d=>e.$emit("change-color"))},null,4)],64)):S("",!0),e.isVariant?(p(),b("table",of,[a("tr",null,[a("td",sf,[y(i,{modelValue:e.flipped,"onUpdate:modelValue":t[1]||(t[1]=d=>e.flipped=d),label:"Flipped?"},null,8,["modelValue"])])]),e.hasVariants?(p(),b("tr",nf,[a("td",rf,[a("button",{class:"small-button",onClick:t[2]||(t[2]=d=>e.seekVariant(-1))},"<")]),af,a("td",lf,[a("button",{class:"small-button",onClick:t[3]||(t[3]=d=>e.seekVariant(1))},">")])])):S("",!0),a("tr",null,[a("td",df,[R(a("select",{"onUpdate:modelValue":t[4]||(t[4]=d=>e.scaling=d),onKeydown:t[5]||(t[5]=I(()=>{},["stop"]))},pf,544),[[oe,e.scaling]])])]),a("tr",null,[a("td",ff,[a("button",{id:"image_options_button",onClick:t[6]||(t[6]=d=>e.$emit("open-image-options"))}," Image options ")])])])):S("",!0)]),_:1},8,["class"])}var bf=H(ef,[["render",gf],["__scopeId","data-v-50397f46"]]);const bn={packId:"dddg.buildin.uploadedBackgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},mf=D({mixins:[ee],components:{BackgroundButton:Qp,BackgroundSettings:bf,DropTarget:us,Color:Rt,ImageOptions:Wo,DButton:mt},data:()=>({colorSelect:!1,imageOptions:!1}),computed:{bgColor:{get(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel].background.color},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundColor",{color:e,panelId:this.$store.state.panels.currentPanel})})}},backgrounds(){return[...this.$store.state.content.current.backgrounds.map(e=>e.id),"buildin.static-color","buildin.transparent"]},showBackgroundsFolder(){return B.supports.openableFolders.has("backgrounds")}},methods:{setBackground(e){this.$store.commit("panels/setCurrentBackground",{current:e,panelId:this.$store.state.panels.currentPanel})},onFileUpload(e){const t=this.$refs.upload;if(!!t.files)for(const o of t.files)this.addImageFile(o)},addImageFile(e){const t=URL.createObjectURL(e);this.addNewCustomBackground(e.name,e.name,t)},addByUrl(){const e=prompt("Enter the URL of the image");if(!e)return;const t=e.split("/").slice(-1)[0];this.addNewCustomBackground(t,t,e)},addNewCustomBackground(e,t,o){bn.backgrounds.push({id:e,label:t,variants:[[o]],scaling:"none"}),this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:bn}),this.setBackground(e)})},dragEnter(e){!e.dataTransfer||(e.dataTransfer.effectAllowed="none",!!Array.from(e.dataTransfer.items).find(t=>t.type.match(/^image.*$/))&&(e.dataTransfer.effectAllowed="link",this.$refs.dt.show()))},openBackgroundFolder(){B.openFolder("backgrounds")}}}),mn=e=>(G("data-v-5fa31ece"),e=e(),Y(),e),yf=v("Drop here to add as a new background "),vf=mn(()=>a("h1",null,"Background",-1)),wf=v(" Upload "),Cf=mn(()=>a("i",{class:"material-icons"},"extension",-1)),$f=v(" Search in content packs "),kf=[Cf,$f],xf=v(" Open backgrounds folder ");function Sf(e,t,o,s,n,r){const i=C("drop-target"),l=C("color"),d=C("image-options"),c=C("background-settings"),u=C("d-button"),h=C("background-button");return p(),b("div",{class:"panel",onDragenter:t[9]||(t[9]=(...f)=>e.dragEnter&&e.dragEnter(...f)),onMouseleave:t[10]||(t[10]=f=>e.$refs.dt.hide())},[y(i,{ref:"dt",class:"drop-target",onDrop:e.addImageFile},{default:w(()=>[yf]),_:1},8,["onDrop"]),vf,e.colorSelect?(p(),x(l,{key:0,modelValue:e.bgColor,"onUpdate:modelValue":t[0]||(t[0]=f=>e.bgColor=f),onLeave:t[1]||(t[1]=f=>e.colorSelect=!1)},null,8,["modelValue"])):e.imageOptions?(p(),x(d,{key:1,type:"background",title:"","panel-id":e.$store.state.panels.currentPanel,"no-composition":"",onLeave:t[2]||(t[2]=f=>e.imageOptions=!1)},null,8,["panel-id"])):(p(),b(_,{key:2},[y(c,{onChangeColor:t[3]||(t[3]=f=>e.colorSelect=!0),onOpenImageOptions:t[4]||(t[4]=f=>e.imageOptions=!0)}),a("button",{class:"btn upload-background",onClick:t[6]||(t[6]=f=>e.$refs.upload.click())},[wf,a("input",{type:"file",ref:"upload",onChange:t[5]||(t[5]=(...f)=>e.onFileUpload&&e.onFileUpload(...f))},null,544)]),a("button",{class:"upload-background",onClick:t[7]||(t[7]=(...f)=>e.addByUrl&&e.addByUrl(...f))},"Add by URL"),a("button",{class:"upload-background",onClick:t[8]||(t[8]=f=>e.$emit("show-dialog","type: Backgrounds"))},kf),e.showBackgroundsFolder?(p(),x(u,{key:0,icon:"folder",class:"upload-background",onClick:e.openBackgroundFolder},{default:w(()=>[xf]),_:1},8,["onClick"])):S("",!0),(p(!0),b(_,null,L(e.backgrounds,f=>(p(),x(h,{key:f,backgroundId:f,onInput:P=>e.setBackground(f)},null,8,["backgroundId","onInput"]))),128))],64))],32)}var Pf=H(mf,[["render",Sf],["__scopeId","data-v-5fa31ece"]]);const jf={},Tf={async createSprite({commit:e,rootState:t,state:o},s){const n=await Oe(s.assets[0],!1);if(!(n instanceof qe))return;const r=o.panels[s.panelId].lastObjId+1;return e("create",{object:k(m({},Me()),{assets:s.assets,height:n.height,width:n.width,id:r,panelId:t.panels.currentPanel,onTop:!1,preserveRatio:!0,ratio:n.width/n.height,type:"sprite",y:0,enlargeWhenTalking:t.ui.defaultCharacterTalkingZoom})}),r}},If={setChoicesProperty(e,t){const o=e.panels[t.panelId].objects[t.id];o[t.key]=t.value,++o.version},setChoiceProperty(e,t){const o=e.panels[t.panelId].objects[t.id];o.choices[t.choiceIdx][t.key]=t.value,++o.version},setChoices(e,t){const o=e.panels[t.panelId].objects[t.id];o.choices=t.choices,++o.version}},_f={createChoice({commit:e,rootState:t,state:o},s){const n=T(),r=o.panels[s.panelId].lastObjId+1;return e("create",{object:k(m({},Me()),{y:n.Choices.ChoiceY,width:n.Choices.ChoiceButtonWidth,height:0,panelId:t.panels.currentPanel,id:r,onTop:!0,autoWrap:!0,type:"choice",preserveRatio:!1,ratio:n.TextBox.TextBoxWidth/n.TextBox.TextBoxHeight,choiceDistance:n.Choices.ChoiceSpacing,choices:[{selected:!1,text:"Click here to edit choice"}],customColor:n.Choices.ChoiceButtonColor})}),r},addChoice({state:e,commit:t},o){const s=e.panels[o.panelId].objects[o.id];t("setChoices",{id:o.id,panelId:o.panelId,choices:[...s.choices,{selected:!1,text:o.text}]})},removeChoice({state:e,commit:t},o){const n=[...e.panels[o.panelId].objects[o.id].choices];!n[o.choiceIdx]||(n.splice(o.choiceIdx,1),n.length===0&&n.push({selected:!1,text:""}),t("setChoices",{id:o.id,panelId:o.panelId,choices:n}))}},Bf={setNotificationProperty(e,t){const o=e.panels[t.panelId].objects[t.id];o[t.key]=t.value,++o.version}},Of={createNotification({commit:e,rootState:t,state:o},s){const n=T(),r=o.panels[s.panelId].lastObjId+1;return e("create",{object:k(m({},Me()),{y:n.Base.screenHeight/2,width:n.Choices.ChoiceButtonWidth,height:0,panelId:t.panels.currentPanel,autoWrap:!1,id:r,onTop:!0,type:"notification",preserveRatio:!1,ratio:n.TextBox.TextBoxWidth/n.TextBox.TextBoxHeight,customColor:n.Choices.ChoiceButtonColor,text:"Click here to edit notification",backdrop:!0})}),r}},Df={setPoemProperty(e,t){const o=e.panels[t.panelId].objects[t.id];o[t.key]=t.value,++o.version}},Hf={createPoem({commit:e,rootState:t,state:o},s){const n=T(),r=o.panels[s.panelId].lastObjId+1;return e("create",{object:{subType:"poem",x:n.Poem.defaultX,y:n.Poem.defaultY,width:n.Poem.defaultPoemWidth,height:n.Poem.defaultPoemHeight,panelId:t.panels.currentPanel,flip:!1,rotation:0,id:r,onTop:!0,opacity:100,type:"poem",version:0,preserveRatio:!1,autoWrap:!0,ratio:n.Poem.defaultPoemWidth/n.Poem.defaultPoemHeight,background:n.Poem.defaultPoemBackground,font:n.Poem.defaultPoemStyle,text:`New poem

Click here to edit poem`,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!0,nameboxWidth:null,zoom:1}}),r},createConsole({commit:e,rootState:t,state:o},s){const n=T(),r=o.panels[s.panelId].lastObjId+1;return e("create",{object:k(m({},Me()),{subType:"console",x:n.Poem.consoleWidth/2,y:n.Poem.consoleHeight/2,width:n.Poem.consoleWidth,height:n.Poem.consoleHeight,panelId:t.panels.currentPanel,id:r,onTop:!0,type:"poem",preserveRatio:!1,ratio:n.Poem.consoleWidth/n.Poem.consoleHeight,background:n.Poem.defaultConsoleBackground,font:n.Poem.defaultConsoleStyle,text:`> _
  
  Console command
  Click here to edit`,autoWrap:!0})}),r}};let Af=0;const Rf=m(m(m(m(m(m({create(e,{object:t}){const o=e.panels[t.panelId];t.id>o.lastObjId&&(o.lastObjId=t.id),o.objects[t.id]=t,(t.onTop?o.onTopOrder:o.order).push(t.id)},removeFromList(e,t){const o=e.panels[t.panelId],s=t.onTop?o.onTopOrder:o.order,n=s.indexOf(t.id);s.splice(n,1)},addToList(e,t){const o=e.panels[t.panelId];o.objects[t.id],(t.onTop?o.onTopOrder:o.order).splice(t.position,0,t.id)},setOnTop(e,t){const s=e.panels[t.panelId].objects[t.id];s.onTop=t.onTop},setPosition(e,t){const s=e.panels[t.panelId].objects[t.id];s.x=t.x,s.y=t.y},setFlip(e,t){const s=e.panels[t.panelId].objects[t.id];s.flip=t.flip},setSize(e,t){const s=e.panels[t.panelId].objects[t.id];s.width=t.width,s.height=t.height},setRatio(e,t){const s=e.panels[t.panelId].objects[t.id];s.preserveRatio=t.preserveRatio,s.ratio=t.ratio},setRotation(e,t){const s=e.panels[t.panelId].objects[t.id];s.rotation=t.rotation<0?360-Math.abs(t.rotation)%360:t.rotation%360},removeObject(e,t){const o=e.panels[t.panelId];delete o.objects[t.id]},setComposition(e,t){const s=e.panels[t.panelId].objects[t.id];s.composite=t.composite},object_setFilters(e,t){const s=e.panels[t.panelId].objects[t.id];s.filters=t.filters},setLabel(e,t){const s=e.panels[t.panelId].objects[t.id];s.label=t.label},setTextboxColor(e,t){const s=e.panels[t.panelId].objects[t.id];s.textboxColor=t.textboxColor},setEnlargeWhenTalking(e,t){const s=e.panels[t.panelId].objects[t.id];s.enlargeWhenTalking=t.enlargeWhenTalking,++s.version},setObjectNameboxWidth(e,t){const s=e.panels[t.panelId].objects[t.id];s.nameboxWidth=t.nameboxWidth,++s.version},setObjectZoom(e,t){const s=e.panels[t.panelId].objects[t.id];s.zoom=t.zoom,++s.version}},jf),Ul),uh),If),Bf),Df),Mf=m(m(m(m(m(m({removeObject({state:e,commit:t,rootState:o},s){const n=e.panels[s.panelId],r=n.objects[s.id];o.ui.selection===s.id&&t("ui/setSelection",null,{root:!0});for(const i of[...n.onTopOrder,...n.order]){const l=n.objects[i];r.id===i||l.type!=="textBox"||l.talkingObjId===r.id&&t("setTalkingOther",{id:l.id,talkingOther:r.label||"",panelId:s.panelId})}t("removeFromList",{id:s.id,panelId:s.panelId,onTop:r.onTop}),t("removeObject",{id:s.id,panelId:s.panelId})},setPosition({state:e,commit:t,dispatch:o},s){e.panels[s.panelId].objects[s.id].type==="character"?o("setCharacterPosition",s):t("setPosition",s)},setOnTop({state:e,commit:t},o){const s=e.panels[o.panelId],n=s.objects[o.id];n.onTop!==o.onTop&&(t("removeFromList",{panelId:o.panelId,id:o.id,onTop:n.onTop}),t("addToList",{id:o.id,panelId:o.panelId,position:(o.onTop?s.onTopOrder:s.order).length,onTop:o.onTop}),t("setOnTop",{panelId:o.panelId,id:o.id,onTop:o.onTop}))},shiftLayer({state:e,commit:t},o){const s=e.panels[o.panelId],n=s.objects[o.id],r=n.onTop?s.onTopOrder:s.order;let l=r.indexOf(n.id)+o.delta;l<0&&(l=0),l>r.length&&(l=r.length),t("removeFromList",{panelId:o.panelId,id:o.id,onTop:n.onTop}),t("addToList",{panelId:o.panelId,id:o.id,position:l,onTop:n.onTop})},setPreserveRatio({commit:e,state:t},o){const n=t.panels[o.panelId].objects[o.id],r=o.preserveRatio?n.width/n.height:0;e("setRatio",{panelId:o.panelId,id:o.id,preserveRatio:o.preserveRatio,ratio:r})},setWidth({commit:e,state:t},o){const n=t.panels[o.panelId].objects[o.id],r=n.preserveRatio?o.width/n.ratio:n.height;e("setSize",{panelId:o.panelId,id:o.id,height:r,width:o.width})},setHeight({commit:e,state:t},o){const n=t.panels[o.panelId].objects[o.id],r=n.preserveRatio?o.height*n.ratio:n.width;e("setSize",{panelId:o.panelId,id:o.id,height:o.height,width:r})},copyObjects({commit:e,state:t},{sourcePanelId:o,targetPanelId:s}){const n=t.panels[o];if(!n)return;t.panels[o];const r=t.panels[s],i=[...n.onTopOrder,...n.order],l=new Map;let d=r.lastObjId;for(const c of i){const u=++d;l.set(c,u)}for(const c of i){const u=t.panels[o].objects[c],h=JSON.parse(JSON.stringify(u));if("talkingObjId"in h){const f=h;f.talkingObjId!==null&&f.talkingObjId!=="$other$"&&l.has(f.talkingObjId)&&(f.talkingObjId=l.get(f.talkingObjId))}e("create",{object:k(m({},h),{id:l.get(c),panelId:s})})}},copyObjectToClipboard({commit:e,state:t},{id:o,panelId:s}){const n=t.panels[s].objects[o];e("ui/setClipboard",JSON.stringify(n),{root:!0})},pasteObjectFromClipboard({commit:e,rootState:t}){if(!t.ui.clipboard)return;const o=JSON.parse(t.ui.clipboard);e("create",{object:k(m({},o),{id:`copy_${++Af}`,panelId:t.panels.currentPanel})})},object_addFilter({state:e,commit:t},o){Mo(o,()=>e.panels[o.panelId].objects[o.id],s=>t("object_setFilters",s))},object_removeFilter({state:e,commit:t},o){Fo(o,()=>e.panels[o.panelId].objects[o.id],s=>t("object_setFilters",s))},object_moveFilter({state:e,commit:t},o){No(o,()=>e.panels[o.panelId].objects[o.id],s=>t("object_setFilters",s))},object_setFilter({state:e,commit:t},o){Vo(o,()=>e.panels[o.panelId].objects[o.id],s=>t("object_setFilters",s))}},Tf),Xl),hh),_f),Of),Hf);function Ff(e,t){const o=e.state.panels;for(const s in o){const n=o[s];for(const r in n.objects){const i=n.objects[r];if(i.type==="character"){Gl(e,i.panelId,i.id,t);return}}}}var ut;(function(e){e[e.None=0]="None",e[e.Stretch=1]="Stretch",e[e.Cover=2]="Cover"})(ut||(ut={}));const Nf="buildin.transparent",Ft={panelToUrl:new Map,urlToPanel:new Map,register(e,t){if(this.panelToUrl.has(e)){if(this.panelToUrl.get(e)===t)return;this.unregister(e,this.panelToUrl.get(e))}this.panelToUrl.set(e,t),this.urlToPanel.has(t)?this.urlToPanel.get(t).push(e):this.urlToPanel.set(t,[e])},unregister(e,t){if(this.urlToPanel.has(t)){const o=this.urlToPanel.get(t);o.splice(o.indexOf(e),1),o.length===0&&(this.urlToPanel.delete(t),URL.revokeObjectURL(t))}this.panelToUrl.delete(e)}};var Vf={namespaced:!0,state:{lastPanelId:-1,panels:{},panelOrder:[],currentPanel:null},mutations:m({setCurrentPanel(e,{panelId:t}){e.currentPanel=t},setPanelPreview(e,{panelId:t,url:o}){e.panels[t].lastRender=o,Ft.register(t,o)},createPanel(e,{panel:t}){e.lastPanelId=t.id,e.panels[t.id]=t},setPanelOrder(e,{panelOrder:t}){e.panelOrder=[...t]},setCurrentBackground(e,{current:t,panelId:o}){const s=e.panels[o];s.background.current=t,s.background.variant=0},setBackgroundColor(e,{color:t,panelId:o}){const s=e.panels[o];s.background.color=t},setBackgroundFlipped(e,{flipped:t,panelId:o}){const s=e.panels[o];s.background.flipped=t},setBackgroundVariant(e,{variant:t,panelId:o}){const s=e.panels[o];s.background.variant=t},setBackgroundScaling(e,{scaling:t,panelId:o}){const s=e.panels[o];s.background.scaling=t},deletePanel(e,{panelId:t}){Ft.unregister(t,Ft.panelToUrl.get(t)),delete e.panels[t]},setComposition(e,t){const o=e.panels[t.panelId];o.composite=t.composite},setFilters(e,t){const o=e.panels[t.panelId];o.filters=t.filters},backgroundSetComposition(e,t){const o=e.panels[t.panelId];o.background.composite=t.composite},backgroundSetFilters(e,t){const o=e.panels[t.panelId];o.background.filters=t.filters}},Rf),actions:m({createPanel({state:e,commit:t}){const o=e.lastPanelId+1;return t("createPanel",{panel:{id:o,background:{color:"#000000",current:Nf,flipped:!1,scaling:2,variant:0,composite:"source-over",filters:[]},lastRender:"",composite:"source-over",filters:[],objects:{},onTopOrder:[],order:[],lastObjId:-1}}),e.panelOrder?t("setPanelOrder",{panelOrder:[...e.panelOrder,o]}):t("setPanelOrder",{panelOrder:[o]}),t("setCurrentPanel",{panelId:o}),o},duplicatePanel({state:e,commit:t},{panelId:o}){const s=e.panels[o],n=e.lastPanelId+1;Ft.register(n,s.lastRender);const r=JSON.parse(JSON.stringify(s));let i=-1;const l=new Map,d={};for(const u in r.objects)l.set(+u,++i);for(const u in r.objects){const h=r.objects[u];if(d[l.get(+u)]=h,h.panelId=n,"talkingObjId"in h){const f=h;f.talkingObjId!==null&&f.talkingObjId!=="$other$"&&l.has(f.talkingObjId)&&(f.talkingObjId=l.get(f.talkingObjId))}}t("createPanel",{panel:k(m({},r),{id:n,lastObjId:i,objects:d})});const c=e.panelOrder.indexOf(o);t("setPanelOrder",{panelOrder:[...e.panelOrder.slice(0,c+1),n,...e.panelOrder.slice(c+1)]}),t("setCurrentPanel",{panelId:n})},seekBackgroundVariant({state:e,rootGetters:t,commit:o},{delta:s}){const n=e.panels[e.currentPanel],i=t["content/getBackgrounds"].get(n.background.current);!i||o("setBackgroundVariant",{panelId:e.currentPanel,variant:Je(i.variants,n.background.variant,s)})},delete({state:e,dispatch:t,commit:o},{panelId:s}){if(e.panelOrder.length<=1)return;const n=e.panelOrder.indexOf(s);let r;n===e.panelOrder.length-1?r=n-1:r=n+1,o("setCurrentPanel",{panelId:e.panelOrder[r]}),o("setPanelOrder",{panelOrder:[...e.panelOrder.slice(0,n),...e.panelOrder.slice(n+1)]}),o("deletePanel",{panelId:s})},async fixContentPackRemoval(e,t){const{state:o,rootGetters:s,commit:n,rootState:r}=e;for(const i of Object.values(o.panels)){const l=t.backgrounds.find(h=>h.id===i.background.current);if(!l)return;const d=s["content/getBackgrounds"].get(i.background.current);if(!d){r.content.current.backgrounds[0]?n("setCurrentBackground",{current:r.content.current.backgrounds[0].id,panelId:i.id}):n("setCurrentBackground",{current:"buildin.transparent",panelId:i.id});return}const c=JSON.stringify(l.variants[i.background.variant]),u=d.variants.findIndex(h=>JSON.stringify(h)===c);u!==i.background.variant&&n("setBackgroundVariant",{variant:u===-1?0:u,panelId:i.id})}await Ff(e,t)},move({state:e,commit:t},{panelId:o,delta:s}){const n=[...e.panelOrder],r=n.indexOf(o);n.splice(r,1);const i=Math.max(r+s,0);n.splice(i,0,o),t("setPanelOrder",{panelOrder:n})},addFilter({state:e,commit:t},o){Mo(o,()=>e.panels[o.panelId],s=>t("setFilters",s))},removeFilter({state:e,commit:t},o){Fo(o,()=>e.panels[o.panelId],s=>t("setFilters",s))},moveFilter({state:e,commit:t},o){No(o,()=>e.panels[o.panelId],s=>t("setFilters",s))},setFilter({state:e,commit:t},o){Vo(o,()=>e.panels[o.panelId],s=>t("setFilters",s))},backgroundAddFilter({state:e,commit:t},o){Mo(o,()=>e.panels[o.panelId].background,s=>t("backgroundSetFilters",s))},backgroundRemoveFilter({state:e,commit:t},o){Fo(o,()=>e.panels[o.panelId].background,s=>t("backgroundSetFilters",s))},backgroundMoveFilter({state:e,commit:t},o){No(o,()=>e.panels[o.panelId].background,s=>t("backgroundSetFilters",s))},backgroundSetFilter({state:e,commit:t},o){Vo(o,()=>e.panels[o.panelId].background,s=>t("backgroundSetFilters",s))}},Mf)};class Wf{constructor(t,o,s,n,r,i){this.id=t,this.assets=o,this.flip=s,this.scale=n,this.compositeMode=r,this.filters=i}async render(t){const{screenWidth:o,screenHeight:s}=T().Base,n=await Promise.all(this.assets.map(r=>Oe(r,t.hq)));for(const r of n){let i=0,l=0,d=r.width,c=r.height;switch(this.scale){case ut.None:i=o/2-d/2,l=s/2-c/2;break;case ut.Stretch:d=o,c=s;break;case ut.Cover:const u=d/c,h=o/s;u>h?(c=s,d=c*u):(d=o,c=d/u),i=o/2-d/2,l=s/2-c/2}t.drawImage({image:r,x:i,y:l,w:d,h:c,flip:this.flip,composite:this.compositeMode,filters:this.filters})}}}const yn={id:"buildin.static-color",name:"Static color",color:"#000000",async render(e){const{screenWidth:t,screenHeight:o}=T().Base;e.drawRect({x:0,y:0,w:t,h:o,fill:{style:this.color}})}};class vn extends ln{constructor(){super(...arguments);g(this,"refTextbox",null)}get canvasDrawWidth(){return this.width*this.objZoom}get canvasDrawHeight(){return this.height*this.objZoom}get canvasDrawPosX(){return this.x-this.width/2+(this.height-this.canvasDrawHeight)/2}get canvasDrawPosY(){return this.y+(this.height-this.canvasDrawHeight)}get objZoom(){return(this.obj.enlargeWhenTalking&&this.refTextbox?1.05:1)*this.obj.zoom}getHitbox(){const t=super.getHitbox(),o=this.width*(this.objZoom-1),s=this.height*(this.objZoom-1);return{x0:t.x0-o/2,x1:t.x1+o/2,y0:t.y0-s,y1:t.y1}}updatedContent(t,o){const s=t.state.panels.panels[o],n=[...s.order,...s.onTopOrder];this.refTextbox=null;for(const r of n){const i=t.state.panels.panels[o].objects[r];if(i.type==="textBox"&&i.talkingObjId===this.obj.id){this.refTextbox=i;return}}}async renderLocal(t){const o=this.getAssetList(),s=await Promise.all(o.filter(n=>n.assets).map(n=>Ef(n,t.hq)));for(const n of s)for(const r of n.assets)t.drawImage({image:r,composite:n.composite,x:n.offset[0],y:n.offset[1]})}}async function Ef(e,t){return"loaded"in e?e:{loaded:!0,offset:e.offset,assets:await Promise.all(e.assets.map(o=>Oe(o,t))),composite:e.composite}}class Lf extends vn{constructor(t){super(t);g(this,"assets");g(this,"ready",null);g(this,"canvasHeight",0);g(this,"canvasWidth",0);this.init()}get version(){return this.assets===null?-1:this.obj.version}async init(){let t;this.ready=new Promise((r,i)=>{t=r});const o=await Promise.all(this.obj.assets.map(r=>Oe(r)));let s=0,n=0;for(const r of o)r.height>n&&(n=r.height),r.width>s&&(s=r.width);this.canvasWidth=s,this.canvasHeight=n,this.assets=[{loaded:!0,assets:o,offset:[0,0]}],t()}getAssetList(){return this.assets||[]}}class Uf extends vn{constructor(t,o){super(t);g(this,"scaleable",!0);this.data=o}updatedContent(t,o){super.updatedContent(t,o),this.data=St(t,this.obj)}getAssetList(){const t=$e(this.data,this.obj),o=To(this.data,this.obj),s=[];for(const n of t.renderCommands)switch(n.type){case"head":s.push({offset:n.offset,composite:n.composite,assets:o?o.variants[this.obj.posePositions.head||0]:[]});break;case"image":s.push({offset:n.offset,composite:n.composite,assets:n.images});break;case"pose-part":const r=t.positions[n.part];if(!r||r.length===0)break;const i=r[this.obj.posePositions[n.part]||0];if(!i)break;s.push({offset:n.offset,composite:n.composite,assets:i});break}return s}get canvasHeight(){return $e(this.data,this.obj).size[1]}get canvasWidth(){return $e(this.data,this.obj).size[0]}get closeZoom(){let t=1;return this.obj.close&&(t*=2),t}get width(){return this.obj.width*this.closeZoom}get height(){return this.obj.height*this.closeZoom}}class zf extends Bt{constructor(){super(...arguments);g(this,"_height",0);g(this,"choiceRenderers",[])}get height(){return this._height}get centeredVertically(){return!0}async draw(t){await this.updateChoiceBounds();const o=T(),s=this.obj.width,n=this.height,r=s/2,l=(this.flip?o.Base.screenWidth-this.obj.x:this.obj.x)-r;let d=this.obj.y-n/2;for(const c of this.choiceRenderers){await c.loadFonts();const u=c.getHeight(this.obj.autoWrap?this.obj.width:0);t.drawRect({x:l,y:d,w:s,h:u+o.Choices.ChoicePadding*2,outline:{style:o.Choices.ChoiceButtonBorderColor,width:o.Choices.Outline},fill:{style:o.Choices.ChoiceButtonColor}}),c.fixAlignment("center",l,l+s,d+o.Choices.ChoiceSpacing*1.25,this.obj.autoWrap?s:0),c.render(t.fsCtx),d+=u+o.Choices.ChoicePadding*2+o.Choices.ChoiceSpacing}}async updateChoiceBounds(){const t=T();this.choiceRenderers=this.obj.choices.map(o=>new ge(o.text||" ",t.Choices.ChoiceTextStyle)),this._height=this.choiceRenderers.reduce((o,s)=>o+s.getHeight(this.obj.autoWrap?this.obj.width:0)+t.Choices.ChoicePadding*2,0)+this.obj.choiceDistance*(this.obj.choices.length-1)}}class Xf extends Bt{constructor(){super(...arguments);g(this,"_height",0);g(this,"_width",0)}get height(){return this._height}get width(){return this._width}get centeredVertically(){return!0}get id(){return this.obj.id}async render(t,o){const s=T();this.obj.backdrop&&o.drawRect({x:0,y:0,w:s.Base.screenWidth,h:s.Base.screenHeight,fill:{style:T().Notification.NotificationBackdropColor}}),await super.render(t,o)}async draw(t){const o=T(),s=new ge(this.obj.text,o.Notification.NotificationTextStyle),n=new ge("OK",o.Notification.NotificationOkTextStyle);await s.loadFonts(),await n.loadFonts();const r=this.obj.autoWrap?this.obj.width-o.Notification.NotificationPadding*2:0,i=this.obj.autoWrap?r:s.getWidth(),l=s.getHeight(r),d=this.obj.autoWrap?r:n.getWidth(),c=n.getHeight(r),u=this._width=Math.max(i,d)+o.Notification.NotificationPadding*2,h=this._height=l+o.Notification.NotificationPadding*2+o.Notification.NotificationSpacing+c,f=u/2,j=(this.flip?o.Base.screenWidth-this.obj.x:this.obj.x)-f,$=this.obj.y-h/2;t.drawRect({x:j,y:$,w:u,h,outline:{style:o.Choices.ChoiceButtonBorderColor,width:3},fill:{style:o.Choices.ChoiceButtonColor}}),s.fixAlignment("center",j,j+u,$+o.Notification.NotificationPadding*1.5,r),s.render(t.fsCtx),n.fixAlignment("center",j,j+u,$+h-o.Notification.NotificationPadding,r),n.render(t.fsCtx)}}const Gf=-2,Yf=26,qf=10,Kf=10;class Jf extends Bt{constructor(){super(...arguments);g(this,"_height",0);g(this,"_width",0)}get height(){return this._height}get width(){return this._width}get centeredVertically(){return!0}async draw(t){const o=T(),s=o.Poem.poemBackgrounds[this.obj.background],n=this.flip?o.Base.screenWidth-this.obj.x:this.obj.x;let r=this.obj.y,i=n+Kf,l=o.Poem.poemPadding,d=o.Poem.poemTopPadding,c=l*2;if(s.file==="internal:console"){const f=this._height=this.obj.height,P=this._width=this.obj.width;t.drawRect({x:n-P/2,y:this.obj.y-f/2,h:f,w:P,fill:{style:o.Poem.consoleBackgroundColor}}),l=Gf,d=Yf,c=qf}else if(s.file==="internal:transparent")this._height=this.obj.height,this._width=this.obj.width;else{const f=await Jt(`assets/poemBackgrounds/${s.file}`);t.drawImage({image:f,x:n-f.width/2,y:this.obj.y-f.height/2}),this._height=f.height,this._width=f.width}r-=this.height/2,i-=this.width/2;const u=o.Poem.poemTextStyles[this.obj.font],h=new ge(this.obj.text,u);await h.loadFonts(),h.fixAlignment("left",i+l,i+l,r+d+l,this.obj.autoWrap?this.width-c:0),h.render(t.fsCtx)}}const Ko=class{constructor(t,o,s,n){g(this,"renderObjectCache",new Map);g(this,"lCurrentlyRendering",!1);g(this,"renderer");this.store=t,this.panelId=o,this.canvasWidth=s,this.canvasHeight=n,this.renderer=new nt(s,n)}render(t,o){return this.panel?this.renderer.render(this.renderCallback.bind(this),t,o):Promise.resolve(!1)}download(){const t=new Date,o=`panel-${[t.getFullYear(),`${t.getMonth()+1}`.padStart(2,"0"),`${t.getDate()}`.padStart(2,"0"),`${t.getHours()}`.padStart(2,"0"),`${t.getMinutes()}`.padStart(2,"0"),`${t.getSeconds()}`.padStart(2,"0")].join("-")}.png`;return this.renderer.download(this.renderCallback.bind(this),o)}get currentlyRendering(){return this.lCurrentlyRendering}paintOnto(t,o){this.renderer.paintOnto(t,o)}objectsAt(t,o){return this.getRenderObjects().filter(s=>s.hitTest(t,o)).map(s=>s.id)}async renderCallback(t){var o;this.lCurrentlyRendering=!0;try{t.fsCtx.imageSmoothingEnabled=!0,t.fsCtx.imageSmoothingQuality=t.hq?"high":"low",await((o=this.getBackgroundRenderer())==null?void 0:o.render(t));const s=this.store.state.ui.selection;for(const n of this.getRenderObjects()){n.updatedContent(this.store,this.panelId);const r=s===n.id,i=document.querySelector(Ko.FocusProp),l=(i==null?void 0:i.getAttribute("data-obj-id"))===""+n.id;await n.render((r?Ee.Selected:Ee.None)+(l?Ee.Focused:Ee.None),t)}t.applyFilters([...this.panel.filters]),t.preview&&t.drawImage({x:0,y:0,h:this.canvasHeight,w:this.canvasWidth,composite:"destination-over",image:await ce("backgrounds/transparent")})}finally{this.lCurrentlyRendering=!1}}getRenderObjects(){const t=this.store.state.panels.panels[this.panelId],o=t?[...t.order,...t.onTopOrder]:[],s=t.objects,n=Array.from(this.renderObjectCache.keys()).filter(r=>!o.includes(r));for(const r of n)this.renderObjectCache.delete(r);return o.map(r=>{let i=this.renderObjectCache.get(r);if(!i){const l=s[r],d=l.type;switch(d){case"sprite":i=new Lf(l);break;case"character":const c=l;i=new Uf(c,St(this.store,c));break;case"textBox":i=new kd(l);break;case"choice":i=new zf(l);break;case"notification":i=new Xf(l);break;case"poem":i=new Jf(l);break;default:throw new de.UnreachableCaseError(d)}this.renderObjectCache.set(r,i)}return i})}get panel(){return this.store.state.panels.panels[this.panelId]}getBackgroundRenderer(){const t=this.panel;switch(t.background.current){case"buildin.static-color":return yn.color=t.background.color,yn;default:const s=this.store.getters["content/getBackgrounds"].get(t.background.current);if(!s)return null;const n=s.variants[t.background.variant];return n?new Wf(t.background.current,n,t.background.flipped,t.background.scaling,t.background.composite,t.background.filters):null}}};let ht=Ko;g(ht,"FocusProp",typeof CSS!="undefined"&&CSS.supports("selector(:focus-visible)")?":focus-visible":":focus");const Zf=1.5,wn=1/4,Qf=.5,Lo=100,Cn=90,$n=70,eg=D({mixins:[ee],components:{DFieldset:re,DFlow:tt,DButton:mt,ImageOptions:Wo},data:()=>({webpSupport:!1,heifSupport:!1,ppi:0,pages:"",format:"image/png",quality:Cn,imageOptions:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},isLossy(){return this.format!=="image/png"},canDeletePanel(){return this.panelButtons.length>1},panelButtons(){return this.$store.state.panels.panelOrder.map(t=>{const o=this.$store.state.panels.panels[t],s=this.$store.state.panels.panels[t],n=s?[].concat(s.order,s.onTopOrder).map(r=>this.$store.state.panels.panels[t].objects[r]).map(this.extractObjectText):[];return{id:t,image:o.lastRender,text:n.reduce((r,i)=>r.length>i.length?r:i,"")}})},canMoveAhead(){return this.$store.state.panels.panelOrder.indexOf(this.currentPanel.id)>0},canMoveBehind(){const e=this.$store.state.panels.panelOrder;return e.indexOf(this.currentPanel.id)<e.length-1}},async created(){[this.webpSupport,this.heifSupport]=await Promise.all([Be(),ei()])},async mounted(){this.moveFocusToActivePanel(),this.renderThumbnail().catch(()=>{})},methods:{async download(){const e=this.getPanelDistibution(),t=new Date,o=`cd-${[t.getFullYear(),`${t.getMonth()+1}`.padStart(2,"0"),`${t.getDate()}`.padStart(2,"0"),`${t.getHours()}`.padStart(2,"0"),`${t.getMinutes()}`.padStart(2,"0"),`${t.getSeconds()}`.padStart(2,"0")].join("-")}`,s=this.format.split("/")[1],n=this.format,r=this.quality;await this.renderObjects(e,!0,async(i,l)=>{await B.saveToFile(l,`${o}_${i}.${s}`,n,r/Lo)})},async estimateExportSize(){const e=this.getPanelDistibution(),t=this.format||"image/png",o=this.quality||Cn,n=(await this.renderObjects(e,!1,async(d,c)=>new Promise((u,h)=>{c.toBlob(f=>{if(!f){h(`Image ${d+1} could not be rendered.`);return}u(f.size)},t,o/Lo)}))).map(d=>(d*Zf/1024/1024).toFixed(2)+"MiB"),r=n.length>1?"files":"file",i=n.length>1?"These":"It",l=n.length>1?"sizes":"size";E.fire(new se(`This would export ${n.length} ${r}. ${i} would have the following (aproximate) ${l}: ${n.join(",")}`))},async renderObjects(e,t,o){const s=T().Base;return await Promise.all(e.map(async(n,r)=>{const i=document.createElement("canvas");i.width=s.screenWidth,i.height=s.screenHeight*n.length;const l=i.getContext("2d");return await Promise.all(n.map(async(d,c)=>{const u=new ht(this.$store,n[c],s.screenWidth,s.screenHeight);await u.render(t,!1),u.paintOnto(l,{x:0,y:s.screenHeight*c,w:s.screenWidth,h:s.screenHeight})})),await o(r,i)}))},getLimitedPanelList(){const e=this.$store.state.panels.panelOrder.length-1,t=0,o=this.pages.split(","),s=[];let n=!1;for(const r of o){const i=r.trim(),l=i.match(/^\s*((\d+)|(\d+)\s*-\s*(\d+))\s*$/);if(!l){i!==""&&E.fire(new se(`Could not read '${r}' in the page list.`));continue}if(n=!0,l[2])s.push(parseInt(l[2],10)-1);else{const d=Math.max(parseInt(l[3],10)-1,t),c=Math.min(parseInt(l[4],10)-1,e);if(d==null||c==null||d>c)continue;for(let u=d;u<=c;++u)s.push(u)}}return n?s.sort((r,i)=>r-i).filter((r,i,l)=>l[i-1]!==r).map(r=>this.$store.state.panels.panelOrder[r]):this.$store.state.panels.panelOrder},getPanelDistibution(){const e=this.getLimitedPanelList();if(isNaN(parseInt(this.ppi))&&(this.ppi=0),this.ppi===0)return[e];const t=[];for(let o=0;o<e.length/this.ppi;++o){const s=o*this.ppi,n=s+this.ppi;t.push([...e.slice(s,n)])}return t},moveFocusToActivePanel(){const e=this.$el.querySelector(".panel_button.active");e&&this.scrollIntoView(e)},scrollIntoView(e){const t=e.parentElement.parentElement;Array.from(e.parentElement.children).indexOf(e),this.$store.state.ui.vertical?(t.scrollTop=e.offsetTop-t.clientHeight/2,t.scrollLeft=0):(t.scrollLeft=e.offsetLeft-t.clientWidth/2,t.scrollTop=0)},extractObjectText(e){switch(e.type){case"textBox":return e.text;case"notification":return e.text;case"poem":return e.text;case"choice":return e.choices.map(t=>`[${t.text}]`).join(`
`)}return""},async addNewPanel(){await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/duplicatePanel",{panelId:this.$store.state.panels.currentPanel})}),this.$nextTick(()=>{this.moveFocusToActivePanel()})},updateCurrentPanel(e){this.vuexHistory.transaction(async()=>{this.$store.commit("panels/setCurrentPanel",{panelId:e})}),this.$nextTick(()=>{this.moveFocusToActivePanel()})},deletePanel(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/delete",{panelId:this.$store.state.panels.currentPanel})}),this.$nextTick(()=>{this.moveFocusToActivePanel()})},moveAhead(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/move",{panelId:this.currentPanel.id,delta:-1})})},moveBehind(){this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/move",{panelId:this.currentPanel.id,delta:1})})},async renderThumbnail(){await cs("render thumbnail",async()=>{const e=T().Base,t=new ht(this.$store,this.currentPanel.id,e.screenWidth,e.screenHeight);await t.render(!1,!0);const o=document.createElement("canvas");o.width=e.screenWidth*wn,o.height=e.screenHeight*wn,t.paintOnto(o.getContext("2d"),{x:0,y:0,w:o.width,h:o.height}),o.toBlob(s=>{if(!s)return;const n=URL.createObjectURL(s);this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPanelPreview",{panelId:this.$store.state.panels.currentPanel,url:n})})},await Be()?"image/webp":"image/jpeg",Qf)})}},watch:{quality(e,t){if(e===Lo){E.fire(new se("Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression."));return}if(t>$n&&e<=$n){E.fire(new se("Note: A quality level below 70% might be very noticable and impair legibility of text."));return}}}}),je=e=>(G("data-v-784b73ff"),e=e(),Y(),e),tg={class:"panel"},og=je(()=>a("h1",null,"Panels",-1)),sg=["onClick","onKeydown"],ng={class:"panel_text"},ig={class:"panel_nr"},rg={class:"column"},ag=v(" Add new"),lg=v(" Delete panel "),dg=v(" Move ahead "),cg=v(" Move behind "),ug=v(" Image options "),hg=je(()=>a("td",null,[a("label",{for:"export_format"},"Format")],-1)),pg=je(()=>a("option",{value:"image/png"},"PNG (lossless)",-1)),fg={key:0,value:"image/webp"},gg={key:1,value:"image/heif"},bg=je(()=>a("option",{value:"image/jpeg"},"JPEG (lossy)",-1)),mg={key:0},yg=je(()=>a("td",null,[a("label",{for:"export_quality"},"Quality:")],-1)),vg=je(()=>a("td",null,[a("label",{for:"export_ppi"},[v(" Panels per image: "),a("br"),a("small",null,"(0 for one single image)")])],-1)),wg=je(()=>a("td",null,[a("label",{for:"export_pages"},[v(" Panels to export: "),a("br"),a("small",null,"(Leave empty for all)")])],-1)),Cg=v(" Download ");function $g(e,t,o,s,n,r){const i=C("image-options"),l=C("d-flow"),d=C("d-fieldset"),c=C("d-button");return p(),b("div",tg,[og,e.imageOptions?(p(),x(i,{key:0,type:"panel",title:"","panel-id":e.currentPanel.id,"no-composition":"",onLeave:t[0]||(t[0]=u=>{e.imageOptions=!1,e.renderThumbnail()})},null,8,["panel-id"])):(p(),b(_,{key:1},[y(d,{class:"existing_panels_fieldset",title:"Existing Panels"},{default:w(()=>[y(l,{"no-wraping":"",maxSize:"350px"},{default:w(()=>[(p(!0),b(_,null,L(e.panelButtons,(u,h)=>(p(),b("div",{key:u.id,class:F({panel_button:!0,active:u.id===e.currentPanel.id}),style:K(`background-image: url('${u.image}')`),tabindex:"0",onClick:f=>e.updateCurrentPanel(u.id),onKeydown:[Q(f=>e.updateCurrentPanel(u.id),["enter"]),Q(I(f=>e.updateCurrentPanel(u.id),["prevent"]),["space"])]},[a("div",ng,[a("p",null,V(u.text),1)]),a("div",ig,V(h+1),1)],46,sg))),128))]),_:1})]),_:1}),a("div",rg,[y(c,{icon:"add_to_queue",onClick:e.addNewPanel},{default:w(()=>[ag]),_:1},8,["onClick"]),y(c,{icon:"remove_from_queue",onClick:e.deletePanel,disabled:!e.canDeletePanel},{default:w(()=>[lg]),_:1},8,["onClick","disabled"]),y(c,{icon:"arrow_upward",onClick:e.moveAhead,disabled:!e.canMoveAhead},{default:w(()=>[dg]),_:1},8,["onClick","disabled"]),y(c,{icon:"arrow_downward",onClick:e.moveBehind,disabled:!e.canMoveBehind},{default:w(()=>[cg]),_:1},8,["onClick","disabled"]),y(c,{icon:"color_lens",onClick:t[1]||(t[1]=u=>e.imageOptions=!0)},{default:w(()=>[ug]),_:1})]),y(d,{title:"Export"},{default:w(()=>[a("table",null,[a("tr",null,[hg,a("td",null,[R(a("select",{id:"export_format","onUpdate:modelValue":t[2]||(t[2]=u=>e.format=u)},[pg,e.webpSupport?(p(),b("option",fg," WebP (lossy) ")):S("",!0),e.heifSupport?(p(),b("option",gg," HEIF (lossy) ")):S("",!0),bg],512),[[oe,e.format]])])]),e.isLossy?(p(),b("tr",mg,[yg,a("td",null,[R(a("input",{id:"export_quality",type:"number",min:"0",max:"100","onUpdate:modelValue":t[3]||(t[3]=u=>e.quality=u),onKeydown:t[4]||(t[4]=I(()=>{},["stop"]))},null,544),[[z,e.quality,void 0,{number:!0}]])])])):S("",!0),a("tr",null,[vg,a("td",null,[R(a("input",{id:"export_ppi",type:"number",min:"0","onUpdate:modelValue":t[5]||(t[5]=u=>e.ppi=u),onKeydown:t[6]||(t[6]=I(()=>{},["stop"])),onBlur:t[7]||(t[7]=u=>{e.ppi===""&&(e.ppi=0)})},null,544),[[z,e.ppi,void 0,{number:!0}]])])]),a("tr",null,[wg,a("td",null,[R(a("input",{id:"export_pages","onUpdate:modelValue":t[8]||(t[8]=u=>e.pages=u),placeholder:"E.g. 1-5, 8, 11-13"},null,512),[[z,e.pages]])])]),a("tr",null,[a("td",null,[y(c,{icon:"photo_camera",onClick:e.download},{default:w(()=>[Cg]),_:1},8,["onClick"])]),a("td",null,[a("button",{onClick:t[9]||(t[9]=(...u)=>e.estimateExportSize&&e.estimateExportSize(...u))},"Estimate filesizes")])])])]),_:1})],64))])}var kg=H(eg,[["render",$g],["__scopeId","data-v-784b73ff"]]);const Uo=Io("panels/setNotificationProperty"),xg=D({mixins:[ee],components:{Toggle:ne,ObjectTool:Xe},data:()=>({textEditor:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="notification")return e},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.text,set:e=>{this.text=e},leave:()=>{this.textEditor=!1}}},text:Uo("text"),autoWrap:Uo("autoWrap"),renderBackdrop:Uo("backdrop")}}),Sg=e=>(G("data-v-4067cb39"),e=e(),Y(),e),Pg={id:"notification_text_wrapper"},jg=Sg(()=>a("label",{for:"notification_text"},"Text:",-1));function Tg(e,t,o,s,n,r){const i=C("toggle"),l=C("object-tool");return p(),x(l,{object:e.object,title:"Notification",textHandler:e.textHandler},{default:w(()=>[a("div",Pg,[jg,R(a("textarea",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.text=d),id:"notification_text",onKeydown:t[1]||(t[1]=I(()=>{},["stop"]))},null,544),[[z,e.text]]),a("button",{onClick:t[2]||(t[2]=d=>e.textEditor=!0)},"Formatting")])]),options:w(()=>[y(i,{modelValue:e.renderBackdrop,"onUpdate:modelValue":t[3]||(t[3]=d=>e.renderBackdrop=d),label:"Show backdrop?"},null,8,["modelValue"])]),_:1},8,["object","textHandler"])}var Ig=H(xg,[["render",Tg],["__scopeId","data-v-4067cb39"]]);const Nt=Io("panels/setPoemProperty"),_g=D({mixins:[ee],components:{Toggle:ne,ObjectTool:Xe},data:()=>({textEditor:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},backgrounds(){return Ps},poemTextStyles(){return js},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="poem")return e},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.text,set:e=>{this.text=e},leave:()=>{this.textEditor=!1}}},text:Nt("text"),autoWrap:Nt("autoWrap"),poemStyle:Nt("font"),poemBackground:Nt("background")}}),Bg=e=>(G("data-v-0046c4ab"),e=e(),Y(),e),Og={id:"poem_text"},Dg=Bg(()=>a("label",{for:"poem_text"},"Text:",-1)),Hg=["value"],Ag=["value"];function Rg(e,t,o,s,n,r){const i=C("toggle"),l=C("object-tool");return p(),x(l,{object:e.object,title:e.object.subType==="poem"?"Poem":"Console",textHandler:e.textHandler},{default:w(()=>[a("div",Og,[Dg,R(a("textarea",{"onUpdate:modelValue":t[0]||(t[0]=d=>e.text=d),onKeydown:t[1]||(t[1]=I(()=>{},["stop"]))},null,544),[[z,e.text]]),a("button",{onClick:t[2]||(t[2]=d=>e.textEditor=!0)},"Formatting")]),y(i,{label:"Auto line wrap?",modelValue:e.autoWrap,"onUpdate:modelValue":t[3]||(t[3]=d=>e.autoWrap=d)},null,8,["modelValue"]),e.object.subType==="poem"?(p(),b(_,{key:0},[R(a("select",{"onUpdate:modelValue":t[4]||(t[4]=d=>e.poemBackground=d),onKeydown:t[5]||(t[5]=I(()=>{},["stop"]))},[(p(!0),b(_,null,L(e.backgrounds,(d,c)=>(p(),b("option",{value:c,key:c},V(d.name),9,Hg))),128))],544),[[oe,e.poemBackground]]),R(a("select",{"onUpdate:modelValue":t[6]||(t[6]=d=>e.poemStyle=d),onKeydown:t[7]||(t[7]=I(()=>{},["stop"]))},[(p(!0),b(_,null,L(e.poemTextStyles,(d,c)=>(p(),b("option",{value:c,key:c},V(d.name),9,Ag))),128))],544),[[oe,e.poemStyle]])],64)):S("",!0)]),_:1},8,["object","title","textHandler"])}var Mg=H(_g,[["render",Rg],["__scopeId","data-v-0046c4ab"]]);const Fg={a:"add",s:"backgrounds",d:"panels",f:"settings"},Ng=D({components:{SettingsPanel:Gi,AddPanel:vr,BackgroundsPanel:Pf,CreditsPanel:qp,CharacterPanel:ah,TextBoxPanel:Lh,ChoicePanel:Jh,SpritePanel:ch,PanelsPanel:kg,NotificationPanel:Ig,PoemPanel:Mg},data:()=>({panelSelection:"add"}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},vertical(){return this.$store.state.ui.vertical},selection(){return this.$store.state.ui.selection},panel(){if(this.panelSelection==="selection")if(this.selection===null)this.panelSelection="add";else return this.currentPanel.objects[this.selection].type;return this.panelSelection},hasPrevRender(){return this.$store.state.ui.lastDownload!==null}},methods:{setPanel(e){e===this.panelSelection&&(e="add"),this.panelSelection=e,this.selection!==null&&this.$store.commit("ui/setSelection",null)},resetScroll(){console.log("resetting scrolls"),this.$refs.panels instanceof HTMLElement&&(this.$refs.panels.scrollTop=0,this.$refs.panels.scrollLeft=0)},onKeydown(e){if(e.ctrlKey){const t=Fg[e.key];t&&(this.setPanel(t),e.preventDefault(),e.stopPropagation())}}},watch:{selection(e){if(e!=null){this.panelSelection="selection";return}this.panelSelection==="selection"&&(this.panelSelection="add")}},created(){B.onPanelChange(e=>{this.panelSelection=e}),window.removeEventListener("keydown",this.onKeydown),window.addEventListener("keydown",this.onKeydown)}}),Vg={id:"toolbar"},Wg=a("i",{class:"material-icons","aria-hidden":"true"},"add_box",-1),Eg=a("div",{class:"shortcut-popup"},"A",-1),Lg=[Wg,Eg],Ug=a("i",{class:"material-icons","aria-hidden":"true"},"panorama",-1),zg=a("div",{class:"shortcut-popup"},"S",-1),Xg=[Ug,zg],Gg=a("i",{class:"material-icons","aria-hidden":"true"},"view_module",-1),Yg=a("div",{class:"shortcut-popup"},"D",-1),qg=[Gg,Yg],Kg=a("i",{class:"material-icons","aria-hidden":"true"},"settings_applications",-1),Jg=a("div",{class:"shortcut-popup"},"F",-1),Zg=[Kg,Jg],Qg={id:"toolbar-end"},eb=a("i",{class:"material-icons","aria-hidden":"true"},"help",-1),tb=[eb],ob=a("i",{class:"material-icons","aria-hidden":"true"},"extension",-1),sb=[ob],nb=["disabled"],ib=a("i",{class:"material-icons","aria-hidden":"true"},"flip_to_back",-1),rb=[ib],ab=a("i",{class:"material-icons","aria-hidden":"true"},"photo_camera",-1),lb=[ab];function db(e,t,o,s,n,r){const i=C("settings-panel"),l=C("backgrounds-panel"),d=C("credits-panel"),c=C("character-panel"),u=C("sprite-panel"),h=C("text-box-panel"),f=C("choice-panel"),P=C("panels-panel"),j=C("notification-panel"),$=C("poem-panel"),le=C("add-panel");return p(),b("div",{id:"panels",class:F({vertical:e.vertical}),onScroll:t[12]||(t[12]=(...N)=>e.resetScroll&&e.resetScroll(...N)),ref:"panels"},[a("div",Vg,[a("button",{class:F({active:e.panel==="add"}),onClick:t[0]||(t[0]=N=>e.setPanel("add")),title:"Add new objects to the scene","aria-label":"Add new objects to the scene"},Lg,2),a("button",{class:F({active:e.panel==="backgrounds"}),onClick:t[1]||(t[1]=N=>e.setPanel("backgrounds")),"aria-label":"Change the current background",title:"Change the current background"},Xg,2),a("button",{class:F({active:e.panel==="panels"}),title:"Panels","aria-label":"Panels",onClick:t[2]||(t[2]=N=>e.setPanel("panels"))},qg,2),a("button",{class:F({active:e.panel==="settings"}),title:"Settings","aria-label":"Settings",onClick:t[3]||(t[3]=N=>e.setPanel("settings"))},Zg,2)]),e.panel==="settings"?(p(),x(i,{key:0})):e.panel==="backgrounds"?(p(),x(l,{key:1,onShowDialog:t[4]||(t[4]=N=>e.$emit("show-dialog",N))})):e.panel==="help_credits"?(p(),x(d,{key:2})):e.panel==="character"?(p(),x(c,{key:3,onShowDialog:t[5]||(t[5]=N=>e.$emit("show-dialog",N)),onShowExpressionDialog:t[6]||(t[6]=N=>e.$emit("show-expression-dialog",N))})):e.panel==="sprite"?(p(),x(u,{key:4})):e.panel==="textBox"?(p(),x(h,{key:5})):e.panel==="choice"?(p(),x(f,{key:6})):e.panel==="panels"?(p(),x(P,{key:7})):e.panel==="notification"?(p(),x(j,{key:8})):e.panel==="poem"?(p(),x($,{key:9})):(p(),x(le,{key:10,onShowDialog:t[7]||(t[7]=N=>e.$emit("show-dialog",N))})),a("div",Qg,[a("button",{class:F({active:e.panel==="help_credits"}),onClick:t[8]||(t[8]=N=>e.setPanel("help_credits")),title:"Help & Credits","aria-label":"Help & Credits"},tb,2),a("button",{class:F({active:e.panel==="packs"}),onClick:t[9]||(t[9]=N=>e.$emit("show-dialog")),title:"Content packs","aria-label":"Content packs"},sb,2),a("button",{onClick:t[10]||(t[10]=N=>e.$emit("show-prev-render")),title:"Show last downloaded panel","aria-label":"Show last downloaded panel",disabled:!e.hasPrevRender},rb,8,nb),a("button",{title:"Take a screenshot of the current scene","aria-label":"Take a screenshot of the current scene",onClick:t[11]||(t[11]=N=>e.$emit("download"))},lb)])],34)}var cb=H(Ng,[["render",db]]);const ub=5e3,zo=2e4,kn=100,hb=D({props:{loading:{default:!1,type:Boolean}},data:()=>({messages:[],errors:[],resolvableErrors:[],showLoading:!1,showLoadingTimeout:0,hideLoadingTimeout:0}),computed:{vertical(){return this.$store.state.ui.vertical}},created(){this.onLoadingChange(this.loading),E.subscribe(pt,e=>{this.messages.push(`Failed to load asset '${e.path}'`),setTimeout(()=>{this.messages.shift()},ub)}),E.subscribe(zt,e=>{this.messages.push("Failed to load custom asset. Try to download it manually and then upload it."),setTimeout(()=>{this.messages.shift()},zo)}),E.subscribe(Ut,e=>{this.errors.push(e.message)}),E.subscribe(Gt,e=>{this.resolvableErrors.push(e)}),E.subscribe(se,e=>{this.messages.push(e.message),setTimeout(()=>{this.messages.shift()},zo)}),E.subscribe(is,e=>{this.messages.push(e.error.name),this.messages.push(JSON.stringify(e.error.stack)),this.messages.push(e.info),setTimeout(()=>{this.messages.shift(),this.messages.shift(),this.messages.shift()},zo)})},methods:{onLoadingChange(e){e?(this.hideLoadingTimeout&&(clearTimeout(this.hideLoadingTimeout),this.hideLoadingTimeout=0),!this.showLoading&&!this.showLoadingTimeout&&(this.showLoadingTimeout=setTimeout(()=>{this.showLoading=!0,this.showLoadingTimeout=0},kn))):(this.showLoadingTimeout&&(clearTimeout(this.showLoadingTimeout),this.showLoadingTimeout=0),this.showLoading&&!this.hideLoadingTimeout&&(this.hideLoadingTimeout=setTimeout(()=>{this.showLoading=!1,this.hideLoadingTimeout=0},kn)))},dismissError(e){this.errors.splice(e,1)},async resolvableAction(e,t){const o=this.resolvableErrors[e];this.resolvableErrors.splice(e,1),await o.actions.find(n=>n.name===t).exec()}},watch:{loading(e){this.onLoadingChange(e)}}}),pb={key:0},fb=["onClick"],gb=["onClick"];function bb(e,t,o,s,n,r){return p(),b("div",{id:"messageConsole",class:F({vertical:e.vertical})},[e.showLoading?(p(),b("p",pb,"Loading...")):S("",!0),(p(!0),b(_,null,L(e.messages,(i,l)=>(p(),b("p",{key:i+"_"+l},V(i),1))),128)),(p(!0),b(_,null,L(e.resolvableErrors,(i,l)=>(p(),b("p",{class:"error",key:"resolvableError_"+l},[v(V(i.message)+" ",1),(p(!0),b(_,null,L(i.actions,d=>(p(),b("a",{href:"#",onClick:c=>e.resolvableAction(l,d.name)},"["+V(d.name)+"]",9,fb))),256))]))),128)),(p(!0),b(_,null,L(e.errors,(i,l)=>(p(),b("p",{class:"error",key:"error_"+l},[v(V(i)+" ",1),a("a",{href:"#",onClick:d=>e.dismissError(l)},"[Dismiss]",8,gb)]))),128))],2)}var mb=H(hb,[["render",bb],["__scopeId","data-v-5275d5b4"]]);const yb=D({props:{canvasWidth:{default:0},canvasHeight:{default:0},preLoading:{type:Boolean}},data:()=>({sdCtx:null,currentlyRendering:!1,queuedRender:null,showingLast:!1,dropSpriteCount:0,dropPreventClick:!1,draggedObject:null,dragXOffset:0,dragYOffset:0,dragXOriginal:0,dragYOriginal:0}),computed:{selection(){var e;return(e=this.$store.state.ui.selection)!=null?e:null},currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},lqRendering(){return this.$store.state.ui.lqRendering},sceneRender(){return new ht(this.$store,this.$store.state.panels.currentPanel,this.bitmapWidth,this.bitmapHeight)},bitmapHeight(){return this.preLoading,T().Base.screenHeight},bitmapWidth(){return this.preLoading,T().Base.screenWidth},pickerMode(){return this.$store.state.ui.pickColor},cursor(){return this.pickerMode?"crosshair":"default"}},methods:{async download(){const e=await this.sceneRender.download();await this.vuexHistory.transaction(async()=>{const t=this.$store.state.ui.lastDownload;this.$store.commit("ui/setLastDownload",e),t&&URL.revokeObjectURL(t)})},invalidateRender(){this.queuedRender||(this.queuedRender=requestAnimationFrame(()=>this.render_()))},async render_(){this.queuedRender&&(cancelAnimationFrame(this.queuedRender),this.queuedRender=null),!this.$store.state.unsafe&&(await this.sceneRender.render(!this.lqRendering,!0),this.display())},renderLoadingScreen(){if(!this.sdCtx)return;const e=document.createElement("canvas");e.height=this.bitmapHeight,e.width=this.bitmapWidth,We.make(e,!0,!1).drawText({text:"Starting...",x:e.width/2,y:e.height/2,align:"center",outline:{width:5,style:"#b59"},font:"32px riffic",fill:{style:"white"}}),this.sdCtx.drawImage(e,this.canvasWidth,this.canvasHeight)},display(){!this.sdCtx||(this.showingLast=!1,this.sceneRender.paintOnto(this.sdCtx,{x:0,y:0,w:this.bitmapWidth,h:this.bitmapHeight}))},toRendererCoordinate(e,t){const o=this.$refs.sd,s=e-o.offsetLeft,n=t-o.offsetTop,r=s/o.offsetWidth*o.width,i=n/o.offsetWidth*o.width;return[r,i]},onUiClick(e){var i;const[t,o]=this.toRendererCoordinate(e.clientX,e.clientY);if(this.pickerMode){const l=this.sdCtx.getImageData(t,o,1,1).data,d=`rgba(${l[0].toString()},${l[1].toString()},${l[2].toString()},${(l[3]/255).toString()})`;this.vuexHistory.transaction(()=>{this.$store.commit("ui/setColorPicker",!1),E.fire(new ft(d))});return}if(this.dropPreventClick){this.dropPreventClick=!1;return}const s=this.sceneRender.objectsAt(t,o),n=s.findIndex(l=>l===this.selection);let r;n===0?r=null:n!==-1?r=s[n-1]:r=(i=s[s.length-1])!=null?i:null,this.$store.state.ui.selection!==r&&this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",r)})},onDragStart(e){if(e.preventDefault(),this.selection===null)return;this.draggedObject=this.currentPanel.objects[this.selection];const[t,o]=this.toRendererCoordinate(e.clientX,e.clientY);this.dragXOffset=t-this.draggedObject.x,this.dragYOffset=o-this.draggedObject.y,this.dragXOriginal=this.draggedObject.x,this.dragYOriginal=this.draggedObject.y},onTouchStart(e){if(this.selection===null)return;this.draggedObject=this.currentPanel.objects[this.selection];const[t,o]=this.toRendererCoordinate(e.touches[0].clientX,e.touches[0].clientY);this.dragXOffset=t-this.draggedObject.x,this.dragYOffset=o-this.draggedObject.y,this.dragXOriginal=this.draggedObject.x,this.dragYOriginal=this.draggedObject.y},onDragOver(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},onSpriteDragMove(e){if(!this.draggedObject)return;e.preventDefault();let[t,o]=e instanceof MouseEvent?this.toRendererCoordinate(e.clientX,e.clientY):this.toRendererCoordinate(e.touches[0].clientX,e.touches[0].clientY);t-=this.dragXOffset,o-=this.dragYOffset;const s=Math.abs(t-this.dragXOriginal),n=Math.abs(o-this.dragYOriginal);s+n>1&&(this.dropPreventClick=!0),e.shiftKey&&(s>n?o=this.dragYOriginal:t=this.dragXOriginal),this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPosition",{panelId:this.draggedObject.panelId,id:this.draggedObject.id,x:t,y:o})})},async onDrop(e){if(e.stopPropagation(),e.preventDefault(),!!e.dataTransfer){for(const t of e.dataTransfer.items)if(t.kind==="file"&&t.type.match(/image.*/)){const o="dropCustomAsset"+ ++this.dropSpriteCount,s=oi(o,t.getAsFile());await this.vuexHistory.transaction(async()=>{await this.$store.dispatch("panels/createSprite",{assets:[{hq:s,lq:s,sourcePack:"dddg.generated.uploaded-sprites"}]})})}}},onSpriteDrop(e){this.draggedObject&&("TouchEvent"in window&&e instanceof TouchEvent&&(this.dropPreventClick=!1),this.draggedObject=null)},onMouseEnter(e){e.buttons!==1&&(this.draggedObject=null)}},watch:{canvasWidth(){this.display()},canvasHeight(){this.display()}},async created(){E.subscribe(Xt,()=>this.invalidateRender()),this.$store.subscribe(e=>{e.type!=="panels/setPanelPreview"&&e.type!=="panels/currentPanel"&&this.invalidateRender()})},mounted(){const e=this.$refs.sd;this.sdCtx=e.getContext("2d"),this.renderLoadingScreen(),this.invalidateRender()}}),vb=["height","width"];function wb(e,t,o,s,n,r){return p(),b("canvas",{id:"scaled_display",ref:"sd",height:e.bitmapHeight,width:e.bitmapWidth,style:K({width:e.canvasWidth+"px",height:e.canvasHeight+"px",cursor:e.cursor}),draggable:"true",onClick:t[0]||(t[0]=(...i)=>e.onUiClick&&e.onUiClick(...i)),onTouchstart:t[1]||(t[1]=(...i)=>e.onTouchStart&&e.onTouchStart(...i)),onDragstart:t[2]||(t[2]=(...i)=>e.onDragStart&&e.onDragStart(...i)),onTouchmove:t[3]||(t[3]=(...i)=>e.onSpriteDragMove&&e.onSpriteDragMove(...i)),onMousemove:t[4]||(t[4]=(...i)=>e.onSpriteDragMove&&e.onSpriteDragMove(...i)),onTouchend:t[5]||(t[5]=(...i)=>e.onSpriteDrop&&e.onSpriteDrop(...i)),onMouseup:t[6]||(t[6]=(...i)=>e.onSpriteDrop&&e.onSpriteDrop(...i)),onDragover:t[7]||(t[7]=(...i)=>e.onDragOver&&e.onDragOver(...i)),onDrop:t[8]||(t[8]=(...i)=>e.onDrop&&e.onDrop(...i)),onMouseenter:t[9]||(t[9]=(...i)=>e.onMouseEnter&&e.onMouseEnter(...i)),onContextmenu:t[10]||(t[10]=I(()=>{},["prevent"]))},"HTML5 is required to use the Doki Doki Dialog Generator. ",44,vb)}var Cb=H(yb,[["render",wb]]);const xn=16/9,Vt=20,$b=50,kb=200,J="./",Sn={"dddg.buildin.backgrounds.nsfw":`${J}packs/buildin.base.backgrounds.nsfw.json`,"dddg.buildin.sayori.nsfw":`${J}packs/buildin.base.sayori.nsfw.json`,"dddg.buildin.base.natsuki.nsfw":`${J}packs/buildin.base.natsuki.nsfw.json`,"dddg.buildin.yuri.nsfw":`${J}packs/buildin.base.yuri.nsfw.json`},xb=new Set(Object.keys(Sn)),Sb=Object.values(Sn),Pb=D({components:{ToolBox:cb,MessageConsole:mb,Render:Cb,ModalDialog:eo,SingleBox:ts(()=>ns(()=>import("./SingleBox.2fc578c3.js"),["assets/SingleBox.2fc578c3.js","assets/SingleBox.0adddef3.css","assets/vendor.25918e1f.js"])),ExpressionBuilder:ts(()=>ns(()=>import("./index.b2e7d70d.js"),["assets/index.b2e7d70d.js","assets/index.d9cd928d.css","assets/vendor.25918e1f.js"]))},data:()=>({canvasWidth:0,canvasHeight:0,blendOver:null,uiSize:192,currentlyRendering:!1,panel:"",dialogVisable:!1,canvasTooSmall:!1,expressionBuilderVisible:!1,expressionBuilderCharacter:"",expressionBuilderHeadGroup:void 0,systemPrefersDarkMode:!1,preLoading:!0,classes:new Set,classTimeout:null,_queuedRerender:null}),computed:{isSafari(){return!1},useDarkTheme(){var e;return(e=this.userPrefersDarkMode)!=null?e:this.systemPrefersDarkMode},userPrefersDarkMode(){return this.$store.state.ui.useDarkTheme},nsfw(){return this.$store.state.ui.nsfw},objects(){const e=this.$store.state.panels,t=e.panels[e.currentPanel];return t?[...t.order,...t.onTopOrder]:[]}},methods:{drawLastDownload(){const e=this.$store.state.ui.lastDownload;!e||this.$refs.render.blendOver(e)},setBlendOver(){this.blendOver=this.$store.state.ui.lastDownload},optimum(e,t){let o=e/xn,s=t*xn;return o>t?o=t:s=e,[s,o]},optimizeWithMenu(e,t){const o=this.optimum(e,t-this.uiSize),s=this.optimum(e-this.uiSize,t);return!this.isSafari&&o[0]*o[1]>s[0]*s[1]?[o[0],o[1],!1]:[s[0],s[1],!0]},updateArea(){const[e,t,o]=this.optimizeWithMenu(document.documentElement.clientWidth,document.documentElement.clientHeight);this.canvasWidth=e,this.canvasHeight=t,this.canvasTooSmall=Math.max(e,t)<kb,this.$store.state.ui.vertical!==o&&this.$store.commit("ui/setVertical",o)},showDialog(e){if(this.dialogVisable=!0,e){const t=()=>{this.$refs.packDialog?this.$refs.packDialog.setSearch(e):setTimeout(t,$b)};this.$nextTick(t)}},showExpressionDialog(e){this.expressionBuilderVisible=!0,this.expressionBuilderCharacter=e.character,this.expressionBuilderHeadGroup=e.headGroup},rerender(){this._queuedRerender||(this._queuedRerender=requestAnimationFrame(()=>{this._queuedRerender=null,E.fire(new Xt)}))},onKeydown(e){if(e.key==="Control"){this.classTimeout===null&&(this.classTimeout=setTimeout(()=>{this.classTimeout=null,this.classes.add("ctrl-key")},500));return}if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement){console.log("skip keydown on potential target");return}this.vuexHistory.transaction(()=>{if(e.ctrlKey){if(e.key==="z"){e.preventDefault();return}else if(e.key==="y"){e.preventDefault();return}else if(e.key==="v"){this.$store.dispatch("panels/pasteObjectFromClipboard",{}),e.preventDefault();return}}const t=this.$store.state.panels.panels[this.$store.state.panels.currentPanel];if(!t)return;const o=t.objects[this.$store.state.ui.selection];if(!o)return;if(e.key==="Delete"){this.$store.dispatch("panels/removeObject",{id:o.id,panelId:o.panelId});return}if(e.key==="c"||e.key==="x"){this.$store.dispatch("panels/copyObjectToClipboard",{id:o.id,panelId:o.panelId}),e.key==="x"&&this.$store.dispatch("panels/removeObject",{id:o.id,panelId:o.panelId}),e.preventDefault();return}if(o.type==="character"){const r=o;if(!r.freeMove){if(e.key==="ArrowLeft"){this.$store.dispatch("panels/shiftCharacterSlot",{id:r.id,panelId:r.panelId,delta:-1});return}if(e.key==="ArrowRight"){this.$store.dispatch("panels/shiftCharacterSlot",{id:r.id,panelId:r.panelId,delta:1});return}}}let{x:s,y:n}=o;if(e.key==="ArrowLeft")s-=e.shiftKey?1:Vt;else if(o&&e.key==="ArrowRight")s+=e.shiftKey?1:Vt;else if(o&&e.key==="ArrowUp")n-=e.shiftKey?1:Vt;else if(o&&e.key==="ArrowDown")n+=e.shiftKey?1:Vt;else return;this.$store.dispatch("panels/setPosition",{id:o.id,panelId:o.panelId,x:s,y:n})})},onKeyup(e){if(e.key==="Control"){this.classTimeout&&clearTimeout(this.classTimeout),this.classTimeout=null,this.classes.delete("ctrl-key");return}},applyTheme(){document.body.classList.toggle("dark-theme",this.useDarkTheme)},select(e){this.$store.state.ui.selection!==e&&this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",e)})}},watch:{systemPrefersDarkMode(){this.applyTheme()},userPrefersDarkMode(){this.applyTheme()},async nsfw(e){e?await this.$store.dispatch("content/loadContentPacks",Sb):await this.$store.dispatch("removePacks",{packs:xb})}},mounted(){if(window.addEventListener("keypress",e=>{e.key==="Escape"&&this.vuexHistory.transaction(()=>{this.$store.state.ui.selection!==null&&this.$store.commit("ui/setSelection",null)})}),window.matchMedia){const e=window.matchMedia("(prefers-color-scheme: dark)");this.systemPrefersDarkMode=e.matches,e.addListener(t=>{this.systemPrefersDarkMode=t.matches})}},async created(){this.updateArea(),ve.setStore(this.$store),window.addEventListener("resize",this.updateArea),window.removeEventListener("keydown",this.onKeydown),window.addEventListener("keydown",this.onKeydown),window.addEventListener("keyup",this.onKeyup),window.app=this,window.store=this.$store,window.env=B,Fn(()=>this.$store.state.ui.selection,t=>{var o,s;((o=document.activeElement)==null?void 0:o.getAttribute("data-obj-id"))!==""+t&&((s=document.querySelector(`*[data-obj-id='${t}']`))==null||s.focus({focusVisible:!1,preventScroll:!0}))}),document.body.addEventListener("drop",t=>{t.preventDefault()},!0),document.body.addEventListener("dragover",t=>{t.preventDefault()},!0),await B.loadGameMode(),this.preLoading=!1,B.connectToStore(this.vuexHistory,this.$store);const e=await B.loadSettings();await this.vuexHistory.transaction(async()=>{var o,s,n,r;B.state.looseTextParsing=e.looseTextParsing||!0,this.$store.commit("ui/setLqRendering",(o=e.lq)!=null?o:!1),this.$store.commit("ui/setDarkTheme",(s=e.darkMode)!=null?s:null),this.$store.commit("ui/setDefaultCharacterTalkingZoom",(n=e.defaultCharacterTalkingZoom)!=null?n:!0),await this.$store.dispatch("content/loadContentPacks",[`${J}packs/buildin.base.backgrounds.json`,`${J}packs/buildin.base.monika.json`,`${J}packs/buildin.base.sayori.json`,`${J}packs/buildin.base.natsuki.json`,`${J}packs/buildin.base.yuri.json`,`${J}packs/buildin.extra.mc.json`,`${J}packs/buildin.extra.concept_mc.json`,`${J}packs/buildin.extra.mc_chad.json`,`${J}packs/buildin.extra.femc.json`,`${J}packs/buildin.extra.concept_femc.json`,`${J}packs/buildin.extra.amy.json`]),await B.loadContentPacks();const t=await this.$store.dispatch("panels/createPanel");Object.keys(this.$store.state.panels.panels[t].objects).length===0&&await this.$store.dispatch("panels/createTextBox",{panelId:t,text:`Hi! Click here to edit this textbox! ${this.$store.state.ui.vertical?"To the right":"At the bottom"} you find the toolbox. There you can add things (try clicking the chibis), change backgrounds and more!`}),await this.$store.commit("panels/setCurrentBackground",{current:"dddg.buildin.backgrounds:ddlc.clubroom",panelId:this.$store.state.panels.currentPanel}),await this.$store.commit("ui/setNsfw",(r=e.nsfw)!=null?r:!1)})},destroyed(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("keyup",this.onKeyup)}}),jb={key:0},Tb={class:"hidden-selectors"},Ib=["data-obj-id","onKeydown"],_b={id:"container"},Bb=a("div",{id:"modal-messages"},null,-1);function Ob(e,t,o,s,n,r){const i=C("render"),l=C("message-console"),d=C("tool-box"),c=C("single-box"),u=C("modal-dialog"),h=C("expression-builder");return p(),b(_,null,[e.canvasTooSmall&&e.isSafari?(p(),b("div",jb," Protrait mode is not supported by safari. Please turn the device sideways. ")):(p(),b("div",{key:1,id:"app",class:F(Array.from(e.classes))},[a("div",Tb,[(p(!0),b(_,null,L(e.objects,f=>(p(),b("div",{key:f,tabindex:"0","data-obj-id":f,onFocus:t[0]||(t[0]=P=>e.rerender()),onBlur:t[1]||(t[1]=P=>e.rerender()),onKeydown:[Q(P=>e.select(f),["enter"]),Q(P=>e.select(f),["space"])]},null,40,Ib))),128))]),a("div",_b,[y(i,{ref:"render",canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,preLoading:e.preLoading},null,8,["canvasWidth","canvasHeight","preLoading"])]),y(l),y(d,{onShowPrevRender:e.drawLastDownload,onDownload:t[2]||(t[2]=f=>e.$refs.render.download()),onShowDialog:e.showDialog,onShowExpressionDialog:e.showExpressionDialog},null,8,["onShowPrevRender","onShowDialog","onShowExpressionDialog"]),(p(),x(Nn,null,[e.dialogVisable?(p(),x(u,{key:0,ref:"dialog",onLeave:t[4]||(t[4]=f=>e.dialogVisable=!1)},{default:w(()=>[y(c,{ref:"packDialog",onLeave:t[3]||(t[3]=f=>e.dialogVisable=!1)},null,512)]),_:1},512)):S("",!0)],1024)),e.expressionBuilderVisible?(p(),x(u,{key:0,ref:"dialog",onLeave:t[6]||(t[6]=f=>e.expressionBuilderVisible=!1)},{default:w(()=>[y(h,{character:e.expressionBuilderCharacter,initHeadGroup:e.expressionBuilderHeadGroup,onLeave:t[5]||(t[5]=f=>e.expressionBuilderVisible=!1)},null,8,["character","initHeadGroup"])]),_:1},512)):S("",!0)],2)),Bb],64)}var Db=H(Pb,[["render",Ob]]),Hb={namespaced:!0,state:{vertical:!1,lqRendering:!0,nsfw:!1,selection:null,lastDownload:null,clipboard:null,useDarkTheme:null,defaultCharacterTalkingZoom:!0,pickColor:!1},mutations:{setVertical(e,t){e.vertical=t},setNsfw(e,t){e.nsfw=t},setLqRendering(e,t){e.lqRendering=t},setSelection(e,t){e.selection=t},setLastDownload(e,t){e.lastDownload=t},setClipboard(e,t){e.clipboard=t},setDarkTheme(e,t){e.useDarkTheme=t},setDefaultCharacterTalkingZoom(e,t){e.defaultCharacterTalkingZoom=t},setColorPicker(e,t){e.pickColor=t}}};function Xo(e,t){return{backgrounds:Ab(e.backgrounds,t.backgrounds),characters:Mb(e.characters,t.characters),dependencies:Go(e.dependencies,t.dependencies),fonts:ae(e.fonts,t.fonts,o=>o.id,(o,s)=>k(m({},o),{files:Go(o.files,s.files)})),poemStyles:ae(e.poemStyles,t.poemStyles,o=>o.label,()=>{throw new Error}),poemBackgrounds:[...e.poemBackgrounds,...t.poemBackgrounds],sprites:ae(e.sprites,t.sprites,o=>o.id,(o,s)=>({id:o.id,label:o.label,variants:[...o.variants,...s.variants],defaultScale:o.defaultScale,hd:o.hd,sdVersion:o.sdVersion||s.sdVersion})),colors:ae(e.colors,t.colors,o=>o.color,o=>o)}}function Ab(e,t){return ae(e,t,o=>o.id,Rb)}function Rb(e,t){return{id:e.id,label:e.label,variants:[...e.variants,...t.variants],scaling:e.scaling,sdVersion:e.sdVersion||t.sdVersion}}function Mb(e,t){return ae(e,t,o=>o.id,Fb)}function Fb(e,t){return{chibi:e.chibi,id:e.id,label:e.label,heads:Wb(e.heads,t.heads),defaultScale:e.defaultScale,hd:e.hd,size:e.size,sdVersion:e.sdVersion,styleGroups:ae(e.styleGroups,t.styleGroups,o=>o.id,(o,s)=>({id:o.id,styleComponents:ae(o.styleComponents,s.styleComponents,n=>n.id,(n,r)=>({id:n.id,label:n.label,variants:Nb(n.variants,r.variants)})),styles:ae(o.styles,s.styles,n=>JSON.stringify(n.components),(n,r)=>({components:n.components,poses:ae(n.poses,r.poses,i=>i.id,Vb)}))}))}}function Nb(e,t){const o=m({},e);for(const s in t)!t.hasOwnProperty(s)||o.hasOwnProperty(s)||(o[s]=t[s]);return o}function Vb(e,t){const o=m({},e.positions);for(const s in t.positions)o[s]?o[s]=[...o[s],...t.positions[s]]:o[s]=t.positions[s];return{id:e.id,compatibleHeads:Go(e.compatibleHeads,t.compatibleHeads),previewOffset:e.previewOffset,previewSize:e.previewSize,scale:e.scale,size:e.size,renderCommands:e.renderCommands,positions:o}}function Wb(e,t){const o=m({},e);for(const s in t){if(!t.hasOwnProperty(s))continue;const n=t[s];if(o[s]){const r=o[s];o[s]={previewOffset:r.previewOffset,previewSize:r.previewSize,variants:[...r.variants,...n.variants]}}else o[s]=n}return o}function Go(e,t){const o=[...e];for(const s of t)o.includes(s)||o.push(s);return o}function ae(e,t,o,s){const n=[...e],r=new Map(e.map((i,l)=>[o(i),l]));for(const i of t){const l=o(i);if(r.has(l)){const d=r.get(l),c=n[d];n.splice(d,1,s(c,i))}else r.set(l,n.length),n.push(i)}return n}function Pn(e){return e.split("/").slice(0,-1).join("/")+"/"}const jn=new Set(["png","gif","bmp","svg"]);var Eb={namespaced:!0,state:{contentPacks:[],current:{dependencies:[],backgrounds:[],characters:[],fonts:[],poemStyles:[],poemBackgrounds:[],sprites:[],colors:[]}},mutations:{setContentPacks(e,t){e.contentPacks=t},setCurrentContent(e,t){e.current=t}},actions:{async removeContentPacks({commit:e,state:t},o){const s=Tn(t.contentPacks.filter(n=>!o.has(n.packId)));e("setContentPacks",s),e("setCurrentContent",s.reduce((n,r)=>Xo(n,r)))},async replaceContentPack({commit:e,state:t},o){const s=o.processed?o.contentPack:await In(o.contentPack);let n=t.contentPacks;const r=n.findIndex(i=>i.packId===o.contentPack.packId);r===-1?n.push(s):n.splice(r,1,s),n=Tn(n),e("setContentPacks",n),e("setCurrentContent",n.reduce((i,l)=>Xo(i,l)))},async loadContentPacks({commit:e,state:t},o){typeof o=="string"&&(o=[o]);const s=await Promise.all(o.map(async l=>{const d=await fetch(l);d.ok||Yo(`Could not load content pack. Server responded with: ${d.statusText}`);let c;try{c=await d.json()}catch{Yo("Content pack is not valid json!")}let u;try{const h={"./":Pn(l),"/":Pn(location.href)+"assets/"};c.version==="2.0"?u=Vn(c,h):u=Wn(En(c,h),h,!1)}catch(h){Yo("Content pack is not in a valid format!",h)}return u})),n=await Promise.all(s.map(l=>In(l))),r=new Set(t.contentPacks.map(l=>l.packId));let i=t.current;for(const l of n){for(const d of l.dependencies)if(!r.has(d))throw new Error(`Missing dependency '${d}'. Refusing to install ${l.packId}`);i=Xo(i,l)}return e("setContentPacks",[...t.contentPacks,...n]),e("setCurrentContent",i),s.map(l=>l.packId)}},getters:{getCharacters({current:e}){const t=new Map;for(const o of e.characters)t.set(o.id,o);return t},getBackgrounds({current:e}){const t=new Map;for(const o of e.backgrounds)t.set(o.id,o);return t}}};function Tn(e){return e}async function In(e){const t=new Set(await Be()?["webp",...jn]:jn),o=new Map([["ext","{lq:.lq:}.{format:webp:webp:png:png}"]]);return Ln(e,(s,n)=>{const r=os(s,o,t,!1),i=os(s,o,t,!0);return{hq:r,lq:i,sourcePack:e.packId||"buildIn"}})}function Yo(e,t){throw console.error(e,t),new Error(e)}var Lb=Un({state:{unsafe:!1},mutations:{setUnsafe(e,t){e.unsafe=t}},actions:{async removePacks({dispatch:e,commit:t,state:o},{packs:s}){const n=JSON.parse(JSON.stringify(o.content.current));t("setUnsafe",!0),await e("content/removeContentPacks",s),await e("panels/fixContentPackRemoval",n),t("setUnsafe",!1)},getSave({state:e},t){return JSON.stringify(e,(o,s)=>{if(o!=="ui"&&o!=="lastRender")return o==="content"&&t?s.contentPacks.map(n=>n.packId).filter(n=>n==null?void 0:n.startsWith("dddg.buildin.")):s},2)}},modules:{ui:Hb,panels:Vf,content:Eb}}),Ub={install(e,t={}){if(!e.config.globalProperties.$store)throw new Error("VuexUndoRedo plugin must be installed after the Vuex plugin.");t.resetStateMutation||(t.resetStateMutation="emptyState"),t.mutations||(t.mutations={});const o=e.config.globalProperties.$store;function s(c,u){let h={};switch(typeof u.payload){case"object":u.payload instanceof Array&&(h=[]),o.commit(`${u.type}`,Object.assign(h,u.payload));break;default:o.commit(`${u.type}`,u.payload)}}async function n(c,u){return await c.transaction(()=>{u.forEach(h=>{s(c,h)})})}async function r(c){const u=c.data.done.slice(0);c.data.done=[],o.commit(t.resetStateMutation);for(let h=0;h<u.length;++h)await n(c,u[h])}const i={};function l(c){if(!i[c]){const u=c.split("/"),h={ignore:P=>!1,combinable:(P,j)=>!1,combinator:(P,j)=>j};let f="";for(const P of u)t.mutations[f+"*"]&&Object.assign(h,t.mutations[f+"*"]),f+=P+"/";t.mutations[c]&&Object.assign(h,t.mutations[c]),i[c]=h}return i[c]}const d={data:Ye({done:[],undone:[],snapshots:[],transactionsSinceSnapshot:0,newMutation:!0,ignoreMutations:t.ignoreMutations||[],currentTransaction:null,transactionQueue:[],initialized:!1}),initialize(){d.initialized||(d.initialized=!0,o.subscribe(c=>{const u=()=>{c.type===t.resetStateMutation||l(c.type).ignore(c)||(d.currentTransaction.push(c),d.newMutation&&(d.data.undone=[]))};d.currentTransaction?u():d.transaction(()=>{u()})}))},async redo(){if(d.data.undone.length<=0)return;const c=d.data.undone.pop();d.newMutation=!1,await n(d,c),d.newMutation=!0},async undo(){d.data.done.length<=0||(d.data.undone.push(d.data.done.pop()),d.newMutation=!1,await r(d),d.newMutation=!0)},clearHistory(){return new Promise((c,u)=>{const h=async()=>{d.currentTransaction=[],d.transactionsSinceSnapshot=0,d.data.undone=[],d.data.done=[],c(),d.currentTransaction=null,d.data.transactionQueue.length>0&&d.data.transactionQueue.shift()()};d.currentTransaction?d.data.transactionQueue.push(h):h()})},transaction(c){return new Promise((u,h)=>{const f=async()=>{d.currentTransaction=[],d.transactionsSinceSnapshot++;try{await c()}catch(P){console.log("Error during transaction!: ",P)}d.currentTransaction=null,d.data.transactionQueue.length>0&&d.data.transactionQueue.shift()(),u()};d.currentTransaction?d.data.transactionQueue.push(f):f()})}};window.storeHistory=d,e.config.globalProperties.vuexHistory=d,d.initialize()}};zn(Db).use(Lb).use(Ub).mount("#main_wrapper");export{Qp as B,Uf as C,us as D,to as L,ve as R,ne as T,is as V,H as _,E as a,Qt as b,re as c,nt as d,B as e,Jt as g};
