{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/toolbox/subtools/color/color.vue?e800","webpack:///./src/components/toolbox/subtools/color/sliderGroup.vue?c241","webpack:///./src/environments/browser.ts","webpack:///./src/environments/edge.ts","webpack:///./src/environments/electron.ts","webpack:///./src/environments/environment.ts","webpack:///./src/components/toolbox/subtools/text/text.vue?b225","webpack:///./src/components/toolbox/tools/content-pack.vue?bccb","webpack:///./src/eventbus/event-bus.ts","webpack:///./src/components/message-console.vue?b712","webpack:///./src/components/toolbox/tools/panels.vue?aca4","webpack:///./src/renderables/character.ts","webpack:///./src/components/toolbox/tools/character/parts.vue?ae7b","webpack:///./src/components/toolbox/tools/textbox.vue?9980","webpack:///./src/components/toolbox/commonsFieldsets/positionAndSize.vue?9b61","webpack:///./src/components/toolbox/subtools/image-options/image-options.vue?bb12","webpack:///./src/components/toolbox/subtools/color/slider.vue?b29c","webpack:///./src/components/toolbox/tools/choice.vue?2c3e","webpack:///./src/renderables/offscreenRenderable.ts","webpack:///./src/renderables/objectRenderable.ts","webpack:///./src/components/toggle.vue?507a","webpack:///./src/renderables/assetListRenderable.ts","webpack:///./src/components/ModalDialog.vue?b39f","webpack:///./src/components/ui/d-flow.vue?925a","webpack:///./src/asset-manager.ts","webpack:///./src/util/exhaust.ts","webpack:///./src/renderer/rendererContext.ts","webpack:///./src/components/toolbox/tools/background/settings.vue?7da1","webpack:///./src/components/toolbox/commonsFieldsets/layers.vue?59e8","webpack:///./src/renderer/renderAbortedException.ts","webpack:///./src/components/toolbox/tools/credits.vue?5484","webpack:///./src/models/error-asset.ts","webpack:///./src/App.vue?06c3","webpack:///./src/components/toolbox/tools/poem.vue?f48d","webpack:///./src/components/vertical-scroll-redirect.ts","webpack:///./src/components/ui/d-fieldset.vue","webpack:///./src/components/ui/d-fieldset.vue?b40b","webpack:///./src/components/ui/d-fieldset.vue?68b3","webpack:///./src/components/toolbox/tools/character.vue?1adf","webpack:///./src/components/toolbox/tools/settings.vue?2930","webpack:///./src/store/objectTypes/characters.ts","webpack:///./src/components/toggle.vue","webpack:///./src/components/toggle.vue?bbb0","webpack:///./src/components/toggle.vue?563e","webpack:///./src/models/seekers.ts","webpack:///./src/App.vue","webpack:///./src/components/toolbox/toolbox.vue","webpack:///./src/components/toolbox/tools/settings.vue","webpack:///./src/components/toolbox/tools/panelMixin.ts","webpack:///./src/components/toolbox/tools/settings.vue?ffc4","webpack:///./src/components/toolbox/tools/settings.vue?175a","webpack:///./src/components/toolbox/tools/add.vue","webpack:///./src/components/ui/d-button.vue","webpack:///./src/components/ui/d-button.vue?c8db","webpack:///./src/components/ui/d-button.vue?96c1","webpack:///./src/components/toolbox/tools/add.vue?283d","webpack:///./src/components/toolbox/tools/add.vue?f544","webpack:///./src/components/toolbox/tools/character.vue","webpack:///./src/components/toolbox/commonsFieldsets/positionAndSize.vue","webpack:///./src/components/toolbox/commonsFieldsets/positionAndSize.vue?5867","webpack:///./src/components/toolbox/commonsFieldsets/positionAndSize.vue?28a6","webpack:///./src/components/toolbox/commonsFieldsets/layers.vue","webpack:///./src/util/simpleSettable.ts","webpack:///./src/components/toolbox/commonsFieldsets/layers.vue?ff96","webpack:///./src/components/toolbox/commonsFieldsets/layers.vue?32a0","webpack:///./src/components/toolbox/commonsFieldsets/delete.vue","webpack:///./src/components/toolbox/commonsFieldsets/delete.vue?8f34","webpack:///./src/components/toolbox/commonsFieldsets/delete.vue?3356","webpack:///./src/components/toolbox/subtools/image-options/image-options.vue","webpack:///./src/components/ui/d-flow.vue","webpack:///./src/components/ui/d-flow.vue?003a","webpack:///./src/components/toolbox/subtools/color/color.vue","webpack:///./src/components/toolbox/subtools/color/sliderGroup.vue","webpack:///./src/util/colors/hsl.ts","webpack:///./src/util/colors/rgb.ts","webpack:///./src/components/toolbox/subtools/color/slider.vue","webpack:///./src/components/toolbox/subtools/color/slider.vue?d57c","webpack:///./src/components/toolbox/subtools/color/slider.vue?1cb9","webpack:///./src/components/toolbox/subtools/color/sliderGroup.vue?4e6a","webpack:///./src/components/toolbox/subtools/color/sliderGroup.vue?1ef8","webpack:///./src/components/toolbox/subtools/color/color.vue?5cc8","webpack:///./src/components/toolbox/subtools/color/color.vue?8003","webpack:///./src/store/sprite_options.ts","webpack:///./src/components/toolbox/subtools/image-options/image-options.vue?e076","webpack:///./src/components/toolbox/subtools/image-options/image-options.vue?11a3","webpack:///./src/components/toolbox/tools/character/parts.vue","webpack:///./src/components/toolbox/tools/character/partButton.vue","webpack:///./src/components/toolbox/tools/character/partButton.vue?3b03","webpack:///./src/components/toolbox/tools/character/partButton.vue?542d","webpack:///./src/components/toolbox/tools/character/parts.vue?7498","webpack:///./src/components/toolbox/tools/character/parts.vue?7e61","webpack:///./src/components/toolbox/tools/character.vue?72b6","webpack:///./src/components/toolbox/tools/character.vue?e8cb","webpack:///./src/components/toolbox/tools/sprite.vue","webpack:///./src/components/toolbox/tools/sprite.vue?a683","webpack:///./src/components/toolbox/tools/sprite.vue?a58f","webpack:///./src/components/toolbox/tools/textbox.vue","webpack:///./src/components/toolbox/subtools/text/text.vue","webpack:///./src/renderer/textRenderer/string-walker.ts","webpack:///./src/renderer/textRenderer/tokenizer.ts","webpack:///./src/renderer/textRenderer/textCommands.ts","webpack:///./src/renderer/textRenderer/textRenderer.ts","webpack:///./src/constants/textBox.ts","webpack:///./src/components/toolbox/subtools/text/text.vue?8f59","webpack:///./src/components/toolbox/subtools/text/text.vue?e6bc","webpack:///./src/components/toolbox/tools/textbox.vue?0f2e","webpack:///./src/components/toolbox/tools/textbox.vue?b36e","webpack:///./src/components/toolbox/tools/choice.vue","webpack:///./src/components/toolbox/tools/choice.vue?7308","webpack:///./src/components/toolbox/tools/choice.vue?ecd7","webpack:///./src/components/toolbox/tools/credits.vue","webpack:///./src/components/toolbox/tools/credits.vue?4104","webpack:///./src/components/toolbox/tools/credits.vue?4a91","webpack:///./src/components/toolbox/tools/backgrounds.vue","webpack:///./src/components/toolbox/tools/background/button.vue","webpack:///./src/components/toolbox/tools/background/button.vue?b7cb","webpack:///./src/components/toolbox/tools/background/button.vue?2499","webpack:///./src/components/toolbox/tools/background/settings.vue","webpack:///./src/components/toolbox/tools/background/settings.vue?6031","webpack:///./src/components/toolbox/tools/background/settings.vue?25f2","webpack:///./src/components/toolbox/tools/backgrounds.vue?b9bb","webpack:///./src/components/toolbox/tools/backgrounds.vue?9860","webpack:///./src/components/toolbox/tools/content-pack.vue","webpack:///./src/components/toolbox/tools/content-pack.vue?4942","webpack:///./src/components/toolbox/tools/content-pack.vue?a00e","webpack:///./src/components/toolbox/tools/panels.vue","webpack:///./src/store/panels.ts","webpack:///./src/renderables/background.ts","webpack:///./src/renderables/sprite.ts","webpack:///./src/renderer/pathTools.ts","webpack:///./src/constants/textBoxCustom.ts","webpack:///./src/renderables/textbox.ts","webpack:///./src/constants/choices.ts","webpack:///./src/renderables/choices.ts","webpack:///./src/constants/notification.ts","webpack:///./src/renderables/notification.ts","webpack:///./src/constants/poem.ts","webpack:///./src/renderables/poem.ts","webpack:///./src/renderables/scene-renderer.ts","webpack:///./src/components/toolbox/tools/panels.vue?19b3","webpack:///./src/components/toolbox/tools/panels.vue?3f6d","webpack:///./src/components/toolbox/tools/notification.vue","webpack:///./src/components/toolbox/tools/notification.vue?5765","webpack:///./src/components/toolbox/tools/notification.vue?3253","webpack:///./src/components/toolbox/tools/poem.vue","webpack:///./src/components/toolbox/tools/poem.vue?4966","webpack:///./src/components/toolbox/tools/poem.vue?76f8","webpack:///./src/components/toolbox/toolbox.vue?d281","webpack:///./src/components/toolbox/toolbox.vue?6f67","webpack:///./src/components/message-console.vue","webpack:///./src/components/message-console.vue?c981","webpack:///./src/components/message-console.vue?fe48","webpack:///./src/components/render.vue","webpack:///./src/components/render.vue?3c85","webpack:///./src/components/render.vue?c91e","webpack:///./src/components/ModalDialog.vue","webpack:///./src/components/ModalDialog.vue?1c09","webpack:///./src/components/ModalDialog.vue?d092","webpack:///./src/App.vue?1d14","webpack:///./src/App.vue?97f5","webpack:///./src/store/objectTypes/sprite.ts","webpack:///./src/store/objectTypes/choices.ts","webpack:///./src/store/objectTypes/textbox.ts","webpack:///./src/store/objectTypes/notification.ts","webpack:///./src/store/objectTypes/poem.ts","webpack:///./src/store/objects.ts","webpack:///./src/store/ui.ts","webpack:///./src/store/content/merge.ts","webpack:///./src/store/content/index.ts","webpack:///./src/store/index.ts","webpack:///./src/plugins/vuex-history.js","webpack:///./src/main.ts","webpack:///./src/components/toolbox/tools/notification.vue?a23b","webpack:///./src/components/toolbox/drop-target.vue?6b84","webpack:///./src/components/toolbox/tools/backgrounds.vue?d29d","webpack:///./src/components/toolbox/drop-target.vue","webpack:///./src/components/toolbox/drop-target.vue?2f60","webpack:///./src/components/toolbox/drop-target.vue?d003","webpack:///./src/components/toolbox/toolbox.vue?d9ea","webpack:///./src/components/toolbox/tools/add.vue?32d7","webpack:///./src/components/toolbox/tools/background/button.vue?2afd","webpack:///./src/components/ui/d-fieldset.vue?9cca","webpack:///./src/components/toolbox/tools/character/partButton.vue?d051","webpack:///./src/components/ui/d-button.vue?d4ac","webpack:///./src/renderer/renderer.ts","webpack:///./src/constants/base.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","installedCssChunks","jsonpScriptSrc","p","exports","module","l","e","promises","cssChunks","Promise","resolve","reject","href","fullhref","existingLinkTags","document","getElementsByTagName","tag","dataHref","getAttribute","rel","existingStyleTags","linkTag","createElement","type","onload","onerror","event","request","target","src","err","Error","code","parentNode","removeChild","head","appendChild","then","installedChunkData","promise","onScriptComplete","script","charset","timeout","nc","setAttribute","error","clearTimeout","chunk","errorType","realSrc","message","name","undefined","setTimeout","all","m","c","d","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","oe","console","jsonpArray","window","oldJsonpFunction","slice","allowLQ","isLocalRepoSupported","isAutoLoadingSupported","isBackgroundInstallingSupported","vueState","active","inactive","tempInstalled","tempUninstalled","localRepositoryUrl","downloadCanvas","filename","format","quality","a","this","createObjectURL","url","body","click","background","id","defaultValue","prompt","handler","canvas","toBlob","URL","blob","toDataURL","dataURItoBlob","dataURI","binStr","atob","split","len","arr","Uint8Array","charCodeAt","Blob","navigator","msSaveBlob","installedBackgroundsPack","packId","dependencies","packCredits","characters","fonts","sprites","poemStyles","poemBackgrounds","backgrounds","colors","electron","promptCache","lastPrompt","vuexHistory","$store","bgInvalidation","pendingContentPacks","ipcRenderer","on","filePath","transaction","dispatch","filepath","parts","variants","label","invalidateInstalledBGs","fire","send","log","arrayBuffer","buffer","assets","sourcePack","hq","asset","HTMLImageElement","fetch","img","array","startsWith","newUrl","panel","store","requestAnimationFrame","updateInstalledBGs","cancelAnimationFrame","contentPack","chooseEnv","isElectron","msSaveOrOpenBlob","envX","toast","eventBus","emit","kind","subscribe","eventType","unsubscribe","off","AssetFailureEvent","path","CustomAssetFailureEvent","InvalidateRenderEvent","ShowMessageEvent","VueErrorEvent","info","Character","obj","scaleable","pose","currentHeads","drawAssetsUnloaded","renderCommands","renderCommand","offset","composite","posePositions","images","posePosition","positions","part","partAssets","JSON","stringify","size","zoom","close","width","height","localRenderer","lastVersion","hitDetectionFallback","renderable","lastWidth","lastHeight","lastX","lastY","lastFlip","canvasWidth","canvasHeight","render","renderLocal","selected","rx","needRedraw","version","x","y","flip","updateLocalCanvas","w","h","drawImage","image","shadow","preview","blur","color","filters","hx","hy","scaledX","scaledY","centeredVertically","flippedX","scaleX","scaleY","getDataAt","Math","round","DOMException","includes","x0","x1","y0","y1","_current","AssetListRenderable","getAssetList","filter","drawAsset","map","loadAssets","loadedDraws","loadedDraw","unloaded","loaded","webpSupportPromise","heifSupportPromise","isWebPSupported","losslessCode","addEventListener","isHeifSupported","assetCache","customAssets","getAAsset","getAssetByUrl","lq","Image","crossOrigin","style","display","baseUrl","getAsset","replace","registerAsset","file","registerAssetWithURL","exhaust","RenderContext","fsCtx","aborted","params","save","font","align","text","lineJoin","textAlign","outline","strokeStyle","lineWidth","strokeText","fill","fillStyle","fillText","restore","ret","measureText","globalCompositeOperation","filterList","offsetX","offsetY","blurRadius","join","opacityCombined","globalAlpha","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","translate","scale","paintOnto","composition","beginPath","rect","stroke","repetition","previewCanvas","createPattern","transform","createLinearGradient","RenderAbortedException","ErrorAsset","firefoxDeltaFactor","VerticalScrollRedirect","methods","verticalScrollRedirect","currentTarget","getComputedStyle","ev","deltaY","overflowY","scrollHeight","scrollTop","clientHeight","stopPropagation","oldScrollLeft","scrollLeft","mozInputSource","class","title","props","required","String","__scopeId","CloseUpYOffset","BaseCharacterYPos","characterMutations","setPose","state","command","objects","poseId","setCharStyleGroup","styleGroupId","setCharStyle","styleId","setPosePosition","setClose","setFreeMove","freeMove","closestCharacterSlot","getData","getters","characterType","getDataG","rootGetters","getPose","styleGroups","styles","poses","getParts","positionKeys","keys","positionKey","compatibleHeads","unshift","getHeads","headTypeId","headType","heads","pos","sorted","idx","abs","sort","b","lastSpriteId","characterActions","createCharacters","rootState","commit","panelId","panels","currentPanel","onTop","opacity","preserveRatio","ratio","seekPart","delta","seekPose","mutatePoseAndPositions","change","seekStyle","linearStyles","flatMap","styleGroup","styleGroupIdx","styleIdx","styleGroupJson","components","styleA","styleB","localeCompare","linearIdx","findIndex","nextIdx","seekHead","headKey","setPart","val","setCharacterPosition","shiftCharacterSlot","currentSlotNr","newSlotNr","fixContentPackRemovalFromCharacter","context","oldPack","oldCharData","find","char","poseAndPositionChange","buildPoseAndPositionData","oldStyleGroup","oldStyle","oldPose","newCharData","content","current","chr","newStyleGroupIdx","newStyleGroup","styleProperies","newStyleIdx","newStyle","newPoseIdx","newPose","newPosePositions","newPosition","oldPositionIdx","oldHeadGroup","newHeadGroupIdx","indexOf","oldHead","newHeadIdx","variant","commitPoseAndPositionChanges","character","poseAndPosition","callback","oldHeadCollection","newHeadCollectionNr","_","uid","ref","for","modelValue","Boolean","default","computed","set","$emit","checkbox","$refs","arraySeeker","canvasTooSmall","isSafari","drawLastDownload","download","showDialog","showExpressionDialog","dialogVisable","expressionBuilderVisible","expressionBuilderCharacter","initHeadGroup","expressionBuilderHeadGroup","vertical","setPanel","$event","disabled","hasPrevRender","lqAllowed","lqRendering","nsfw","PanelMixin","mixins","ui","mounted","updateVertical","$el","passive","classList","add","remove","watch","nsfwPacks","names","Set","values","Toggle","environment","contentPacks","pack","has","packs","showDropTarget","hideDropTarget","addCustomSpriteFile","group","icon-pos","icon","onChosen","toLowerCase","assetPath","alt","sprite","assetSpriteBackground","addSpriteToScene","spriteUpload","onSpriteFileUpload","uploadFromURL","addTextBox","addPoem","addDialog","addChoice","addConsole","iconPos","uploadedSpritesPack","DropTarget","DButton","customAssetCount","chibi","dataTransfer","effectAllowed","Array","from","items","item","match","spriteDt","show","hide","uploadInput","files","lastSegment","addNewCustomSprite","processed","created","panelForParts","imageOptionsOpen","hasMultiplePoses","hasMultipleStyles","captialize","closeUp","colspan","allowSize","allowStepMove","isFirstPos","positionNames","isLastPos","min","DFieldset","shiftLayer","Infinity","genericSetable","action","onClick","showShadowColor","no-wraping","compositionMode","gap","direction","addEffectSelection","filterTypes","filterType","getFilterLabel","addFilter","currentFilter","removeFilter","currentFilterIdx","moveFilter","maxSize","filterIdx","selectFilter","getFilterText","shadowX","shadowY","isPercentFilter","toFixed","max","maxValue","minValue","setValue","Number","noWraping","finalDirection","wrapingClass","attrs","flowContainer","$slots","scrollContainer","relative","updateHex","addSwatch","swatches","swatch","label1","v1","max-value","maxValue1","gradient-stops","stops1","label2","v2","maxValue2","stops2","label3","v3","maxValue3","stops3","stopsAlpha","deltas","HSLAColor","g","q","hue2rgb","toString","padStart","sqrt","pow","str","validCssRgb","validHex","fromCssRgb","fromHex","rgbEx","test","rgbaEx","rgbHead","parentesisPos","rbgTail","elements","parseFloat","trim","RGBAColor","hexShortEx","hexLongEx","hexTail","parseInt","xmlns","viewBox","enterSlide","moveSlide","exitSlide","x2","y2","gradientStops","stroke-width","paint-order","pointerPath","sliderLength","sliderOffset","slideActive","svg","contains","MouseEvent","which","bounding","getBoundingClientRect","clientX","touches","preventDefault","Slider","validator","lastRGBEmit","stops","eightsStops","stop","toRgb","toCss","initValues","valueChanged","updateValue","newColor","rgbColor","toHex","hslColor","toHSL","gen","generatedPackId","SliderGroup","rgb","fromCss","hex","existingPack","newPack","percentageValue","filterText","Map","DFlow","Color","moveBy","charData","index","styleComponents","styleComponent","buttons","button","choose_component","spriteSize","lookups","backgroundSize","floor","backgroundPosition","lookup","backgroundImage","PartButton","stylePriorities","component","collection","currentPose","headKeyIdx","headIdx","headImages","previewSize","previewOffset","currentStyle","poseIdx","generatePosePreview","partIdx","partImage","updateStyleData","baseStyle","concat","updatePose","selection","priority","subSelect","choose","headTypeIdx","prioIdx","stylePriority","PositionAndSize","Layers","Delete","Parts","ImageOptions","charAt","toUpperCase","substring","colorSelect","colorName","textEditor","textEditorName","textEditorText","textBoxStyle","talkingDefaults","talkingOther","autoQuoting","autoWrap","dialog","resetPosition","splitTextbox","showControls","allowSkipping","showContinueArrow","customColor","customNameboxWidth","deriveCustomColors","customControlsColor","customNameboxColor","customNameboxStroke","colorSelector","selectedColor","applyColor","onValueChanged","insertText","insertCommand","selectedFont","selectColor","aroundContextSize","tokenize","tokens","stringWalker","currentTokenState","tokenStateNormal","tokenStateEnd","contents","walker","tokenStateCommand","tokenStateNewLine","tokenText","nextState","textContent","escape","next","msg","around","closing","commandName","argument","argumentsState","paramlessOp","isItalic","isBold","isUnderlined","isStrikethrough","fontName","strokeColor","strokeWidth","letterSpacing","relativeNumberOp","parameter","fontSize","alpha","op","num","isNaN","rebuildParts","renderParts","getRenderParts","neededToLoad","doc","fontString","check","load","ctx","applyTextStyleToCanvas","State","lastChar","None","ExplictQuote","Star","measureWidth","ImplictQuote","lastPart","alignment","xStart","xEnd","yStart","maxLineWidth","currentLine","fixLine","applyLineWrapping","lineHeights","lineHeight","line","lastItem","lastItemInLine","styleStack","tagStack","currentStyleHeight","measureHeight","currentTag","token","TextRenderer","textCommands","pop","lastBreakPoint","currentLineWidth","lastBreakLineWidth","newParts","tmpContext","getContext","lastStyle","textStyle","heightCache","lineSpacing","innerHTML","fontFamily","div","position","top","left","offsetHeight","TextBoxWidth","TextBoxCorruptedWidth","TextBoxHeight","TextBoxY","TextBoxTextXOffset","TextBoxTextYOffset","NameboxHeight","NameboxWidth","NameboxXOffset","NameboxTextYOffset","ControlsYBottomOffset","ControlsXHistoryOffset","ControlsXSkipOffset","ControlsXStuffOffset","ArrowXRightOffset","ArrowYBottomOffset","GlowRX","GlowRY","BaseTextStyle","NameboxTextStyle","ControlsTextStyle","ControlsTextDisabledStyle","NameboxY","rememberedStart","rememberedEnd","textArea","el","selectionStart","selectionEnd","$nextTick","selStart","selEnd","focus","arg","selectedText","before","after","commandOpen","TextEditor","button_text","btnIdx","currentIdx","select","removeChoice","simpleButtonSettable","choices","choiceIdx","dragEnter","dt","addImageFile","bgColor","upload","onFileUpload","addByUrl","backgroundId","setBackground","isActive","bgData","urls","isColor","isVariant","flipped","hasVariants","seekVariant","scaling","currentBackgroundId","uploadedBackgroundsPack","BackgroundButton","BackgroundSettings","addNewCustomBackground","addNew","readonly","credits","activatable","activate","deactivatable","deactivate","installable","install","uninstallable","uninstall","needRestart","restart","selectedPack","installed","queuedUninstall","freshInstall","location","reload","localRepoAdd","localRepoRemove","autoLoadAdd","autoLoadRemove","ScalingModes","panelButtons","updateCurrentPanel","addNewPanel","deletePanel","canDeletePanel","moveAhead","canMoveAhead","moveBehind","canMoveBehind","webpSupport","heifSupport","isLossy","ppi","pages","placeholder","estimateExportSize","transparentId","lastPanelNum","previewManager","panelToUrl","urlToPanel","register","unregister","delete","revokeObjectURL","namespaced","panelOrder","mutations","setCurrentPanel","setPanelPreview","lastRender","createPanel","setPanelOrder","setCurrentBackground","setBackgroundColor","setBackgroundFlipped","setBackgroundVariant","setBackgroundScaling","actions","duplicatePanel","parse","sourcePanelId","targetPanelId","root","oldIdx","seekBackgroundVariant","newOrderIdx","orderIdx","fixContentPackRemoval","oldContent","oldBackground","newBackground","oldVariantJSON","newVariantIdx","move","newIdx","Stretch","Cover","screenRatio","drawRect","init","roundedRectangle","moveTo","arcTo","closePath","roundedTopRectangle","lineTo","nameboxTextOutlineDelta","nameboxBackgroundDelta","nameboxGradientMiddleStopPosition","nameboxGradientEndDelta","nameboxRounding","textboxRounding","textboxRoundingBuffer","controlColorDelta","controlDisableColorDelta","dotColorDelta","dotRadius","dotPatternSize","textboxOutlineColorDelta","w2","baseX","renderBackdrop","talkingDefault","renderNamebox","renderText","bottom","controlsY","controlsCenter","controls","drawText","controlsStyle","skip","controlsDisableStyle","continue","nameboxOutlineColor","customTransform","clip","subRx","gradient","linearGradient","baseBG","nameboxBackgroundColor","targetColor","addColorStop","loadFonts","fixAlignment","dotPattern","dotRx","drawDot","dotX","dotY","drawPath","ellipse","PI","_subSubRx","pattern","patternFrom","glowGradient","outlineColor","baseY","quote","base","controlColor","col","disColor","ChoiceButtonColor","ChoiceButtonBorderColor","ChoiceButtonWidth","ChoiceSpacing","ChoiceYOffset","ChoicePadding","ChoiceY","ChoiceTextStyle","_height","choiceRenderers","updateChoiceBounds","choiceRenderer","getHeight","choice","reduce","acc","renderer","choiceDistance","NotificationBackdropColor","NotificationPadding","NotificationSpacing","NotificationOkTextStyle","NotificationTextStyle","_width","backdrop","textRenderer","buttonRenderer","lineWrap","textWidth","getWidth","textHeight","buttonWidth","buttonHeight","defaultPoemBackground","defaultPoemStyle","defaultX","defaultY","poemTopPadding","poemPadding","defaultPoemWidth","defaultPoemHeight","consoleBackgroundColor","consoleWidth","consoleHeight","defaultConsoleBackground","defaultConsoleStyle","BasePoemStyle","consolePadding","consoleTopPadding","consoleLineWrapPadding","poemTopMargin","paper","padding","topPadding","lineWrapPadding","renderObjectCache","lCurrentlyRendering","renderCallback","date","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getRenderObjects","renderObject","hitTest","getBackgroundRenderer","updatedContent","objectsState","order","onTopOrder","toUncache","estimateFactor","thumbnailFactor","thumbnailQuality","qualityFactor","defaultQuality","qualityWarningThreshold","objectOrders","txtBox","objId","extractObjectText","moveFocusToActivePanel","sceneRenderer","targetCanvas","distribution","getPanelDistibution","prefix","extension","renderObjects","imageIdx","saveToFile","sizes","readableSizes","filePluralize","itPluralize","sizePluralize","mapper","panelIdx","getLimitedPanelList","listedPages","foundMatch","trimmedPart","to","ary","pageIdx","imageI","sliceStart","sliceEnd","querySelector","scrollIntoView","ele","parent","parentElement","children","scroll","clientWidth","oldQuality","subType","poemBackground","poemStyle","poemTextStyles","SettingsPanel","AddPanel","BackgroundsPanel","CreditsPanel","CharacterPanel","TextBoxPanel","ChoicePanel","SpritePanel","ContentPacksPanel","PanelsPanel","NotificationPanel","PoemPanel","panelSelection","lastDownload","onPanelChange","newSelection","showLoading","messages","shortHidingTime","longHidingTime","hideShowTimeouts","loading","showLoadingTimeout","hideLoadingTimeout","onLoadingChange","stack","newValue","bitmapHeight","bitmapWidth","draggable","onUiClick","onTouchStart","onDragStart","onSpriteDragMove","onSpriteDrop","onDragOver","onDrop","onMouseEnter","sdCtx","currentlyRendering","queuedRender","showingLast","dropSpriteCount","dropPreventClick","draggedObject","dragXOffset","dragYOffset","dragXOriginal","dragYOriginal","sceneRender","oldUrl","invalidateRender","render_","unsafe","renderLoadingScreen","loadingScreen","rctx","toRendererCoordinate","sd","offsetLeft","ry","offsetTop","sx","offsetWidth","sy","selectedObject","clientY","objectsAt","currentObjectIdx","dropEffect","deltaX","shiftKey","getAsFile","TouchEvent","mut","open","aspectRatio","arrowMoveStepSize","packDialogWaitMs","canvasTooSmallThreshold","ToolBox","MessageConsole","Render","ModalDialog","SingleBox","ExpressionBuilder","blendOver","uiSize","last","setBlendOver","optimum","sw","sh","rh","rw","optimizeWithMenu","opth","optv","updateArea","documentElement","cw","ch","v","search","wait","packDialog","setSearch","headGroup","onKeydown","ctrlKey","destroyed","removeEventListener","app","spriteMutations","spriteActions","createSprite","choiceMutations","setChoices","setChoiceColor","setChoiceDistance","setAutoWrapping","lastChoiceId","choiceActions","createChoice","setChoiceText","splitTextboxSpacing","textBoxMutations","setText","setTalkingDefault","setTalkingOther","setStyle","setControlsVisible","setControlsColor","setDeriveCustomColors","setNameboxColor","setNameboxStroke","setNameboxWidth","setSkipable","setContinueArrow","setCustomColor","setAutoQuoting","setResetBounds","resetBounds","lastTextBoxId","textBoxActions","createTextBox","resetTextboxBounds","newWidth","notificationMutations","setNotificationColor","setNotificationText","setNotificationBackdrop","lastNotificationId","notificationActions","createNotification","poemMutations","setPoemBackground","setPoemFont","setPoemText","lastPoemId","poemActions","createPoem","createConsole","lastCopyId","removeFromList","addToList","setOnTop","setPosition","setFlip","setSize","setRatio","removeObject","setComposition","setFilters","setPreserveRatio","setWidth","setHeight","copyObjects","sourceOrders","oldObject","deleteAllOfPanel","setFilter","setVertical","setNsfw","setLqRendering","setSelection","setLastDownload","mergeContentPacks","mergeBackgrounds","mergeCharacters","mergeArrayUnique","mergeIdArrays","xObj","yObj","mergeBackground","mergeCharacter","mergeHeadCollections","xStyleGroup","yStyleGroup","xClasses","yClasses","mergeStyleClasses","xStyle","yStyle","mergePose","classKey","headGroupKey","getId","merge","definedIds","yId","existingIdx","existing","baseDir","baseTypes","setContentPacks","setCurrentContent","convertContentPack","convertedPack","existingPacks","dependency","removeContentPacks","packIds","newContentPacks","sortByDependencies","replaceContentPack","packIdx","loadContentPacks","response","ok","statusText","json","paths","convertV1","getCharacters","getBackgrounds","types","replacementMap","payload","setUnsafe","removePacks","oldState","vueApp","options","config","globalProperties","resetStateMutation","replayMutation","vm","mutation","baseObj","assign","replayTransaction","forEach","replayAll","oldTransactions","done","mutationProperiesCache","getMutationProperties","mutationProperties","ignore","combinable","oldMutation","newMutation","combinator","currentWildcard","history","reactive","undone","ignoreMutations","currentTransaction","transactionQueue","initialized","initialize","exec","redo","undo","lastUndo","combination","App","use","mount","visible","drop","Renderer","runningContext","abort","clearRect","getImageData","screenWidth","screenHeight","characterPositions"],"mappings":"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","file":"js/app.2abd246d.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded CSS chunks\n \tvar installedCssChunks = {\n \t\t\"app\": 0\n \t}\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"js/\" + ({}[chunkId]||chunkId) + \".\" + {\"chunk-7799a822\":\"71555152\",\"chunk-ab09dd9e\":\"34ec6f95\"}[chunkId] + \".js\"\n \t}\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar promises = [];\n\n\n \t\t// mini-css-extract-plugin CSS loading\n \t\tvar cssChunks = {\"chunk-7799a822\":1,\"chunk-ab09dd9e\":1};\n \t\tif(installedCssChunks[chunkId]) promises.push(installedCssChunks[chunkId]);\n \t\telse if(installedCssChunks[chunkId] !== 0 && cssChunks[chunkId]) {\n \t\t\tpromises.push(installedCssChunks[chunkId] = new Promise(function(resolve, reject) {\n \t\t\t\tvar href = \"css/\" + ({}[chunkId]||chunkId) + \".\" + {\"chunk-7799a822\":\"8e9a32db\",\"chunk-ab09dd9e\":\"a5b1d338\"}[chunkId] + \".css\";\n \t\t\t\tvar fullhref = __webpack_require__.p + href;\n \t\t\t\tvar existingLinkTags = document.getElementsByTagName(\"link\");\n \t\t\t\tfor(var i = 0; i < existingLinkTags.length; i++) {\n \t\t\t\t\tvar tag = existingLinkTags[i];\n \t\t\t\t\tvar dataHref = tag.getAttribute(\"data-href\") || tag.getAttribute(\"href\");\n \t\t\t\t\tif(tag.rel === \"stylesheet\" && (dataHref === href || dataHref === fullhref)) return resolve();\n \t\t\t\t}\n \t\t\t\tvar existingStyleTags = document.getElementsByTagName(\"style\");\n \t\t\t\tfor(var i = 0; i < existingStyleTags.length; i++) {\n \t\t\t\t\tvar tag = existingStyleTags[i];\n \t\t\t\t\tvar dataHref = tag.getAttribute(\"data-href\");\n \t\t\t\t\tif(dataHref === href || dataHref === fullhref) return resolve();\n \t\t\t\t}\n \t\t\t\tvar linkTag = document.createElement(\"link\");\n \t\t\t\tlinkTag.rel = \"stylesheet\";\n \t\t\t\tlinkTag.type = \"text/css\";\n \t\t\t\tlinkTag.onload = resolve;\n \t\t\t\tlinkTag.onerror = function(event) {\n \t\t\t\t\tvar request = event && event.target && event.target.src || fullhref;\n \t\t\t\t\tvar err = new Error(\"Loading CSS chunk \" + chunkId + \" failed.\\n(\" + request + \")\");\n \t\t\t\t\terr.code = \"CSS_CHUNK_LOAD_FAILED\";\n \t\t\t\t\terr.request = request;\n \t\t\t\t\tdelete installedCssChunks[chunkId]\n \t\t\t\t\tlinkTag.parentNode.removeChild(linkTag)\n \t\t\t\t\treject(err);\n \t\t\t\t};\n \t\t\t\tlinkTag.href = fullhref;\n\n \t\t\t\tvar head = document.getElementsByTagName(\"head\")[0];\n \t\t\t\thead.appendChild(linkTag);\n \t\t\t}).then(function() {\n \t\t\t\tinstalledCssChunks[chunkId] = 0;\n \t\t\t}));\n \t\t}\n\n \t\t// JSONP chunk loading for javascript\n\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n \t\t\t// a Promise means \"currently loading\".\n \t\t\tif(installedChunkData) {\n \t\t\t\tpromises.push(installedChunkData[2]);\n \t\t\t} else {\n \t\t\t\t// setup Promise in chunk cache\n \t\t\t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t\t\t});\n \t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n \t\t\t\t// start chunk loading\n \t\t\t\tvar script = document.createElement('script');\n \t\t\t\tvar onScriptComplete;\n\n \t\t\t\tscript.charset = 'utf-8';\n \t\t\t\tscript.timeout = 120;\n \t\t\t\tif (__webpack_require__.nc) {\n \t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t\t\t}\n \t\t\t\tscript.src = jsonpScriptSrc(chunkId);\n\n \t\t\t\t// create error before stack unwound to get useful stacktrace later\n \t\t\t\tvar error = new Error();\n \t\t\t\tonScriptComplete = function (event) {\n \t\t\t\t\t// avoid mem leaks in IE.\n \t\t\t\t\tscript.onerror = script.onload = null;\n \t\t\t\t\tclearTimeout(timeout);\n \t\t\t\t\tvar chunk = installedChunks[chunkId];\n \t\t\t\t\tif(chunk !== 0) {\n \t\t\t\t\t\tif(chunk) {\n \t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n \t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n \t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n \t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n \t\t\t\t\t\t\terror.type = errorType;\n \t\t\t\t\t\t\terror.request = realSrc;\n \t\t\t\t\t\t\tchunk[1](error);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t\t\t}\n \t\t\t\t};\n \t\t\t\tvar timeout = setTimeout(function(){\n \t\t\t\t\tonScriptComplete({ type: 'timeout', target: script });\n \t\t\t\t}, 120000);\n \t\t\t\tscript.onerror = script.onload = onScriptComplete;\n \t\t\t\tdocument.head.appendChild(script);\n \t\t\t}\n \t\t}\n \t\treturn Promise.all(promises);\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export { default } from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./color.vue?vue&type=style&index=0&id=5ae5bdec&lang=scss&scoped=true\"; export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./color.vue?vue&type=style&index=0&id=5ae5bdec&lang=scss&scoped=true\"","export { default } from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./sliderGroup.vue?vue&type=style&index=0&id=24b7dbc3&lang=scss&scoped=true\"; export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./sliderGroup.vue?vue&type=style&index=0&id=24b7dbc3&lang=scss&scoped=true\"","import { IEnvironment, IPack } from './environment';\nimport { Background } from '@/renderables/background';\nimport { EnvState } from './envState';\nimport { reactive } from 'vue';\n\nexport class Browser implements IEnvironment {\n\tpublic readonly allowLQ = true;\n\tpublic readonly isLocalRepoSupported = false;\n\tpublic readonly isAutoLoadingSupported = false;\n\tpublic readonly isBackgroundInstallingSupported = false;\n\tpublic readonly vueState: EnvState = reactive({\n\t\tactive: [],\n\t\tinactive: [],\n\t\ttempInstalled: [],\n\t\ttempUninstalled: [],\n\t});\n\tpublic readonly localRepositoryUrl = '';\n\n\tpublic async saveToFile(\n\t\tdownloadCanvas: HTMLCanvasElement,\n\t\tfilename: string,\n\t\tformat = 'image/png',\n\t\tquality = 1\n\t): Promise<string> {\n\t\tconst a = document.createElement('a');\n\t\ta.setAttribute('download', filename);\n\t\tconst url = await this.createObjectURL(downloadCanvas, format, quality);\n\t\ta.setAttribute('href', url);\n\t\tdocument.body.appendChild(a);\n\t\ta.click();\n\t\tdocument.body.removeChild(a);\n\t\treturn url;\n\t}\n\n\tpublic installBackground(background: Background): boolean {\n\t\tthrow new Error('This environment does not support installing backgrounds');\n\t}\n\n\tpublic uninstallBackground(background: Background): boolean {\n\t\tthrow new Error(\n\t\t\t'This environment does not support uninstalling backgrounds'\n\t\t);\n\t}\n\n\tpublic localRepoAdd(url: string): void {\n\t\tthrow new Error('This environment does not support a local repository');\n\t}\n\n\tpublic localRepoRemove(id: string): void {\n\t\tthrow new Error('This environment does not support a local repository');\n\t}\n\n\tpublic autoLoadAdd(id: string): void {\n\t\tthrow new Error('This environment does not support auto loading');\n\t}\n\n\tpublic autoLoadRemove(id: string): void {\n\t\tthrow new Error('This environment does not support auto loading');\n\t}\n\n\tpublic prompt(\n\t\tmessage: string,\n\t\tdefaultValue?: string\n\t): Promise<string | null> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tresolve(prompt(message, defaultValue));\n\t\t});\n\t}\n\n\tpublic onPanelChange(handler: (panel: string) => void): void {\n\t\treturn;\n\t}\n\n\tprotected createObjectURL(\n\t\tcanvas: HTMLCanvasElement,\n\t\tformat: string,\n\t\tquality: number\n\t): Promise<string> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (canvas.toBlob && window.URL && window.URL.createObjectURL) {\n\t\t\t\tcanvas.toBlob(\n\t\t\t\t\tblob => {\n\t\t\t\t\t\tif (!blob) {\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(URL.createObjectURL(blob));\n\t\t\t\t\t},\n\t\t\t\t\tformat,\n\t\t\t\t\tquality\n\t\t\t\t);\n\t\t\t} else if (window.URL && window.URL.createObjectURL) {\n\t\t\t\tconst url = canvas.toDataURL();\n\t\t\t\tconst blob = this.dataURItoBlob(url, format);\n\t\t\t\tresolve(URL.createObjectURL(blob));\n\t\t\t} else {\n\t\t\t\tresolve(canvas.toDataURL());\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected dataURItoBlob(dataURI: string, type: string) {\n\t\tconst binStr = atob(dataURI.split(',')[1]);\n\t\tconst len = binStr.length;\n\t\tconst arr = new Uint8Array(len);\n\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tarr[i] = binStr.charCodeAt(i);\n\t\t}\n\n\t\treturn new Blob([arr], { type });\n\t}\n}\n","import { Browser } from './browser';\n\nexport class Edge extends Browser {\n\tpublic async saveToFile(\n\t\tdownloadCanvas: HTMLCanvasElement,\n\t\tfilename: string,\n\t\tformat: string = 'image/png',\n\t\tquality: number = 1\n\t): Promise<string> {\n\t\tlet url = downloadCanvas.toDataURL(format, quality);\n\t\tconst blob = this.dataURItoBlob(url, format);\n\n\t\tif (window.URL && window.URL.createObjectURL) {\n\t\t\turl = URL.createObjectURL(blob);\n\t\t}\n\n\t\t// IE-specific code\n\t\twindow.navigator.msSaveBlob(blob, filename);\n\t\treturn url;\n\t}\n}\n","import { IEnvironment, IPack } from './environment';\nimport { registerAssetWithURL, getAsset } from '@/asset-manager';\nimport { Background } from '@/renderables/background';\nimport eventBus, { ShowMessageEvent } from '@/eventbus/event-bus';\nimport { EnvState } from '@/environments/envState';\nimport { ContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IHistorySupport } from '@/plugins/vuex-history';\nimport { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport { ReplaceContentPackAction } from '@/store/content';\nimport { reactive } from 'vue';\n\nconst packs: IPack[] = [];\n\nconst installedBackgroundsPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.installedBackgrounds',\n\tdependencies: [],\n\tpackCredits: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport class Electron implements IEnvironment {\n\tpublic readonly allowLQ = false;\n\tpublic readonly vueState: EnvState = reactive({\n\t\tactive: [],\n\t\tinactive: [],\n\t\ttempInstalled: [],\n\t\ttempUninstalled: [],\n\t});\n\tpublic readonly localRepositoryUrl = '/repo/repo.json';\n\tpublic readonly isBackgroundInstallingSupported = true;\n\tpublic readonly isLocalRepoSupported = true;\n\tpublic readonly isAutoLoadingSupported = true;\n\n\tprivate electron = (window as any) as IElectronWindow;\n\tprivate promptCache: {\n\t\t[promptId: number]: (resolved: string | null) => void;\n\t} = {};\n\tprivate lastPrompt = 0;\n\n\tprivate vuexHistory: IHistorySupport | null = null;\n\tprivate $store: Store<IRootState> | null = null;\n\tprivate bgInvalidation: number | null = null;\n\tprivate pendingContentPacks: string[] = [];\n\n\tconstructor() {\n\t\tthis.electron.ipcRenderer.on(\n\t\t\t'add-persistent-content-pack',\n\t\t\tasync (e, filePath: string) => {\n\t\t\t\tif (!this.$store || !this.vuexHistory) {\n\t\t\t\t\tthis.pendingContentPacks.push(filePath);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store!.dispatch('content/loadContentPacks', filePath);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.on(\n\t\t\t'add-persistent-background',\n\t\t\tasync (e, filepath: string) => {\n\t\t\t\tconst name = 'persistentBg-' + filepath;\n\t\t\t\tconst parts = filepath.split('/');\n\t\t\t\tregisterAssetWithURL(name, filepath);\n\t\t\t\tinstalledBackgroundsPack.backgrounds.push({\n\t\t\t\t\tid: name,\n\t\t\t\t\tvariants: [[name]],\n\t\t\t\t\tlabel: parts[parts.length - 1],\n\t\t\t\t});\n\t\t\t\tthis.invalidateInstalledBGs();\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.on('push-message', async (e, message: string) => {\n\t\t\teventBus.fire(new ShowMessageEvent(message));\n\t\t});\n\t\tthis.electron.ipcRenderer.on(\n\t\t\t'prompt-answered',\n\t\t\t(e, id: number, value: string | null) => {\n\t\t\t\tthis.promptCache[id](value);\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.on('update-ready', e => {});\n\t\tthis.electron.ipcRenderer.send('find-customs');\n\t}\n\n\tpublic localRepoAdd(url: string): void {\n\t\tconsole.log('installContentPack', url);\n\t\tthis.electron.ipcRenderer.send('install-content-pack', url);\n\t}\n\tpublic localRepoRemove(id: string): void {\n\t\tconsole.log('uninstallContentPack', id);\n\t\tthis.electron.ipcRenderer.send('uninstall-content-pack', id);\n\t}\n\tpublic autoLoadAdd(id: string): void {\n\t\tconsole.log('activateContentPack', id);\n\t\tthis.electron.ipcRenderer.send('activate-content-pack', id);\n\t}\n\tpublic autoLoadRemove(id: string): void {\n\t\tconsole.log('deactivateContentPack', id);\n\t\tthis.electron.ipcRenderer.send('deactivate-content-pack', id);\n\t}\n\n\tpublic saveToFile(\n\t\tdownloadCanvas: HTMLCanvasElement,\n\t\tfilename: string,\n\t\tformat = 'image/png',\n\t\tquality = 1\n\t): Promise<string> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tdownloadCanvas.toBlob(\n\t\t\t\tasync blob => {\n\t\t\t\t\tif (!blob) {\n\t\t\t\t\t\treject();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst buffer = await (blob as any).arrayBuffer();\n\t\t\t\t\tthis.electron.ipcRenderer.send(\n\t\t\t\t\t\t'save-file',\n\t\t\t\t\t\tfilename,\n\t\t\t\t\t\tnew Uint8Array(buffer)\n\t\t\t\t\t);\n\t\t\t\t\tresolve(URL.createObjectURL(blob));\n\t\t\t\t},\n\t\t\t\tformat,\n\t\t\t\tquality\n\t\t\t);\n\t\t});\n\t}\n\n\tpublic async installBackground(background: Background): Promise<void> {\n\t\tif (background.assets.length !== 1) return;\n\t\tif (\n\t\t\tbackground.assets[0].sourcePack !== 'dddg.buildin.uploadedBackgrounds'\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst asset = await getAsset(background.assets[0].hq, true);\n\t\tif (!(asset instanceof HTMLImageElement)) return;\n\t\tconst img = await fetch(asset.src);\n\t\tconst array = new Uint8Array(await img.arrayBuffer());\n\t\tthis.electron.ipcRenderer.send('install-background', array);\n\t}\n\n\tpublic async uninstallBackground(background: Background): Promise<void> {\n\t\tif (background.assets.length !== 1) return;\n\t\tif (\n\t\t\tbackground.assets[0].sourcePack !== 'dddg.buildin.installedBackgrounds'\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst asset = await getAsset(background.assets[0].hq, true);\n\t\tif (!(asset instanceof HTMLImageElement)) return;\n\t\tif (!asset.src.startsWith('blob:')) {\n\t\t\tconst img = await fetch(asset.src);\n\t\t\tconst blob = await img.blob();\n\t\t\tconst newUrl = URL.createObjectURL(blob);\n\t\t\tregisterAssetWithURL(background.assets[0].hq, newUrl);\n\t\t}\n\t\tthis.electron.ipcRenderer.send('uninstall-background', background.id);\n\t}\n\n\tpublic prompt(\n\t\tmessage: string,\n\t\tdefaultValue?: string\n\t): Promise<string | null> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.promptCache[++this.lastPrompt] = resolve;\n\t\t\tthis.electron.ipcRenderer.send(\n\t\t\t\t'show-prompt',\n\t\t\t\tthis.lastPrompt,\n\t\t\t\tmessage,\n\t\t\t\tdefaultValue\n\t\t\t);\n\t\t});\n\t}\n\n\tpublic onPanelChange(handler: (panel: string) => void): void {\n\t\tthis.electron.ipcRenderer.on('open-panel', (e, panel: string) => {\n\t\t\thandler(panel);\n\t\t});\n\t}\n\n\tpublic connectToStore(\n\t\tvuexHistory: IHistorySupport,\n\t\tstore: Store<IRootState>\n\t) {\n\t\tthis.vuexHistory = vuexHistory;\n\t\tthis.$store = store;\n\t\tthis.invalidateInstalledBGs();\n\n\t\tif (this.pendingContentPacks.length > 0) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tawait this.$store!.dispatch(\n\t\t\t\t\t'content/loadContentPacks',\n\t\t\t\t\tthis.pendingContentPacks\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate invalidateInstalledBGs() {\n\t\tif (!this.vuexHistory || !this.$store) return;\n\t\tif (this.bgInvalidation !== null) return;\n\t\tthis.bgInvalidation = requestAnimationFrame(() => {\n\t\t\tthis.updateInstalledBGs();\n\t\t});\n\t}\n\n\tprivate updateInstalledBGs() {\n\t\tif (this.bgInvalidation) {\n\t\t\tcancelAnimationFrame(this.bgInvalidation);\n\t\t\tthis.bgInvalidation = null;\n\t\t}\n\t\tif (!this.vuexHistory || !this.$store) return;\n\n\t\tthis.vuexHistory.transaction(() => {\n\t\t\tthis.$store!.dispatch('content/replaceContentPack', {\n\t\t\t\tcontentPack: installedBackgroundsPack,\n\t\t\t} as ReplaceContentPackAction);\n\t\t});\n\t}\n}\n\ninterface IElectronWindow {\n\tisElectron: boolean;\n\tipcRenderer: IpcRenderer;\n}\n\ninterface IpcRenderer {\n\ton(\n\t\tchannel: string,\n\t\tlistener: (event: IpcRendererEvent, ...args: any[]) => void\n\t): void;\n\tsend(channel: string, ...args: any[]): void;\n}\n\ninterface IpcRendererEvent extends Event {\n\tsender: IpcRenderer;\n\tsenderId: number;\n}\n","import { Edge } from './edge';\nimport { Browser } from './browser';\nimport { Electron } from './electron';\nimport { Background } from '@/renderables/background';\nimport { EnvState } from './envState';\n\nexport interface IPack {\n\turl: string;\n\tid: string;\n\tcredits: string;\n\tqueuedUninstall: boolean;\n\tactive: boolean;\n}\n\nexport interface IEnvironment {\n\treadonly allowLQ: boolean;\n\treadonly isBackgroundInstallingSupported: boolean;\n\treadonly isLocalRepoSupported: boolean;\n\treadonly localRepositoryUrl: string;\n\treadonly isAutoLoadingSupported: boolean;\n\treadonly vueState: EnvState;\n\n\tsaveToFile(\n\t\tcanvas: HTMLCanvasElement,\n\t\tfilename: string,\n\t\tformat?: string,\n\t\tquality?: number\n\t): Promise<string>;\n\tinstallBackground(background: Background): void;\n\tuninstallBackground(background: Background): void;\n\tprompt(message: string, defaultValue?: string): Promise<string | null>;\n\tonPanelChange(handler: (panel: string) => void): void;\n\n\tlocalRepoAdd(url: string): void;\n\tlocalRepoRemove(id: string): void;\n\tautoLoadAdd(id: string): void;\n\tautoLoadRemove(id: string): void;\n}\n\nfunction chooseEnv(): IEnvironment {\n\tif ((window as any).isElectron) {\n\t\treturn new Electron();\n\t}\n\tif (window.navigator.msSaveOrOpenBlob !== undefined) {\n\t\treturn new Edge();\n\t}\n\treturn new Browser();\n}\n\nconst envX = chooseEnv();\n\n(window as any).toast = envX;\nexport default envX;\n","export { default } from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./text.vue?vue&type=style&index=0&id=7ba8b720&lang=scss&scoped=true\"; export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./text.vue?vue&type=style&index=0&id=7ba8b720&lang=scss&scoped=true\"","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./content-pack.vue?vue&type=style&index=0&id=68102184&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./content-pack.vue?vue&type=style&index=0&id=68102184&lang=scss&scoped=true\"","import { DeepReadonly } from '@/util/readonly';\nimport mitt from 'mitt';\n\nconst eventBus = mitt();\n\nexport default {\n\tfire(event: IEvent) {\n\t\teventBus.emit(event.kind, event);\n\t},\n\n\tsubscribe<T extends IEvent>(\n\t\teventType: IEventClass<T>,\n\t\thandler: (ev: T) => void\n\t) {\n\t\teventBus.on(eventType.kind, handler as any);\n\t},\n\n\tunsubscribe<T extends IEvent>(\n\t\teventType: IEventClass<T>,\n\t\thandler: (ev: T) => void\n\t) {\n\t\teventBus.off(eventType.kind, handler as any);\n\t},\n};\n\ninterface IEvent {\n\tkind: string;\n}\n\ninterface IEventClass<T> {\n\tkind: string;\n\tnew (...args: any[]): T;\n}\n\n// tslint:disable: max-classes-per-file\n\nexport class AssetFailureEvent implements IEvent {\n\tpublic static readonly kind = 'AssetFailureEvent';\n\tpublic readonly kind = 'AssetFailureEvent';\n\tpublic constructor(public path: string) {}\n}\n\nexport class CustomAssetFailureEvent implements IEvent {\n\tpublic static readonly kind = 'CustomAssetFailureEvent';\n\tpublic readonly kind = 'CustomAssetFailureEvent';\n\tpublic constructor(public error: ErrorEvent) {}\n}\n\nexport class InvalidateRenderEvent implements IEvent {\n\tpublic static readonly kind = 'InvalidateRenderEvent';\n\tpublic readonly kind = 'InvalidateRenderEvent';\n}\n\nexport class ShowMessageEvent implements IEvent {\n\tpublic static readonly kind = 'ShowMessageEvent';\n\tpublic readonly kind = 'ShowMessageEvent';\n\tpublic constructor(public message: string) {}\n}\n\nexport class VueErrorEvent implements IEvent {\n\tpublic static readonly kind = 'VueErrorEvent';\n\tpublic readonly kind = 'VueErrorEvent';\n\tpublic constructor(\n\t\tpublic readonly error: DeepReadonly<Error>,\n\t\tpublic readonly info: string\n\t) {}\n}\n","export { default } from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./message-console.vue?vue&type=style&index=0&id=51633a54&lang=scss&scoped=true\"; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./message-console.vue?vue&type=style&index=0&id=51633a54&lang=scss&scoped=true\"","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./panels.vue?vue&type=style&index=0&id=71818f1a&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./panels.vue?vue&type=style&index=0&id=71818f1a&lang=scss&scoped=true\"","import {\n\tICharacter,\n\tgetPose,\n\tgetHeads,\n\tgetData,\n} from '@/store/objectTypes/characters';\nimport {\n\tPose,\n\tCharacter as CharacterModel,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport { DeepReadonly } from '@/util/readonly';\nimport { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport {\n\tAssetListRenderable,\n\tIDrawAssetsUnloaded,\n} from './assetListRenderable';\n\nexport class Character extends AssetListRenderable<ICharacter> {\n\tpublic constructor(\n\t\tobj: DeepReadonly<ICharacter>,\n\t\tprivate data: DeepReadonly<CharacterModel<IAsset>>\n\t) {\n\t\tsuper(obj);\n\t}\n\n\tpublic updatedContent(store: Store<DeepReadonly<IRootState>>): void {\n\t\tthis.data = getData(store, this.obj);\n\t}\n\n\tprotected getAssetList(): IDrawAssetsUnloaded[] {\n\t\tconst pose = getPose(this.data, this.obj) as Pose<IAsset>;\n\t\tconst currentHeads = getHeads(this.data, this.obj);\n\t\tconst drawAssetsUnloaded: IDrawAssetsUnloaded[] = [];\n\n\t\tfor (const renderCommand of pose.renderCommands) {\n\t\t\tswitch (renderCommand.type) {\n\t\t\t\tcase 'head':\n\t\t\t\t\tdrawAssetsUnloaded.push({\n\t\t\t\t\t\toffset: renderCommand.offset,\n\t\t\t\t\t\tcomposite: renderCommand.composite,\n\t\t\t\t\t\tassets: currentHeads\n\t\t\t\t\t\t\t? currentHeads.variants[this.obj.posePositions.head || 0]\n\t\t\t\t\t\t\t: [],\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image':\n\t\t\t\t\tdrawAssetsUnloaded.push({\n\t\t\t\t\t\toffset: renderCommand.offset,\n\t\t\t\t\t\tcomposite: renderCommand.composite,\n\t\t\t\t\t\tassets: renderCommand.images,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'pose-part':\n\t\t\t\t\tconst posePosition = pose.positions[renderCommand.part];\n\t\t\t\t\tif (!posePosition || posePosition.length === 0) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tconst partAssets =\n\t\t\t\t\t\tposePosition[this.obj.posePositions[renderCommand.part] || 0];\n\t\t\t\t\tif (!partAssets) break;\n\t\t\t\t\tdrawAssetsUnloaded.push({\n\t\t\t\t\t\toffset: renderCommand.offset,\n\t\t\t\t\t\tcomposite: renderCommand.composite,\n\t\t\t\t\t\tassets: partAssets,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconsole.log(renderCommand, JSON.stringify(drawAssetsUnloaded));\n\t\t}\n\t\treturn drawAssetsUnloaded;\n\t}\n\n\tprotected scaleable = true;\n\tprotected get canvasHeight(): number {\n\t\tconst pose = getPose(this.data, this.obj) as Pose<IAsset>;\n\t\treturn pose.size[1];\n\t}\n\tprotected get canvasWidth(): number {\n\t\tconst pose = getPose(this.data, this.obj) as Pose<IAsset>;\n\t\treturn pose.size[0];\n\t}\n\n\tpublic get width() {\n\t\tconst zoom = this.obj.close ? 2 : 1;\n\t\treturn this.obj.width * zoom;\n\t}\n\n\tpublic get height() {\n\t\tconst zoom = this.obj.close ? 2 : 1;\n\t\treturn this.obj.height * zoom;\n\t}\n}\n","export { default } from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./parts.vue?vue&type=style&index=0&id=47f2e1e8&lang=scss&scoped=true\"; export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./parts.vue?vue&type=style&index=0&id=47f2e1e8&lang=scss&scoped=true\"","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./textbox.vue?vue&type=style&index=0&id=6a66463a&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./textbox.vue?vue&type=style&index=0&id=6a66463a&lang=scss&scoped=true\"","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./positionAndSize.vue?vue&type=style&index=0&id=7f101752&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./positionAndSize.vue?vue&type=style&index=0&id=7f101752&lang=scss&scoped=true\"","export { default } from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./image-options.vue?vue&type=style&index=0&id=79b6e46b&lang=scss&scoped=true\"; export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./image-options.vue?vue&type=style&index=0&id=79b6e46b&lang=scss&scoped=true\"","export { default } from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./slider.vue?vue&type=style&index=0&id=cbe5aa08&lang=scss&scoped=true\"; export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./slider.vue?vue&type=style&index=0&id=cbe5aa08&lang=scss&scoped=true\"","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./choice.vue?vue&type=style&index=0&id=6dc05483&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./choice.vue?vue&type=style&index=0&id=6dc05483&lang=scss&scoped=true\"","import { RenderContext } from '@/renderer/rendererContext';\nimport { Renderer } from '@/renderer/renderer';\nimport { IHitbox } from './renderable';\nimport { DeepReadonly } from '@/util/readonly';\nimport { SpriteFilter } from '@/store/sprite_options';\nimport { screenHeight, screenWidth } from '@/constants/base';\nimport { CompositeModes } from '@/renderer/rendererContext';\n\nexport abstract class OffscreenRenderable {\n\tprivate hq: boolean = false;\n\tprivate localRenderer: Renderer | null = null;\n\tprivate lastVersion: any = null;\n\tprivate hitDetectionFallback = false;\n\tprotected renderable: boolean = false;\n\n\tprotected constructor() {}\n\n\t/**\n\t * A scalable offscreenRenderable has a canvas size independent of the\n\t * display size. * Non-scalable renderables have canvases as big as the\n\t * screen, and are applied without scaling\n\t */\n\tprotected abstract readonly scaleable: boolean;\n\tprotected get centeredVertically(): boolean {\n\t\treturn false;\n\t}\n\tprotected abstract readonly canvasHeight: number;\n\tprotected abstract readonly canvasWidth: number;\n\tprotected abstract renderLocal(rx: RenderContext): Promise<void>;\n\n\tprivate lastWidth = -1;\n\tprivate lastHeight = -1;\n\tprivate lastX = -1;\n\tprivate lastY = -1;\n\tprivate lastFlip: boolean | null = null;\n\n\tprotected abstract readonly x: number;\n\tprotected abstract readonly y: number;\n\tprotected abstract readonly version: any;\n\tprotected abstract readonly flip: boolean;\n\tprotected abstract readonly composite: CompositeModes;\n\tprotected abstract readonly filters: DeepReadonly<SpriteFilter[]>;\n\n\tpublic async updateLocalCanvas(hq: boolean) {\n\t\tconst width = this.canvasWidth;\n\t\tconst height = this.canvasHeight;\n\t\tif (height === 0 && width === 0) {\n\t\t\tthis.renderable = false;\n\t\t\treturn;\n\t\t}\n\t\tthis.renderable = true;\n\t\tthis.localRenderer = new Renderer(width, height);\n\t\tthis.hq = hq;\n\t\tawait this.localRenderer.render(this.renderLocal.bind(this));\n\t}\n\n\tpublic get width() {\n\t\treturn this.canvasWidth;\n\t}\n\n\tpublic get height() {\n\t\treturn this.canvasHeight;\n\t}\n\n\tpublic async render(selected: boolean, rx: RenderContext) {\n\t\tlet needRedraw =\n\t\t\tthis.localRenderer === null ||\n\t\t\tthis.lastVersion !== this.version ||\n\t\t\tthis.hq !== rx.hq;\n\n\t\tif (!this.scaleable) {\n\t\t\tneedRedraw =\n\t\t\t\tneedRedraw ||\n\t\t\t\tthis.width !== this.lastWidth ||\n\t\t\t\tthis.height !== this.lastHeight ||\n\t\t\t\tthis.x !== this.lastX ||\n\t\t\t\tthis.y !== this.lastY ||\n\t\t\t\tthis.flip !== this.lastFlip;\n\t\t\tthis.lastWidth = this.width;\n\t\t\tthis.lastHeight = this.height;\n\t\t\tthis.lastX = this.x;\n\t\t\tthis.lastY = this.y;\n\t\t\tthis.lastFlip = this.flip;\n\t\t}\n\n\t\tif (needRedraw) {\n\t\t\tawait this.updateLocalCanvas(!rx.hq);\n\t\t}\n\n\t\tthis.hq = rx.hq;\n\t\tthis.lastVersion = this.version;\n\n\t\tif (!this.renderable) return;\n\n\t\tconst w = this.scaleable ? this.width : screenWidth;\n\t\tconst h = this.scaleable ? this.height : screenHeight;\n\t\tconst x = this.scaleable ? this.x - w / 2 : 0;\n\t\tconst y = this.scaleable ? this.y : 0;\n\n\t\trx.drawImage({\n\t\t\timage: this.localRenderer!,\n\t\t\tx,\n\t\t\ty,\n\t\t\tw,\n\t\t\th,\n\t\t\tflip: this.flip,\n\t\t\tshadow: selected && rx.preview ? { blur: 20, color: 'red' } : undefined,\n\t\t\tcomposite: this.composite,\n\t\t\tfilters: this.filters,\n\t\t});\n\t}\n\n\tpublic hitTest(hx: number, hy: number): boolean {\n\t\tif (!this.localRenderer) return false;\n\n\t\tconst scaledX = hx - (this.x - this.width / 2);\n\t\tconst scaledY =\n\t\t\thy - (this.centeredVertically ? this.y - this.height / 2 : this.y);\n\n\t\tif (scaledX < 0 || scaledX > this.width) return false;\n\t\tif (scaledY < 0 || scaledY > this.height) return false;\n\n\t\tif (!this.hitDetectionFallback) {\n\t\t\ttry {\n\t\t\t\tif (this.scaleable) {\n\t\t\t\t\tconst flippedX = this.flip ? this.width - scaledX : scaledX;\n\t\t\t\t\tconst scaleX = this.localRenderer.width / this.width;\n\t\t\t\t\tconst scaleY = this.localRenderer.height / this.height;\n\t\t\t\t\tconst data = this.localRenderer.getDataAt(\n\t\t\t\t\t\tMath.round(flippedX * scaleX),\n\t\t\t\t\t\tMath.round(scaledY * scaleY)\n\t\t\t\t\t);\n\t\t\t\t\treturn data[3] !== 0;\n\t\t\t\t} else {\n\t\t\t\t\tconst data = this.localRenderer.getDataAt(\n\t\t\t\t\t\tMath.round(this.flip ? screenWidth - hx : hx),\n\t\t\t\t\t\tMath.round(hy)\n\t\t\t\t\t);\n\t\t\t\t\treturn data[3] !== 0;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t// On chrome for android, the hit test tends to fail because of cross-origin shenanigans, even though\n\t\t\t\t// we only ever load from one origin. ¯\\_(ツ)_/¯\n\t\t\t\t// So we have a fallback that doesn't read the contents of the canvas. This looses accuracy, but at\n\t\t\t\t// least works always.\n\t\t\t\tif (e instanceof DOMException && e.message.includes('cross-origin')) {\n\t\t\t\t\tthis.hitDetectionFallback = true;\n\t\t\t\t} else {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tpublic getHitbox(): IHitbox {\n\t\treturn {\n\t\t\tx0: this.x - this.width / 2,\n\t\t\tx1: this.x + this.width / 2,\n\t\t\ty0: this.y,\n\t\t\ty1: this.y + this.height,\n\t\t};\n\t}\n}\n","import { DeepReadonly } from '@/util/readonly';\nimport { IObject } from '@/store/objects';\nimport { SpriteFilter } from '@/store/sprite_options';\nimport { OffscreenRenderable } from './offscreenRenderable';\nimport { IRootState } from '@/store';\nimport { Store } from 'vuex';\nimport { CompositeModes } from '@/renderer/rendererContext';\n\nexport abstract class ObjectRenderable<\n\tObj extends IObject\n> extends OffscreenRenderable {\n\tpublic constructor(protected obj: DeepReadonly<Obj>) {\n\t\tsuper();\n\t}\n\n\tpublic updatedContent(_current: Store<DeepReadonly<IRootState>>): void {}\n\tpublic get id(): string {\n\t\treturn this.obj.id;\n\t}\n\n\tprotected get x(): number {\n\t\treturn this.obj.x;\n\t}\n\tprotected get y(): number {\n\t\treturn this.obj.y;\n\t}\n\tprotected get version(): number {\n\t\treturn this.obj.version;\n\t}\n\tprotected get flip(): boolean {\n\t\treturn this.obj.flip;\n\t}\n\tprotected get composite(): CompositeModes {\n\t\treturn this.obj.composite;\n\t}\n\tprotected get filters(): DeepReadonly<SpriteFilter[]> {\n\t\treturn this.obj.filters;\n\t}\n}\n","export { default } from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./toggle.vue?vue&type=style&index=0&id=5ca7fb80&lang=scss&scoped=true\"; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./toggle.vue?vue&type=style&index=0&id=5ca7fb80&lang=scss&scoped=true\"","import { RenderContext } from '@/renderer/rendererContext';\nimport { getAAsset } from '@/asset-manager';\nimport { PoseRenderCommand } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport { ErrorAsset } from '../models/error-asset';\nimport { DeepReadonly } from '@/util/readonly';\nimport { ObjectRenderable } from './objectRenderable';\nimport { IObject } from '@/store/objects';\n\nexport abstract class AssetListRenderable<\n\tObj extends IObject\n> extends ObjectRenderable<Obj> {\n\tprotected abstract getAssetList(): Array<IDrawAssetsUnloaded | IDrawAssets>;\n\n\tprotected async renderLocal(rx: RenderContext): Promise<void> {\n\t\tconst drawAssetsUnloaded: Array<\n\t\t\tIDrawAssetsUnloaded | IDrawAssets\n\t\t> = this.getAssetList();\n\n\t\tconst loadedDraws = await Promise.all(\n\t\t\tdrawAssetsUnloaded\n\t\t\t\t.filter(drawAsset => drawAsset.assets)\n\t\t\t\t.map(drawAsset => loadAssets(drawAsset, rx.hq))\n\t\t);\n\t\tfor (const loadedDraw of loadedDraws) {\n\t\t\tfor (const asset of loadedDraw.assets) {\n\t\t\t\trx.drawImage({\n\t\t\t\t\timage: asset,\n\t\t\t\t\tcomposite: loadedDraw.composite,\n\t\t\t\t\tx: loadedDraw.offset[0],\n\t\t\t\t\ty: loadedDraw.offset[1],\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport interface IDrawAssetsUnloaded {\n\toffset: DeepReadonly<[number, number]>;\n\tassets: DeepReadonly<IAsset[]>;\n\tcomposite?: PoseRenderCommand<any>['composite'];\n}\n\nexport interface IDrawAssets {\n\tloaded: true;\n\toffset: DeepReadonly<[number, number]>;\n\tassets: DeepReadonly<Array<HTMLImageElement | ErrorAsset>>;\n\tcomposite?: PoseRenderCommand<any>['composite'];\n}\n\nexport async function loadAssets(\n\tunloaded: IDrawAssetsUnloaded | IDrawAssets,\n\thq: boolean\n): Promise<IDrawAssets> {\n\tif ('loaded' in unloaded) return unloaded;\n\treturn {\n\t\tloaded: true,\n\t\toffset: unloaded.offset,\n\t\tassets: await Promise.all(\n\t\t\tunloaded.assets.map(asset => getAAsset(asset, hq))\n\t\t),\n\t\tcomposite: unloaded.composite,\n\t};\n}\n","export { default } from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./ModalDialog.vue?vue&type=style&index=0&id=7f2c764e&scoped=true&lang=scss\"; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./ModalDialog.vue?vue&type=style&index=0&id=7f2c764e&scoped=true&lang=scss\"","export { default } from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./d-flow.vue?vue&type=style&index=0&id=01fb80b6&lang=scss&scoped=true\"; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./d-flow.vue?vue&type=style&index=0&id=01fb80b6&lang=scss&scoped=true\"","import EventBus, {\n\tAssetFailureEvent,\n\tCustomAssetFailureEvent,\n} from './eventbus/event-bus';\nimport { ErrorAsset } from './models/error-asset';\nimport { IAsset } from './store/content';\nimport environment from './environments/environment';\n\nlet webpSupportPromise: Promise<boolean>;\nlet heifSupportPromise: Promise<boolean>;\n\nexport function isWebPSupported(): Promise<boolean> {\n\tif (!webpSupportPromise) {\n\t\twebpSupportPromise = new Promise((resolve, reject) => {\n\t\t\tconst losslessCode =\n\t\t\t\t'data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=';\n\t\t\tconst img = document.createElement('img');\n\t\t\timg.addEventListener('load', () => {\n\t\t\t\tresolve(img.width === 2 && img.height === 1);\n\t\t\t});\n\t\t\timg.addEventListener('error', () => {\n\t\t\t\tresolve(false);\n\t\t\t});\n\t\t\timg.src = losslessCode;\n\t\t});\n\t}\n\treturn webpSupportPromise;\n}\n\nexport function isHeifSupported(): Promise<boolean> {\n\tif (!heifSupportPromise) {\n\t\theifSupportPromise = new Promise((resolve, reject) => {\n\t\t\tconst losslessCode =\n\t\t\t\t'data:image/heic;base64,AAAAGGZ0eXBoZWljAAAAAG1pZjFoZWljAAAAsW1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAHBpY3QAXABjAGMAcwBsAGEAAAAADnBpdG0AAAAAAAEAAAAQaWxvYwAAAABEQAAAAAAAI2lpbmYAAAAAAAEAAAAVaW5mZQIAAAAAAQAAaHZjMQAAAABDaXBycAAAACdpcGNvAAAAH2h2Y0NmzGx1ci0AAAAAAABv9HP+//v9bjr3AAAAABRpcG1hAAAAAAAAAAEAAQGBAAAACG1kYXQ=';\n\t\t\tconst img = document.createElement('img');\n\t\t\timg.addEventListener('load', () => {\n\t\t\t\tconsole.log('Heif no error. ' + (img.width === 2 && img.height === 1));\n\t\t\t\tresolve(img.width === 2 && img.height === 1);\n\t\t\t});\n\t\t\timg.addEventListener('error', () => {\n\t\t\t\tconsole.log('Heif not supported');\n\t\t\t\tresolve(false);\n\t\t\t});\n\t\t\timg.src = losslessCode;\n\t\t});\n\t}\n\treturn heifSupportPromise;\n}\n\nconst assetCache: {\n\t[url: string]: Promise<HTMLImageElement | ErrorAsset> | undefined;\n} = {};\nconst customAssets: { [id: string]: Promise<HTMLImageElement> } = {};\n\nexport async function getAAsset(\n\tasset: IAsset,\n\thq: boolean = true\n): Promise<HTMLImageElement | ErrorAsset> {\n\treturn getAssetByUrl(environment.allowLQ && !hq ? asset.lq : asset.hq);\n}\nexport async function getAssetByUrl(\n\turl: string\n): Promise<HTMLImageElement | ErrorAsset> {\n\tif (!assetCache[url]) {\n\t\tassetCache[url] = new Promise((resolve, reject) => {\n\t\t\tconst img = new Image();\n\t\t\timg.addEventListener('load', () => {\n\t\t\t\tresolve(img);\n\t\t\t});\n\t\t\timg.addEventListener('error', () => {\n\t\t\t\tEventBus.fire(new AssetFailureEvent(url));\n\t\t\t\tassetCache[url] = undefined;\n\t\t\t\tresolve(new ErrorAsset());\n\t\t\t});\n\t\t\timg.crossOrigin = 'Anonymous';\n\t\t\timg.src = url;\n\t\t\timg.style.display = 'none';\n\t\t\tdocument.body.appendChild(img);\n\t\t});\n\t}\n\n\treturn assetCache[url]!;\n}\nexport const baseUrl = process.env.BASE_URL === '' ? '.' : process.env.BASE_URL;\n\nexport async function getAsset(\n\tasset: string,\n\thq: boolean = true\n): Promise<HTMLImageElement | ErrorAsset> {\n\tif (customAssets[asset]) {\n\t\treturn customAssets[asset];\n\t}\n\n\tconst url = `${baseUrl}/assets/${asset}${hq ? '' : '.lq'}${\n\t\t(await isWebPSupported()) ? '.webp' : '.png'\n\t}`.replace(/\\/+/, '/');\n\treturn getAssetByUrl(url);\n}\n\nexport function registerAsset(asset: string, file: File): string {\n\tconst url = URL.createObjectURL(file);\n\tcustomAssets[asset] = new Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\t\timg.addEventListener('load', () => {\n\t\t\tresolve(img);\n\t\t});\n\t\timg.addEventListener('error', error => {\n\t\t\tEventBus.fire(new CustomAssetFailureEvent(error));\n\t\t\treject(`Failed to load \"${url}\"`);\n\t\t});\n\t\timg.crossOrigin = 'Anonymous';\n\t\timg.src = url;\n\t\timg.style.display = 'none';\n\t\tdocument.body.appendChild(img);\n\t});\n\treturn url;\n}\n\nexport function registerAssetWithURL(\n\tasset: string,\n\turl: string\n): Promise<HTMLImageElement> {\n\treturn (customAssets[asset] = new Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\t\timg.addEventListener('load', () => {\n\t\t\tresolve(img);\n\t\t});\n\t\timg.addEventListener('error', error => {\n\t\t\tEventBus.fire(new CustomAssetFailureEvent(error));\n\t\t\treject(`Failed to load \"${url}\"`);\n\t\t});\n\t\timg.crossOrigin = 'Anonymous';\n\t\timg.src = url;\n\t\timg.style.display = 'none';\n\t\tdocument.body.appendChild(img);\n\t}));\n}\n","export function exhaust(a: never): never {\n\tthrow new Error(`Unexpected value \"${a}\"`);\n}\n","import { RenderAbortedException } from './renderAbortedException';\nimport { Renderer } from './renderer';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { SpriteFilter } from '@/store/sprite_options';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport type CompositeModes =\n\t| 'source-over'\n\t| 'source-in'\n\t| 'source-out'\n\t| 'source-atop'\n\t| 'destination-over'\n\t| 'destination-in'\n\t| 'destination-out'\n\t| 'destination-atop'\n\t| 'lighter'\n\t| 'copy'\n\t| 'xor'\n\t| 'multiply'\n\t| 'screen'\n\t| 'overlay'\n\t| 'darken'\n\t| 'lighten'\n\t| 'color-dodge'\n\t| 'color-burn'\n\t| 'hard-light'\n\t| 'soft-light'\n\t| 'difference'\n\t| 'exclusion'\n\t| 'hue'\n\t| 'saturation'\n\t| 'color'\n\t| 'luminosity';\n\nexport class RenderContext {\n\tprivate aborted: boolean = false;\n\n\tpublic constructor(\n\t\tpublic fsCtx: CanvasRenderingContext2D,\n\t\tpublic readonly hq: boolean,\n\t\tpublic readonly preview: boolean\n\t) {}\n\n\tpublic drawText(\n\t\tparams: { text: string; align?: CanvasTextAlign; font?: string } & IRPos &\n\t\t\tIOOutline &\n\t\t\tIOFill\n\t) {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tthis.fsCtx.save();\n\n\t\tconst { font, align, x = 0, y = 0, text = '' } = {\n\t\t\t...{\n\t\t\t\tfont: '20px aller',\n\t\t\t\talign: 'left' as CanvasTextAlign,\n\t\t\t},\n\t\t\t...params,\n\t\t};\n\n\t\tthis.fsCtx.lineJoin = 'round';\n\t\tthis.fsCtx.textAlign = align;\n\t\tthis.fsCtx.font = font;\n\n\t\tif (params.outline) {\n\t\t\tthis.fsCtx.strokeStyle = params.outline.style;\n\t\t\tthis.fsCtx.lineWidth = params.outline.width;\n\t\t\tthis.fsCtx.strokeText(text, x, y);\n\t\t}\n\n\t\tif (params.fill) {\n\t\t\tthis.fsCtx.fillStyle = params.fill.style;\n\t\t\tthis.fsCtx.fillText(text, x, y);\n\t\t}\n\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic measureText(\n\t\tparams: {\n\t\t\ttext: string;\n\t\t\talign?: CanvasTextAlign;\n\t\t\tfont?: string;\n\t\t} & IOOutline &\n\t\t\tIOFill\n\t): TextMetrics {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tthis.fsCtx.save();\n\n\t\tconst { font, align, text = '' } = {\n\t\t\t...{\n\t\t\t\tfont: '20px aller',\n\t\t\t\talign: 'left' as CanvasTextAlign,\n\t\t\t},\n\t\t\t...params,\n\t\t};\n\n\t\tthis.fsCtx.lineJoin = 'round';\n\t\tthis.fsCtx.textAlign = align;\n\t\tthis.fsCtx.font = font;\n\n\t\tif (params.outline) {\n\t\t\tthis.fsCtx.strokeStyle = params.outline.style;\n\t\t\tthis.fsCtx.lineWidth = params.outline.width;\n\t\t}\n\n\t\tif (params.fill) {\n\t\t\tthis.fsCtx.fillStyle = params.fill.style;\n\t\t}\n\t\tconst ret = this.fsCtx.measureText(text);\n\t\tthis.fsCtx.restore();\n\t\treturn ret;\n\t}\n\n\tpublic drawImage(\n\t\tparams: {\n\t\t\timage: HTMLImageElement | ErrorAsset | Renderer;\n\t\t\tflip?: boolean;\n\t\t\tcomposite?: CompositeModes;\n\t\t} & IRPos &\n\t\t\tIOSize &\n\t\t\tIOShadow &\n\t\t\tIOFilters\n\t): void {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tif (params.image instanceof ErrorAsset) return;\n\t\tconst { image, flip, x, y, w, h, filters, composite } = {\n\t\t\tflip: false,\n\t\t\tw: params.image.width,\n\t\t\th: params.image.height,\n\t\t\tcomposite: 'source-over' as 'source-over',\n\t\t\t...params,\n\t\t};\n\n\t\tthis.fsCtx.save();\n\t\tthis.fsCtx.globalCompositeOperation = composite;\n\n\t\tif (filters) {\n\t\t\t// Safari fallback\n\t\t\tif (!(('filter' in this.fsCtx) as any)) {\n\t\t\t\tlet opacityCombined = 1;\n\t\t\t\tfor (const filter of filters) {\n\t\t\t\t\tif (filter.type === 'opacity') {\n\t\t\t\t\t\topacityCombined *= filter.value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.fsCtx.globalAlpha = opacityCombined;\n\t\t\t} else {\n\t\t\t\tconst filterList: string[] = [];\n\t\t\t\tfor (const filter of filters) {\n\t\t\t\t\tif (filter.type === 'drop-shadow') {\n\t\t\t\t\t\tfilterList.push(\n\t\t\t\t\t\t\t`drop-shadow(${filter.offsetX}px ${filter.offsetY}px ${filter.blurRadius}px ${filter.color})`\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if (filter.type === 'hue-rotate') {\n\t\t\t\t\t\tfilterList.push(`hue-rotate(${filter.value}deg)`);\n\t\t\t\t\t} else if (filter.type === 'blur') {\n\t\t\t\t\t\tfilterList.push(`blur(${filter.value}px)`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfilterList.push(`${filter.type}(${filter.value * 100}%)`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.fsCtx.filter = filterList.join(' ');\n\t\t\t}\n\t\t}\n\n\t\tif (params.shadow) {\n\t\t\tconst shadow = params.shadow;\n\t\t\tif (shadow.color) {\n\t\t\t\tthis.fsCtx.shadowColor = shadow.color;\n\t\t\t}\n\t\t\tif (shadow.blur) {\n\t\t\t\tthis.fsCtx.shadowBlur = shadow.blur;\n\t\t\t}\n\t\t\tif (shadow.offsetX) {\n\t\t\t\tthis.fsCtx.shadowOffsetX = shadow.offsetX;\n\t\t\t}\n\t\t\tif (shadow.offsetY) {\n\t\t\t\tthis.fsCtx.shadowOffsetY = shadow.offsetY;\n\t\t\t}\n\t\t}\n\n\t\tthis.fsCtx.translate(x + w / 2, y + h / 2);\n\t\tthis.fsCtx.scale(flip ? -1 : 1, 1);\n\n\t\tif (image instanceof Renderer) {\n\t\t\timage.paintOnto(this.fsCtx, -w / 2, -h / 2, w, h);\n\t\t} else {\n\t\t\tthis.fsCtx.drawImage(image as HTMLImageElement, -w / 2, -h / 2, w, h);\n\t\t}\n\n\t\tthis.fsCtx.restore();\n\t\tthis.fsCtx.globalCompositeOperation = 'source-over';\n\t}\n\n\tpublic drawRect({\n\t\tx,\n\t\ty,\n\t\tw,\n\t\th,\n\t\toutline,\n\t\tfill,\n\t\tcomposition,\n\t}: IRPos & IRSize & IOOutline & IOFill & IOComposition) {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tthis.fsCtx.save();\n\t\tthis.fsCtx.beginPath();\n\t\tthis.fsCtx.rect(x, y, w, h);\n\n\t\tif (composition) {\n\t\t\tthis.fsCtx.globalCompositeOperation = composition;\n\t\t}\n\n\t\tif (fill) {\n\t\t\tthis.fsCtx.fillStyle = fill.style;\n\t\t\tthis.fsCtx.fill();\n\t\t}\n\t\tif (outline) {\n\t\t\tthis.fsCtx.strokeStyle = outline.style;\n\t\t\tthis.fsCtx.lineWidth = outline.width;\n\t\t\tthis.fsCtx.stroke();\n\t\t}\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic drawPath({\n\t\toutline,\n\t\tfill,\n\t\tpath,\n\t}: { path: (ctx: CanvasPath) => void } & IOOutline & IOFill) {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tthis.fsCtx.save();\n\t\tthis.fsCtx.beginPath();\n\t\tpath(this.fsCtx);\n\n\t\tif (fill) {\n\t\t\tthis.fsCtx.fillStyle = fill.style;\n\t\t\tthis.fsCtx.fill();\n\t\t}\n\t\tif (outline) {\n\t\t\tthis.fsCtx.strokeStyle = outline.style;\n\t\t\tthis.fsCtx.lineWidth = outline.width;\n\t\t\tthis.fsCtx.stroke();\n\t\t}\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic patternFrom(\n\t\timage: HTMLImageElement | Renderer,\n\t\trepetition: 'repeat' | 'repeat-x' | 'repeat-y' | 'no-repeat' = 'repeat'\n\t): CanvasPattern {\n\t\tif (image instanceof Renderer) {\n\t\t\timage = (image as any).previewCanvas;\n\t\t}\n\t\treturn this.fsCtx.createPattern(\n\t\t\t(image as any) as CanvasImageSource,\n\t\t\trepetition\n\t\t)!;\n\t}\n\n\tpublic customTransform(\n\t\ttransform: (transformContext: CanvasRenderingContext2D) => void,\n\t\trender: (rx: RenderContext) => void\n\t) {\n\t\tthis.fsCtx.save();\n\t\ttransform(this.fsCtx);\n\t\trender(this);\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic linearGradient(\n\t\tx0: number,\n\t\ty0: number,\n\t\tx1: number,\n\t\ty1: number\n\t): CanvasGradient {\n\t\treturn this.fsCtx.createLinearGradient(x0, y0, x1, y1);\n\t}\n\n\tpublic abort(): void {\n\t\tthis.aborted = true;\n\t}\n}\n\nexport interface IShadow {\n\tblur?: number;\n\tcolor?: string;\n\toffsetX?: number;\n\toffsetY?: number;\n}\n\nexport interface IOutline {\n\tstyle: string;\n\twidth: number;\n}\n\nexport interface IFill {\n\tstyle: string | CanvasGradient | CanvasPattern;\n}\n\ninterface IOShadow {\n\tshadow?: IShadow;\n}\n\ninterface IOComposition {\n\tcomposition?: CompositeModes;\n}\n\ninterface IRPos {\n\tx: number;\n\ty: number;\n}\n\ninterface IRSize {\n\tw: number;\n\th: number;\n}\n\ninterface IOSize {\n\tw?: number;\n\th?: number;\n}\n\ninterface IOOutline {\n\toutline?: IOutline;\n}\ninterface IOFilters {\n\tfilters?: DeepReadonly<SpriteFilter[]>;\n}\n\ninterface IOFill {\n\tfill?: IFill;\n}\n","export { default } from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./settings.vue?vue&type=style&index=0&id=2a0abeea&lang=scss&scoped=true\"; export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./settings.vue?vue&type=style&index=0&id=2a0abeea&lang=scss&scoped=true\"","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./layers.vue?vue&type=style&index=0&id=90b83fd8&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./layers.vue?vue&type=style&index=0&id=90b83fd8&lang=scss&scoped=true\"","export class RenderAbortedException {}\n","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./credits.vue?vue&type=style&index=0&id=8abb847e&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./credits.vue?vue&type=style&index=0&id=8abb847e&lang=scss&scoped=true\"","export class ErrorAsset {}\n","export { default } from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&lang=scss\"; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&lang=scss\"","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./poem.vue?vue&type=style&index=0&id=51b46526&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./poem.vue?vue&type=style&index=0&id=51b46526&lang=scss&scoped=true\"","import { ComponentOptionsMixin } from 'vue';\n\nconst firefoxDeltaFactor = 25;\n\nexport const VerticalScrollRedirect: ComponentOptionsMixin = {\n\tmethods: {\n\t\tverticalScrollRedirect(e: WheelEvent) {\n\t\t\tif (e.type !== 'wheel') return;\n\t\t\tif (!e.currentTarget) return;\n\t\t\tconst currentTarget = e.currentTarget as HTMLElement;\n\t\t\tconst target = getComputedStyle(currentTarget);\n\n\t\t\tconst ev = e as WheelEvent;\n\t\t\tif (ev.deltaY === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (target.overflowY === 'auto') {\n\t\t\t\tif (ev.deltaY > 0) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tcurrentTarget.scrollHeight >\n\t\t\t\t\t\tcurrentTarget.scrollTop + currentTarget.clientHeight\n\t\t\t\t\t) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (currentTarget.scrollTop > 0) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst oldScrollLeft = currentTarget.scrollLeft;\n\t\t\tif ((ev as any).mozInputSource) {\n\t\t\t\t// Firefox sends wierdly low delta values :/\n\t\t\t\tcurrentTarget.scrollLeft += ev.deltaY * firefoxDeltaFactor;\n\t\t\t} else {\n\t\t\t\tcurrentTarget.scrollLeft += ev.deltaY;\n\t\t\t}\n\t\t\tif (currentTarget.scrollLeft !== oldScrollLeft) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t},\n\t},\n};\n","<template>\r\n\t<div class=\"fieldset_wrapper\">\r\n\t\t<fieldset>\r\n\t\t\t<legend v-if=\"title > ''\">{{ title }}</legend>\r\n\t\t\t<div class=\"fieldset_contents\">\r\n\t\t\t\t<slot />\r\n\t\t\t</div>\r\n\t\t</fieldset>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue';\r\nexport default defineComponent({\r\n\tprops: {\r\n\t\ttitle: {\r\n\t\t\trequired: true,\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t},\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.fieldset_contents {\r\n\tmargin-top: 0.5em;\r\n\theight: calc(100% - 0.5em);\r\n}\r\n\r\nlegend {\r\n\tline-height: 0px;\r\n}\r\n\r\nfieldset {\r\n\tborder: 3px solid #ffbde1;\r\n\theight: 100%;\r\n}\r\n.fieldset_wrapper {\r\n\tpadding-top: 0.5em;\r\n}\r\n</style>\r\n","\r\nimport { defineComponent } from 'vue';\r\nexport default defineComponent({\r\n\tprops: {\r\n\t\ttitle: {\r\n\t\t\trequired: true,\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t},\r\n});\r\n","import { render } from \"./d-fieldset.vue?vue&type=template&id=779c4f22&scoped=true&bindings={}\"\nimport script from \"./d-fieldset.vue?vue&type=script&lang=ts\"\nexport * from \"./d-fieldset.vue?vue&type=script&lang=ts\"\n\nimport \"./d-fieldset.vue?vue&type=style&index=0&id=779c4f22&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-779c4f22\"\n\nexport default script","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./character.vue?vue&type=style&index=0&id=6d0ef99f&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./character.vue?vue&type=style&index=0&id=6d0ef99f&lang=scss&scoped=true\"","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./settings.vue?vue&type=style&index=0&id=4dea3924&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./settings.vue?vue&type=style&index=0&id=4dea3924&lang=scss&scoped=true\"","import { ICommand } from '@/eventbus/command';\nimport {\n\tIObjectsState,\n\tICreateObjectMutation,\n\tIObject,\n\tISetPositionAction,\n\tISetObjectPositionMutation,\n\tIRemoveObjectAction,\n} from '@/store/objects';\nimport { MutationTree, ActionTree, Store, Commit, ActionContext } from 'vuex';\nimport { characterPositions } from '@/constants/base';\nimport { arraySeeker } from '@/models/seekers';\nimport { IHistoryOptions } from '@/plugins/vuex-history';\nimport {\n\tCharacter,\n\tPose,\n\tHeadCollection,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '../content';\nimport { IRootState } from '..';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport interface ICharacter extends IObject {\n\ttype: 'character';\n\tcharacterType: string;\n\tfreeMove: boolean;\n\tclose: boolean;\n\tstyleGroupId: number;\n\tstyleId: number;\n\tposeId: number;\n\tposePositions: {\n\t\t[id: string]: number;\n\t};\n}\n\nexport const CloseUpYOffset = -74;\nexport const BaseCharacterYPos = -26;\n\nexport const characterMutations: MutationTree<IObjectsState> = {\n\tsetPose(state, command: ISetPoseMutation) {\n\t\tconst obj = state.objects[command.id] as ICharacter;\n\t\tobj.poseId = command.poseId;\n\t\t++obj.version;\n\t},\n\tsetCharStyleGroup(state, { id, styleGroupId }: ISetCharStyleGroupMutation) {\n\t\tconst obj = state.objects[id] as ICharacter;\n\t\tobj.styleGroupId = styleGroupId;\n\t\t++obj.version;\n\t},\n\tsetCharStyle(state, { id, styleId }: ISetCharStyleMutation) {\n\t\tconst obj = state.objects[id] as ICharacter;\n\t\tobj.styleId = styleId;\n\t\t++obj.version;\n\t},\n\tsetPosePosition(state, command: ISetPosePositionMutation) {\n\t\tconst obj = state.objects[command.id] as ICharacter;\n\t\tobj.posePositions = {\n\t\t\t...obj.posePositions,\n\t\t\t...command.posePositions,\n\t\t};\n\t\t++obj.version;\n\t},\n\tsetClose(state, command: ISetCloseMutation) {\n\t\tconst obj = state.objects[command.id] as ICharacter;\n\t\tobj.close = command.close;\n\t\t++obj.version;\n\t},\n\tsetFreeMove(state, command: ISetFreeMoveMutation) {\n\t\tconst obj = state.objects[command.id] as ICharacter;\n\t\tobj.freeMove = command.freeMove;\n\t\tif (!obj.freeMove) {\n\t\t\tobj.x = characterPositions[closestCharacterSlot(obj.x)];\n\t\t\tobj.y = BaseCharacterYPos;\n\t\t}\n\t},\n};\n\nexport function getData(\n\tstore: Store<DeepReadonly<IRootState>>,\n\tstate: DeepReadonly<ICharacter>\n): DeepReadonly<Character<IAsset>> {\n\tconst characters = store.getters['content/getCharacters'] as Map<\n\t\tCharacter<IAsset>['id'],\n\t\tCharacter<IAsset>\n\t>;\n\treturn characters.get(state.characterType)!;\n}\n\nexport function getDataG(\n\trootGetters: any,\n\tstate: Readonly<ICharacter>\n): Readonly<Character<IAsset>> {\n\tconst characters = rootGetters['content/getCharacters'] as Map<\n\t\tCharacter<IAsset>['id'],\n\t\tCharacter<IAsset>\n\t>;\n\treturn characters.get(state.characterType)!;\n}\n\nexport function getPose(\n\tdata: DeepReadonly<Character<IAsset>>,\n\tstate: DeepReadonly<ICharacter>\n): DeepReadonly<Pose<IAsset>> {\n\treturn data.styleGroups[state.styleGroupId].styles[state.styleId].poses[\n\t\tstate.poseId\n\t];\n}\n\nexport function getParts(\n\tdata: DeepReadonly<Character<IAsset>>,\n\tstate: DeepReadonly<ICharacter>\n): DeepReadonly<string[]> {\n\tconst pose = getPose(data, state);\n\tconst positionKeys = [\n\t\t...Object.keys(pose.positions).filter(\n\t\t\tpositionKey => pose.positions[positionKey].length > 1\n\t\t),\n\t];\n\tif (pose.compatibleHeads.length > 0) positionKeys.unshift('head');\n\treturn positionKeys;\n}\n\nexport function getHeads(\n\tdata: DeepReadonly<Character<IAsset>>,\n\tstate: DeepReadonly<ICharacter>,\n\theadTypeId: number = state.posePositions.headType || 0\n): DeepReadonly<HeadCollection<IAsset>> | null {\n\tconst compatibleHeads = getPose(data, state).compatibleHeads;\n\tif (!compatibleHeads || compatibleHeads.length === 0) {\n\t\treturn null;\n\t}\n\tconst heads = data.heads[compatibleHeads[headTypeId]];\n\treturn heads;\n}\n\nexport function closestCharacterSlot(pos: number): number {\n\tconst sorted = characterPositions\n\t\t.map((x, idx) => ({ pos: Math.abs(pos - x), idx }))\n\t\t.sort((a, b) => a.pos - b.pos);\n\treturn sorted[0].idx;\n}\n\nlet lastSpriteId = 0;\n\nexport const characterActions: ActionTree<IObjectsState, IRootState> = {\n\tcreateCharacters({ rootState, commit }, command: ICreateCharacterAction) {\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\tflip: false,\n\t\t\t\tid: 'characters_' + ++lastSpriteId,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tonTop: false,\n\t\t\t\topacity: 100,\n\t\t\t\ttype: 'character',\n\t\t\t\tx: 640,\n\t\t\t\ty: BaseCharacterYPos,\n\t\t\t\tpreserveRatio: true,\n\t\t\t\tratio: 1,\n\t\t\t\theight: 768,\n\t\t\t\twidth: 768,\n\t\t\t\tcharacterType: command.characterType,\n\t\t\t\tclose: false,\n\t\t\t\tfreeMove: false,\n\t\t\t\tversion: 0,\n\t\t\t\tposeId: 0,\n\t\t\t\tstyleId: 0,\n\t\t\t\tstyleGroupId: 0,\n\t\t\t\tposePositions: {},\n\t\t\t\tcomposite: 'source-over',\n\t\t\t\tfilters: [],\n\t\t\t} as ICharacter,\n\t\t} as ICreateObjectMutation);\n\t},\n\n\tseekPart(\n\t\t{ state, commit, dispatch, rootGetters },\n\t\t{ delta, id, part }: ISeekPosePartAction\n\t) {\n\t\tif (part === 'head') {\n\t\t\tdispatch('seekHead', { id, delta } as ISeekHeadAction);\n\t\t\treturn;\n\t\t}\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst pose = getPose(getDataG(rootGetters, obj), obj);\n\t\tif (!pose.positions[part]) return;\n\t\tcommit('setPosePosition', {\n\t\t\tid,\n\t\t\tposePositions: {\n\t\t\t\t[part]: arraySeeker(\n\t\t\t\t\tpose.positions[part],\n\t\t\t\t\tobj.posePositions[part] || 0,\n\t\t\t\t\tdelta\n\t\t\t\t),\n\t\t\t},\n\t\t} as ISetPosePositionMutation);\n\t},\n\n\tseekPose({ state, commit, rootGetters }, { id, delta }: ISeekPoseAction) {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj);\n\t\tconst poses = data.styleGroups[obj.styleGroupId].styles[obj.styleId].poses;\n\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\tchange.poseId = arraySeeker(poses, change.poseId, delta);\n\t\t});\n\t},\n\n\tseekStyle({ state, commit, rootGetters }, { id, delta }: ISeekStyleAction) {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj);\n\t\tconst linearStyles = data.styleGroups\n\t\t\t.flatMap((styleGroup, styleGroupIdx) => {\n\t\t\t\treturn styleGroup.styles.map((style, styleIdx) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstyleGroupIdx,\n\t\t\t\t\t\tstyleIdx,\n\t\t\t\t\t\tstyleGroupJson: JSON.stringify(style.components),\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t})\n\t\t\t.sort((styleA, styleB) =>\n\t\t\t\tstyleA.styleGroupJson.localeCompare(styleB.styleGroupJson)\n\t\t\t);\n\t\tconst linearIdx = linearStyles.findIndex(\n\t\t\tstyle =>\n\t\t\t\tstyle.styleGroupIdx === obj.styleGroupId &&\n\t\t\t\tstyle.styleIdx === obj.styleId\n\t\t);\n\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\tconst nextIdx = arraySeeker(linearStyles, linearIdx, delta);\n\t\t\tconst style = linearStyles[nextIdx];\n\t\t\tchange.styleGroupId = style.styleGroupIdx;\n\t\t\tchange.styleId = style.styleIdx;\n\t\t});\n\t},\n\n\tseekHead({ state, commit, rootGetters }, { id, delta }: ISeekHeadAction) {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj);\n\t\tconst pose = getPose(data, obj);\n\t\tlet currentHeads = getHeads(data, obj);\n\t\tif (!currentHeads) return;\n\t\tlet head = (obj.posePositions.head || 0) + delta;\n\t\tlet headType = obj.posePositions.headType || 0;\n\t\tif (head < 0 || head >= currentHeads.variants.length) {\n\t\t\theadType = arraySeeker(\n\t\t\t\tpose.compatibleHeads.map(headKey => data.heads[headKey]),\n\t\t\t\theadType,\n\t\t\t\tdelta\n\t\t\t);\n\t\t\tcurrentHeads = getHeads(data, obj, headType)!;\n\t\t\thead = delta === 1 ? 0 : currentHeads.variants.length - 1;\n\t\t}\n\t\tcommit('setPosePosition', {\n\t\t\tid,\n\t\t\tposePositions: {\n\t\t\t\thead,\n\t\t\t\theadType,\n\t\t\t},\n\t\t} as ISetPosePositionMutation);\n\t},\n\n\tsetPart(\n\t\t{ state, commit, rootGetters },\n\t\t{ id, part, val }: ISetPartAction\n\t): void {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj);\n\t\tif (part === 'pose') {\n\t\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\t\tchange.poseId = val;\n\t\t\t});\n\t\t} else if (part === 'style') {\n\t\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\t\tchange.styleId = val;\n\t\t\t});\n\t\t} else {\n\t\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\t\tchange.posePositions[part] = val;\n\t\t\t});\n\t\t}\n\t},\n\n\tsetCharStyle(\n\t\t{ state, commit, rootGetters },\n\t\t{ id, styleGroupId, styleId }: ISetStyleAction\n\t) {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj);\n\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\tchange.styleGroupId = styleGroupId;\n\t\t\tchange.styleId = styleId;\n\t\t});\n\t},\n\n\tsetCharacterPosition(\n\t\t{ state, commit },\n\t\t{ id, x, y }: ISetPositionAction\n\t): void {\n\t\tconst obj = state.objects[id] as ICharacter;\n\t\tif (obj.freeMove) {\n\t\t\tcommit('setPosition', {\n\t\t\t\tid,\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t} as ISetObjectPositionMutation);\n\t\t} else {\n\t\t\tcommit('setPosition', {\n\t\t\t\tid,\n\t\t\t\tx: characterPositions[closestCharacterSlot(x)],\n\t\t\t\ty: BaseCharacterYPos + (obj.close ? CloseUpYOffset : 0),\n\t\t\t} as ISetObjectPositionMutation);\n\t\t}\n\t},\n\n\tshiftCharacterSlot(\n\t\t{ state, commit },\n\t\t{ id, delta }: IShiftCharacterSlotAction\n\t): void {\n\t\tconst obj = state.objects[id] as ICharacter;\n\t\tconst currentSlotNr = closestCharacterSlot(obj.x);\n\t\tlet newSlotNr = currentSlotNr + delta;\n\t\tif (newSlotNr < 0) {\n\t\t\tnewSlotNr = 0;\n\t\t}\n\t\tif (newSlotNr >= characterPositions.length) {\n\t\t\tnewSlotNr = characterPositions.length - 1;\n\t\t}\n\t\tcommit('setPosition', {\n\t\t\tid,\n\t\t\tx: characterPositions[newSlotNr],\n\t\t\ty: obj.y,\n\t\t} as ISetObjectPositionMutation);\n\t},\n};\n\nexport async function fixContentPackRemovalFromCharacter(\n\tcontext: ActionContext<IObjectsState, IRootState>,\n\tid: string,\n\toldPack: ContentPack<IAsset>\n) {\n\tconst obj = context.state.objects[id] as ICharacter;\n\tconst oldCharData = oldPack.characters.find(\n\t\tchar => char.id === obj.characterType\n\t);\n\tif (!oldCharData) {\n\t\tconsole.error('Character data is missing. Dropping the character.');\n\t\tcontext.dispatch('removeObject', {\n\t\t\tid,\n\t\t} as IRemoveObjectAction);\n\t\treturn;\n\t}\n\tconst poseAndPositionChange = buildPoseAndPositionData(obj);\n\tconst oldStyleGroup = oldCharData.styleGroups[obj.styleGroupId];\n\tconst oldStyle = oldStyleGroup.styles[poseAndPositionChange.styleId];\n\tconst oldPose = oldStyle.poses[poseAndPositionChange.poseId];\n\n\tconst newCharData = context.rootState.content.current.characters.find(\n\t\tchr => chr.id === oldCharData.id\n\t);\n\tif (!newCharData) {\n\t\tconsole.error('Character data is missing. Dropping the character.');\n\t\tcontext.dispatch('removeObject', {\n\t\t\tid,\n\t\t} as IRemoveObjectAction);\n\t\treturn;\n\t}\n\tconst newStyleGroupIdx = newCharData.styleGroups.findIndex(\n\t\tstyleGroup => styleGroup.id === oldStyleGroup.id\n\t);\n\tposeAndPositionChange.styleGroupId =\n\t\tnewStyleGroupIdx === -1 ? 0 : newStyleGroupIdx;\n\n\tconst newStyleGroup =\n\t\tnewCharData.styleGroups[poseAndPositionChange.styleGroupId];\n\tconst styleProperies = JSON.stringify(oldStyle.components);\n\tconst newStyleIdx = newStyleGroup.styles.findIndex(\n\t\tstyle => JSON.stringify(style.components) === styleProperies\n\t);\n\tposeAndPositionChange.styleId = newStyleIdx === -1 ? 0 : newStyleIdx;\n\n\tconst newStyle = newStyleGroup.styles[poseAndPositionChange.styleId];\n\tconst newPoseIdx = newStyle.poses.findIndex(pose => pose.id === oldPose.id);\n\tposeAndPositionChange.poseId = newPoseIdx === -1 ? 0 : newPoseIdx;\n\n\t// Styles and poses have been restored. Proceding with pose parts\n\tconst newPose = newStyle.poses[poseAndPositionChange.poseId];\n\n\tconst newPosePositions: ICharacter['posePositions'] = {};\n\n\tfor (const key in newPose.positions) {\n\t\tif (!newPose.positions.hasOwnProperty(key)) continue;\n\t\tconst newPosition = newPose.positions[key];\n\n\t\tif (oldPose.positions[key]) {\n\t\t\tconst oldPositionIdx = poseAndPositionChange.posePositions[key];\n\t\t\tif (oldPositionIdx >= 0 && oldPositionIdx < newPosition.length) {\n\t\t\t\tnewPosePositions[key] = oldPositionIdx;\n\t\t\t} else {\n\t\t\t\tnewPosePositions[key] = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tnewPosePositions[key] = 0;\n\t\t}\n\t}\n\n\tconst oldHeadGroup = oldPose.compatibleHeads[obj.posePositions.headType];\n\tconst newHeadGroupIdx = newPose.compatibleHeads.indexOf(oldHeadGroup);\n\n\tif (newHeadGroupIdx === -1) {\n\t\tposeAndPositionChange.posePositions.headType = 0;\n\t\tposeAndPositionChange.posePositions.head = 0;\n\t} else {\n\t\tif (newHeadGroupIdx !== obj.posePositions.headType) {\n\t\t\tposeAndPositionChange.posePositions.headType = newHeadGroupIdx;\n\t\t}\n\t\tconst oldHead = JSON.stringify(\n\t\t\toldCharData.heads[oldHeadGroup].variants[obj.posePositions.head]\n\t\t);\n\t\tconst newHeadIdx = newCharData.heads[oldHeadGroup].variants.findIndex(\n\t\t\tvariant => JSON.stringify(variant) === oldHead\n\t\t);\n\t\tif (newHeadIdx === -1) {\n\t\t\tposeAndPositionChange.posePositions.head = 0;\n\t\t} else {\n\t\t\tposeAndPositionChange.posePositions.head = newHeadIdx;\n\t\t}\n\t}\n\n\tcommitPoseAndPositionChanges(context.commit, obj, poseAndPositionChange);\n}\n\nexport const propertyOptions: IHistoryOptions = {\n\tmutations: {\n\t\tsetPosePosition: {\n\t\t\tcombinable: (oldMut, newMut) => oldMut.payload.id === newMut.payload.id,\n\t\t\tcombinator: (oldMut, newMut) => ({\n\t\t\t\ttype: newMut.type,\n\t\t\t\tpayload: {\n\t\t\t\t\tid: newMut.payload.id,\n\t\t\t\t\tposePositions: {\n\t\t\t\t\t\t...oldMut.payload.posePositions,\n\t\t\t\t\t\t...newMut.payload.posePositions,\n\t\t\t\t\t},\n\t\t\t\t} as ISetPosePositionMutation,\n\t\t\t}),\n\t\t},\n\t},\n};\n\nfunction buildPoseAndPositionData(\n\tcharacter: Readonly<ICharacter>\n): PoseAndPositionChange {\n\treturn {\n\t\tstyleGroupId: character.styleGroupId,\n\t\tstyleId: character.styleId,\n\t\tposeId: character.poseId,\n\t\tposePositions: { ...character.posePositions },\n\t};\n}\n\nfunction commitPoseAndPositionChanges(\n\tcommit: Commit,\n\tcharacter: Readonly<ICharacter>,\n\tposeAndPosition: PoseAndPositionChange\n) {\n\tif (poseAndPosition.styleGroupId !== character.styleGroupId) {\n\t\tcommit('setCharStyleGroup', {\n\t\t\tid: character.id,\n\t\t\tstyleGroupId: poseAndPosition.styleGroupId,\n\t\t} as ISetCharStyleGroupMutation);\n\t}\n\tif (poseAndPosition.styleId !== character.styleId) {\n\t\tconsole.log(\n\t\t\t`Setting style of ${character.id} to ${poseAndPosition.styleId}`\n\t\t);\n\t\tcommit('setCharStyle', {\n\t\t\tid: character.id,\n\t\t\tstyleId: poseAndPosition.styleId,\n\t\t} as ISetCharStyleMutation);\n\t}\n\tif (poseAndPosition.poseId !== character.poseId) {\n\t\tcommit('setPose', {\n\t\t\tid: character.id,\n\t\t\tposeId: poseAndPosition.poseId,\n\t\t} as ISetPoseMutation);\n\t}\n\tif (\n\t\tJSON.stringify(poseAndPosition.posePositions) !==\n\t\tJSON.stringify(character.posePositions)\n\t) {\n\t\tcommit('setPosePosition', {\n\t\t\tid: character.id,\n\t\t\tposePositions: poseAndPosition.posePositions,\n\t\t} as ISetPosePositionMutation);\n\t}\n}\n\nfunction mutatePoseAndPositions(\n\tcommit: Commit,\n\tcharacter: Readonly<ICharacter>,\n\tdata: Character<IAsset>,\n\tcallback: (change: PoseAndPositionChange) => void\n) {\n\tconst poseAndPosition = buildPoseAndPositionData(character);\n\tcallback(poseAndPosition);\n\n\tif (!data.styleGroups[poseAndPosition.styleGroupId]) {\n\t\tposeAndPosition.styleGroupId = 0;\n\t}\n\tconst styleGroup = data.styleGroups[poseAndPosition.styleGroupId];\n\n\tif (!styleGroup.styles[poseAndPosition.styleId]) {\n\t\tposeAndPosition.styleId = 0;\n\t}\n\tconst style = styleGroup.styles[poseAndPosition.styleId];\n\n\t// ensure pose integrity\n\tif (!style.poses[poseAndPosition.poseId]) {\n\t\tposeAndPosition.poseId = 0;\n\t}\n\tconst pose = style.poses[poseAndPosition.poseId];\n\n\tfor (const positionKey in pose.positions) {\n\t\tif (!pose.positions[positionKey]) continue;\n\t\tif (\n\t\t\t!pose.positions[positionKey][poseAndPosition.posePositions[positionKey]]\n\t\t) {\n\t\t\tposeAndPosition.posePositions[positionKey] = 0;\n\t\t}\n\t}\n\n\t// restore head group\n\tconst oldPose =\n\t\tdata.styleGroups[character.styleGroupId].styles[character.styleId].poses[\n\t\t\tcharacter.poseId\n\t\t];\n\tconst oldHeadCollection =\n\t\toldPose.compatibleHeads[character.posePositions.headType || 0];\n\tconst newHeadCollectionNr = pose.compatibleHeads.indexOf(oldHeadCollection);\n\tif (newHeadCollectionNr >= 0) {\n\t\tposeAndPosition.posePositions.headType = newHeadCollectionNr;\n\t} else {\n\t\tposeAndPosition.posePositions.headType = 0;\n\t\tposeAndPosition.posePositions.head = 0;\n\t}\n\n\tcommitPoseAndPositionChanges(commit, character, poseAndPosition);\n}\n\ninterface PoseAndPositionChange {\n\tstyleGroupId: ICharacter['styleGroupId'];\n\tstyleId: ICharacter['styleId'];\n\tposeId: ICharacter['poseId'];\n\tposePositions: ICharacter['posePositions'];\n}\n\nexport interface ISetPoseMutation extends ICommand {\n\treadonly poseId: number;\n}\n\nexport interface ISetCharStyleGroupMutation extends ICommand {\n\treadonly styleGroupId: number;\n}\n\nexport interface ISetCharStyleMutation extends ICommand {\n\treadonly styleId: number;\n}\n\nexport interface ISetPosePositionMutation extends ICommand {\n\treadonly posePositions: {\n\t\t[id: string]: number;\n\t};\n}\n\nexport interface ISetFreeMoveMutation extends ICommand {\n\treadonly freeMove: boolean;\n}\n\nexport interface ISetCloseMutation extends ICommand {\n\treadonly close: boolean;\n}\n\nexport interface ICreateCharacterAction {\n\treadonly characterType: string;\n}\n\nexport interface ISeekPoseAction extends ICommand {\n\treadonly delta: -1 | 1;\n}\n\nexport interface ISeekStyleAction extends ICommand {\n\treadonly delta: -1 | 1;\n}\n\nexport interface ISeekHeadAction extends ICommand {\n\treadonly delta: -1 | 1;\n}\n\nexport interface ISetPartAction extends ICommand {\n\treadonly part: string;\n\treadonly val: number;\n}\n\nexport interface ISetStyleAction extends ICommand {\n\treadonly styleGroupId: number;\n\treadonly styleId: number;\n}\n\nexport interface INsfwCheckAction extends ICommand {}\n\nexport interface ISeekPosePartAction extends ICommand {\n\treadonly part: string;\n\treadonly delta: -1 | 1;\n}\n\nexport interface ISetSpriteSizeMutation extends ICommand {\n\treadonly width: number;\n\treadonly height: number;\n}\n\nexport interface ISetSpriteRatioMutation extends ICommand {\n\treadonly preserveRatio: boolean;\n\treadonly ratio: number;\n}\n\nexport interface ISetSpriteWidthAction extends ICommand {\n\treadonly width: number;\n}\n\nexport interface ISetSpriteHeightAction extends ICommand {\n\treadonly height: number;\n}\n\nexport interface ISetSpriteRatioAction extends ICommand {\n\treadonly preserveRatio: boolean;\n}\n\nexport interface ICreateSpriteAction extends ICommand {\n\treadonly assetName: string;\n}\n\nexport interface IShiftCharacterSlotAction extends ICommand {\n\treadonly delta: -1 | 1;\n}\n","<template>\r\n\t<div>\r\n\t\t<input :id=\"_.uid\" type=\"checkbox\" ref=\"checkbox\" v-model=\"value\" />\r\n\t\t<label :for=\"_.uid\" class=\"switch\"></label>\r\n\t\t<label :for=\"_.uid\">{{ label }}</label>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue';\r\n\r\nexport default defineComponent({\r\n\tprops: {\r\n\t\tlabel: String,\r\n\t\tmodelValue: { type: Boolean, default: false },\r\n\t},\r\n\tcomputed: {\r\n\t\tvalue: {\r\n\t\t\tget(): boolean {\r\n\t\t\t\treturn this.modelValue;\r\n\t\t\t},\r\n\t\t\tset(value: boolean) {\r\n\t\t\t\tthis.$emit('update:modelValue', value);\r\n\t\t\t},\r\n\t\t},\r\n\t\tcheckbox(): HTMLInputElement {\r\n\t\t\treturn this.$refs.checkbox as HTMLInputElement;\r\n\t\t},\r\n\t},\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\ndiv {\r\n\toverflow: visible;\r\n}\r\n\r\n/* The switch - the box around the slider */\r\n.switch {\r\n\theight: 20px;\r\n\twidth: 20px;\r\n\tdisplay: inline-block;\r\n\tbackground: url('./toggle/inactive.svg');\r\n\tbackground-size: cover;\r\n\tvertical-align: text-bottom;\r\n}\r\n\r\n/* Hide default HTML checkbox */\r\ninput {\r\n\topacity: 0;\r\n\twidth: 0;\r\n\theight: 0;\r\n\tposition: absolute;\r\n\tpointer-events: none;\r\n}\r\n\r\ninput:checked + .switch {\r\n\tbackground: url('./toggle/active.svg');\r\n\tbackground-size: cover;\r\n}\r\n</style>\r\n","\r\nimport { defineComponent } from 'vue';\r\n\r\nexport default defineComponent({\r\n\tprops: {\r\n\t\tlabel: String,\r\n\t\tmodelValue: { type: Boolean, default: false },\r\n\t},\r\n\tcomputed: {\r\n\t\tvalue: {\r\n\t\t\tget(): boolean {\r\n\t\t\t\treturn this.modelValue;\r\n\t\t\t},\r\n\t\t\tset(value: boolean) {\r\n\t\t\t\tthis.$emit('update:modelValue', value);\r\n\t\t\t},\r\n\t\t},\r\n\t\tcheckbox(): HTMLInputElement {\r\n\t\t\treturn this.$refs.checkbox as HTMLInputElement;\r\n\t\t},\r\n\t},\r\n});\r\n","import { render } from \"./toggle.vue?vue&type=template&id=5ca7fb80&scoped=true&bindings={}\"\nimport script from \"./toggle.vue?vue&type=script&lang=ts\"\nexport * from \"./toggle.vue?vue&type=script&lang=ts\"\n\nimport \"./toggle.vue?vue&type=style&index=0&id=5ca7fb80&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-5ca7fb80\"\n\nexport default script","import { DeepReadonly } from '@/util/readonly';\n\nexport function arraySeeker(\n\tarray: DeepReadonly<any[]>,\n\tpos: number,\n\tdelta: number\n) {\n\tlet val = pos + delta;\n\tconst length = array.length;\n\n\tif (val < 0) {\n\t\tval += length;\n\t}\n\tif (val >= length) {\n\t\tval -= length;\n\t}\n\treturn val;\n}\n\nexport function nsfwArraySeeker(\n\tarray: Array<{ nsfw?: boolean }>,\n\tpos: number,\n\tdelta: number,\n\tnsfw: boolean\n) {\n\tlet val = pos;\n\tconst length = array.length;\n\tdo {\n\t\tval += delta;\n\t\tif (val < 0) {\n\t\t\tval += length;\n\t\t}\n\t\tif (val >= length) {\n\t\t\tval -= length;\n\t\t}\n\t} while (array[val].nsfw && !nsfw);\n\treturn val;\n}\n","<template>\n\t<div v-if=\"canvasTooSmall && isSafari\">\n\t\tProtrait mode is not supported by safari. Please turn the device sideways.\n\t</div>\n\t<div v-else id=\"app\">\n\t\t<div id=\"container\">\n\t\t\t<render\n\t\t\t\tref=\"render\"\n\t\t\t\t:canvasWidth=\"canvasWidth\"\n\t\t\t\t:canvasHeight=\"canvasHeight\"\n\t\t\t/>\n\t\t</div>\n\t\t<message-console />\n\t\t<tool-box\n\t\t\t@show-prev-render=\"drawLastDownload\"\n\t\t\t@download=\"$refs.render.download()\"\n\t\t\t@show-dialog=\"showDialog\"\n\t\t\t@show-expression-dialog=\"showExpressionDialog\"\n\t\t/>\n\t\t<keep-alive>\n\t\t\t<modal-dialog\n\t\t\t\tv-if=\"dialogVisable\"\n\t\t\t\tref=\"dialog\"\n\t\t\t\t@leave=\"dialogVisable = false\"\n\t\t\t>\n\t\t\t\t<single-box ref=\"packDialog\" @leave=\"dialogVisable = false\" />\n\t\t\t</modal-dialog>\n\t\t</keep-alive>\n\t\t<modal-dialog\n\t\t\tv-if=\"expressionBuilderVisible\"\n\t\t\tref=\"dialog\"\n\t\t\t@leave=\"expressionBuilderVisible = false\"\n\t\t>\n\t\t\t<expression-builder\n\t\t\t\t:character=\"expressionBuilderCharacter\"\n\t\t\t\t:initHeadGroup=\"expressionBuilderHeadGroup\"\n\t\t\t\t@leave=\"expressionBuilderVisible = false\"\n\t\t\t/>\n\t\t</modal-dialog>\n\t</div>\n</template>\n\n<script lang=\"ts\">\n// App.vue has currently so many responsiblities that it's best to break it into chunks\nimport { ICreateTextBoxAction } from '@/store/objectTypes/textbox';\nimport {\n\tISetObjectPositionMutation,\n\tIRemoveObjectAction,\n} from '@/store/objects';\nimport {\n\tIShiftCharacterSlotAction,\n\tICharacter,\n} from '@/store/objectTypes/characters';\nimport ToolBox from '@/components/toolbox/toolbox.vue';\nimport MessageConsole from '@/components/message-console.vue';\nimport Render from '@/components/render.vue';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport { ISetCurrentMutation } from '@/store/panels';\nimport { defineAsyncComponent, defineComponent } from 'vue';\n\n// tslint:disable-next-line: no-magic-numbers\nconst aspectRatio = 16 / 9;\nconst arrowMoveStepSize = 20;\nconst packDialogWaitMs = 50;\nconst canvasTooSmallThreshold = 200;\n\nexport default defineComponent({\n\tcomponents: {\n\t\tToolBox,\n\t\tMessageConsole,\n\t\tRender,\n\t\tModalDialog,\n\t\tSingleBox: defineAsyncComponent(() =>\n\t\t\timport('@/components/repo/layouts/SingleBox.vue')\n\t\t),\n\t\tExpressionBuilder: defineAsyncComponent(() =>\n\t\t\timport('@/components/content-pack-builder/expression-builder/index.vue')\n\t\t),\n\t},\n\tdata: () => ({\n\t\tcanvasWidth: 0,\n\t\tcanvasHeight: 0,\n\t\tblendOver: null as string | null,\n\t\tuiSize: 192,\n\t\tcurrentlyRendering: false,\n\t\tpanel: '',\n\t\tdialogVisable: false,\n\t\tcanvasTooSmall: false,\n\t\texpressionBuilderVisible: false,\n\t\texpressionBuilderCharacter: '',\n\t\texpressionBuilderHeadGroup: undefined as string | undefined,\n\t}),\n\tcomputed: {\n\t\tisSafari(): boolean {\n\t\t\treturn false;\n\t\t\t/*\t\treturn !!(\n\t\t\tnavigator.vendor &&\n\t\t\tnavigator.vendor.indexOf('Apple') > -1 &&\n\t\t\tnavigator.userAgent &&\n\t\t\tnavigator.userAgent.indexOf('CriOS') === -1 &&\n\t\t\tnavigator.userAgent.indexOf('FxiOS') === -1\n\t\t);*/\n\t\t},\n\t},\n\tmethods: {\n\t\tdrawLastDownload(): void {\n\t\t\tconst last = this.$store.state.ui.lastDownload;\n\t\t\tif (!last) return;\n\t\t\t(this.$refs.render as typeof Render).blendOver(last);\n\t\t},\n\t\tsetBlendOver(): void {\n\t\t\tthis.blendOver = this.$store.state.ui.lastDownload;\n\t\t},\n\t\toptimum(sw: number, sh: number): [number, number] {\n\t\t\tlet rh = sw / aspectRatio;\n\t\t\tlet rw = sh * aspectRatio;\n\n\t\t\tif (rh > sh) {\n\t\t\t\trh = sh;\n\t\t\t} else {\n\t\t\t\trw = sw;\n\t\t\t}\n\n\t\t\treturn [rw, rh];\n\t\t},\n\t\toptimizeWithMenu(sw: number, sh: number): [number, number, boolean] {\n\t\t\tconst opth = this.optimum(sw, sh - this.uiSize);\n\t\t\tconst optv = this.optimum(sw - this.uiSize, sh);\n\n\t\t\tif (!this.isSafari && opth[0] * opth[1] > optv[0] * optv[1]) {\n\t\t\t\treturn [opth[0], opth[1], false];\n\t\t\t} else {\n\t\t\t\treturn [optv[0], optv[1], true];\n\t\t\t}\n\t\t},\n\t\tupdateArea(): void {\n\t\t\tconst [cw, ch, v] = this.optimizeWithMenu(\n\t\t\t\tdocument.documentElement.clientWidth,\n\t\t\t\tdocument.documentElement.clientHeight\n\t\t\t);\n\n\t\t\tthis.canvasWidth = cw;\n\t\t\tthis.canvasHeight = ch;\n\n\t\t\tthis.canvasTooSmall = Math.max(cw, ch) < canvasTooSmallThreshold;\n\n\t\t\tif (this.$store.state.ui.vertical === v) return;\n\t\t\tthis.$store.commit('ui/setVertical', v);\n\t\t},\n\t\tshowDialog(search: string | undefined) {\n\t\t\tthis.dialogVisable = true;\n\t\t\tif (search) {\n\t\t\t\tconst wait = () => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.$refs.packDialog &&\n\t\t\t\t\t\t(this.$refs.packDialog as any).$refs.packDialog\n\t\t\t\t\t) {\n\t\t\t\t\t\t// This strange doubling is to get around the async component wrapper\n\t\t\t\t\t\t(this.$refs.packDialog as any).$refs.packDialog.setSearch(search);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetTimeout(wait, packDialogWaitMs);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.$nextTick(wait);\n\t\t\t}\n\t\t},\n\t\tshowExpressionDialog(e: IShowExpressionDialogEvent) {\n\t\t\tthis.expressionBuilderVisible = true;\n\t\t\tthis.expressionBuilderCharacter = e.character;\n\t\t\tthis.expressionBuilderHeadGroup = e.headGroup;\n\t\t},\n\t\tonKeydown(e: KeyboardEvent) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tconst selection = this.$store.state.objects.objects[\n\t\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t\t];\n\t\t\t\tif (!selection) return;\n\t\t\t\tif (e.key === 'Delete') {\n\t\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t} as IRemoveObjectAction);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (e.key === 'z' && e.ctrlKey) {\n\t\t\t\t\t// this.$store.commit('history/undo');\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t} else if (e.key === 'y' && e.ctrlKey) {\n\t\t\t\t\t// this.$store.commit('history/redo');\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (selection.type === 'character') {\n\t\t\t\t\tconst character = selection as ICharacter;\n\t\t\t\t\tif (character.freeMove) {\n\t\t\t\t\t\tif (e.key === 'ArrowLeft') {\n\t\t\t\t\t\t\tthis.$store.dispatch('objects/shiftCharacterSlot', {\n\t\t\t\t\t\t\t\tid: character.id,\n\t\t\t\t\t\t\t\tdelta: -1,\n\t\t\t\t\t\t\t} as IShiftCharacterSlotAction);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (e.key === 'ArrowRight') {\n\t\t\t\t\t\t\tthis.$store.dispatch('objects/shiftCharacterSlot', {\n\t\t\t\t\t\t\t\tid: character.id,\n\t\t\t\t\t\t\t\tdelta: 1,\n\t\t\t\t\t\t\t} as IShiftCharacterSlotAction);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet { x, y } = selection;\n\t\t\t\tif (e.key === 'ArrowLeft') {\n\t\t\t\t\tx -= e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowRight') {\n\t\t\t\t\tx += e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowUp') {\n\t\t\t\t\ty -= e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowDown') {\n\t\t\t\t\ty += e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\tid: selection.id,\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tdestroyed(): void {\n\t\t\twindow.removeEventListener('keydown', this.onKeydown);\n\t\t},\n\t},\n\tmounted(): void {\n\t\twindow.addEventListener('keypress', e => {\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tif (this.$store.state.ui.selection === null) return;\n\t\t\t\t\tthis.$store.commit('ui/setSelection', null);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\tasync created(): Promise<void> {\n\t\t// Moving this to the \"mounted\"-handler crashes safari over version 12.\n\t\t// My best guess is because it runs in a microtask, which have been added in that Version.\n\t\tthis.updateArea();\n\t\twindow.addEventListener('resize', this.updateArea);\n\t\twindow.removeEventListener('keydown', this.onKeydown);\n\t\twindow.addEventListener('keydown', this.onKeydown);\n\n\t\t(window as any).app = this;\n\t\t(window as any).store = this.$store;\n\n\t\tdocument.body.addEventListener(\n\t\t\t'drop',\n\t\t\t(event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t\tdocument.body.addEventListener(\n\t\t\t'dragover',\n\t\t\t(event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\tthis.vuexHistory.transaction(async () => {\n\t\t\tawait this.$store.dispatch('content/loadContentPacks', [\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.backgrounds.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.monika.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.sayori.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.natsuki.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.yuri.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc_chad.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc_classic.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.femc.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.classic_amy.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.amy.json`,\n\t\t\t]);\n\n\t\t\tawait this.$store.dispatch('panels/createPanel');\n\t\t\tif (Object.keys(this.$store.state.objects.objects).length === 0) {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createTextBox',\n\t\t\t\t\t{} as ICreateTextBoxAction\n\t\t\t\t);\n\t\t\t}\n\t\t\tawait this.$store.commit('panels/setCurrentBackground', {\n\t\t\t\tcurrent: 'dddg.buildin.backgrounds:ddlc.clubroom',\n\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t} as ISetCurrentMutation);\n\t\t});\n\t},\n});\n\nexport interface IShowExpressionDialogEvent {\n\tcharacter: string;\n\theadGroup?: string;\n}\n</script>\n\n<style lang=\"scss\">\n@import '@/styles/globals.scss';\n</style>\n","<template>\n\t<div id=\"panels\" :class=\"{ vertical }\">\n\t\t<div id=\"toolbar\">\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'add' }\"\n\t\t\t\t@click=\"setPanel('add')\"\n\t\t\t\ttitle=\"Add new objects to the scene\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\">add_box</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'backgrounds' }\"\n\t\t\t\t@click=\"setPanel('backgrounds')\"\n\t\t\t\ttitle=\"Change the current background\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\">panorama</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'panels' }\"\n\t\t\t\ttitle=\"Panels\"\n\t\t\t\t@click=\"setPanel('panels')\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\">view_module</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'settings' }\"\n\t\t\t\ttitle=\"Settings\"\n\t\t\t\t@click=\"setPanel('settings')\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\">settings_applications</i>\n\t\t\t</button>\n\t\t</div>\n\t\t<settings-panel v-if=\"panel === 'settings'\" />\n\t\t<content-packs-panel v-else-if=\"panel === 'packs'\" />\n\t\t<backgrounds-panel\n\t\t\tv-else-if=\"panel === 'backgrounds'\"\n\t\t\t@show-dialog=\"$emit('show-dialog', $event)\"\n\t\t/>\n\t\t<credits-panel v-else-if=\"panel === 'help_credits'\" />\n\t\t<character-panel\n\t\t\tv-else-if=\"panel === 'character'\"\n\t\t\t@show-dialog=\"$emit('show-dialog', $event)\"\n\t\t\t@show-expression-dialog=\"$emit('show-expression-dialog', $event)\"\n\t\t/>\n\t\t<sprite-panel v-else-if=\"panel === 'sprite'\" />\n\t\t<text-box-panel v-else-if=\"panel === 'textBox'\" />\n\t\t<choice-panel v-else-if=\"panel === 'choice'\" />\n\t\t<panels-panel v-else-if=\"panel === 'panels'\" />\n\t\t<notification-panel v-else-if=\"panel === 'notification'\" />\n\t\t<poem-panel v-else-if=\"panel === 'poem'\" />\n\t\t<add-panel v-else @show-dialog=\"$emit('show-dialog', $event)\" />\n\t\t<div id=\"toolbar-end\">\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'help_credits' }\"\n\t\t\t\t@click=\"setPanel('help_credits')\"\n\t\t\t\ttitle=\"Help &amp; Credits\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\">help</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'packs' }\"\n\t\t\t\t@click=\"$emit('show-dialog')\"\n\t\t\t\ttitle=\"Content packs\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t@click=\"$emit('show-prev-render')\"\n\t\t\t\ttitle=\"Show last downloaded panel\"\n\t\t\t\t:disabled=\"!hasPrevRender\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\">flip_to_back</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\ttitle=\"Take a screenshot of the current scene\"\n\t\t\t\t@click=\"$emit('download')\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\">photo_camera</i>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport SettingsPanel from './tools/settings.vue';\nimport AddPanel from './tools/add.vue';\nimport CharacterPanel from './tools/character.vue';\nimport SpritePanel from './tools/sprite.vue';\nimport TextBoxPanel from './tools/textbox.vue';\nimport ChoicePanel from './tools/choice.vue';\nimport CreditsPanel from './tools/credits.vue';\nimport BackgroundsPanel from './tools/backgrounds.vue';\nimport ContentPacksPanel from './tools/content-pack.vue';\nimport PanelsPanel from './tools/panels.vue';\nimport NotificationPanel from './tools/notification.vue';\nimport PoemPanel from './tools/poem.vue';\nimport { IObject, ObjectTypes } from '@/store/objects';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\ntype PanelNames =\n\t| 'add'\n\t| 'backgrounds'\n\t| 'help_credits'\n\t| 'selection'\n\t| 'packs'\n\t| 'settings'\n\t| 'panels'\n\t| 'notification'\n\t| 'poem';\n\nexport default defineComponent({\n\tcomponents: {\n\t\tSettingsPanel,\n\t\tAddPanel,\n\t\tBackgroundsPanel,\n\t\tCreditsPanel,\n\t\tCharacterPanel,\n\t\tTextBoxPanel,\n\t\tChoicePanel,\n\t\tSpritePanel,\n\t\tContentPacksPanel,\n\t\tPanelsPanel,\n\t\tNotificationPanel,\n\t\tPoemPanel,\n\t},\n\tdata: () => ({\n\t\tpanelSelection: 'add' as PanelNames,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tselection(): string | null {\n\t\t\treturn this.$store.state.ui.selection;\n\t\t},\n\t\tpanel(): PanelNames | ObjectTypes {\n\t\t\tif (this.panelSelection === 'selection') {\n\t\t\t\tif (this.selection === null) {\n\t\t\t\t\t// eslint-disable-next-line vue/no-side-effects-in-computed-properties\n\t\t\t\t\tthis.panelSelection = 'add';\n\t\t\t\t} else {\n\t\t\t\t\tconst obj = this.$store.state.objects.objects[this.selection];\n\t\t\t\t\treturn obj.type;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this.panelSelection;\n\t\t},\n\t\thasPrevRender(): boolean {\n\t\t\treturn this.$store.state.ui.lastDownload !== null;\n\t\t},\n\t},\n\tmethods: {\n\t\tcreate() {\n\t\t\tenvironment.onPanelChange((panel: string) => {\n\t\t\t\tthis.panelSelection = panel as PanelNames;\n\t\t\t});\n\t\t},\n\t\tsetPanel(name: PanelNames) {\n\t\t\tif (name === this.panelSelection) name = 'add';\n\t\t\tthis.panelSelection = name;\n\t\t\tif (this.selection) {\n\t\t\t\tif (this.$store.state.ui.selection === null) return;\n\t\t\t\tthis.$store.commit('ui/setSelection', null);\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tselection(newSelection: IObject | null) {\n\t\t\tif (newSelection) {\n\t\t\t\tthis.panelSelection = 'selection';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.panelSelection === 'selection') {\n\t\t\t\tthis.panelSelection = 'add';\n\t\t\t}\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\">\n#panels {\n\tbackground-color: #ffffff;\n\tborder: 3px solid #ffbde1;\n\tposition: absolute;\n\tdisplay: flex;\n\toverflow: hidden;\n\n\t.panel {\n\t\tdisplay: flex;\n\t\tflex-grow: 1;\n\t\tflex-direction: column;\n\t\tpadding: 4px;\n\t}\n\n\t&:not(.vertical) {\n\t\tflex-direction: row;\n\t\tleft: 0;\n\t\tbottom: 0;\n\t\theight: 192px;\n\t\twidth: 100vw;\n\n\t\t.panel {\n\t\t\tflex-grow: 1;\n\t\t\tflex-wrap: wrap;\n\t\t\talign-content: flex-start;\n\t\t\toverflow-x: auto;\n\t\t\toverflow-y: hidden;\n\n\t\t\t> * {\n\t\t\t\tmargin-right: 8px;\n\t\t\t}\n\t\t}\n\n\t\t#toolbar,\n\t\t#toolbar-end {\n\t\t\twidth: 48px;\n\t\t\theight: 100%;\n\t\t\tfloat: left;\n\t\t\tmargin-top: -3px;\n\t\t}\n\n\t\t#toolbar {\n\t\t\tbutton {\n\t\t\t\tborder-bottom: none;\n\n\t\t\t\t&:nth-child(4) {\n\t\t\t\t\tborder-bottom: 3px solid #ffbde1;\n\t\t\t\t}\n\n\t\t\t\t&.active {\n\t\t\t\t\tborder-right: 3px solid white;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t#toolbar-end {\n\t\t\tbutton {\n\t\t\t\tborder-bottom: none;\n\t\t\t\t&:nth-child(4) {\n\t\t\t\t\tborder-top: 3px solid #ffbde1;\n\t\t\t\t}\n\n\t\t\t\t&.active {\n\t\t\t\t\tborder-left: 3px solid white;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\th1 {\n\t\t\twriting-mode: vertical-rl;\n\t\t\theight: 100%;\n\t\t}\n\t}\n\n\t&.vertical {\n\t\tflex-direction: column;\n\t\ttop: 0;\n\t\tright: 0;\n\t\theight: 100%;\n\t\twidth: 192px;\n\n\t\t.panel {\n\t\t\toverflow-x: hidden;\n\t\t\toverflow-y: auto;\n\t\t}\n\n\t\t#toolbar,\n\t\t#toolbar-end {\n\t\t\twidth: calc(100% + 6px);\n\t\t}\n\n\t\t#toolbar {\n\t\t\tbutton {\n\t\t\t\tborder-right: none;\n\t\t\t\t&:nth-child(4) {\n\t\t\t\t\tborder-right: 3px solid #ffbde1;\n\t\t\t\t}\n\n\t\t\t\t&.active {\n\t\t\t\t\tborder-bottom: 3px solid white;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t#toolbar-end {\n\t\t\tmargin-bottom: -3px;\n\t\t\tbutton {\n\t\t\t\tborder-left: none;\n\n\t\t\t\t&:nth-child(4) {\n\t\t\t\t\tborder-right: 3px solid #ffbde1;\n\t\t\t\t}\n\n\t\t\t\t&.active {\n\t\t\t\t\tborder-top: 3px solid white;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#toolbar {\n\t\tmargin-top: -3px;\n\t\tmargin-left: -3px;\n\t\tbutton {\n\t\t\toutline: 0;\n\t\t\twidth: 48px;\n\t\t\theight: 48px;\n\t\t\tline-height: 48px;\n\t\t\tbackground-color: #ffe6f4;\n\t\t\tborder: 3px solid #ffbde1;\n\n\t\t\ti {\n\t\t\t\tvertical-align: sub;\n\t\t\t}\n\n\t\t\t&.active {\n\t\t\t\tbackground: white;\n\t\t\t}\n\t\t}\n\t}\n\n\t#toolbar-end {\n\t\tmargin-right: -3px;\n\t\tbutton {\n\t\t\toutline: 0;\n\t\t\twidth: 48px;\n\t\t\theight: 48px;\n\t\t\tline-height: 48px;\n\t\t\tbackground-color: #ffe6f4;\n\t\t\tborder: 3px solid #ffbde1;\n\n\t\t\ti {\n\t\t\t\tvertical-align: sub;\n\t\t\t}\n\n\t\t\t&.active {\n\t\t\t\tbackground: white;\n\t\t\t}\n\t\t}\n\t}\n}\n</style>\n","<template>\n\t<div class=\"panel\">\n\t\t<h1>Settings</h1>\n\t\t<toggle\n\t\t\tv-if=\"lqAllowed\"\n\t\t\tlabel=\"Low quality preview?\"\n\t\t\ttitle=\"Reduces the quality of the preview images to speed up the user experience and consume less data. Does not effect final render.\"\n\t\t\tv-model=\"lqRendering\"\n\t\t/>\n\t\t<toggle label=\"NSFW Mode?\" v-model=\"nsfw\" />\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IRemovePacksAction } from '@/store';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\nconst nsfwPacks = {\n\t'dddg.buildin.backgrounds.nsfw': `${process.env.BASE_URL}packs/buildin.base.backgrounds.nsfw.json`,\n\t'dddg.buildin.sayori.nsfw': `${process.env.BASE_URL}packs/buildin.base.sayori.nsfw.json`,\n\t'dddg.buildin.base.natsuki.nsfw': `${process.env.BASE_URL}packs/buildin.base.natsuki.nsfw.json`,\n\t'dddg.buildin.yuri.nsfw': `${process.env.BASE_URL}packs/buildin.base.yuri.nsfw.json`,\n};\n\nconst names = new Set(Object.keys(nsfwPacks));\nconst paths = Object.values(nsfwPacks);\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { Toggle },\n\tcomputed: {\n\t\tlqAllowed(): boolean {\n\t\t\treturn environment.allowLQ;\n\t\t},\n\t\tlqRendering: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.$store.state.ui.lqRendering;\n\t\t\t},\n\t\t\tset(lqRendering: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setLqRendering', lqRendering);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tnsfw: {\n\t\t\tget(): boolean {\n\t\t\t\treturn !!this.$store.state.content.contentPacks\n\t\t\t\t\t.map(pack => pack.packId)\n\t\t\t\t\t.filter(packId => !!packId)\n\t\t\t\t\t.find(packId => names.has(packId!));\n\t\t\t},\n\t\t\tset(value: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tawait this.$store.dispatch('content/loadContentPacks', paths);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait this.$store.dispatch('removePacks', {\n\t\t\t\t\t\t\tpacks: names,\n\t\t\t\t\t\t} as IRemovePacksAction);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.panel {\n\t&.vertical {\n\t\t#dialog_text_wrapper {\n\t\t\twidth: 173px;\n\n\t\t\ttextarea {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t#dialog_text_wrapper {\n\t\t\theight: 181px;\n\t\t\tdisplay: table;\n\n\t\t\t* {\n\t\t\t\tdisplay: table-row;\n\t\t\t}\n\t\t}\n\t}\n}\n\ntextarea {\n\tmin-height: 148px;\n}\n\n.btn_link {\n\tappearance: button;\n\ttext-align: center;\n}\n</style>\n","import { VerticalScrollRedirect } from '@/components/vertical-scroll-redirect';\nimport { ComponentOptionsMixin } from 'vue';\n\nexport const PanelMixin: ComponentOptionsMixin = {\n\tmixins: [VerticalScrollRedirect],\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tmounted() {\n\t\tthis.updateVertical();\n\t\tthis.$el.addEventListener(\n\t\t\t'wheel',\n\t\t\t(e: WheelEvent) => {\n\t\t\t\tif (!this.vertical) this.verticalScrollRedirect(e as WheelEvent);\n\t\t\t},\n\t\t\t{\n\t\t\t\tpassive: true,\n\t\t\t}\n\t\t);\n\t},\n\tmethods: {\n\t\tupdateVertical() {\n\t\t\tif (!this.$el) return;\n\t\t\tif (this.vertical) {\n\t\t\t\tthis.$el.classList.add('vertical');\n\t\t\t} else {\n\t\t\t\tthis.$el.classList.remove('vertical');\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tvertical() {\n\t\t\t(this as any).updateVertical();\n\t\t},\n\t},\n};\n","\nimport Toggle from '@/components/toggle.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IRemovePacksAction } from '@/store';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\nconst nsfwPacks = {\n\t'dddg.buildin.backgrounds.nsfw': `${process.env.BASE_URL}packs/buildin.base.backgrounds.nsfw.json`,\n\t'dddg.buildin.sayori.nsfw': `${process.env.BASE_URL}packs/buildin.base.sayori.nsfw.json`,\n\t'dddg.buildin.base.natsuki.nsfw': `${process.env.BASE_URL}packs/buildin.base.natsuki.nsfw.json`,\n\t'dddg.buildin.yuri.nsfw': `${process.env.BASE_URL}packs/buildin.base.yuri.nsfw.json`,\n};\n\nconst names = new Set(Object.keys(nsfwPacks));\nconst paths = Object.values(nsfwPacks);\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { Toggle },\n\tcomputed: {\n\t\tlqAllowed(): boolean {\n\t\t\treturn environment.allowLQ;\n\t\t},\n\t\tlqRendering: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.$store.state.ui.lqRendering;\n\t\t\t},\n\t\t\tset(lqRendering: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setLqRendering', lqRendering);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tnsfw: {\n\t\t\tget(): boolean {\n\t\t\t\treturn !!this.$store.state.content.contentPacks\n\t\t\t\t\t.map(pack => pack.packId)\n\t\t\t\t\t.filter(packId => !!packId)\n\t\t\t\t\t.find(packId => names.has(packId!));\n\t\t\t},\n\t\t\tset(value: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tawait this.$store.dispatch('content/loadContentPacks', paths);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait this.$store.dispatch('removePacks', {\n\t\t\t\t\t\t\tpacks: names,\n\t\t\t\t\t\t} as IRemovePacksAction);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t},\n});\n","import { render } from \"./settings.vue?vue&type=template&id=4dea3924&scoped=true&bindings={}\"\nimport script from \"./settings.vue?vue&type=script&lang=ts\"\nexport * from \"./settings.vue?vue&type=script&lang=ts\"\n\nimport \"./settings.vue?vue&type=style&index=0&id=4dea3924&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-4dea3924\"\n\nexport default script","<template>\n\t<div\n\t\tclass=\"panel\"\n\t\tv-if=\"isWebPSupported !== undefined\"\n\t\t@dragenter=\"showDropTarget\"\n\t\t@mouseleave=\"hideDropTarget\"\n\t>\n\t\t<drop-target ref=\"spriteDt\" class=\"drop-target\" @drop=\"addCustomSpriteFile\"\n\t\t\t>Drop here to add as a new sprite</drop-target\n\t\t>\n\t\t<h1>Add</h1>\n\t\t<div :class=\"{ 'group-selector': true, vertical }\">\n\t\t\t<d-button\n\t\t\t\t:class=\"{ active: group === 'characters' }\"\n\t\t\t\ticon-pos=\"top\"\n\t\t\t\ticon=\"emoji_people\"\n\t\t\t\t@click=\"group = 'characters'\"\n\t\t\t>\n\t\t\t\tChar&shy;acters\n\t\t\t</d-button>\n\t\t\t<d-button\n\t\t\t\t:class=\"{ active: group === 'sprites' }\"\n\t\t\t\ticon-pos=\"top\"\n\t\t\t\ticon=\"change_history\"\n\t\t\t\t@click=\"group = 'sprites'\"\n\t\t\t>\n\t\t\t\tSprites\n\t\t\t</d-button>\n\t\t\t<d-button\n\t\t\t\t:class=\"{ active: group === 'ui' }\"\n\t\t\t\ticon-pos=\"top\"\n\t\t\t\ticon=\"view_quilt\"\n\t\t\t\t@click=\"group = 'ui'\"\n\t\t\t>\n\t\t\t\tUI\n\t\t\t</d-button>\n\t\t</div>\n\t\t<div :class=\"{ 'item-grid': true, vertical }\">\n\t\t\t<template v-if=\"group === 'characters'\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"character\"\n\t\t\t\t\tv-for=\"character of characters\"\n\t\t\t\t\t:key=\"character.id\"\n\t\t\t\t\t:title=\"character.label\"\n\t\t\t\t\t@click=\"onChosen(character.id.toLowerCase())\"\n\t\t\t\t>\n\t\t\t\t\t<img :src=\"assetPath(character)\" :alt=\"character.label\" />\n\t\t\t\t</div>\n\t\t\t\t<d-button\n\t\t\t\t\tclass=\"custom-sprite\"\n\t\t\t\t\ticon=\"extension\"\n\t\t\t\t\t@click=\"$emit('show-dialog', 'type: Characters')\"\n\t\t\t\t>\n\t\t\t\t\tSearch in content packs\n\t\t\t\t</d-button>\n\t\t\t</template>\n\t\t\t<template v-if=\"group === 'sprites'\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"sprite\"\n\t\t\t\t\tv-for=\"sprite of sprites\"\n\t\t\t\t\t:key=\"sprite.label\"\n\t\t\t\t\t:title=\"sprite.label\"\n\t\t\t\t\t:style=\"{ background: assetSpriteBackground(sprite) }\"\n\t\t\t\t\t@click=\"addSpriteToScene(sprite)\"\n\t\t\t\t>\n\t\t\t\t\t{{ sprite.label }}\n\t\t\t\t</div>\n\n\t\t\t\t<d-button\n\t\t\t\t\tclass=\"custom-sprite\"\n\t\t\t\t\ticon=\"publish\"\n\t\t\t\t\t@click=\"$refs.spriteUpload.click()\"\n\t\t\t\t>\n\t\t\t\t\tUpload new sprite\n\t\t\t\t\t<input type=\"file\" ref=\"spriteUpload\" @change=\"onSpriteFileUpload\" />\n\t\t\t\t</d-button>\n\t\t\t\t<d-button icon=\"insert_link\" @click=\"uploadFromURL\">\n\t\t\t\t\tNew sprite from URL\n\t\t\t\t</d-button>\n\t\t\t\t<d-button\n\t\t\t\t\ticon=\"extension\"\n\t\t\t\t\t@click=\"$emit('show-dialog', 'type: Sprites')\"\n\t\t\t\t>\n\t\t\t\t\tSearch in content packs\n\t\t\t\t</d-button>\n\t\t\t</template>\n\t\t\t<template v-if=\"group === 'ui'\">\n\t\t\t\t<button @click=\"addTextBox\">Textbox</button>\n\t\t\t\t<button @click=\"addPoem\">Poem</button>\n\t\t\t\t<button @click=\"addDialog\">Notification</button>\n\t\t\t\t<button @click=\"addChoice\">Choice</button>\n\t\t\t\t<button @click=\"addConsole\">Console</button>\n\t\t\t</template>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { isWebPSupported } from '@/asset-manager';\nimport { ICreateCharacterAction } from '@/store/objectTypes/characters';\nimport { ICreateTextBoxAction } from '@/store/objectTypes/textbox';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport {\n\tCharacter,\n\tContentPack,\n\tSprite,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { PanelMixin } from './panelMixin';\nimport DropTarget from '../drop-target.vue';\nimport DButton from '@/components/ui/d-button.vue';\nimport { ICreateSpriteAction } from '@/store/objectTypes/sprite';\nimport { ICreateChoicesAction } from '@/store/objectTypes/choices';\nimport { ICreateNotificationAction } from '@/store/objectTypes/notification';\nimport { ICreatePoemAction } from '@/store/objectTypes/poem';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nconst uploadedSpritesPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.uploadedSprites',\n\tpackCredits: [''],\n\tdependencies: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DropTarget, DButton },\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\tcustomAssetCount: 0,\n\t\tgroup: 'characters' as 'characters' | 'sprites' | 'ui',\n\t}),\n\tcomputed: {\n\t\tcharacters(): DeepReadonly<Array<Character<IAsset>>> {\n\t\t\treturn this.$store.state.content.current.characters;\n\t\t},\n\t\tsprites(): DeepReadonly<Array<Sprite<IAsset>>> {\n\t\t\treturn this.$store.state.content.current.sprites;\n\t\t},\n\t},\n\tmethods: {\n\t\tassetSpriteBackground(sprite: Sprite<IAsset>) {\n\t\t\treturn sprite.variants[0]\n\t\t\t\t.map(variant => `url('${variant.lq}')`)\n\t\t\t\t.join(',');\n\t\t},\n\t\tassetPath(character: Character<IAsset>) {\n\t\t\treturn character.chibi\n\t\t\t\t? environment.allowLQ\n\t\t\t\t\t? character.chibi.lq\n\t\t\t\t\t: character.chibi.hq\n\t\t\t\t: '';\n\t\t},\n\t\tshowDropTarget(e: DragEvent) {\n\t\t\tif (!e.dataTransfer) return;\n\t\t\te.dataTransfer.effectAllowed = 'none';\n\t\t\tif (\n\t\t\t\t!Array.from(e.dataTransfer.items).find(item =>\n\t\t\t\t\titem.type.match(/^image.*$/)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.dataTransfer.effectAllowed = 'link';\n\t\t\tif (this.group === 'sprites') {\n\t\t\t\t(this.$refs.spriteDt as any).show();\n\t\t\t}\n\t\t},\n\t\thideDropTarget() {\n\t\t\tif (this.group === 'sprites') {\n\t\t\t\t(this.$refs.spriteDt as any).hide();\n\t\t\t}\n\t\t},\n\t\tonSpriteFileUpload() {\n\t\t\tconst uploadInput = this.$refs.spriteUpload as HTMLInputElement;\n\t\t\tif (!uploadInput.files) return;\n\t\t\tfor (const file of uploadInput.files) {\n\t\t\t\tthis.addCustomSpriteFile(file);\n\t\t\t}\n\t\t},\n\t\tasync uploadFromURL() {\n\t\t\tconst url = prompt('Enter the URL of the image');\n\t\t\tif (!url) return;\n\t\t\tconst lastSegment = url.split('/').slice(-1)[0];\n\t\t\tthis.addNewCustomSprite(lastSegment, url);\n\t\t},\n\t\tasync addSpriteToScene(sprite: Sprite<IAsset>) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tawait this.$store.dispatch('objects/createSprite', {\n\t\t\t\t\tassets: sprite.variants[0],\n\t\t\t\t} as ICreateSpriteAction);\n\t\t\t});\n\t\t},\n\t\taddTextBox() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createTextBox',\n\t\t\t\t\t{} as ICreateTextBoxAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddChoice() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createChoice',\n\t\t\t\t\t{} as ICreateChoicesAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddDialog() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createNotification',\n\t\t\t\t\t{} as ICreateNotificationAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddPoem() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createPoem', {} as ICreatePoemAction);\n\t\t\t});\n\t\t},\n\t\taddConsole() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createConsole', {} as ICreatePoemAction);\n\t\t\t});\n\t\t},\n\t\tonChosen(id: string) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createCharacters', {\n\t\t\t\t\tcharacterType: id,\n\t\t\t\t} as ICreateCharacterAction);\n\t\t\t});\n\t\t},\n\t\taddCustomSpriteFile(file: File) {\n\t\t\tconst url = URL.createObjectURL(file);\n\t\t\tthis.addNewCustomSprite(file.name, url);\n\t\t},\n\t\taddNewCustomSprite(label: string, url: string) {\n\t\t\tuploadedSpritesPack.sprites.push({\n\t\t\t\tid: url,\n\t\t\t\tlabel,\n\t\t\t\tvariants: [[url]],\n\t\t\t});\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: uploadedSpritesPack,\n\t\t\t\t\tprocessed: false,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t});\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.isWebPSupported = await isWebPSupported();\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\ntextarea {\n\tflex-grow: 1;\n}\n\n#panels {\n\t&:not(.vertical) .panel {\n\t\tjustify-content: center;\n\t}\n}\n\n.panel {\n\tflex-wrap: nowrap;\n\n\t.custom-sprite {\n\t\tinput {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n}\n\n.group-selector {\n\tdisplay: flex;\n\n\t&.vertical {\n\t\twidth: 100%;\n\t\tflex-direction: row;\n\t}\n\n\t&:not(.vertical) {\n\t\t@include height-100();\n\t\tflex-direction: column;\n\t}\n\n\tbutton {\n\t\tflex-grow: 1;\n\t\t&.active {\n\t\t\tbackground: white;\n\t\t}\n\t}\n}\n\n.item-grid {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: space-evenly;\n\n\t&.vertical {\n\t\tmargin-top: 4px;\n\t\twidth: 100%;\n\t\tflex-direction: row;\n\n\t\tbutton {\n\t\t\twidth: 100%;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\tmargin-left: 4px;\n\t\t@include height-100();\n\t\tflex-direction: column;\n\t}\n\n\t.character img {\n\t\tmax-height: 72px;\n\t\tmax-width: 72px;\n\t}\n}\n\n.item-grid {\n\t.sprite {\n\t\tbox-shadow: inset 0 0 1px 3px rgba(0, 0, 0, 0.5);\n\t\theight: 256px;\n\t\twidth: 256px;\n\t\tbackground-size: contain !important;\n\t\tbackground-repeat: no-repeat !important;\n\t\tbackground-position: center center !important;\n\t\tmargin-right: 4px;\n\t\ttext-shadow: 0 0 4px #000, -1px -1px 0 #000, 1px -1px 0 #000,\n\t\t\t-1px 1px 0 #000, 1px 1px 0 #000;\n\t\tcolor: white;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n}\n</style>\n","<template>\r\n\t<button :class=\"[iconPos]\" :disabled=\"disabled\">\r\n\t\t<div class=\"material-icons\">{{ icon }}</div>\r\n\t\t<div class=\"content\"><slot /></div>\r\n\t</button>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent, PropType } from 'vue';\r\nexport default defineComponent({\r\n\tprops: {\r\n\t\ticon: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true,\r\n\t\t},\r\n\t\ticonPos: {\r\n\t\t\ttype: String as PropType<'left' | 'top'>,\r\n\t\t\tdefault: 'left',\r\n\t\t},\r\n\t\tdisabled: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false,\r\n\t\t},\r\n\t},\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\nbutton {\r\n\tborder: 2px solid #ffbde1;\r\n\tbackground: #ffe6f4;\r\n\tpadding: 1px;\r\n\tdisplay: flex;\r\n\ttext-align: center;\r\n\tjustify-content: center;\r\n\talign-items: center;\r\n\r\n\t&.left {\r\n\t\tflex-direction: row;\r\n\t\t> .content {\r\n\t\t\tflex-grow: 1;\r\n\t\t}\r\n\t}\r\n\t&.top {\r\n\t\tflex-direction: column;\r\n\t}\r\n}\r\n</style>\r\n","\r\nimport { defineComponent, PropType } from 'vue';\r\nexport default defineComponent({\r\n\tprops: {\r\n\t\ticon: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true,\r\n\t\t},\r\n\t\ticonPos: {\r\n\t\t\ttype: String as PropType<'left' | 'top'>,\r\n\t\t\tdefault: 'left',\r\n\t\t},\r\n\t\tdisabled: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false,\r\n\t\t},\r\n\t},\r\n});\r\n","import { render } from \"./d-button.vue?vue&type=template&id=5803ca69&scoped=true&bindings={}\"\nimport script from \"./d-button.vue?vue&type=script&lang=ts\"\nexport * from \"./d-button.vue?vue&type=script&lang=ts\"\n\nimport \"./d-button.vue?vue&type=style&index=0&id=5803ca69&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-5803ca69\"\n\nexport default script","\nimport { isWebPSupported } from '@/asset-manager';\nimport { ICreateCharacterAction } from '@/store/objectTypes/characters';\nimport { ICreateTextBoxAction } from '@/store/objectTypes/textbox';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport {\n\tCharacter,\n\tContentPack,\n\tSprite,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { PanelMixin } from './panelMixin';\nimport DropTarget from '../drop-target.vue';\nimport DButton from '@/components/ui/d-button.vue';\nimport { ICreateSpriteAction } from '@/store/objectTypes/sprite';\nimport { ICreateChoicesAction } from '@/store/objectTypes/choices';\nimport { ICreateNotificationAction } from '@/store/objectTypes/notification';\nimport { ICreatePoemAction } from '@/store/objectTypes/poem';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nconst uploadedSpritesPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.uploadedSprites',\n\tpackCredits: [''],\n\tdependencies: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DropTarget, DButton },\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\tcustomAssetCount: 0,\n\t\tgroup: 'characters' as 'characters' | 'sprites' | 'ui',\n\t}),\n\tcomputed: {\n\t\tcharacters(): DeepReadonly<Array<Character<IAsset>>> {\n\t\t\treturn this.$store.state.content.current.characters;\n\t\t},\n\t\tsprites(): DeepReadonly<Array<Sprite<IAsset>>> {\n\t\t\treturn this.$store.state.content.current.sprites;\n\t\t},\n\t},\n\tmethods: {\n\t\tassetSpriteBackground(sprite: Sprite<IAsset>) {\n\t\t\treturn sprite.variants[0]\n\t\t\t\t.map(variant => `url('${variant.lq}')`)\n\t\t\t\t.join(',');\n\t\t},\n\t\tassetPath(character: Character<IAsset>) {\n\t\t\treturn character.chibi\n\t\t\t\t? environment.allowLQ\n\t\t\t\t\t? character.chibi.lq\n\t\t\t\t\t: character.chibi.hq\n\t\t\t\t: '';\n\t\t},\n\t\tshowDropTarget(e: DragEvent) {\n\t\t\tif (!e.dataTransfer) return;\n\t\t\te.dataTransfer.effectAllowed = 'none';\n\t\t\tif (\n\t\t\t\t!Array.from(e.dataTransfer.items).find(item =>\n\t\t\t\t\titem.type.match(/^image.*$/)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.dataTransfer.effectAllowed = 'link';\n\t\t\tif (this.group === 'sprites') {\n\t\t\t\t(this.$refs.spriteDt as any).show();\n\t\t\t}\n\t\t},\n\t\thideDropTarget() {\n\t\t\tif (this.group === 'sprites') {\n\t\t\t\t(this.$refs.spriteDt as any).hide();\n\t\t\t}\n\t\t},\n\t\tonSpriteFileUpload() {\n\t\t\tconst uploadInput = this.$refs.spriteUpload as HTMLInputElement;\n\t\t\tif (!uploadInput.files) return;\n\t\t\tfor (const file of uploadInput.files) {\n\t\t\t\tthis.addCustomSpriteFile(file);\n\t\t\t}\n\t\t},\n\t\tasync uploadFromURL() {\n\t\t\tconst url = prompt('Enter the URL of the image');\n\t\t\tif (!url) return;\n\t\t\tconst lastSegment = url.split('/').slice(-1)[0];\n\t\t\tthis.addNewCustomSprite(lastSegment, url);\n\t\t},\n\t\tasync addSpriteToScene(sprite: Sprite<IAsset>) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tawait this.$store.dispatch('objects/createSprite', {\n\t\t\t\t\tassets: sprite.variants[0],\n\t\t\t\t} as ICreateSpriteAction);\n\t\t\t});\n\t\t},\n\t\taddTextBox() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createTextBox',\n\t\t\t\t\t{} as ICreateTextBoxAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddChoice() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createChoice',\n\t\t\t\t\t{} as ICreateChoicesAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddDialog() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createNotification',\n\t\t\t\t\t{} as ICreateNotificationAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddPoem() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createPoem', {} as ICreatePoemAction);\n\t\t\t});\n\t\t},\n\t\taddConsole() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createConsole', {} as ICreatePoemAction);\n\t\t\t});\n\t\t},\n\t\tonChosen(id: string) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createCharacters', {\n\t\t\t\t\tcharacterType: id,\n\t\t\t\t} as ICreateCharacterAction);\n\t\t\t});\n\t\t},\n\t\taddCustomSpriteFile(file: File) {\n\t\t\tconst url = URL.createObjectURL(file);\n\t\t\tthis.addNewCustomSprite(file.name, url);\n\t\t},\n\t\taddNewCustomSprite(label: string, url: string) {\n\t\t\tuploadedSpritesPack.sprites.push({\n\t\t\t\tid: url,\n\t\t\t\tlabel,\n\t\t\t\tvariants: [[url]],\n\t\t\t});\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: uploadedSpritesPack,\n\t\t\t\t\tprocessed: false,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t});\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.isWebPSupported = await isWebPSupported();\n\t},\n});\n","import { render } from \"./add.vue?vue&type=template&id=1d4627bd&scoped=true&bindings={}\"\nimport script from \"./add.vue?vue&type=script&lang=ts\"\nexport * from \"./add.vue?vue&type=script&lang=ts\"\n\nimport \"./add.vue?vue&type=style&index=0&id=1d4627bd&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-1d4627bd\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>{{ label }}</h1>\n\t\t<parts\n\t\t\tv-if=\"panelForParts\"\n\t\t\t:character=\"object\"\n\t\t\t:part=\"panelForParts\"\n\t\t\t@leave=\"panelForParts = null\"\n\t\t\t@show-dialog=\"$emit('show-dialog', $event)\"\n\t\t\t@show-expression-dialog=\"$emit('show-expression-dialog', $event)\"\n\t\t/>\n\t\t<image-options\n\t\t\tv-else-if=\"imageOptionsOpen\"\n\t\t\ttype=\"object\"\n\t\t\t:title=\"label\"\n\t\t\t:id=\"object.id\"\n\t\t\t@leave=\"imageOptionsOpen = false\"\n\t\t/>\n\t\t<template v-else>\n\t\t\t<d-fieldset\n\t\t\t\tv-if=\"hasMultiplePoses || parts.length > 0\"\n\t\t\t\tclass=\"pose-list\"\n\t\t\t\ttitle=\"Pose:\"\n\t\t\t>\n\t\t\t\t<table>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr v-if=\"hasMultipleStyles\">\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekStyle(-1)\">&lt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button class=\"middle-button\" @click=\"panelForParts = 'style'\">\n\t\t\t\t\t\t\t\t\tStyle\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekStyle(1)\">&gt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-if=\"hasMultiplePoses\">\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekPose(-1)\">&lt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button class=\"middle-button\" @click=\"panelForParts = 'pose'\">\n\t\t\t\t\t\t\t\t\tPose\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekPose(1)\">&gt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-for=\"part of parts\" :key=\"part\">\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekPart(part, -1)\">&lt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button class=\"middle-button\" @click=\"panelForParts = part\">\n\t\t\t\t\t\t\t\t\t{{ captialize(part) }}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekPart(part, 1)\">&gt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</d-fieldset>\n\t\t\t<position-and-size :obj=\"object\" />\n\t\t\t<layers :object=\"object\" />\n\t\t\t<toggle v-model=\"closeUp\" label=\"Close up?\" />\n\t\t\t<toggle v-model=\"flip\" label=\"Flip?\" />\n\t\t\t<button @click=\"imageOptionsOpen = true\">Image options</button>\n\t\t\t<delete :obj=\"object\" />\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport {\n\tgetData,\n\tgetParts,\n\tISeekPoseAction,\n\tISeekPosePartAction,\n\tICharacter,\n\tISeekStyleAction,\n} from '@/store/objectTypes/characters';\nimport Toggle from '@/components/toggle.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport Parts from './character/parts.vue';\nimport { Character } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport { PanelMixin } from './panelMixin';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<ICharacter>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tParts,\n\t\tDFieldset,\n\t\tImageOptions,\n\t},\n\tdata: () => ({\n\t\timageOptionsOpen: false,\n\t\tpanelForParts: null as string | null,\n\t}),\n\tcomputed: {\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\tcloseUp: setable('close', 'objects/setClose'),\n\t\tselection(): string {\n\t\t\treturn this.$store.state.ui.selection!;\n\t\t},\n\t\tobject(): DeepReadonly<ICharacter> {\n\t\t\tconst obj = this.$store.state.objects.objects[this.selection];\n\t\t\tif (obj.type !== 'character') return undefined!;\n\t\t\treturn obj as ICharacter;\n\t\t},\n\t\tcharData(): DeepReadonly<Character<IAsset>> {\n\t\t\treturn getData(this.$store, this.object);\n\t\t},\n\t\tlabel(): string {\n\t\t\treturn this.charData.label || '';\n\t\t},\n\t\tparts(): DeepReadonly<string[]> {\n\t\t\treturn getParts(this.charData, this.object);\n\t\t},\n\t\thasMultipleStyles(): boolean {\n\t\t\treturn (\n\t\t\t\tthis.charData.styleGroups[this.object.styleGroupId].styles.length > 1 ||\n\t\t\t\tthis.charData.styleGroups.length > 1\n\t\t\t);\n\t\t},\n\t\thasMultiplePoses(): boolean {\n\t\t\tconst styleGroup = this.charData.styleGroups[this.object.styleGroupId];\n\t\t\tconst style = styleGroup.styles[this.object.styleId];\n\t\t\treturn style.poses.length > 1;\n\t\t},\n\t},\n\tmethods: {\n\t\tseekPose(delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekPose', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as ISeekPoseAction);\n\t\t\t});\n\t\t},\n\t\tseekStyle(delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekStyle', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as ISeekStyleAction);\n\t\t\t});\n\t\t},\n\t\tseekPart(part: string, delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekPart', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t\tpart,\n\t\t\t\t} as ISeekPosePartAction);\n\t\t\t});\n\t\t},\n\t\tcaptialize(str: string) {\n\t\t\treturn str.charAt(0).toUpperCase() + str.substring(1);\n\t\t},\n\t},\n\twatch: {\n\t\tselection() {\n\t\t\tthis.panelForParts = null;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\nfieldset {\n\ttable {\n\t\twidth: 100%;\n\t}\n}\n\n.panel:not(.vertical) {\n\tfieldset {\n\t\tmax-height: 100%;\n\t\toverflow: auto;\n\t}\n}\n\n.panel.vertical {\n\tfieldset {\n\t\tinput {\n\t\t\twidth: 60px;\n\t\t}\n\t}\n}\n\n.middle-button {\n\twidth: 100%;\n}\n\n.arrow-col {\n\twidth: 24px;\n\n\tbutton {\n\t\twidth: 24px;\n\t}\n}\n</style>\n","<template>\n\t<d-fieldset :title=\"'Position' + (allowSize ? '/Size' : '')\">\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t<toggle\n\t\t\t\t\t\tv-if=\"allowStepMove\"\n\t\t\t\t\t\tv-model=\"freeMove\"\n\t\t\t\t\t\tlabel=\"Move freely?\"\n\t\t\t\t\t/>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr v-if=\"allowStepMove && !freeMove\">\n\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t<table>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"--pos\" :disabled=\"isFirstPos\">&lt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<select id=\"current_talking\" v-model.number=\"pos\">\n\t\t\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\t\t\tv-for=\"(val, key) of positionNames\"\n\t\t\t\t\t\t\t\t\t\t:key=\"key\"\n\t\t\t\t\t\t\t\t\t\t:value=\"key\"\n\t\t\t\t\t\t\t\t\t\t>{{ val }}</option\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"++pos\" :disabled=\"isLastPos\">&gt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<template v-else>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"sprite_x\">X:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"sprite_x\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model.number=\"x\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"sprite_y\">Y:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"sprite_y\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model.number=\"y\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</template>\n\t\t\t<template v-if=\"allowSize\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"sprite_w\">Width:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"sprite_w\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model.number=\"width\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"sprite_h\">Height:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"sprite_h\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model.number=\"height\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t<toggle v-model=\"preserveRatio\" label=\"Lock ratio?\" />\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</template>\n\t\t</table>\n\t</d-fieldset>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { positions, characterPositions } from '@/constants/base';\nimport {\n\tclosestCharacterSlot,\n\tISetFreeMoveMutation,\n\tICharacter,\n} from '@/store/objectTypes/characters';\nimport {\n\tISetPositionAction,\n\tISetObjectPositionMutation,\n\tIObject,\n\tISetHeightAction,\n\tISetWidthAction,\n\tISetRatioAction,\n} from '@/store/objects';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tprops: {\n\t\tobj: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\tcomputed: {\n\t\tfreeMove: {\n\t\t\tget(): boolean {\n\t\t\t\treturn (this.obj! as ICharacter).freeMove;\n\t\t\t},\n\t\t\tset(freeMove: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setFreeMove', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tfreeMove,\n\t\t\t\t\t} as ISetFreeMoveMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tpreserveRatio: {\n\t\t\tget(): boolean {\n\t\t\t\treturn (this.obj! as ICharacter).preserveRatio;\n\t\t\t},\n\t\t\tset(preserveRatio: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPreserveRatio', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tpreserveRatio,\n\t\t\t\t\t} as ISetRatioAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tpos: {\n\t\t\tget(): number {\n\t\t\t\treturn closestCharacterSlot(this.obj!.x);\n\t\t\t},\n\t\t\tset(value: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx: characterPositions[value],\n\t\t\t\t\t\ty: this.obj!.y,\n\t\t\t\t\t} as ISetPositionAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tx: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.x;\n\t\t\t},\n\t\t\tset(x: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty: this.y,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ty: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.y;\n\t\t\t},\n\t\t\tset(y: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx: this.x,\n\t\t\t\t\t\ty,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\theight: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.height;\n\t\t\t},\n\t\t\tset(height: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setHeight', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\theight,\n\t\t\t\t\t} as ISetHeightAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\twidth: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.width;\n\t\t\t},\n\t\t\tset(width: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setWidth', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\twidth,\n\t\t\t\t\t} as ISetWidthAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tallowSize(): boolean {\n\t\t\tconst obj = this.obj!;\n\t\t\tif (obj.type === 'textBox' && (obj as ITextBox).style !== 'custom') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (obj.type === 'character' && !(obj as ICharacter).freeMove) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\tallowStepMove(): boolean {\n\t\t\treturn 'freeMove' in this.obj!;\n\t\t},\n\t\tpositionNames(): string[] {\n\t\t\treturn positions;\n\t\t},\n\n\t\tisFirstPos(): boolean {\n\t\t\treturn this.pos === 0;\n\t\t},\n\n\t\tisLastPos(): boolean {\n\t\t\treturn this.pos === positions.length - 1;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\nfieldset {\n\t> table {\n\t\twidth: 100%;\n\n\t\t> tr > td:nth-child(2) {\n\t\t\twidth: 64px;\n\t\t}\n\n\t\ttable {\n\t\t\twidth: 100%;\n\t\t\tselect {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.vertical {\n\tfieldset {\n\t\tinput {\n\t\t\twidth: 64px;\n\t\t}\n\t}\n}\n\ninput {\n\twidth: 80px;\n}\n\n.arrow-col {\n\twidth: 24px;\n\n\tbutton {\n\t\twidth: 24px;\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { positions, characterPositions } from '@/constants/base';\nimport {\n\tclosestCharacterSlot,\n\tISetFreeMoveMutation,\n\tICharacter,\n} from '@/store/objectTypes/characters';\nimport {\n\tISetPositionAction,\n\tISetObjectPositionMutation,\n\tIObject,\n\tISetHeightAction,\n\tISetWidthAction,\n\tISetRatioAction,\n} from '@/store/objects';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tprops: {\n\t\tobj: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\tcomputed: {\n\t\tfreeMove: {\n\t\t\tget(): boolean {\n\t\t\t\treturn (this.obj! as ICharacter).freeMove;\n\t\t\t},\n\t\t\tset(freeMove: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setFreeMove', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tfreeMove,\n\t\t\t\t\t} as ISetFreeMoveMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tpreserveRatio: {\n\t\t\tget(): boolean {\n\t\t\t\treturn (this.obj! as ICharacter).preserveRatio;\n\t\t\t},\n\t\t\tset(preserveRatio: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPreserveRatio', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tpreserveRatio,\n\t\t\t\t\t} as ISetRatioAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tpos: {\n\t\t\tget(): number {\n\t\t\t\treturn closestCharacterSlot(this.obj!.x);\n\t\t\t},\n\t\t\tset(value: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx: characterPositions[value],\n\t\t\t\t\t\ty: this.obj!.y,\n\t\t\t\t\t} as ISetPositionAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tx: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.x;\n\t\t\t},\n\t\t\tset(x: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty: this.y,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ty: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.y;\n\t\t\t},\n\t\t\tset(y: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx: this.x,\n\t\t\t\t\t\ty,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\theight: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.height;\n\t\t\t},\n\t\t\tset(height: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setHeight', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\theight,\n\t\t\t\t\t} as ISetHeightAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\twidth: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.width;\n\t\t\t},\n\t\t\tset(width: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setWidth', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\twidth,\n\t\t\t\t\t} as ISetWidthAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tallowSize(): boolean {\n\t\t\tconst obj = this.obj!;\n\t\t\tif (obj.type === 'textBox' && (obj as ITextBox).style !== 'custom') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (obj.type === 'character' && !(obj as ICharacter).freeMove) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\tallowStepMove(): boolean {\n\t\t\treturn 'freeMove' in this.obj!;\n\t\t},\n\t\tpositionNames(): string[] {\n\t\t\treturn positions;\n\t\t},\n\n\t\tisFirstPos(): boolean {\n\t\t\treturn this.pos === 0;\n\t\t},\n\n\t\tisLastPos(): boolean {\n\t\t\treturn this.pos === positions.length - 1;\n\t\t},\n\t},\n});\n","import { render } from \"./positionAndSize.vue?vue&type=template&id=7f101752&scoped=true&bindings={}\"\nimport script from \"./positionAndSize.vue?vue&type=script&lang=ts\"\nexport * from \"./positionAndSize.vue?vue&type=script&lang=ts\"\n\nimport \"./positionAndSize.vue?vue&type=style&index=0&id=7f101752&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-7f101752\"\n\nexport default script","<template>\n\t<d-fieldset id=\"layerfs\" title=\"Layer:\">\n\t\t<table>\n\t\t\t<tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"shiftLayer(-Infinity)\" title=\"Move to back\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">vertical_align_bottom</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"shiftLayer(-1)\" title=\"Move backwards\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">arrow_downward</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"shiftLayer(1)\" title=\"Move forwards\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">arrow_upward</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"shiftLayer(Infinity)\" title=\"Move to front\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">vertical_align_top</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t\t<toggle v-model=\"onTop\" label=\"In front?\" />\n\t</d-fieldset>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { IObjectShiftLayerAction, IObject } from '@/store/objects';\nimport { genericSetable } from '@/util/simpleSettable';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tprops: {\n\t\tobject: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\tcomputed: {\n\t\tonTop: genericSetable<IObject>()('onTop', 'objects/setOnTop', true),\n\t},\n\tmethods: {\n\t\tshiftLayer(delta: number) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/shiftLayer', {\n\t\t\t\t\tid: this.object!.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as IObjectShiftLayerAction);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\ntable {\n\twidth: 100%;\n\n\tbutton {\n\t\twidth: 100%;\n\t}\n}\n</style>\n","import { IObject } from '@/store/objects';\r\nimport { ComponentCustomProperties } from 'vue';\r\n\r\nexport function genericSetable<T extends IObject>() {\r\n\treturn function setable<K extends keyof T>(\r\n\t\tkey: K,\r\n\t\tmessage: string,\r\n\t\taction = false\r\n\t) {\r\n\t\treturn {\r\n\t\t\tget(this: IThis<T>): T[K] {\r\n\t\t\t\treturn this.object[key];\r\n\t\t\t},\r\n\t\t\tset(this: IThis<T>, val: T[K]): void {\r\n\t\t\t\tthis.vuexHistory.transaction(() => {\r\n\t\t\t\t\tthis.$store[action ? 'dispatch' : 'commit'](message, {\r\n\t\t\t\t\t\tid: this.object.id,\r\n\t\t\t\t\t\t[key]: val,\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t};\r\n\t};\r\n}\r\n\r\ninterface IThis<T extends IObject> extends ComponentCustomProperties {\r\n\tobject: T;\r\n}\r\n","\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { IObjectShiftLayerAction, IObject } from '@/store/objects';\nimport { genericSetable } from '@/util/simpleSettable';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tprops: {\n\t\tobject: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\tcomputed: {\n\t\tonTop: genericSetable<IObject>()('onTop', 'objects/setOnTop', true),\n\t},\n\tmethods: {\n\t\tshiftLayer(delta: number) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/shiftLayer', {\n\t\t\t\t\tid: this.object!.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as IObjectShiftLayerAction);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./layers.vue?vue&type=template&id=90b83fd8&scoped=true&bindings={}\"\nimport script from \"./layers.vue?vue&type=script&lang=ts\"\nexport * from \"./layers.vue?vue&type=script&lang=ts\"\n\nimport \"./layers.vue?vue&type=style&index=0&id=90b83fd8&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-90b83fd8\"\n\nexport default script","<template>\n\t<button @click=\"onClick\">Delete</button>\n</template>\n\n<script lang=\"ts\">\nimport { IObject, IRemoveObjectAction } from '@/store/objects';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tobj: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\n\tmethods: {\n\t\tonClick() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t} as IRemoveObjectAction);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n","\nimport { IObject, IRemoveObjectAction } from '@/store/objects';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tobj: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\n\tmethods: {\n\t\tonClick() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t} as IRemoveObjectAction);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./delete.vue?vue&type=template&id=8ad92c36&bindings={}\"\nimport script from \"./delete.vue?vue&type=script&lang=ts\"\nexport * from \"./delete.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n\t<color\n\t\tv-if=\"showShadowColor\"\n\t\tv-model=\"shadowColor\"\n\t\tformat=\"rgb\"\n\t\t@leave=\"showShadowColor = false\"\n\t/>\n\t<d-flow v-else no-wraping class=\"image-options-subpanel\">\n\t\t<h2>Image options</h2>\n\t\t<div class=\"column ok-col\">\n\t\t\t<button @click=\"$emit('leave')\">Back</button>\n\t\t</div>\n\t\t<div class=\"column\">\n\t\t\t<label for=\"compositionSelect\">Compositing Mode:</label\n\t\t\t><a\n\t\t\t\thref=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation#Types\"\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t>[?]</a\n\t\t\t>\n\t\t\t<select id=\"compositionSelect\" v-model=\"compositionMode\" @keydown.stop>\n\t\t\t\t<option value=\"source-over\">source-over</option>\n\t\t\t\t<!--\n\t\t\t\t<option value=\"source-in\">source-in</option>\n\t\t\t\t<option value=\"source-out\">source-out</option>\n\t\t\t\t-->\n\t\t\t\t<option value=\"source-atop\">source-atop</option>\n\t\t\t\t<option value=\"destination-over\">destination-over</option>\n\t\t\t\t<option value=\"destination-in\">destination-in</option>\n\t\t\t\t<option value=\"destination-in\">destination-out</option>\n\t\t\t\t<option value=\"destination-in\">destination-atop</option>\n\t\t\t\t<option value=\"lighter\">lighter</option>\n\t\t\t\t<option value=\"xor\">xor</option>\n\t\t\t\t<option value=\"multiply\">multiply</option>\n\t\t\t\t<option value=\"screen\">screen</option>\n\t\t\t\t<option value=\"overlay\">overlay</option>\n\t\t\t\t<option value=\"darken\">darken</option>\n\t\t\t\t<option value=\"lighten\">lighten</option>\n\t\t\t\t<option value=\"color-dodge\">color-dodge</option>\n\t\t\t\t<option value=\"color-burn\">color-burn</option>\n\t\t\t\t<option value=\"hard-light\">hard-light</option>\n\t\t\t\t<option value=\"soft-light\">soft-light</option>\n\t\t\t\t<option value=\"difference\">difference</option>\n\t\t\t\t<option value=\"exclusion\">exclusion</option>\n\t\t\t\t<option value=\"hue\">hue</option>\n\t\t\t\t<option value=\"saturation\">saturation</option>\n\t\t\t\t<option value=\"color\">color</option>\n\t\t\t\t<option value=\"luminosity\">luminosity</option>\n\t\t\t</select>\n\t\t</div>\n\t\t<d-fieldset title=\"Effects\">\n\t\t\t<d-flow class=\"filter-flow\" no-wraping gap=\"8px\">\n\t\t\t\t<d-flow direction=\"vertical\" no-wraping>\n\t\t\t\t\t<label for=\"addEffect\">Add new effect</label>\n\t\t\t\t\t<select id=\"addEffect\" v-model=\"addEffectSelection\" @keydown.stop>\n\t\t\t\t\t\t<option\n\t\t\t\t\t\t\tv-for=\"filterType of filterTypes\"\n\t\t\t\t\t\t\t:key=\"filterType\"\n\t\t\t\t\t\t\t:value=\"filterType\"\n\t\t\t\t\t\t\t>{{ getFilterLabel(filterType) }}</option\n\t\t\t\t\t\t>\n\t\t\t\t\t</select>\n\t\t\t\t\t<button\n\t\t\t\t\t\t:disabled=\"addEffectSelection === ''\"\n\t\t\t\t\t\t@click=\"addFilter\"\n\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t>\n\t\t\t\t\t\tAdd\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\t:disabled=\"!currentFilter\"\n\t\t\t\t\t\t@click=\"removeFilter\"\n\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t>\n\t\t\t\t\t\tRemove\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\t:disabled=\"currentFilterIdx === 0\"\n\t\t\t\t\t\t@click=\"moveFilter(-1)\"\n\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t>\n\t\t\t\t\t\tMove up\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\t:disabled=\"currentFilterIdx === filters.length - 1\"\n\t\t\t\t\t\t@click=\"moveFilter(1)\"\n\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t>\n\t\t\t\t\t\tMove down\n\t\t\t\t\t</button>\n\t\t\t\t</d-flow>\n\t\t\t\t<d-flow maxSize=\"100%\" direction=\"vertical\" no-wraping>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for=\"(filter, filterIdx) in filters\"\n\t\t\t\t\t\t:key=\"filterIdx\"\n\t\t\t\t\t\t:class=\"{ choiceBtn: true, active: filterIdx === currentFilterIdx }\"\n\t\t\t\t\t\t@click=\"selectFilter(filterIdx)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ getFilterText(filter) }}\n\t\t\t\t\t</div>\n\t\t\t\t</d-flow>\n\t\t\t\t<table v-if=\"currentFilter\" class=\"value-input-table\">\n\t\t\t\t\t<template v-if=\"currentFilter.type === 'drop-shadow'\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"shadow_color\">Color:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tid=\"shadow_color\"\n\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t:style=\"{ background: shadowColor }\"\n\t\t\t\t\t\t\t\t\t@click=\"showShadowColor = true\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_x\">X:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_x\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tv-model.number=\"shadowX\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_y\">Y:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_y\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tv-model.number=\"shadowY\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_blur\">Blur:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_blur\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tv-model.number=\"shadowBlur\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"isPercentFilter\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_value\">Value:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_value\"\n\t\t\t\t\t\t\t\t\t:value=\"(currentFilter.value * 100).toFixed()\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t:max=\"maxValue\"\n\t\t\t\t\t\t\t\t\t:min=\"minValue\"\n\t\t\t\t\t\t\t\t\t@input=\"\n\t\t\t\t\t\t\t\t\t\tsetValue({ value: Number($event.target.value / 100) })\n\t\t\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>%\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_value\">Value:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_value\"\n\t\t\t\t\t\t\t\t\t:value=\"currentFilter.value\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t:max=\"maxValue\"\n\t\t\t\t\t\t\t\t\t:min=\"minValue\"\n\t\t\t\t\t\t\t\t\t@input=\"setValue({ value: Number($event.target.value) })\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</template>\n\t\t\t\t</table>\n\t\t\t</d-flow>\n\t\t</d-fieldset>\n\t</d-flow>\n</template>\n\n<script lang=\"ts\">\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport Color from '@/components/toolbox/subtools/color/color.vue';\nimport { defineComponent, Prop, PropType } from 'vue';\nimport { CompositeModes } from '@/renderer/rendererContext';\nimport { DeepReadonly } from '@/util/readonly';\nimport {\n\tIHasSpriteFilters,\n\tINumericSpriteFilter,\n\tpercentageValue,\n\tSpriteFilter,\n} from '@/store/sprite_options';\nimport { exhaust } from '@/util/exhaust';\nimport {\n\tIAddFilterAction,\n\tIMoveFilterAction,\n\tIRemoveFilterAction,\n\tISetCompositionMutation,\n\tISetFilterAction,\n} from '@/store/objects';\n\nconst filterText: ReadonlyMap<SpriteFilter['type'], string> = new Map<\n\tSpriteFilter['type'],\n\tstring\n>([\n\t['blur', 'Blur'],\n\t['brightness', 'Brightness'],\n\t['contrast', 'Contrast'],\n\t['grayscale', 'Grayscale'],\n\t['hue-rotate', 'Rotate hue'],\n\t['invert', 'Invert colors'],\n\t['opacity', 'Opacity'],\n\t['saturate', 'Saturate'],\n\t['sepia', 'Sepia'],\n\t['drop-shadow', 'Drop shadow'],\n]);\n\nconst filters: ReadonlyArray<SpriteFilter['type']> = Array.from(\n\tfilterText.keys()\n).sort();\n\nexport default defineComponent({\n\tcomponents: { DFlow, DFieldset, Color },\n\tprops: {\n\t\ttype: {\n\t\t\ttype: String as PropType<'object' | 'background' | 'panel'>,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tid: {\n\t\t\trequired: true,\n\t\t} as Prop<string | number>,\n\t},\n\tdata: () => ({\n\t\taddEffectSelection: '' as SpriteFilter['type'] | '',\n\t\tcurrentFilterIdx: 0,\n\t\tshowShadowColor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): DeepReadonly<IHasSpriteFilters> {\n\t\t\tswitch (this.type) {\n\t\t\t\tcase 'object':\n\t\t\t\t\treturn this.$store.state.objects.objects[this.id!];\n\t\t\t\tcase 'background':\n\t\t\t\t\treturn this.$store.state.panels.panels[this.id!].background;\n\t\t\t\tcase 'panel':\n\t\t\t\t\treturn this.$store.state.panels.panels[this.id!];\n\t\t\t\tdefault:\n\t\t\t\t\texhaust(this.type);\n\t\t\t\t\treturn null!;\n\t\t\t}\n\t\t},\n\t\tcompositionMode: {\n\t\t\tget(): CompositeModes {\n\t\t\t\treturn this.object.composite;\n\t\t\t},\n\t\t\tset(composite: CompositeModes): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tswitch (this.type) {\n\t\t\t\t\t\tcase 'object':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setComposition', {\n\t\t\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\t\t\tcomposite,\n\t\t\t\t\t\t\t} as ISetCompositionMutation);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'background':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'panel':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\texhaust(this.type);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tfilters(): DeepReadonly<SpriteFilter[]> {\n\t\t\treturn this.object.filters;\n\t\t},\n\t\tfilterTypes(): ReadonlyArray<SpriteFilter['type']> {\n\t\t\treturn filters;\n\t\t},\n\t\tcurrentFilter(): DeepReadonly<SpriteFilter> | null {\n\t\t\treturn this.filters[this.currentFilterIdx] || null;\n\t\t},\n\t\tisPercentFilter(): boolean {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return false;\n\t\t\treturn percentageValue.has(filter.type);\n\t\t},\n\t\tmaxValue(): number | undefined {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return undefined;\n\n\t\t\tif (filter.type === 'hue-rotate') return 360;\n\t\t\tif (\n\t\t\t\tfilter.type === 'grayscale' ||\n\t\t\t\tfilter.type === 'sepia' ||\n\t\t\t\tfilter.type === 'opacity' ||\n\t\t\t\tfilter.type === 'invert'\n\t\t\t)\n\t\t\t\treturn 100;\n\n\t\t\treturn undefined;\n\t\t},\n\t\tminValue(): number | undefined {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return undefined;\n\n\t\t\tswitch (filter.type) {\n\t\t\t\tcase 'blur':\n\t\t\t\tcase 'brightness':\n\t\t\t\tcase 'contrast':\n\t\t\t\tcase 'grayscale':\n\t\t\t\tcase 'hue-rotate':\n\t\t\t\tcase 'invert':\n\t\t\t\tcase 'opacity':\n\t\t\t\tcase 'saturate':\n\t\t\t\tcase 'sepia':\n\t\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t},\n\t\tshadowColor: {\n\t\t\tget(): string | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('color' in filter)) return undefined;\n\t\t\t\treturn filter.color;\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.setValue({ color });\n\t\t\t},\n\t\t},\n\t\tshadowX: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('offsetX' in filter)) return undefined;\n\t\t\t\treturn filter.offsetX;\n\t\t\t},\n\t\t\tset(offsetX: number) {\n\t\t\t\tthis.setValue({ offsetX });\n\t\t\t},\n\t\t},\n\t\tshadowY: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('offsetY' in filter)) return undefined;\n\t\t\t\treturn filter.offsetY;\n\t\t\t},\n\t\t\tset(offsetY: number) {\n\t\t\t\tthis.setValue({ offsetY });\n\t\t\t},\n\t\t},\n\t\tshadowBlur: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('blurRadius' in filter)) return undefined;\n\t\t\t\treturn filter.blurRadius;\n\t\t\t},\n\t\t\tset(blurRadius: number) {\n\t\t\t\tthis.setValue({ blurRadius });\n\t\t\t},\n\t\t},\n\t},\n\tmethods: {\n\t\tgetFilterLabel(type: SpriteFilter['type']): string {\n\t\t\treturn filterText.get(type)!;\n\t\t},\n\t\tgetFilterText(filter: SpriteFilter): string {\n\t\t\tif (percentageValue.has(filter.type)) {\n\t\t\t\treturn `${filterText.get(filter.type)} ${(\n\t\t\t\t\t(filter as INumericSpriteFilter<any>).value * 100\n\t\t\t\t).toFixed()}%`;\n\t\t\t} else if (filter.type === 'hue-rotate') {\n\t\t\t\treturn `${filterText.get(filter.type)} ${filter.value.toFixed()}°`;\n\t\t\t} else if (filter.type === 'blur') {\n\t\t\t\treturn `${filterText.get(filter.type)} ${filter.value.toFixed()}px`;\n\t\t\t}\n\t\t\treturn filterText.get(filter.type)!;\n\t\t},\n\t\taddFilter() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/addFilter', {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\ttype: this.addEffectSelection,\n\t\t\t\t\tidx: this.currentFilterIdx + 1,\n\t\t\t\t} as IAddFilterAction);\n\t\t\t});\n\t\t},\n\t\tselectFilter(idx: number) {\n\t\t\tthis.currentFilterIdx = idx;\n\t\t},\n\t\tremoveFilter() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/removeFilter', {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t} as IRemoveFilterAction);\n\t\t\t});\n\t\t},\n\t\tmoveFilter(moveBy: number) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/moveFilter', {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t\tmoveBy,\n\t\t\t\t} as IMoveFilterAction);\n\t\t\t\tthis.currentFilterIdx += moveBy;\n\t\t\t});\n\t\t},\n\t\tsetValue(value: Omit<ISetFilterAction, 'id' | 'idx'>) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setFilter', {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t\t...value,\n\t\t\t\t} as ISetFilterAction);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.image-options-subpanel {\n\t&.vertical {\n\t\t.column {\n\t\t\twidth: 100%;\n\t\t\tmargin-top: 8px;\n\n\t\t\tbutton,\n\t\t\tselect {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t.column {\n\t\t\tdisplay: flex;\n\t\t\t@include height-100();\n\t\t\tflex-direction: column;\n\t\t\tflex-wrap: wrap;\n\t\t\tmargin-left: 8px;\n\t\t}\n\t\t.ok-col {\n\t\t\twidth: 42px;\n\t\t\tbutton {\n\t\t\t\t@include height-100();\n\t\t\t}\n\t\t}\n\n\t\t.filter-flow {\n\t\t\t> .vertical {\n\t\t\t\twidth: auto;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.choiceBtn {\n\toverflow: hidden;\n\twidth: 100%;\n\theight: 24px;\n\ttext-overflow: ellipsis;\n\tpadding: 2px;\n\n\t&.active {\n\t\tbackground-color: #ffbde1;\n\t}\n}\n\n.value-input-table {\n\ttd {\n\t\tvertical-align: top;\n\t}\n\tinput,\n\t.color-button {\n\t\twidth: 100px;\n\t}\n}\n</style>\n","\r\nimport { defineComponent, h, Prop, PropType, VNode } from 'vue';\r\nimport { VerticalScrollRedirect } from '../vertical-scroll-redirect';\r\nexport default defineComponent({\r\n\tmixins: [VerticalScrollRedirect],\r\n\tprops: {\r\n\t\t/**\r\n\t\t * Indicates whether or not line-breaks are allowed. Otherwise all elements automatically get the maximum\r\n\t\t * width/hight (depending on direction)\r\n\t\t */\r\n\t\tnoWraping: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false,\r\n\t\t},\r\n\t\tdirection: {\r\n\t\t\ttype: String as PropType<\r\n\t\t\t\t'global' | 'inverted' | 'horizontal' | 'vertical'\r\n\t\t\t>,\r\n\t\t\tdefault: 'global',\r\n\t\t},\r\n\t\tmaxSize: {} as Prop<string | [string, string]>,\r\n\t\tgap: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: '0px',\r\n\t\t},\r\n\t},\r\n\tcomputed: {\r\n\t\tfinalDirection(): 'horizontal' | 'vertical' {\r\n\t\t\tif (this.direction === 'global') {\r\n\t\t\t\treturn this.$store.state.ui.vertical ? 'vertical' : 'horizontal';\r\n\t\t\t}\r\n\t\t\tif (this.direction === 'inverted') {\r\n\t\t\t\treturn this.$store.state.ui.vertical ? 'horizontal' : 'vertical';\r\n\t\t\t}\r\n\t\t\treturn this.direction;\r\n\t\t},\r\n\t},\r\n\trender(): VNode {\r\n\t\tconst wrapingClass = this.noWraping ? 'no-wraping' : 'wraping';\r\n\t\tconst attrs: { [s: string]: any } = {};\r\n\t\tconst flowContainer = h(\r\n\t\t\t'div',\r\n\t\t\t{\r\n\t\t\t\t...attrs,\r\n\t\t\t\tclass: ['d-flow', this.finalDirection, wrapingClass],\r\n\t\t\t\tstyle: {\r\n\t\t\t\t\tgap: this.gap,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tthis.$slots.default!()\r\n\t\t);\r\n\t\tif (this.maxSize) {\r\n\t\t\tconst maxSize =\r\n\t\t\t\tthis.maxSize instanceof Array\r\n\t\t\t\t\t? this.maxSize[this.finalDirection === 'horizontal' ? 0 : 1]\r\n\t\t\t\t\t: this.maxSize;\r\n\t\t\treturn h(\r\n\t\t\t\t'div',\r\n\t\t\t\t{\r\n\t\t\t\t\tref: 'scrollContainer',\r\n\t\t\t\t\tclass: ['d-flow-scroll-container', this.finalDirection],\r\n\t\t\t\t\tstyle: {\r\n\t\t\t\t\t\t[this.finalDirection === 'horizontal'\r\n\t\t\t\t\t\t\t? 'maxWidth'\r\n\t\t\t\t\t\t\t: 'maxHeight']: maxSize,\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t[flowContainer]\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn flowContainer;\r\n\t},\r\n\tmounted() {\r\n\t\tif (this.$refs.scrollContainer) {\r\n\t\t\t(this.$refs.scrollContainer as HTMLDivElement).addEventListener(\r\n\t\t\t\t'wheel',\r\n\t\t\t\t(this as any).verticalScrollRedirect\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n});\r\n","import script from \"./d-flow.vue?vue&type=script&lang=ts\"\nexport * from \"./d-flow.vue?vue&type=script&lang=ts\"\n\nimport \"./d-flow.vue?vue&type=style&index=0&id=01fb80b6&lang=scss&scoped=true\"\nscript.__scopeId = \"data-v-01fb80b6\"\n\nexport default script","<template>\n\t<div :class=\"{ color: true, vertical }\">\n\t\t<h2>{{ title }}</h2>\n\t\t<button @click=\"$emit('leave')\">OK</button>\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td>\n\t\t\t\t\t<button @click=\"mode = 'hsla'\">HSLA</button>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<button @click=\"mode = 'rgba'\">RGBA</button>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\n\t\t<div class=\"column\">\n\t\t\t<slider-group :mode=\"mode\" v-model=\"color\" :relative=\"true\" />\n\t\t\t<div class=\"hex-selector\">\n\t\t\t\t<label class=\"hex-label\" :for=\"`hex_${_.uid}`\">Hex</label>\n\t\t\t\t<input :id=\"`hex_${_.uid}`\" :modelValue=\"color\" @input=\"updateHex\" />\n\t\t\t</div>\n\t\t\t<button @click=\"addSwatch\">Add as swatch</button>\n\t\t</div>\n\t\t<div id=\"color-swatches\" :class=\"{ vertical }\">\n\t\t\t<button\n\t\t\t\tv-for=\"swatch of swatches\"\n\t\t\t\tclass=\"swatch\"\n\t\t\t\t:key=\"swatch.color\"\n\t\t\t\t:style=\"{ backgroundColor: swatch.color }\"\n\t\t\t\t:title=\"swatch.label\"\n\t\t\t\t@click=\"\n\t\t\t\t\tcolor = swatch.color;\n\t\t\t\t\t$emit('leave');\n\t\t\t\t\"\n\t\t\t></button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport {\n\tColor,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport SliderGroup from './sliderGroup.vue';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { defineComponent, PropType } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nconst generatedPackId = 'dddg.generated.colors';\n\nexport default defineComponent({\n\tcomponents: {\n\t\tSliderGroup,\n\t},\n\tprops: {\n\t\tmodelValue: {\n\t\t\trequired: true,\n\t\t\ttype: String,\n\t\t},\n\t\ttitle: { default: '' },\n\t\tformat: {\n\t\t\ttype: String as PropType<'rgb' | 'hex'>,\n\t\t\tdefault: 'hex',\n\t\t},\n\t},\n\tdata: () => ({\n\t\tmode: 'hsla',\n\t\trelative: true,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tswatches(): DeepReadonly<Color[]> {\n\t\t\treturn this.$store.state.content.current.colors;\n\t\t},\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\tif (this.format === 'rgb') {\n\t\t\t\t\tconst rgb = RGBAColor.fromCss(this.modelValue);\n\t\t\t\t\treturn rgb.toHex();\n\t\t\t\t} else {\n\t\t\t\t\treturn this.modelValue;\n\t\t\t\t}\n\t\t\t},\n\t\t\tset(newColor: string) {\n\t\t\t\tif (this.format === 'rgb') {\n\t\t\t\t\tconst rgb = RGBAColor.fromCss(newColor);\n\t\t\t\t\tthis.$emit('update:modelValue', rgb.toCss());\n\t\t\t\t} else {\n\t\t\t\t\tthis.$emit('update:modelValue', newColor);\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n\tmethods: {\n\t\tupdateHex(event: Event) {\n\t\t\tconst hex = (event.target as HTMLInputElement).value;\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\tif (RGBAColor.validHex(hex) && (hex.length === 7 || hex.length === 9)) {\n\t\t\t\tthis.color = hex;\n\t\t\t}\n\t\t},\n\t\taddSwatch() {\n\t\t\tif (this.swatches.find(swatch => swatch.color === this.color)) return;\n\n\t\t\tconst existingPack = this.$store.state.content.contentPacks.find(\n\t\t\t\tpack => pack.packId === 'generatedPackId'\n\t\t\t) || {\n\t\t\t\tpackId: generatedPackId,\n\t\t\t\tpackCredits: [''],\n\t\t\t\tdependencies: [],\n\t\t\t\tcharacters: [],\n\t\t\t\tfonts: [],\n\t\t\t\tbackgrounds: [],\n\t\t\t\tsprites: [],\n\t\t\t\tpoemStyles: [],\n\t\t\t\tpoemBackgrounds: [],\n\t\t\t\tcolors: [],\n\t\t\t};\n\n\t\t\tconst newPack: ContentPack<IAsset> = {\n\t\t\t\t...existingPack,\n\t\t\t\tcolors: [\n\t\t\t\t\t...existingPack.colors,\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: this.color,\n\t\t\t\t\t\tcolor: this.color,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t} as any;\n\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: newPack,\n\t\t\t\t\tprocessed: true,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.color {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\n\th2 {\n\t\tfont-size: 20px;\n\t\tcolor: black;\n\t\tfont-family: riffic, sans-serif;\n\t\ttext-align: center;\n\t}\n\n\t&.vertical {\n\t\tflex-direction: row;\n\t\twidth: 100%;\n\n\t\t.column {\n\t\t\twidth: 100%;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\tflex-direction: column;\n\t\theight: 100%;\n\n\t\th2 {\n\t\t\twriting-mode: vertical-rl;\n\t\t\theight: 100%;\n\t\t}\n\n\t\t.column {\n\t\t\theight: 100%;\n\t\t}\n\t}\n}\n\n.hex-selector {\n\tdisplay: table;\n\tlabel {\n\t\ttext-align: right;\n\t\twidth: 100px;\n\t}\n\n\tinput {\n\t\tmargin-left: 7px;\n\t}\n\n\t&.vertical {\n\t\t> * {\n\t\t\tdisplay: table-row;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t> * {\n\t\t\tdisplay: table-cell;\n\t\t\tvertical-align: middle;\n\t\t}\n\t}\n}\n\n#color-swatches {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: space-evenly;\n\n\t&.vertical {\n\t\tmargin-top: 4px;\n\t\twidth: 100%;\n\t\tflex-direction: row;\n\t}\n\n\t&:not(.vertical) {\n\t\tmargin-left: 4px;\n\t\theight: 100%;\n\t\tflex-direction: column;\n\t}\n\n\t.swatch {\n\t\theight: 42px;\n\t\twidth: 42px;\n\t\tmargin: 1px;\n\t\tborder-color: black;\n\t}\n}\n</style>\n","<template>\n\t<div>\n\t\t<slider\n\t\t\t:label=\"label1\"\n\t\t\tv-model=\"v1\"\n\t\t\t:max-value=\"maxValue1\"\n\t\t\t:gradient-stops=\"stops1\"\n\t\t/>\n\t\t<slider\n\t\t\t:label=\"label2\"\n\t\t\tv-model=\"v2\"\n\t\t\t:max-value=\"maxValue2\"\n\t\t\t:gradient-stops=\"stops2\"\n\t\t/>\n\t\t<slider\n\t\t\t:label=\"label3\"\n\t\t\tv-model=\"v3\"\n\t\t\t:max-value=\"maxValue3\"\n\t\t\t:gradient-stops=\"stops3\"\n\t\t/>\n\t\t<slider\n\t\t\tlabel=\"Alpha\"\n\t\t\tv-model=\"a\"\n\t\t\t:max-value=\"255\"\n\t\t\t:gradient-stops=\"stopsAlpha\"\n\t\t/>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { IColor } from '@/util/colors/color';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { HSLAColor } from '@/util/colors/hsl';\nimport Slider from './slider.vue';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Slider },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\tvalidator: (val: string): boolean => !!val.match(/^#[0-9a-f]{6,8}$/i),\n\t\t},\n\t\tmode: {\n\t\t\ttype: String,\n\t\t} as Prop<'hsla' | 'rgba'>,\n\t\trelative: Boolean,\n\t},\n\tdata: () => ({\n\t\tlastRGBEmit: null as string | null,\n\t\tv1: 0,\n\t\tv2: 0,\n\t\tv3: 0,\n\t\ta: 0,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tmaxValue1(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 360;\n\t\t},\n\t\tlabel1(): string {\n\t\t\tif (this.mode === 'rgba') return 'Red';\n\t\t\treturn 'Hue';\n\t\t},\n\t\tstops1(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst g = this.relative ? this.v2 : 0;\n\t\t\t\tconst b = this.relative ? this.v3 : 0;\n\t\t\t\tstops = [new RGBAColor(0, g, b, 1), new RGBAColor(255, g, b, 1)];\n\t\t\t} else {\n\t\t\t\tconst s = this.relative ? this.v2 / 100 : 1;\n\t\t\t\tconst l = this.relative ? this.v3 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(i, s, l, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tmaxValue2(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 100;\n\t\t},\n\t\tlabel2(): string {\n\t\t\tif (this.mode === 'rgba') return 'Green';\n\t\t\treturn 'Saturation';\n\t\t},\n\t\tstops2(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst r = this.relative ? this.v1 : 0;\n\t\t\t\tconst b = this.relative ? this.v3 : 0;\n\t\t\t\tstops = [new RGBAColor(r, 0, b, 1), new RGBAColor(r, 255, b, 1)];\n\t\t\t} else {\n\t\t\t\tconst h = this.relative ? this.v1 / 360 : 0;\n\t\t\t\tconst l = this.relative ? this.v3 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(h, i, l, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tmaxValue3(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 100;\n\t\t},\n\t\tlabel3(): string {\n\t\t\tif (this.mode === 'rgba') return 'Blue';\n\t\t\treturn 'Luminosity';\n\t\t},\n\t\tstops3(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst r = this.relative ? this.v1 : 0;\n\t\t\t\tconst g = this.relative ? this.v2 : 0;\n\t\t\t\tstops = [new RGBAColor(r, g, 0, 1), new RGBAColor(r, g, 255, 1)];\n\t\t\t} else {\n\t\t\t\tconst h = this.relative ? this.v1 / 360 : 0;\n\t\t\t\tconst s = this.relative ? this.v2 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(h, s, i, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tstopsAlpha(): string[] {\n\t\t\tconst color = RGBAColor.fromHex(this.modelValue!);\n\t\t\treturn [\n\t\t\t\tnew RGBAColor(color.r, color.g, color.b, 0).toCss(),\n\t\t\t\tnew RGBAColor(color.r, color.g, color.b, 1).toCss(),\n\t\t\t];\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.initValues();\n\t},\n\tmethods: {\n\t\tvalueChanged() {\n\t\t\tif (this.modelValue === this.lastRGBEmit) return;\n\t\t\tthis.initValues();\n\t\t},\n\t\tupdateValue() {\n\t\t\tlet newColor: IColor;\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tnewColor = new RGBAColor(this.v1, this.v2, this.v3, this.a / 255);\n\t\t\t} else {\n\t\t\t\tnewColor = new HSLAColor(\n\t\t\t\t\tthis.v1 / 360,\n\t\t\t\t\tthis.v2 / 100,\n\t\t\t\t\tthis.v3 / 100,\n\t\t\t\t\tthis.a / 255\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst rgbColor = newColor.toRgb().toHex();\n\t\t\tif (this.lastRGBEmit === rgbColor) return;\n\t\t\tif (rgbColor.length !== 9) {\n\t\t\t\tthrow new Error(`Invalid color code: ${rgbColor}`);\n\t\t\t}\n\t\t\tthis.lastRGBEmit = rgbColor;\n\t\t\tthis.$emit('update:modelValue', rgbColor);\n\t\t},\n\t\tinitValues() {\n\t\t\tconst color = RGBAColor.fromHex(this.modelValue!);\n\t\t\tthis.lastRGBEmit = color.toHex();\n\t\t\tthis.a = color.a * 255;\n\t\t\tif (this.mode === 'hsla') {\n\t\t\t\tconst hslColor = color.toHSL();\n\t\t\t\tthis.v1 = hslColor.h * 360;\n\t\t\t\tthis.v2 = hslColor.s * 100;\n\t\t\t\tthis.v3 = hslColor.l * 100;\n\t\t\t} else {\n\t\t\t\tthis.v1 = color.r;\n\t\t\t\tthis.v2 = color.g;\n\t\t\t\tthis.v3 = color.b;\n\t\t\t}\n\t\t},\n\t\teightsStops(gen: (i: number) => IColor): IColor[] {\n\t\t\tconst stops: IColor[] = [];\n\t\t\tfor (let i = 0; i <= 8; ++i) {\n\t\t\t\tstops.push(gen(i / 8));\n\t\t\t}\n\t\t\treturn stops;\n\t\t},\n\t},\n\twatch: {\n\t\tvalue() {\n\t\t\tthis.valueChanged();\n\t\t},\n\t\tv1() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tv2() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tv3() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\ta() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tmode() {\n\t\t\tthis.initValues();\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.slider {\n\tdisplay: table;\n\tlabel {\n\t\ttext-align: right;\n\t\twidth: 100px;\n\t}\n\n\tinput {\n\t\twidth: 52px;\n\t}\n\n\t&.vertical {\n\t\t> * {\n\t\t\tdisplay: table-row;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t> * {\n\t\t\tdisplay: table-cell;\n\t\t\tvertical-align: middle;\n\t\t}\n\t}\n}\n</style>\n","import { IColor } from './color';\nimport { RGBAColor } from './rgb';\n\n// tslint:disable: no-magic-numbers\nexport class HSLAColor implements IColor {\n\tpublic constructor(\n\t\tpublic readonly h: number,\n\t\tpublic readonly s: number,\n\t\tpublic readonly l: number,\n\t\tpublic readonly a: number\n\t) {}\n\n\tpublic toCss(): string {\n\t\tif (this.a >= 1) {\n\t\t\treturn `hsl(${this.h}, ${this.s}, ${this.l})`;\n\t\t}\n\t\treturn `hsla(${this.h}, ${this.s}, ${this.l}, ${this.a})`;\n\t}\n\n\tpublic shift(deltas: HSLAColor): HSLAColor {\n\t\tlet { h, s, l, a } = this;\n\t\th += deltas.h;\n\t\tif (h >= 1) {\n\t\t\th -= 1;\n\t\t} else if (h < 0) {\n\t\t\th += 1;\n\t\t}\n\t\tif (s + deltas.s > 1) {\n\t\t\ts -= deltas.s;\n\t\t} else {\n\t\t\ts += deltas.s;\n\t\t\tif (s < 0) {\n\t\t\t\ts = 0;\n\t\t\t}\n\t\t}\n\t\tif (l + deltas.l > 1 || l + deltas.l < 0) {\n\t\t\tl -= deltas.l;\n\t\t} else {\n\t\t\tl += deltas.l;\n\t\t}\n\t\tif (a + deltas.a > 1 || a + deltas.a < 0) {\n\t\t\ta -= deltas.a;\n\t\t} else {\n\t\t\ta += deltas.a;\n\t\t}\n\t\treturn new HSLAColor(h, s, l, a);\n\t}\n\n\tpublic toRgb(): RGBAColor {\n\t\tconst { h, s, l, a } = this;\n\t\tlet r: number;\n\t\tlet g: number;\n\t\tlet b: number;\n\n\t\tif (s === 0) {\n\t\t\tr = g = b = l; // achromatic\n\t\t} else {\n\t\t\tconst q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n\t\t\tconst p = 2 * l - q;\n\t\t\tr = this.hue2rgb(p, q, h + 1 / 3);\n\t\t\tg = this.hue2rgb(p, q, h);\n\t\t\tb = this.hue2rgb(p, q, h - 1 / 3);\n\t\t}\n\n\t\treturn new RGBAColor(\n\t\t\tMath.round(r * 255),\n\t\t\tMath.round(g * 255),\n\t\t\tMath.round(b * 255),\n\t\t\ta\n\t\t);\n\t}\n\n\tpublic toHSL(): HSLAColor {\n\t\treturn this;\n\t}\n\n\tprivate hue2rgb(p: number, q: number, t: number) {\n\t\tif (t < 0) t += 1;\n\t\tif (t > 1) t -= 1;\n\t\tif (t < 1 / 6) return p + (q - p) * 6 * t;\n\t\tif (t < 1 / 2) return q;\n\t\tif (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n\t\treturn p;\n\t}\n}\n","import { HSLAColor } from './hsl';\n\n// tslint:disable: no-magic-numbers\nexport class RGBAColor {\n\tpublic static validCss(str: string): boolean {\n\t\treturn this.validCssRgb(str) || this.validHex(str);\n\t}\n\n\tpublic static fromCss(str: string): RGBAColor {\n\t\tif (this.validCssRgb(str)) {\n\t\t\treturn this.fromCssRgb(str);\n\t\t}\n\t\tif (this.validHex(str)) {\n\t\t\treturn this.fromHex(str);\n\t\t}\n\t\tthrow new Error('Invalid RGB color format');\n\t}\n\n\tpublic static validCssRgb(str: string): boolean {\n\t\treturn this.rgbEx.test(str) || this.rgbaEx.test(str);\n\t}\n\n\tpublic static fromCssRgb(str: string): RGBAColor {\n\t\tif (!this.validCssRgb(str)) throw new Error('Invalid RGB color format');\n\t\tconst rgbHead = str.slice(0, -1);\n\t\tconst parentesisPos = rgbHead.indexOf('(');\n\t\tconst rbgTail = rgbHead.slice(parentesisPos + 1);\n\t\tconst elements = rbgTail.split(',').map(x => parseFloat(x.trim()));\n\t\treturn new RGBAColor(\n\t\t\telements[0],\n\t\t\telements[1],\n\t\t\telements[2],\n\t\t\telements.length === 4 ? elements[3] : 1\n\t\t);\n\t}\n\n\tpublic static validHex(str: string): boolean {\n\t\treturn this.hexShortEx.test(str) || this.hexLongEx.test(str);\n\t}\n\n\tpublic static fromHex(str: string): RGBAColor {\n\t\tif (!this.validHex(str)) throw new Error('Invalid Hex color format');\n\t\tconst hexTail = str.slice(1);\n\t\tif (hexTail.length === 3) {\n\t\t\treturn new RGBAColor(\n\t\t\t\tparseInt(hexTail[0] + hexTail[0], 16),\n\t\t\t\tparseInt(hexTail[1] + hexTail[1], 16),\n\t\t\t\tparseInt(hexTail[2] + hexTail[2], 16),\n\t\t\t\t1\n\t\t\t);\n\t\t}\n\t\tif (hexTail.length === 4) {\n\t\t\treturn new RGBAColor(\n\t\t\t\tparseInt(hexTail[0] + hexTail[0], 16),\n\t\t\t\tparseInt(hexTail[1] + hexTail[1], 16),\n\t\t\t\tparseInt(hexTail[2] + hexTail[2], 16),\n\t\t\t\tparseInt(hexTail[3] + hexTail[3], 16) / 255\n\t\t\t);\n\t\t}\n\t\tif (hexTail.length === 6) {\n\t\t\treturn new RGBAColor(\n\t\t\t\tparseInt(hexTail[0] + hexTail[1], 16),\n\t\t\t\tparseInt(hexTail[2] + hexTail[3], 16),\n\t\t\t\tparseInt(hexTail[4] + hexTail[5], 16),\n\t\t\t\t1\n\t\t\t);\n\t\t}\n\t\tif (hexTail.length === 8) {\n\t\t\treturn new RGBAColor(\n\t\t\t\tparseInt(hexTail[0] + hexTail[1], 16),\n\t\t\t\tparseInt(hexTail[2] + hexTail[3], 16),\n\t\t\t\tparseInt(hexTail[4] + hexTail[5], 16),\n\t\t\t\tparseInt(hexTail[6] + hexTail[7], 16) / 255\n\t\t\t);\n\t\t}\n\t\tthrow new Error('Invalid Hex color format length');\n\t}\n\n\tprivate static rgbEx = /^rgb\\((\\d*?)\\,(\\d*?)\\,(\\d*?)\\)$/i;\n\tprivate static rgbaEx = /^rgba\\((\\d{1,3})\\,(\\d{1,3})\\,(\\d{1,3})\\,([\\d\\.]+)\\)$/i;\n\tprivate static hexShortEx = /^\\#[0-9A-Z]{3,4}$/i;\n\tprivate static hexLongEx = /^\\#[0-9A-Z]{6,8}$/i;\n\n\tpublic constructor(\n\t\tpublic readonly r: number,\n\t\tpublic readonly g: number,\n\t\tpublic readonly b: number,\n\t\tpublic readonly a: number\n\t) {}\n\n\tpublic toCss(): string {\n\t\tif (this.a > 1) {\n\t\t\treturn `rgb(${this.r},${this.g},${this.b})`;\n\t\t}\n\t\treturn `rgba(${this.r},${this.g},${this.b},${this.a})`;\n\t}\n\n\tpublic toHex(): string {\n\t\treturn `#${Math.round(this.r)\n\t\t\t.toString(16)\n\t\t\t.padStart(2, '0')}${Math.round(this.g)\n\t\t\t.toString(16)\n\t\t\t.padStart(2, '0')}${Math.round(this.b)\n\t\t\t.toString(16)\n\t\t\t.padStart(2, '0')}${Math.round(this.a * 255)\n\t\t\t.toString(16)\n\t\t\t.padStart(2, '0')}`;\n\t}\n\n\tpublic toRgb(): RGBAColor {\n\t\treturn this;\n\t}\n\n\tpublic toHSL(): HSLAColor {\n\t\tlet { r, g, b } = this;\n\t\tconst { a } = this;\n\t\t(r /= 255), (g /= 255), (b /= 255);\n\t\tconst max = Math.max(r, g, b);\n\t\tconst min = Math.min(r, g, b);\n\t\tlet h: number;\n\t\tlet s: number;\n\t\tconst l: number = (max + min) / 2;\n\n\t\tif (max === min) {\n\t\t\th = s = 0; // achromatic\n\t\t} else {\n\t\t\tconst d = max - min;\n\t\t\ts = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\t\t\tswitch (max) {\n\t\t\t\tcase r:\n\t\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase g:\n\t\t\t\t\th = (b - r) / d + 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase b:\n\t\t\t\t\th = (r - g) / d + 4;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\th! /= 6;\n\t\t}\n\n\t\treturn new HSLAColor(h!, s, l, a);\n\t}\n\n\tpublic get luminance(): number {\n\t\treturn Math.sqrt(\n\t\t\tMath.pow(0.299 * (this.r / 255), 2) +\n\t\t\t\tMath.pow(0.587 * (this.g / 255), 2) +\n\t\t\t\tMath.pow(0.114 * (this.b / 255), 2)\n\t\t);\n\t}\n}\n","<template>\n\t<div :class=\"{ slider: true, vertical }\" @keydown.stop>\n\t\t<label :for=\"_.uid\">{{ label }}</label>\n\t\t<div>\n\t\t\t<svg\n\t\t\t\tref=\"svg\"\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tviewBox=\"0 0 271 24\"\n\t\t\t\t@mousedown=\"enterSlide\"\n\t\t\t\t@touchstart=\"enterSlide\"\n\t\t\t\t@mousemove=\"moveSlide\"\n\t\t\t\t@touchmove=\"moveSlide\"\n\t\t\t\t@mouseup=\"exitSlide\"\n\t\t\t\t@touchend=\"exitSlide\"\n\t\t\t>\n\t\t\t\t<defs>\n\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t:id=\"`gradient${_.uid}`\"\n\t\t\t\t\t\tx1=\"0%\"\n\t\t\t\t\t\ty1=\"0%\"\n\t\t\t\t\t\tx2=\"100%\"\n\t\t\t\t\t\ty2=\"0%\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<stop\n\t\t\t\t\t\t\tv-for=\"(color, idx) in gradientStops\"\n\t\t\t\t\t\t\t:key=\"idx\"\n\t\t\t\t\t\t\t:offset=\"(idx / (gradientStops.length - 1)) * 100 + '%'\"\n\t\t\t\t\t\t\t:style=\"'stop-color:' + color\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</linearGradient>\n\t\t\t\t</defs>\n\t\t\t\t<g stroke=\"#ffbde1\">\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M7 0H262V24H7z\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tpaint-order=\"fill stroke markers\"\n\t\t\t\t\t\t:fill=\"`url(#gradient${_.uid})`\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path :d=\"pointerPath\" stroke-width=\"2\" fill=\"#000000\" />\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t\t<input\n\t\t\t:id=\"_.uid\"\n\t\t\tclass=\"sliderInput\"\n\t\t\tmin=\"0\"\n\t\t\t:max=\"maxValue\"\n\t\t\t:value=\"modelValue\"\n\t\t\ttype=\"number\"\n\t\t\t@input=\"$emit('input', parseFloat($event.target.value))\"\n\t\t\t@keydown.stop\n\t\t/>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, Prop } from 'vue';\n\nconst sliderLength = 255;\nconst sliderOffset = 8;\n\nexport default defineComponent({\n\tprops: {\n\t\tlabel: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tgradientStops: {\n\t\t\trequired: true,\n\t\t} as Prop<string[]>,\n\t\tmodelValue: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tmaxValue: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tslideActive: false,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tpointerPath(): string {\n\t\t\tconst val = (this.modelValue / this.maxValue) * sliderLength;\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\treturn `M${val} 0L${val + 14} 0L${val + 7} 12Z`;\n\t\t},\n\t},\n\tmethods: {\n\t\tenterSlide(event: MouseEvent | TouchEvent): void {\n\t\t\tthis.slideActive = true;\n\t\t\tthis.gradientStops;\n\t\t\tthis.moveSlide(event);\n\t\t},\n\t\tmoveSlide(event: MouseEvent | TouchEvent) {\n\t\t\tif (!this.slideActive) return;\n\t\t\tconst svg = this.$refs.svg as HTMLElement;\n\t\t\tif (!svg.contains(event.target as Node) && event.target !== svg) return;\n\t\t\tif (event instanceof MouseEvent && event.which !== 1) {\n\t\t\t\tthis.slideActive = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst bounding = svg.getBoundingClientRect();\n\t\t\tconst scale =\n\t\t\t\tbounding.width / (sliderOffset + sliderLength + sliderOffset);\n\t\t\tconst x =\n\t\t\t\t(event instanceof MouseEvent\n\t\t\t\t\t? event.clientX\n\t\t\t\t\t: event.touches[0].clientX) - bounding.x;\n\t\t\tconst scaledX = x / scale;\n\t\t\tevent.preventDefault();\n\t\t\tconst value =\n\t\t\t\t(Math.max(Math.min(scaledX - sliderOffset, sliderLength), 0) /\n\t\t\t\t\tsliderLength) *\n\t\t\t\tthis.maxValue;\n\t\t\tthis.$emit('update:modelValue', value);\n\t\t},\n\t\texitSlide() {\n\t\t\tthis.slideActive = false;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.slider {\n\tdisplay: table;\n\tlabel {\n\t\ttext-align: right;\n\t\twidth: 100px;\n\t}\n\n\tinput {\n\t\twidth: 52px;\n\t}\n\n\t&.vertical {\n\t\tsvg {\n\t\t\twidth: 100%;\n\t\t\theight: 24px;\n\t\t}\n\n\t\t> * {\n\t\t\tdisplay: table-row;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\tsvg {\n\t\t\twidth: 271px;\n\t\t\theight: 24px;\n\t\t}\n\n\t\t> * {\n\t\t\tdisplay: table-cell;\n\t\t\tvertical-align: middle;\n\t\t}\n\t}\n}\n</style>\n","\nimport { defineComponent, Prop } from 'vue';\n\nconst sliderLength = 255;\nconst sliderOffset = 8;\n\nexport default defineComponent({\n\tprops: {\n\t\tlabel: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tgradientStops: {\n\t\t\trequired: true,\n\t\t} as Prop<string[]>,\n\t\tmodelValue: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tmaxValue: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tslideActive: false,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tpointerPath(): string {\n\t\t\tconst val = (this.modelValue / this.maxValue) * sliderLength;\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\treturn `M${val} 0L${val + 14} 0L${val + 7} 12Z`;\n\t\t},\n\t},\n\tmethods: {\n\t\tenterSlide(event: MouseEvent | TouchEvent): void {\n\t\t\tthis.slideActive = true;\n\t\t\tthis.gradientStops;\n\t\t\tthis.moveSlide(event);\n\t\t},\n\t\tmoveSlide(event: MouseEvent | TouchEvent) {\n\t\t\tif (!this.slideActive) return;\n\t\t\tconst svg = this.$refs.svg as HTMLElement;\n\t\t\tif (!svg.contains(event.target as Node) && event.target !== svg) return;\n\t\t\tif (event instanceof MouseEvent && event.which !== 1) {\n\t\t\t\tthis.slideActive = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst bounding = svg.getBoundingClientRect();\n\t\t\tconst scale =\n\t\t\t\tbounding.width / (sliderOffset + sliderLength + sliderOffset);\n\t\t\tconst x =\n\t\t\t\t(event instanceof MouseEvent\n\t\t\t\t\t? event.clientX\n\t\t\t\t\t: event.touches[0].clientX) - bounding.x;\n\t\t\tconst scaledX = x / scale;\n\t\t\tevent.preventDefault();\n\t\t\tconst value =\n\t\t\t\t(Math.max(Math.min(scaledX - sliderOffset, sliderLength), 0) /\n\t\t\t\t\tsliderLength) *\n\t\t\t\tthis.maxValue;\n\t\t\tthis.$emit('update:modelValue', value);\n\t\t},\n\t\texitSlide() {\n\t\t\tthis.slideActive = false;\n\t\t},\n\t},\n});\n","import { render } from \"./slider.vue?vue&type=template&id=cbe5aa08&scoped=true&bindings={}\"\nimport script from \"./slider.vue?vue&type=script&lang=ts\"\nexport * from \"./slider.vue?vue&type=script&lang=ts\"\n\nimport \"./slider.vue?vue&type=style&index=0&id=cbe5aa08&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-cbe5aa08\"\n\nexport default script","\nimport { IColor } from '@/util/colors/color';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { HSLAColor } from '@/util/colors/hsl';\nimport Slider from './slider.vue';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Slider },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\tvalidator: (val: string): boolean => !!val.match(/^#[0-9a-f]{6,8}$/i),\n\t\t},\n\t\tmode: {\n\t\t\ttype: String,\n\t\t} as Prop<'hsla' | 'rgba'>,\n\t\trelative: Boolean,\n\t},\n\tdata: () => ({\n\t\tlastRGBEmit: null as string | null,\n\t\tv1: 0,\n\t\tv2: 0,\n\t\tv3: 0,\n\t\ta: 0,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tmaxValue1(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 360;\n\t\t},\n\t\tlabel1(): string {\n\t\t\tif (this.mode === 'rgba') return 'Red';\n\t\t\treturn 'Hue';\n\t\t},\n\t\tstops1(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst g = this.relative ? this.v2 : 0;\n\t\t\t\tconst b = this.relative ? this.v3 : 0;\n\t\t\t\tstops = [new RGBAColor(0, g, b, 1), new RGBAColor(255, g, b, 1)];\n\t\t\t} else {\n\t\t\t\tconst s = this.relative ? this.v2 / 100 : 1;\n\t\t\t\tconst l = this.relative ? this.v3 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(i, s, l, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tmaxValue2(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 100;\n\t\t},\n\t\tlabel2(): string {\n\t\t\tif (this.mode === 'rgba') return 'Green';\n\t\t\treturn 'Saturation';\n\t\t},\n\t\tstops2(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst r = this.relative ? this.v1 : 0;\n\t\t\t\tconst b = this.relative ? this.v3 : 0;\n\t\t\t\tstops = [new RGBAColor(r, 0, b, 1), new RGBAColor(r, 255, b, 1)];\n\t\t\t} else {\n\t\t\t\tconst h = this.relative ? this.v1 / 360 : 0;\n\t\t\t\tconst l = this.relative ? this.v3 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(h, i, l, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tmaxValue3(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 100;\n\t\t},\n\t\tlabel3(): string {\n\t\t\tif (this.mode === 'rgba') return 'Blue';\n\t\t\treturn 'Luminosity';\n\t\t},\n\t\tstops3(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst r = this.relative ? this.v1 : 0;\n\t\t\t\tconst g = this.relative ? this.v2 : 0;\n\t\t\t\tstops = [new RGBAColor(r, g, 0, 1), new RGBAColor(r, g, 255, 1)];\n\t\t\t} else {\n\t\t\t\tconst h = this.relative ? this.v1 / 360 : 0;\n\t\t\t\tconst s = this.relative ? this.v2 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(h, s, i, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tstopsAlpha(): string[] {\n\t\t\tconst color = RGBAColor.fromHex(this.modelValue!);\n\t\t\treturn [\n\t\t\t\tnew RGBAColor(color.r, color.g, color.b, 0).toCss(),\n\t\t\t\tnew RGBAColor(color.r, color.g, color.b, 1).toCss(),\n\t\t\t];\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.initValues();\n\t},\n\tmethods: {\n\t\tvalueChanged() {\n\t\t\tif (this.modelValue === this.lastRGBEmit) return;\n\t\t\tthis.initValues();\n\t\t},\n\t\tupdateValue() {\n\t\t\tlet newColor: IColor;\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tnewColor = new RGBAColor(this.v1, this.v2, this.v3, this.a / 255);\n\t\t\t} else {\n\t\t\t\tnewColor = new HSLAColor(\n\t\t\t\t\tthis.v1 / 360,\n\t\t\t\t\tthis.v2 / 100,\n\t\t\t\t\tthis.v3 / 100,\n\t\t\t\t\tthis.a / 255\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst rgbColor = newColor.toRgb().toHex();\n\t\t\tif (this.lastRGBEmit === rgbColor) return;\n\t\t\tif (rgbColor.length !== 9) {\n\t\t\t\tthrow new Error(`Invalid color code: ${rgbColor}`);\n\t\t\t}\n\t\t\tthis.lastRGBEmit = rgbColor;\n\t\t\tthis.$emit('update:modelValue', rgbColor);\n\t\t},\n\t\tinitValues() {\n\t\t\tconst color = RGBAColor.fromHex(this.modelValue!);\n\t\t\tthis.lastRGBEmit = color.toHex();\n\t\t\tthis.a = color.a * 255;\n\t\t\tif (this.mode === 'hsla') {\n\t\t\t\tconst hslColor = color.toHSL();\n\t\t\t\tthis.v1 = hslColor.h * 360;\n\t\t\t\tthis.v2 = hslColor.s * 100;\n\t\t\t\tthis.v3 = hslColor.l * 100;\n\t\t\t} else {\n\t\t\t\tthis.v1 = color.r;\n\t\t\t\tthis.v2 = color.g;\n\t\t\t\tthis.v3 = color.b;\n\t\t\t}\n\t\t},\n\t\teightsStops(gen: (i: number) => IColor): IColor[] {\n\t\t\tconst stops: IColor[] = [];\n\t\t\tfor (let i = 0; i <= 8; ++i) {\n\t\t\t\tstops.push(gen(i / 8));\n\t\t\t}\n\t\t\treturn stops;\n\t\t},\n\t},\n\twatch: {\n\t\tvalue() {\n\t\t\tthis.valueChanged();\n\t\t},\n\t\tv1() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tv2() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tv3() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\ta() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tmode() {\n\t\t\tthis.initValues();\n\t\t},\n\t},\n});\n","import { render } from \"./sliderGroup.vue?vue&type=template&id=24b7dbc3&scoped=true&bindings={}\"\nimport script from \"./sliderGroup.vue?vue&type=script&lang=ts\"\nexport * from \"./sliderGroup.vue?vue&type=script&lang=ts\"\n\nimport \"./sliderGroup.vue?vue&type=style&index=0&id=24b7dbc3&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-24b7dbc3\"\n\nexport default script","\nimport {\n\tColor,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport SliderGroup from './sliderGroup.vue';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { defineComponent, PropType } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nconst generatedPackId = 'dddg.generated.colors';\n\nexport default defineComponent({\n\tcomponents: {\n\t\tSliderGroup,\n\t},\n\tprops: {\n\t\tmodelValue: {\n\t\t\trequired: true,\n\t\t\ttype: String,\n\t\t},\n\t\ttitle: { default: '' },\n\t\tformat: {\n\t\t\ttype: String as PropType<'rgb' | 'hex'>,\n\t\t\tdefault: 'hex',\n\t\t},\n\t},\n\tdata: () => ({\n\t\tmode: 'hsla',\n\t\trelative: true,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tswatches(): DeepReadonly<Color[]> {\n\t\t\treturn this.$store.state.content.current.colors;\n\t\t},\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\tif (this.format === 'rgb') {\n\t\t\t\t\tconst rgb = RGBAColor.fromCss(this.modelValue);\n\t\t\t\t\treturn rgb.toHex();\n\t\t\t\t} else {\n\t\t\t\t\treturn this.modelValue;\n\t\t\t\t}\n\t\t\t},\n\t\t\tset(newColor: string) {\n\t\t\t\tif (this.format === 'rgb') {\n\t\t\t\t\tconst rgb = RGBAColor.fromCss(newColor);\n\t\t\t\t\tthis.$emit('update:modelValue', rgb.toCss());\n\t\t\t\t} else {\n\t\t\t\t\tthis.$emit('update:modelValue', newColor);\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n\tmethods: {\n\t\tupdateHex(event: Event) {\n\t\t\tconst hex = (event.target as HTMLInputElement).value;\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\tif (RGBAColor.validHex(hex) && (hex.length === 7 || hex.length === 9)) {\n\t\t\t\tthis.color = hex;\n\t\t\t}\n\t\t},\n\t\taddSwatch() {\n\t\t\tif (this.swatches.find(swatch => swatch.color === this.color)) return;\n\n\t\t\tconst existingPack = this.$store.state.content.contentPacks.find(\n\t\t\t\tpack => pack.packId === 'generatedPackId'\n\t\t\t) || {\n\t\t\t\tpackId: generatedPackId,\n\t\t\t\tpackCredits: [''],\n\t\t\t\tdependencies: [],\n\t\t\t\tcharacters: [],\n\t\t\t\tfonts: [],\n\t\t\t\tbackgrounds: [],\n\t\t\t\tsprites: [],\n\t\t\t\tpoemStyles: [],\n\t\t\t\tpoemBackgrounds: [],\n\t\t\t\tcolors: [],\n\t\t\t};\n\n\t\t\tconst newPack: ContentPack<IAsset> = {\n\t\t\t\t...existingPack,\n\t\t\t\tcolors: [\n\t\t\t\t\t...existingPack.colors,\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: this.color,\n\t\t\t\t\t\tcolor: this.color,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t} as any;\n\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: newPack,\n\t\t\t\t\tprocessed: true,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./color.vue?vue&type=template&id=5ae5bdec&scoped=true&bindings={}\"\nimport script from \"./color.vue?vue&type=script&lang=ts\"\nexport * from \"./color.vue?vue&type=script&lang=ts\"\n\nimport \"./color.vue?vue&type=style&index=0&id=5ae5bdec&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-5ae5bdec\"\n\nexport default script","import { exhaust } from '@/util/exhaust';\n\nexport type SpriteFilter =\n\t| INumericSpriteFilter<'blur'>\n\t| INumericSpriteFilter<'brightness'>\n\t| INumericSpriteFilter<'contrast'>\n\t| IDropShadowSpriteFilter\n\t| INumericSpriteFilter<'grayscale'>\n\t| INumericSpriteFilter<'hue-rotate'>\n\t| INumericSpriteFilter<'invert'>\n\t| INumericSpriteFilter<'opacity'>\n\t| INumericSpriteFilter<'saturate'>\n\t| INumericSpriteFilter<'sepia'>;\n\nexport const percentageValue = new Set<SpriteFilter['type']>([\n\t'brightness',\n\t'contrast',\n\t'grayscale',\n\t'invert',\n\t'opacity',\n\t'saturate',\n\t'sepia',\n]);\n\nexport interface IHasSpriteFilters {\n\tfilters: SpriteFilter[];\n\tcomposite:\n\t\t| 'source-over'\n\t\t| 'source-in'\n\t\t| 'source-out'\n\t\t| 'source-atop'\n\t\t| 'destination-over'\n\t\t| 'destination-in'\n\t\t| 'destination-out'\n\t\t| 'destination-atop'\n\t\t| 'lighter'\n\t\t| 'copy'\n\t\t| 'xor'\n\t\t| 'multiply'\n\t\t| 'screen'\n\t\t| 'overlay'\n\t\t| 'darken'\n\t\t| 'lighten'\n\t\t| 'color-dodge'\n\t\t| 'color-burn'\n\t\t| 'hard-light'\n\t\t| 'soft-light'\n\t\t| 'difference'\n\t\t| 'exclusion'\n\t\t| 'hue'\n\t\t| 'saturation'\n\t\t| 'color'\n\t\t| 'luminosity';\n}\n\nexport interface INumericSpriteFilter<K extends string> {\n\ttype: K;\n\tvalue: number;\n}\n\nexport interface IDropShadowSpriteFilter {\n\ttype: 'drop-shadow';\n\toffsetX: number;\n\toffsetY: number;\n\tblurRadius: number;\n\tcolor: string;\n}\n\nexport interface ISetFilterValue {\n\ttype: Exclude<SpriteFilter['type'], 'drop-shadow'>;\n\tvalue: number;\n}\n\nexport interface ISetDropShadowFilter {\n\ttype: 'drop-shadow';\n\toffsetX?: number;\n\toffsetY?: number;\n\tblurRadius?: number;\n\tcolor?: string;\n}\n\nexport function addFilter(obj: IHasSpriteFilters, type: SpriteFilter['type']) {\n\tconst filter = obj.filters.find(f => f.type === type);\n\tif (filter) return;\n\tswitch (type) {\n\t\tcase 'blur':\n\t\tcase 'grayscale':\n\t\tcase 'hue-rotate':\n\t\tcase 'invert':\n\t\tcase 'sepia':\n\t\t\tobj.filters.push({\n\t\t\t\ttype,\n\t\t\t\tvalue: 0,\n\t\t\t});\n\t\t\treturn;\n\t\tcase 'brightness':\n\t\tcase 'contrast':\n\t\tcase 'opacity':\n\t\tcase 'saturate':\n\t\t\tobj.filters.push({\n\t\t\t\ttype,\n\t\t\t\tvalue: 1,\n\t\t\t});\n\t\t\treturn;\n\t\tcase 'drop-shadow':\n\t\t\tobj.filters.push({\n\t\t\t\ttype,\n\t\t\t\tblurRadius: 0,\n\t\t\t\toffsetX: 10,\n\t\t\t\toffsetY: 10,\n\t\t\t\tcolor: '#555555',\n\t\t\t});\n\t\t\treturn;\n\t\tdefault:\n\t\t\texhaust(type);\n\t\t\tthrow new Error(`Unexpected filter type \"${type}\"`);\n\t}\n}\n\nexport type SetFilterValue = ISetFilterValue | ISetDropShadowFilter;\n\nexport function applyFilter(obj: IHasSpriteFilters, command: SetFilterValue) {\n\tconst filter = obj.filters.find(f => f.type === command.type);\n\tif (!filter) return;\n\tObject.assign(filter, command);\n}\n\nexport function removeFilter(\n\tobj: IHasSpriteFilters,\n\ttype: SpriteFilter['type']\n) {\n\tconst filterIdx = obj.filters.findIndex(f => f.type === type);\n\tif (filterIdx === -1) return;\n\tobj.filters.splice(filterIdx, 1);\n}\n","\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport Color from '@/components/toolbox/subtools/color/color.vue';\nimport { defineComponent, Prop, PropType } from 'vue';\nimport { CompositeModes } from '@/renderer/rendererContext';\nimport { DeepReadonly } from '@/util/readonly';\nimport {\n\tIHasSpriteFilters,\n\tINumericSpriteFilter,\n\tpercentageValue,\n\tSpriteFilter,\n} from '@/store/sprite_options';\nimport { exhaust } from '@/util/exhaust';\nimport {\n\tIAddFilterAction,\n\tIMoveFilterAction,\n\tIRemoveFilterAction,\n\tISetCompositionMutation,\n\tISetFilterAction,\n} from '@/store/objects';\n\nconst filterText: ReadonlyMap<SpriteFilter['type'], string> = new Map<\n\tSpriteFilter['type'],\n\tstring\n>([\n\t['blur', 'Blur'],\n\t['brightness', 'Brightness'],\n\t['contrast', 'Contrast'],\n\t['grayscale', 'Grayscale'],\n\t['hue-rotate', 'Rotate hue'],\n\t['invert', 'Invert colors'],\n\t['opacity', 'Opacity'],\n\t['saturate', 'Saturate'],\n\t['sepia', 'Sepia'],\n\t['drop-shadow', 'Drop shadow'],\n]);\n\nconst filters: ReadonlyArray<SpriteFilter['type']> = Array.from(\n\tfilterText.keys()\n).sort();\n\nexport default defineComponent({\n\tcomponents: { DFlow, DFieldset, Color },\n\tprops: {\n\t\ttype: {\n\t\t\ttype: String as PropType<'object' | 'background' | 'panel'>,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tid: {\n\t\t\trequired: true,\n\t\t} as Prop<string | number>,\n\t},\n\tdata: () => ({\n\t\taddEffectSelection: '' as SpriteFilter['type'] | '',\n\t\tcurrentFilterIdx: 0,\n\t\tshowShadowColor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): DeepReadonly<IHasSpriteFilters> {\n\t\t\tswitch (this.type) {\n\t\t\t\tcase 'object':\n\t\t\t\t\treturn this.$store.state.objects.objects[this.id!];\n\t\t\t\tcase 'background':\n\t\t\t\t\treturn this.$store.state.panels.panels[this.id!].background;\n\t\t\t\tcase 'panel':\n\t\t\t\t\treturn this.$store.state.panels.panels[this.id!];\n\t\t\t\tdefault:\n\t\t\t\t\texhaust(this.type);\n\t\t\t\t\treturn null!;\n\t\t\t}\n\t\t},\n\t\tcompositionMode: {\n\t\t\tget(): CompositeModes {\n\t\t\t\treturn this.object.composite;\n\t\t\t},\n\t\t\tset(composite: CompositeModes): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tswitch (this.type) {\n\t\t\t\t\t\tcase 'object':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setComposition', {\n\t\t\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\t\t\tcomposite,\n\t\t\t\t\t\t\t} as ISetCompositionMutation);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'background':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'panel':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\texhaust(this.type);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tfilters(): DeepReadonly<SpriteFilter[]> {\n\t\t\treturn this.object.filters;\n\t\t},\n\t\tfilterTypes(): ReadonlyArray<SpriteFilter['type']> {\n\t\t\treturn filters;\n\t\t},\n\t\tcurrentFilter(): DeepReadonly<SpriteFilter> | null {\n\t\t\treturn this.filters[this.currentFilterIdx] || null;\n\t\t},\n\t\tisPercentFilter(): boolean {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return false;\n\t\t\treturn percentageValue.has(filter.type);\n\t\t},\n\t\tmaxValue(): number | undefined {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return undefined;\n\n\t\t\tif (filter.type === 'hue-rotate') return 360;\n\t\t\tif (\n\t\t\t\tfilter.type === 'grayscale' ||\n\t\t\t\tfilter.type === 'sepia' ||\n\t\t\t\tfilter.type === 'opacity' ||\n\t\t\t\tfilter.type === 'invert'\n\t\t\t)\n\t\t\t\treturn 100;\n\n\t\t\treturn undefined;\n\t\t},\n\t\tminValue(): number | undefined {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return undefined;\n\n\t\t\tswitch (filter.type) {\n\t\t\t\tcase 'blur':\n\t\t\t\tcase 'brightness':\n\t\t\t\tcase 'contrast':\n\t\t\t\tcase 'grayscale':\n\t\t\t\tcase 'hue-rotate':\n\t\t\t\tcase 'invert':\n\t\t\t\tcase 'opacity':\n\t\t\t\tcase 'saturate':\n\t\t\t\tcase 'sepia':\n\t\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t},\n\t\tshadowColor: {\n\t\t\tget(): string | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('color' in filter)) return undefined;\n\t\t\t\treturn filter.color;\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.setValue({ color });\n\t\t\t},\n\t\t},\n\t\tshadowX: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('offsetX' in filter)) return undefined;\n\t\t\t\treturn filter.offsetX;\n\t\t\t},\n\t\t\tset(offsetX: number) {\n\t\t\t\tthis.setValue({ offsetX });\n\t\t\t},\n\t\t},\n\t\tshadowY: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('offsetY' in filter)) return undefined;\n\t\t\t\treturn filter.offsetY;\n\t\t\t},\n\t\t\tset(offsetY: number) {\n\t\t\t\tthis.setValue({ offsetY });\n\t\t\t},\n\t\t},\n\t\tshadowBlur: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('blurRadius' in filter)) return undefined;\n\t\t\t\treturn filter.blurRadius;\n\t\t\t},\n\t\t\tset(blurRadius: number) {\n\t\t\t\tthis.setValue({ blurRadius });\n\t\t\t},\n\t\t},\n\t},\n\tmethods: {\n\t\tgetFilterLabel(type: SpriteFilter['type']): string {\n\t\t\treturn filterText.get(type)!;\n\t\t},\n\t\tgetFilterText(filter: SpriteFilter): string {\n\t\t\tif (percentageValue.has(filter.type)) {\n\t\t\t\treturn `${filterText.get(filter.type)} ${(\n\t\t\t\t\t(filter as INumericSpriteFilter<any>).value * 100\n\t\t\t\t).toFixed()}%`;\n\t\t\t} else if (filter.type === 'hue-rotate') {\n\t\t\t\treturn `${filterText.get(filter.type)} ${filter.value.toFixed()}°`;\n\t\t\t} else if (filter.type === 'blur') {\n\t\t\t\treturn `${filterText.get(filter.type)} ${filter.value.toFixed()}px`;\n\t\t\t}\n\t\t\treturn filterText.get(filter.type)!;\n\t\t},\n\t\taddFilter() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/addFilter', {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\ttype: this.addEffectSelection,\n\t\t\t\t\tidx: this.currentFilterIdx + 1,\n\t\t\t\t} as IAddFilterAction);\n\t\t\t});\n\t\t},\n\t\tselectFilter(idx: number) {\n\t\t\tthis.currentFilterIdx = idx;\n\t\t},\n\t\tremoveFilter() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/removeFilter', {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t} as IRemoveFilterAction);\n\t\t\t});\n\t\t},\n\t\tmoveFilter(moveBy: number) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/moveFilter', {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t\tmoveBy,\n\t\t\t\t} as IMoveFilterAction);\n\t\t\t\tthis.currentFilterIdx += moveBy;\n\t\t\t});\n\t\t},\n\t\tsetValue(value: Omit<ISetFilterAction, 'id' | 'idx'>) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setFilter', {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t\t...value,\n\t\t\t\t} as ISetFilterAction);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./image-options.vue?vue&type=template&id=79b6e46b&scoped=true&bindings={}\"\nimport script from \"./image-options.vue?vue&type=script&lang=ts\"\nexport * from \"./image-options.vue?vue&type=script&lang=ts\"\n\nimport \"./image-options.vue?vue&type=style&index=0&id=79b6e46b&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-79b6e46b\"\n\nexport default script","<template>\n\t<d-flow no-wraping>\n\t\t<button @click=\"$emit('leave')\">Back</button>\n\t\t<button\n\t\t\t@click=\"\n\t\t\t\t$emit('show-expression-dialog', { character: character.characterType })\n\t\t\t\"\n\t\t\tv-if=\"part === 'head'\"\n\t\t\tclass=\"icon-button\"\n\t\t>\n\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t<span class=\"text-block\">Create new expressions</span>\n\t\t</button>\n\t\t<button\n\t\t\t@click=\"\n\t\t\t\t$emit('show-dialog', 'type: Expressions character: ' + charData.label)\n\t\t\t\"\n\t\t\tv-if=\"part === 'head'\"\n\t\t\tclass=\"icon-button\"\n\t\t>\n\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t<span class=\"text-block\">Search in content packs</span>\n\t\t</button>\n\t\t<button\n\t\t\t@click=\"$emit('show-dialog', 'type: Styles character: ' + charData.label)\"\n\t\t\tv-else-if=\"part === 'style'\"\n\t\t\tclass=\"icon-button\"\n\t\t>\n\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t<span>Search in content packs</span>\n\t\t</button>\n\t\t<button\n\t\t\t@click=\"$emit('show-dialog', 'type: Poses character: ' + charData.label)\"\n\t\t\tv-else\n\t\t\tclass=\"icon-button\"\n\t\t>\n\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t<span>Search in content packs</span>\n\t\t</button>\n\t\t<part-button\n\t\t\tv-for=\"(part, index) of parts\"\n\t\t\t:key=\"index\"\n\t\t\t:value=\"index\"\n\t\t\t:part=\"part\"\n\t\t\t@click=\"\n\t\t\t\tchoose(index);\n\t\t\t\t$emit('leave');\n\t\t\t\"\n\t\t/>\n\t\t<d-fieldset\n\t\t\tv-for=\"styleComponent of styleComponents\"\n\t\t\t:key=\"styleComponent.name\"\n\t\t\t:title=\"styleComponent.label\"\n\t\t>\n\t\t\t<d-flow noWraping>\n\t\t\t\t<part-button\n\t\t\t\t\tv-for=\"(button, id) of styleComponent.buttons\"\n\t\t\t\t\t:size=\"130\"\n\t\t\t\t\t:key=\"id\"\n\t\t\t\t\t:value=\"id\"\n\t\t\t\t\t:part=\"button\"\n\t\t\t\t\t@click=\"choose_component(styleComponent.name, id)\"\n\t\t\t\t/>\n\t\t\t</d-flow>\n\t\t</d-fieldset>\n\t</d-flow>\n</template>\n\n<script lang=\"ts\">\nimport { isWebPSupported } from '@/asset-manager';\nimport PartButton, { IPartButtonImage, IPartImage } from './partButton.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport {\n\tPose,\n\tCharacter,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport {\n\tgetPose,\n\tISetPosePositionMutation,\n\tISetPartAction,\n\tgetData,\n\tICharacter,\n\tISetStyleAction,\n} from '@/store/objectTypes/characters';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent, PropType } from 'vue';\n\ninterface IPartStyleGroup {\n\tlabel: string;\n\tname: string;\n\tbuttons: { [id: string]: IPartButtonImage };\n}\n\nexport default defineComponent({\n\tcomponents: { PartButton, DFieldset, DFlow },\n\tprops: {\n\t\tcharacter: {\n\t\t\ttype: Object as PropType<ICharacter>,\n\t\t\trequired: true,\n\t\t},\n\t\tpart: {\n\t\t\trequired: true,\n\t\t\ttype: String as PropType<string | 'pose' | 'style'>,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\t/**\n\t\t * [styleComponentKey, styleComponentValue]\n\t\t */\n\t\tstylePriorities: [] as Array<[string, string]>,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tstyleComponents(): DeepReadonly<IPartStyleGroup[]> {\n\t\t\tif (this.part !== 'style') return [];\n\t\t\tconst styleComponents = this.charData.styleGroups[\n\t\t\t\tthis.character.styleGroupId\n\t\t\t];\n\t\t\treturn styleComponents.styleComponents.map(component => {\n\t\t\t\tconst buttons: IPartStyleGroup['buttons'] = {};\n\t\t\t\tfor (const key in component.variants) {\n\t\t\t\t\t// eslint-disable-next-line no-prototype-builtins\n\t\t\t\t\tif (!component.variants.hasOwnProperty(key)) continue;\n\t\t\t\t\tconst variant = component.variants[key];\n\t\t\t\t\tbuttons[key] = {\n\t\t\t\t\t\tsize: styleComponents.styles[0].poses[0].size,\n\t\t\t\t\t\toffset: [0, 0],\n\t\t\t\t\t\timages: [{ offset: [0, 0], asset: variant }],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn { label: component.label, name: component.id, buttons };\n\t\t\t});\n\t\t},\n\t\tparts(): { [id: number]: DeepReadonly<IPartButtonImage> } {\n\t\t\tconst ret: { [id: string]: DeepReadonly<IPartButtonImage> } = {};\n\t\t\tlet collection: DeepReadonly<IAsset[][]>;\n\t\t\tlet offset: DeepReadonly<IPartButtonImage['offset']>;\n\t\t\tlet size: DeepReadonly<IPartButtonImage['size']>;\n\t\t\tconst data = this.charData;\n\t\t\tconst currentPose = getPose(data, this.character);\n\t\t\tswitch (this.part) {\n\t\t\t\tcase 'head':\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet headKeyIdx = 0;\n\t\t\t\t\t\theadKeyIdx < currentPose.compatibleHeads.length;\n\t\t\t\t\t\t++headKeyIdx\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst headKey = currentPose.compatibleHeads[headKeyIdx];\n\t\t\t\t\t\tconst heads = data.heads[headKey];\n\t\t\t\t\t\tfor (let headIdx = 0; headIdx < heads.variants.length; ++headIdx) {\n\t\t\t\t\t\t\tconst headImages = heads.variants[headIdx];\n\t\t\t\t\t\t\tret[`${headKeyIdx}_${headIdx}`] = {\n\t\t\t\t\t\t\t\tsize: heads.previewSize,\n\t\t\t\t\t\t\t\toffset: heads.previewOffset,\n\t\t\t\t\t\t\t\timages: headImages.map(\n\t\t\t\t\t\t\t\t\t(image): IPartImage => ({ asset: image, offset: [0, 0] })\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\tcase 'pose':\n\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\tconst currentStyle =\n\t\t\t\t\t\tdata.styleGroups[this.character.styleGroupId].styles[\n\t\t\t\t\t\t\tthis.character.styleId\n\t\t\t\t\t\t];\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet poseIdx = 0;\n\t\t\t\t\t\tposeIdx < currentStyle.poses.length;\n\t\t\t\t\t\t++poseIdx\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst pose = currentStyle.poses[poseIdx];\n\t\t\t\t\t\tret[poseIdx] = this.generatePosePreview(pose);\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\tcase 'style':\n\t\t\t\t\tfor (const styleGroup of data.styleGroups) {\n\t\t\t\t\t\tret[styleGroup.id] = this.generatePosePreview(\n\t\t\t\t\t\t\tstyleGroup.styles[0].poses[0]\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\n\t\t\t\tdefault:\n\t\t\t\t\tcollection = currentPose.positions[this.part];\n\t\t\t\t\tsize = currentPose.previewSize;\n\t\t\t\t\toffset = currentPose.previewOffset;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tfor (let partIdx = 0; partIdx < collection.length; ++partIdx) {\n\t\t\t\tconst part = collection[partIdx];\n\t\t\t\tret[partIdx] = {\n\t\t\t\t\timages: part.map((partImage: IAsset) => ({\n\t\t\t\t\t\toffset: [0, 0],\n\t\t\t\t\t\tasset: partImage,\n\t\t\t\t\t})),\n\t\t\t\t\tsize,\n\t\t\t\t\toffset,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\tcharData(): DeepReadonly<Character<IAsset>> {\n\t\t\treturn getData(this.$store, this.character);\n\t\t},\n\t},\n\tmethods: {\n\t\tupdateStyleData(): void {\n\t\t\tconst baseStyle = this.charData.styleGroups[this.character.styleGroupId]\n\t\t\t\t.styles[this.character.styleId];\n\t\t\tthis.stylePriorities = Object.keys(baseStyle.components).map(key => [\n\t\t\t\tkey,\n\t\t\t\tbaseStyle.components[key],\n\t\t\t]);\n\t\t},\n\t\tgeneratePosePreview(\n\t\t\tpose: DeepReadonly<Pose<IAsset>>\n\t\t): DeepReadonly<IPartButtonImage> {\n\t\t\tconst data = this.charData;\n\t\t\tconst heads = data.heads[pose.compatibleHeads[0]];\n\t\t\tconst head = heads ? heads.variants[0] : null;\n\t\t\tlet images: IAsset[] = [];\n\n\t\t\tfor (const command of pose.renderCommands) {\n\t\t\t\tswitch (command.type) {\n\t\t\t\t\tcase 'pose-part':\n\t\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\t\tconst part = pose.positions[command.part];\n\t\t\t\t\t\tif (!part || part.length === 0) break;\n\t\t\t\t\t\timages = images.concat(part[0] as IAsset[]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'head':\n\t\t\t\t\t\tif (head) images = images.concat(head);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'image':\n\t\t\t\t\t\timages = images.concat(command.images);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\timages: images.map(image => ({ asset: image, offset: [0, 0] })),\n\t\t\t\tsize: pose.previewSize,\n\t\t\t\toffset: pose.previewOffset,\n\t\t\t};\n\t\t},\n\t\tupdatePose(styleGroupId?: number) {\n\t\t\tif (styleGroupId === undefined)\n\t\t\t\tstyleGroupId = this.character.styleGroupId;\n\n\t\t\tconst data = this.charData;\n\t\t\tconst styleGroups = data.styleGroups[styleGroupId];\n\t\t\tlet selection = styleGroups.styles;\n\t\t\tfor (const priority of this.stylePriorities) {\n\t\t\t\tconst subSelect = selection.filter(style => {\n\t\t\t\t\treturn style.components[priority[0]] === priority[1];\n\t\t\t\t});\n\t\t\t\tif (subSelect.length > 0) selection = subSelect;\n\t\t\t}\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setCharStyle', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tstyleGroupId,\n\t\t\t\t\tstyleId: styleGroups.styles.indexOf(selection[0]),\n\t\t\t\t} as ISetStyleAction);\n\t\t\t});\n\t\t},\n\t\tchoose(index: string) {\n\t\t\tif (this.part === 'style') {\n\t\t\t\tthis.updatePose(\n\t\t\t\t\tthis.charData.styleGroups.findIndex(group => group.id === index)\n\t\t\t\t);\n\t\t\t} else if (this.part === 'head') {\n\t\t\t\tconst [headTypeIdx, headIdx] = index\n\t\t\t\t\t.split('_', 2)\n\t\t\t\t\t.map(part => parseInt(part, 10));\n\t\t\t\tthis.$store.commit('objects/setPosePosition', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tposePositions: {\n\t\t\t\t\t\theadType: headTypeIdx,\n\t\t\t\t\t\thead: headIdx,\n\t\t\t\t\t},\n\t\t\t\t} as ISetPosePositionMutation);\n\t\t\t} else {\n\t\t\t\tthis.setPart(this.part, parseInt(index, 10));\n\t\t\t}\n\t\t},\n\t\t// eslint-disable-next-line @typescript-eslint/camelcase\n\t\tchoose_component(component: string, id: string) {\n\t\t\tconst prioIdx = this.stylePriorities.findIndex(\n\t\t\t\tstylePriority => stylePriority[0] === component\n\t\t\t);\n\t\t\tthis.stylePriorities.splice(prioIdx, 1);\n\t\t\tthis.stylePriorities.unshift([component, id]);\n\t\t\tthis.updatePose();\n\t\t},\n\t\tsetPart(part: ISetPartAction['part'], index: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setPart', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tpart,\n\t\t\t\t\tval: index,\n\t\t\t\t} as ISetPartAction);\n\t\t\t});\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.updateStyleData();\n\t\tthis.isWebPSupported = await isWebPSupported();\n\t},\n\twatch: {\n\t\tcharacter() {\n\t\t\tthis.updateStyleData();\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.icon-button {\n\tvertical-align: middle;\n\twidth: 100px;\n}\n</style>\n","<template>\n\t<div\n\t\t:class=\"{ part: true, active: false /*background === value*/ }\"\n\t\t:style=\"style\"\n\t\t@click=\"$emit('click')\"\n\t></div>\n</template>\n\n<script lang=\"ts\">\nimport { getAAsset, getAsset } from '@/asset-manager';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { IAsset } from '@/store/content';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent, Prop } from 'vue';\n\nexport interface IPartButtonImage {\n\timages: IPartImage[];\n\tsize: DeepReadonly<[number, number]>;\n\toffset: DeepReadonly<[number, number]>;\n}\n\nexport interface IPartImage {\n\tasset: IAsset | string;\n\toffset: DeepReadonly<[number, number]>;\n}\n\nconst spriteSize = 960;\n\nexport default defineComponent({\n\tprops: {\n\t\tpart: {\n\t\t\trequired: true,\n\t\t} as Prop<IPartButtonImage>,\n\t\tvalue: {\n\t\t\trequired: true,\n\t\t},\n\t\tsize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 150,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tlookups: [] as Array<HTMLImageElement | ErrorAsset | null>,\n\t\tloaded: false,\n\t}),\n\tcomputed: {\n\t\tscaleX(): number {\n\t\t\treturn this.size / this.part!.size[0];\n\t\t},\n\t\tscaleY(): number {\n\t\t\treturn this.size / this.part!.size[1];\n\t\t},\n\t\tbackgroundSize(): string {\n\t\t\treturn `${Math.floor(spriteSize * this.scaleX)}px ${Math.floor(\n\t\t\t\tspriteSize * this.scaleY\n\t\t\t)}px`;\n\t\t},\n\t\tbackgroundPosition(): string {\n\t\t\treturn (\n\t\t\t\t`${Math.floor(this.part!.offset[0] * -this.scaleX)}px ` +\n\t\t\t\t`${Math.floor(this.part!.offset[1] * -this.scaleY)}px`\n\t\t\t);\n\t\t},\n\t\tstyle(): { [id: string]: string } {\n\t\t\tconst images = (this.lookups.filter(\n\t\t\t\tlookup => lookup instanceof HTMLImageElement\n\t\t\t) as HTMLImageElement[]).map(\n\t\t\t\tlookup => `url('${lookup.src.replace(\"'\", \"\\\\'\")}')`\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tbackgroundImage: images.join(','),\n\t\t\t\theight: this.size + 'px',\n\t\t\t\twidth: this.size + 'px',\n\t\t\t\tbackgroundPosition: this.backgroundPosition,\n\t\t\t\tbackgroundSize: this.backgroundSize,\n\t\t\t};\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.lookups = await Promise.all(\n\t\t\tthis.part!.images.map(image => {\n\t\t\t\tif (typeof image.asset === 'string') {\n\t\t\t\t\treturn getAsset(image.asset, false);\n\t\t\t\t} else {\n\t\t\t\t\treturn getAAsset(image.asset, false);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.part {\n\tmargin-top: 4px;\n\ttext-shadow: 0 0 2px black;\n\tcolor: white;\n\tbox-shadow: inset 0 0 1px 3px rgba(0, 0, 0, 0.5);\n\ttext-align: center;\n\tuser-select: none;\n\tvertical-align: middle;\n\n\t&.active {\n\t\tbox-shadow: inset 0 0 1px 3px rgba(255, 255, 255, 0.5);\n\t}\n}\n\n.partList:not(.vertical) .part {\n\tdisplay: inline-block;\n}\n\n.partList.vertical .part {\n\tdisplay: block;\n}\n</style>\n","\nimport { getAAsset, getAsset } from '@/asset-manager';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { IAsset } from '@/store/content';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent, Prop } from 'vue';\n\nexport interface IPartButtonImage {\n\timages: IPartImage[];\n\tsize: DeepReadonly<[number, number]>;\n\toffset: DeepReadonly<[number, number]>;\n}\n\nexport interface IPartImage {\n\tasset: IAsset | string;\n\toffset: DeepReadonly<[number, number]>;\n}\n\nconst spriteSize = 960;\n\nexport default defineComponent({\n\tprops: {\n\t\tpart: {\n\t\t\trequired: true,\n\t\t} as Prop<IPartButtonImage>,\n\t\tvalue: {\n\t\t\trequired: true,\n\t\t},\n\t\tsize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 150,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tlookups: [] as Array<HTMLImageElement | ErrorAsset | null>,\n\t\tloaded: false,\n\t}),\n\tcomputed: {\n\t\tscaleX(): number {\n\t\t\treturn this.size / this.part!.size[0];\n\t\t},\n\t\tscaleY(): number {\n\t\t\treturn this.size / this.part!.size[1];\n\t\t},\n\t\tbackgroundSize(): string {\n\t\t\treturn `${Math.floor(spriteSize * this.scaleX)}px ${Math.floor(\n\t\t\t\tspriteSize * this.scaleY\n\t\t\t)}px`;\n\t\t},\n\t\tbackgroundPosition(): string {\n\t\t\treturn (\n\t\t\t\t`${Math.floor(this.part!.offset[0] * -this.scaleX)}px ` +\n\t\t\t\t`${Math.floor(this.part!.offset[1] * -this.scaleY)}px`\n\t\t\t);\n\t\t},\n\t\tstyle(): { [id: string]: string } {\n\t\t\tconst images = (this.lookups.filter(\n\t\t\t\tlookup => lookup instanceof HTMLImageElement\n\t\t\t) as HTMLImageElement[]).map(\n\t\t\t\tlookup => `url('${lookup.src.replace(\"'\", \"\\\\'\")}')`\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tbackgroundImage: images.join(','),\n\t\t\t\theight: this.size + 'px',\n\t\t\t\twidth: this.size + 'px',\n\t\t\t\tbackgroundPosition: this.backgroundPosition,\n\t\t\t\tbackgroundSize: this.backgroundSize,\n\t\t\t};\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.lookups = await Promise.all(\n\t\t\tthis.part!.images.map(image => {\n\t\t\t\tif (typeof image.asset === 'string') {\n\t\t\t\t\treturn getAsset(image.asset, false);\n\t\t\t\t} else {\n\t\t\t\t\treturn getAAsset(image.asset, false);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t},\n});\n","import { render } from \"./partButton.vue?vue&type=template&id=002d03a0&scoped=true&bindings={}\"\nimport script from \"./partButton.vue?vue&type=script&lang=ts\"\nexport * from \"./partButton.vue?vue&type=script&lang=ts\"\n\nimport \"./partButton.vue?vue&type=style&index=0&id=002d03a0&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-002d03a0\"\n\nexport default script","\nimport { isWebPSupported } from '@/asset-manager';\nimport PartButton, { IPartButtonImage, IPartImage } from './partButton.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport {\n\tPose,\n\tCharacter,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport {\n\tgetPose,\n\tISetPosePositionMutation,\n\tISetPartAction,\n\tgetData,\n\tICharacter,\n\tISetStyleAction,\n} from '@/store/objectTypes/characters';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent, PropType } from 'vue';\n\ninterface IPartStyleGroup {\n\tlabel: string;\n\tname: string;\n\tbuttons: { [id: string]: IPartButtonImage };\n}\n\nexport default defineComponent({\n\tcomponents: { PartButton, DFieldset, DFlow },\n\tprops: {\n\t\tcharacter: {\n\t\t\ttype: Object as PropType<ICharacter>,\n\t\t\trequired: true,\n\t\t},\n\t\tpart: {\n\t\t\trequired: true,\n\t\t\ttype: String as PropType<string | 'pose' | 'style'>,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\t/**\n\t\t * [styleComponentKey, styleComponentValue]\n\t\t */\n\t\tstylePriorities: [] as Array<[string, string]>,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tstyleComponents(): DeepReadonly<IPartStyleGroup[]> {\n\t\t\tif (this.part !== 'style') return [];\n\t\t\tconst styleComponents = this.charData.styleGroups[\n\t\t\t\tthis.character.styleGroupId\n\t\t\t];\n\t\t\treturn styleComponents.styleComponents.map(component => {\n\t\t\t\tconst buttons: IPartStyleGroup['buttons'] = {};\n\t\t\t\tfor (const key in component.variants) {\n\t\t\t\t\t// eslint-disable-next-line no-prototype-builtins\n\t\t\t\t\tif (!component.variants.hasOwnProperty(key)) continue;\n\t\t\t\t\tconst variant = component.variants[key];\n\t\t\t\t\tbuttons[key] = {\n\t\t\t\t\t\tsize: styleComponents.styles[0].poses[0].size,\n\t\t\t\t\t\toffset: [0, 0],\n\t\t\t\t\t\timages: [{ offset: [0, 0], asset: variant }],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn { label: component.label, name: component.id, buttons };\n\t\t\t});\n\t\t},\n\t\tparts(): { [id: number]: DeepReadonly<IPartButtonImage> } {\n\t\t\tconst ret: { [id: string]: DeepReadonly<IPartButtonImage> } = {};\n\t\t\tlet collection: DeepReadonly<IAsset[][]>;\n\t\t\tlet offset: DeepReadonly<IPartButtonImage['offset']>;\n\t\t\tlet size: DeepReadonly<IPartButtonImage['size']>;\n\t\t\tconst data = this.charData;\n\t\t\tconst currentPose = getPose(data, this.character);\n\t\t\tswitch (this.part) {\n\t\t\t\tcase 'head':\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet headKeyIdx = 0;\n\t\t\t\t\t\theadKeyIdx < currentPose.compatibleHeads.length;\n\t\t\t\t\t\t++headKeyIdx\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst headKey = currentPose.compatibleHeads[headKeyIdx];\n\t\t\t\t\t\tconst heads = data.heads[headKey];\n\t\t\t\t\t\tfor (let headIdx = 0; headIdx < heads.variants.length; ++headIdx) {\n\t\t\t\t\t\t\tconst headImages = heads.variants[headIdx];\n\t\t\t\t\t\t\tret[`${headKeyIdx}_${headIdx}`] = {\n\t\t\t\t\t\t\t\tsize: heads.previewSize,\n\t\t\t\t\t\t\t\toffset: heads.previewOffset,\n\t\t\t\t\t\t\t\timages: headImages.map(\n\t\t\t\t\t\t\t\t\t(image): IPartImage => ({ asset: image, offset: [0, 0] })\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\tcase 'pose':\n\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\tconst currentStyle =\n\t\t\t\t\t\tdata.styleGroups[this.character.styleGroupId].styles[\n\t\t\t\t\t\t\tthis.character.styleId\n\t\t\t\t\t\t];\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet poseIdx = 0;\n\t\t\t\t\t\tposeIdx < currentStyle.poses.length;\n\t\t\t\t\t\t++poseIdx\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst pose = currentStyle.poses[poseIdx];\n\t\t\t\t\t\tret[poseIdx] = this.generatePosePreview(pose);\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\tcase 'style':\n\t\t\t\t\tfor (const styleGroup of data.styleGroups) {\n\t\t\t\t\t\tret[styleGroup.id] = this.generatePosePreview(\n\t\t\t\t\t\t\tstyleGroup.styles[0].poses[0]\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\n\t\t\t\tdefault:\n\t\t\t\t\tcollection = currentPose.positions[this.part];\n\t\t\t\t\tsize = currentPose.previewSize;\n\t\t\t\t\toffset = currentPose.previewOffset;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tfor (let partIdx = 0; partIdx < collection.length; ++partIdx) {\n\t\t\t\tconst part = collection[partIdx];\n\t\t\t\tret[partIdx] = {\n\t\t\t\t\timages: part.map((partImage: IAsset) => ({\n\t\t\t\t\t\toffset: [0, 0],\n\t\t\t\t\t\tasset: partImage,\n\t\t\t\t\t})),\n\t\t\t\t\tsize,\n\t\t\t\t\toffset,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\tcharData(): DeepReadonly<Character<IAsset>> {\n\t\t\treturn getData(this.$store, this.character);\n\t\t},\n\t},\n\tmethods: {\n\t\tupdateStyleData(): void {\n\t\t\tconst baseStyle = this.charData.styleGroups[this.character.styleGroupId]\n\t\t\t\t.styles[this.character.styleId];\n\t\t\tthis.stylePriorities = Object.keys(baseStyle.components).map(key => [\n\t\t\t\tkey,\n\t\t\t\tbaseStyle.components[key],\n\t\t\t]);\n\t\t},\n\t\tgeneratePosePreview(\n\t\t\tpose: DeepReadonly<Pose<IAsset>>\n\t\t): DeepReadonly<IPartButtonImage> {\n\t\t\tconst data = this.charData;\n\t\t\tconst heads = data.heads[pose.compatibleHeads[0]];\n\t\t\tconst head = heads ? heads.variants[0] : null;\n\t\t\tlet images: IAsset[] = [];\n\n\t\t\tfor (const command of pose.renderCommands) {\n\t\t\t\tswitch (command.type) {\n\t\t\t\t\tcase 'pose-part':\n\t\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\t\tconst part = pose.positions[command.part];\n\t\t\t\t\t\tif (!part || part.length === 0) break;\n\t\t\t\t\t\timages = images.concat(part[0] as IAsset[]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'head':\n\t\t\t\t\t\tif (head) images = images.concat(head);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'image':\n\t\t\t\t\t\timages = images.concat(command.images);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\timages: images.map(image => ({ asset: image, offset: [0, 0] })),\n\t\t\t\tsize: pose.previewSize,\n\t\t\t\toffset: pose.previewOffset,\n\t\t\t};\n\t\t},\n\t\tupdatePose(styleGroupId?: number) {\n\t\t\tif (styleGroupId === undefined)\n\t\t\t\tstyleGroupId = this.character.styleGroupId;\n\n\t\t\tconst data = this.charData;\n\t\t\tconst styleGroups = data.styleGroups[styleGroupId];\n\t\t\tlet selection = styleGroups.styles;\n\t\t\tfor (const priority of this.stylePriorities) {\n\t\t\t\tconst subSelect = selection.filter(style => {\n\t\t\t\t\treturn style.components[priority[0]] === priority[1];\n\t\t\t\t});\n\t\t\t\tif (subSelect.length > 0) selection = subSelect;\n\t\t\t}\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setCharStyle', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tstyleGroupId,\n\t\t\t\t\tstyleId: styleGroups.styles.indexOf(selection[0]),\n\t\t\t\t} as ISetStyleAction);\n\t\t\t});\n\t\t},\n\t\tchoose(index: string) {\n\t\t\tif (this.part === 'style') {\n\t\t\t\tthis.updatePose(\n\t\t\t\t\tthis.charData.styleGroups.findIndex(group => group.id === index)\n\t\t\t\t);\n\t\t\t} else if (this.part === 'head') {\n\t\t\t\tconst [headTypeIdx, headIdx] = index\n\t\t\t\t\t.split('_', 2)\n\t\t\t\t\t.map(part => parseInt(part, 10));\n\t\t\t\tthis.$store.commit('objects/setPosePosition', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tposePositions: {\n\t\t\t\t\t\theadType: headTypeIdx,\n\t\t\t\t\t\thead: headIdx,\n\t\t\t\t\t},\n\t\t\t\t} as ISetPosePositionMutation);\n\t\t\t} else {\n\t\t\t\tthis.setPart(this.part, parseInt(index, 10));\n\t\t\t}\n\t\t},\n\t\t// eslint-disable-next-line @typescript-eslint/camelcase\n\t\tchoose_component(component: string, id: string) {\n\t\t\tconst prioIdx = this.stylePriorities.findIndex(\n\t\t\t\tstylePriority => stylePriority[0] === component\n\t\t\t);\n\t\t\tthis.stylePriorities.splice(prioIdx, 1);\n\t\t\tthis.stylePriorities.unshift([component, id]);\n\t\t\tthis.updatePose();\n\t\t},\n\t\tsetPart(part: ISetPartAction['part'], index: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setPart', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tpart,\n\t\t\t\t\tval: index,\n\t\t\t\t} as ISetPartAction);\n\t\t\t});\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.updateStyleData();\n\t\tthis.isWebPSupported = await isWebPSupported();\n\t},\n\twatch: {\n\t\tcharacter() {\n\t\t\tthis.updateStyleData();\n\t\t},\n\t},\n});\n","import { render } from \"./parts.vue?vue&type=template&id=47f2e1e8&scoped=true&bindings={}\"\nimport script from \"./parts.vue?vue&type=script&lang=ts\"\nexport * from \"./parts.vue?vue&type=script&lang=ts\"\n\nimport \"./parts.vue?vue&type=style&index=0&id=47f2e1e8&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-47f2e1e8\"\n\nexport default script","\nimport {\n\tgetData,\n\tgetParts,\n\tISeekPoseAction,\n\tISeekPosePartAction,\n\tICharacter,\n\tISeekStyleAction,\n} from '@/store/objectTypes/characters';\nimport Toggle from '@/components/toggle.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport Parts from './character/parts.vue';\nimport { Character } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport { PanelMixin } from './panelMixin';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<ICharacter>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tParts,\n\t\tDFieldset,\n\t\tImageOptions,\n\t},\n\tdata: () => ({\n\t\timageOptionsOpen: false,\n\t\tpanelForParts: null as string | null,\n\t}),\n\tcomputed: {\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\tcloseUp: setable('close', 'objects/setClose'),\n\t\tselection(): string {\n\t\t\treturn this.$store.state.ui.selection!;\n\t\t},\n\t\tobject(): DeepReadonly<ICharacter> {\n\t\t\tconst obj = this.$store.state.objects.objects[this.selection];\n\t\t\tif (obj.type !== 'character') return undefined!;\n\t\t\treturn obj as ICharacter;\n\t\t},\n\t\tcharData(): DeepReadonly<Character<IAsset>> {\n\t\t\treturn getData(this.$store, this.object);\n\t\t},\n\t\tlabel(): string {\n\t\t\treturn this.charData.label || '';\n\t\t},\n\t\tparts(): DeepReadonly<string[]> {\n\t\t\treturn getParts(this.charData, this.object);\n\t\t},\n\t\thasMultipleStyles(): boolean {\n\t\t\treturn (\n\t\t\t\tthis.charData.styleGroups[this.object.styleGroupId].styles.length > 1 ||\n\t\t\t\tthis.charData.styleGroups.length > 1\n\t\t\t);\n\t\t},\n\t\thasMultiplePoses(): boolean {\n\t\t\tconst styleGroup = this.charData.styleGroups[this.object.styleGroupId];\n\t\t\tconst style = styleGroup.styles[this.object.styleId];\n\t\t\treturn style.poses.length > 1;\n\t\t},\n\t},\n\tmethods: {\n\t\tseekPose(delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekPose', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as ISeekPoseAction);\n\t\t\t});\n\t\t},\n\t\tseekStyle(delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekStyle', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as ISeekStyleAction);\n\t\t\t});\n\t\t},\n\t\tseekPart(part: string, delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekPart', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t\tpart,\n\t\t\t\t} as ISeekPosePartAction);\n\t\t\t});\n\t\t},\n\t\tcaptialize(str: string) {\n\t\t\treturn str.charAt(0).toUpperCase() + str.substring(1);\n\t\t},\n\t},\n\twatch: {\n\t\tselection() {\n\t\t\tthis.panelForParts = null;\n\t\t},\n\t},\n});\n","import { render } from \"./character.vue?vue&type=template&id=6d0ef99f&scoped=true&bindings={}\"\nimport script from \"./character.vue?vue&type=script&lang=ts\"\nexport * from \"./character.vue?vue&type=script&lang=ts\"\n\nimport \"./character.vue?vue&type=style&index=0&id=6d0ef99f&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-6d0ef99f\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<image-options\n\t\t\tv-if=\"imageOptionsOpen\"\n\t\t\ttype=\"object\"\n\t\t\ttitle=\"Custom Sprite\"\n\t\t\t:id=\"object.id\"\n\t\t\t@leave=\"imageOptionsOpen = false\"\n\t\t/>\n\t\t<template v-else>\n\t\t\t<h1>Custom Sprite</h1>\n\t\t\t<position-and-size :obj=\"object\" />\n\t\t\t<layers :object=\"object\" />\n\t\t\t<toggle v-model=\"flip\" label=\"Flip?\" />\n\t\t\t<button @click=\"imageOptionsOpen = true\">Image options</button>\n\t\t\t<delete :obj=\"object\" />\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport { ISprite } from '@/store/objectTypes/sprite';\nimport { PanelMixin } from './panelMixin';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tImageOptions,\n\t},\n\tdata: () => ({\n\t\timageOptionsOpen: false,\n\t}),\n\tcomputed: {\n\t\tobject(): ISprite {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'sprite') return undefined!;\n\t\t\treturn obj as ISprite;\n\t\t},\n\t\tflip: genericSetable<ISprite>()('flip', 'objects/setFlip'),\n\t},\n});\n</script>\n","\nimport Toggle from '@/components/toggle.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport { ISprite } from '@/store/objectTypes/sprite';\nimport { PanelMixin } from './panelMixin';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tImageOptions,\n\t},\n\tdata: () => ({\n\t\timageOptionsOpen: false,\n\t}),\n\tcomputed: {\n\t\tobject(): ISprite {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'sprite') return undefined!;\n\t\t\treturn obj as ISprite;\n\t\t},\n\t\tflip: genericSetable<ISprite>()('flip', 'objects/setFlip'),\n\t},\n});\n","import { render } from \"./sprite.vue?vue&type=template&id=7fd53be0&bindings={}\"\nimport script from \"./sprite.vue?vue&type=script&lang=ts\"\nexport * from \"./sprite.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>Textbox</h1>\n\t\t<color\n\t\t\tv-if=\"colorSelect !== ''\"\n\t\t\t:title=\"colorName\"\n\t\t\tv-model=\"color\"\n\t\t\t@leave=\"colorSelect = ''\"\n\t\t/>\n\t\t<text-editor\n\t\t\tv-else-if=\"textEditor !== ''\"\n\t\t\t:title=\"textEditorName\"\n\t\t\tv-model=\"textEditorText\"\n\t\t\t@leave=\"textEditor = ''\"\n\t\t/>\n\t\t<image-options\n\t\t\tv-else-if=\"imageOptionsOpen\"\n\t\t\ttype=\"object\"\n\t\t\ttitle=\"Textbox\"\n\t\t\t:id=\"object.id\"\n\t\t\t@leave=\"imageOptionsOpen = false\"\n\t\t/>\n\t\t<template v-else>\n\t\t\t<table class=\"upper-combos\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"text_style\">Style:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<select id=\"text_style\" v-model=\"textBoxStyle\" @keydown.stop>\n\t\t\t\t\t\t\t<option value=\"normal\">Normal</option>\n\t\t\t\t\t\t\t<option value=\"corrupt\">Corrupt</option>\n\t\t\t\t\t\t\t<option value=\"custom\">Custom</option>\n\t\t\t\t\t\t\t<option value=\"none\">None</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"current_talking\">Person talking:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tid=\"current_talking\"\n\t\t\t\t\t\t\tv-model=\"talkingDefaults\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"No-one\">No-one</option>\n\t\t\t\t\t\t\t<option value=\"Sayori\">Sayori</option>\n\t\t\t\t\t\t\t<option value=\"Yuri\">Yuri</option>\n\t\t\t\t\t\t\t<option value=\"Natsuki\">Natsuki</option>\n\t\t\t\t\t\t\t<option value=\"Monika\">Monika</option>\n\t\t\t\t\t\t\t<option value=\"FeMC\">FeMC</option>\n\t\t\t\t\t\t\t<option value=\"MC\">MC</option>\n\t\t\t\t\t\t\t<option value=\"Chad\">Chad</option>\n\t\t\t\t\t\t\t<option value=\"Amy\">Amy</option>\n\t\t\t\t\t\t\t<option value=\"Other\">Other</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"custom_name\">Other name:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input id=\"custom_name\" v-model=\"talkingOther\" @keydown.stop />\n\t\t\t\t\t\t<button @click=\"textEditor = 'name'\">...</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\n\t\t\t<toggle label=\"Auto quoting?\" v-model=\"autoQuoting\" />\n\t\t\t<toggle label=\"Auto line wrap?\" v-model=\"autoWrap\" />\n\t\t\t<div id=\"dialog_text_wrapper\">\n\t\t\t\t<label for=\"dialog_text\">Dialog:</label>\n\t\t\t\t<textarea v-model=\"dialog\" id=\"dialog_text\" @keydown.stop />\n\t\t\t\t<button @click=\"textEditor = 'body'\">Formatting</button>\n\t\t\t</div>\n\t\t\t<position-and-size :obj=\"object\" />\n\t\t\t<button @click=\"resetPosition\">Reset position</button>\n\t\t\t<button @click=\"splitTextbox\">Split textbox</button>\n\t\t\t<layers :object=\"object\" />\n\t\t\t<toggle v-model=\"flip\" label=\"Flip?\" />\n\n\t\t\t<d-fieldset title=\"Customization:\">\n\t\t\t\t<toggle label=\"Controls visible?\" v-model=\"showControls\" />\n\t\t\t\t<toggle label=\"Able to skip?\" v-model=\"allowSkipping\" />\n\t\t\t\t<toggle label=\"Continue arrow?\" v-model=\"showContinueArrow\" />\n\t\t\t\t<table v-if=\"textBoxStyle === 'custom'\">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"textbox_color\">Color:</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tid=\"textbox_color\"\n\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t:style=\"{ background: object.customColor }\"\n\t\t\t\t\t\t\t\t@click=\"colorSelect = 'base'\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"custom_namebox_width\">Namebox width:</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"custom_namebox_width\"\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tstyle=\"width: 48px;\"\n\t\t\t\t\t\t\t\tv-model.number=\"customNameboxWidth\"\n\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t\t<toggle\n\t\t\t\t\t\t\t\tid=\"derive_custom_colors\"\n\t\t\t\t\t\t\t\tv-model=\"deriveCustomColors\"\n\t\t\t\t\t\t\t\tlabel=\"Derive other colors\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<template v-if=\"!deriveCustomColors\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"custom_controls_color\">Controls Color:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tid=\"custom_controls_color\"\n\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t:style=\"{ background: object.customControlsColor }\"\n\t\t\t\t\t\t\t\t\t@click=\"colorSelect = 'controls'\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"custom_namebox_color\">Namebox Color:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tid=\"custom_namebox_color\"\n\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t:style=\"{ background: object.customNameboxColor }\"\n\t\t\t\t\t\t\t\t\t@click=\"colorSelect = 'namebox'\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"custom_namebox_stroke\">Namebox text stroke:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tid=\"custom_namebox_stroke\"\n\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t:style=\"{ background: object.customNameboxStroke }\"\n\t\t\t\t\t\t\t\t\t@click=\"colorSelect = 'nameboxStroke'\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</template>\n\t\t\t\t</table>\n\t\t\t</d-fieldset>\n\t\t\t<button @click=\"imageOptionsOpen = true\">Image options</button>\n\t\t\t<delete :obj=\"object\" />\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport {\n\tITextBox,\n\tISetTextBoxCustomColorMutation,\n\tISetTextBoxCustomControlsColorMutation,\n\tISetTextBoxNameboxColorMutation,\n\tISetTextBoxNameboxStrokeMutation,\n\tISplitTextbox,\n\tIResetTextboxBounds,\n} from '@/store/objectTypes/textbox';\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport Color from '../subtools/color/color.vue';\nimport TextEditor from '../subtools/text/text.vue';\nimport { defineComponent } from 'vue';\nimport { exhaust } from '@/util/exhaust';\nimport { PanelMixin } from './panelMixin';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<ITextBox>();\n\nexport default defineComponent({\n\tcomponents: {\n\t\tToggle,\n\t\tDFieldset,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tColor,\n\t\tTextEditor,\n\t\tImageOptions,\n\t},\n\tmixins: [PanelMixin],\n\tdata: () => ({\n\t\ttextEditor: '' as '' | 'name' | 'body',\n\t\tcolorSelect: '' as '' | 'base' | 'controls' | 'namebox' | 'nameboxStroke',\n\t\timageOptionsOpen: false,\n\t}),\n\tcomputed: {\n\t\tobject(): ITextBox {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'textBox') return undefined!;\n\t\t\treturn obj as ITextBox;\n\t\t},\n\t\ttextEditorText: {\n\t\t\tget(): string {\n\t\t\t\tif (this.textEditor === 'name') return this.object.talkingOther;\n\t\t\t\tif (this.textEditor === 'body') return this.dialog;\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tset(value: string) {\n\t\t\t\tif (this.textEditor === 'name') this.talkingOther = value;\n\t\t\t\telse if (this.textEditor === 'body') this.dialog = value;\n\t\t\t},\n\t\t},\n\t\ttalkingDefaults: setable('talkingDefault', 'objects/setTalkingDefault'),\n\t\ttalkingOther: setable('talkingOther', 'objects/setTalkingOther'),\n\t\tshowControls: setable('controls', 'objects/setControlsVisible'),\n\t\tallowSkipping: setable('skip', 'objects/setSkipable'),\n\t\tautoQuoting: setable('autoQuoting', 'objects/setAutoQuoting'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\tshowContinueArrow: setable('continue', 'objects/setContinueArrow'),\n\t\tdialog: setable('text', 'objects/setText'),\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\ttextBoxStyle: setable('style', 'objects/setStyle'),\n\t\tderiveCustomColors: setable(\n\t\t\t'deriveCustomColors',\n\t\t\t'objects/setDeriveCustomColors'\n\t\t),\n\t\tcustomNameboxWidth: setable(\n\t\t\t'customNameboxWidth',\n\t\t\t'objects/setNameboxWidth'\n\t\t),\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\tswitch (this.colorSelect) {\n\t\t\t\t\tcase '':\n\t\t\t\t\t\treturn '#000000';\n\t\t\t\t\tcase 'base':\n\t\t\t\t\t\treturn this.object.customColor;\n\t\t\t\t\tcase 'controls':\n\t\t\t\t\t\treturn this.object.customControlsColor;\n\t\t\t\t\tcase 'namebox':\n\t\t\t\t\t\treturn this.object.customNameboxColor;\n\t\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\t\treturn this.object.customNameboxStroke;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\texhaust(this.colorSelect);\n\t\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tswitch (this.colorSelect) {\n\t\t\t\t\t\tcase '':\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tcase 'base':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setCustomColor', {\n\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\t} as ISetTextBoxCustomColorMutation);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tcase 'controls':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setControlsColor', {\n\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\tcustomControlsColor: color,\n\t\t\t\t\t\t\t} as ISetTextBoxCustomControlsColorMutation);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tcase 'namebox':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setNameboxColor', {\n\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\tcustomNameboxColor: color,\n\t\t\t\t\t\t\t} as ISetTextBoxNameboxColorMutation);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setNameboxStroke', {\n\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\tcustomNameboxStroke: color,\n\t\t\t\t\t\t\t} as ISetTextBoxNameboxStrokeMutation);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ttextEditorName(): string {\n\t\t\tif (this.textEditor === 'name') return 'Name';\n\t\t\tif (this.textEditor === 'body') return 'Dialog';\n\t\t\treturn '';\n\t\t},\n\t\tcustomControlsColor(): string {\n\t\t\treturn this.object.customControlsColor;\n\t\t},\n\t\tcolorName(): string {\n\t\t\tswitch (this.colorSelect) {\n\t\t\t\tcase '':\n\t\t\t\t\treturn '';\n\t\t\t\tcase 'base':\n\t\t\t\t\treturn 'Base color';\n\t\t\t\tcase 'controls':\n\t\t\t\t\treturn 'Controls color';\n\t\t\t\tcase 'namebox':\n\t\t\t\t\treturn 'Namebox color';\n\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\treturn 'Namebox text stroke';\n\t\t\t\tdefault:\n\t\t\t\t\texhaust(this.colorSelect);\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\tsplitTextbox(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/splitTextbox', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as ISplitTextbox);\n\t\t\t});\n\t\t},\n\t\tresetPosition(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/resetTextboxBounds', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as IResetTextboxBounds);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n<style lang=\"scss\" scoped>\n.panel {\n\t&.vertical {\n\t\t#dialog_text_wrapper {\n\t\t\twidth: 173px;\n\n\t\t\ttextarea {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\ttable {\n\t\t\twidth: 100%;\n\n\t\t\tinput,\n\t\t\tselect {\n\t\t\t\twidth: 100px;\n\t\t\t}\n\t\t}\n\t}\n\n\ttextarea {\n\t\tdisplay: block;\n\t\theight: 114px;\n\t}\n\n\t&:not(.vertical) {\n\t\ttable.upper-combos {\n\t\t\twidth: 256px;\n\n\t\t\tselect {\n\t\t\t\twidth: 100px;\n\t\t\t}\n\t\t\tinput {\n\t\t\t\twidth: 75px;\n\t\t\t}\n\t\t\tbutton {\n\t\t\t\twidth: 25px;\n\t\t\t}\n\t\t}\n\t\tfieldset {\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: row;\n\t\t\tflex-wrap: wrap;\n\t\t\talign-content: flex-start;\n\t\t\tmax-height: 100%;\n\t\t\toverflow: auto;\n\t\t}\n\t}\n}\n\np {\n\tmax-width: 148px;\n}\n\n.color-button {\n\theight: 24px;\n\twidth: 48px;\n\tvertical-align: middle;\n}\n</style>\n","<template>\n\t<color v-if=\"colorSelector\" v-model=\"selectedColor\" @leave=\"applyColor\" />\n\t<div v-else :class=\"{ 'text-subpanel': true, vertical }\">\n\t\t<h2>{{ title }}</h2>\n\t\t<div class=\"column ok-col\">\n\t\t\t<button @click=\"$emit('leave')\">OK</button>\n\t\t</div>\n\t\t<div class=\"column\">\n\t\t\t<textarea\n\t\t\t\tref=\"textArea\"\n\t\t\t\t:value=\"modelValue\"\n\t\t\t\t@input=\"onValueChanged\"\n\t\t\t\t@keydown.stop\n\t\t\t\t@keypress.stop\n\t\t\t/>\n\t\t</div>\n\t\t<div class=\"column error-col\" v-if=\"error\">{{ error }}</div>\n\t\t<div class=\"column\">\n\t\t\t<button @click=\"insertText('\\\\\\\\')\" class=\"style-button\">Insert \\</button>\n\t\t\t<button @click=\"insertText('\\\\{')\" class=\"style-button\">Insert {</button>\n\t\t\t<button @click=\"insertText('\\\\}')\" class=\"style-button\">Insert }</button>\n\t\t</div>\n\t\t<p class=\"hint-col\">Apply style to selected text:</p>\n\t\t<div class=\"column\">\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('b')\"\n\t\t\t\tclass=\"style-button\"\n\t\t\t\tstyle=\"font-weight: bold\"\n\t\t\t>\n\t\t\t\tBold\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('i')\"\n\t\t\t\tclass=\"style-button\"\n\t\t\t\tstyle=\"font-style: italic\"\n\t\t\t>\n\t\t\t\tItalics\n\t\t\t</button>\n\t\t\t<button @click=\"insertCommand('plain')\" class=\"style-button\">\n\t\t\t\tPlain\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('edited')\"\n\t\t\t\tclass=\"style-button edited-style\"\n\t\t\t>\n\t\t\t\tEdited\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('k', 2)\"\n\t\t\t\tclass=\"style-button\"\n\t\t\t\tstyle=\"letter-spacing: 5px;\"\n\t\t\t>\n\t\t\t\tKerning\n\t\t\t</button>\n\t\t</div>\n\t\t<div class=\"column\">\n\t\t\t<button @click=\"insertCommand('alpha', 0.5)\" class=\"style-button\">\n\t\t\t\tAlpha\n\t\t\t</button>\n\t\t</div>\n\t\t<div class=\"column\">\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('size', 12)\"\n\t\t\t\tclass=\"style-button\"\n\t\t\t\tstyle=\"font-size: 20px\"\n\t\t\t>\n\t\t\t\tFont size\n\t\t\t</button>\n\t\t\t<select v-model=\"selectedFont\" class=\"style-button\">\n\t\t\t\t<option value>Font</option>\n\t\t\t\t<option value=\"aller\" style=\"font-family: aller\"\n\t\t\t\t\t>Aller (Textbox)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"riffic\" style=\"font-family: riffic\"\n\t\t\t\t\t>Riffic (Bold text)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"hashtag\" style=\"font-family: hashtag\"\n\t\t\t\t\t>Hashtag (Sayori)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"ammy_handwriting\" style=\"font-family: ammy_handwriting\"\n\t\t\t\t\t>Ammy's Handwriting (Natsuki)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"journal\" style=\"font-family: journal\"\n\t\t\t\t\t>Journal (Monika)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"jp_hand_slanted\" style=\"font-family: jp_hand_slanted\"\n\t\t\t\t\t>JP Hand Slanted (Yuri)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"damagrafik_script\" style=\"font-family: damagrafik_script\"\n\t\t\t\t\t>Damagrafik (Yuri, Act 2)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"as_i_lay_dying\" style=\"font-family: as_i_lay_dying\"\n\t\t\t\t\t>As I Lay Dying (Yuri, Act Unused)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"halogen\" style=\"font-family: halogen\"\n\t\t\t\t\t>Halogen (MC)</option\n\t\t\t\t>\n\t\t\t</select>\n\t\t\t<button @click=\"selectColor('text')\" class=\"style-button\">\n\t\t\t\tText color\n\t\t\t</button>\n\t\t\t<button @click=\"selectColor('outline')\" class=\"style-button\">\n\t\t\t\tOutline color\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport Color from '../color/color.vue';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { NameboxTextStyle } from '@/constants/textBox';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Color },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata: () => ({\n\t\tcolorSelector: '' as '' | 'text' | 'outline',\n\t\tselectedFont: '',\n\t\tselectedColor: '#000000',\n\t\trememberedStart: 0,\n\t\trememberedEnd: 0,\n\t\terror: '',\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\twatch: {\n\t\tselectedFont() {\n\t\t\tif (this.selectedFont === '') return;\n\t\t\tthis.insertCommand('font', this.selectedFont);\n\t\t\tthis.selectedFont = '';\n\t\t},\n\t},\n\tmethods: {\n\t\tonValueChanged() {\n\t\t\tconst val = (this.$refs.textArea as HTMLTextAreaElement).value;\n\t\t\ttry {\n\t\t\t\t// tslint:disable-next-line: no-unused-expression\n\t\t\t\tnew TextRenderer(val, NameboxTextStyle);\n\t\t\t\tthis.error = '';\n\t\t\t} catch (e) {\n\t\t\t\tthis.error = (e as Error).message;\n\t\t\t}\n\t\t\tthis.$emit('update:modelValue', val);\n\t\t},\n\t\tselectColor(colorSelector: '' | 'text' | 'outline') {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tthis.colorSelector = colorSelector;\n\t\t\tthis.rememberedStart = el.selectionStart;\n\t\t\tthis.rememberedEnd = el.selectionEnd;\n\t\t},\n\t\tapplyColor() {\n\t\t\tconst color = this.selectedColor;\n\t\t\tconst colorSelector = this.colorSelector;\n\t\t\tconst apply = () => {\n\t\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\t\tif (!el) {\n\t\t\t\t\tthis.$nextTick(apply);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tel.selectionStart = this.rememberedStart;\n\t\t\t\tel.selectionEnd = this.rememberedEnd;\n\t\t\t\tthis.insertCommand(\n\t\t\t\t\tcolorSelector === 'text' ? 'color' : 'outlinecolor',\n\t\t\t\t\tcolor\n\t\t\t\t);\n\t\t\t};\n\t\t\tthis.$nextTick(apply);\n\t\t\tthis.selectedColor = '#000000';\n\t\t\tthis.colorSelector = '';\n\t\t},\n\t\tinsertText(text: string) {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tconst val = el.value;\n\t\t\tconst selStart = el.selectionStart;\n\t\t\tconst selEnd = el.selectionEnd;\n\t\t\tel.value = val.slice(0, selStart) + text + val.slice(selEnd);\n\t\t\tel.selectionStart = el.selectionEnd = selStart + text.length;\n\t\t\tel.focus();\n\t\t\tthis.onValueChanged();\n\t\t},\n\t\tinsertCommand(command: string, arg?: any) {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tconst val = el.value;\n\t\t\tconst selStart = el.selectionStart;\n\t\t\tconst selEnd = el.selectionEnd;\n\t\t\tconst selectedText = val.slice(selStart, selEnd);\n\t\t\tconst before = val.slice(0, selStart);\n\t\t\tconst after = val.slice(selEnd);\n\t\t\tlet commandOpen = command;\n\t\t\tif (arg) {\n\t\t\t\tcommandOpen += '=' + arg;\n\t\t\t}\n\t\t\tel.value = `${before}{${commandOpen}}${selectedText}{/${command}}${after}`;\n\t\t\tel.selectionStart = selStart + commandOpen.length + 2;\n\t\t\tel.selectionEnd = el.selectionStart + selectedText.length;\n\t\t\tel.focus();\n\t\t\tthis.onValueChanged();\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.text-subpanel {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\t//flex-flow: nowrap;\n\n\th2 {\n\t\tfont-size: 20px;\n\t\tcolor: black;\n\t\tfont-family: riffic, sans-serif;\n\t\ttext-align: center;\n\t}\n\n\t&.vertical {\n\t\tflex-direction: row;\n\t\twidth: 100%;\n\n\t\t.column {\n\t\t\twidth: 100%;\n\n\t\t\tbutton,\n\t\t\tselect {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\ttextarea {\n\t\t\theight: 128px;\n\t\t}\n\t}\n\n\t.error-col {\n\t\tcolor: #880000;\n\t}\n\n\t&:not(.vertical) {\n\t\tflex-direction: column;\n\t\t@include height-100();\n\n\t\th2 {\n\t\t\twriting-mode: vertical-rl;\n\t\t\t@include height-100();\n\t\t}\n\n\t\t.column {\n\t\t\tdisplay: flex;\n\t\t\t@include height-100();\n\t\t\tflex-direction: column;\n\t\t\tflex-wrap: wrap;\n\n\t\t\ttextarea {\n\t\t\t\t@include height-100();\n\t\t\t}\n\t\t}\n\n\t\t.hint-col {\n\t\t\twidth: 64px;\n\t\t\tmargin: 4px;\n\t\t}\n\n\t\t.error-col {\n\t\t\theight: 100%;\n\t\t\twidth: 168px;\n\t\t}\n\t\t.ok-col {\n\t\t\twidth: 32px;\n\t\t\tbutton {\n\t\t\t\t@include height-100();\n\t\t\t}\n\t\t}\n\t}\n}\n\n.hex-selector {\n\tdisplay: table;\n\tlabel {\n\t\ttext-align: right;\n\t\twidth: 100px;\n\t}\n\n\tinput {\n\t\tmargin-left: 7px;\n\t}\n\n\t&.vertical {\n\t\t> * {\n\t\t\tdisplay: table-row;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t> * {\n\t\t\tdisplay: table-cell;\n\t\t\tvertical-align: middle;\n\t\t}\n\t}\n}\n\n#color-swatches {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: space-evenly;\n\n\t&.vertical {\n\t\tmargin-top: 4px;\n\t\twidth: 100%;\n\t\tflex-direction: row;\n\t}\n\n\t&:not(.vertical) {\n\t\tmargin-left: 4px;\n\t\theight: 100%;\n\t\tflex-direction: column;\n\t}\n\n\t.swatch {\n\t\theight: 42px;\n\t\twidth: 42px;\n\t\tmargin: 1px;\n\t\tborder-color: black;\n\t}\n}\n\n.style-button {\n\tpadding: 4px;\n}\n\n.edited-style {\n\tcolor: white;\n\ttext-shadow: 0 6px 0.3px #000, 1px 6px 0.3px #000, 2px 5px 0.3px #000,\n\t\t3px 5px 0.3px #000, 4px 4px 0.3px #000, 5px 3px 0.3px #000,\n\t\t5px 2px 0.3px #000, 7px 1px 0.3px #000, 6px 0 0.3px #000,\n\t\t6px -1px 0.3px #000, 5px -2px 0.3px #000, 5px -3px 0.3px #000,\n\t\t4px -4px 0.3px #000, 3px -5px 0.3px #000, 2px -5px 0.3px #000,\n\t\t1px -6px 0.3px #000, 0 -6px 0.3px #000, -1px -6px 0.3px #000,\n\t\t-2px -5px 0.3px #000, -3px -5px 0.3px #000, -4px -4px 0.3px #000,\n\t\t-5px -3px 0.3px #000, -5px -2px 0.3px #000, -6px -1px 0.3px #000,\n\t\t-6px 0 0.3px #000, -6px 1px 0.3px #000, -5px 2px 0.3px #000,\n\t\t-5px 3px 0.3px #000, -4px 4px 0.3px #000, -3px 5px 0.3px #000,\n\t\t-2px 5px 0.3px #000, -1px 6px 0.3px #000, 0 6px 0 #000, 1px 6px 0 #000,\n\t\t2px 5px 0 #000, 3px 5px 0 #000, 4px 4px 0 #000, 5px 3px 0 #000,\n\t\t5px 2px 0 #000, 7px 1px 0 #000, 6px 0 0 #000, 6px -1px 0 #000,\n\t\t5px -2px 0 #000, 5px -3px 0 #000, 4px -4px 0 #000, 3px -5px 0 #000,\n\t\t2px -5px 0 #000, 1px -6px 0 #000, 0 -6px 0 #000, -1px -6px 0 #000,\n\t\t-2px -5px 0 #000, -3px -5px 0 #000, -4px -4px 0 #000, -5px -3px 0 #000,\n\t\t-5px -2px 0 #000, -6px -1px 0 #000, -6px 0 0 #000, -6px 1px 0 #000,\n\t\t-5px 2px 0 #000, -5px 3px 0 #000, -4px 4px 0 #000, -3px 5px 0 #000,\n\t\t-2px 5px 0 #000, -1px 6px 0 #000, 0 5px 0 #000, 1px 5px 0 #000,\n\t\t2px 4px 0 #000, 3px 4px 0 #000, 4px 3px 0 #000, 4px 2px 0 #000,\n\t\t5px 1px 0 #000, 5px 0 0 #000, 5px -1px 0 #000, 4px -2px 0 #000,\n\t\t4px -3px 0 #000, 3px -4px 0 #000, 2px -4px 0 #000, 1px -5px 0 #000,\n\t\t0 -5px 0 #000, -1px -5px 0 #000, -2px -4px 0 #000, -3px -4px 0 #000,\n\t\t-4px -3px 0 #000, -4px -2px 0 #000, -5px -1px 0 #000, -5px 0 0 #000,\n\t\t-5px 1px 0 #000, -4px 2px 0 #000, -4px 3px 0 #000, -3px 4px 0 #000,\n\t\t-2px 4px 0 #000, -1px 5px 0 #000, 0 4px 0 #000, 1px 4px 0 #000,\n\t\t2px 3px 0 #000, 3px 3px 0 #000, 3px 2px 0 #000, 4px 1px 0 #000, 4px 0 0 #000,\n\t\t4px -1px 0 #000, 3px -2px 0 #000, 3px -3px 0 #000, 2px -3px 0 #000,\n\t\t1px -4px 0 #000, 0 -4px 0 #000, -1px -4px 0 #000, -2px -3px 0 #000,\n\t\t-3px -3px 0 #000, -3px -2px 0 #000, -4px -1px 0 #000, -4px 0 0 #000,\n\t\t-4px 1px 0 #000, -3px 2px 0 #000, -3px 3px 0 #000, -2px 3px 0 #000,\n\t\t-1px 4px 0 #000, 0 3px 0 #000, 1px 3px 0 #000, 2px 2px 0 #000,\n\t\t3px 1px 0 #000, 3px 0 0 #000, 1px -3px 0 #000, 2px -2px 0 #000,\n\t\t3px -1px 0 #000, 0 -3px 0 #000, -1px -3px 0 #000, -2px -2px 0 #000,\n\t\t-3px -1px 0 #000, -3px 0 0 #000, -1px 3px 0 #000, -2px 2px 0 #000,\n\t\t-3px 1px 0 #000, 0 2px 0 #000, 1px 2px 0 #000, 2px 1px 0 #000, 2px 0 0 #000,\n\t\t1px -2px 0 #000, 2px -1px 0 #000, 0 -2px 0 #000, -1px -2px 0 #000,\n\t\t-2px -1px 0 #000, -2px 0 0 #000, -1px 2px 0 #000, -2px 1px 0 #000,\n\t\t0 1px 0 #000, 1px 1px 0 #000, 1px 0 0 #000, 1px -1px 0 #000, 0 -1px 0 #000,\n\t\t-1px -1px 0 #000, -1px 0 0 #000, -1px 1px 0 #000;\n}\n</style>\n","const aroundContextSize = 5;\n\nexport class StringWalker {\n\tprivate i: number = 0;\n\tpublic constructor(private readonly str: string) {}\n\n\tpublic get pos(): number {\n\t\treturn this.i;\n\t}\n\n\tpublic current(): string {\n\t\treturn this.str[this.i];\n\t}\n\n\tpublic get around(): string {\n\t\treturn this.str.slice(\n\t\t\tMath.max(0, this.i - aroundContextSize),\n\t\t\tthis.i + aroundContextSize\n\t\t);\n\t}\n\n\tpublic get ahead(): string {\n\t\treturn this.str[this.i + 1];\n\t}\n\n\tpublic get behind(): string {\n\t\treturn this.str[this.i + 1];\n\t}\n\n\tpublic next(): string {\n\t\t++this.i;\n\t\treturn this.current();\n\t}\n}\n","import { StringWalker } from './string-walker';\n\ninterface ITextToken {\n\tcontent: string;\n\tpos: number;\n\ttype: 'text';\n}\nexport interface ICommandToken {\n\tcommandName: string;\n\targument: string;\n\tpos: number;\n\ttype: 'command';\n}\ninterface ICommandCloseToken {\n\tcommandName: string;\n\tpos: number;\n\ttype: 'commandClose';\n}\ninterface INewlineToken {\n\ttype: 'newline';\n\tpos: number;\n}\n\nexport type Token =\n\t| ITextToken\n\t| ICommandToken\n\t| ICommandCloseToken\n\t| INewlineToken;\n\nexport function tokenize(str: string): Token[] {\n\tconst tokens: Token[] = [];\n\tconst stringWalker = new StringWalker(str);\n\tlet currentTokenState: TokenizerState = tokenStateNormal;\n\twhile (currentTokenState !== tokenStateEnd) {\n\t\tcurrentTokenState = currentTokenState(tokens, stringWalker);\n\t}\n\treturn tokens;\n}\n\ntype TokenizerState = (\n\tcontents: Token[],\n\twalker: StringWalker\n) => TokenizerState;\n\nfunction tokenStateNormal(\n\tcontents: Token[],\n\twalker: StringWalker\n): TokenizerState {\n\tif (walker.current() === undefined) return tokenStateEnd;\n\tif (walker.current() === '{') return tokenStateCommand;\n\tif (walker.current() === '\\n') return tokenStateNewLine;\n\treturn tokenText;\n}\n\nfunction tokenStateEnd(): TokenizerState {\n\treturn tokenStateEnd;\n}\n\nfunction tokenText(contents: Token[], walker: StringWalker): TokenizerState {\n\tconst { pos } = walker;\n\tlet textContent = '';\n\tlet escape = false;\n\tlet nextState: TokenizerState;\n\twhile (true) {\n\t\tif (walker.current() === undefined) {\n\t\t\tnextState = tokenStateEnd;\n\t\t\tbreak;\n\t\t} else if (escape) {\n\t\t\ttextContent += walker.current();\n\t\t\tescape = false;\n\t\t} else if (walker.current() === '\\\\') {\n\t\t\tescape = true;\n\t\t} else if (walker.current() === '{' || walker.current() === '\\n') {\n\t\t\tnextState = tokenStateNormal;\n\t\t\tbreak;\n\t\t} else {\n\t\t\ttextContent += walker.current();\n\t\t}\n\t\twalker.next();\n\t}\n\tcontents.push({\n\t\ttype: 'text',\n\t\tpos,\n\t\tcontent: textContent,\n\t});\n\treturn nextState;\n}\n\nfunction error(walker: StringWalker, msg: string): never {\n\tthrow new Error(\n\t\t`Error at position ${walker.pos}: (around: ${walker.around}) ${msg}`\n\t);\n}\n\nfunction tokenStateCommand(\n\tcontents: Token[],\n\twalker: StringWalker\n): TokenizerState {\n\tconst { pos } = walker;\n\tif (walker.current() !== '{') {\n\t\tthrow new Error('Parser error: Command does not start with {');\n\t}\n\tconst closing = walker.next() === '/';\n\tif (closing) {\n\t\twalker.next();\n\t}\n\tlet commandName = '';\n\tlet argument = '';\n\tlet argumentsState = false;\n\n\twhile (true) {\n\t\tif (walker.current() === undefined) {\n\t\t\terror(walker, 'Unexpected end of text inside a command');\n\t\t}\n\t\tif (walker.current() === '}') {\n\t\t\tbreak;\n\t\t} else if (!argumentsState) {\n\t\t\tif (walker.current().match(/[a-z]/i)) {\n\t\t\t\tcommandName += walker.current();\n\t\t\t} else if (walker.current() === '=') {\n\t\t\t\tif (closing) {\n\t\t\t\t\terror(walker, 'Closing commands may not contain arguments');\n\t\t\t\t}\n\t\t\t\targumentsState = true;\n\t\t\t} else {\n\t\t\t\terror(walker, 'Unexpected character in command name.');\n\t\t\t}\n\t\t} else {\n\t\t\targument += walker.current();\n\t\t}\n\t\twalker.next();\n\t}\n\twalker.next();\n\tif (closing) {\n\t\tcontents.push({\n\t\t\ttype: 'commandClose',\n\t\t\tcommandName,\n\t\t\tpos,\n\t\t});\n\t} else {\n\t\tcontents.push({\n\t\t\ttype: 'command',\n\t\t\tpos,\n\t\t\targument,\n\t\t\tcommandName,\n\t\t});\n\t}\n\treturn tokenStateNormal;\n}\n\nfunction tokenStateNewLine(\n\tcontents: Token[],\n\twalker: StringWalker\n): TokenizerState {\n\tcontents.push({ type: 'newline', pos: walker.pos });\n\twalker.next();\n\treturn tokenStateNormal;\n}\n","import { ITextStyle } from './textRenderer';\n\ntype Command = (style: ITextStyle, parameter?: string) => ITextStyle;\n\nexport default new Map<string, Command>([\n\tparamlessOp('i', style => ({ ...style, isItalic: true })),\n\tparamlessOp('b', style => ({ ...style, isBold: true })),\n\tparamlessOp('u', style => ({ ...style, isUnderlined: true })),\n\tparamlessOp('s', style => ({\n\t\t...style,\n\t\tisStrikethrough: true,\n\t})),\n\tparamlessOp('plain', style => ({\n\t\t...style,\n\t\tisStrikethrough: false,\n\t\tisUnderlined: false,\n\t\tisBold: false,\n\t\tisItalic: false,\n\t})),\n\tparamlessOp('edited', style => ({\n\t\t...style,\n\t\tfontName: 'verily',\n\t\tstrokeColor: '#000000',\n\t\tstrokeWidth: 20,\n\t\tletterSpacing: 8,\n\t})),\n\trelativeNumberOp('k', (style, relative, parameter) => ({\n\t\t...style,\n\t\tletterSpacing: relative ? style.letterSpacing + parameter : parameter,\n\t})),\n\trelativeNumberOp('size', (style, relative, parameter) => ({\n\t\t...style,\n\t\tfontSize: relative ? style.fontSize + parameter : parameter,\n\t})),\n\trelativeNumberOp('alpha', (style, relative, parameter) => ({\n\t\t...style,\n\t\talpha: relative ? style.alpha + parameter : parameter,\n\t})),\n\trelativeNumberOp('stroke', (style, relative, parameter) => ({\n\t\t...style,\n\t\tstrokeWidth: relative ? style.strokeWidth + parameter : parameter,\n\t})),\n\t[\n\t\t'font',\n\t\t(style, parameter?) => {\n\t\t\treturn { ...style, fontName: parameter! };\n\t\t},\n\t],\n\t[\n\t\t'color',\n\t\t(style, parameter?) => {\n\t\t\treturn { ...style, color: parameter! };\n\t\t},\n\t],\n\t[\n\t\t'outlinecolor',\n\t\t(style, parameter?) => {\n\t\t\treturn { ...style, strokeColor: parameter! };\n\t\t},\n\t],\n]);\n\nfunction paramlessOp(\n\tname: string,\n\top: (style: ITextStyle) => ITextStyle\n): [string, Command] {\n\treturn [\n\t\tname,\n\t\t(style: ITextStyle, parameter?: string) => {\n\t\t\tif (parameter) {\n\t\t\t\tthrow new Error(`Operator '${name}' does not take any arguments.`);\n\t\t\t}\n\t\t\treturn op(style);\n\t\t},\n\t];\n}\n\nfunction numberOp(\n\tname: string,\n\top: (style: ITextStyle, param: number) => ITextStyle\n): [string, Command] {\n\treturn [\n\t\tname,\n\t\t(style: ITextStyle, parameter?: string) => {\n\t\t\tif (!parameter) throw new Error(`Operator '${name}' needs an argument.`);\n\t\t\tconst num = Number(parameter);\n\t\t\tif (isNaN(num)) {\n\t\t\t\tthrow new Error(`Operator '${name}' needs a numeric argument.`);\n\t\t\t}\n\t\t\treturn op(style, num);\n\t\t},\n\t];\n}\n\nfunction relativeNumberOp(\n\tname: string,\n\top: (style: ITextStyle, relative: boolean, param: number) => ITextStyle\n): [string, Command] {\n\treturn [\n\t\tname,\n\t\t(style: ITextStyle, parameter?: string) => {\n\t\t\tif (!parameter) throw new Error(`Operator '${name}' needs an argument.`);\n\t\t\tconst relative = parameter[0] === '+' || parameter[0] === '-';\n\t\t\tconst num = Number(parameter);\n\t\t\tif (isNaN(num)) {\n\t\t\t\tthrow new Error(`Operator '${name}' needs a numeric argument.`);\n\t\t\t}\n\t\t\treturn op(style, relative, num);\n\t\t},\n\t];\n}\n","import { tokenize, Token, ICommandToken } from './tokenizer';\n\nimport textCommands from './textCommands';\nimport { exhaust } from '@/util/exhaust';\n\nexport interface ITextStyle {\n\tfontName: string;\n\tfontSize: number;\n\tisBold: boolean;\n\tisUnderlined: boolean;\n\tisStrikethrough: boolean;\n\tisItalic: boolean;\n\tcolor: string;\n\tstrokeWidth: number;\n\tstrokeColor: string;\n\tletterSpacing: number;\n\tlineSpacing: number;\n\talpha: number;\n}\n\ninterface ITextRenderItem {\n\tx: number;\n\ty: number;\n\theight: number;\n\twidth: number;\n}\n\ninterface IDrawCharacterItem extends ITextRenderItem {\n\ttype: 'character';\n\tcharacter: string;\n\tstyle: ITextStyle;\n}\n\ninterface INewlineItem extends ITextRenderItem {\n\ttype: 'newline';\n}\n\ntype RenderItem = IDrawCharacterItem | INewlineItem;\n\n// const widthCache = new Map<ITextStyle, Map<string, number>>();\n// const heightCache = new Map<ITextStyle, number>();\n\nexport class TextRenderer {\n\tpublic static textCommands = textCommands;\n\tprivate renderParts!: RenderItem[];\n\tprivate readonly tokens: Token[];\n\n\tpublic constructor(\n\t\tprivate str: string,\n\t\tprivate readonly baseStyle: ITextStyle\n\t) {\n\t\tthis.tokens = tokenize(str);\n\t\tthis.rebuildParts();\n\t}\n\n\tpublic rebuildParts() {\n\t\tthis.renderParts = this.getRenderParts(this.tokens, this.baseStyle);\n\t}\n\n\tpublic async loadFonts() {\n\t\tif (!('fonts' in document)) return;\n\t\tconst fonts = new Set<string>();\n\t\tlet currentStyle: ITextStyle | null = null;\n\t\tfor (const part of this.renderParts) {\n\t\t\tif (!('style' in part)) continue;\n\t\t\tif (part.style !== currentStyle) {\n\t\t\t\tcurrentStyle = part.style;\n\t\t\t\tif (currentStyle.fontName) {\n\t\t\t\t\tfonts.add(currentStyle.fontName);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet neededToLoad = false;\n\t\tfor (const font of fonts) {\n\t\t\tconst doc = document as any;\n\t\t\tconst fontString = `8px ${font}`;\n\t\t\tif (!doc.fonts.check(fontString)) {\n\t\t\t\tneededToLoad = true;\n\t\t\t\tawait doc.fonts.load(fontString);\n\t\t\t}\n\t\t}\n\n\t\tif (neededToLoad) {\n\t\t\tconst tokens = tokenize(this.str);\n\t\t\tthis.renderParts = this.getRenderParts(tokens, this.baseStyle);\n\t\t}\n\t}\n\n\tpublic render(ctx: CanvasRenderingContext2D): void {\n\t\tctx.save();\n\t\tlet currentStyle: ITextStyle | null = null;\n\t\tfor (const part of this.renderParts) {\n\t\t\tif (part.type === 'newline') continue;\n\t\t\tif (part.style !== currentStyle) {\n\t\t\t\tcurrentStyle = part.style;\n\t\t\t\tapplyTextStyleToCanvas(currentStyle, ctx);\n\t\t\t}\n\t\t\tif (currentStyle.strokeWidth > 0 && currentStyle.strokeColor > '') {\n\t\t\t\tctx.strokeText(part.character, part.x, part.y);\n\t\t\t}\n\t\t}\n\t\tfor (const part of this.renderParts) {\n\t\t\tif (part.type === 'newline') continue;\n\t\t\tif (part.style !== currentStyle) {\n\t\t\t\tcurrentStyle = part.style;\n\t\t\t\tapplyTextStyleToCanvas(currentStyle, ctx);\n\t\t\t}\n\t\t\tctx.fillText(part.character, part.x, part.y);\n\t\t}\n\t\tctx.restore();\n\t}\n\n\tpublic quote() {\n\t\tenum State {\n\t\t\tNone,\n\t\t\tExplictQuote,\n\t\t\tImplictQuote,\n\t\t\tStar,\n\t\t}\n\n\t\tlet lastChar = -1;\n\t\tlet state = State.None;\n\n\t\tfor (let i = 0; i < this.renderParts.length; ++i) {\n\t\t\tconst part = this.renderParts[i];\n\t\t\tif (part.type !== 'character') continue;\n\t\t\tswitch (state) {\n\t\t\t\tcase State.None:\n\t\t\t\t\tif (part.character.match(/\\s/)) continue;\n\t\t\t\t\tif (part.character === '\"') {\n\t\t\t\t\t\tstate = State.ExplictQuote;\n\t\t\t\t\t\tlastChar = i;\n\t\t\t\t\t} else if (part.character === '*') {\n\t\t\t\t\t\tstate = State.Star;\n\t\t\t\t\t\tlastChar = i;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.renderParts.splice(i, 0, {\n\t\t\t\t\t\t\ttype: 'character',\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\tstyle: part.style,\n\t\t\t\t\t\t\tcharacter: '\"',\n\t\t\t\t\t\t\theight: part.height,\n\t\t\t\t\t\t\twidth: measureWidth(part.style, '\"'),\n\t\t\t\t\t\t});\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tlastChar = i;\n\t\t\t\t\t\tstate = State.ImplictQuote;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase State.ExplictQuote:\n\t\t\t\t\tlastChar = i;\n\t\t\t\t\tif (part.character === '\"') {\n\t\t\t\t\t\tstate = State.None;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase State.ImplictQuote:\n\t\t\t\t\tif (part.character.match(/\\s/)) continue;\n\t\t\t\t\tif (part.character === '*') {\n\t\t\t\t\t\tthis.renderParts.splice(lastChar + 1, 0, {\n\t\t\t\t\t\t\ttype: 'character',\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\tstyle: part.style,\n\t\t\t\t\t\t\tcharacter: '\"',\n\t\t\t\t\t\t\theight: part.height,\n\t\t\t\t\t\t\twidth: measureWidth(part.style, '\"'),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tstate = State.Star;\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\tlastChar = i;\n\t\t\t\t\tbreak;\n\t\t\t\tcase State.Star:\n\t\t\t\t\tif (part.character === '*') {\n\t\t\t\t\t\tstate = State.None;\n\t\t\t\t\t}\n\t\t\t\t\tlastChar = i;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconst lastPart = this.renderParts[lastChar] as IDrawCharacterItem;\n\t\tif (lastPart && state === State.Star) {\n\t\t\tthis.renderParts.splice(lastChar + 1, 0, {\n\t\t\t\ttype: 'character',\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tstyle: lastPart.style,\n\t\t\t\tcharacter: '*',\n\t\t\t\theight: lastPart.height,\n\t\t\t\twidth: measureWidth(lastPart.style, '\"'),\n\t\t\t});\n\t\t}\n\t\tif (\n\t\t\tlastPart &&\n\t\t\t(state === State.ExplictQuote || state === State.ImplictQuote)\n\t\t) {\n\t\t\tthis.renderParts.splice(lastChar + 1, 0, {\n\t\t\t\ttype: 'character',\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tstyle: lastPart.style,\n\t\t\t\tcharacter: '\"',\n\t\t\t\theight: lastPart.height,\n\t\t\t\twidth: measureWidth(lastPart.style, '\"'),\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic fixAlignment(\n\t\talignment: 'left' | 'center' | 'right',\n\t\txStart: number,\n\t\txEnd: number,\n\t\tyStart: number,\n\t\tmaxLineWidth: number\n\t) {\n\t\tlet lineWidth = 0;\n\t\tlet currentLine: RenderItem[] = [];\n\n\t\tfunction fixLine() {\n\t\t\tlet x = xStart;\n\t\t\tif (alignment === 'center') {\n\t\t\t\tx = xStart + (xEnd - xStart) / 2 - lineWidth / 2;\n\t\t\t} else if (alignment === 'right') {\n\t\t\t\tx = xEnd - lineWidth;\n\t\t\t}\n\t\t\tfor (const item of currentLine) {\n\t\t\t\titem.x = x;\n\t\t\t\tx += item.width;\n\t\t\t}\n\t\t}\n\t\tlet renderParts = this.renderParts;\n\n\t\tif (maxLineWidth > 0) {\n\t\t\trenderParts = this.applyLineWrapping(\n\t\t\t\tthis.renderParts.slice(0),\n\t\t\t\tmaxLineWidth\n\t\t\t);\n\t\t}\n\n\t\tlet y = yStart;\n\t\tconst lineHeights = [];\n\t\tlet lineHeight = 0;\n\n\t\tfor (const item of renderParts) {\n\t\t\tlineHeight = Math.max(lineHeight, item.height);\n\n\t\t\tif (item.type === 'newline') {\n\t\t\t\tlineHeights.push(lineHeight);\n\t\t\t\tlineHeight = 0;\n\t\t\t}\n\t\t}\n\t\tlineHeights.push(lineHeight);\n\n\t\tlet line = 0;\n\n\t\tfor (const item of renderParts) {\n\t\t\tlineHeight = Math.max(lineHeight, item.height);\n\t\t\titem.y = y;\n\t\t\tcurrentLine.push(item);\n\t\t\tlineWidth += item.width;\n\n\t\t\tif (item.type === 'newline') {\n\t\t\t\tfixLine();\n\t\t\t\ty += lineHeights[++line] || 0;\n\t\t\t\tlineWidth = 0;\n\t\t\t\tlineHeight = 0;\n\t\t\t\tcurrentLine = [];\n\t\t\t} else if (item.type === 'character') {\n\t\t\t\tconst lastItem = currentLine[currentLine.length - 1];\n\t\t\t\tif (lastItem.type === 'character') {\n\t\t\t\t\tlineWidth += lastItem.style.letterSpacing;\n\t\t\t\t\tlastItem.width += lastItem.style.letterSpacing;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfixLine();\n\t}\n\n\tpublic getHeight(maxLineWidth: number) {\n\t\tlet lineHeight = 0;\n\t\tlet height = 0;\n\t\tconst renderParts =\n\t\t\tmaxLineWidth === 0\n\t\t\t\t? this.renderParts\n\t\t\t\t: this.applyLineWrapping(this.renderParts.slice(0), maxLineWidth);\n\n\t\tfor (const item of renderParts) {\n\t\t\tlineHeight = Math.max(lineHeight, item.height);\n\n\t\t\tif (item.type === 'newline') {\n\t\t\t\theight += lineHeight;\n\t\t\t\tlineHeight = 0;\n\t\t\t}\n\t\t}\n\t\theight += lineHeight;\n\n\t\treturn height;\n\t}\n\n\tpublic getWidth() {\n\t\tlet lineWidth = 0;\n\t\tlet maxLineWidth = 0;\n\t\tlet lastItemInLine: RenderItem | null = null;\n\n\t\tfor (const item of this.renderParts) {\n\t\t\tlineWidth += item.width;\n\n\t\t\tif (item.type === 'newline') {\n\t\t\t\tmaxLineWidth = Math.max(maxLineWidth, lineWidth);\n\t\t\t\tlineWidth = 0;\n\t\t\t\tlastItemInLine = null;\n\t\t\t} else if (item.type === 'character') {\n\t\t\t\tif (lastItemInLine && lastItemInLine.type === 'character') {\n\t\t\t\t\tlineWidth += lastItemInLine.style.letterSpacing;\n\t\t\t\t}\n\t\t\t\tlastItemInLine = item;\n\t\t\t}\n\t\t}\n\t\tmaxLineWidth = Math.max(maxLineWidth, lineWidth);\n\t\treturn maxLineWidth;\n\t}\n\n\tprivate getRenderParts(tokens: Token[], baseStyle: ITextStyle): RenderItem[] {\n\t\tconst renderParts: RenderItem[] = [];\n\t\tconst styleStack: ITextStyle[] = [];\n\t\tconst tagStack: Array<ICommandToken | null> = [];\n\t\tlet currentStyleHeight: number = measureHeight(baseStyle);\n\t\tlet currentStyle = baseStyle;\n\t\tlet currentTag: ICommandToken | null = null;\n\t\tfor (const token of tokens) {\n\t\t\tswitch (token.type) {\n\t\t\t\tcase 'command':\n\t\t\t\t\tif (TextRenderer.textCommands.has(token.commandName)) {\n\t\t\t\t\t\tstyleStack.push(currentStyle);\n\t\t\t\t\t\ttagStack.push(currentTag);\n\t\t\t\t\t\tcurrentStyle = TextRenderer.textCommands.get(token.commandName)!(\n\t\t\t\t\t\t\tcurrentStyle,\n\t\t\t\t\t\t\ttoken.argument\n\t\t\t\t\t\t);\n\t\t\t\t\t\tcurrentStyleHeight = measureHeight(currentStyle);\n\t\t\t\t\t\tcurrentTag = token;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`There is no text command called '${token.commandName}' at position ${token.pos}.`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'commandClose':\n\t\t\t\t\tif (!currentTag) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Unmatched closing command at position ${token.pos}. Closed '${token.commandName}', but no commands are currently open.`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (token.commandName !== currentTag.commandName) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Unmatched closing command at position ${token.pos}. Closed '${token.commandName}', expected to close '${currentTag}' first. (Opened at position ${currentTag.pos})`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcurrentTag = tagStack.pop()!;\n\t\t\t\t\tcurrentStyle = styleStack.pop()!;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'newline':\n\t\t\t\t\trenderParts.push({\n\t\t\t\t\t\theight: currentStyleHeight,\n\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\ttype: 'newline',\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'text':\n\t\t\t\t\tfor (const character of token.content) {\n\t\t\t\t\t\trenderParts.push({\n\t\t\t\t\t\t\ttype: 'character',\n\t\t\t\t\t\t\tcharacter,\n\t\t\t\t\t\t\theight: currentStyleHeight,\n\t\t\t\t\t\t\twidth: measureWidth(currentStyle, character),\n\t\t\t\t\t\t\tstyle: currentStyle,\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn renderParts;\n\t}\n\n\tprivate applyLineWrapping(\n\t\tparts: RenderItem[],\n\t\tmaxLineWidth: number\n\t): RenderItem[] {\n\t\tlet lastBreakPoint = -1;\n\t\tlet currentLineWidth = 0;\n\t\tlet lastBreakLineWidth = 0;\n\t\tconst newParts: RenderItem[] = [];\n\n\t\tfor (const item of parts) {\n\t\t\tif (item.type === 'newline') {\n\t\t\t\tlastBreakPoint = -1;\n\t\t\t\tcurrentLineWidth = 0;\n\t\t\t\tlastBreakLineWidth = 0;\n\t\t\t\tnewParts.push(item);\n\t\t\t} else if (item.type === 'character') {\n\t\t\t\tif (item.character === ' ') {\n\t\t\t\t\tif (currentLineWidth > maxLineWidth) {\n\t\t\t\t\t\tlastBreakPoint = -1;\n\t\t\t\t\t\tcurrentLineWidth = 0;\n\t\t\t\t\t\tlastBreakLineWidth = 0;\n\t\t\t\t\t\tnewParts.push({\n\t\t\t\t\t\t\ttype: 'newline',\n\t\t\t\t\t\t\theight: item.height,\n\t\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrentLineWidth += item.width;\n\t\t\t\t\t\tlastBreakLineWidth = currentLineWidth;\n\t\t\t\t\t\tlastBreakPoint = newParts.length;\n\t\t\t\t\t\tnewParts.push(item);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcurrentLineWidth += item.width;\n\n\t\t\t\t\tif (currentLineWidth > maxLineWidth && lastBreakPoint !== -1) {\n\t\t\t\t\t\tcurrentLineWidth -= lastBreakLineWidth;\n\t\t\t\t\t\tnewParts.splice(lastBreakPoint, 1, {\n\t\t\t\t\t\t\ttype: 'newline',\n\t\t\t\t\t\t\theight: item.height,\n\t\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlastBreakPoint = -1;\n\t\t\t\t\t\tlastBreakLineWidth = 0;\n\t\t\t\t\t\tnewParts.push(item);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewParts.push(item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\texhaust(item);\n\t\t\t}\n\t\t}\n\n\t\treturn newParts;\n\t}\n}\n\nconst tmpContext = document.createElement('canvas').getContext('2d')!;\nlet lastStyle: ITextStyle | null = null;\n\nfunction measureWidth(textStyle: ITextStyle, character: string): number {\n\tif (textStyle !== lastStyle) {\n\t\tapplyTextStyleToCanvas(textStyle, tmpContext);\n\t\tlastStyle = textStyle;\n\t}\n\treturn tmpContext.measureText(character).width;\n}\n\nconst heightCache = new Map<string, number>();\n\nfunction measureHeight(textStyle: ITextStyle): number {\n\tconst font = textStyle.fontSize + ' ' + textStyle.fontName;\n\tif (heightCache.has(font)) {\n\t\treturn heightCache.get(font)! * textStyle.lineSpacing;\n\t}\n\n\tconst text = document.createElement('span');\n\ttext.innerHTML = 'Hg';\n\ttext.style.fontFamily = textStyle.fontName;\n\ttext.style.fontSize = `${textStyle.fontSize}px`;\n\ttext.style.lineHeight = '1';\n\n\tconst div = document.createElement('div');\n\tdiv.style.opacity = '0';\n\tdiv.style.fontFamily = textStyle.fontName;\n\tdiv.style.fontSize = `${textStyle.fontSize}px`;\n\tdiv.style.lineHeight = '1';\n\tdiv.style.position = 'absolute';\n\tdiv.style.top = '0';\n\tdiv.style.left = '0';\n\tdiv.appendChild(text);\n\n\tdocument.body.appendChild(div);\n\n\ttry {\n\t\tconst height = div.offsetHeight;\n\t\theightCache.set(font, height);\n\t\treturn height * textStyle.lineSpacing;\n\t} finally {\n\t\tdiv.remove();\n\t}\n}\n\nfunction applyTextStyleToCanvas(\n\tstyle: ITextStyle,\n\tctx: CanvasRenderingContext2D\n) {\n\tctx.textAlign = 'left';\n\tctx.font =\n\t\t(style.isItalic ? 'italic ' : '') +\n\t\t(style.isBold ? 'bold ' : '') +\n\t\tstyle.fontSize +\n\t\t'px ' +\n\t\tstyle.fontName;\n\tctx.lineJoin = 'round';\n\n\tif (style.strokeWidth > 0 && style.strokeColor > '') {\n\t\tctx.strokeStyle = style.strokeColor;\n\t\tctx.lineWidth = style.strokeWidth;\n\t} else {\n\t\tctx.strokeStyle = '';\n\t\tctx.lineWidth = 0;\n\t}\n\n\tctx.globalAlpha = style.alpha || 0;\n\tctx.fillStyle = style.color;\n}\n","import { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth } from '@/constants/base';\n\n// tslint:disable: no-magic-numbers\nexport const TextBoxWidth = 816;\nexport const TextBoxCorruptedWidth = 900;\nexport const TextBoxHeight = 146;\nexport const TextBoxY = 568;\nexport const TextBoxKerning = 0;\nexport const TextBoxLineHeight = 29;\nexport const TextBoxCorruptedKerning = 8;\nexport const TextBoxTextXOffset = 38;\nexport const TextBoxTextYOffset = 50;\n\nexport const TextBoxTextCorruptedXOffset = 9;\nexport const TextBoxTextCorruptedYOffset = 9;\n\nexport const NameboxHeight = 39;\nexport const NameboxWidth = 168;\nexport const NameboxXOffset = 34;\nexport const NameboxTextYOffset = 29;\n\nexport const ControlsYBottomOffset = 12;\nexport const ControlsXHistoryOffset = -126;\nexport const ControlsXSkipOffset = -72;\nexport const ControlsXStuffOffset = -38;\n\nexport const ArrowXRightOffset = 30.75;\nexport const ArrowYBottomOffset = 26;\n\nexport const GlowRX = 426;\nexport const GlowRY = 58;\n\nexport const BaseTextStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tfontName: 'aller',\n\tfontSize: 24,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n};\n\nexport const NameboxTextStyle: ITextStyle = {\n\t...BaseTextStyle,\n\tfontName: 'riffic',\n\tfontSize: 24,\n\tstrokeColor: '#bb5599',\n\tstrokeWidth: 6,\n\tcolor: 'white',\n\tletterSpacing: 1,\n};\n\nexport const ControlsTextStyle = {\n\talign: 'left' as CanvasTextAlign,\n\tfont: '13px aller',\n\tfill: {\n\t\tstyle: '#522',\n\t},\n};\n\nexport const ControlsTextDisabledStyle = {\n\t...ControlsTextStyle,\n\tfill: {\n\t\tstyle: '#a66',\n\t},\n};\n\nexport const TextBoxStyle = {\n\talign: 'left' as CanvasTextAlign,\n\tfont: '24px aller',\n\toutline: {\n\t\tstyle: '#523140',\n\t\twidth: 4,\n\t},\n\tfill: {\n\t\tstyle: '#fff',\n\t},\n};\n\nexport const TextBoxCorruptedStyle = {\n\talign: 'left' as CanvasTextAlign,\n\tfont: '24px verily',\n\toutline: {\n\t\tstyle: '#000',\n\t\twidth: 20,\n\t},\n\tfill: {\n\t\tstyle: '#fff',\n\t},\n};\n\nexport const TextBoxX = screenWidth / 2 - TextBoxWidth / 2; // 232\nexport const TextBoxCorruptedX = screenWidth / 2 - TextBoxCorruptedWidth / 2;\nexport const TextBoxTextX = TextBoxX + TextBoxTextXOffset;\nexport const TextBoxTextY = TextBoxY + TextBoxTextYOffset;\n\nexport const NameboxY = TextBoxY - NameboxHeight;\nexport const NameboxX = TextBoxX + NameboxXOffset;\nexport const NameboxTextX = NameboxX + NameboxWidth / 2;\nexport const NameboxTextY = NameboxY + NameboxTextYOffset;\n\nexport const ControlsXHistory = TextBoxX + ControlsXHistoryOffset;\nexport const ControlsXSkip = TextBoxX + ControlsXSkipOffset;\nexport const ControlsXStuff = TextBoxX + ControlsXStuffOffset;\n","\nimport Color from '../color/color.vue';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { NameboxTextStyle } from '@/constants/textBox';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Color },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata: () => ({\n\t\tcolorSelector: '' as '' | 'text' | 'outline',\n\t\tselectedFont: '',\n\t\tselectedColor: '#000000',\n\t\trememberedStart: 0,\n\t\trememberedEnd: 0,\n\t\terror: '',\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\twatch: {\n\t\tselectedFont() {\n\t\t\tif (this.selectedFont === '') return;\n\t\t\tthis.insertCommand('font', this.selectedFont);\n\t\t\tthis.selectedFont = '';\n\t\t},\n\t},\n\tmethods: {\n\t\tonValueChanged() {\n\t\t\tconst val = (this.$refs.textArea as HTMLTextAreaElement).value;\n\t\t\ttry {\n\t\t\t\t// tslint:disable-next-line: no-unused-expression\n\t\t\t\tnew TextRenderer(val, NameboxTextStyle);\n\t\t\t\tthis.error = '';\n\t\t\t} catch (e) {\n\t\t\t\tthis.error = (e as Error).message;\n\t\t\t}\n\t\t\tthis.$emit('update:modelValue', val);\n\t\t},\n\t\tselectColor(colorSelector: '' | 'text' | 'outline') {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tthis.colorSelector = colorSelector;\n\t\t\tthis.rememberedStart = el.selectionStart;\n\t\t\tthis.rememberedEnd = el.selectionEnd;\n\t\t},\n\t\tapplyColor() {\n\t\t\tconst color = this.selectedColor;\n\t\t\tconst colorSelector = this.colorSelector;\n\t\t\tconst apply = () => {\n\t\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\t\tif (!el) {\n\t\t\t\t\tthis.$nextTick(apply);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tel.selectionStart = this.rememberedStart;\n\t\t\t\tel.selectionEnd = this.rememberedEnd;\n\t\t\t\tthis.insertCommand(\n\t\t\t\t\tcolorSelector === 'text' ? 'color' : 'outlinecolor',\n\t\t\t\t\tcolor\n\t\t\t\t);\n\t\t\t};\n\t\t\tthis.$nextTick(apply);\n\t\t\tthis.selectedColor = '#000000';\n\t\t\tthis.colorSelector = '';\n\t\t},\n\t\tinsertText(text: string) {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tconst val = el.value;\n\t\t\tconst selStart = el.selectionStart;\n\t\t\tconst selEnd = el.selectionEnd;\n\t\t\tel.value = val.slice(0, selStart) + text + val.slice(selEnd);\n\t\t\tel.selectionStart = el.selectionEnd = selStart + text.length;\n\t\t\tel.focus();\n\t\t\tthis.onValueChanged();\n\t\t},\n\t\tinsertCommand(command: string, arg?: any) {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tconst val = el.value;\n\t\t\tconst selStart = el.selectionStart;\n\t\t\tconst selEnd = el.selectionEnd;\n\t\t\tconst selectedText = val.slice(selStart, selEnd);\n\t\t\tconst before = val.slice(0, selStart);\n\t\t\tconst after = val.slice(selEnd);\n\t\t\tlet commandOpen = command;\n\t\t\tif (arg) {\n\t\t\t\tcommandOpen += '=' + arg;\n\t\t\t}\n\t\t\tel.value = `${before}{${commandOpen}}${selectedText}{/${command}}${after}`;\n\t\t\tel.selectionStart = selStart + commandOpen.length + 2;\n\t\t\tel.selectionEnd = el.selectionStart + selectedText.length;\n\t\t\tel.focus();\n\t\t\tthis.onValueChanged();\n\t\t},\n\t},\n});\n","import { render } from \"./text.vue?vue&type=template&id=7ba8b720&scoped=true&bindings={}\"\nimport script from \"./text.vue?vue&type=script&lang=ts\"\nexport * from \"./text.vue?vue&type=script&lang=ts\"\n\nimport \"./text.vue?vue&type=style&index=0&id=7ba8b720&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-7ba8b720\"\n\nexport default script","\nimport {\n\tITextBox,\n\tISetTextBoxCustomColorMutation,\n\tISetTextBoxCustomControlsColorMutation,\n\tISetTextBoxNameboxColorMutation,\n\tISetTextBoxNameboxStrokeMutation,\n\tISplitTextbox,\n\tIResetTextboxBounds,\n} from '@/store/objectTypes/textbox';\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport Color from '../subtools/color/color.vue';\nimport TextEditor from '../subtools/text/text.vue';\nimport { defineComponent } from 'vue';\nimport { exhaust } from '@/util/exhaust';\nimport { PanelMixin } from './panelMixin';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<ITextBox>();\n\nexport default defineComponent({\n\tcomponents: {\n\t\tToggle,\n\t\tDFieldset,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tColor,\n\t\tTextEditor,\n\t\tImageOptions,\n\t},\n\tmixins: [PanelMixin],\n\tdata: () => ({\n\t\ttextEditor: '' as '' | 'name' | 'body',\n\t\tcolorSelect: '' as '' | 'base' | 'controls' | 'namebox' | 'nameboxStroke',\n\t\timageOptionsOpen: false,\n\t}),\n\tcomputed: {\n\t\tobject(): ITextBox {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'textBox') return undefined!;\n\t\t\treturn obj as ITextBox;\n\t\t},\n\t\ttextEditorText: {\n\t\t\tget(): string {\n\t\t\t\tif (this.textEditor === 'name') return this.object.talkingOther;\n\t\t\t\tif (this.textEditor === 'body') return this.dialog;\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tset(value: string) {\n\t\t\t\tif (this.textEditor === 'name') this.talkingOther = value;\n\t\t\t\telse if (this.textEditor === 'body') this.dialog = value;\n\t\t\t},\n\t\t},\n\t\ttalkingDefaults: setable('talkingDefault', 'objects/setTalkingDefault'),\n\t\ttalkingOther: setable('talkingOther', 'objects/setTalkingOther'),\n\t\tshowControls: setable('controls', 'objects/setControlsVisible'),\n\t\tallowSkipping: setable('skip', 'objects/setSkipable'),\n\t\tautoQuoting: setable('autoQuoting', 'objects/setAutoQuoting'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\tshowContinueArrow: setable('continue', 'objects/setContinueArrow'),\n\t\tdialog: setable('text', 'objects/setText'),\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\ttextBoxStyle: setable('style', 'objects/setStyle'),\n\t\tderiveCustomColors: setable(\n\t\t\t'deriveCustomColors',\n\t\t\t'objects/setDeriveCustomColors'\n\t\t),\n\t\tcustomNameboxWidth: setable(\n\t\t\t'customNameboxWidth',\n\t\t\t'objects/setNameboxWidth'\n\t\t),\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\tswitch (this.colorSelect) {\n\t\t\t\t\tcase '':\n\t\t\t\t\t\treturn '#000000';\n\t\t\t\t\tcase 'base':\n\t\t\t\t\t\treturn this.object.customColor;\n\t\t\t\t\tcase 'controls':\n\t\t\t\t\t\treturn this.object.customControlsColor;\n\t\t\t\t\tcase 'namebox':\n\t\t\t\t\t\treturn this.object.customNameboxColor;\n\t\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\t\treturn this.object.customNameboxStroke;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\texhaust(this.colorSelect);\n\t\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tswitch (this.colorSelect) {\n\t\t\t\t\t\tcase '':\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tcase 'base':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setCustomColor', {\n\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\t} as ISetTextBoxCustomColorMutation);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tcase 'controls':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setControlsColor', {\n\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\tcustomControlsColor: color,\n\t\t\t\t\t\t\t} as ISetTextBoxCustomControlsColorMutation);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tcase 'namebox':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setNameboxColor', {\n\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\tcustomNameboxColor: color,\n\t\t\t\t\t\t\t} as ISetTextBoxNameboxColorMutation);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setNameboxStroke', {\n\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\tcustomNameboxStroke: color,\n\t\t\t\t\t\t\t} as ISetTextBoxNameboxStrokeMutation);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ttextEditorName(): string {\n\t\t\tif (this.textEditor === 'name') return 'Name';\n\t\t\tif (this.textEditor === 'body') return 'Dialog';\n\t\t\treturn '';\n\t\t},\n\t\tcustomControlsColor(): string {\n\t\t\treturn this.object.customControlsColor;\n\t\t},\n\t\tcolorName(): string {\n\t\t\tswitch (this.colorSelect) {\n\t\t\t\tcase '':\n\t\t\t\t\treturn '';\n\t\t\t\tcase 'base':\n\t\t\t\t\treturn 'Base color';\n\t\t\t\tcase 'controls':\n\t\t\t\t\treturn 'Controls color';\n\t\t\t\tcase 'namebox':\n\t\t\t\t\treturn 'Namebox color';\n\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\treturn 'Namebox text stroke';\n\t\t\t\tdefault:\n\t\t\t\t\texhaust(this.colorSelect);\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\tsplitTextbox(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/splitTextbox', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as ISplitTextbox);\n\t\t\t});\n\t\t},\n\t\tresetPosition(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/resetTextboxBounds', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as IResetTextboxBounds);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./textbox.vue?vue&type=template&id=6a66463a&scoped=true&bindings={}\"\nimport script from \"./textbox.vue?vue&type=script&lang=ts\"\nexport * from \"./textbox.vue?vue&type=script&lang=ts\"\n\nimport \"./textbox.vue?vue&type=style&index=0&id=6a66463a&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-6a66463a\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>Choice</h1>\n\t\t<text-editor\n\t\t\tv-if=\"textEditor\"\n\t\t\ttitle=\"Button Text\"\n\t\t\tv-model=\"button_text\"\n\t\t\t@leave=\"textEditor = false\"\n\t\t/>\n\t\t<image-options\n\t\t\tv-else-if=\"imageOptionsOpen\"\n\t\t\ttype=\"object\"\n\t\t\ttitle=\"Choice\"\n\t\t\t:id=\"object.id\"\n\t\t\t@leave=\"imageOptionsOpen = false\"\n\t\t/>\n\t\t<template v-else>\n\t\t\t<d-fieldset class=\"buttons\" title=\"Buttons:\">\n\t\t\t\t<d-flow maxSize=\"100%\" direction=\"vertical\" noWraping>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for=\"(button, btnIdx) in buttons\"\n\t\t\t\t\t\t:class=\"{ choiceBtn: true, active: btnIdx === currentIdx }\"\n\t\t\t\t\t\t:key=\"btnIdx\"\n\t\t\t\t\t\t@click=\"select(btnIdx)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ button.text.trim() === '' ? '[Empty]' : button.text }}\n\t\t\t\t\t</div>\n\t\t\t\t</d-flow>\n\t\t\t</d-fieldset>\n\t\t\t<d-fieldset class=\"current_button\" title=\"Current button:\">\n\t\t\t\t<table>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t\t<label for=\"choice-button-input\">Text</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"choice-button-input\"\n\t\t\t\t\t\t\t\tv-model=\"button_text\"\n\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<button @click=\"textEditor = true\">...</button>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t</d-fieldset>\n\t\t\t<button @click=\"addChoice\">Add</button>\n\t\t\t<button @click=\"removeChoice\">Remove</button>\n\t\t\t<toggle label=\"Auto line wrap?\" v-model=\"autoWrap\" />\n\t\t\t<position-and-size :obj=\"object\" />\n\t\t\t<layers :object=\"object\" />\n\t\t\t<toggle v-model=\"flip\" label=\"Flip?\" />\n\t\t\t<button @click=\"imageOptionsOpen = true\">Image options</button>\n\t\t\t<delete :obj=\"object\" />\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IChoices, IRemoveChoiceAction } from '@/store/objectTypes/choices';\nimport { IChoice, IAddChoiceAction } from '@/store/objectTypes/choices';\nimport { DeepReadonly } from '@/util/readonly';\nimport TextEditor from '../subtools/text/text.vue';\nimport { ComponentCustomProperties, defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<IChoices>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tDFieldset,\n\t\tDFlow,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tTextEditor,\n\t\tImageOptions,\n\t},\n\tdata: () => ({\n\t\timageOptionsOpen: false,\n\t\tcurrentIdx: 0,\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): IChoices {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'choice') return undefined!;\n\t\t\treturn obj as IChoices;\n\t\t},\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\t// eslint-disable-next-line @typescript-eslint/camelcase\n\t\tbutton_text: simpleButtonSettable('text', 'objects/setChoiceText', true),\n\t\tbuttons(): DeepReadonly<IChoice[]> {\n\t\t\treturn this.object.choices;\n\t\t},\n\t},\n\tmethods: {\n\t\tselect(idx: number): void {\n\t\t\tthis.currentIdx = idx;\n\t\t},\n\t\taddChoice(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/addChoice', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\ttext: '',\n\t\t\t\t} as IAddChoiceAction);\n\t\t\t});\n\t\t},\n\t\tremoveChoice(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tif (\n\t\t\t\t\tthis.currentIdx === this.object.choices.length - 1 &&\n\t\t\t\t\tthis.currentIdx > 0\n\t\t\t\t) {\n\t\t\t\t\tthis.select(this.currentIdx - 1);\n\t\t\t\t}\n\t\t\t\tthis.$store.dispatch('objects/removeChoice', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tchoiceIdx: this.currentIdx,\n\t\t\t\t} as IRemoveChoiceAction);\n\t\t\t});\n\t\t},\n\t},\n});\n\nfunction simpleButtonSettable<K extends keyof IChoice>(\n\tkey: K,\n\tmessage: string,\n\taction = false\n) {\n\treturn {\n\t\tget(this: IThis): IChoice[K] {\n\t\t\treturn this.object.choices[this.currentIdx][key];\n\t\t},\n\t\tset(this: IThis, val: IChoice[K]): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store[action ? 'dispatch' : 'commit'](message, {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tchoiceIdx: this.currentIdx,\n\t\t\t\t\t[key]: val,\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t};\n}\n\ninterface IThis extends ComponentCustomProperties {\n\tobject: IChoices;\n\tcurrentIdx: number;\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.choiceBtn {\n\toverflow: hidden;\n\twidth: 100%;\n\theight: 24px;\n\ttext-overflow: ellipsis;\n\tpadding: 2px;\n\n\t&.active {\n\t\tbackground-color: #ffbde1;\n\t}\n}\n\n.current_button {\n\tinput {\n\t\twidth: 130px;\n\t}\n}\n\n.panel.vertical {\n\t.buttons {\n\t\tmax-height: 200px;\n\t\twidth: 100%;\n\n\t\t> .list {\n\t\t\twidth: 172px;\n\n\t\t\t* {\n\t\t\t\twidth: 100%;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\tpadding: 2px;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.panel:not(.vertical) {\n\t.buttons {\n\t\t@include height-100();\n\t\twidth: 161px;\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IChoices, IRemoveChoiceAction } from '@/store/objectTypes/choices';\nimport { IChoice, IAddChoiceAction } from '@/store/objectTypes/choices';\nimport { DeepReadonly } from '@/util/readonly';\nimport TextEditor from '../subtools/text/text.vue';\nimport { ComponentCustomProperties, defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<IChoices>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tDFieldset,\n\t\tDFlow,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tTextEditor,\n\t\tImageOptions,\n\t},\n\tdata: () => ({\n\t\timageOptionsOpen: false,\n\t\tcurrentIdx: 0,\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): IChoices {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'choice') return undefined!;\n\t\t\treturn obj as IChoices;\n\t\t},\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\t// eslint-disable-next-line @typescript-eslint/camelcase\n\t\tbutton_text: simpleButtonSettable('text', 'objects/setChoiceText', true),\n\t\tbuttons(): DeepReadonly<IChoice[]> {\n\t\t\treturn this.object.choices;\n\t\t},\n\t},\n\tmethods: {\n\t\tselect(idx: number): void {\n\t\t\tthis.currentIdx = idx;\n\t\t},\n\t\taddChoice(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/addChoice', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\ttext: '',\n\t\t\t\t} as IAddChoiceAction);\n\t\t\t});\n\t\t},\n\t\tremoveChoice(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tif (\n\t\t\t\t\tthis.currentIdx === this.object.choices.length - 1 &&\n\t\t\t\t\tthis.currentIdx > 0\n\t\t\t\t) {\n\t\t\t\t\tthis.select(this.currentIdx - 1);\n\t\t\t\t}\n\t\t\t\tthis.$store.dispatch('objects/removeChoice', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tchoiceIdx: this.currentIdx,\n\t\t\t\t} as IRemoveChoiceAction);\n\t\t\t});\n\t\t},\n\t},\n});\n\nfunction simpleButtonSettable<K extends keyof IChoice>(\n\tkey: K,\n\tmessage: string,\n\taction = false\n) {\n\treturn {\n\t\tget(this: IThis): IChoice[K] {\n\t\t\treturn this.object.choices[this.currentIdx][key];\n\t\t},\n\t\tset(this: IThis, val: IChoice[K]): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store[action ? 'dispatch' : 'commit'](message, {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tchoiceIdx: this.currentIdx,\n\t\t\t\t\t[key]: val,\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t};\n}\n\ninterface IThis extends ComponentCustomProperties {\n\tobject: IChoices;\n\tcurrentIdx: number;\n}\n","import { render } from \"./choice.vue?vue&type=template&id=6dc05483&scoped=true&bindings={}\"\nimport script from \"./choice.vue?vue&type=script&lang=ts\"\nexport * from \"./choice.vue?vue&type=script&lang=ts\"\n\nimport \"./choice.vue?vue&type=style&index=0&id=6dc05483&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-6dc05483\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>Help and Credits</h1>\n\t\t<a\n\t\t\tclass=\"btn\"\n\t\t\ttarget=\"_blank\"\n\t\t\trel=\"noopener noreferrer\"\n\t\t\thref=\"https://github.com/edave64/Doki-Doki-Dialog-Generator/wiki/Version-2:-Dokumentation\"\n\t\t\t>Help</a\n\t\t>\n\t\t<a\n\t\t\tclass=\"btn\"\n\t\t\ttarget=\"_blank\"\n\t\t\trel=\"noopener noreferrer\"\n\t\t\thref=\"https://github.com/edave64/Doki-Doki-Dialog-Generator/\"\n\t\t\t>Fork me on GitHub</a\n\t\t>\n\t\t<p>\n\t\t\tAll assets used are IP of Team Salvato and created by them, unless noted\n\t\t\totherwise.\n\t\t</p>\n\t\t<p>\n\t\t\tDoki Doki Dialog Generator developed by EDave64\n\t\t\t<br />Based on gemdude46's DDLC Shitpost generator\n\t\t</p>\n\t\t<p>\n\t\t\tUnused House Background by\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://www.deviantart.com/fatelogic/art/VN-Background-Practice-295671161\"\n\t\t\t\t>Fatelogic</a\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tAller Font by\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://www.daltonmaag.com/library/aller\"\n\t\t\t\t>Dalton Maag Ltd</a\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tRiffic Bold Font by\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://www.fontspring.com/fonts/inky-type/riffic\"\n\t\t\t\t>InkyType</a\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tVerily Serif Mono Font by\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://www.dafont.com/verily-serif-mono.font\"\n\t\t\t\t>Stephen G. Hartke</a\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tF25 Bank Printer Font by\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://www.dafont.com/f25-bank-printer.font\"\n\t\t\t\t>F25 Digital Typeface Design</a\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tJournal Font by\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://www.dafont.com/journal.font\"\n\t\t\t\t>Fontourist</a\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tHashtag Font by\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://www.dafont.com/hashtag.font\"\n\t\t\t>\n\t\t\t\tTitanVex</a\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tJP Hand Slanted Font by\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://www.dafont.com/jp-hand-slanted.font\"\n\t\t\t\t>Jonathan Paterson</a\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tAs I Lay Dying Font by\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://www.dafont.com/as-i-lay-dying.font\"\n\t\t\t\t>Moises Esqueda</a\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tDamagrafik Script Font by\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://www.dafont.com/damagrafik-script.font\"\n\t\t\t\t>Davide Terenzi</a\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tAmmy's Handwriting Font by\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://www.dafont.com/ammys-handwriting.font\"\n\t\t\t\t>Ammy K.</a\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tHalogen Font by\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://www.dafont.com/halogen.font\"\n\t\t\t\t>JLH Fonts</a\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tMC Classic Sprite by Childish-N\n\t\t\t<br />MC Classic Chibi by GyleToTheRescue\n\t\t</p>\n\t\t<p>\n\t\t\tMC Sprite by Childish-N\n\t\t\t<br />MC Casual Sprite by SlightlySimple <br />MC Chibi by SlightlySimple\n\t\t</p>\n\t\t<p>\n\t\t\tMC Chad Sprite by Cylent-Nite\n\t\t\t<br />MC Chad Poses and expressions by SlightlySimple <br />MC Chad Poses\n\t\t\tand chibi by Meddy-sin\n\t\t</p>\n\t\t<p>\n\t\t\tFeMC Sprite by Meddy-sin\n\t\t\t<br />FeMC Casual Sprite by SlightlySimple\n\t\t</p>\n\t\t<p>Classic Amy Sprite by Meddy-sin</p>\n\t\t<p>Amy Sprite by Meddy-sin and SlightlySimple</p>\n\t\t<p>Special thanks to SlightlySimple for testing and technical help</p>\n\t\t<p>\n\t\t\tAtlas421, T-Rex Harris, smearglexd and Tactical Cupcakes for suggestions\n\t\t\tand testing\n\t\t</p>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { PanelMixin } from './panelMixin';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n});\n</script>\n\n<style lang=\"scss\" scoped>\np {\n\tmargin: 4px;\n\tmax-width: 256px;\n}\n</style>\n","\nimport { PanelMixin } from './panelMixin';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n});\n","import { render } from \"./credits.vue?vue&type=template&id=8abb847e&scoped=true&bindings={}\"\nimport script from \"./credits.vue?vue&type=script&lang=ts\"\nexport * from \"./credits.vue?vue&type=script&lang=ts\"\n\nimport \"./credits.vue?vue&type=style&index=0&id=8abb847e&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-8abb847e\"\n\nexport default script","<template>\n\t<div class=\"panel\" @dragenter=\"dragEnter\" @mouseleave=\"$refs.dt.hide()\">\n\t\t<drop-target ref=\"dt\" class=\"drop-target\" @drop=\"addImageFile\"\n\t\t\t>Drop here to add as a new background</drop-target\n\t\t>\n\t\t<h1>Background</h1>\n\t\t<color v-if=\"colorSelect\" v-model=\"bgColor\" @leave=\"colorSelect = false\" />\n\t\t<template v-else>\n\t\t\t<background-settings @change-color=\"colorSelect = true\" />\n\n\t\t\t<div class=\"btn upload-background\" @click=\"$refs.upload.click()\">\n\t\t\t\tUpload\n\t\t\t\t<input type=\"file\" ref=\"upload\" @change=\"onFileUpload\" />\n\t\t\t</div>\n\t\t\t<button class=\"upload-background\" @click=\"addByUrl\">Add by URL</button>\n\t\t\t<button\n\t\t\t\tclass=\"upload-background\"\n\t\t\t\ttitle=\"Not yet implemented\"\n\t\t\t\t@click=\"$emit('show-dialog', 'type: Backgrounds')\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\">extension</i> Search in content packs\n\t\t\t</button>\n\t\t\t<background-button\n\t\t\t\tv-for=\"background of backgrounds\"\n\t\t\t\t:key=\"background\"\n\t\t\t\t:backgroundId=\"background\"\n\t\t\t\t@input=\"setBackground(background)\"\n\t\t\t/>\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport BackgroundButton from './background/button.vue';\nimport BackgroundSettings from './background/settings.vue';\nimport DropTarget from '../drop-target.vue';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport {\n\tBackground,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { ISetCurrentMutation, ISetColorMutation } from '@/store/panels';\nimport { PanelMixin } from './panelMixin';\nimport Color from '../subtools/color/color.vue';\nimport { defineComponent } from 'vue';\n\nconst uploadedBackgroundsPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.uploadedBackgrounds',\n\tdependencies: [],\n\tpackCredits: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tBackgroundButton,\n\t\tBackgroundSettings,\n\t\tDropTarget,\n\t\tColor,\n\t},\n\tdata: () => ({\n\t\tcolorSelect: false,\n\t}),\n\tcomputed: {\n\t\tbgColor: {\n\t\t\tget(): string {\n\t\t\t\treturn this.$store.state.panels.panels[\n\t\t\t\t\tthis.$store.state.panels.currentPanel\n\t\t\t\t].background.color;\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundColor', {\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetColorMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tbackgrounds(): Array<Background<IAsset>['id']> {\n\t\t\treturn [\n\t\t\t\t...this.$store.state.content.current.backgrounds.map(\n\t\t\t\t\tbackground => background.id\n\t\t\t\t),\n\t\t\t\t'buildin.static-color',\n\t\t\t\t'buildin.transparent',\n\t\t\t];\n\t\t},\n\t},\n\tmethods: {\n\t\tsetBackground(id: Background<IAsset>['id']) {\n\t\t\tthis.$store.commit('panels/setCurrentBackground', {\n\t\t\t\tcurrent: id,\n\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t} as ISetCurrentMutation);\n\t\t},\n\t\tonFileUpload(e: Event) {\n\t\t\tconst uploadInput = this.$refs.upload as HTMLInputElement;\n\t\t\tif (!uploadInput.files) return;\n\t\t\tfor (const file of uploadInput.files) {\n\t\t\t\tthis.addImageFile(file);\n\t\t\t}\n\t\t},\n\t\taddImageFile(file: File) {\n\t\t\tconst url = URL.createObjectURL(file);\n\t\t\tthis.addNewCustomBackground(file.name, file.name, url);\n\t\t},\n\t\taddByUrl() {\n\t\t\tconst url = prompt('Enter the URL of the image');\n\t\t\tif (!url) return;\n\t\t\tconst lastSegment = url.split('/').slice(-1)[0];\n\t\t\tthis.addNewCustomBackground(lastSegment, lastSegment, url);\n\t\t},\n\t\taddNewCustomBackground(\n\t\t\tid: Background<IAsset>['id'],\n\t\t\tlabel: string,\n\t\t\turl: string\n\t\t) {\n\t\t\tuploadedBackgroundsPack.backgrounds.push({\n\t\t\t\tid,\n\t\t\t\tlabel,\n\t\t\t\tvariants: [[url]],\n\t\t\t});\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: uploadedBackgroundsPack,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t\tthis.setBackground(id);\n\t\t\t});\n\t\t},\n\t\tdragEnter(e: DragEvent) {\n\t\t\tif (!e.dataTransfer) return;\n\t\t\te.dataTransfer.effectAllowed = 'none';\n\t\t\tif (\n\t\t\t\t!Array.from(e.dataTransfer.items).find(item =>\n\t\t\t\t\titem.type.match(/^image.*$/)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.dataTransfer.effectAllowed = 'link';\n\t\t\t(this.$refs.dt as any).show();\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\ntextarea {\n\tflex-grow: 1;\n}\n\n.upload-background {\n\tmargin-top: 4px;\n\tbackground-size: cover;\n\ttext-shadow: 0 0 2px white;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tbox-shadow: inset 0 0 1px 3px rgba(0, 0, 0, 0.5);\n\theight: 48px;\n\tmin-height: 48px;\n\ttext-align: center;\n\tuser-select: none;\n\ttext-align: center;\n\tuser-select: none;\n\n\tinput {\n\t\tdisplay: none;\n\t}\n}\n\n#panels:not(.vertical) > .panel {\n\t> div,\n\tbutton {\n\t\t&:not(.drop-target) {\n\t\t\twidth: 12rem;\n\t\t}\n\t}\n}\n\n.vertical {\n\tfieldset {\n\t\tinput {\n\t\t\twidth: 60px;\n\t\t}\n\t}\n}\n</style>\n","<template>\n\t<div\n\t\t:class=\"{ background: true, active: isActive }\"\n\t\t:title=\"title\"\n\t\t:style=\"style\"\n\t\t@click=\"$emit('input', backgroundId)\"\n\t>\n\t\t{{ title }}\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { getAAsset } from '@/asset-manager';\nimport { Background } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, BackgroundLookup } from '@/store/content';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { IPanel } from '@/store/panels';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport default defineComponent({\n\tprops: {\n\t\tbackgroundId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\tassets: [] as Array<HTMLImageElement | ErrorAsset>,\n\t}),\n\tcomputed: {\n\t\tbackground(): DeepReadonly<IPanel['background']> {\n\t\t\tconst currentPanel = this.$store.state.panels.currentPanel;\n\t\t\treturn this.$store.state.panels.panels[currentPanel].background;\n\t\t},\n\n\t\tbgData(): Background<IAsset> | null {\n\t\t\tconst backgrounds: BackgroundLookup = this.$store.getters[\n\t\t\t\t'content/getBackgrounds'\n\t\t\t];\n\t\t\treturn backgrounds.get(this.backgroundId) || null;\n\t\t},\n\n\t\tisActive(): boolean {\n\t\t\treturn this.backgroundId === this.background.current;\n\t\t},\n\n\t\ttitle(): string {\n\t\t\tswitch (this.backgroundId) {\n\t\t\t\tcase 'buildin.static-color':\n\t\t\t\t\treturn 'Static color';\n\t\t\t\tcase 'buildin.transparent':\n\t\t\t\t\treturn 'Transparent';\n\t\t\t}\n\t\t\treturn this.bgData!.label || '';\n\t\t},\n\n\t\tstyle(): { [id: string]: string } {\n\t\t\tswitch (this.backgroundId) {\n\t\t\t\tcase 'buildin.static-color':\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'background-color': this.background.color,\n\t\t\t\t\t};\n\t\t\t\tcase 'buildin.transparent':\n\t\t\t\t\treturn {};\n\t\t\t}\n\t\t\tconst urls = (this.assets.filter(\n\t\t\t\timg => img instanceof HTMLImageElement\n\t\t\t) as HTMLImageElement[])\n\t\t\t\t.map(img => `url('${img.src}')`)\n\t\t\t\t.join(',');\n\t\t\treturn {\n\t\t\t\tbackgroundImage: urls,\n\t\t\t};\n\t\t},\n\t},\n\tasync created() {\n\t\tif (this.bgData) {\n\t\t\tthis.assets = await Promise.all(\n\t\t\t\tthis.bgData.variants[0].map(asset => getAAsset(asset, false))\n\t\t\t);\n\t\t}\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.background {\n\tmargin-top: 4px;\n\tbackground-size: cover;\n\ttext-shadow: 0 0 4px #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000,\n\t\t1px 1px 0 #000;\n\tcolor: white;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tbox-shadow: inset 0 0 1px 3px rgba(0, 0, 0, 0.5);\n\theight: 48px;\n\tmin-height: 48px;\n\ttext-align: center;\n\tuser-select: none;\n\n\t&.active {\n\t\tbox-shadow: inset 0 0 1px 3px rgba(255, 255, 255, 0.5);\n\t}\n}\n</style>\n","\nimport { getAAsset } from '@/asset-manager';\nimport { Background } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, BackgroundLookup } from '@/store/content';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { IPanel } from '@/store/panels';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport default defineComponent({\n\tprops: {\n\t\tbackgroundId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\tassets: [] as Array<HTMLImageElement | ErrorAsset>,\n\t}),\n\tcomputed: {\n\t\tbackground(): DeepReadonly<IPanel['background']> {\n\t\t\tconst currentPanel = this.$store.state.panels.currentPanel;\n\t\t\treturn this.$store.state.panels.panels[currentPanel].background;\n\t\t},\n\n\t\tbgData(): Background<IAsset> | null {\n\t\t\tconst backgrounds: BackgroundLookup = this.$store.getters[\n\t\t\t\t'content/getBackgrounds'\n\t\t\t];\n\t\t\treturn backgrounds.get(this.backgroundId) || null;\n\t\t},\n\n\t\tisActive(): boolean {\n\t\t\treturn this.backgroundId === this.background.current;\n\t\t},\n\n\t\ttitle(): string {\n\t\t\tswitch (this.backgroundId) {\n\t\t\t\tcase 'buildin.static-color':\n\t\t\t\t\treturn 'Static color';\n\t\t\t\tcase 'buildin.transparent':\n\t\t\t\t\treturn 'Transparent';\n\t\t\t}\n\t\t\treturn this.bgData!.label || '';\n\t\t},\n\n\t\tstyle(): { [id: string]: string } {\n\t\t\tswitch (this.backgroundId) {\n\t\t\t\tcase 'buildin.static-color':\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'background-color': this.background.color,\n\t\t\t\t\t};\n\t\t\t\tcase 'buildin.transparent':\n\t\t\t\t\treturn {};\n\t\t\t}\n\t\t\tconst urls = (this.assets.filter(\n\t\t\t\timg => img instanceof HTMLImageElement\n\t\t\t) as HTMLImageElement[])\n\t\t\t\t.map(img => `url('${img.src}')`)\n\t\t\t\t.join(',');\n\t\t\treturn {\n\t\t\t\tbackgroundImage: urls,\n\t\t\t};\n\t\t},\n\t},\n\tasync created() {\n\t\tif (this.bgData) {\n\t\t\tthis.assets = await Promise.all(\n\t\t\t\tthis.bgData.variants[0].map(asset => getAAsset(asset, false))\n\t\t\t);\n\t\t}\n\t},\n});\n","import { render } from \"./button.vue?vue&type=template&id=1cae163a&scoped=true&bindings={}\"\nimport script from \"./button.vue?vue&type=script&lang=ts\"\nexport * from \"./button.vue?vue&type=script&lang=ts\"\n\nimport \"./button.vue?vue&type=style&index=0&id=1cae163a&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-1cae163a\"\n\nexport default script","<template>\n\t<d-fieldset class=\"bg-settings\" title=\"Settings:\">\n\t\t<template v-if=\"isColor\">\n\t\t\t<label for=\"bg_color\">Color:</label>\n\t\t\t<button\n\t\t\t\tid=\"bg_color\"\n\t\t\t\tclass=\"color-button\"\n\t\t\t\t:style=\"{ background: color }\"\n\t\t\t\t@click=\"$emit('change-color')\"\n\t\t\t/>\n\t\t</template>\n\t\t<table v-if=\"isVariant\">\n\t\t\t<tr>\n\t\t\t\t<td colspan=\"3\">\n\t\t\t\t\t<toggle v-model=\"flipped\" label=\"Flipped?\" />\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr v-if=\"hasVariants\">\n\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t<button @click=\"seekVariant(-1)\">&lt;</button>\n\t\t\t\t</td>\n\t\t\t\t<td style=\"text-align:center\">Variant</td>\n\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t<button @click=\"seekVariant(1)\">&gt;</button>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td colspan=\"3\">\n\t\t\t\t\t<select v-model=\"scaling\" @keydown.stop>\n\t\t\t\t\t\t<option value=\"0\">None</option>\n\t\t\t\t\t\t<option value=\"1\">Stretch</option>\n\t\t\t\t\t\t<option value=\"2\">Cover</option>\n\t\t\t\t\t</select>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</d-fieldset>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { Background } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport {\n\tISetColorMutation,\n\tISetFlipMutation,\n\tISeekVariantAction,\n\tISetScalingMutation,\n\tIPanel,\n} from '@/store/panels';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tcomputed: {\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\treturn this.background.color;\n\t\t\t},\n\t\t\tset(color: string): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundColor', {\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetColorMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tflipped: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.background.flipped;\n\t\t\t},\n\t\t\tset(flipped: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundFlipped', {\n\t\t\t\t\t\tflipped,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetFlipMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tscaling: {\n\t\t\tget(): string {\n\t\t\t\treturn this.background.scaling.toString();\n\t\t\t},\n\n\t\t\tset(scaling: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundScaling', {\n\t\t\t\t\t\tscaling: parseInt(scaling, 10),\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetScalingMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tcurrentBackgroundId(): string {\n\t\t\treturn this.background.current;\n\t\t},\n\t\tbackground(): DeepReadonly<IPanel['background']> {\n\t\t\tconst currentPanel = this.$store.state.panels.currentPanel;\n\t\t\treturn this.$store.state.panels.panels[currentPanel].background;\n\t\t},\n\t\tbgData(): DeepReadonly<Background<IAsset>> | null {\n\t\t\treturn (\n\t\t\t\tthis.$store.state.content.current.backgrounds.find(\n\t\t\t\t\tbackground => background.id === this.currentBackgroundId\n\t\t\t\t) || null\n\t\t\t);\n\t\t},\n\t\tisColor(): boolean {\n\t\t\treturn this.currentBackgroundId === 'buildin.static-color';\n\t\t},\n\t\tisVariant(): boolean {\n\t\t\treturn !!this.bgData;\n\t\t},\n\t\thasVariants(): boolean {\n\t\t\treturn this.bgData ? this.bgData.variants.length > 1 : false;\n\t\t},\n\t},\n\tmethods: {\n\t\tseekVariant(delta: 1 | -1) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/seekBackgroundVariant', {\n\t\t\t\t\tdelta,\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as ISeekVariantAction);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.bg-settings {\n\theight: 100%;\n}\n\nbutton {\n\twidth: 24px;\n}\n\nselect {\n\twidth: 100%;\n}\n\ntable {\n\twidth: 100%;\n}\n\n.arrow-col {\n\twidth: 24px;\n\n\tbutton {\n\t\twidth: 24px;\n\t}\n}\n\n.color-button {\n\theight: 24px;\n\twidth: 48px;\n\tvertical-align: middle;\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { Background } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport {\n\tISetColorMutation,\n\tISetFlipMutation,\n\tISeekVariantAction,\n\tISetScalingMutation,\n\tIPanel,\n} from '@/store/panels';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tcomputed: {\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\treturn this.background.color;\n\t\t\t},\n\t\t\tset(color: string): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundColor', {\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetColorMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tflipped: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.background.flipped;\n\t\t\t},\n\t\t\tset(flipped: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundFlipped', {\n\t\t\t\t\t\tflipped,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetFlipMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tscaling: {\n\t\t\tget(): string {\n\t\t\t\treturn this.background.scaling.toString();\n\t\t\t},\n\n\t\t\tset(scaling: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundScaling', {\n\t\t\t\t\t\tscaling: parseInt(scaling, 10),\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetScalingMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tcurrentBackgroundId(): string {\n\t\t\treturn this.background.current;\n\t\t},\n\t\tbackground(): DeepReadonly<IPanel['background']> {\n\t\t\tconst currentPanel = this.$store.state.panels.currentPanel;\n\t\t\treturn this.$store.state.panels.panels[currentPanel].background;\n\t\t},\n\t\tbgData(): DeepReadonly<Background<IAsset>> | null {\n\t\t\treturn (\n\t\t\t\tthis.$store.state.content.current.backgrounds.find(\n\t\t\t\t\tbackground => background.id === this.currentBackgroundId\n\t\t\t\t) || null\n\t\t\t);\n\t\t},\n\t\tisColor(): boolean {\n\t\t\treturn this.currentBackgroundId === 'buildin.static-color';\n\t\t},\n\t\tisVariant(): boolean {\n\t\t\treturn !!this.bgData;\n\t\t},\n\t\thasVariants(): boolean {\n\t\t\treturn this.bgData ? this.bgData.variants.length > 1 : false;\n\t\t},\n\t},\n\tmethods: {\n\t\tseekVariant(delta: 1 | -1) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/seekBackgroundVariant', {\n\t\t\t\t\tdelta,\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as ISeekVariantAction);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./settings.vue?vue&type=template&id=2a0abeea&scoped=true&bindings={}\"\nimport script from \"./settings.vue?vue&type=script&lang=ts\"\nexport * from \"./settings.vue?vue&type=script&lang=ts\"\n\nimport \"./settings.vue?vue&type=style&index=0&id=2a0abeea&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-2a0abeea\"\n\nexport default script","\nimport BackgroundButton from './background/button.vue';\nimport BackgroundSettings from './background/settings.vue';\nimport DropTarget from '../drop-target.vue';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport {\n\tBackground,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { ISetCurrentMutation, ISetColorMutation } from '@/store/panels';\nimport { PanelMixin } from './panelMixin';\nimport Color from '../subtools/color/color.vue';\nimport { defineComponent } from 'vue';\n\nconst uploadedBackgroundsPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.uploadedBackgrounds',\n\tdependencies: [],\n\tpackCredits: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tBackgroundButton,\n\t\tBackgroundSettings,\n\t\tDropTarget,\n\t\tColor,\n\t},\n\tdata: () => ({\n\t\tcolorSelect: false,\n\t}),\n\tcomputed: {\n\t\tbgColor: {\n\t\t\tget(): string {\n\t\t\t\treturn this.$store.state.panels.panels[\n\t\t\t\t\tthis.$store.state.panels.currentPanel\n\t\t\t\t].background.color;\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundColor', {\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetColorMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tbackgrounds(): Array<Background<IAsset>['id']> {\n\t\t\treturn [\n\t\t\t\t...this.$store.state.content.current.backgrounds.map(\n\t\t\t\t\tbackground => background.id\n\t\t\t\t),\n\t\t\t\t'buildin.static-color',\n\t\t\t\t'buildin.transparent',\n\t\t\t];\n\t\t},\n\t},\n\tmethods: {\n\t\tsetBackground(id: Background<IAsset>['id']) {\n\t\t\tthis.$store.commit('panels/setCurrentBackground', {\n\t\t\t\tcurrent: id,\n\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t} as ISetCurrentMutation);\n\t\t},\n\t\tonFileUpload(e: Event) {\n\t\t\tconst uploadInput = this.$refs.upload as HTMLInputElement;\n\t\t\tif (!uploadInput.files) return;\n\t\t\tfor (const file of uploadInput.files) {\n\t\t\t\tthis.addImageFile(file);\n\t\t\t}\n\t\t},\n\t\taddImageFile(file: File) {\n\t\t\tconst url = URL.createObjectURL(file);\n\t\t\tthis.addNewCustomBackground(file.name, file.name, url);\n\t\t},\n\t\taddByUrl() {\n\t\t\tconst url = prompt('Enter the URL of the image');\n\t\t\tif (!url) return;\n\t\t\tconst lastSegment = url.split('/').slice(-1)[0];\n\t\t\tthis.addNewCustomBackground(lastSegment, lastSegment, url);\n\t\t},\n\t\taddNewCustomBackground(\n\t\t\tid: Background<IAsset>['id'],\n\t\t\tlabel: string,\n\t\t\turl: string\n\t\t) {\n\t\t\tuploadedBackgroundsPack.backgrounds.push({\n\t\t\t\tid,\n\t\t\t\tlabel,\n\t\t\t\tvariants: [[url]],\n\t\t\t});\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: uploadedBackgroundsPack,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t\tthis.setBackground(id);\n\t\t\t});\n\t\t},\n\t\tdragEnter(e: DragEvent) {\n\t\t\tif (!e.dataTransfer) return;\n\t\t\te.dataTransfer.effectAllowed = 'none';\n\t\t\tif (\n\t\t\t\t!Array.from(e.dataTransfer.items).find(item =>\n\t\t\t\t\titem.type.match(/^image.*$/)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.dataTransfer.effectAllowed = 'link';\n\t\t\t(this.$refs.dt as any).show();\n\t\t},\n\t},\n});\n","import { render } from \"./backgrounds.vue?vue&type=template&id=43d75d36&scoped=true&bindings={}\"\nimport script from \"./backgrounds.vue?vue&type=script&lang=ts\"\nexport * from \"./backgrounds.vue?vue&type=script&lang=ts\"\n\nimport \"./backgrounds.vue?vue&type=style&index=0&id=43d75d36&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-43d75d36\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>Content Packs</h1>\n\t\t<button @click=\"addNew\">Add new Pack</button>\n\t\t<d-fieldset title=\"Installed Packs:\">\n\t\t\t<div class=\"list\">\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"pack in packs\"\n\t\t\t\t\t:class=\"{ active: pack.name === name }\"\n\t\t\t\t\t:key=\"pack.name\"\n\t\t\t\t\t@click=\"select(pack.name)\"\n\t\t\t\t>\n\t\t\t\t\t{{ pack.name }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</d-fieldset>\n\t\t<label for=\"pack_name\">Name:</label>\n\t\t<input id=\"pack_name\" :value=\"name\" readonly />\n\t\t<label for=\"pack_credits\">Credits:</label>\n\t\t<div id=\"pack_credits\" v-html=\"credits\"></div>\n\t\t<button v-if=\"activatable\" @click=\"activate\">Activate</button>\n\t\t<button v-if=\"deactivatable\" @click=\"deactivate\">Deactivate</button>\n\t\t<button v-if=\"installable\" @click=\"install\">Install</button>\n\t\t<button v-if=\"uninstallable\" @click=\"uninstall\">Uninstall</button>\n\t\t<div v-if=\"needRestart\">\n\t\t\tThe tool need restart for changes to take effect.\n\t\t\t<button @click=\"restart\">Restart Now</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { PanelMixin } from './panelMixin';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\ninterface IPack {\n\tname: string;\n\tcredits: [string | [string, string]];\n\tinstalled: boolean;\n\tqueuedUninstall: boolean;\n\tactive: boolean;\n\tfreshInstall: boolean;\n\turl: string;\n}\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DFieldset },\n\tdata: () => ({\n\t\tselectedPack: null as IPack | null,\n\t\tneedRestart: false,\n\t}),\n\tcomputed: {\n\t\tpacks(): IPack[] {\n\t\t\tconst packs = this.$store.state.content.contentPacks;\n\t\t\treturn packs\n\t\t\t\t.filter(pack => pack.packId && !pack.packId.startsWith('dddg.buildin.'))\n\t\t\t\t.map(\n\t\t\t\t\tpack =>\n\t\t\t\t\t\t({\n\t\t\t\t\t\t\tname: pack.packId,\n\t\t\t\t\t\t\tcredits: pack.packCredits,\n\t\t\t\t\t\t\tinstalled: true,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tqueuedUninstall: false,\n\t\t\t\t\t\t\tfreshInstall: false,\n\t\t\t\t\t\t\turl: '',\n\t\t\t\t\t\t} as IPack)\n\t\t\t\t);\n\t\t},\n\n\t\tname(): string {\n\t\t\tif (!this.selectedPack) return '';\n\t\t\treturn this.selectedPack.name;\n\t\t},\n\t\tcredits(): [string | [string, string]] {\n\t\t\tif (!this.selectedPack) return [''];\n\t\t\treturn this.selectedPack.credits;\n\t\t},\n\t\tactivatable(): boolean {\n\t\t\tif (!environment.isAutoLoadingSupported) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (!this.selectedPack.installed) return false;\n\t\t\tif (this.selectedPack.queuedUninstall) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn !this.selectedPack.active;\n\t\t},\n\t\tdeactivatable(): boolean {\n\t\t\tif (!environment.isAutoLoadingSupported) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (!this.selectedPack.installed) return false;\n\t\t\tif (this.selectedPack.queuedUninstall) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn this.selectedPack.active;\n\t\t},\n\t\tinstallable(): boolean {\n\t\t\tif (!environment.isLocalRepoSupported) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\treturn this.selectedPack.queuedUninstall || !this.selectedPack.installed;\n\t\t},\n\t\tuninstallable(): boolean {\n\t\t\tif (!environment.isLocalRepoSupported) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn !(\n\t\t\t\tthis.selectedPack.queuedUninstall || !this.selectedPack.installed\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tselect(name: string) {\n\t\t\tthis.selectedPack = this.packs.find(pack => pack.name === name) || null;\n\t\t},\n\t\tasync addNew() {\n\t\t\tconst url = await environment.prompt(\n\t\t\t\t'Enter the URL of the character pack:'\n\t\t\t);\n\t\t\tif (!url) return;\n\t\t\tawait this.$store.dispatch('content/loadContentPacks', url);\n\t\t},\n\t\trestart() {\n\t\t\tlocation.reload(true);\n\t\t},\n\t\tinstall(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.localRepoAdd(this.selectedPack.url);\n\t\t\tif (this.selectedPack.queuedUninstall) {\n\t\t\t\tthis.selectedPack.queuedUninstall = false;\n\t\t\t} else {\n\t\t\t\tthis.selectedPack.installed = true;\n\t\t\t}\n\t\t},\n\t\tuninstall(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.localRepoRemove(this.selectedPack.url);\n\t\t\tthis.selectedPack.queuedUninstall = true;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t\tactivate(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.autoLoadAdd(this.selectedPack.url);\n\t\t\tthis.selectedPack.active = true;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t\tdeactivate(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.autoLoadRemove(this.selectedPack.url);\n\t\t\tthis.selectedPack.active = false;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\np {\n\tmargin: 4px;\n}\n.list {\n\toverflow-y: auto;\n\toverflow-x: hidden;\n\t.active {\n\t\tbackground-color: #ffbde1;\n\t}\n}\n\n.panel.vertical {\n\tfieldset {\n\t\twidth: 100%;\n\n\t\t> .list {\n\t\t\tmax-height: 200px;\n\t\t\twidth: 172px;\n\n\t\t\t* {\n\t\t\t\twidth: 100%;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\tpadding: 2px;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.panel:not(.vertical) {\n\t.list {\n\t\tmax-height: 140px;\n\t}\n}\n</style>\n","\nimport { PanelMixin } from './panelMixin';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\ninterface IPack {\n\tname: string;\n\tcredits: [string | [string, string]];\n\tinstalled: boolean;\n\tqueuedUninstall: boolean;\n\tactive: boolean;\n\tfreshInstall: boolean;\n\turl: string;\n}\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DFieldset },\n\tdata: () => ({\n\t\tselectedPack: null as IPack | null,\n\t\tneedRestart: false,\n\t}),\n\tcomputed: {\n\t\tpacks(): IPack[] {\n\t\t\tconst packs = this.$store.state.content.contentPacks;\n\t\t\treturn packs\n\t\t\t\t.filter(pack => pack.packId && !pack.packId.startsWith('dddg.buildin.'))\n\t\t\t\t.map(\n\t\t\t\t\tpack =>\n\t\t\t\t\t\t({\n\t\t\t\t\t\t\tname: pack.packId,\n\t\t\t\t\t\t\tcredits: pack.packCredits,\n\t\t\t\t\t\t\tinstalled: true,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tqueuedUninstall: false,\n\t\t\t\t\t\t\tfreshInstall: false,\n\t\t\t\t\t\t\turl: '',\n\t\t\t\t\t\t} as IPack)\n\t\t\t\t);\n\t\t},\n\n\t\tname(): string {\n\t\t\tif (!this.selectedPack) return '';\n\t\t\treturn this.selectedPack.name;\n\t\t},\n\t\tcredits(): [string | [string, string]] {\n\t\t\tif (!this.selectedPack) return [''];\n\t\t\treturn this.selectedPack.credits;\n\t\t},\n\t\tactivatable(): boolean {\n\t\t\tif (!environment.isAutoLoadingSupported) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (!this.selectedPack.installed) return false;\n\t\t\tif (this.selectedPack.queuedUninstall) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn !this.selectedPack.active;\n\t\t},\n\t\tdeactivatable(): boolean {\n\t\t\tif (!environment.isAutoLoadingSupported) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (!this.selectedPack.installed) return false;\n\t\t\tif (this.selectedPack.queuedUninstall) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn this.selectedPack.active;\n\t\t},\n\t\tinstallable(): boolean {\n\t\t\tif (!environment.isLocalRepoSupported) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\treturn this.selectedPack.queuedUninstall || !this.selectedPack.installed;\n\t\t},\n\t\tuninstallable(): boolean {\n\t\t\tif (!environment.isLocalRepoSupported) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn !(\n\t\t\t\tthis.selectedPack.queuedUninstall || !this.selectedPack.installed\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tselect(name: string) {\n\t\t\tthis.selectedPack = this.packs.find(pack => pack.name === name) || null;\n\t\t},\n\t\tasync addNew() {\n\t\t\tconst url = await environment.prompt(\n\t\t\t\t'Enter the URL of the character pack:'\n\t\t\t);\n\t\t\tif (!url) return;\n\t\t\tawait this.$store.dispatch('content/loadContentPacks', url);\n\t\t},\n\t\trestart() {\n\t\t\tlocation.reload(true);\n\t\t},\n\t\tinstall(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.localRepoAdd(this.selectedPack.url);\n\t\t\tif (this.selectedPack.queuedUninstall) {\n\t\t\t\tthis.selectedPack.queuedUninstall = false;\n\t\t\t} else {\n\t\t\t\tthis.selectedPack.installed = true;\n\t\t\t}\n\t\t},\n\t\tuninstall(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.localRepoRemove(this.selectedPack.url);\n\t\t\tthis.selectedPack.queuedUninstall = true;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t\tactivate(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.autoLoadAdd(this.selectedPack.url);\n\t\t\tthis.selectedPack.active = true;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t\tdeactivate(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.autoLoadRemove(this.selectedPack.url);\n\t\t\tthis.selectedPack.active = false;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t},\n});\n","import { render } from \"./content-pack.vue?vue&type=template&id=68102184&scoped=true&bindings={}\"\nimport script from \"./content-pack.vue?vue&type=script&lang=ts\"\nexport * from \"./content-pack.vue?vue&type=script&lang=ts\"\n\nimport \"./content-pack.vue?vue&type=style&index=0&id=68102184&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-68102184\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>Panels</h1>\n\t\t<d-fieldset class=\"existing_panels_fieldset\" title=\"Existing Panels\">\n\t\t\t<d-flow no-wraping maxSize=\"350px\">\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"(panel, idx) of panelButtons\"\n\t\t\t\t\t:key=\"panel.id\"\n\t\t\t\t\t:class=\"{ panel_button: true, active: panel.id === currentPanel }\"\n\t\t\t\t\t:style=\"`background-image: url('${panel.image}')`\"\n\t\t\t\t\t@click=\"updateCurrentPanel(panel.id)\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"panel_text\">\n\t\t\t\t\t\t<p>{{ panel.text }}</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"panel_nr\">{{ idx + 1 }}</div>\n\t\t\t\t</div>\n\t\t\t</d-flow>\n\t\t</d-fieldset>\n\t\t<div class=\"column\">\n\t\t\t<d-button icon=\"add_to_queue\" @click=\"addNewPanel\">\n\t\t\t\tAdd new\n\t\t\t</d-button>\n\t\t\t<d-button\n\t\t\t\ticon=\"remove_from_queue\"\n\t\t\t\t@click=\"deletePanel\"\n\t\t\t\t:disabled=\"!canDeletePanel\"\n\t\t\t>\n\t\t\t\tDelete panel\n\t\t\t</d-button>\n\n\t\t\t<d-button\n\t\t\t\ticon=\"arrow_upward\"\n\t\t\t\t@click=\"moveAhead\"\n\t\t\t\t:disabled=\"!canMoveAhead\"\n\t\t\t>\n\t\t\t\tMove ahead\n\t\t\t</d-button>\n\t\t\t<d-button\n\t\t\t\ticon=\"arrow_downward\"\n\t\t\t\t@click=\"moveBehind\"\n\t\t\t\t:disabled=\"!canMoveBehind\"\n\t\t\t>\n\t\t\t\tMove behind\n\t\t\t</d-button>\n\t\t</div>\n\t\t<d-fieldset title=\"Export\">\n\t\t\t<table>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"export_format\">Format</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<select id=\"export_format\" v-model=\"format\">\n\t\t\t\t\t\t\t<option value=\"image/png\">PNG (lossless)</option>\n\t\t\t\t\t\t\t<option value=\"image/webp\" v-if=\"webpSupport\"\n\t\t\t\t\t\t\t\t>WebP (lossy)</option\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"image/heif\" v-if=\"heifSupport\"\n\t\t\t\t\t\t\t\t>HEIF (lossy)</option\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"image/jpeg\">JPEG (lossy)</option>\n\t\t\t\t\t\t\t<!-- <option value=\"image/jpeg\">WebM (lossy, video)</option>-->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr v-if=\"isLossy\">\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"export_quality\">Quality:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"export_quality\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tmax=\"100\"\n\t\t\t\t\t\t\tv-model.number=\"quality\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"export_ppi\">\n\t\t\t\t\t\t\tPanels per image:\n\t\t\t\t\t\t\t<br /><small>(0 for one single image)</small>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"export_ppi\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tv-model.number=\"ppi\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"export_pages\">\n\t\t\t\t\t\t\tPanels to export:\n\t\t\t\t\t\t\t<br /><small>(Leave empty for all)</small>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"export_pages\"\n\t\t\t\t\t\t\tv-model=\"pages\"\n\t\t\t\t\t\t\tplaceholder=\"E.g. 1-5, 8, 11-13\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<d-button icon=\"photo_camera\" @click=\"download\">\n\t\t\t\t\t\t\tDownload\n\t\t\t\t\t\t</d-button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"estimateExportSize\">Estimate filesizes</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</d-fieldset>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { PanelMixin } from './panelMixin';\nimport {\n\tIDuplicatePanelAction,\n\tISetCurrentPanelMutation,\n\tIDeletePanelAction,\n\tISetPanelPreviewMutation,\n\tIMovePanelAction,\n} from '@/store/panels';\nimport { isWebPSupported, isHeifSupported } from '@/asset-manager';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { SceneRenderer } from '@/renderables/scene-renderer';\nimport { DeepReadonly } from '@/util/readonly';\nimport environment from '@/environments/environment';\nimport eventBus, { ShowMessageEvent } from '@/eventbus/event-bus';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport { IObject } from '@/store/objects';\nimport { INotification } from '@/store/objectTypes/notification';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { IChoices } from '@/store/objectTypes/choices';\nimport { defineComponent } from 'vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DButton from '@/components/ui/d-button.vue';\n\ninterface IPanelButton {\n\tid: string;\n\timage: string;\n\ttext: string;\n}\n\n// tslint:disable: no-magic-numbers\nconst estimateFactor = 1.5;\nconst thumbnailFactor = 1 / 4;\nconst thumbnailQuality = 0.5;\nconst qualityFactor = 100;\n\nconst defaultQuality = 90;\n\nconst qualityWarningThreshold = 70;\n// tslint:enable: no-magic-numbers\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DFieldset, DFlow, DButton },\n\tdata: () => ({\n\t\twebpSupport: false,\n\t\theifSupport: false,\n\t\tppi: 0,\n\t\tpages: '',\n\t\tformat: 'image/png',\n\t\tquality: defaultQuality,\n\t}),\n\tcomputed: {\n\t\tcurrentPanel(): string {\n\t\t\treturn this.$store.state.panels.currentPanel;\n\t\t},\n\n\t\tisLossy(): boolean {\n\t\t\treturn this.format !== 'image/png';\n\t\t},\n\n\t\tcanDeletePanel(): boolean {\n\t\t\treturn this.panelButtons.length > 1;\n\t\t},\n\n\t\tpanelButtons(): IPanelButton[] {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\treturn panelOrder.map(id => {\n\t\t\t\tconst panel = this.$store.state.panels.panels[id];\n\t\t\t\tconst objectOrders = this.$store.state.objects.panels[id];\n\t\t\t\tconst txtBox = objectOrders\n\t\t\t\t\t? ([] as string[])\n\t\t\t\t\t\t\t.concat(objectOrders.order, objectOrders.onTopOrder)\n\t\t\t\t\t\t\t.map(objId => this.$store.state.objects.objects[objId])\n\t\t\t\t\t\t\t.map(this.extractObjectText)\n\t\t\t\t\t: [];\n\t\t\t\treturn {\n\t\t\t\t\tid,\n\t\t\t\t\timage: panel.lastRender,\n\t\t\t\t\ttext: txtBox.reduce(\n\t\t\t\t\t\t(acc, current) => (acc.length > current.length ? acc : current),\n\t\t\t\t\t\t''\n\t\t\t\t\t),\n\t\t\t\t} as IPanelButton;\n\t\t\t});\n\t\t},\n\n\t\tcanMoveAhead(): boolean {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\tconst idx = panelOrder.indexOf(this.currentPanel);\n\t\t\treturn idx > 0;\n\t\t},\n\n\t\tcanMoveBehind(): boolean {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\tconst idx = panelOrder.indexOf(this.currentPanel);\n\t\t\treturn idx < panelOrder.length - 1;\n\t\t},\n\t},\n\tasync created() {\n\t\t[this.webpSupport, this.heifSupport] = await Promise.all([\n\t\t\tisWebPSupported(),\n\t\t\tisHeifSupported(),\n\t\t]);\n\t},\n\tasync mounted() {\n\t\tthis.moveFocusToActivePanel();\n\n\t\tconst sceneRenderer = new SceneRenderer(\n\t\t\tthis.$store,\n\t\t\tthis.currentPanel,\n\t\t\tscreenWidth,\n\t\t\tscreenHeight\n\t\t);\n\n\t\tawait sceneRenderer.render(false, true);\n\n\t\tconst targetCanvas = document.createElement('canvas');\n\t\ttargetCanvas.width = screenWidth * thumbnailFactor;\n\t\ttargetCanvas.height = screenHeight * thumbnailFactor;\n\n\t\tsceneRenderer.paintOnto(\n\t\t\ttargetCanvas.getContext('2d')!,\n\t\t\t0,\n\t\t\t0,\n\t\t\ttargetCanvas.width,\n\t\t\ttargetCanvas.height\n\t\t);\n\t\ttargetCanvas.toBlob(\n\t\t\tblob => {\n\t\t\t\tif (!blob) return;\n\t\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setPanelPreview', {\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t\turl,\n\t\t\t\t\t} as ISetPanelPreviewMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t\t(await isWebPSupported()) ? 'image/webp' : 'image/jpeg',\n\t\t\tthumbnailQuality\n\t\t);\n\t},\n\tmethods: {\n\t\tasync download() {\n\t\t\tconst distribution = this.getPanelDistibution();\n\t\t\tconst date = new Date();\n\t\t\tconst prefix = `cd-${[\n\t\t\t\tdate.getFullYear(),\n\t\t\t\t`${date.getMonth() + 1}`.padStart(2, '0'),\n\t\t\t\t`${date.getDate()}`.padStart(2, '0'),\n\t\t\t\t`${date.getHours()}`.padStart(2, '0'),\n\t\t\t\t`${date.getMinutes()}`.padStart(2, '0'),\n\t\t\t\t`${date.getSeconds()}`.padStart(2, '0'),\n\t\t\t].join('-')}`;\n\t\t\tconst extension = this.format.split('/')[1];\n\t\t\tconst format = this.format;\n\t\t\tconst quality = this.quality;\n\t\t\tawait this.renderObjects(\n\t\t\t\tdistribution,\n\t\t\t\ttrue,\n\t\t\t\tasync (imageIdx: number, canvas: HTMLCanvasElement) => {\n\t\t\t\t\tenvironment.saveToFile(\n\t\t\t\t\t\tcanvas,\n\t\t\t\t\t\t`${prefix}_${imageIdx}.${extension}`,\n\t\t\t\t\t\tformat,\n\t\t\t\t\t\tquality / qualityFactor\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tasync estimateExportSize() {\n\t\t\tconst distribution = this.getPanelDistibution();\n\t\t\tconst format = this.format || 'image/png';\n\t\t\tconst quality = this.quality || defaultQuality;\n\t\t\tconst sizes = await this.renderObjects(\n\t\t\t\tdistribution,\n\t\t\t\tfalse,\n\t\t\t\tasync (imageIdx: number, canvas: HTMLCanvasElement) => {\n\t\t\t\t\treturn new Promise<number>((resolve, reject) => {\n\t\t\t\t\t\tcanvas.toBlob(\n\t\t\t\t\t\t\tblob => {\n\t\t\t\t\t\t\t\tif (!blob) {\n\t\t\t\t\t\t\t\t\treject(`Image ${imageIdx + 1} could not be rendered.`);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresolve(blob.size);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tformat,\n\t\t\t\t\t\t\tquality / qualityFactor\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t\tconst readableSizes = sizes.map(\n\t\t\t\tsize => ((size * estimateFactor) / 1024 / 1024).toFixed(2) + 'MiB'\n\t\t\t);\n\t\t\tconst filePluralize = readableSizes.length > 1 ? 'files' : 'file';\n\t\t\tconst itPluralize = readableSizes.length > 1 ? 'These' : 'It';\n\t\t\tconst sizePluralize = readableSizes.length > 1 ? 'sizes' : 'size';\n\t\t\teventBus.fire(\n\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t`This would export ${\n\t\t\t\t\t\treadableSizes.length\n\t\t\t\t\t} ${filePluralize}. ${itPluralize} would have the following (aproximate) ${sizePluralize}: ${readableSizes.join(\n\t\t\t\t\t\t','\n\t\t\t\t\t)}`\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\tasync renderObjects<T>(\n\t\t\tdistribution: DeepReadonly<string[][]>,\n\t\t\thq: boolean,\n\t\t\tmapper: (imageIdx: number, canvas: HTMLCanvasElement) => Promise<T>\n\t\t): Promise<T[]> {\n\t\t\treturn await Promise.all(\n\t\t\t\tdistribution.map(async (image, imageIdx) => {\n\t\t\t\t\tconst targetCanvas = document.createElement('canvas');\n\t\t\t\t\ttargetCanvas.width = screenWidth;\n\t\t\t\t\ttargetCanvas.height = screenHeight * image.length;\n\t\t\t\t\tconst context = targetCanvas.getContext('2d')!;\n\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\timage.map(async (panelId, panelIdx) => {\n\t\t\t\t\t\t\tconst sceneRenderer = new SceneRenderer(\n\t\t\t\t\t\t\t\tthis.$store,\n\t\t\t\t\t\t\t\timage[panelIdx],\n\t\t\t\t\t\t\t\tscreenWidth,\n\t\t\t\t\t\t\t\tscreenHeight\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tawait sceneRenderer.render(hq, false);\n\n\t\t\t\t\t\t\tsceneRenderer.paintOnto(\n\t\t\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\tscreenHeight * panelIdx,\n\t\t\t\t\t\t\t\tscreenWidth,\n\t\t\t\t\t\t\t\tscreenHeight\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t\treturn await mapper(imageIdx, targetCanvas);\n\t\t\t\t})\n\t\t\t);\n\t\t},\n\t\tgetLimitedPanelList(): DeepReadonly<string[]> {\n\t\t\tconst max = this.$store.state.panels.panelOrder.length - 1;\n\t\t\tconst min = 0;\n\t\t\tconst parts = this.pages.split(',');\n\t\t\tconst listedPages: number[] = [];\n\t\t\tlet foundMatch = false;\n\n\t\t\tfor (const part of parts) {\n\t\t\t\tconst trimmedPart = part.trim();\n\t\t\t\tconst match = trimmedPart.match(/^\\s*((\\d+)|(\\d+)\\s*-\\s*(\\d+))\\s*$/);\n\t\t\t\tif (!match) {\n\t\t\t\t\tif (trimmedPart !== '') {\n\t\t\t\t\t\teventBus.fire(\n\t\t\t\t\t\t\tnew ShowMessageEvent(`Could not read '${part}' in the page list.`)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfoundMatch = true;\n\t\t\t\tif (match[2]) listedPages.push(parseInt(match[2], 10) - 1);\n\t\t\t\telse {\n\t\t\t\t\tconst from = Math.max(parseInt(match[3], 10) - 1, min);\n\t\t\t\t\tconst to = Math.min(parseInt(match[4], 10) - 1, max);\n\t\t\t\t\tif (from === undefined || to === undefined || from > to) continue;\n\t\t\t\t\tfor (let i = from; i <= to; ++i) {\n\t\t\t\t\t\tlistedPages.push(i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!foundMatch) {\n\t\t\t\treturn this.$store.state.panels.panelOrder;\n\t\t\t}\n\n\t\t\treturn listedPages\n\t\t\t\t.sort((a, b) => a - b)\n\t\t\t\t.filter((value, idx, ary) => ary[idx - 1] !== value)\n\t\t\t\t.map(pageIdx => this.$store.state.panels.panelOrder[pageIdx]);\n\t\t},\n\t\tgetPanelDistibution(): DeepReadonly<string[][]> {\n\t\t\tconst panelOrder = this.getLimitedPanelList();\n\t\t\tif (this.ppi === 0) return [panelOrder];\n\t\t\tconst images: string[][] = [];\n\t\t\tfor (let imageI = 0; imageI < panelOrder.length / this.ppi; ++imageI) {\n\t\t\t\tconst sliceStart = imageI * this.ppi;\n\t\t\t\tconst sliceEnd = sliceStart + this.ppi;\n\t\t\t\timages.push([...panelOrder.slice(sliceStart, sliceEnd)]);\n\t\t\t}\n\t\t\treturn images;\n\t\t},\n\t\tmoveFocusToActivePanel() {\n\t\t\tconst active = this.$el.querySelector('.panel_button.active');\n\t\t\tif (active) {\n\t\t\t\tthis.scrollIntoView(active);\n\t\t\t}\n\t\t},\n\t\tscrollIntoView(ele: Element) {\n\t\t\tconst parent = ele.parentElement!.parentElement!;\n\t\t\tconst idx = Array.from(ele.parentElement!.children).indexOf(ele);\n\t\t\tif (this.$store.state.ui.vertical) {\n\t\t\t\tconst scroll =\n\t\t\t\t\tidx * ele.clientHeight -\n\t\t\t\t\tparent.clientHeight / 2 +\n\t\t\t\t\tele.clientHeight / 2;\n\t\t\t\tparent.scrollTop = scroll;\n\t\t\t\tparent.scrollLeft = 0;\n\t\t\t} else {\n\t\t\t\tconst scroll =\n\t\t\t\t\tidx * ele.clientWidth - parent.clientWidth / 2 + ele.clientWidth / 2;\n\t\t\t\tparent.scrollLeft = scroll;\n\t\t\t\tparent.scrollTop = 0;\n\t\t\t}\n\t\t},\n\t\textractObjectText(obj: DeepReadonly<IObject>) {\n\t\t\tswitch (obj.type) {\n\t\t\t\tcase 'textBox':\n\t\t\t\t\treturn (obj as ITextBox).text;\n\t\t\t\tcase 'notification':\n\t\t\t\t\treturn (obj as INotification).text;\n\t\t\t\tcase 'poem':\n\t\t\t\t\treturn (obj as IPoem).text;\n\t\t\t\tcase 'choice':\n\t\t\t\t\treturn (obj as IChoices).choices\n\t\t\t\t\t\t.map(choice => `[${choice.text}]`)\n\t\t\t\t\t\t.join('\\n');\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\tasync addNewPanel() {\n\t\t\tawait this.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('panels/duplicatePanel', {\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as IDuplicatePanelAction);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tupdateCurrentPanel(panelId: string) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.commit('panels/setCurrentPanel', {\n\t\t\t\t\tpanelId,\n\t\t\t\t} as ISetCurrentPanelMutation);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tdeletePanel() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('panels/delete', {\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as IDeletePanelAction);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tmoveAhead() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/move', {\n\t\t\t\t\tpanelId: this.currentPanel,\n\t\t\t\t\tdelta: -1,\n\t\t\t\t} as IMovePanelAction);\n\t\t\t});\n\t\t},\n\t\tmoveBehind() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/move', {\n\t\t\t\t\tpanelId: this.currentPanel,\n\t\t\t\t\tdelta: 1,\n\t\t\t\t} as IMovePanelAction);\n\t\t\t});\n\t\t},\n\t},\n\twatch: {\n\t\tquality(quality: number, oldQuality: number) {\n\t\t\tif (quality === qualityFactor) {\n\t\t\t\teventBus.fire(\n\t\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t\t'Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression.'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (\n\t\t\t\toldQuality > qualityWarningThreshold &&\n\t\t\t\tquality <= qualityWarningThreshold\n\t\t\t) {\n\t\t\t\teventBus.fire(\n\t\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t\t'Note: A quality level below 70% might be very noticable and impair legibility of text.'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.panel_button {\n\theight: 150px;\n\twidth: 150px;\n\tflex-shrink: 0;\n\tpadding: 4px;\n\tbackground-size: contain;\n\tbackground-position: center center;\n\tbackground-repeat: no-repeat;\n\tbackground-color: #ffffff;\n\tborder: #ffbde1 2px solid;\n\tdisplay: flex;\n\tflex-direction: column;\n\tcolor: #ffffff;\n\n\ttext-shadow: 0 0 4px #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000,\n\t\t1px 1px 0 #000;\n\n\t&.active {\n\t\tbackground-color: #ffbde1;\n\t}\n}\n\n.panel_text {\n\tflex-grow: 1;\n\tposition: relative;\n\n\tp {\n\t\theight: 60px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\twhite-space: pre;\n\t}\n}\n\n.panel_nr {\n\ttext-align: right;\n}\n\n#export_ppi,\n#export_pages {\n\twidth: 128px;\n}\n\nsmall {\n\tfont-size: 0.75em;\n}\n\n.panel {\n\t&.vertical {\n\t\t.column {\n\t\t\twidth: 100%;\n\n\t\t\tbutton,\n\t\t\tselect {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\tfieldset {\n\t\t\twidth: 100%;\n\t\t\t.existing_panels {\n\t\t\t\tmax-height: 350px;\n\t\t\t\twidth: 100%;\n\t\t\t\tflex-direction: column;\n\n\t\t\t\t.panel_button {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 150px;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttable {\n\t\t\t\twidth: 100%;\n\t\t\t\ttd {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tdisplay: table-row;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t&:not(.vertical) {\n\t\t.column {\n\t\t\tdisplay: flex;\n\t\t\t@include height-100();\n\t\t\tflex-direction: column;\n\t\t\tflex-wrap: wrap;\n\n\t\t\ttextarea {\n\t\t\t\theight: 100%;\n\t\t\t}\n\t\t}\n\n\t\t.existing_panels_fieldset {\n\t\t\t@include height-100();\n\t\t}\n\n\t\tfieldset {\n\t\t\t.existing_panels {\n\t\t\t\tflex-direction: row;\n\n\t\t\t\t.panel_button {\n\t\t\t\t\theight: 100%;\n\t\t\t\t\twidth: 150px;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttable {\n\t\t\t\ttd {\n\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n</style>\n","import { Module } from 'vuex';\nimport { ContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, BackgroundLookup } from './content';\nimport { IRootState } from '.';\nimport { arraySeeker } from '@/models/seekers';\nimport { ICopyObjectsAction, IDeleteAllOfPanel } from './objects';\nimport { IHasSpriteFilters } from './sprite_options';\n\nexport enum ScalingModes {\n\tNone = 0,\n\tStretch = 1,\n\tCover = 2,\n}\n\nexport interface IPanel extends IHasSpriteFilters {\n\tid: string;\n\tbackground: IPanelBackground;\n\tlastRender: string;\n}\n\ninterface IPanelBackground extends IHasSpriteFilters {\n\tcurrent: string;\n\tcolor: string;\n\tflipped: boolean;\n\tvariant: number;\n\tscaling: ScalingModes;\n}\n\nexport interface IPanels {\n\tpanels: { [id: string]: IPanel };\n\tpanelOrder: string[];\n\tcurrentPanel: string;\n}\n\nexport const transparentId = 'buildin.transparent';\nexport const staticColorId = 'buildin.static-color';\n\nlet lastPanelNum = 0;\n\nconst previewManager = {\n\tpanelToUrl: new Map<string, string>(),\n\turlToPanel: new Map<string, string[]>(),\n\tregister(panelId: string, url: string) {\n\t\tif (this.panelToUrl.has(panelId)) {\n\t\t\tif (this.panelToUrl.get(panelId) === url) return;\n\t\t\tthis.unregister(panelId, this.panelToUrl.get(panelId)!);\n\t\t}\n\t\tthis.panelToUrl.set(panelId, url);\n\t\tif (this.urlToPanel.has(url)) {\n\t\t\tthis.urlToPanel.get(url)!.push(panelId);\n\t\t} else {\n\t\t\tthis.urlToPanel.set(url, [panelId]);\n\t\t}\n\t},\n\tunregister(panelId: string, url: string) {\n\t\tif (this.urlToPanel.has(url)) {\n\t\t\tconst panels = this.urlToPanel.get(url)!;\n\t\t\tpanels.splice(panels.indexOf(panelId), 1);\n\t\t\tif (panels.length === 0) {\n\t\t\t\tthis.urlToPanel.delete(url);\n\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t}\n\t\t}\n\t\tthis.panelToUrl.delete(panelId);\n\t},\n};\n\nexport default {\n\tnamespaced: true,\n\tstate: {\n\t\tpanels: {},\n\t\tpanelOrder: [],\n\t\tcurrentPanel: null!,\n\t},\n\tmutations: {\n\t\tsetCurrentPanel(state, { panelId }: ISetCurrentPanelMutation) {\n\t\t\tstate.currentPanel = panelId;\n\t\t},\n\t\tsetPanelPreview(state, { panelId, url }: ISetPanelPreviewMutation) {\n\t\t\tstate.panels[panelId].lastRender = url;\n\t\t\tpreviewManager.register(panelId, url);\n\t\t},\n\t\tcreatePanel(state, { panel }: ICreatePanel) {\n\t\t\tstate.panels[panel.id] = panel;\n\t\t},\n\t\tsetPanelOrder(state, { panelOrder }: ISetPanelOrder) {\n\t\t\tstate.panelOrder = [...panelOrder];\n\t\t},\n\t\tsetCurrentBackground(state, { current, panelId }: ISetCurrentMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.current = current;\n\t\t\tpanel.background.variant = 0;\n\t\t},\n\t\tsetBackgroundColor(state, { color, panelId }: ISetColorMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.color = color;\n\t\t},\n\t\tsetBackgroundFlipped(state, { flipped, panelId }: ISetFlipMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.flipped = flipped;\n\t\t},\n\t\tsetBackgroundVariant(state, { variant, panelId }: ISetVariantMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.variant = variant;\n\t\t},\n\t\tsetBackgroundScaling(state, { scaling, panelId }: ISetScalingMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.scaling = scaling;\n\t\t},\n\t\tdeletePanel(state, { panelId }: IDeletePanelMutation) {\n\t\t\tpreviewManager.unregister(\n\t\t\t\tpanelId,\n\t\t\t\tpreviewManager.panelToUrl.get(panelId)!\n\t\t\t);\n\t\t\tdelete state.panels[panelId];\n\t\t},\n\t},\n\tactions: {\n\t\tcreatePanel({ state, commit }) {\n\t\t\tconst id = 'panel' + ++lastPanelNum;\n\t\t\tcommit('createPanel', {\n\t\t\t\tpanel: {\n\t\t\t\t\tid,\n\t\t\t\t\tbackground: {\n\t\t\t\t\t\tcolor: '#000000',\n\t\t\t\t\t\tcurrent: transparentId,\n\t\t\t\t\t\tflipped: false,\n\t\t\t\t\t\tscaling: ScalingModes.None,\n\t\t\t\t\t\tvariant: 0,\n\t\t\t\t\t},\n\t\t\t\t\tlastRender: '',\n\t\t\t\t},\n\t\t\t} as ICreatePanel);\n\t\t\tif (!state.panelOrder) {\n\t\t\t\tcommit('setPanelOrder', {\n\t\t\t\t\tpanelOrder: [id],\n\t\t\t\t} as ISetPanelOrder);\n\t\t\t} else {\n\t\t\t\tcommit('setPanelOrder', {\n\t\t\t\t\tpanelOrder: [...state.panelOrder, id],\n\t\t\t\t} as ISetPanelOrder);\n\t\t\t}\n\t\t\tcommit('setCurrentPanel', {\n\t\t\t\tpanelId: id,\n\t\t\t} as ISetCurrentPanelMutation);\n\t\t},\n\t\tduplicatePanel(\n\t\t\t{ state, commit, dispatch },\n\t\t\t{ panelId }: IDuplicatePanelAction\n\t\t) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tconst id = 'panel' + ++lastPanelNum;\n\t\t\tpreviewManager.register(id, panel.lastRender);\n\t\t\tcommit('createPanel', {\n\t\t\t\tpanel: {\n\t\t\t\t\tid,\n\t\t\t\t\tbackground: JSON.parse(JSON.stringify(panel.background)),\n\t\t\t\t\tlastRender: panel.lastRender,\n\t\t\t\t},\n\t\t\t} as ICreatePanel);\n\t\t\tdispatch(\n\t\t\t\t'objects/copyObjects',\n\t\t\t\t{\n\t\t\t\t\tsourcePanelId: panelId,\n\t\t\t\t\ttargetPanelId: id,\n\t\t\t\t} as ICopyObjectsAction,\n\t\t\t\t{ root: true }\n\t\t\t);\n\t\t\tconst oldIdx = state.panelOrder.indexOf(panelId);\n\t\t\tcommit('setPanelOrder', {\n\t\t\t\tpanelOrder: [\n\t\t\t\t\t...state.panelOrder.slice(0, oldIdx + 1),\n\t\t\t\t\tid,\n\t\t\t\t\t...state.panelOrder.slice(oldIdx + 1),\n\t\t\t\t],\n\t\t\t} as ISetPanelOrder);\n\t\t\tcommit('setCurrentPanel', {\n\t\t\t\tpanelId: id,\n\t\t\t} as ISetCurrentPanelMutation);\n\t\t},\n\t\tseekBackgroundVariant(\n\t\t\t{ state, rootGetters, commit },\n\t\t\t{ delta }: ISeekVariantAction\n\t\t) {\n\t\t\tconst panel = state.panels[state.currentPanel];\n\t\t\tconst backgrounds = rootGetters[\n\t\t\t\t'content/getBackgrounds'\n\t\t\t] as BackgroundLookup;\n\t\t\tconst background = backgrounds.get(panel.background.current);\n\t\t\tif (!background) return;\n\t\t\tcommit('setBackgroundVariant', {\n\t\t\t\tpanelId: state.currentPanel,\n\t\t\t\tvariant: arraySeeker(\n\t\t\t\t\tbackground.variants,\n\t\t\t\t\tpanel.background.variant,\n\t\t\t\t\tdelta\n\t\t\t\t),\n\t\t\t} as ISetVariantMutation);\n\t\t},\n\t\tdelete({ state, dispatch, commit }, { panelId }: IDeletePanelAction) {\n\t\t\tif (state.panelOrder.length <= 1) return;\n\t\t\tconst orderIdx = state.panelOrder.indexOf(panelId);\n\t\t\tlet newOrderIdx;\n\t\t\tif (orderIdx === state.panelOrder.length - 1) {\n\t\t\t\tnewOrderIdx = orderIdx - 1;\n\t\t\t} else {\n\t\t\t\tnewOrderIdx = orderIdx + 1;\n\t\t\t}\n\t\t\tcommit('setCurrentPanel', {\n\t\t\t\tpanelId: state.panelOrder[newOrderIdx],\n\t\t\t} as ISetCurrentPanelMutation);\n\t\t\tcommit('setPanelOrder', {\n\t\t\t\tpanelOrder: [\n\t\t\t\t\t...state.panelOrder.slice(0, orderIdx),\n\t\t\t\t\t...state.panelOrder.slice(orderIdx + 1),\n\t\t\t\t],\n\t\t\t} as ISetPanelOrder);\n\t\t\tdispatch(\n\t\t\t\t'objects/deleteAllOfPanel',\n\t\t\t\t{\n\t\t\t\t\tpanelId,\n\t\t\t\t} as IDeleteAllOfPanel,\n\t\t\t\t{ root: true }\n\t\t\t);\n\t\t\tcommit('deletePanel', {\n\t\t\t\tpanelId,\n\t\t\t} as IDeletePanelMutation);\n\t\t},\n\t\tasync fixContentPackRemoval(\n\t\t\t{ state, rootGetters, commit, rootState },\n\t\t\toldContent: ContentPack<IAsset>\n\t\t) {\n\t\t\tfor (const panel of Object.values(state.panels)) {\n\t\t\t\tconst oldBackground = oldContent.backgrounds.find(\n\t\t\t\t\tx => x.id === panel.background.current\n\t\t\t\t);\n\t\t\t\t// Probably build in?\n\t\t\t\tif (!oldBackground) return;\n\n\t\t\t\tconst newBackground = (rootGetters[\n\t\t\t\t\t'content/getBackgrounds'\n\t\t\t\t] as BackgroundLookup).get(panel.background.current);\n\n\t\t\t\tif (!newBackground) {\n\t\t\t\t\tif (rootState.content.current.backgrounds[0]) {\n\t\t\t\t\t\tcommit('setCurrentBackground', {\n\t\t\t\t\t\t\tcurrent: rootState.content.current.backgrounds[0].id,\n\t\t\t\t\t\t\tpanelId: panel.id,\n\t\t\t\t\t\t} as ISetCurrentMutation);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcommit('setCurrentBackground', {\n\t\t\t\t\t\t\tcurrent: 'buildin.transparent',\n\t\t\t\t\t\t\tpanelId: panel.id,\n\t\t\t\t\t\t} as ISetCurrentMutation);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst oldVariantJSON = JSON.stringify(\n\t\t\t\t\toldBackground.variants[panel.background.variant]\n\t\t\t\t);\n\t\t\t\tconst newVariantIdx = newBackground.variants.findIndex(\n\t\t\t\t\tvariant => JSON.stringify(variant) === oldVariantJSON\n\t\t\t\t);\n\t\t\t\tif (newVariantIdx !== panel.background.variant) {\n\t\t\t\t\tcommit('setBackgroundVariant', {\n\t\t\t\t\t\tvariant: newVariantIdx === -1 ? 0 : newVariantIdx,\n\t\t\t\t\t\tpanelId: panel.id,\n\t\t\t\t\t} as ISetVariantMutation);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmove({ state, commit }, { panelId, delta }: IMovePanelAction) {\n\t\t\tconst collection = [...state.panelOrder];\n\t\t\tconst oldIdx = collection.indexOf(panelId);\n\t\t\tcollection.splice(oldIdx, 1);\n\t\t\tconst newIdx = Math.max(oldIdx + delta, 0);\n\t\t\tcollection.splice(newIdx, 0, panelId);\n\t\t\tcommit('setPanelOrder', { panelOrder: collection } as ISetPanelOrder);\n\t\t},\n\t},\n} as Module<IPanels, IRootState>;\n\nexport interface ISetCurrentPanelMutation {\n\treadonly panelId: string;\n}\n\nexport interface IDeletePanelMutation {\n\treadonly panelId: string;\n}\n\nexport interface ISetPanelPreviewMutation {\n\treadonly panelId: string;\n\treadonly url: string;\n}\n\nexport interface IDuplicatePanelAction {\n\treadonly panelId: string;\n}\n\nexport interface IDeletePanelAction {\n\treadonly panelId: string;\n}\n\nexport interface ICreatePanel {\n\treadonly panel: IPanel;\n}\n\nexport interface ISetPanelOrder {\n\treadonly panelOrder: string[];\n}\n\nexport interface ISetCurrentMutation {\n\treadonly panelId: string;\n\treadonly current: string;\n}\n\nexport interface ISetColorMutation {\n\treadonly panelId: string;\n\treadonly color: string;\n}\n\nexport interface ISetFlipMutation {\n\treadonly panelId: string;\n\treadonly flipped: boolean;\n}\n\nexport interface ISetVariantMutation {\n\treadonly panelId: string;\n\treadonly variant: number;\n}\n\nexport interface ISetScalingMutation {\n\treadonly panelId: string;\n\treadonly scaling: ScalingModes;\n}\n\nexport interface ISeekVariantAction {\n\treadonly delta: 1 | -1;\n}\n\nexport interface IMovePanelAction {\n\treadonly panelId: string;\n\treadonly delta: number;\n}\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { getAAsset } from '@/asset-manager';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport { IAsset } from '@/store/content';\nimport { ScalingModes } from '@/store/panels';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport interface IBackgroundRenderer {\n\trender(rx: RenderContext): Promise<void>;\n}\n\nexport class Background implements IBackgroundRenderer {\n\tpublic constructor(\n\t\tpublic readonly id: string,\n\t\tpublic readonly assets: DeepReadonly<IAsset[]>,\n\t\tpublic readonly flip: boolean,\n\t\tpublic readonly scale: ScalingModes\n\t) {}\n\n\tpublic async render(rx: RenderContext): Promise<void> {\n\t\tconst images = await Promise.all(\n\t\t\tthis.assets.map(asset => getAAsset(asset, rx.hq))\n\t\t);\n\t\tfor (const image of images) {\n\t\t\tif (!(image instanceof HTMLImageElement)) return;\n\t\t\tlet x = 0;\n\t\t\tlet y = 0;\n\t\t\tlet w = image.width;\n\t\t\tlet h = image.height;\n\n\t\t\tswitch (this.scale) {\n\t\t\t\tcase ScalingModes.None:\n\t\t\t\t\tx = screenWidth / 2 - w / 2;\n\t\t\t\t\ty = screenHeight / 2 - h / 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScalingModes.Stretch:\n\t\t\t\t\tw = screenWidth;\n\t\t\t\t\th = screenHeight;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScalingModes.Cover:\n\t\t\t\t\tconst ratio = w / h;\n\t\t\t\t\tconst screenRatio = screenWidth / screenHeight;\n\n\t\t\t\t\tif (ratio > screenRatio) {\n\t\t\t\t\t\th = screenHeight;\n\t\t\t\t\t\tw = h * ratio;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tw = screenWidth;\n\t\t\t\t\t\th = w / ratio;\n\t\t\t\t\t}\n\n\t\t\t\t\tx = screenWidth / 2 - w / 2;\n\t\t\t\t\ty = screenHeight / 2 - h / 2;\n\t\t\t}\n\n\t\t\trx.drawImage({\n\t\t\t\timage,\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tw,\n\t\t\t\th,\n\t\t\t\tflip: this.flip,\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport const color = {\n\tid: 'buildin.static-color',\n\tname: 'Static color',\n\tcolor: '#000000',\n\n\tasync render(rx: RenderContext): Promise<void> {\n\t\trx.drawRect({\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tw: screenWidth,\n\t\t\th: screenHeight,\n\t\t\tfill: { style: this.color },\n\t\t});\n\t},\n};\n\nexport const transparent = {\n\tid: 'buildin.transparent',\n\tname: 'Transparent',\n\t// tslint:disable-next-line: no-empty\n\tasync render(rx: RenderContext) {},\n};\n","import { getAAsset } from '@/asset-manager';\nimport { ISprite } from '@/store/objectTypes/sprite';\nimport { DeepReadonly } from '@/util/readonly';\nimport {\n\tAssetListRenderable,\n\tIDrawAssets,\n\tIDrawAssetsUnloaded,\n} from './assetListRenderable';\nimport eventBus, { InvalidateRenderEvent } from '@/eventbus/event-bus';\n\nconst BaseXPosition = 640;\n\nexport class Sprite extends AssetListRenderable<ISprite> {\n\tprivate assets: IDrawAssets[] | null = null;\n\tprotected scaleable = true;\n\tprotected canvasHeight: number = 0;\n\tprotected canvasWidth: number = 0;\n\n\tconstructor(obj: DeepReadonly<ISprite>) {\n\t\tsuper(obj);\n\t\tthis.init();\n\t}\n\n\tprotected get version(): number {\n\t\treturn this.assets === null ? -1 : this.obj.version;\n\t}\n\n\tpublic async init() {\n\t\tconst assets = await Promise.all(\n\t\t\tthis.obj.assets.map(asset => getAAsset(asset))\n\t\t);\n\t\tlet width = 0;\n\t\tlet height = 0;\n\t\tfor (const asset of assets) {\n\t\t\tif (asset instanceof HTMLImageElement) {\n\t\t\t\tif (asset.height > height) height = asset.height;\n\t\t\t\tif (asset.width > width) width = asset.width;\n\t\t\t}\n\t\t}\n\t\tthis.canvasWidth = width;\n\t\tthis.canvasHeight = height;\n\t\tthis.assets = [\n\t\t\t{\n\t\t\t\tloaded: true,\n\t\t\t\tassets,\n\t\t\t\toffset: [0, 0],\n\t\t\t},\n\t\t];\n\t\tdebugger;\n\t\teventBus.fire(new InvalidateRenderEvent());\n\t}\n\tprotected getAssetList(): (IDrawAssets | IDrawAssetsUnloaded)[] {\n\t\treturn this.assets || [];\n\t}\n\n\tpublic updatedContent(): void {}\n}\n","export function roundedRectangle(\n\tctx: CanvasPath,\n\tx: number,\n\ty: number,\n\tw: number,\n\th: number,\n\tr: number\n) {\n\tif (w < 0) w = 0;\n\tif (h < 0) h = 0;\n\tif (w < 2 * r) r = w / 2;\n\tif (h < 2 * r) r = h / 2;\n\tctx.moveTo(x + r, y);\n\tctx.arcTo(x + w, y, x + w, y + h, r);\n\tctx.arcTo(x + w, y + h, x, y + h, r);\n\tctx.arcTo(x, y + h, x, y, r);\n\tctx.arcTo(x, y, x + w, y, r);\n\tctx.closePath();\n}\n\nexport function roundedTopRectangle(\n\tctx: CanvasPath,\n\tx: number,\n\ty: number,\n\tw: number,\n\th: number,\n\tr: number\n) {\n\tif (w < 0) w = 0;\n\tif (h < 0) h = 0;\n\tif (w < 2 * r) r = w / 2;\n\tif (h < 2 * r) r = h / 2;\n\tctx.moveTo(x + r, y);\n\tctx.arcTo(x + w, y, x + w, y + h, r);\n\tctx.lineTo(x + w, y + h);\n\tctx.lineTo(x, y + h);\n\tctx.arcTo(x, y, x + w, y, r);\n\tctx.closePath();\n}\n","import { HSLAColor } from '@/util/colors/hsl';\n\n// tslint:disable: no-magic-numbers\nexport const nameboxTextOutlineDelta = new HSLAColor(\n\t-0.03065134099616873,\n\t-0.5714285714285714,\n\t-0.29607843137254896,\n\t0\n);\n\nexport const nameboxBackgroundDelta = new HSLAColor(\n\t0.002028397565922768,\n\t0,\n\t0.13725490196078438,\n\t0\n);\n\nexport const nameboxGradientMiddleStopPosition = 0.82;\n\nexport const nameboxGradientEndDelta = new HSLAColor(\n\t-0.004901960784313708,\n\t-0.8599999999999999,\n\t-0.16274509803921566,\n\t0\n);\n\nexport const nameboxRounding = 12;\nexport const nameboxRoundingBuffer = 1.5;\n\nexport const textboxRounding = 12;\nexport const textboxRoundingBuffer = 1.5;\n\nexport const nameColorThreshold = 0.6;\n\nexport const controlColorDelta = new HSLAColor(\n\t0.08045977011494243,\n\t-0.5714285714285714,\n\t-0.5960784313725489,\n\t0\n);\n\nexport const controlDisableColorDelta = new HSLAColor(\n\t0,\n\t-0.14285714285714296,\n\t0.3,\n\t0\n);\n\nexport const dotColorDelta = new HSLAColor(\n\t0.004269293924466178,\n\t-0.01869158878504662,\n\t-0.039215686274509665,\n\t0\n);\n\nexport const dotRadius = 9.5;\nexport const dotPatternSize = 47;\n\nexport const textboxOutlineColorDelta = new HSLAColor(\n\t0.0023347701149424305,\n\t0,\n\t0.10784313725490202,\n\t0\n);\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { getAsset } from '@/asset-manager';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport {\n\tNameboxTextStyle,\n\tControlsTextStyle,\n\tControlsTextDisabledStyle,\n\tTextBoxWidth,\n\tNameboxHeight,\n\tTextBoxHeight,\n\tTextBoxCorruptedWidth,\n\tNameboxXOffset,\n\tNameboxWidth,\n\tNameboxTextYOffset,\n\tControlsXHistoryOffset,\n\tControlsXSkipOffset,\n\tControlsXStuffOffset,\n\tArrowXRightOffset,\n\tArrowYBottomOffset,\n\tTextBoxTextYOffset,\n\tTextBoxTextXOffset,\n\tControlsYBottomOffset,\n\tGlowRY,\n\tGlowRX,\n} from '@/constants/textBox';\nimport { Renderer } from '@/renderer/renderer';\nimport { roundedRectangle, roundedTopRectangle } from '@/renderer/pathTools';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { TextRenderer, ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport {\n\tnameboxTextOutlineDelta,\n\tnameboxBackgroundDelta,\n\tnameboxGradientEndDelta,\n\tnameboxGradientMiddleStopPosition,\n\tcontrolColorDelta,\n\tcontrolDisableColorDelta,\n\tnameboxRounding,\n\tdotColorDelta,\n\tdotRadius,\n\tdotPatternSize,\n\ttextboxRoundingBuffer,\n\ttextboxRounding,\n\ttextboxOutlineColorDelta,\n} from '@/constants/textBoxCustom';\nimport { ObjectRenderable } from './objectRenderable';\n\nexport class TextBox extends ObjectRenderable<ITextBox> {\n\tprotected readonly scaleable = false;\n\tprotected readonly canvasHeight = screenHeight;\n\tprotected readonly canvasWidth = screenWidth;\n\n\tpublic get width(): number {\n\t\treturn this.obj.style === 'custom' ? this.obj.width : TextBoxWidth;\n\t}\n\n\tpublic get height(): number {\n\t\treturn (\n\t\t\t(this.obj.style === 'custom' ? this.obj.height : TextBoxHeight) +\n\t\t\tNameboxHeight\n\t\t);\n\t}\n\n\tpublic get controlColor(): string {\n\t\tif (this.obj.deriveCustomColors) {\n\t\t\tconst base = RGBAColor.fromCss(this.obj.customColor).toHSL();\n\t\t\treturn base\n\t\t\t\t.shift(controlColorDelta)\n\t\t\t\t.toRgb()\n\t\t\t\t.toCss();\n\t\t}\n\t\treturn this.obj.customControlsColor;\n\t}\n\n\tpublic get controlsStyle() {\n\t\tif (this.obj.style !== 'custom') return ControlsTextStyle;\n\t\treturn {\n\t\t\t...ControlsTextStyle,\n\t\t\tfill: {\n\t\t\t\tstyle: this.controlColor,\n\t\t\t},\n\t\t};\n\t}\n\n\tpublic get controlsDisableStyle() {\n\t\tif (this.obj.style !== 'custom') return ControlsTextDisabledStyle;\n\n\t\tconst col = RGBAColor.fromCss(this.controlColor).toHSL();\n\t\tconst disColor = col\n\t\t\t.shift(controlDisableColorDelta)\n\t\t\t.toRgb()\n\t\t\t.toCss();\n\n\t\treturn {\n\t\t\t...ControlsTextStyle,\n\n\t\t\tfill: {\n\t\t\t\tstyle: disColor,\n\t\t\t},\n\t\t};\n\t}\n\n\tprotected async renderLocal(rx: RenderContext): Promise<void> {\n\t\tconst w = this.width;\n\t\tconst h = this.height;\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.flip ? screenWidth - this.obj.x : this.obj.x;\n\t\tconst x = baseX - w2;\n\t\tconst y = this.obj.y;\n\n\t\tawait this.renderBackdrop(rx, x, y + NameboxHeight);\n\n\t\tif (this.obj.talkingDefault !== 'No-one') {\n\t\t\tconst name =\n\t\t\t\tthis.obj.talkingDefault === 'Other'\n\t\t\t\t\t? this.obj.talkingOther\n\t\t\t\t\t: this.obj.talkingDefault;\n\t\t\tawait this.renderNamebox(rx, x + NameboxXOffset, y, name);\n\t\t}\n\n\t\tawait this.renderText(rx, x, y, this.obj.autoWrap ? w : 0);\n\n\t\tconst bottom = y + h;\n\t\tconst controlsY = bottom - ControlsYBottomOffset;\n\t\tconst controlsCenter = x + w / 2;\n\n\t\tif (this.obj.controls) {\n\t\t\trx.drawText({\n\t\t\t\ttext: 'History',\n\t\t\t\tx: controlsCenter + ControlsXHistoryOffset,\n\t\t\t\ty: controlsY,\n\t\t\t\t...this.controlsStyle,\n\t\t\t});\n\t\t\trx.drawText({\n\t\t\t\ttext: 'Skip',\n\t\t\t\tx: controlsCenter + ControlsXSkipOffset,\n\t\t\t\ty: controlsY,\n\t\t\t\t...(this.obj.skip ? this.controlsStyle : this.controlsDisableStyle),\n\t\t\t});\n\t\t\trx.drawText({\n\t\t\t\ttext: 'Auto   Save   Load   Settings',\n\t\t\t\tx: controlsCenter + ControlsXStuffOffset,\n\t\t\t\ty: controlsY,\n\t\t\t\t...this.controlsStyle,\n\t\t\t});\n\t\t}\n\n\t\tif (this.obj.continue) {\n\t\t\trx.drawImage({\n\t\t\t\timage: await getAsset('next'),\n\t\t\t\tx: x + w - ArrowXRightOffset,\n\t\t\t\ty: bottom - ArrowYBottomOffset,\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate get nameboxOutlineColor(): string {\n\t\tif (this.obj.deriveCustomColors) {\n\t\t\tconst base = RGBAColor.fromCss(this.obj.customColor).toHSL();\n\t\t\treturn base\n\t\t\t\t.shift(nameboxTextOutlineDelta)\n\t\t\t\t.toRgb()\n\t\t\t\t.toCss();\n\t\t}\n\t\treturn this.obj.customNameboxStroke;\n\t}\n\n\tprivate get nameboxBackgroundColor(): string {\n\t\tif (this.obj.deriveCustomColors) {\n\t\t\tconst base = RGBAColor.fromCss(this.obj.customColor).toHSL();\n\t\t\treturn base\n\t\t\t\t.shift(nameboxBackgroundDelta)\n\t\t\t\t.toRgb()\n\t\t\t\t.toCss();\n\t\t}\n\t\treturn this.obj.customNameboxColor;\n\t}\n\n\tprivate async renderNamebox(\n\t\trx: RenderContext,\n\t\tx: number,\n\t\ty: number,\n\t\tname: string\n\t): Promise<void> {\n\t\tlet w: number;\n\t\tconst h = NameboxHeight;\n\t\tlet style: ITextStyle = NameboxTextStyle;\n\t\tif (this.obj.style === 'custom') {\n\t\t\tstyle = {\n\t\t\t\t...style,\n\t\t\t\tstrokeColor: this.nameboxOutlineColor,\n\t\t\t\tstrokeWidth: 6,\n\t\t\t\tcolor: '#FFFFFF',\n\t\t\t};\n\t\t\tw = this.obj.customNameboxWidth;\n\t\t\trx.customTransform(\n\t\t\t\tctx => {\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\troundedTopRectangle(ctx, x, y, w, h, nameboxRounding);\n\t\t\t\t\tctx.clip();\n\t\t\t\t},\n\t\t\t\tsubRx => {\n\t\t\t\t\tconst gradient = subRx.linearGradient(x, y, x, y + NameboxHeight);\n\t\t\t\t\tconst baseBG = RGBAColor.fromCss(this.nameboxBackgroundColor);\n\t\t\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\t\t\tconst color = new RGBAColor(baseBG.r, baseBG.g, baseBG.b, 0.95);\n\t\t\t\t\tconst targetColor = color\n\t\t\t\t\t\t.toHSL()\n\t\t\t\t\t\t.shift(nameboxGradientEndDelta)\n\t\t\t\t\t\t.toRgb();\n\t\t\t\t\tgradient.addColorStop(0, color.toCss());\n\t\t\t\t\tgradient.addColorStop(\n\t\t\t\t\t\tnameboxGradientMiddleStopPosition,\n\t\t\t\t\t\tcolor.toCss()\n\t\t\t\t\t);\n\t\t\t\t\tgradient.addColorStop(1, targetColor.toCss());\n\t\t\t\t\tsubRx.drawRect({\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty,\n\t\t\t\t\t\tw: this.obj.width,\n\t\t\t\t\t\th,\n\t\t\t\t\t\tfill: {\n\t\t\t\t\t\t\tstyle: gradient,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t} else if (this.obj.style !== 'none') {\n\t\t\tw = NameboxWidth;\n\t\t\trx.drawImage({\n\t\t\t\timage: await getAsset('namebox'),\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t});\n\t\t} else {\n\t\t\tw = NameboxWidth;\n\t\t}\n\n\t\tconst render = new TextRenderer(name, style);\n\t\tawait render.loadFonts();\n\n\t\trender.fixAlignment('center', x, x + w, y + NameboxTextYOffset, 0);\n\n\t\trender.render(rx.fsCtx);\n\t}\n\n\tprivate async renderBackdrop(\n\t\trx: RenderContext,\n\t\tx: number,\n\t\ty: number\n\t): Promise<void> {\n\t\tif (this.obj.style === 'custom') {\n\t\t\tconst hslColor = RGBAColor.fromCss(this.obj.customColor).toHSL();\n\t\t\tconst dotPattern = new Renderer(dotPatternSize, dotPatternSize);\n\t\t\tdotPattern.render(async (dotRx: RenderContext) => {\n\t\t\t\tconst fill = {\n\t\t\t\t\tstyle: hslColor\n\t\t\t\t\t\t.shift(dotColorDelta)\n\t\t\t\t\t\t.toRgb()\n\t\t\t\t\t\t.toCss(),\n\t\t\t\t};\n\n\t\t\t\tfunction drawDot(dotX: number, dotY: number) {\n\t\t\t\t\tdotRx.drawPath({\n\t\t\t\t\t\tpath: ctx => {\n\t\t\t\t\t\t\tctx.ellipse(dotX, dotY, dotRadius, dotRadius, 0, 0, 2 * Math.PI);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfill,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tdrawDot(0, 0);\n\t\t\t\tdrawDot(dotPatternSize, 0);\n\t\t\t\tdrawDot(0, dotPatternSize);\n\t\t\t\tdrawDot(dotPatternSize, dotPatternSize);\n\t\t\t\tdrawDot(dotPatternSize / 2, dotPatternSize / 2);\n\t\t\t}, true);\n\t\t\trx.customTransform(\n\t\t\t\tctx => {\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\troundedRectangle(\n\t\t\t\t\t\tctx,\n\t\t\t\t\t\tx + textboxRoundingBuffer,\n\t\t\t\t\t\ty + textboxRoundingBuffer,\n\t\t\t\t\t\tthis.obj.width - textboxRoundingBuffer * 2,\n\t\t\t\t\t\tthis.obj.height - textboxRoundingBuffer * 2,\n\t\t\t\t\t\ttextboxRounding\n\t\t\t\t\t);\n\t\t\t\t\tctx.clip();\n\t\t\t\t},\n\t\t\t\tsubRx => {\n\t\t\t\t\tconst h = this.obj.height;\n\t\t\t\t\tconst w = this.obj.width;\n\t\t\t\t\tconst gradient = subRx.linearGradient(x, y, x, y + h);\n\t\t\t\t\tconst color = RGBAColor.fromHex(this.obj.customColor);\n\t\t\t\t\tgradient.addColorStop(0, color.toCss());\n\t\t\t\t\tgradient.addColorStop(\n\t\t\t\t\t\t1,\n\t\t\t\t\t\t`rgba(${color.r},${color.g},${color.b},0.6667)`\n\t\t\t\t\t);\n\t\t\t\t\tsubRx.drawRect({\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty,\n\t\t\t\t\t\tw,\n\t\t\t\t\t\th,\n\t\t\t\t\t\tfill: {\n\t\t\t\t\t\t\tstyle: gradient,\n\t\t\t\t\t\t},\n\t\t\t\t\t\toutline: {\n\t\t\t\t\t\t\tstyle: '#ffdfee',\n\t\t\t\t\t\t\twidth: 6,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tsubRx.customTransform(\n\t\t\t\t\t\tctx => {\n\t\t\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t_subSubRx => {\n\t\t\t\t\t\t\tconst pattern = subRx.patternFrom(dotPattern);\n\t\t\t\t\t\t\tsubRx.drawRect({\n\t\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\t\tw,\n\t\t\t\t\t\t\t\th,\n\t\t\t\t\t\t\t\tfill: {\n\t\t\t\t\t\t\t\t\tstyle: pattern,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcomposition: 'source-atop',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tconst glowGradient = subRx.linearGradient(\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty + h - GlowRY,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty + h\n\t\t\t\t\t);\n\t\t\t\t\tglowGradient.addColorStop(0, 'rgba(255,255,255,0.3137)');\n\t\t\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\t\t\tglowGradient.addColorStop(0.5, 'rgba(255,255,255,0.0627)');\n\t\t\t\t\tglowGradient.addColorStop(1, 'rgba(255,255,255,0)');\n\t\t\t\t\tsubRx.drawPath({\n\t\t\t\t\t\tpath: ctx => {\n\t\t\t\t\t\t\tctx.ellipse(x + w / 2, y + h, GlowRX, GlowRY, 0, 0, 2 * Math.PI);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfill: {\n\t\t\t\t\t\t\tstyle: glowGradient,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t\tconst outlineColor = hslColor\n\t\t\t\t.shift(textboxOutlineColorDelta)\n\t\t\t\t.toRgb()\n\t\t\t\t.toCss();\n\t\t\trx.drawPath({\n\t\t\t\tpath: path => {\n\t\t\t\t\troundedRectangle(\n\t\t\t\t\t\tpath,\n\t\t\t\t\t\tx + textboxRoundingBuffer,\n\t\t\t\t\t\ty + textboxRoundingBuffer,\n\t\t\t\t\t\tthis.obj.width - textboxRoundingBuffer * 2,\n\t\t\t\t\t\tthis.obj.height - textboxRoundingBuffer * 2,\n\t\t\t\t\t\ttextboxRounding\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\toutline: {\n\t\t\t\t\tstyle: outlineColor,\n\t\t\t\t\twidth: 3,\n\t\t\t\t},\n\t\t\t});\n\t\t} else if (this.obj.style !== 'none') {\n\t\t\tif (this.obj.style === 'corrupt') {\n\t\t\t\tx += (TextBoxWidth - TextBoxCorruptedWidth) / 2;\n\t\t\t}\n\t\t\tconst image = await getAsset(\n\t\t\t\tthis.obj.style === 'corrupt' ? 'textbox_monika' : 'textbox'\n\t\t\t);\n\t\t\trx.drawImage({ image, x, y });\n\t\t}\n\t}\n\n\tprivate async renderText(\n\t\trx: RenderContext,\n\t\tbaseX: number,\n\t\tbaseY: number,\n\t\tmaxLineWidth: number\n\t): Promise<void> {\n\t\tconst render = new TextRenderer(this.obj.text, {\n\t\t\talpha: 1,\n\t\t\tcolor: '#ffffff',\n\t\t\tfontName: 'aller',\n\t\t\tfontSize: 24,\n\t\t\tisBold: false,\n\t\t\tisItalic: false,\n\t\t\tisStrikethrough: false,\n\t\t\tisUnderlined: false,\n\t\t\tletterSpacing: 0,\n\t\t\tstrokeColor: '#523140',\n\t\t\tstrokeWidth: 4,\n\t\t\tlineSpacing: 1.2,\n\t\t});\n\t\tif (this.obj.autoQuoting && this.obj.talkingDefault !== 'No-one') {\n\t\t\trender.quote();\n\t\t}\n\t\tawait render.loadFonts();\n\n\t\trender.fixAlignment(\n\t\t\t'left',\n\t\t\tbaseX + TextBoxTextXOffset,\n\t\t\t0,\n\t\t\tbaseY + NameboxHeight + TextBoxTextYOffset,\n\t\t\tmaxLineWidth - TextBoxTextXOffset - TextBoxTextXOffset\n\t\t);\n\n\t\trender.render(rx.fsCtx);\n\t}\n}\n","import { HSLAColor } from '@/util/colors/hsl';\nimport { screenHeight } from './base';\nimport { ITextStyle } from '@/renderer/textRenderer/textRenderer';\n\n// tslint:disable: no-magic-numbers\nexport const nameboxTextOutlineDelta = new HSLAColor(\n\t-0.03065134099616873,\n\t-0.5714285714285714,\n\t-0.29607843137254896,\n\t0\n);\n\nexport const ChoiceButtonColor = '#ffe6f4';\nexport const ChoiceButtonBorderColor = '#ffbde1';\nexport const ChoiceButtonWidth = 420;\nexport const ChoiceSpacing = 22;\nexport const ChoiceX = 640;\nexport const ChoiceYOffset = 270;\nexport const ChoicePadding = 7;\n\nexport const ChoiceY = (screenHeight - ChoiceYOffset) / 2;\n\nexport const ChoiceTextStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tfontName: 'aller',\n\tfontSize: 24,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n};\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport { IChoices } from '@/store/objectTypes/choices';\nimport {\n\tChoiceTextStyle,\n\tChoiceButtonBorderColor,\n\tChoiceButtonColor,\n\tChoicePadding,\n\tChoiceSpacing,\n} from '@/constants/choices';\nimport { ObjectRenderable } from './objectRenderable';\n\nexport class Choice extends ObjectRenderable<IChoices> {\n\tprotected readonly scaleable = false;\n\tprotected readonly canvasHeight = screenHeight;\n\tprotected readonly canvasWidth = screenWidth;\n\n\tprivate _height: number = 0;\n\tpublic get height(): number {\n\t\treturn this._height;\n\t}\n\tprotected get centeredVertically(): boolean {\n\t\treturn true;\n\t}\n\n\tprivate choiceRenderers: TextRenderer[] = [];\n\n\tprotected async renderLocal(rx: RenderContext): Promise<void> {\n\t\tawait this.updateChoiceBounds();\n\t\tconsole.log('rerender choice');\n\n\t\tconst w = this.obj.width;\n\t\tconst h = this.height;\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.flip ? screenWidth - this.obj.x : this.obj.x;\n\t\tconst x = baseX - w2;\n\t\tlet y = this.obj.y - h / 2;\n\n\t\tfor (const choiceRenderer of this.choiceRenderers) {\n\t\t\tawait choiceRenderer.loadFonts();\n\t\t\tconst height = choiceRenderer.getHeight(\n\t\t\t\tthis.obj.autoWrap ? this.obj.width : 0\n\t\t\t);\n\t\t\trx.drawRect({\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tw,\n\t\t\t\th: height + ChoicePadding * 2,\n\t\t\t\toutline: {\n\t\t\t\t\tstyle: ChoiceButtonBorderColor,\n\t\t\t\t\twidth: 3,\n\t\t\t\t},\n\t\t\t\tfill: {\n\t\t\t\t\tstyle: ChoiceButtonColor,\n\t\t\t\t},\n\t\t\t});\n\t\t\tchoiceRenderer.fixAlignment(\n\t\t\t\t'center',\n\t\t\t\tx,\n\t\t\t\tx + w,\n\t\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\t\ty + ChoiceSpacing * 1.25,\n\t\t\t\tthis.obj.autoWrap ? w : 0\n\t\t\t);\n\t\t\tchoiceRenderer.render(rx.fsCtx);\n\t\t\ty += height + ChoicePadding * 2 + ChoiceSpacing;\n\t\t}\n\t}\n\n\tprivate async updateChoiceBounds() {\n\t\tthis.choiceRenderers = this.obj.choices.map(\n\t\t\tchoice => new TextRenderer(choice.text || ' ', ChoiceTextStyle)\n\t\t);\n\n\t\tthis._height =\n\t\t\tthis.choiceRenderers.reduce(\n\t\t\t\t(acc, renderer) =>\n\t\t\t\t\tacc +\n\t\t\t\t\trenderer.getHeight(this.obj.autoWrap ? this.obj.width : 0) +\n\t\t\t\t\tChoicePadding * 2,\n\t\t\t\t0\n\t\t\t) +\n\t\t\tthis.obj.choiceDistance * (this.obj.choices.length - 1);\n\t}\n}\n","import { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { BaseTextStyle } from './textBox';\n\n// tslint:disable: no-magic-numbers\nexport const NotificationBackgroundColor = '#ffe6f4';\nexport const NotificationBorderColor = '#ffbde1';\nexport const NotificationBackdropColor = 'rgba(255,255,255,0.6)';\n// export const NotificationMaxWidth = 744;\nexport const NotificationPadding = 40;\nexport const NotificationSpacing = 30;\n\nexport const NotificationOkTextStyle: ITextStyle = {\n\t...BaseTextStyle,\n\tfontName: 'riffic',\n\tfontSize: 24,\n\tstrokeColor: '#bb5599',\n\tstrokeWidth: 8,\n\tletterSpacing: 1,\n\tcolor: 'white',\n};\n\nexport const NotificationTextStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tfontName: 'aller',\n\tfontSize: 24,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1.2,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n};\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport {\n\tChoiceButtonBorderColor,\n\tChoiceButtonColor,\n} from '@/constants/choices';\nimport { INotification } from '@/store/objectTypes/notification';\nimport {\n\tNotificationTextStyle,\n\tNotificationPadding,\n\tNotificationSpacing,\n\tNotificationOkTextStyle,\n\tNotificationBackdropColor,\n} from '@/constants/notification';\nimport { ObjectRenderable } from './objectRenderable';\n\nexport class Notification extends ObjectRenderable<INotification> {\n\tprotected readonly canvasHeight: number = screenHeight;\n\tprotected readonly canvasWidth: number = screenWidth;\n\tprotected scaleable = false;\n\tprivate _height: number = 0;\n\tpublic get height(): number {\n\t\treturn this._height;\n\t}\n\tprivate _width: number = 0;\n\tpublic get width(): number {\n\t\treturn this._width;\n\t}\n\tprotected get centeredVertically(): boolean {\n\t\treturn true;\n\t}\n\n\tpublic updatedContent(): void {}\n\n\tpublic get id() {\n\t\treturn this.obj.id;\n\t}\n\n\tpublic async render(selected: boolean, rx: RenderContext) {\n\t\tif (this.obj.backdrop) {\n\t\t\trx.drawRect({\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tw: screenWidth,\n\t\t\t\th: screenHeight,\n\t\t\t\tfill: {\n\t\t\t\t\tstyle: NotificationBackdropColor,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tawait super.render(selected, rx);\n\t}\n\n\tprotected async renderLocal(rx: RenderContext): Promise<void> {\n\t\tconst textRenderer = new TextRenderer(this.obj.text, NotificationTextStyle);\n\t\tconst buttonRenderer = new TextRenderer('OK', NotificationOkTextStyle);\n\t\tawait textRenderer.loadFonts();\n\t\tawait buttonRenderer.loadFonts();\n\n\t\tconst lineWrap = this.obj.autoWrap\n\t\t\t? this.obj.width - NotificationPadding * 2\n\t\t\t: 0;\n\n\t\tconst textWidth = this.obj.autoWrap ? lineWrap : textRenderer.getWidth();\n\t\tconst textHeight = textRenderer.getHeight(lineWrap);\n\t\tconst buttonWidth = this.obj.autoWrap\n\t\t\t? lineWrap\n\t\t\t: buttonRenderer.getWidth();\n\t\tconst buttonHeight = buttonRenderer.getHeight(lineWrap);\n\n\t\tconst w = (this._width =\n\t\t\tMath.max(textWidth, buttonWidth) + NotificationPadding * 2);\n\t\tconst h = (this._height =\n\t\t\ttextHeight +\n\t\t\tNotificationPadding * 2 +\n\t\t\tNotificationSpacing +\n\t\t\tbuttonHeight);\n\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.flip ? screenWidth - this.obj.x : this.obj.x;\n\t\tconst x = baseX - w2;\n\t\tconst y = this.obj.y - h / 2;\n\n\t\trx.drawRect({\n\t\t\tx,\n\t\t\ty,\n\t\t\tw,\n\t\t\th,\n\t\t\toutline: {\n\t\t\t\tstyle: ChoiceButtonBorderColor,\n\t\t\t\twidth: 3,\n\t\t\t},\n\t\t\tfill: {\n\t\t\t\tstyle: ChoiceButtonColor,\n\t\t\t},\n\t\t});\n\t\ttextRenderer.fixAlignment(\n\t\t\t'center',\n\t\t\tx,\n\t\t\tx + w,\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\ty + NotificationPadding * 1.5,\n\t\t\tlineWrap\n\t\t);\n\t\ttextRenderer.render(rx.fsCtx);\n\t\tbuttonRenderer.fixAlignment(\n\t\t\t'center',\n\t\t\tx,\n\t\t\tx + w,\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\ty + h - NotificationPadding,\n\t\t\tlineWrap\n\t\t);\n\t\tbuttonRenderer.render(rx.fsCtx);\n\t}\n}\n","import { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth, screenHeight } from '@/constants/base';\n\n// tslint:disable: no-magic-numbers\nexport const poemBackgrounds = [\n\t{ name: 'Normal paper', file: 'poem.jpg' },\n\t{ name: 'Lightly soiled paper', file: 'poem_y1.jpg' },\n\t{ name: 'Heavily soiled paper', file: 'poem_y2.jpg' },\n\t{ name: 'Console', file: 'internal:console' },\n\t{ name: 'Transparent', file: 'internal:transparent' },\n];\nexport const defaultPoemBackground = 0;\nexport const defaultPoemStyle = 0;\nexport const defaultX = screenWidth / 2;\nexport const defaultY = screenHeight / 2;\nexport const poemTopPadding = 33;\nexport const poemBottomPadding = 100;\nexport const poemPadding = 30;\nexport const defaultPoemWidth = 800;\nexport const defaultPoemHeight = 720;\n\n//#region Console style\nexport const consoleBackgroundColor = 'rgba(51,51,51,0.75)';\nexport const consoleWidth = 480;\nexport const consoleHeight = 180;\nexport const defaultConsoleBackground = 3;\nexport const defaultConsoleStyle = 7;\n//#endregion Console style\n\nconst BasePoemStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1.2,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n\tfontName: 'aller',\n\tfontSize: 12,\n};\n\nexport interface IPoemTextStyle extends ITextStyle {\n\tname: string;\n}\n\nexport const poemTextStyles: IPoemTextStyle[] = [\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Sayori',\n\t\tfontName: 'hashtag',\n\t\tfontSize: 34,\n\t\tlineSpacing: 1.05,\n\t\tletterSpacing: 0,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Natsuki',\n\t\tfontName: 'ammy_handwriting',\n\t\tfontSize: 28,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Monika',\n\t\tfontName: 'journal',\n\t\tfontSize: 34,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Yuri',\n\t\tfontName: 'jp_hand_slanted',\n\t\tlineSpacing: 1.5,\n\t\tfontSize: 32,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Yuri Act 2',\n\t\tfontName: 'damagrafik_script',\n\t\tfontSize: 18,\n\t\tletterSpacing: -8,\n\t\t// justify: true,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Yuri Unused',\n\t\tfontName: 'as_i_lay_dying',\n\t\tfontSize: 40,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'MC',\n\t\tfontName: 'halogen',\n\t\tfontSize: 30,\n\t\tlineSpacing: 1.53,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Console',\n\t\tfontName: 'f25_bank_printer',\n\t\tfontSize: 18,\n\t\tcolor: 'white',\n\t\tlineSpacing: 1.1,\n\t},\n];\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport {\n\tpoemBackgrounds,\n\tpoemTextStyles,\n\tpoemTopPadding,\n\tpoemPadding,\n\tconsoleBackgroundColor,\n} from '@/constants/poem';\nimport { getAssetByUrl } from '@/asset-manager';\nimport { ObjectRenderable } from './objectRenderable';\n\nconst consolePadding = -2;\nconst consoleTopPadding = 26;\nconst consoleLineWrapPadding = 10;\nconst poemTopMargin = 10;\n\nexport class Poem extends ObjectRenderable<IPoem> {\n\tprotected readonly scaleable = false;\n\tprotected readonly canvasHeight = screenHeight;\n\tprotected readonly canvasWidth = screenWidth;\n\n\tprivate _height: number = 0;\n\tpublic get height(): number {\n\t\treturn this._height;\n\t}\n\n\tprivate _width: number = 0;\n\tpublic get width(): number {\n\t\treturn this._width;\n\t}\n\n\tprotected async renderLocal(rx: RenderContext): Promise<void> {\n\t\tconst paper = poemBackgrounds[this.obj.background];\n\t\tconst flippedX = this.flip ? screenWidth - this.obj.x : this.obj.x;\n\t\tlet y = this.obj.y;\n\t\tlet x = flippedX + poemTopMargin;\n\t\tlet padding = poemPadding;\n\t\tlet topPadding = poemTopPadding;\n\t\tlet lineWrapPadding = padding * 2;\n\n\t\tif (paper.file === 'internal:console') {\n\t\t\tconst h = (this._height = this.obj.height);\n\t\t\tconst w = (this._width = this.obj.width);\n\n\t\t\trx.drawRect({\n\t\t\t\tx: flippedX - w / 2,\n\t\t\t\ty: this.obj.y - h / 2,\n\t\t\t\th,\n\t\t\t\tw,\n\t\t\t\tfill: { style: consoleBackgroundColor },\n\t\t\t});\n\t\t\tpadding = consolePadding;\n\t\t\ttopPadding = consoleTopPadding;\n\t\t\tlineWrapPadding = consoleLineWrapPadding;\n\t\t} else if (paper.file === 'internal:transparent') {\n\t\t\tthis._height = this.obj.height;\n\t\t\tthis._width = this.obj.width;\n\t\t} else {\n\t\t\tconst asset = await getAssetByUrl(`assets/poemBackgrounds/${paper.file}`);\n\t\t\tif (asset instanceof HTMLImageElement) {\n\t\t\t\trx.drawImage({\n\t\t\t\t\timage: asset,\n\t\t\t\t\tx: flippedX - asset.width / 2,\n\t\t\t\t\ty: this.obj.y - asset.height / 2,\n\t\t\t\t});\n\t\t\t\tthis._height = asset.height;\n\t\t\t\tthis._width = asset.width;\n\t\t\t}\n\t\t}\n\t\ty -= this.height / 2;\n\t\tx -= this.width / 2;\n\n\t\tconst style = poemTextStyles[this.obj.font];\n\t\tconst render = new TextRenderer(this.obj.text, style);\n\t\tawait render.loadFonts();\n\n\t\trender.fixAlignment(\n\t\t\t'left',\n\t\t\tx + padding,\n\t\t\tx + padding,\n\t\t\ty + topPadding + padding,\n\t\t\tthis.obj.autoWrap ? this.width - lineWrapPadding : 0\n\t\t);\n\n\t\trender.render(rx.fsCtx);\n\t}\n}\n","import { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport { color, Background, IBackgroundRenderer } from './background';\nimport { IPanel } from '@/store/panels';\nimport { DeepReadonly } from '@/util/readonly';\nimport { ISprite } from '@/store/objectTypes/sprite';\nimport { Sprite } from './sprite';\nimport { Character } from './character';\nimport { ICharacter, getData } from '@/store/objectTypes/characters';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { TextBox } from './textbox';\nimport { Choice } from './choices';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { getAsset } from '@/asset-manager';\nimport { Renderer } from '@/renderer/renderer';\nimport { BackgroundLookup } from '@/store/content';\nimport { IChoices } from '@/store/objectTypes/choices';\nimport { INotification } from '@/store/objectTypes/notification';\nimport { Notification } from '@/renderables/notification';\nimport { Poem } from './poem';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { ObjectRenderable } from './objectRenderable';\nimport { IObject } from '@/store/objects';\n\nexport class SceneRenderer {\n\tprivate renderObjectCache = new Map<string, ObjectRenderable<IObject>>();\n\tprivate state: DeepReadonly<IRootState>;\n\tprivate lCurrentlyRendering = false;\n\tprivate renderer: Renderer;\n\n\tpublic constructor(\n\t\tprivate store: Store<DeepReadonly<IRootState>>,\n\t\tprivate panelId: string,\n\t\treadonly canvasWidth: number,\n\t\treadonly canvasHeight: number\n\t) {\n\t\tthis.state = store.state;\n\t\tthis.renderer = new Renderer(canvasWidth, canvasHeight);\n\t}\n\n\tpublic render(hq: boolean, preview: boolean): Promise<boolean> {\n\t\tif (!this.panel) return Promise.resolve(false);\n\t\treturn this.renderer.render(this.renderCallback.bind(this), hq, preview);\n\t}\n\n\tpublic download(): Promise<string> {\n\t\tconst date = new Date();\n\t\tconst filename = `panel-${[\n\t\t\tdate.getFullYear(),\n\t\t\t`${date.getMonth() + 1}`.padStart(2, '0'),\n\t\t\t`${date.getDate()}`.padStart(2, '0'),\n\t\t\t`${date.getHours()}`.padStart(2, '0'),\n\t\t\t`${date.getMinutes()}`.padStart(2, '0'),\n\t\t\t`${date.getSeconds()}`.padStart(2, '0'),\n\t\t].join('-')}.png`;\n\t\treturn this.renderer.download(this.renderCallback.bind(this), filename);\n\t}\n\n\tpublic get currentlyRendering() {\n\t\treturn this.lCurrentlyRendering;\n\t}\n\n\tpublic paintOnto(\n\t\tc: CanvasRenderingContext2D,\n\t\tx: number,\n\t\ty: number,\n\t\tw?: number,\n\t\th?: number\n\t) {\n\t\tthis.renderer.paintOnto(c, x, y, w, h);\n\t}\n\n\tpublic objectsAt(x: number, y: number): string[] {\n\t\treturn this.getRenderObjects()\n\t\t\t.filter(renderObject => renderObject.hitTest(x, y))\n\t\t\t.map(renderObject => ((renderObject as unknown) as { id: string }).id);\n\t}\n\n\tprivate async renderCallback(rx: RenderContext): Promise<void> {\n\t\tthis.lCurrentlyRendering = true;\n\t\ttry {\n\t\t\tawait this.getBackgroundRenderer()?.render(rx);\n\n\t\t\tconst selection = this.state.ui.selection;\n\t\t\tfor (const object of this.getRenderObjects()) {\n\t\t\t\tlet selected = false;\n\t\t\t\tif (object instanceof ObjectRenderable) {\n\t\t\t\t\tobject.updatedContent(this.store);\n\t\t\t\t\tselected = selection === object.id;\n\t\t\t\t}\n\t\t\t\tawait object.render(selected, rx);\n\t\t\t}\n\t\t\tif (rx.preview) {\n\t\t\t\trx.drawImage({\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tcomposite: 'destination-over',\n\t\t\t\t\timage: await getAsset('backgrounds/transparent'),\n\t\t\t\t});\n\t\t\t}\n\t\t} finally {\n\t\t\tthis.lCurrentlyRendering = false;\n\t\t}\n\t}\n\n\tprivate getRenderObjects() {\n\t\tconst objectsState = this.state.objects.panels[this.panelId];\n\t\tconst order = objectsState\n\t\t\t? [...objectsState.order, ...objectsState.onTopOrder]\n\t\t\t: [];\n\t\tconst objects = this.state.objects.objects;\n\t\tconst toUncache = Object.keys(this.renderObjectCache).filter(\n\t\t\tid => !order.includes(id)\n\t\t);\n\n\t\tfor (const id of toUncache) {\n\t\t\tthis.renderObjectCache.delete(id);\n\t\t}\n\n\t\treturn order.map(id => {\n\t\t\tlet renderObject = this.renderObjectCache.get(id);\n\t\t\tif (!renderObject) {\n\t\t\t\tconst obj = objects[id];\n\t\t\t\tswitch (obj.type) {\n\t\t\t\t\tcase 'sprite':\n\t\t\t\t\t\trenderObject = new Sprite(obj as DeepReadonly<ISprite>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'character':\n\t\t\t\t\t\tconst char = obj as DeepReadonly<ICharacter>;\n\t\t\t\t\t\trenderObject = new Character(char, getData(this.store, char));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'textBox':\n\t\t\t\t\t\trenderObject = new TextBox(obj as DeepReadonly<ITextBox>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'choice':\n\t\t\t\t\t\trenderObject = new Choice(obj as DeepReadonly<IChoices>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'notification':\n\t\t\t\t\t\trenderObject = new Notification(obj as DeepReadonly<INotification>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'poem':\n\t\t\t\t\t\trenderObject = new Poem(obj as DeepReadonly<IPoem>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tthis.renderObjectCache.set(id, renderObject);\n\t\t\t}\n\t\t\treturn renderObject;\n\t\t});\n\t}\n\n\tprivate get panel(): DeepReadonly<IPanel> {\n\t\treturn this.state.panels.panels[this.panelId];\n\t}\n\n\tprivate getBackgroundRenderer(): IBackgroundRenderer | null {\n\t\tconst panel = this.panel;\n\t\tswitch (panel.background.current) {\n\t\t\tcase 'buildin.static-color':\n\t\t\t\tcolor.color = panel.background.color;\n\t\t\t\treturn color;\n\t\t\tdefault:\n\t\t\t\tconst lookup = this.store.getters[\n\t\t\t\t\t'content/getBackgrounds'\n\t\t\t\t] as BackgroundLookup;\n\t\t\t\tconst current = lookup.get(panel.background.current);\n\t\t\t\tif (!current) return null;\n\t\t\t\tconst variant = current.variants[panel.background.variant];\n\t\t\t\tif (!variant) return null;\n\t\t\t\treturn new Background(\n\t\t\t\t\tpanel.background.current,\n\t\t\t\t\tvariant,\n\t\t\t\t\tpanel.background.flipped,\n\t\t\t\t\tpanel.background.scaling\n\t\t\t\t);\n\t\t}\n\t}\n}\n","\nimport { PanelMixin } from './panelMixin';\nimport {\n\tIDuplicatePanelAction,\n\tISetCurrentPanelMutation,\n\tIDeletePanelAction,\n\tISetPanelPreviewMutation,\n\tIMovePanelAction,\n} from '@/store/panels';\nimport { isWebPSupported, isHeifSupported } from '@/asset-manager';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { SceneRenderer } from '@/renderables/scene-renderer';\nimport { DeepReadonly } from '@/util/readonly';\nimport environment from '@/environments/environment';\nimport eventBus, { ShowMessageEvent } from '@/eventbus/event-bus';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport { IObject } from '@/store/objects';\nimport { INotification } from '@/store/objectTypes/notification';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { IChoices } from '@/store/objectTypes/choices';\nimport { defineComponent } from 'vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DButton from '@/components/ui/d-button.vue';\n\ninterface IPanelButton {\n\tid: string;\n\timage: string;\n\ttext: string;\n}\n\n// tslint:disable: no-magic-numbers\nconst estimateFactor = 1.5;\nconst thumbnailFactor = 1 / 4;\nconst thumbnailQuality = 0.5;\nconst qualityFactor = 100;\n\nconst defaultQuality = 90;\n\nconst qualityWarningThreshold = 70;\n// tslint:enable: no-magic-numbers\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DFieldset, DFlow, DButton },\n\tdata: () => ({\n\t\twebpSupport: false,\n\t\theifSupport: false,\n\t\tppi: 0,\n\t\tpages: '',\n\t\tformat: 'image/png',\n\t\tquality: defaultQuality,\n\t}),\n\tcomputed: {\n\t\tcurrentPanel(): string {\n\t\t\treturn this.$store.state.panels.currentPanel;\n\t\t},\n\n\t\tisLossy(): boolean {\n\t\t\treturn this.format !== 'image/png';\n\t\t},\n\n\t\tcanDeletePanel(): boolean {\n\t\t\treturn this.panelButtons.length > 1;\n\t\t},\n\n\t\tpanelButtons(): IPanelButton[] {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\treturn panelOrder.map(id => {\n\t\t\t\tconst panel = this.$store.state.panels.panels[id];\n\t\t\t\tconst objectOrders = this.$store.state.objects.panels[id];\n\t\t\t\tconst txtBox = objectOrders\n\t\t\t\t\t? ([] as string[])\n\t\t\t\t\t\t\t.concat(objectOrders.order, objectOrders.onTopOrder)\n\t\t\t\t\t\t\t.map(objId => this.$store.state.objects.objects[objId])\n\t\t\t\t\t\t\t.map(this.extractObjectText)\n\t\t\t\t\t: [];\n\t\t\t\treturn {\n\t\t\t\t\tid,\n\t\t\t\t\timage: panel.lastRender,\n\t\t\t\t\ttext: txtBox.reduce(\n\t\t\t\t\t\t(acc, current) => (acc.length > current.length ? acc : current),\n\t\t\t\t\t\t''\n\t\t\t\t\t),\n\t\t\t\t} as IPanelButton;\n\t\t\t});\n\t\t},\n\n\t\tcanMoveAhead(): boolean {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\tconst idx = panelOrder.indexOf(this.currentPanel);\n\t\t\treturn idx > 0;\n\t\t},\n\n\t\tcanMoveBehind(): boolean {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\tconst idx = panelOrder.indexOf(this.currentPanel);\n\t\t\treturn idx < panelOrder.length - 1;\n\t\t},\n\t},\n\tasync created() {\n\t\t[this.webpSupport, this.heifSupport] = await Promise.all([\n\t\t\tisWebPSupported(),\n\t\t\tisHeifSupported(),\n\t\t]);\n\t},\n\tasync mounted() {\n\t\tthis.moveFocusToActivePanel();\n\n\t\tconst sceneRenderer = new SceneRenderer(\n\t\t\tthis.$store,\n\t\t\tthis.currentPanel,\n\t\t\tscreenWidth,\n\t\t\tscreenHeight\n\t\t);\n\n\t\tawait sceneRenderer.render(false, true);\n\n\t\tconst targetCanvas = document.createElement('canvas');\n\t\ttargetCanvas.width = screenWidth * thumbnailFactor;\n\t\ttargetCanvas.height = screenHeight * thumbnailFactor;\n\n\t\tsceneRenderer.paintOnto(\n\t\t\ttargetCanvas.getContext('2d')!,\n\t\t\t0,\n\t\t\t0,\n\t\t\ttargetCanvas.width,\n\t\t\ttargetCanvas.height\n\t\t);\n\t\ttargetCanvas.toBlob(\n\t\t\tblob => {\n\t\t\t\tif (!blob) return;\n\t\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setPanelPreview', {\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t\turl,\n\t\t\t\t\t} as ISetPanelPreviewMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t\t(await isWebPSupported()) ? 'image/webp' : 'image/jpeg',\n\t\t\tthumbnailQuality\n\t\t);\n\t},\n\tmethods: {\n\t\tasync download() {\n\t\t\tconst distribution = this.getPanelDistibution();\n\t\t\tconst date = new Date();\n\t\t\tconst prefix = `cd-${[\n\t\t\t\tdate.getFullYear(),\n\t\t\t\t`${date.getMonth() + 1}`.padStart(2, '0'),\n\t\t\t\t`${date.getDate()}`.padStart(2, '0'),\n\t\t\t\t`${date.getHours()}`.padStart(2, '0'),\n\t\t\t\t`${date.getMinutes()}`.padStart(2, '0'),\n\t\t\t\t`${date.getSeconds()}`.padStart(2, '0'),\n\t\t\t].join('-')}`;\n\t\t\tconst extension = this.format.split('/')[1];\n\t\t\tconst format = this.format;\n\t\t\tconst quality = this.quality;\n\t\t\tawait this.renderObjects(\n\t\t\t\tdistribution,\n\t\t\t\ttrue,\n\t\t\t\tasync (imageIdx: number, canvas: HTMLCanvasElement) => {\n\t\t\t\t\tenvironment.saveToFile(\n\t\t\t\t\t\tcanvas,\n\t\t\t\t\t\t`${prefix}_${imageIdx}.${extension}`,\n\t\t\t\t\t\tformat,\n\t\t\t\t\t\tquality / qualityFactor\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tasync estimateExportSize() {\n\t\t\tconst distribution = this.getPanelDistibution();\n\t\t\tconst format = this.format || 'image/png';\n\t\t\tconst quality = this.quality || defaultQuality;\n\t\t\tconst sizes = await this.renderObjects(\n\t\t\t\tdistribution,\n\t\t\t\tfalse,\n\t\t\t\tasync (imageIdx: number, canvas: HTMLCanvasElement) => {\n\t\t\t\t\treturn new Promise<number>((resolve, reject) => {\n\t\t\t\t\t\tcanvas.toBlob(\n\t\t\t\t\t\t\tblob => {\n\t\t\t\t\t\t\t\tif (!blob) {\n\t\t\t\t\t\t\t\t\treject(`Image ${imageIdx + 1} could not be rendered.`);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresolve(blob.size);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tformat,\n\t\t\t\t\t\t\tquality / qualityFactor\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t\tconst readableSizes = sizes.map(\n\t\t\t\tsize => ((size * estimateFactor) / 1024 / 1024).toFixed(2) + 'MiB'\n\t\t\t);\n\t\t\tconst filePluralize = readableSizes.length > 1 ? 'files' : 'file';\n\t\t\tconst itPluralize = readableSizes.length > 1 ? 'These' : 'It';\n\t\t\tconst sizePluralize = readableSizes.length > 1 ? 'sizes' : 'size';\n\t\t\teventBus.fire(\n\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t`This would export ${\n\t\t\t\t\t\treadableSizes.length\n\t\t\t\t\t} ${filePluralize}. ${itPluralize} would have the following (aproximate) ${sizePluralize}: ${readableSizes.join(\n\t\t\t\t\t\t','\n\t\t\t\t\t)}`\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\tasync renderObjects<T>(\n\t\t\tdistribution: DeepReadonly<string[][]>,\n\t\t\thq: boolean,\n\t\t\tmapper: (imageIdx: number, canvas: HTMLCanvasElement) => Promise<T>\n\t\t): Promise<T[]> {\n\t\t\treturn await Promise.all(\n\t\t\t\tdistribution.map(async (image, imageIdx) => {\n\t\t\t\t\tconst targetCanvas = document.createElement('canvas');\n\t\t\t\t\ttargetCanvas.width = screenWidth;\n\t\t\t\t\ttargetCanvas.height = screenHeight * image.length;\n\t\t\t\t\tconst context = targetCanvas.getContext('2d')!;\n\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\timage.map(async (panelId, panelIdx) => {\n\t\t\t\t\t\t\tconst sceneRenderer = new SceneRenderer(\n\t\t\t\t\t\t\t\tthis.$store,\n\t\t\t\t\t\t\t\timage[panelIdx],\n\t\t\t\t\t\t\t\tscreenWidth,\n\t\t\t\t\t\t\t\tscreenHeight\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tawait sceneRenderer.render(hq, false);\n\n\t\t\t\t\t\t\tsceneRenderer.paintOnto(\n\t\t\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\tscreenHeight * panelIdx,\n\t\t\t\t\t\t\t\tscreenWidth,\n\t\t\t\t\t\t\t\tscreenHeight\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t\treturn await mapper(imageIdx, targetCanvas);\n\t\t\t\t})\n\t\t\t);\n\t\t},\n\t\tgetLimitedPanelList(): DeepReadonly<string[]> {\n\t\t\tconst max = this.$store.state.panels.panelOrder.length - 1;\n\t\t\tconst min = 0;\n\t\t\tconst parts = this.pages.split(',');\n\t\t\tconst listedPages: number[] = [];\n\t\t\tlet foundMatch = false;\n\n\t\t\tfor (const part of parts) {\n\t\t\t\tconst trimmedPart = part.trim();\n\t\t\t\tconst match = trimmedPart.match(/^\\s*((\\d+)|(\\d+)\\s*-\\s*(\\d+))\\s*$/);\n\t\t\t\tif (!match) {\n\t\t\t\t\tif (trimmedPart !== '') {\n\t\t\t\t\t\teventBus.fire(\n\t\t\t\t\t\t\tnew ShowMessageEvent(`Could not read '${part}' in the page list.`)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfoundMatch = true;\n\t\t\t\tif (match[2]) listedPages.push(parseInt(match[2], 10) - 1);\n\t\t\t\telse {\n\t\t\t\t\tconst from = Math.max(parseInt(match[3], 10) - 1, min);\n\t\t\t\t\tconst to = Math.min(parseInt(match[4], 10) - 1, max);\n\t\t\t\t\tif (from === undefined || to === undefined || from > to) continue;\n\t\t\t\t\tfor (let i = from; i <= to; ++i) {\n\t\t\t\t\t\tlistedPages.push(i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!foundMatch) {\n\t\t\t\treturn this.$store.state.panels.panelOrder;\n\t\t\t}\n\n\t\t\treturn listedPages\n\t\t\t\t.sort((a, b) => a - b)\n\t\t\t\t.filter((value, idx, ary) => ary[idx - 1] !== value)\n\t\t\t\t.map(pageIdx => this.$store.state.panels.panelOrder[pageIdx]);\n\t\t},\n\t\tgetPanelDistibution(): DeepReadonly<string[][]> {\n\t\t\tconst panelOrder = this.getLimitedPanelList();\n\t\t\tif (this.ppi === 0) return [panelOrder];\n\t\t\tconst images: string[][] = [];\n\t\t\tfor (let imageI = 0; imageI < panelOrder.length / this.ppi; ++imageI) {\n\t\t\t\tconst sliceStart = imageI * this.ppi;\n\t\t\t\tconst sliceEnd = sliceStart + this.ppi;\n\t\t\t\timages.push([...panelOrder.slice(sliceStart, sliceEnd)]);\n\t\t\t}\n\t\t\treturn images;\n\t\t},\n\t\tmoveFocusToActivePanel() {\n\t\t\tconst active = this.$el.querySelector('.panel_button.active');\n\t\t\tif (active) {\n\t\t\t\tthis.scrollIntoView(active);\n\t\t\t}\n\t\t},\n\t\tscrollIntoView(ele: Element) {\n\t\t\tconst parent = ele.parentElement!.parentElement!;\n\t\t\tconst idx = Array.from(ele.parentElement!.children).indexOf(ele);\n\t\t\tif (this.$store.state.ui.vertical) {\n\t\t\t\tconst scroll =\n\t\t\t\t\tidx * ele.clientHeight -\n\t\t\t\t\tparent.clientHeight / 2 +\n\t\t\t\t\tele.clientHeight / 2;\n\t\t\t\tparent.scrollTop = scroll;\n\t\t\t\tparent.scrollLeft = 0;\n\t\t\t} else {\n\t\t\t\tconst scroll =\n\t\t\t\t\tidx * ele.clientWidth - parent.clientWidth / 2 + ele.clientWidth / 2;\n\t\t\t\tparent.scrollLeft = scroll;\n\t\t\t\tparent.scrollTop = 0;\n\t\t\t}\n\t\t},\n\t\textractObjectText(obj: DeepReadonly<IObject>) {\n\t\t\tswitch (obj.type) {\n\t\t\t\tcase 'textBox':\n\t\t\t\t\treturn (obj as ITextBox).text;\n\t\t\t\tcase 'notification':\n\t\t\t\t\treturn (obj as INotification).text;\n\t\t\t\tcase 'poem':\n\t\t\t\t\treturn (obj as IPoem).text;\n\t\t\t\tcase 'choice':\n\t\t\t\t\treturn (obj as IChoices).choices\n\t\t\t\t\t\t.map(choice => `[${choice.text}]`)\n\t\t\t\t\t\t.join('\\n');\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\tasync addNewPanel() {\n\t\t\tawait this.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('panels/duplicatePanel', {\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as IDuplicatePanelAction);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tupdateCurrentPanel(panelId: string) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.commit('panels/setCurrentPanel', {\n\t\t\t\t\tpanelId,\n\t\t\t\t} as ISetCurrentPanelMutation);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tdeletePanel() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('panels/delete', {\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as IDeletePanelAction);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tmoveAhead() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/move', {\n\t\t\t\t\tpanelId: this.currentPanel,\n\t\t\t\t\tdelta: -1,\n\t\t\t\t} as IMovePanelAction);\n\t\t\t});\n\t\t},\n\t\tmoveBehind() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/move', {\n\t\t\t\t\tpanelId: this.currentPanel,\n\t\t\t\t\tdelta: 1,\n\t\t\t\t} as IMovePanelAction);\n\t\t\t});\n\t\t},\n\t},\n\twatch: {\n\t\tquality(quality: number, oldQuality: number) {\n\t\t\tif (quality === qualityFactor) {\n\t\t\t\teventBus.fire(\n\t\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t\t'Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression.'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (\n\t\t\t\toldQuality > qualityWarningThreshold &&\n\t\t\t\tquality <= qualityWarningThreshold\n\t\t\t) {\n\t\t\t\teventBus.fire(\n\t\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t\t'Note: A quality level below 70% might be very noticable and impair legibility of text.'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t},\n\t},\n});\n","import { render } from \"./panels.vue?vue&type=template&id=71818f1a&scoped=true&bindings={}\"\nimport script from \"./panels.vue?vue&type=script&lang=ts\"\nexport * from \"./panels.vue?vue&type=script&lang=ts\"\n\nimport \"./panels.vue?vue&type=style&index=0&id=71818f1a&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-71818f1a\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>Notification</h1>\n\t\t<text-editor\n\t\t\tv-if=\"textEditor\"\n\t\t\ttitle=\"Notification Text\"\n\t\t\tv-model=\"text\"\n\t\t\t@leave=\"textEditor = false\"\n\t\t/>\n\t\t<image-options\n\t\t\tv-else-if=\"imageOptionsOpen\"\n\t\t\ttype=\"object\"\n\t\t\ttitle=\"Notification\"\n\t\t\t:id=\"object.id\"\n\t\t\t@leave=\"imageOptionsOpen = false\"\n\t\t/>\n\t\t<template v-else>\n\t\t\t<div id=\"notification_text\">\n\t\t\t\t<label for=\"notification_text\">Text:</label>\n\t\t\t\t<textarea v-model=\"text\" id=\"notification_text\" @keydown.stop />\n\t\t\t\t<button @click=\"textEditor = true\">Formatting</button>\n\t\t\t</div>\n\t\t\t<position-and-size :obj=\"object\" />\n\t\t\t<toggle label=\"Auto line wrap?\" v-model=\"autoWrap\" />\n\t\t\t<layers :object=\"object\" />\n\t\t\t<toggle v-model=\"flip\" label=\"Flip?\" />\n\t\t\t<toggle v-model=\"renderBackdrop\" label=\"Show backdrop?\" />\n\t\t\t<button @click=\"imageOptionsOpen = true\">Image options</button>\n\t\t\t<delete :obj=\"object\" />\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport { PanelMixin } from './panelMixin';\nimport TextEditor from '../subtools/text/text.vue';\nimport { INotification } from '../../../store/objectTypes/notification';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<INotification>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tTextEditor,\n\t\tImageOptions,\n\t},\n\tdata: () => ({\n\t\timageOptionsOpen: false,\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): INotification {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'notification') return undefined!;\n\t\t\treturn obj as INotification;\n\t\t},\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\ttext: setable('text', 'objects/setNotificationText'),\n\t\trenderBackdrop: setable('backdrop', 'objects/setNotificationBackdrop'),\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\nfieldset {\n\t> .list {\n\t\t* {\n\t\t\toverflow: hidden;\n\t\t\twidth: 100%;\n\t\t\theight: 24px;\n\t\t\ttext-overflow: ellipsis;\n\t\t\tpadding: 2px;\n\n\t\t\t&.active {\n\t\t\t\tbackground-color: #ffbde1;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.current_button {\n\tinput {\n\t\twidth: 145px;\n\t}\n}\n\n.panel {\n\t&.vertical {\n\t\t#notification_text {\n\t\t\twidth: 173px;\n\n\t\t\ttextarea {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\tfieldset.buttons {\n\t\t\twidth: 100%;\n\n\t\t\t> .list {\n\t\t\t\tmax-height: 200px;\n\t\t\t\twidth: 172px;\n\n\t\t\t\t* {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\t\tpadding: 2px;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\ttextarea {\n\t\tdisplay: block;\n\t\theight: 114px;\n\t}\n}\n\n.panel:not(.vertical) {\n\t.list {\n\t\tmax-height: 140px;\n\t\tmax-width: 172px;\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport { PanelMixin } from './panelMixin';\nimport TextEditor from '../subtools/text/text.vue';\nimport { INotification } from '../../../store/objectTypes/notification';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<INotification>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tTextEditor,\n\t\tImageOptions,\n\t},\n\tdata: () => ({\n\t\timageOptionsOpen: false,\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): INotification {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'notification') return undefined!;\n\t\t\treturn obj as INotification;\n\t\t},\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\ttext: setable('text', 'objects/setNotificationText'),\n\t\trenderBackdrop: setable('backdrop', 'objects/setNotificationBackdrop'),\n\t},\n});\n","import { render } from \"./notification.vue?vue&type=template&id=88ed25a2&scoped=true&bindings={}\"\nimport script from \"./notification.vue?vue&type=script&lang=ts\"\nexport * from \"./notification.vue?vue&type=script&lang=ts\"\n\nimport \"./notification.vue?vue&type=style&index=0&id=88ed25a2&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-88ed25a2\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>{{ object.subType === 'poem' ? 'Poem' : 'Console' }}</h1>\n\t\t<text-editor\n\t\t\tv-if=\"textEditor\"\n\t\t\ttitle=\"Poem Text\"\n\t\t\tv-model=\"text\"\n\t\t\t@leave=\"textEditor = false\"\n\t\t/>\n\t\t<image-options\n\t\t\tv-else-if=\"imageOptionsOpen\"\n\t\t\ttype=\"object\"\n\t\t\t:title=\"object.subType === 'poem' ? 'Poem' : 'Console'\"\n\t\t\t:id=\"object.id\"\n\t\t\t@leave=\"imageOptionsOpen = false\"\n\t\t/>\n\t\t<template v-else>\n\t\t\t<div id=\"notification_text\">\n\t\t\t\t<label for=\"notification_text\">Text:</label>\n\t\t\t\t<textarea v-model=\"text\" id=\"notification_text\" @keydown.stop />\n\t\t\t\t<button @click=\"textEditor = true\">Formatting</button>\n\t\t\t</div>\n\t\t\t<toggle label=\"Auto line wrap?\" v-model=\"autoWrap\" />\n\t\t\t<template v-if=\"object.subType === 'poem'\">\n\t\t\t\t<select v-model=\"poemBackground\" @keydown.stop>\n\t\t\t\t\t<option\n\t\t\t\t\t\tv-for=\"(background, idx) of backgrounds\"\n\t\t\t\t\t\t:value=\"idx\"\n\t\t\t\t\t\t:key=\"idx\"\n\t\t\t\t\t\t>{{ background.name }}</option\n\t\t\t\t\t>\n\t\t\t\t</select>\n\t\t\t\t<select v-model=\"poemStyle\" @keydown.stop>\n\t\t\t\t\t<option\n\t\t\t\t\t\tv-for=\"(style, idx) of poemTextStyles\"\n\t\t\t\t\t\t:value=\"idx\"\n\t\t\t\t\t\t:key=\"idx\"\n\t\t\t\t\t\t>{{ style.name }}</option\n\t\t\t\t\t>\n\t\t\t\t</select>\n\t\t\t</template>\n\t\t\t<position-and-size :obj=\"object\" />\n\t\t\t<layers :object=\"object\" />\n\t\t\t<toggle v-model=\"flip\" label=\"Flip?\" />\n\t\t\t<button @click=\"imageOptionsOpen = true\">Image options</button>\n\t\t\t<delete :obj=\"object\" />\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport { PanelMixin } from './panelMixin';\nimport TextEditor from '../subtools/text/text.vue';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport {\n\tpoemBackgrounds,\n\tpoemTextStyles,\n\tIPoemTextStyle,\n} from '@/constants/poem';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<IPoem>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tTextEditor,\n\t\tImageOptions,\n\t},\n\tdata: () => ({\n\t\ttextEditor: false,\n\t\timageOptionsOpen: false,\n\t}),\n\tcomputed: {\n\t\tbackgrounds(): Array<{ name: string; file: string }> {\n\t\t\treturn poemBackgrounds;\n\t\t},\n\t\tpoemTextStyles(): IPoemTextStyle[] {\n\t\t\treturn poemTextStyles;\n\t\t},\n\t\tobject(): IPoem {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'poem') return undefined!;\n\t\t\treturn obj as IPoem;\n\t\t},\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\ttext: setable('text', 'objects/setPoemText'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\tpoemStyle: setable('font', 'objects/setPoemFont'),\n\t\tpoemBackground: setable('background', 'objects/setPoemBackground'),\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\nfieldset {\n\t> .list {\n\t\t* {\n\t\t\toverflow: hidden;\n\t\t\twidth: 100%;\n\t\t\theight: 24px;\n\t\t\ttext-overflow: ellipsis;\n\t\t\tpadding: 2px;\n\n\t\t\t&.active {\n\t\t\t\tbackground-color: #ffbde1;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.current_button {\n\tinput {\n\t\twidth: 145px;\n\t}\n}\n\n.panel {\n\t&.vertical {\n\t\t#notification_text {\n\t\t\twidth: 173px;\n\n\t\t\ttextarea {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\tfieldset.buttons {\n\t\t\twidth: 100%;\n\n\t\t\t> .list {\n\t\t\t\tmax-height: 200px;\n\t\t\t\twidth: 172px;\n\n\t\t\t\t* {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\t\tpadding: 2px;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\ttextarea {\n\t\tdisplay: block;\n\t\theight: 114px;\n\t}\n}\n\n.panel:not(.vertical) {\n\t.list {\n\t\tmax-height: 140px;\n\t\tmax-width: 172px;\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport { PanelMixin } from './panelMixin';\nimport TextEditor from '../subtools/text/text.vue';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport {\n\tpoemBackgrounds,\n\tpoemTextStyles,\n\tIPoemTextStyle,\n} from '@/constants/poem';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<IPoem>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tTextEditor,\n\t\tImageOptions,\n\t},\n\tdata: () => ({\n\t\ttextEditor: false,\n\t\timageOptionsOpen: false,\n\t}),\n\tcomputed: {\n\t\tbackgrounds(): Array<{ name: string; file: string }> {\n\t\t\treturn poemBackgrounds;\n\t\t},\n\t\tpoemTextStyles(): IPoemTextStyle[] {\n\t\t\treturn poemTextStyles;\n\t\t},\n\t\tobject(): IPoem {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'poem') return undefined!;\n\t\t\treturn obj as IPoem;\n\t\t},\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\ttext: setable('text', 'objects/setPoemText'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\tpoemStyle: setable('font', 'objects/setPoemFont'),\n\t\tpoemBackground: setable('background', 'objects/setPoemBackground'),\n\t},\n});\n","import { render } from \"./poem.vue?vue&type=template&id=51b46526&scoped=true&bindings={}\"\nimport script from \"./poem.vue?vue&type=script&lang=ts\"\nexport * from \"./poem.vue?vue&type=script&lang=ts\"\n\nimport \"./poem.vue?vue&type=style&index=0&id=51b46526&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-51b46526\"\n\nexport default script","\nimport SettingsPanel from './tools/settings.vue';\nimport AddPanel from './tools/add.vue';\nimport CharacterPanel from './tools/character.vue';\nimport SpritePanel from './tools/sprite.vue';\nimport TextBoxPanel from './tools/textbox.vue';\nimport ChoicePanel from './tools/choice.vue';\nimport CreditsPanel from './tools/credits.vue';\nimport BackgroundsPanel from './tools/backgrounds.vue';\nimport ContentPacksPanel from './tools/content-pack.vue';\nimport PanelsPanel from './tools/panels.vue';\nimport NotificationPanel from './tools/notification.vue';\nimport PoemPanel from './tools/poem.vue';\nimport { IObject, ObjectTypes } from '@/store/objects';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\ntype PanelNames =\n\t| 'add'\n\t| 'backgrounds'\n\t| 'help_credits'\n\t| 'selection'\n\t| 'packs'\n\t| 'settings'\n\t| 'panels'\n\t| 'notification'\n\t| 'poem';\n\nexport default defineComponent({\n\tcomponents: {\n\t\tSettingsPanel,\n\t\tAddPanel,\n\t\tBackgroundsPanel,\n\t\tCreditsPanel,\n\t\tCharacterPanel,\n\t\tTextBoxPanel,\n\t\tChoicePanel,\n\t\tSpritePanel,\n\t\tContentPacksPanel,\n\t\tPanelsPanel,\n\t\tNotificationPanel,\n\t\tPoemPanel,\n\t},\n\tdata: () => ({\n\t\tpanelSelection: 'add' as PanelNames,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tselection(): string | null {\n\t\t\treturn this.$store.state.ui.selection;\n\t\t},\n\t\tpanel(): PanelNames | ObjectTypes {\n\t\t\tif (this.panelSelection === 'selection') {\n\t\t\t\tif (this.selection === null) {\n\t\t\t\t\t// eslint-disable-next-line vue/no-side-effects-in-computed-properties\n\t\t\t\t\tthis.panelSelection = 'add';\n\t\t\t\t} else {\n\t\t\t\t\tconst obj = this.$store.state.objects.objects[this.selection];\n\t\t\t\t\treturn obj.type;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this.panelSelection;\n\t\t},\n\t\thasPrevRender(): boolean {\n\t\t\treturn this.$store.state.ui.lastDownload !== null;\n\t\t},\n\t},\n\tmethods: {\n\t\tcreate() {\n\t\t\tenvironment.onPanelChange((panel: string) => {\n\t\t\t\tthis.panelSelection = panel as PanelNames;\n\t\t\t});\n\t\t},\n\t\tsetPanel(name: PanelNames) {\n\t\t\tif (name === this.panelSelection) name = 'add';\n\t\t\tthis.panelSelection = name;\n\t\t\tif (this.selection) {\n\t\t\t\tif (this.$store.state.ui.selection === null) return;\n\t\t\t\tthis.$store.commit('ui/setSelection', null);\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tselection(newSelection: IObject | null) {\n\t\t\tif (newSelection) {\n\t\t\t\tthis.panelSelection = 'selection';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.panelSelection === 'selection') {\n\t\t\t\tthis.panelSelection = 'add';\n\t\t\t}\n\t\t},\n\t},\n});\n","import { render } from \"./toolbox.vue?vue&type=template&id=bae0d784&bindings={}\"\nimport script from \"./toolbox.vue?vue&type=script&lang=ts\"\nexport * from \"./toolbox.vue?vue&type=script&lang=ts\"\n\nimport \"./toolbox.vue?vue&type=style&index=0&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n\t<div id=\"messageConsole\" :class=\"{ vertical }\">\n\t\t<p v-if=\"showLoading\">Loading...</p>\n\t\t<p v-for=\"(message, i) in messages\" :key=\"message + '_' + i\">\n\t\t\t{{ message }}\n\t\t</p>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport EventBus, {\n\tAssetFailureEvent,\n\tCustomAssetFailureEvent,\n\tShowMessageEvent,\n\tVueErrorEvent,\n} from '@/eventbus/event-bus';\nimport { defineComponent } from 'vue';\n\nconst shortHidingTime = 5000;\nconst longHidingTime = 20000;\nconst hideShowTimeouts = 100;\n\nexport default defineComponent({\n\tprops: {\n\t\tloading: {\n\t\t\tdefault: false,\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tmessages: [] as string[],\n\t\tshowLoading: false,\n\t\tshowLoadingTimeout: 0,\n\t\thideLoadingTimeout: 0,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.onLoadingChange(this.loading);\n\t\tEventBus.subscribe(AssetFailureEvent, ev => {\n\t\t\tthis.messages.push(`Failed to load asset '${ev.path}'`);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, shortHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(CustomAssetFailureEvent, ev => {\n\t\t\tthis.messages.push(\n\t\t\t\t'Failed to load custom asset. Try to download it manually and then upload it.'\n\t\t\t);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(ShowMessageEvent, ev => {\n\t\t\tthis.messages.push(ev.message);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(VueErrorEvent, ev => {\n\t\t\tthis.messages.push(ev.error.name);\n\t\t\tthis.messages.push(JSON.stringify(ev.error.stack));\n\t\t\tthis.messages.push(ev.info);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t\tthis.messages.shift();\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\t},\n\n\tmethods: {\n\t\tonLoadingChange(newValue: boolean) {\n\t\t\tif (newValue) {\n\t\t\t\tif (this.hideLoadingTimeout) {\n\t\t\t\t\tclearTimeout(this.hideLoadingTimeout);\n\t\t\t\t\tthis.hideLoadingTimeout = 0;\n\t\t\t\t}\n\t\t\t\tif (!this.showLoading && !this.showLoadingTimeout) {\n\t\t\t\t\tthis.showLoadingTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.showLoading = true;\n\t\t\t\t\t\tthis.showLoadingTimeout = 0;\n\t\t\t\t\t}, hideShowTimeouts);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.showLoadingTimeout) {\n\t\t\t\t\tclearTimeout(this.showLoadingTimeout);\n\t\t\t\t\tthis.showLoadingTimeout = 0;\n\t\t\t\t}\n\t\t\t\tif (this.showLoading && !this.hideLoadingTimeout) {\n\t\t\t\t\tthis.hideLoadingTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.showLoading = false;\n\t\t\t\t\t\tthis.hideLoadingTimeout = 0;\n\t\t\t\t\t}, hideShowTimeouts);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\n\twatch: {\n\t\tloading(newValue: boolean) {\n\t\t\tthis.onLoadingChange(newValue);\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n#messageConsole {\n\tfont-family: monospace;\n\ttext-shadow: 0px 0px 4px #ffffff;\n\tposition: absolute;\n\n\t&.vertical {\n\t\tright: 200px;\n\t\ttop: 0;\n\t}\n\n\t&:not(.vertical) {\n\t\tbottom: 200px;\n\t\tleft: 0;\n\t}\n}\n</style>\n","\nimport EventBus, {\n\tAssetFailureEvent,\n\tCustomAssetFailureEvent,\n\tShowMessageEvent,\n\tVueErrorEvent,\n} from '@/eventbus/event-bus';\nimport { defineComponent } from 'vue';\n\nconst shortHidingTime = 5000;\nconst longHidingTime = 20000;\nconst hideShowTimeouts = 100;\n\nexport default defineComponent({\n\tprops: {\n\t\tloading: {\n\t\t\tdefault: false,\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tmessages: [] as string[],\n\t\tshowLoading: false,\n\t\tshowLoadingTimeout: 0,\n\t\thideLoadingTimeout: 0,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.onLoadingChange(this.loading);\n\t\tEventBus.subscribe(AssetFailureEvent, ev => {\n\t\t\tthis.messages.push(`Failed to load asset '${ev.path}'`);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, shortHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(CustomAssetFailureEvent, ev => {\n\t\t\tthis.messages.push(\n\t\t\t\t'Failed to load custom asset. Try to download it manually and then upload it.'\n\t\t\t);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(ShowMessageEvent, ev => {\n\t\t\tthis.messages.push(ev.message);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(VueErrorEvent, ev => {\n\t\t\tthis.messages.push(ev.error.name);\n\t\t\tthis.messages.push(JSON.stringify(ev.error.stack));\n\t\t\tthis.messages.push(ev.info);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t\tthis.messages.shift();\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\t},\n\n\tmethods: {\n\t\tonLoadingChange(newValue: boolean) {\n\t\t\tif (newValue) {\n\t\t\t\tif (this.hideLoadingTimeout) {\n\t\t\t\t\tclearTimeout(this.hideLoadingTimeout);\n\t\t\t\t\tthis.hideLoadingTimeout = 0;\n\t\t\t\t}\n\t\t\t\tif (!this.showLoading && !this.showLoadingTimeout) {\n\t\t\t\t\tthis.showLoadingTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.showLoading = true;\n\t\t\t\t\t\tthis.showLoadingTimeout = 0;\n\t\t\t\t\t}, hideShowTimeouts);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.showLoadingTimeout) {\n\t\t\t\t\tclearTimeout(this.showLoadingTimeout);\n\t\t\t\t\tthis.showLoadingTimeout = 0;\n\t\t\t\t}\n\t\t\t\tif (this.showLoading && !this.hideLoadingTimeout) {\n\t\t\t\t\tthis.hideLoadingTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.showLoading = false;\n\t\t\t\t\t\tthis.hideLoadingTimeout = 0;\n\t\t\t\t\t}, hideShowTimeouts);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\n\twatch: {\n\t\tloading(newValue: boolean) {\n\t\t\tthis.onLoadingChange(newValue);\n\t\t},\n\t},\n});\n","import { render } from \"./message-console.vue?vue&type=template&id=51633a54&scoped=true&bindings={}\"\nimport script from \"./message-console.vue?vue&type=script&lang=ts\"\nexport * from \"./message-console.vue?vue&type=script&lang=ts\"\n\nimport \"./message-console.vue?vue&type=style&index=0&id=51633a54&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-51633a54\"\n\nexport default script","<template>\n\t<canvas\n\t\tid=\"scaled_display\"\n\t\tref=\"sd\"\n\t\t:height=\"bitmapHeight\"\n\t\t:width=\"bitmapWidth\"\n\t\t:style=\"{ width: canvasWidth + 'px', height: canvasHeight + 'px' }\"\n\t\tdraggable=\"true\"\n\t\t@click=\"onUiClick\"\n\t\t@touchstart=\"onTouchStart\"\n\t\t@dragstart=\"onDragStart\"\n\t\t@touchmove=\"onSpriteDragMove\"\n\t\t@mousemove=\"onSpriteDragMove\"\n\t\t@touchend=\"onSpriteDrop\"\n\t\t@mouseup=\"onSpriteDrop\"\n\t\t@dragover=\"onDragOver\"\n\t\t@drop=\"onDrop\"\n\t\t@mouseenter=\"onMouseEnter\"\n\t\t>HTML5 is required to use the Doki Doki Dialog Generator.</canvas\n\t>\n</template>\n\n<script lang=\"ts\">\nimport { MutationPayload } from 'vuex';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { registerAsset } from '@/asset-manager';\nimport eventBus, { InvalidateRenderEvent } from '@/eventbus/event-bus';\nimport { IObject, ISetObjectPositionMutation } from '@/store/objects';\nimport { ICreateSpriteAction } from '@/store/objectTypes/sprite';\nimport { SceneRenderer } from '../renderables/scene-renderer';\nimport { DeepReadonly } from '../util/readonly';\nimport { screenHeight, screenWidth } from '@/constants/base';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tcanvasWidth: { default: 0 },\n\t\tcanvasHeight: { default: 0 },\n\t},\n\tdata: () => ({\n\t\tsdCtx: null! as CanvasRenderingContext2D,\n\t\tcurrentlyRendering: false,\n\t\tqueuedRender: null as null | number,\n\t\tshowingLast: false,\n\t\tdropSpriteCount: 0,\n\t\tdropPreventClick: false,\n\n\t\tdraggedObject: null as DeepReadonly<IObject> | null,\n\t\tdragXOffset: 0,\n\t\tdragYOffset: 0,\n\t\tdragXOriginal: 0,\n\t\tdragYOriginal: 0,\n\t}),\n\tcomputed: {\n\t\tselection(): string | null {\n\t\t\treturn this.$store.state.ui.selection;\n\t\t},\n\t\tlqRendering(): boolean {\n\t\t\treturn this.$store.state.ui.lqRendering;\n\t\t},\n\t\tsceneRender(): SceneRenderer {\n\t\t\treturn new SceneRenderer(\n\t\t\t\tthis.$store,\n\t\t\t\tthis.$store.state.panels.currentPanel,\n\t\t\t\tthis.bitmapWidth,\n\t\t\t\tthis.bitmapHeight\n\t\t\t);\n\t\t},\n\t\tbitmapHeight(): number {\n\t\t\treturn screenHeight;\n\t\t},\n\t\tbitmapWidth(): number {\n\t\t\treturn screenWidth;\n\t\t},\n\t},\n\tmethods: {\n\t\tasync download(): Promise<void> {\n\t\t\tconst url = await this.sceneRender.download();\n\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tconst oldUrl = this.$store.state.ui.lastDownload;\n\n\t\t\t\tthis.$store.commit('ui/setLastDownload', url);\n\t\t\t\tif (oldUrl) {\n\t\t\t\t\tURL.revokeObjectURL(oldUrl);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tinvalidateRender() {\n\t\t\tif (this.queuedRender) return;\n\t\t\tthis.queuedRender = requestAnimationFrame(() => this.render_());\n\t\t},\n\t\tasync render_(): Promise<void> {\n\t\t\tif (this.queuedRender) {\n\t\t\t\tcancelAnimationFrame(this.queuedRender);\n\t\t\t\tthis.queuedRender = null;\n\t\t\t}\n\n\t\t\tif (this.$store.state.unsafe) return;\n\n\t\t\tawait this.sceneRender.render(!this.lqRendering, true);\n\t\t\tthis.display();\n\t\t},\n\t\trenderLoadingScreen() {\n\t\t\tif (!this.sdCtx) return;\n\t\t\tconst loadingScreen = document.createElement('canvas');\n\t\t\tloadingScreen.height = this.bitmapHeight;\n\t\t\tloadingScreen.width = this.bitmapWidth;\n\t\t\tconst rctx = new RenderContext(\n\t\t\t\tloadingScreen.getContext('2d')!,\n\t\t\t\ttrue,\n\t\t\t\tfalse\n\t\t\t);\n\t\t\trctx.drawText({\n\t\t\t\ttext: 'Starting...',\n\t\t\t\tx: loadingScreen.width / 2,\n\t\t\t\ty: loadingScreen.height / 2,\n\t\t\t\talign: 'center',\n\t\t\t\toutline: {\n\t\t\t\t\twidth: 5,\n\t\t\t\t\tstyle: '#b59',\n\t\t\t\t},\n\t\t\t\tfont: '32px riffic',\n\t\t\t\tfill: {\n\t\t\t\t\tstyle: 'white',\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.sdCtx!.drawImage(loadingScreen, this.canvasWidth, this.canvasHeight);\n\t\t},\n\t\tdisplay(): void {\n\t\t\tif (!this.sdCtx) return;\n\t\t\tthis.showingLast = false;\n\t\t\tthis.sceneRender.paintOnto(\n\t\t\t\tthis.sdCtx,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tthis.bitmapWidth,\n\t\t\t\tthis.bitmapHeight\n\t\t\t);\n\t\t},\n\t\ttoRendererCoordinate(x: number, y: number): [number, number] {\n\t\t\tconst sd = this.$refs.sd as HTMLCanvasElement;\n\t\t\tconst rx = x - sd.offsetLeft;\n\t\t\tconst ry = y - sd.offsetTop;\n\t\t\tconst sx = (rx / sd.offsetWidth) * sd.width;\n\t\t\tconst sy = (ry / sd.offsetWidth) * sd.width;\n\t\t\treturn [sx, sy];\n\t\t},\n\t\tonUiClick(e: MouseEvent): void {\n\t\t\tif (this.dropPreventClick) {\n\t\t\t\tthis.dropPreventClick = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [sx, sy] = this.toRendererCoordinate(e.clientX, e.clientY);\n\n\t\t\tconst objects = this.sceneRender.objectsAt(sx, sy);\n\n\t\t\tconst currentObjectIdx = objects.findIndex(id => id === this.selection);\n\t\t\tlet selectedObject: string | null;\n\n\t\t\tif (currentObjectIdx === 0) {\n\t\t\t\tselectedObject = null;\n\t\t\t} else if (currentObjectIdx !== -1) {\n\t\t\t\t// Select the next lower character\n\t\t\t\tselectedObject = objects[currentObjectIdx - 1];\n\t\t\t} else {\n\t\t\t\tselectedObject = objects[objects.length - 1] || null;\n\t\t\t}\n\n\t\t\tif (this.$store.state.ui.selection === selectedObject) return;\n\t\t\tthis.$store.commit('ui/setSelection', selectedObject);\n\t\t},\n\t\tonDragStart(e: DragEvent) {\n\t\t\te.preventDefault();\n\t\t\tif (!this.selection) return;\n\t\t\tthis.draggedObject = this.$store.state.objects.objects[this.selection];\n\t\t\tconst [x, y] = this.toRendererCoordinate(e.clientX, e.clientY);\n\t\t\tthis.dragXOffset = x - this.draggedObject.x;\n\t\t\tthis.dragYOffset = y - this.draggedObject.y;\n\t\t\tthis.dragXOriginal = this.draggedObject.x;\n\t\t\tthis.dragYOriginal = this.draggedObject.y;\n\t\t},\n\t\tonTouchStart(e: TouchEvent) {\n\t\t\tif (!this.selection) return;\n\t\t\tthis.draggedObject = this.$store.state.objects.objects[this.selection];\n\t\t\tconst [x, y] = this.toRendererCoordinate(\n\t\t\t\te.touches[0].clientX,\n\t\t\t\te.touches[0].clientY\n\t\t\t);\n\t\t\tthis.dragXOffset = x - this.draggedObject.x;\n\t\t\tthis.dragYOffset = y - this.draggedObject.y;\n\t\t\tthis.dragXOriginal = this.draggedObject.x;\n\t\t\tthis.dragYOriginal = this.draggedObject.y;\n\t\t},\n\t\tonDragOver(e: DragEvent) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\te.dataTransfer!.dropEffect = 'copy';\n\t\t},\n\t\tonSpriteDragMove(e: MouseEvent | TouchEvent) {\n\t\t\tif (this.draggedObject) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\t// Formatter quirk\n\t\t\t\t// tslint:disable:indent\n\t\t\t\tlet [x, y] =\n\t\t\t\t\te instanceof MouseEvent\n\t\t\t\t\t\t? this.toRendererCoordinate(e.clientX, e.clientY)\n\t\t\t\t\t\t: this.toRendererCoordinate(\n\t\t\t\t\t\t\t\te.touches[0].clientX,\n\t\t\t\t\t\t\t\te.touches[0].clientY\n\t\t\t\t\t\t  );\n\t\t\t\t// tslint:enable:indent\n\t\t\t\tx -= this.dragXOffset;\n\t\t\t\ty -= this.dragYOffset;\n\n\t\t\t\tconst deltaX = Math.abs(x - this.dragXOriginal);\n\t\t\t\tconst deltaY = Math.abs(y - this.dragYOriginal);\n\n\t\t\t\tif (deltaX + deltaY > 1) this.dropPreventClick = true;\n\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tif (deltaX > deltaY) {\n\t\t\t\t\t\ty = this.dragYOriginal;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tx = this.dragXOriginal;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\t\tid: this.draggedObject!.id,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tasync onDrop(e: DragEvent) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (!e.dataTransfer) return;\n\n\t\t\tfor (const item of e.dataTransfer.items) {\n\t\t\t\tif (item.kind === 'file' && item.type.match(/image.*/)) {\n\t\t\t\t\tconst name = 'dropCustomAsset' + ++this.dropSpriteCount;\n\t\t\t\t\tconst url = registerAsset(name, item.getAsFile()!);\n\n\t\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\t\tawait this.$store.dispatch('objects/createSprite', {\n\t\t\t\t\t\t\tassets: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\thq: url,\n\t\t\t\t\t\t\t\t\tlq: url,\n\t\t\t\t\t\t\t\t\tsourcePack: 'dddg.generated.uploaded-sprites',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t} as ICreateSpriteAction);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonSpriteDrop(e: MouseEvent | TouchEvent) {\n\t\t\tif (this.draggedObject) {\n\t\t\t\tif ('TouchEvent' in window && e instanceof TouchEvent) {\n\t\t\t\t\tthis.dropPreventClick = false;\n\t\t\t\t}\n\t\t\t\tthis.draggedObject = null;\n\t\t\t}\n\t\t},\n\t\tonMouseEnter(e: MouseEvent) {\n\t\t\tif (e.buttons !== 1) {\n\t\t\t\tthis.draggedObject = null;\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tcanvasWidth() {\n\t\t\tthis.display();\n\t\t},\n\t\tcanvasHeight() {\n\t\t\tthis.display();\n\t\t},\n\t},\n\tasync created(): Promise<void> {\n\t\teventBus.subscribe(InvalidateRenderEvent, () => this.invalidateRender());\n\t\tthis.$store.subscribe((mut: MutationPayload) => {\n\t\t\tif (mut.type === 'panels/setPanelPreview') return;\n\t\t\tif (mut.type === 'panels/currentPanel') return;\n\t\t\tthis.invalidateRender();\n\t\t});\n\t},\n\tmounted(): void {\n\t\tconst sd = this.$refs.sd as HTMLCanvasElement;\n\t\tthis.sdCtx = sd.getContext('2d')!;\n\n\t\tthis.renderLoadingScreen();\n\t\tthis.invalidateRender();\n\t},\n});\n</script>\n\n<style lang=\"scss\"></style>\n","\nimport { MutationPayload } from 'vuex';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { registerAsset } from '@/asset-manager';\nimport eventBus, { InvalidateRenderEvent } from '@/eventbus/event-bus';\nimport { IObject, ISetObjectPositionMutation } from '@/store/objects';\nimport { ICreateSpriteAction } from '@/store/objectTypes/sprite';\nimport { SceneRenderer } from '../renderables/scene-renderer';\nimport { DeepReadonly } from '../util/readonly';\nimport { screenHeight, screenWidth } from '@/constants/base';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tcanvasWidth: { default: 0 },\n\t\tcanvasHeight: { default: 0 },\n\t},\n\tdata: () => ({\n\t\tsdCtx: null! as CanvasRenderingContext2D,\n\t\tcurrentlyRendering: false,\n\t\tqueuedRender: null as null | number,\n\t\tshowingLast: false,\n\t\tdropSpriteCount: 0,\n\t\tdropPreventClick: false,\n\n\t\tdraggedObject: null as DeepReadonly<IObject> | null,\n\t\tdragXOffset: 0,\n\t\tdragYOffset: 0,\n\t\tdragXOriginal: 0,\n\t\tdragYOriginal: 0,\n\t}),\n\tcomputed: {\n\t\tselection(): string | null {\n\t\t\treturn this.$store.state.ui.selection;\n\t\t},\n\t\tlqRendering(): boolean {\n\t\t\treturn this.$store.state.ui.lqRendering;\n\t\t},\n\t\tsceneRender(): SceneRenderer {\n\t\t\treturn new SceneRenderer(\n\t\t\t\tthis.$store,\n\t\t\t\tthis.$store.state.panels.currentPanel,\n\t\t\t\tthis.bitmapWidth,\n\t\t\t\tthis.bitmapHeight\n\t\t\t);\n\t\t},\n\t\tbitmapHeight(): number {\n\t\t\treturn screenHeight;\n\t\t},\n\t\tbitmapWidth(): number {\n\t\t\treturn screenWidth;\n\t\t},\n\t},\n\tmethods: {\n\t\tasync download(): Promise<void> {\n\t\t\tconst url = await this.sceneRender.download();\n\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tconst oldUrl = this.$store.state.ui.lastDownload;\n\n\t\t\t\tthis.$store.commit('ui/setLastDownload', url);\n\t\t\t\tif (oldUrl) {\n\t\t\t\t\tURL.revokeObjectURL(oldUrl);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tinvalidateRender() {\n\t\t\tif (this.queuedRender) return;\n\t\t\tthis.queuedRender = requestAnimationFrame(() => this.render_());\n\t\t},\n\t\tasync render_(): Promise<void> {\n\t\t\tif (this.queuedRender) {\n\t\t\t\tcancelAnimationFrame(this.queuedRender);\n\t\t\t\tthis.queuedRender = null;\n\t\t\t}\n\n\t\t\tif (this.$store.state.unsafe) return;\n\n\t\t\tawait this.sceneRender.render(!this.lqRendering, true);\n\t\t\tthis.display();\n\t\t},\n\t\trenderLoadingScreen() {\n\t\t\tif (!this.sdCtx) return;\n\t\t\tconst loadingScreen = document.createElement('canvas');\n\t\t\tloadingScreen.height = this.bitmapHeight;\n\t\t\tloadingScreen.width = this.bitmapWidth;\n\t\t\tconst rctx = new RenderContext(\n\t\t\t\tloadingScreen.getContext('2d')!,\n\t\t\t\ttrue,\n\t\t\t\tfalse\n\t\t\t);\n\t\t\trctx.drawText({\n\t\t\t\ttext: 'Starting...',\n\t\t\t\tx: loadingScreen.width / 2,\n\t\t\t\ty: loadingScreen.height / 2,\n\t\t\t\talign: 'center',\n\t\t\t\toutline: {\n\t\t\t\t\twidth: 5,\n\t\t\t\t\tstyle: '#b59',\n\t\t\t\t},\n\t\t\t\tfont: '32px riffic',\n\t\t\t\tfill: {\n\t\t\t\t\tstyle: 'white',\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.sdCtx!.drawImage(loadingScreen, this.canvasWidth, this.canvasHeight);\n\t\t},\n\t\tdisplay(): void {\n\t\t\tif (!this.sdCtx) return;\n\t\t\tthis.showingLast = false;\n\t\t\tthis.sceneRender.paintOnto(\n\t\t\t\tthis.sdCtx,\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tthis.bitmapWidth,\n\t\t\t\tthis.bitmapHeight\n\t\t\t);\n\t\t},\n\t\ttoRendererCoordinate(x: number, y: number): [number, number] {\n\t\t\tconst sd = this.$refs.sd as HTMLCanvasElement;\n\t\t\tconst rx = x - sd.offsetLeft;\n\t\t\tconst ry = y - sd.offsetTop;\n\t\t\tconst sx = (rx / sd.offsetWidth) * sd.width;\n\t\t\tconst sy = (ry / sd.offsetWidth) * sd.width;\n\t\t\treturn [sx, sy];\n\t\t},\n\t\tonUiClick(e: MouseEvent): void {\n\t\t\tif (this.dropPreventClick) {\n\t\t\t\tthis.dropPreventClick = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [sx, sy] = this.toRendererCoordinate(e.clientX, e.clientY);\n\n\t\t\tconst objects = this.sceneRender.objectsAt(sx, sy);\n\n\t\t\tconst currentObjectIdx = objects.findIndex(id => id === this.selection);\n\t\t\tlet selectedObject: string | null;\n\n\t\t\tif (currentObjectIdx === 0) {\n\t\t\t\tselectedObject = null;\n\t\t\t} else if (currentObjectIdx !== -1) {\n\t\t\t\t// Select the next lower character\n\t\t\t\tselectedObject = objects[currentObjectIdx - 1];\n\t\t\t} else {\n\t\t\t\tselectedObject = objects[objects.length - 1] || null;\n\t\t\t}\n\n\t\t\tif (this.$store.state.ui.selection === selectedObject) return;\n\t\t\tthis.$store.commit('ui/setSelection', selectedObject);\n\t\t},\n\t\tonDragStart(e: DragEvent) {\n\t\t\te.preventDefault();\n\t\t\tif (!this.selection) return;\n\t\t\tthis.draggedObject = this.$store.state.objects.objects[this.selection];\n\t\t\tconst [x, y] = this.toRendererCoordinate(e.clientX, e.clientY);\n\t\t\tthis.dragXOffset = x - this.draggedObject.x;\n\t\t\tthis.dragYOffset = y - this.draggedObject.y;\n\t\t\tthis.dragXOriginal = this.draggedObject.x;\n\t\t\tthis.dragYOriginal = this.draggedObject.y;\n\t\t},\n\t\tonTouchStart(e: TouchEvent) {\n\t\t\tif (!this.selection) return;\n\t\t\tthis.draggedObject = this.$store.state.objects.objects[this.selection];\n\t\t\tconst [x, y] = this.toRendererCoordinate(\n\t\t\t\te.touches[0].clientX,\n\t\t\t\te.touches[0].clientY\n\t\t\t);\n\t\t\tthis.dragXOffset = x - this.draggedObject.x;\n\t\t\tthis.dragYOffset = y - this.draggedObject.y;\n\t\t\tthis.dragXOriginal = this.draggedObject.x;\n\t\t\tthis.dragYOriginal = this.draggedObject.y;\n\t\t},\n\t\tonDragOver(e: DragEvent) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\te.dataTransfer!.dropEffect = 'copy';\n\t\t},\n\t\tonSpriteDragMove(e: MouseEvent | TouchEvent) {\n\t\t\tif (this.draggedObject) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\t// Formatter quirk\n\t\t\t\t// tslint:disable:indent\n\t\t\t\tlet [x, y] =\n\t\t\t\t\te instanceof MouseEvent\n\t\t\t\t\t\t? this.toRendererCoordinate(e.clientX, e.clientY)\n\t\t\t\t\t\t: this.toRendererCoordinate(\n\t\t\t\t\t\t\t\te.touches[0].clientX,\n\t\t\t\t\t\t\t\te.touches[0].clientY\n\t\t\t\t\t\t  );\n\t\t\t\t// tslint:enable:indent\n\t\t\t\tx -= this.dragXOffset;\n\t\t\t\ty -= this.dragYOffset;\n\n\t\t\t\tconst deltaX = Math.abs(x - this.dragXOriginal);\n\t\t\t\tconst deltaY = Math.abs(y - this.dragYOriginal);\n\n\t\t\t\tif (deltaX + deltaY > 1) this.dropPreventClick = true;\n\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tif (deltaX > deltaY) {\n\t\t\t\t\t\ty = this.dragYOriginal;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tx = this.dragXOriginal;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\t\tid: this.draggedObject!.id,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tasync onDrop(e: DragEvent) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (!e.dataTransfer) return;\n\n\t\t\tfor (const item of e.dataTransfer.items) {\n\t\t\t\tif (item.kind === 'file' && item.type.match(/image.*/)) {\n\t\t\t\t\tconst name = 'dropCustomAsset' + ++this.dropSpriteCount;\n\t\t\t\t\tconst url = registerAsset(name, item.getAsFile()!);\n\n\t\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\t\tawait this.$store.dispatch('objects/createSprite', {\n\t\t\t\t\t\t\tassets: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\thq: url,\n\t\t\t\t\t\t\t\t\tlq: url,\n\t\t\t\t\t\t\t\t\tsourcePack: 'dddg.generated.uploaded-sprites',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t} as ICreateSpriteAction);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonSpriteDrop(e: MouseEvent | TouchEvent) {\n\t\t\tif (this.draggedObject) {\n\t\t\t\tif ('TouchEvent' in window && e instanceof TouchEvent) {\n\t\t\t\t\tthis.dropPreventClick = false;\n\t\t\t\t}\n\t\t\t\tthis.draggedObject = null;\n\t\t\t}\n\t\t},\n\t\tonMouseEnter(e: MouseEvent) {\n\t\t\tif (e.buttons !== 1) {\n\t\t\t\tthis.draggedObject = null;\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tcanvasWidth() {\n\t\t\tthis.display();\n\t\t},\n\t\tcanvasHeight() {\n\t\t\tthis.display();\n\t\t},\n\t},\n\tasync created(): Promise<void> {\n\t\teventBus.subscribe(InvalidateRenderEvent, () => this.invalidateRender());\n\t\tthis.$store.subscribe((mut: MutationPayload) => {\n\t\t\tif (mut.type === 'panels/setPanelPreview') return;\n\t\t\tif (mut.type === 'panels/currentPanel') return;\n\t\t\tthis.invalidateRender();\n\t\t});\n\t},\n\tmounted(): void {\n\t\tconst sd = this.$refs.sd as HTMLCanvasElement;\n\t\tthis.sdCtx = sd.getContext('2d')!;\n\n\t\tthis.renderLoadingScreen();\n\t\tthis.invalidateRender();\n\t},\n});\n","import { render } from \"./render.vue?vue&type=template&id=290e0c24&bindings={}\"\nimport script from \"./render.vue?vue&type=script&lang=ts\"\nexport * from \"./render.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n\t<div class=\"dialog-wrapper\" @click=\"$emit('leave')\">\n\t\t<dialog open @click.stop>\n\t\t\t<slot />\n\t\t</dialog>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({});\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped lang=\"scss\">\n.dialog-wrapper {\n\tposition: absolute;\n\ttop: 0;\n\tbottom: 0;\n\tright: 0;\n\tleft: 0;\n\tbackground: rgba($color: #000000, $alpha: 0.5);\n\tdisplay: flex;\n\ttransition: all 0.15s;\n}\n\ndialog {\n\twidth: 860px;\n\theight: 860px;\n\tmax-width: 90vw;\n\tmax-height: 90vh;\n\tbackground-attachment: scroll;\n\tbackground-color: #ffffff;\n\tbackground-position: right center;\n\tbackground-repeat: no-repeat;\n\tbackground-size: contain;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-self: center;\n\toverflow: hidden;\n\tpadding: 0;\n\tborder: 4px solid #ffbde1;\n\toverflow: hidden;\n\talign-self: center;\n\tjustify-self: center;\n\tmargin: auto;\n}\n</style>\n","\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({});\n","import { render } from \"./ModalDialog.vue?vue&type=template&id=7f2c764e&scoped=true&bindings={}\"\nimport script from \"./ModalDialog.vue?vue&type=script&lang=ts\"\nexport * from \"./ModalDialog.vue?vue&type=script&lang=ts\"\n\nimport \"./ModalDialog.vue?vue&type=style&index=0&id=7f2c764e&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-7f2c764e\"\n\nexport default script","\n// App.vue has currently so many responsiblities that it's best to break it into chunks\nimport { ICreateTextBoxAction } from '@/store/objectTypes/textbox';\nimport {\n\tISetObjectPositionMutation,\n\tIRemoveObjectAction,\n} from '@/store/objects';\nimport {\n\tIShiftCharacterSlotAction,\n\tICharacter,\n} from '@/store/objectTypes/characters';\nimport ToolBox from '@/components/toolbox/toolbox.vue';\nimport MessageConsole from '@/components/message-console.vue';\nimport Render from '@/components/render.vue';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport { ISetCurrentMutation } from '@/store/panels';\nimport { defineAsyncComponent, defineComponent } from 'vue';\n\n// tslint:disable-next-line: no-magic-numbers\nconst aspectRatio = 16 / 9;\nconst arrowMoveStepSize = 20;\nconst packDialogWaitMs = 50;\nconst canvasTooSmallThreshold = 200;\n\nexport default defineComponent({\n\tcomponents: {\n\t\tToolBox,\n\t\tMessageConsole,\n\t\tRender,\n\t\tModalDialog,\n\t\tSingleBox: defineAsyncComponent(() =>\n\t\t\timport('@/components/repo/layouts/SingleBox.vue')\n\t\t),\n\t\tExpressionBuilder: defineAsyncComponent(() =>\n\t\t\timport('@/components/content-pack-builder/expression-builder/index.vue')\n\t\t),\n\t},\n\tdata: () => ({\n\t\tcanvasWidth: 0,\n\t\tcanvasHeight: 0,\n\t\tblendOver: null as string | null,\n\t\tuiSize: 192,\n\t\tcurrentlyRendering: false,\n\t\tpanel: '',\n\t\tdialogVisable: false,\n\t\tcanvasTooSmall: false,\n\t\texpressionBuilderVisible: false,\n\t\texpressionBuilderCharacter: '',\n\t\texpressionBuilderHeadGroup: undefined as string | undefined,\n\t}),\n\tcomputed: {\n\t\tisSafari(): boolean {\n\t\t\treturn false;\n\t\t\t/*\t\treturn !!(\n\t\t\tnavigator.vendor &&\n\t\t\tnavigator.vendor.indexOf('Apple') > -1 &&\n\t\t\tnavigator.userAgent &&\n\t\t\tnavigator.userAgent.indexOf('CriOS') === -1 &&\n\t\t\tnavigator.userAgent.indexOf('FxiOS') === -1\n\t\t);*/\n\t\t},\n\t},\n\tmethods: {\n\t\tdrawLastDownload(): void {\n\t\t\tconst last = this.$store.state.ui.lastDownload;\n\t\t\tif (!last) return;\n\t\t\t(this.$refs.render as typeof Render).blendOver(last);\n\t\t},\n\t\tsetBlendOver(): void {\n\t\t\tthis.blendOver = this.$store.state.ui.lastDownload;\n\t\t},\n\t\toptimum(sw: number, sh: number): [number, number] {\n\t\t\tlet rh = sw / aspectRatio;\n\t\t\tlet rw = sh * aspectRatio;\n\n\t\t\tif (rh > sh) {\n\t\t\t\trh = sh;\n\t\t\t} else {\n\t\t\t\trw = sw;\n\t\t\t}\n\n\t\t\treturn [rw, rh];\n\t\t},\n\t\toptimizeWithMenu(sw: number, sh: number): [number, number, boolean] {\n\t\t\tconst opth = this.optimum(sw, sh - this.uiSize);\n\t\t\tconst optv = this.optimum(sw - this.uiSize, sh);\n\n\t\t\tif (!this.isSafari && opth[0] * opth[1] > optv[0] * optv[1]) {\n\t\t\t\treturn [opth[0], opth[1], false];\n\t\t\t} else {\n\t\t\t\treturn [optv[0], optv[1], true];\n\t\t\t}\n\t\t},\n\t\tupdateArea(): void {\n\t\t\tconst [cw, ch, v] = this.optimizeWithMenu(\n\t\t\t\tdocument.documentElement.clientWidth,\n\t\t\t\tdocument.documentElement.clientHeight\n\t\t\t);\n\n\t\t\tthis.canvasWidth = cw;\n\t\t\tthis.canvasHeight = ch;\n\n\t\t\tthis.canvasTooSmall = Math.max(cw, ch) < canvasTooSmallThreshold;\n\n\t\t\tif (this.$store.state.ui.vertical === v) return;\n\t\t\tthis.$store.commit('ui/setVertical', v);\n\t\t},\n\t\tshowDialog(search: string | undefined) {\n\t\t\tthis.dialogVisable = true;\n\t\t\tif (search) {\n\t\t\t\tconst wait = () => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.$refs.packDialog &&\n\t\t\t\t\t\t(this.$refs.packDialog as any).$refs.packDialog\n\t\t\t\t\t) {\n\t\t\t\t\t\t// This strange doubling is to get around the async component wrapper\n\t\t\t\t\t\t(this.$refs.packDialog as any).$refs.packDialog.setSearch(search);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetTimeout(wait, packDialogWaitMs);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.$nextTick(wait);\n\t\t\t}\n\t\t},\n\t\tshowExpressionDialog(e: IShowExpressionDialogEvent) {\n\t\t\tthis.expressionBuilderVisible = true;\n\t\t\tthis.expressionBuilderCharacter = e.character;\n\t\t\tthis.expressionBuilderHeadGroup = e.headGroup;\n\t\t},\n\t\tonKeydown(e: KeyboardEvent) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tconst selection = this.$store.state.objects.objects[\n\t\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t\t];\n\t\t\t\tif (!selection) return;\n\t\t\t\tif (e.key === 'Delete') {\n\t\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t} as IRemoveObjectAction);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (e.key === 'z' && e.ctrlKey) {\n\t\t\t\t\t// this.$store.commit('history/undo');\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t} else if (e.key === 'y' && e.ctrlKey) {\n\t\t\t\t\t// this.$store.commit('history/redo');\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (selection.type === 'character') {\n\t\t\t\t\tconst character = selection as ICharacter;\n\t\t\t\t\tif (character.freeMove) {\n\t\t\t\t\t\tif (e.key === 'ArrowLeft') {\n\t\t\t\t\t\t\tthis.$store.dispatch('objects/shiftCharacterSlot', {\n\t\t\t\t\t\t\t\tid: character.id,\n\t\t\t\t\t\t\t\tdelta: -1,\n\t\t\t\t\t\t\t} as IShiftCharacterSlotAction);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (e.key === 'ArrowRight') {\n\t\t\t\t\t\t\tthis.$store.dispatch('objects/shiftCharacterSlot', {\n\t\t\t\t\t\t\t\tid: character.id,\n\t\t\t\t\t\t\t\tdelta: 1,\n\t\t\t\t\t\t\t} as IShiftCharacterSlotAction);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet { x, y } = selection;\n\t\t\t\tif (e.key === 'ArrowLeft') {\n\t\t\t\t\tx -= e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowRight') {\n\t\t\t\t\tx += e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowUp') {\n\t\t\t\t\ty -= e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowDown') {\n\t\t\t\t\ty += e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\tid: selection.id,\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tdestroyed(): void {\n\t\t\twindow.removeEventListener('keydown', this.onKeydown);\n\t\t},\n\t},\n\tmounted(): void {\n\t\twindow.addEventListener('keypress', e => {\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tif (this.$store.state.ui.selection === null) return;\n\t\t\t\t\tthis.$store.commit('ui/setSelection', null);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\tasync created(): Promise<void> {\n\t\t// Moving this to the \"mounted\"-handler crashes safari over version 12.\n\t\t// My best guess is because it runs in a microtask, which have been added in that Version.\n\t\tthis.updateArea();\n\t\twindow.addEventListener('resize', this.updateArea);\n\t\twindow.removeEventListener('keydown', this.onKeydown);\n\t\twindow.addEventListener('keydown', this.onKeydown);\n\n\t\t(window as any).app = this;\n\t\t(window as any).store = this.$store;\n\n\t\tdocument.body.addEventListener(\n\t\t\t'drop',\n\t\t\t(event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t\tdocument.body.addEventListener(\n\t\t\t'dragover',\n\t\t\t(event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\tthis.vuexHistory.transaction(async () => {\n\t\t\tawait this.$store.dispatch('content/loadContentPacks', [\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.backgrounds.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.monika.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.sayori.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.natsuki.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.yuri.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc_chad.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc_classic.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.femc.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.classic_amy.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.amy.json`,\n\t\t\t]);\n\n\t\t\tawait this.$store.dispatch('panels/createPanel');\n\t\t\tif (Object.keys(this.$store.state.objects.objects).length === 0) {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createTextBox',\n\t\t\t\t\t{} as ICreateTextBoxAction\n\t\t\t\t);\n\t\t\t}\n\t\t\tawait this.$store.commit('panels/setCurrentBackground', {\n\t\t\t\tcurrent: 'dddg.buildin.backgrounds:ddlc.clubroom',\n\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t} as ISetCurrentMutation);\n\t\t});\n\t},\n});\n\nexport interface IShowExpressionDialogEvent {\n\tcharacter: string;\n\theadGroup?: string;\n}\n","import { render } from \"./App.vue?vue&type=template&id=78bd1126&bindings={}\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&lang=scss\"\nscript.render = render\n\nexport default script","import { ICommand } from '@/eventbus/command';\nimport { getAAsset } from '@/asset-manager';\nimport { IObjectsState, ICreateObjectMutation, IObject } from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { IRootState } from '..';\nimport { IAsset } from '../content';\n\nexport interface ISprite extends IObject {\n\ttype: 'sprite';\n\tassets: IAsset[];\n}\n\nexport const spriteMutations: MutationTree<IObjectsState> = {};\n\nlet lastSpriteId = 0;\n\nexport const spriteActions: ActionTree<IObjectsState, IRootState> = {\n\tasync createSprite(\n\t\t{ state, commit, rootState },\n\t\tcommand: ICreateSpriteAction\n\t) {\n\t\tconst asset = await getAAsset(command.assets[0], false);\n\t\tif (!(asset instanceof HTMLImageElement)) return;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\tassets: command.assets,\n\t\t\t\tflip: false,\n\t\t\t\theight: asset.height,\n\t\t\t\twidth: asset.width,\n\t\t\t\tid: 'sprite_' + ++lastSpriteId,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tonTop: false,\n\t\t\t\topacity: 100,\n\t\t\t\tpreserveRatio: true,\n\t\t\t\tratio: asset.width / asset.height,\n\t\t\t\ttype: 'sprite',\n\t\t\t\tversion: 0,\n\t\t\t\tx: 640,\n\t\t\t\ty: 0,\n\t\t\t\tcomposite: 'source-over',\n\t\t\t\tfilters: [],\n\t\t\t} as ISprite,\n\t\t} as ICreateObjectMutation);\n\t},\n};\n\nexport interface ICreateSpriteAction extends ICommand {\n\treadonly assets: IAsset[];\n}\n","import { ICommand } from '@/eventbus/command';\nimport { IObjectsState, ICreateObjectMutation, IObject } from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { TextBoxWidth, TextBoxHeight } from '@/constants/textBox';\nimport { IRootState } from '..';\nimport {\n\tChoiceSpacing,\n\tChoiceButtonColor,\n\tChoiceY,\n\tChoiceButtonWidth,\n} from '@/constants/choices';\nimport { ISetAutoWrappingMutation } from './textbox';\n\nexport interface IChoice {\n\ttext: string;\n\tselected: boolean;\n}\n\nexport interface IChoices extends IObject {\n\ttype: 'choice';\n\tcustomColor: string;\n\tchoices: IChoice[];\n\tchoiceDistance: number;\n\tautoWrap: boolean;\n}\n\nexport const choiceMutations: MutationTree<IObjectsState> = {\n\tsetChoices(state, command: ISetChoicesMutation) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tobj.choices = command.choices;\n\t\t++obj.version;\n\t},\n\tsetChoiceColor(state, command: ISetChoiceColorMutation) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tobj.customColor = command.customColor;\n\t\t++obj.version;\n\t},\n\tsetChoiceDistance(state, command: ISetChoiceDistanceMutation) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tobj.choiceDistance = command.choiceDistance;\n\t\t++obj.version;\n\t},\n\tsetAutoWrapping(state, command: ISetAutoWrappingMutation) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tobj.autoWrap = command.autoWrap;\n\t\t++obj.version;\n\t},\n};\n\nlet lastChoiceId = 0;\n\nexport const choiceActions: ActionTree<IObjectsState, IRootState> = {\n\tcreateChoice({ commit, rootState }, command: ICreateChoicesAction): string {\n\t\tconst id = 'choice_' + ++lastChoiceId;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\tx: 640,\n\t\t\t\ty: ChoiceY,\n\t\t\t\twidth: ChoiceButtonWidth,\n\t\t\t\theight: 0,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tflip: false,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\tautoWrap: true,\n\t\t\t\topacity: 100,\n\t\t\t\ttype: 'choice',\n\t\t\t\tversion: 0,\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tratio: TextBoxWidth / TextBoxHeight,\n\t\t\t\tchoiceDistance: ChoiceSpacing,\n\t\t\t\tchoices: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselected: false,\n\t\t\t\t\t\ttext: 'Click here to edit choice',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tcustomColor: ChoiceButtonColor,\n\t\t\t\tcomposite: 'source-over',\n\t\t\t\tfilters: [],\n\t\t\t} as IChoices,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n\n\taddChoice({ state, commit }, command: IAddChoiceAction) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tcommit('setChoices', {\n\t\t\tid: command.id,\n\t\t\tchoices: [\n\t\t\t\t...obj.choices,\n\t\t\t\t{\n\t\t\t\t\tselected: false,\n\t\t\t\t\ttext: command.text,\n\t\t\t\t},\n\t\t\t],\n\t\t} as ISetChoicesMutation);\n\t},\n\n\tremoveChoice({ state, commit }, command: IRemoveChoiceAction) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tconst choices = [...obj.choices];\n\t\tif (!choices[command.choiceIdx]) return;\n\t\tchoices.splice(command.choiceIdx, 1);\n\t\t// Do not allow empty choices\n\t\tif (choices.length === 0) {\n\t\t\tchoices.push({\n\t\t\t\tselected: false,\n\t\t\t\ttext: '',\n\t\t\t});\n\t\t}\n\t\tcommit('setChoices', {\n\t\t\tid: command.id,\n\t\t\tchoices,\n\t\t} as ISetChoicesMutation);\n\t},\n\n\tsetChoiceText({ state, commit }, command: ISetChoiceTextAction) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tconst choices = [...obj.choices];\n\t\tif (!choices[command.choiceIdx]) return;\n\t\tchoices[command.choiceIdx].text = command.text;\n\t\tcommit('setChoices', {\n\t\t\tid: command.id,\n\t\t\tchoices,\n\t\t} as ISetChoicesMutation);\n\t},\n};\n\nexport interface ISetChoicesMutation extends ICommand {\n\treadonly choices: IChoices['choices'];\n}\n\nexport interface ISetChoiceColorMutation extends ICommand {\n\treadonly customColor: IChoices['customColor'];\n}\n\nexport interface ISetChoiceDistanceMutation extends ICommand {\n\treadonly choiceDistance: IChoices['choiceDistance'];\n}\n\nexport interface ICreateChoicesAction extends ICommand {}\n\nexport interface IAddChoiceAction extends ICommand {\n\treadonly text: string;\n}\n\nexport interface ISetChoiceTextAction extends ICommand {\n\treadonly choiceIdx: number;\n\treadonly text: string;\n}\n\nexport interface IRemoveChoiceAction extends ICommand {\n\treadonly choiceIdx: number;\n}\n","import { ICommand } from '@/eventbus/command';\nimport {\n\tIObjectsState,\n\tICreateObjectMutation,\n\tIObject,\n\tISetObjectPositionMutation,\n\tISetObjectFlipMutation,\n} from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { NameboxY, TextBoxWidth, TextBoxHeight } from '@/constants/textBox';\nimport { ISetSpriteSizeMutation } from './characters';\nimport { IRootState } from '..';\n\nexport interface ITextBox extends IObject {\n\ttype: 'textBox';\n\ttext: string;\n\ttalkingDefault:\n\t\t| 'No-one'\n\t\t| 'Sayori'\n\t\t| 'Monika'\n\t\t| 'Natsuki'\n\t\t| 'Yuri'\n\t\t| 'MC'\n\t\t| 'FeMC'\n\t\t| 'Chad'\n\t\t| 'Amy'\n\t\t| 'Other';\n\ttalkingOther: string;\n\tstyle: 'normal' | 'corrupt' | 'custom' | 'none';\n\tcustomColor: string;\n\tderiveCustomColors: boolean;\n\tcustomControlsColor: string;\n\tcustomNameboxColor: string;\n\tcustomNameboxStroke: string;\n\tcustomNameboxWidth: number;\n\tcontrols: boolean;\n\tskip: boolean;\n\tautoQuoting: boolean;\n\tautoWrap: boolean;\n\tcontinue: boolean;\n\tresetBounds: {\n\t\tx: number;\n\t\ty: number;\n\t\twidth: number;\n\t\theight: number;\n\t};\n}\n\nconst splitTextboxSpacing = 4;\n\nexport const textBoxMutations: MutationTree<IObjectsState> = {\n\tsetText(state, command: ISetTextBoxTextMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.text = command.text;\n\t\t++obj.version;\n\t},\n\tsetTalkingDefault(state, command: ISetTextBoxTalkingDefaultMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.talkingDefault = command.talkingDefault;\n\t\t++obj.version;\n\t},\n\tsetTalkingOther(state, command: ISetTextBoxTalkingOtherMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.talkingOther = command.talkingOther;\n\t\tobj.talkingDefault = 'Other';\n\t\t++obj.version;\n\t},\n\tsetStyle(state, command: ISetTextBoxStyleMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.style = command.style;\n\t\t++obj.version;\n\t},\n\tsetControlsVisible(state, command: ISetTextBoxControlsVisibleMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.controls = command.controls;\n\t\t++obj.version;\n\t},\n\tsetControlsColor(state, command: ISetTextBoxCustomControlsColorMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customControlsColor = command.customControlsColor;\n\t\t++obj.version;\n\t},\n\tsetDeriveCustomColors(state, command: ISetTextBoxDeriveCustomColorMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.deriveCustomColors = command.deriveCustomColors;\n\t\t++obj.version;\n\t},\n\tsetNameboxColor(state, command: ISetTextBoxNameboxColorMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customNameboxColor = command.customNameboxColor;\n\t\t++obj.version;\n\t},\n\tsetNameboxStroke(state, command: ISetTextBoxNameboxStrokeMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customNameboxStroke = command.customNameboxStroke;\n\t\t++obj.version;\n\t},\n\tsetNameboxWidth(state, command: ISetTextBoxNameboxWidthMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customNameboxWidth = command.customNameboxWidth;\n\t\t++obj.version;\n\t},\n\tsetSkipable(state, command: ISetTextBoxControlsSkipMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.skip = command.skip;\n\t\t++obj.version;\n\t},\n\tsetContinueArrow(state, command: ISetTextBoxControlsContinueMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.continue = command.continue;\n\t\t++obj.version;\n\t},\n\tsetCustomColor(state, command: ISetTextBoxCustomColorMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customColor = command.color;\n\t\t++obj.version;\n\t},\n\tsetAutoQuoting(state, command: ISetTextBoxAutoQuotingMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.autoQuoting = command.autoQuoting;\n\t\t++obj.version;\n\t},\n\tsetAutoWrapping(state, command: ISetAutoWrappingMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.autoWrap = command.autoWrap;\n\t\t++obj.version;\n\t},\n\tsetResetBounds(state, command: ISetResetBoundsMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.resetBounds = command.resetBounds;\n\t\tobj.x = command.resetBounds.x;\n\t\tobj.y = command.resetBounds.y;\n\t\tobj.height = command.resetBounds.height;\n\t\tobj.width = command.resetBounds.width;\n\t\t++obj.version;\n\t},\n};\n\nlet lastTextBoxId = 0;\n\nexport const textBoxActions: ActionTree<IObjectsState, IRootState> = {\n\tcreateTextBox({ commit, rootState }, command: ICreateTextBoxAction): string {\n\t\tconst id = 'textBox_' + ++lastTextBoxId;\n\t\tconst resetBounds = command.resetBounds || {\n\t\t\tx: 640,\n\t\t\ty: NameboxY,\n\t\t\twidth: TextBoxWidth,\n\t\t\theight: TextBoxHeight,\n\t\t};\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...resetBounds,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tflip: false,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\topacity: 100,\n\t\t\t\ttype: 'textBox',\n\t\t\t\tversion: 0,\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tratio: TextBoxWidth / TextBoxHeight,\n\t\t\t\tcontinue: true,\n\t\t\t\tcontrols: true,\n\t\t\t\tskip: true,\n\t\t\t\tautoQuoting: true,\n\t\t\t\tautoWrap: true,\n\t\t\t\tstyle: 'normal',\n\t\t\t\tcustomColor: '#ffa8d2',\n\t\t\t\tderiveCustomColors: true,\n\t\t\t\tcustomControlsColor: '#552222',\n\t\t\t\tcustomNameboxColor: '#ffeef6',\n\t\t\t\tcustomNameboxWidth: 168,\n\t\t\t\tcustomNameboxStroke: '#bb5599',\n\t\t\t\ttalkingDefault: 'No-one',\n\t\t\t\ttalkingOther: '',\n\t\t\t\ttext: '',\n\t\t\t\tresetBounds,\n\t\t\t\tcomposite: 'source-over',\n\t\t\t\tfilters: [],\n\t\t\t} as ITextBox,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n\n\tsetStyle({ commit }, command: ISetTextBoxStyleAction) {\n\t\tcommit('setStyle', {\n\t\t\tid: command.id,\n\t\t\tstyle: command.style,\n\t\t} as ISetTextBoxStyleMutation);\n\t},\n\n\tresetTextboxBounds(\n\t\t{ commit, state, dispatch },\n\t\tcommand: IResetTextboxBounds\n\t) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tcommit('setPosition', {\n\t\t\tid: command.id,\n\t\t\tx: obj.resetBounds.x,\n\t\t\ty: obj.resetBounds.y,\n\t\t} as ISetObjectPositionMutation);\n\t\tcommit('setSize', {\n\t\t\tid: command.id,\n\t\t\theight: obj.resetBounds.height,\n\t\t\twidth: obj.resetBounds.width,\n\t\t} as ISetSpriteSizeMutation);\n\t},\n\n\tasync splitTextbox({ commit, state, dispatch }, command: ISplitTextbox) {\n\t\tconst obj = state.objects[command.id];\n\t\tconst newWidth = (obj.width - splitTextboxSpacing) / 2;\n\t\tcommit('setResetBounds', {\n\t\t\tid: command.id,\n\t\t\tresetBounds: {\n\t\t\t\tx: obj.x - newWidth / 2,\n\t\t\t\ty: obj.y,\n\t\t\t\twidth: newWidth,\n\t\t\t\theight: obj.height,\n\t\t\t},\n\t\t} as ISetResetBoundsMutation);\n\t\tcommit('setStyle', {\n\t\t\tid: command.id,\n\t\t\tstyle: 'custom',\n\t\t} as ISetTextBoxStyleMutation);\n\t\tconst id = (await dispatch('createTextBox', {\n\t\t\tresetBounds: {\n\t\t\t\tx: obj.x + newWidth + splitTextboxSpacing / 2,\n\t\t\t\ty: obj.y,\n\t\t\t\twidth: newWidth,\n\t\t\t\theight: obj.height,\n\t\t\t},\n\t\t} as ICreateTextBoxAction)) as string;\n\t\tcommit('setStyle', {\n\t\t\tid,\n\t\t\tstyle: 'custom',\n\t\t} as ISetTextBoxStyleMutation);\n\t\tif (obj.flip) {\n\t\t\tcommit('setFlip', {\n\t\t\t\tid,\n\t\t\t\tflip: obj.flip,\n\t\t\t} as ISetObjectFlipMutation);\n\t\t}\n\t},\n};\n\nexport interface ISetTextBoxTextMutation extends ICommand {\n\treadonly text: string;\n}\n\nexport interface ISetTextBoxTalkingDefaultMutation extends ICommand {\n\treadonly talkingDefault: ITextBox['talkingDefault'];\n}\n\nexport interface ISetTextBoxTalkingOtherMutation extends ICommand {\n\treadonly talkingOther: string;\n}\n\nexport interface ISetTextBoxStyleMutation extends ICommand {\n\treadonly style: ITextBox['style'];\n}\n\nexport interface ISetTextBoxControlsVisibleMutation extends ICommand {\n\treadonly controls: boolean;\n}\n\nexport interface ISetTextBoxDeriveCustomColorMutation extends ICommand {\n\treadonly deriveCustomColors: boolean;\n}\n\nexport interface ISetTextBoxCustomControlsColorMutation extends ICommand {\n\treadonly customControlsColor: string;\n}\n\nexport interface ISetTextBoxNameboxColorMutation extends ICommand {\n\treadonly customNameboxColor: string;\n}\n\nexport interface ISetTextBoxNameboxStrokeMutation extends ICommand {\n\treadonly customNameboxStroke: string;\n}\n\nexport interface ISetTextBoxNameboxWidthMutation extends ICommand {\n\treadonly customNameboxWidth: number;\n}\n\nexport interface ISetTextBoxAutoQuotingMutation extends ICommand {\n\treadonly autoQuoting: boolean;\n}\n\nexport interface ISetAutoWrappingMutation extends ICommand {\n\treadonly autoWrap: boolean;\n}\n\nexport interface ISetResetBoundsMutation extends ICommand {\n\treadonly resetBounds: ITextBox['resetBounds'];\n}\n\nexport interface ISetTextBoxControlsSkipMutation extends ICommand {\n\treadonly skip: boolean;\n}\n\nexport interface ISetTextBoxControlsContinueMutation extends ICommand {\n\treadonly continue: boolean;\n}\n\nexport interface ISetTextBoxCustomColorMutation extends ICommand {\n\treadonly color: string;\n}\n\nexport interface ICreateTextBoxAction extends ICommand {\n\treadonly resetBounds?: ITextBox['resetBounds'];\n}\n\nexport interface ISetTextBoxStyleAction extends ICommand {\n\treadonly style: ITextBox['style'];\n}\n\nexport interface ISplitTextbox extends ICommand {}\n\nexport interface IResetTextboxBounds extends ICommand {}\n","import { ICommand } from '@/eventbus/command';\nimport { IObjectsState, ICreateObjectMutation, IObject } from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { TextBoxWidth, TextBoxHeight } from '@/constants/textBox';\nimport { IRootState } from '..';\nimport {\n\tChoiceButtonColor,\n\tChoiceY,\n\tChoiceButtonWidth,\n} from '@/constants/choices';\nimport { screenHeight, screenWidth } from '@/constants/base';\nimport { ISetAutoWrappingMutation } from './textbox';\n\nexport interface INotification extends IObject {\n\ttype: 'notification';\n\tcustomColor: string;\n\ttext: string;\n\tbackdrop: boolean;\n\tautoWrap: boolean;\n}\n\nexport const notificationMutations: MutationTree<IObjectsState> = {\n\tsetNotificationColor(state, command: ISetChoiceColorMutation) {\n\t\tconst obj = state.objects[command.id] as INotification;\n\t\tobj.customColor = command.customColor;\n\t\t++obj.version;\n\t},\n\tsetNotificationText(state, { id, text }: ISetNotificationTextMutation) {\n\t\tconst obj = state.objects[id] as INotification;\n\t\tobj.text = text;\n\t\t++obj.version;\n\t},\n\tsetNotificationBackdrop(\n\t\tstate,\n\t\t{ id, backdrop }: ISetNotificationBackdropMutation\n\t) {\n\t\tconst obj = state.objects[id] as INotification;\n\t\tobj.backdrop = backdrop;\n\t\t++obj.version;\n\t},\n\tsetAutoWrapping(state, command: ISetAutoWrappingMutation) {\n\t\tconst obj = state.objects[command.id] as INotification;\n\t\tobj.autoWrap = command.autoWrap;\n\t\t++obj.version;\n\t},\n};\n\nlet lastNotificationId = 0;\n\nexport const notificationActions: ActionTree<IObjectsState, IRootState> = {\n\tcreateNotification(\n\t\t{ commit, rootState },\n\t\tcommand: ICreateNotificationAction\n\t): string {\n\t\tconst id = 'notification_' + ++lastNotificationId;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\tx: screenWidth / 2,\n\t\t\t\ty: screenHeight / 2,\n\t\t\t\twidth: ChoiceButtonWidth,\n\t\t\t\theight: 0,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tflip: false,\n\t\t\t\tautoWrap: false,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\topacity: 100,\n\t\t\t\ttype: 'notification',\n\t\t\t\tversion: 0,\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tratio: TextBoxWidth / TextBoxHeight,\n\t\t\t\tcustomColor: ChoiceButtonColor,\n\t\t\t\ttext: 'Click here to edit notification',\n\t\t\t\tbackdrop: true,\n\t\t\t\tcomposite: 'source-over',\n\t\t\t\tfilters: [],\n\t\t\t} as INotification,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n};\n\nexport interface ISetNotificationTextMutation extends ICommand {\n\treadonly text: INotification['text'];\n}\n\nexport interface ISetNotificationBackdropMutation extends ICommand {\n\treadonly backdrop: INotification['backdrop'];\n}\n\nexport interface ISetChoiceColorMutation extends ICommand {\n\treadonly customColor: INotification['customColor'];\n}\n\nexport interface ICreateNotificationAction extends ICommand {}\n","import { ICommand } from '@/eventbus/command';\nimport { IObjectsState, ICreateObjectMutation, IObject } from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { IRootState } from '..';\nimport {\n\tdefaultPoemBackground,\n\tdefaultX,\n\tdefaultY,\n\tdefaultPoemWidth,\n\tdefaultPoemHeight,\n\tconsoleHeight,\n\tconsoleWidth,\n\tdefaultPoemStyle,\n\tdefaultConsoleBackground,\n\tdefaultConsoleStyle,\n} from '@/constants/poem';\nimport { ISetAutoWrappingMutation } from './textbox';\n\nexport interface IPoem extends IObject {\n\ttype: 'poem';\n\tsubType: 'poem' | 'console';\n\tbackground: number;\n\tfont: number;\n\ttext: string;\n\tautoWrap: boolean;\n}\n\nexport const poemMutations: MutationTree<IObjectsState> = {\n\tsetPoemBackground(state, { id, background }: ISetBackgroundMutation) {\n\t\tconst obj = state.objects[id] as IPoem;\n\t\tobj.background = background;\n\t\t++obj.version;\n\t},\n\tsetPoemFont(state, { id, font }: ISetFontMutation) {\n\t\tconst obj = state.objects[id] as IPoem;\n\t\tobj.font = font;\n\t\t++obj.version;\n\t},\n\tsetPoemText(state, { id, text }: ISetTextMutation) {\n\t\tconst obj = state.objects[id] as IPoem;\n\t\tobj.text = text;\n\t\t++obj.version;\n\t},\n\tsetAutoWrapping(state, command: ISetAutoWrappingMutation) {\n\t\tconst obj = state.objects[command.id] as IPoem;\n\t\tobj.autoWrap = command.autoWrap;\n\t\t++obj.version;\n\t},\n};\n\nlet lastPoemId = 0;\n\nexport const poemActions: ActionTree<IObjectsState, IRootState> = {\n\tcreatePoem({ commit, rootState }, command: ICreatePoemAction): string {\n\t\tconst id = 'poem_' + ++lastPoemId;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\tsubType: 'poem',\n\t\t\t\tx: defaultX,\n\t\t\t\ty: defaultY,\n\t\t\t\twidth: defaultPoemWidth,\n\t\t\t\theight: defaultPoemHeight,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tflip: false,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\topacity: 100,\n\t\t\t\ttype: 'poem',\n\t\t\t\tversion: 0,\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tautoWrap: true,\n\t\t\t\tratio: defaultPoemWidth / defaultPoemHeight,\n\t\t\t\tbackground: defaultPoemBackground,\n\t\t\t\tfont: defaultPoemStyle,\n\t\t\t\ttext: 'New poem\\n\\nClick here to edit poem',\n\t\t\t\tcomposite: 'source-over',\n\t\t\t\tfilters: [],\n\t\t\t} as IPoem,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n\tcreateConsole({ commit, rootState }, command: ICreatePoemAction): string {\n\t\tconst id = 'poem_' + ++lastPoemId;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\tsubType: 'console',\n\t\t\t\tx: consoleWidth / 2,\n\t\t\t\ty: consoleHeight / 2,\n\t\t\t\twidth: consoleWidth,\n\t\t\t\theight: consoleHeight,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tflip: false,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\topacity: 100,\n\t\t\t\ttype: 'poem',\n\t\t\t\tversion: 0,\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tratio: consoleWidth / consoleHeight,\n\t\t\t\tbackground: defaultConsoleBackground,\n\t\t\t\tfont: defaultConsoleStyle,\n\t\t\t\ttext: '> _\\n  \\n  Console command\\n  Click here to edit',\n\t\t\t\tcomposite: 'source-over',\n\t\t\t\tfilters: [],\n\t\t\t\tautoWrap: true,\n\t\t\t} as IPoem,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n};\n\nexport interface ISetBackgroundMutation extends ICommand {\n\treadonly background: IPoem['background'];\n}\n\nexport interface ISetFontMutation extends ICommand {\n\treadonly font: IPoem['font'];\n}\n\nexport interface ISetTextMutation extends ICommand {\n\treadonly text: IPoem['text'];\n}\n\nexport interface ICreatePoemAction extends ICommand {}\n","import { Module } from 'vuex';\nimport { ICommand } from '@/eventbus/command';\nimport { spriteMutations, spriteActions } from './objectTypes/sprite';\nimport {\n\tcharacterActions,\n\tcharacterMutations,\n\tfixContentPackRemovalFromCharacter,\n} from './objectTypes/characters';\nimport { choiceMutations, choiceActions } from './objectTypes/choices';\nimport { textBoxActions, textBoxMutations } from './objectTypes/textbox';\nimport {\n\tnotificationMutations,\n\tnotificationActions,\n} from './objectTypes/notification';\nimport { poemMutations, poemActions } from './objectTypes/poem';\nimport { IRootState } from '.';\nimport { ContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from './content';\nimport {\n\tIHasSpriteFilters,\n\tpercentageValue,\n\tSpriteFilter,\n} from './sprite_options';\nimport { CompositeModes } from '@/renderer/rendererContext';\n\nexport interface IPanel {\n\tid: string;\n\torder: string[];\n\tonTopOrder: string[];\n}\n\nexport interface IObjectsState {\n\tobjects: { [id: string]: IObject };\n\tpanels: { [id: string]: IPanel };\n}\n\nexport interface IObject extends IHasSpriteFilters {\n\ttype: ObjectTypes;\n\tpanelId: string;\n\tid: string;\n\tx: number;\n\ty: number;\n\twidth: number;\n\theight: number;\n\tpreserveRatio: boolean;\n\tratio: number;\n\tversion: number;\n\tflip: boolean;\n\tonTop: boolean;\n}\n\nexport type ObjectTypes =\n\t| 'sprite'\n\t| 'character'\n\t| 'textBox'\n\t| 'choice'\n\t| 'notification'\n\t| 'poem';\n\nlet lastCopyId = 0;\n\nexport default {\n\tnamespaced: true,\n\tstate: {\n\t\tobjects: {},\n\t\tpanels: {},\n\t},\n\tmutations: {\n\t\tcreate(state, { object }: ICreateObjectMutation) {\n\t\t\tif (!state.panels[object.panelId]) {\n\t\t\t\tstate.panels[object.panelId] = {\n\t\t\t\t\tid: object.panelId,\n\t\t\t\t\tonTopOrder: [],\n\t\t\t\t\torder: [],\n\t\t\t\t};\n\t\t\t}\n\t\t\tconst panel = state.panels[object.panelId];\n\t\t\tconst collection = object.onTop ? panel.onTopOrder : panel.order;\n\t\t\tstate.objects[object.id] = object;\n\t\t\tcollection.push(object.id);\n\t\t},\n\t\tremoveFromList(state, command: IRemoveFromListMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tconst collection = command.onTop ? panel.onTopOrder : panel.order;\n\t\t\tconst idx = collection.indexOf(command.id);\n\t\t\tcollection.splice(idx, 1);\n\t\t},\n\t\taddToList(state, command: IAddToListMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tconst collection = command.onTop ? panel.onTopOrder : panel.order;\n\t\t\tcollection.splice(command.position, 0, command.id);\n\t\t},\n\t\tsetOnTop(state, command: ISetOnTopMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.onTop = command.onTop;\n\t\t},\n\t\tsetPosition(state, command: ISetObjectPositionMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.x = command.x;\n\t\t\tobj.y = command.y;\n\t\t},\n\t\tsetFlip(state, command: ISetObjectFlipMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.flip = command.flip;\n\t\t},\n\t\tsetSize(state, command: ISetSpriteSizeMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.width = command.width;\n\t\t\tobj.height = command.height;\n\t\t},\n\t\tsetRatio(state, command: ISetSpriteRatioMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.preserveRatio = command.preserveRatio;\n\t\t\tobj.ratio = command.ratio;\n\t\t},\n\t\tremoveObject(state, command: IRemoveObjectMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tdelete state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tif (panel.onTopOrder.length === 0 && panel.order.length === 0) {\n\t\t\t\tdelete state.panels[obj.panelId];\n\t\t\t}\n\t\t},\n\t\tsetComposition(state, command: ISetCompositionMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.composite = command.composite;\n\t\t},\n\t\tsetFilters(state, command: ISetFiltersMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.filters = command.filters;\n\t\t},\n\t\t...spriteMutations,\n\t\t...characterMutations,\n\t\t...textBoxMutations,\n\t\t...choiceMutations,\n\t\t...notificationMutations,\n\t\t...poemMutations,\n\t},\n\tactions: {\n\t\tremoveObject({ state, commit, rootState }, command: IRemoveObjectAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tif (rootState.ui.selection === command.id) {\n\t\t\t\tcommit('ui/setSelection', null, { root: true });\n\t\t\t}\n\t\t\tcommit('removeFromList', {\n\t\t\t\tid: command.id,\n\t\t\t\tonTop: obj.onTop,\n\t\t\t} as IRemoveFromListMutation);\n\t\t\tcommit('removeObject', {\n\t\t\t\tid: command.id,\n\t\t\t} as IRemoveObjectMutation);\n\t\t},\n\t\tsetPosition({ state, commit, dispatch }, command: ISetPositionAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tif (obj.type === 'character') {\n\t\t\t\tdispatch('setCharacterPosition', command as ISetPositionAction);\n\t\t\t} else {\n\t\t\t\tcommit('setPosition', command as ISetObjectPositionMutation);\n\t\t\t}\n\t\t},\n\t\tsetOnTop({ state, commit }, command: IObjectSetOnTopAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tif (obj.onTop === command.onTop) return;\n\t\t\tcommit('removeFromList', {\n\t\t\t\tid: command.id,\n\t\t\t\tonTop: obj.onTop,\n\t\t\t} as IRemoveFromListMutation);\n\t\t\tcommit('addToList', {\n\t\t\t\tid: command.id,\n\t\t\t\tposition: (command.onTop ? panel.onTopOrder : panel.order).length,\n\t\t\t\tonTop: command.onTop,\n\t\t\t} as IRemoveFromListMutation);\n\t\t\tcommit('setOnTop', {\n\t\t\t\tid: command.id,\n\t\t\t\tonTop: command.onTop,\n\t\t\t} as ISetOnTopMutation);\n\t\t},\n\t\tshiftLayer({ state, commit }, command: IObjectShiftLayerAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tconst collection = obj.onTop ? panel.onTopOrder : panel.order;\n\t\t\tconst position = collection.indexOf(obj.id);\n\n\t\t\tlet newPosition = position + command.delta;\n\t\t\tif (newPosition < 0) {\n\t\t\t\tnewPosition = 0;\n\t\t\t}\n\t\t\tif (newPosition > collection.length) {\n\t\t\t\tnewPosition = collection.length;\n\t\t\t}\n\t\t\tcommit('removeFromList', {\n\t\t\t\tid: command.id,\n\t\t\t\tonTop: obj.onTop,\n\t\t\t} as IRemoveFromListMutation);\n\t\t\tcommit('addToList', {\n\t\t\t\tid: command.id,\n\t\t\t\tposition: newPosition,\n\t\t\t\tonTop: obj.onTop,\n\t\t\t} as IAddToListMutation);\n\t\t},\n\t\tsetPreserveRatio({ commit, state }, command: ISetRatioAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst ratio = command.preserveRatio ? obj.width / obj.height : 0;\n\t\t\tcommit('setRatio', {\n\t\t\t\tid: command.id,\n\t\t\t\tpreserveRatio: command.preserveRatio,\n\t\t\t\tratio,\n\t\t\t} as ISetSpriteRatioMutation);\n\t\t},\n\t\tsetWidth({ commit, state }, command: ISetWidthAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst height = !obj.preserveRatio\n\t\t\t\t? obj.height\n\t\t\t\t: command.width / obj.ratio;\n\t\t\tcommit('setSize', {\n\t\t\t\tid: command.id,\n\t\t\t\theight,\n\t\t\t\twidth: command.width,\n\t\t\t} as ISetSpriteSizeMutation);\n\t\t},\n\t\tsetHeight({ commit, state }, command: ISetHeightAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst width = !obj.preserveRatio ? obj.width : command.height * obj.ratio;\n\t\t\tcommit('setSize', {\n\t\t\t\tid: command.id,\n\t\t\t\theight: command.height,\n\t\t\t\twidth,\n\t\t\t} as ISetSpriteSizeMutation);\n\t\t},\n\t\tfixContentPackRemoval(context, oldContent: ContentPack<IAsset>) {\n\t\t\tObject.values(context.state.objects).map(obj => {\n\t\t\t\tswitch (obj.type) {\n\t\t\t\t\tcase 'character':\n\t\t\t\t\t\tfixContentPackRemovalFromCharacter(context, obj.id, oldContent);\n\t\t\t\t\t\treturn;\n\t\t\t\t\tcase 'sprite':\n\t\t\t\t\t\treturn;\n\t\t\t\t\tcase 'textBox':\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tcopyObjects(\n\t\t\t{ commit, state },\n\t\t\t{ sourcePanelId, targetPanelId }: ICopyObjectsAction\n\t\t) {\n\t\t\tconst sourceOrders = state.panels[sourcePanelId];\n\t\t\tif (!sourceOrders) return;\n\t\t\tfor (const id of [...sourceOrders.onTopOrder, ...sourceOrders.order]) {\n\t\t\t\tconst oldObject = state.objects[id];\n\t\t\t\tcommit('create', {\n\t\t\t\t\tobject: {\n\t\t\t\t\t\t...JSON.parse(JSON.stringify(oldObject)),\n\t\t\t\t\t\tid: `copy_${oldObject.id}_${++lastCopyId}`,\n\t\t\t\t\t\tpanelId: targetPanelId,\n\t\t\t\t\t},\n\t\t\t\t} as ICreateObjectMutation);\n\t\t\t}\n\t\t},\n\t\tdeleteAllOfPanel({ state, dispatch }, { panelId }: IDeleteAllOfPanel) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tfor (const id of [...panel.onTopOrder, ...panel.order]) {\n\t\t\t\tdispatch('removeObject', { id } as IRemoveObjectAction);\n\t\t\t}\n\t\t},\n\t\taddFilter({ state, commit }, action: IAddFilterAction) {\n\t\t\tconst obj = state.objects[action.id];\n\t\t\tconst filters = [...obj.filters];\n\t\t\tlet filter: SpriteFilter;\n\t\t\tif (action.type === 'drop-shadow') {\n\t\t\t\tfilter = {\n\t\t\t\t\ttype: 'drop-shadow',\n\t\t\t\t\tblurRadius: 0,\n\t\t\t\t\tcolor: 'rgba(0,0,0,0.5)',\n\t\t\t\t\toffsetX: 10,\n\t\t\t\t\toffsetY: 10,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tfilter = {\n\t\t\t\t\ttype: action.type,\n\t\t\t\t\tvalue: percentageValue.has(action.type) ? 1 : 0,\n\t\t\t\t};\n\t\t\t}\n\t\t\tfilters.splice(action.idx, 0, filter);\n\t\t\tcommit('setFilters', {\n\t\t\t\tid: action.id,\n\t\t\t\tfilters,\n\t\t\t} as ISetFiltersMutation);\n\t\t},\n\t\tremoveFilter({ state, commit }, action: IRemoveFilterAction) {\n\t\t\tconst obj = state.objects[action.id];\n\t\t\tconst filters = [...obj.filters];\n\t\t\tfilters.splice(action.idx, 1);\n\t\t\tcommit('setFilters', {\n\t\t\t\tid: action.id,\n\t\t\t\tfilters,\n\t\t\t} as ISetFiltersMutation);\n\t\t},\n\t\tmoveFilter({ state, commit }, action: IMoveFilterAction) {\n\t\t\tconst obj = state.objects[action.id];\n\t\t\tconst filters = [...obj.filters];\n\t\t\tconst filter = filters[action.idx];\n\t\t\tfilters.splice(action.idx, 1);\n\t\t\tfilters.splice(action.idx + action.moveBy, 0, filter);\n\t\t\tcommit('setFilters', {\n\t\t\t\tid: action.id,\n\t\t\t\tfilters,\n\t\t\t} as ISetFiltersMutation);\n\t\t},\n\t\tsetFilter({ state, commit }, action: ISetFilterAction) {\n\t\t\tconst obj = state.objects[action.id];\n\t\t\tconst filters = [...obj.filters];\n\t\t\tconst filter = filters[action.idx];\n\n\t\t\tif (filter.type === 'drop-shadow') {\n\t\t\t\tif (action.blurRadius !== undefined) {\n\t\t\t\t\tfilter.blurRadius = action.blurRadius;\n\t\t\t\t}\n\t\t\t\tif (action.color !== undefined) {\n\t\t\t\t\tfilter.color = action.color;\n\t\t\t\t}\n\t\t\t\tif (action.offsetX !== undefined) {\n\t\t\t\t\tfilter.offsetX = action.offsetX;\n\t\t\t\t}\n\t\t\t\tif (action.offsetY !== undefined) {\n\t\t\t\t\tfilter.offsetY = action.offsetY;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfilter.value = action.value!;\n\t\t\t}\n\n\t\t\tcommit('setFilters', {\n\t\t\t\tid: action.id,\n\t\t\t\tfilters,\n\t\t\t} as ISetFiltersMutation);\n\t\t},\n\t\t...spriteActions,\n\t\t...characterActions,\n\t\t...textBoxActions,\n\t\t...choiceActions,\n\t\t...notificationActions,\n\t\t...poemActions,\n\t},\n} as Module<IObjectsState, IRootState>;\n\nexport interface ICreateObjectMutation {\n\treadonly object: IObject;\n}\n\nexport interface IDeleteAllOfPanel {\n\treadonly panelId: string;\n}\n\nexport interface IObjectMutation {\n\treadonly id: string;\n}\n\nexport interface ISetSpriteSizeMutation extends ICommand {\n\treadonly width: number;\n\treadonly height: number;\n}\n\nexport interface ISetSpriteRatioMutation extends ICommand {\n\treadonly preserveRatio: boolean;\n\treadonly ratio: number;\n}\n\nexport interface ISetObjectPositionMutation extends IObjectMutation {\n\treadonly x: number;\n\treadonly y: number;\n}\n\nexport interface ISetOnTopMutation extends IObjectMutation {\n\treadonly onTop: boolean;\n}\n\nexport interface ISetObjectFlipMutation extends IObjectMutation {\n\treadonly flip: boolean;\n}\n\nexport interface IRemoveFromListMutation extends IObjectMutation {\n\treadonly onTop: boolean;\n}\n\nexport interface IAddToListMutation extends IObjectMutation {\n\treadonly onTop: boolean;\n\treadonly position: number;\n}\n\nexport interface IObjectShiftLayerAction extends ICommand {\n\treadonly delta: number;\n}\n\nexport interface IObjectSetOnTopAction extends ICommand {\n\treadonly onTop: boolean;\n}\n\nexport interface ISetWidthAction extends ICommand {\n\treadonly width: number;\n}\n\nexport interface ISetHeightAction extends ICommand {\n\treadonly height: number;\n}\n\nexport interface ISetRatioAction extends ICommand {\n\treadonly preserveRatio: boolean;\n}\n\nexport interface IRemoveObjectMutation extends ICommand {}\nexport interface IRemoveObjectAction extends ICommand {}\n\nexport interface ISetPositionAction extends ICommand {\n\treadonly x: number;\n\treadonly y: number;\n}\n\nexport interface IObjectContentPackRemovalAction extends ICommand {\n\treadonly oldPack: ContentPack<IAsset>;\n}\n\nexport interface ICopyObjectsAction {\n\treadonly sourcePanelId: string;\n\treadonly targetPanelId: string;\n}\n\nexport interface ISetCompositionMutation extends ICommand {\n\treadonly composite: CompositeModes;\n}\n\nexport interface ISetFiltersMutation extends ICommand {\n\treadonly filters: SpriteFilter[];\n}\n\nexport interface IAddFilterAction extends ICommand {\n\treadonly type: SpriteFilter['type'];\n\treadonly idx: number;\n}\n\nexport interface IRemoveFilterAction extends ICommand {\n\treadonly idx: number;\n}\n\nexport interface IMoveFilterAction extends ICommand {\n\treadonly idx: number;\n\treadonly moveBy: number;\n}\n\nexport interface ISetFilterAction extends ICommand {\n\treadonly idx: number;\n\treadonly value?: number;\n\treadonly offsetX?: number;\n\treadonly offsetY?: number;\n\treadonly blurRadius?: number;\n\treadonly color?: string;\n}\n","import { Module } from 'vuex';\nimport { IRootState } from '.';\n\nexport interface IUiState {\n\tvertical: boolean;\n\tnsfw: boolean;\n\tselection: string | null;\n\tlqRendering: boolean;\n\tlastDownload: string | null;\n}\n\nexport default {\n\tnamespaced: true,\n\tstate: {\n\t\tvertical: false,\n\t\tlqRendering: true,\n\t\tnsfw: false,\n\t\tselection: null,\n\t\tlastDownload: null,\n\t},\n\tmutations: {\n\t\tsetVertical(state, vertical: boolean) {\n\t\t\tstate.vertical = vertical;\n\t\t},\n\t\tsetNsfw(state, nsfw: boolean) {\n\t\t\tstate.nsfw = nsfw;\n\t\t},\n\t\tsetLqRendering(state, lqRendering: boolean) {\n\t\t\tstate.lqRendering = lqRendering;\n\t\t},\n\t\tsetSelection(state, selection: string | null) {\n\t\t\tstate.selection = selection;\n\t\t},\n\t\tsetLastDownload(state, download: string) {\n\t\t\tstate.lastDownload = download;\n\t\t},\n\t},\n} as Module<IUiState, IRootState>;\n","import {\n\tContentPack,\n\tBackground,\n\tCharacter,\n\tHeadCollections,\n\tPose,\n\tStyleClasses,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '.';\n\nexport function mergeContentPacks(\n\tx: ContentPack<IAsset>,\n\ty: ContentPack<IAsset>\n): ContentPack<IAsset> {\n\treturn {\n\t\tbackgrounds: mergeBackgrounds(x.backgrounds, y.backgrounds),\n\t\tcharacters: mergeCharacters<IAsset>(x.characters, y.characters),\n\t\tdependencies: mergeArrayUnique(x.dependencies, y.dependencies),\n\t\tfonts: mergeIdArrays(\n\t\t\tx.fonts,\n\t\t\ty.fonts,\n\t\t\tobj => obj.id,\n\t\t\t(xObj, yObj) => ({\n\t\t\t\t...xObj,\n\t\t\t\tfiles: mergeArrayUnique(xObj.files, yObj.files),\n\t\t\t})\n\t\t),\n\t\tpoemStyles: mergeIdArrays(\n\t\t\tx.poemStyles,\n\t\t\ty.poemStyles,\n\t\t\tobj => obj.label,\n\t\t\t() => {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\t\t),\n\t\tpoemBackgrounds: [...x.poemBackgrounds, ...y.poemBackgrounds],\n\t\tsprites: mergeIdArrays(\n\t\t\tx.sprites,\n\t\t\ty.sprites,\n\t\t\tobj => obj.id,\n\t\t\t(xObj, yObj) => ({\n\t\t\t\tid: xObj.id,\n\t\t\t\tlabel: xObj.label,\n\t\t\t\tvariants: [...xObj.variants, ...yObj.variants],\n\t\t\t})\n\t\t),\n\t\tcolors: mergeIdArrays(\n\t\t\tx.colors,\n\t\t\ty.colors,\n\t\t\tobj => obj.color,\n\t\t\txObj => xObj\n\t\t),\n\t};\n}\n\nfunction mergeBackgrounds<A>(\n\tx: Array<Background<A>>,\n\ty: Array<Background<A>>\n): Array<Background<A>> {\n\treturn mergeIdArrays(x, y, obj => obj.id, mergeBackground);\n}\n\nfunction mergeBackground<A>(x: Background<A>, y: Background<A>): Background<A> {\n\treturn {\n\t\tid: x.id,\n\t\tlabel: x.label,\n\t\tvariants: [...x.variants, ...y.variants],\n\t};\n}\n\nfunction mergeCharacters<A>(\n\tx: Array<Character<A>>,\n\ty: Array<Character<A>>\n): Array<Character<A>> {\n\treturn mergeIdArrays(x, y, obj => obj.id, mergeCharacter);\n}\n\nfunction mergeCharacter<A>(x: Character<A>, y: Character<A>): Character<A> {\n\treturn {\n\t\tchibi: x.chibi,\n\t\tid: x.id,\n\t\tlabel: x.label,\n\t\theads: mergeHeadCollections(x.heads, y.heads),\n\t\tstyleGroups: mergeIdArrays(\n\t\t\tx.styleGroups,\n\t\t\ty.styleGroups,\n\t\t\tobj => obj.id,\n\t\t\t(xStyleGroup, yStyleGroup) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: xStyleGroup.id,\n\t\t\t\t\tstyleComponents: mergeIdArrays(\n\t\t\t\t\t\txStyleGroup.styleComponents,\n\t\t\t\t\t\tyStyleGroup.styleComponents,\n\t\t\t\t\t\tobj => obj.id,\n\t\t\t\t\t\t(xClasses, yClasses) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tid: xClasses.id,\n\t\t\t\t\t\t\t\tlabel: xClasses.label,\n\t\t\t\t\t\t\t\tvariants: mergeStyleClasses(\n\t\t\t\t\t\t\t\t\txClasses.variants,\n\t\t\t\t\t\t\t\t\tyClasses.variants\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t),\n\t\t\t\t\tstyles: mergeIdArrays(\n\t\t\t\t\t\txStyleGroup.styles,\n\t\t\t\t\t\tyStyleGroup.styles,\n\t\t\t\t\t\tobj => JSON.stringify(obj.components),\n\t\t\t\t\t\t(xStyle, yStyle) => ({\n\t\t\t\t\t\t\tcomponents: xStyle.components,\n\t\t\t\t\t\t\tposes: mergeIdArrays(\n\t\t\t\t\t\t\t\txStyle.poses,\n\t\t\t\t\t\t\t\tyStyle.poses,\n\t\t\t\t\t\t\t\tobj => obj.id,\n\t\t\t\t\t\t\t\tmergePose\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t})\n\t\t\t\t\t),\n\t\t\t\t};\n\t\t\t}\n\t\t),\n\t};\n}\n\nfunction mergeStyleClasses<A>(\n\tx: StyleClasses<A>,\n\ty: StyleClasses<A>\n): StyleClasses<A> {\n\tconst ret: StyleClasses<A> = { ...x };\n\n\tfor (const classKey in y) {\n\t\tif (!y.hasOwnProperty(classKey)) continue;\n\t\tif (ret.hasOwnProperty(classKey)) continue;\n\t\tret[classKey] = y[classKey];\n\t}\n\n\treturn ret;\n}\n\nfunction mergePose<A>(x: Pose<A>, y: Pose<A>): Pose<A> {\n\tconst positions: Pose<A>['positions'] = { ...x.positions };\n\n\tfor (const key in y.positions) {\n\t\tif (positions[key]) {\n\t\t\tpositions[key] = [...positions[key], ...y.positions[key]] as A[][];\n\t\t} else {\n\t\t\tpositions[key] = y.positions[key];\n\t\t}\n\t}\n\n\treturn {\n\t\tid: x.id,\n\t\tcompatibleHeads: mergeArrayUnique(x.compatibleHeads, y.compatibleHeads),\n\t\tpreviewOffset: x.previewOffset,\n\t\tpreviewSize: x.previewSize,\n\t\tscale: x.scale,\n\t\tsize: x.size,\n\t\trenderCommands: x.renderCommands,\n\t\tpositions,\n\t};\n}\n\nfunction mergeHeadCollections<A>(\n\tx: HeadCollections<A>,\n\ty: HeadCollections<A>\n): HeadCollections<A> {\n\tconst ret = { ...x };\n\n\tfor (const headGroupKey in y) {\n\t\tif (!y.hasOwnProperty(headGroupKey)) continue;\n\t\tconst headGroup = y[headGroupKey];\n\t\tif (ret[headGroupKey]) {\n\t\t\tconst oldHeadGroup = ret[headGroupKey];\n\t\t\tret[headGroupKey] = {\n\t\t\t\tpreviewOffset: oldHeadGroup.previewOffset,\n\t\t\t\tpreviewSize: oldHeadGroup.previewSize,\n\t\t\t\tvariants: [...oldHeadGroup.variants, ...headGroup.variants],\n\t\t\t};\n\t\t} else {\n\t\t\tret[headGroupKey] = headGroup;\n\t\t}\n\t}\n\n\treturn ret;\n}\n\nfunction mergeArrayUnique<A>(x: A[], y: A[]): A[] {\n\tconst ret = [...x];\n\tfor (const yObj of y) {\n\t\tif (!ret.includes(yObj)) {\n\t\t\tret.push(yObj);\n\t\t}\n\t}\n\treturn ret;\n}\n\nfunction mergeIdArrays<A, B>(\n\tx: A[],\n\ty: A[],\n\tgetId: (obj: A) => B,\n\tmerge: (x: A, y: A) => A\n): A[] {\n\tconst ret = [...x];\n\tconst definedIds = new Map<B, number>(\n\t\tx.map((xObj, idx) => [getId(xObj), idx])\n\t);\n\n\tfor (const yObj of y) {\n\t\tconst yId = getId(yObj);\n\t\tif (definedIds.has(yId)) {\n\t\t\tconst existingIdx = definedIds.get(yId)!;\n\t\t\tconst existing = ret[existingIdx];\n\t\t\tret.splice(existingIdx, 1, merge(existing, yObj));\n\t\t} else {\n\t\t\tdefinedIds.set(yId, ret.length);\n\t\t\tret.push(yObj);\n\t\t}\n\t}\n\n\treturn ret;\n}\n","import { Module } from 'vuex';\nimport {\n\tContentPack,\n\tCharacter,\n\tBackground,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport {\n\tassetWalker,\n\tnormalizePath,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/util';\nimport { normalizeContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/parser';\nimport { convert as convertV1 } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/convertV1';\n// tslint:disable-next-line: max-line-length\nimport { normalizeCharacter as normalizeCharacterV1 } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v1/parser';\nimport { isWebPSupported } from '@/asset-manager';\nimport { mergeContentPacks } from './merge';\nimport { IRootState } from '..';\n\nexport interface IContentState {\n\tcontentPacks: Array<ContentPack<IAsset>>;\n\tcurrent: ContentPack<IAsset>;\n}\n\nexport interface IAsset {\n\thq: string;\n\tlq: string;\n\tsourcePack: string;\n}\n\nfunction baseDir(url: string): string {\n\treturn (\n\t\turl\n\t\t\t.split('/')\n\t\t\t.slice(0, -1)\n\t\t\t.join('/') + '/'\n\t);\n}\n\n// These types are assumed to always be supported\nconst baseTypes = new Set(['png', 'gif', 'bmp', 'svg']);\n\nexport type BackgroundLookup = Map<\n\tBackground<IAsset>['id'],\n\tBackground<IAsset>\n>;\n\nexport default {\n\tnamespaced: true,\n\tstate: {\n\t\tcontentPacks: [],\n\t\tcurrent: {\n\t\t\tdependencies: [],\n\t\t\tbackgrounds: [],\n\t\t\tcharacters: [],\n\t\t\tfonts: [],\n\t\t\tpoemStyles: [],\n\t\t\tpoemBackgrounds: [],\n\t\t\tsprites: [],\n\t\t\tcolors: [],\n\t\t},\n\t},\n\tmutations: {\n\t\tsetContentPacks(state: IContentState, packs: Array<ContentPack<IAsset>>) {\n\t\t\tstate.contentPacks = packs;\n\t\t},\n\t\tsetCurrentContent(state: IContentState, content: ContentPack<IAsset>) {\n\t\t\tstate.current = content;\n\t\t},\n\t},\n\tactions: {\n\t\tasync contentPack({ commit, state }, contentPack: ContentPack<string>) {\n\t\t\tconst convertedPack = (await convertContentPack(\n\t\t\t\tcontentPack\n\t\t\t)) as ContentPack<IAsset>;\n\t\t\tconst existingPacks = new Set(state.contentPacks.map(x => x.packId!));\n\t\t\tfor (const dependency of contentPack.dependencies) {\n\t\t\t\tif (!existingPacks.has(dependency)) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Missing dependency '${dependency}'. Refusing to install ${contentPack.packId}`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcommit('setContentPacks', [...state.contentPacks, convertedPack]);\n\t\t\tcommit(\n\t\t\t\t'setCurrentContent',\n\t\t\t\tmergeContentPacks(state.current, convertedPack)\n\t\t\t);\n\t\t},\n\n\t\tasync removeContentPacks({ commit, state }, packIds: Set<string>) {\n\t\t\tconst newContentPacks = sortByDependencies(\n\t\t\t\tstate.contentPacks.filter(pack => !packIds.has(pack.packId!))\n\t\t\t);\n\t\t\tcommit('setContentPacks', newContentPacks);\n\t\t\tcommit(\n\t\t\t\t'setCurrentContent',\n\t\t\t\t(newContentPacks as Array<ContentPack<IAsset>>).reduce((acc, value) =>\n\t\t\t\t\tmergeContentPacks(acc, value)\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\n\t\tasync replaceContentPack(\n\t\t\t{ commit, state },\n\t\t\taction: ReplaceContentPackAction\n\t\t) {\n\t\t\tconst convertedPack = action.processed\n\t\t\t\t? action.contentPack\n\t\t\t\t: await convertContentPack(action.contentPack);\n\t\t\tlet packs = state.contentPacks;\n\t\t\tconst packIdx = packs.findIndex(\n\t\t\t\tpack => pack.packId === action.contentPack.packId\n\t\t\t);\n\t\t\tif (packIdx === -1) {\n\t\t\t\tpacks.push(convertedPack);\n\t\t\t} else {\n\t\t\t\tpacks.splice(packIdx, 1, convertedPack);\n\t\t\t}\n\t\t\tpacks = sortByDependencies(packs);\n\t\t\tcommit('setContentPacks', packs);\n\t\t\tcommit(\n\t\t\t\t'setCurrentContent',\n\t\t\t\t(packs as Array<ContentPack<IAsset>>).reduce((acc, value) =>\n\t\t\t\t\tmergeContentPacks(acc, value)\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\n\t\tasync loadContentPacks({ dispatch }, urls: string | string[]) {\n\t\t\tif (typeof urls === 'string') {\n\t\t\t\turls = [urls];\n\t\t\t}\n\t\t\tconst contentPacks = await Promise.all(\n\t\t\t\turls.map(async url => {\n\t\t\t\t\tconst response = await fetch(url);\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\terror(\n\t\t\t\t\t\t\t`Could not load content pack. Server responded with: ${response.statusText}`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet json;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tjson = await response.json();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\terror('Content pack is not valid json!');\n\t\t\t\t\t}\n\n\t\t\t\t\tlet contentPack: ContentPack<string>;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst paths = {\n\t\t\t\t\t\t\t'./': baseDir(url),\n\t\t\t\t\t\t\t'/': baseDir(location.href) + 'assets/',\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (json.version === '2.0') {\n\t\t\t\t\t\t\tcontentPack = normalizeContentPack(json, paths) as ContentPack<\n\t\t\t\t\t\t\t\tstring\n\t\t\t\t\t\t\t>;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontentPack = convertV1(\n\t\t\t\t\t\t\t\tnormalizeCharacterV1(json, paths),\n\t\t\t\t\t\t\t\tpaths,\n\t\t\t\t\t\t\t\tfalse\n\t\t\t\t\t\t\t) as ContentPack<string>;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\terror('Content pack is not in a valid format!', e);\n\t\t\t\t\t}\n\t\t\t\t\treturn contentPack;\n\t\t\t\t})\n\t\t\t);\n\n\t\t\tfor (const contentPack of contentPacks) {\n\t\t\t\tawait dispatch('contentPack', contentPack);\n\t\t\t}\n\n\t\t\treturn contentPacks.map(x => x.packId);\n\t\t},\n\t},\n\tgetters: {\n\t\tgetCharacters({\n\t\t\tcurrent,\n\t\t}): Map<Character<IAsset>['id'], Character<IAsset>> {\n\t\t\tconst ret = new Map<Character<IAsset>['id'], Character<IAsset>>();\n\t\t\tfor (const character of current.characters) {\n\t\t\t\tret.set(character.id, character);\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\tgetBackgrounds({ current }): BackgroundLookup {\n\t\t\tconst ret = new Map<Background<IAsset>['id'], Background<IAsset>>();\n\t\t\tfor (const background of current.backgrounds) {\n\t\t\t\tret.set(background.id, background);\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t},\n} as Module<IContentState, IRootState>;\n\nfunction sortByDependencies(\n\tpacks: Array<ContentPack<IAsset>>\n): Array<ContentPack<IAsset>> {\n\treturn packs;\n}\n\nasync function convertContentPack(\n\tpack: ContentPack<string>\n): Promise<ContentPack<IAsset>> {\n\tconst types: ReadonlySet<string> = new Set(\n\t\t(await isWebPSupported()) ? ['webp', ...baseTypes] : baseTypes\n\t);\n\n\tconst replacementMap = new Map([\n\t\t['ext', '{lq:.lq:}.{format:webp:webp:png:png}'],\n\t]);\n\n\tconst ret = assetWalker(\n\t\tpack,\n\t\t(path: string, type: 'image' | 'font'): IAsset => {\n\t\t\tconst hq = normalizePath(path, replacementMap, types, false);\n\t\t\tconst lq = normalizePath(path, replacementMap, types, true);\n\n\t\t\treturn {\n\t\t\t\thq,\n\t\t\t\tlq,\n\t\t\t\tsourcePack: pack.packId || 'buildIn',\n\t\t\t};\n\t\t}\n\t) as ContentPack<IAsset>;\n\treturn ret;\n}\n\nfunction error(msg: string, payload?: any): never {\n\tconsole.error(msg, payload);\n\tthrow new Error(msg);\n}\n\n// tslint:disable: indent\nexport type ReplaceContentPackAction =\n\t| {\n\t\t\tcontentPack: ContentPack<string>;\n\t\t\tprocessed: false;\n\t  }\n\t| {\n\t\t\tcontentPack: ContentPack<IAsset>;\n\t\t\tprocessed: true;\n\t  };\n// tslint:enable: indent\n","import { createStore } from 'vuex';\nimport objects, { IObjectsState } from './objects';\nimport ui, { IUiState } from './ui';\nimport panels, { IPanels } from './panels';\nimport content, { IContentState, IAsset } from './content';\nimport { ContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\n\nexport interface IRootState {\n\tobjects: IObjectsState;\n\tui: IUiState;\n\tpanels: IPanels;\n\tcontent: IContentState;\n\tunsafe: boolean;\n}\n\nexport default createStore({\n\tstate: {\n\t\tunsafe: false,\n\t} as any,\n\tmutations: {\n\t\tsetUnsafe(state, unsafe: boolean) {\n\t\t\tstate.unsafe = unsafe;\n\t\t},\n\t},\n\tactions: {\n\t\tasync removePacks(\n\t\t\t{ dispatch, commit, state },\n\t\t\t{ packs }: IRemovePacksAction\n\t\t) {\n\t\t\tconst oldState: ContentPack<IAsset> = JSON.parse(\n\t\t\t\tJSON.stringify(state.content.current)\n\t\t\t);\n\n\t\t\tcommit('setUnsafe', true);\n\t\t\tawait dispatch('content/removeContentPacks', packs);\n\t\t\tawait dispatch('panels/fixContentPackRemoval', oldState);\n\t\t\tawait dispatch('objects/fixContentPackRemoval', oldState);\n\t\t\tcommit('setUnsafe', false);\n\t\t},\n\t},\n\tmodules: { objects, ui, panels, content },\n});\n\nexport interface IRemovePacksAction {\n\tpacks: Set<string>;\n}\n","import { reactive } from 'vue';\n\nexport default {\n\t/**\n\t *\n\t * @param {Vue} Vue\n\t * @param {{}} options\n\t */\n\tinstall(vueApp, options = {}) {\n\t\tif (!vueApp.config.globalProperties.$store) {\n\t\t\tthrow new Error(\n\t\t\t\t'VuexUndoRedo plugin must be installed after the Vuex plugin.'\n\t\t\t);\n\t\t}\n\t\tif (!options.resetStateMutation) options.resetStateMutation = 'emptyState';\n\t\tif (!options.mutations) options.mutations = {};\n\n\t\tconst $store = vueApp.config.globalProperties.$store;\n\n\t\t/**\n\t\t * @param {Vue} vm\n\t\t * @param {*} mutation\n\t\t */\n\t\tfunction replayMutation(vm, mutation) {\n\t\t\tlet baseObj = {};\n\t\t\tswitch (typeof mutation.payload) {\n\t\t\t\tcase 'object':\n\t\t\t\t\tif (mutation.payload instanceof Array) {\n\t\t\t\t\t\tbaseObj = [];\n\t\t\t\t\t}\n\t\t\t\t\t$store.commit(\n\t\t\t\t\t\t`${mutation.type}`,\n\t\t\t\t\t\tObject.assign(baseObj, mutation.payload)\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t$store.commit(`${mutation.type}`, mutation.payload);\n\t\t\t}\n\t\t}\n\n\t\tasync function replayTransaction(vm, transaction) {\n\t\t\treturn await vm.transaction(() => {\n\t\t\t\ttransaction.forEach(mutation => {\n\t\t\t\t\treplayMutation(vm, mutation);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * @param {Vue} vm\n\t\t * @param {*} mutation\n\t\t */\n\t\tasync function replayAll(vm) {\n\t\t\tconst oldTransactions = vm.data.done.slice(0);\n\t\t\tvm.data.done = [];\n\t\t\t$store.commit(options.resetStateMutation);\n\t\t\tfor (let i = 0; i < oldTransactions.length; ++i) {\n\t\t\t\tawait replayTransaction(vm, oldTransactions[i]);\n\t\t\t}\n\t\t}\n\n\t\tconst mutationProperiesCache = {};\n\n\t\t/**\n\t\t *\n\t\t * @param {IHistoryOptions} options\n\t\t * @param {*} name\n\t\t */\n\t\tfunction getMutationProperties(name) {\n\t\t\tif (!mutationProperiesCache[name]) {\n\t\t\t\tconst parts = name.split('/');\n\t\t\t\tconst mutationProperties = {\n\t\t\t\t\tignore: mutation => false,\n\t\t\t\t\tcombinable: (oldMutation, newMutation) => false,\n\t\t\t\t\tcombinator: (oldMutation, newMutation) => newMutation,\n\t\t\t\t};\n\t\t\t\tlet currentWildcard = '';\n\t\t\t\tfor (const part of parts) {\n\t\t\t\t\tif (options.mutations[currentWildcard + '*']) {\n\t\t\t\t\t\tObject.assign(\n\t\t\t\t\t\t\tmutationProperties,\n\t\t\t\t\t\t\toptions.mutations[currentWildcard + '*']\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcurrentWildcard += part + '/';\n\t\t\t\t}\n\t\t\t\tif (options.mutations[name]) {\n\t\t\t\t\tObject.assign(mutationProperties, options.mutations[name]);\n\t\t\t\t}\n\t\t\t\tmutationProperiesCache[name] = mutationProperties;\n\t\t\t}\n\t\t\treturn mutationProperiesCache[name];\n\t\t}\n\n\t\tconst history = {\n\t\t\tdata: reactive({\n\t\t\t\tdone: [],\n\t\t\t\tundone: [],\n\t\t\t\tnewMutation: true,\n\t\t\t\tignoreMutations: options.ignoreMutations || [],\n\t\t\t\tcurrentTransaction: null,\n\t\t\t\ttransactionQueue: [],\n\t\t\t\tinitialized: false,\n\t\t\t}),\n\t\t\tinitialize() {\n\t\t\t\tif (history.initialized) return;\n\t\t\t\thistory.initialized = true;\n\t\t\t\t$store.subscribe(mutation => {\n\t\t\t\t\tconst exec = () => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tmutation.type === options.resetStateMutation ||\n\t\t\t\t\t\t\tgetMutationProperties(mutation.type).ignore(mutation)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\thistory.currentTransaction.push(mutation);\n\t\t\t\t\t\tif (history.newMutation) {\n\t\t\t\t\t\t\thistory.data.undone = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tif (history.currentTransaction) {\n\t\t\t\t\t\texec();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If a mutation triggers outside of any transaction, it gets it's own transaction\n\t\t\t\t\t\thistory.transaction(() => {\n\t\t\t\t\t\t\texec();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tredo() {\n\t\t\t\tif (history.data.undone.length <= 0) return;\n\t\t\t\tconst commit = history.data.undone.pop();\n\t\t\t\thistory.newMutation = false;\n\t\t\t\treplayTransaction(history, commit);\n\t\t\t\thistory.newMutation = true;\n\t\t\t},\n\t\t\tasync undo() {\n\t\t\t\tif (history.data.done.length <= 0) return;\n\t\t\t\thistory.data.undone.push(history.data.done.pop());\n\t\t\t\thistory.newMutation = false;\n\t\t\t\tawait replayAll(history);\n\t\t\t\thistory.newMutation = true;\n\t\t\t},\n\t\t\t/**\n\t\t\t * @param {transactionCallback} callback\n\t\t\t */\n\t\t\ttransaction(callback) {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst exec = async () => {\n\t\t\t\t\t\thistory.currentTransaction = [];\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait callback();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.log('Error during transaction!: ', e);\n\t\t\t\t\t\t\t// reject(e);\n\t\t\t\t\t\t\t//this.currentTransaction = [];\n\t\t\t\t\t\t\t// The transaction that just failed is not in the undo history yet.\n\t\t\t\t\t\t\t// So replaying that is equivalent to undoing the transaction.\n\t\t\t\t\t\t\t//replayAll(this);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst lastUndo = history.data.done[history.data.done.length - 1];\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\thistory.currentTransaction.length === 1 &&\n\t\t\t\t\t\t\tlastUndo &&\n\t\t\t\t\t\t\tlastUndo.length === 1\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tconst options = getMutationProperties(\n\t\t\t\t\t\t\t\thistory.currentTransaction[0].type\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\toptions.combinable(lastUndo[0], history.currentTransaction[0])\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tconst combination = options.combinator(\n\t\t\t\t\t\t\t\t\tlastUndo[0],\n\t\t\t\t\t\t\t\t\thistory.currentTransaction[0]\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\thistory.data.done.pop();\n\t\t\t\t\t\t\t\tif (combination) {\n\t\t\t\t\t\t\t\t\thistory.currentTransaction = [combination];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// Returning a non-truthy value in the combinator simply eliminates both transactions.\n\t\t\t\t\t\t\t\t\t// So if the user manually undoes an action, you can just pretend it never happened.\n\t\t\t\t\t\t\t\t\thistory.currentTransaction = [];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (history.currentTransaction.length > 0) {\n\t\t\t\t\t\t\thistory.data.done.push(history.currentTransaction);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thistory.currentTransaction = null;\n\t\t\t\t\t\tif (history.data.transactionQueue.length > 0) {\n\t\t\t\t\t\t\thistory.data.transactionQueue.pop()();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t};\n\t\t\t\t\tif (history.currentTransaction) {\n\t\t\t\t\t\thistory.data.transactionQueue.push(exec);\n\t\t\t\t\t} else {\n\t\t\t\t\t\texec();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t};\n\n\t\tvueApp.config.globalProperties.vuexHistory = history;\n\t\thistory.initialize();\n\t},\n};\n\n/**\n * @callback transactionCallback\n * @async\n */\n","import { createApp } from 'vue';\r\nimport App from './App.vue';\r\nimport store from './store';\r\nimport History from './plugins/vuex-history';\r\n\r\ncreateApp(App)\r\n\t.use(store)\r\n\t.use(History)\r\n\t.mount('#app');\r\n","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./notification.vue?vue&type=style&index=0&id=88ed25a2&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./notification.vue?vue&type=style&index=0&id=88ed25a2&lang=scss&scoped=true\"","export { default } from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./drop-target.vue?vue&type=style&index=0&id=032c021c&lang=css&scoped=true\"; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./drop-target.vue?vue&type=style&index=0&id=032c021c&lang=css&scoped=true\"","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./backgrounds.vue?vue&type=style&index=0&id=43d75d36&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./backgrounds.vue?vue&type=style&index=0&id=43d75d36&lang=scss&scoped=true\"","<template>\n\t<div\n\t\tv-if=\"visible\"\n\t\t@dragleave=\"visible = false\"\n\t\t@drop=\"drop\"\n\t\t:class=\"{ vertical: vertical }\"\n\t>\n\t\t<slot />\n\t</div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tdata: () => ({\n\t\tvisible: false,\n\t}),\n\tmethods: {\n\t\tshow(): void {\n\t\t\tthis.visible = true;\n\t\t},\n\t\thide(): void {\n\t\t\tthis.visible = false;\n\t\t},\n\t\tdrop(e: DragEvent): void {\n\t\t\tthis.hide();\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (!e.dataTransfer) return;\n\n\t\t\tfor (const item of e.dataTransfer.items) {\n\t\t\t\tif (item.kind === 'file' && item.type.match(/image.*/)) {\n\t\t\t\t\tthis.$emit('drop', item.getAsFile());\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n});\n</script>\n<style lang=\"css\" scoped>\ndiv {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground: rgba(50, 50, 50, 0.75);\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tcolor: white;\n\ttext-shadow: 2px black;\n\tfont-size: 24px;\n\ttext-shadow: 0 0 4px #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000,\n\t\t1px 1px 0 #000;\n\tfont-size: 24px;\n\tfont-family: riffic, sans-serif;\n}\n</style>\n","\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tdata: () => ({\n\t\tvisible: false,\n\t}),\n\tmethods: {\n\t\tshow(): void {\n\t\t\tthis.visible = true;\n\t\t},\n\t\thide(): void {\n\t\t\tthis.visible = false;\n\t\t},\n\t\tdrop(e: DragEvent): void {\n\t\t\tthis.hide();\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (!e.dataTransfer) return;\n\n\t\t\tfor (const item of e.dataTransfer.items) {\n\t\t\t\tif (item.kind === 'file' && item.type.match(/image.*/)) {\n\t\t\t\t\tthis.$emit('drop', item.getAsFile());\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n});\n","import { render } from \"./drop-target.vue?vue&type=template&id=032c021c&scoped=true&bindings={}\"\nimport script from \"./drop-target.vue?vue&type=script&lang=ts\"\nexport * from \"./drop-target.vue?vue&type=script&lang=ts\"\n\nimport \"./drop-target.vue?vue&type=style&index=0&id=032c021c&lang=css&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-032c021c\"\n\nexport default script","export { default } from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./toolbox.vue?vue&type=style&index=0&lang=scss\"; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./toolbox.vue?vue&type=style&index=0&lang=scss\"","export { default } from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./add.vue?vue&type=style&index=0&id=1d4627bd&lang=scss&scoped=true\"; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./add.vue?vue&type=style&index=0&id=1d4627bd&lang=scss&scoped=true\"","export { default } from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./button.vue?vue&type=style&index=0&id=1cae163a&lang=scss&scoped=true\"; export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./button.vue?vue&type=style&index=0&id=1cae163a&lang=scss&scoped=true\"","export { default } from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./d-fieldset.vue?vue&type=style&index=0&id=779c4f22&scoped=true&lang=css\"; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./d-fieldset.vue?vue&type=style&index=0&id=779c4f22&scoped=true&lang=css\"","export { default } from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./partButton.vue?vue&type=style&index=0&id=002d03a0&lang=scss&scoped=true\"; export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./partButton.vue?vue&type=style&index=0&id=002d03a0&lang=scss&scoped=true\"","export { default } from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./d-button.vue?vue&type=style&index=0&id=5803ca69&lang=scss&scoped=true\"; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./d-button.vue?vue&type=style&index=0&id=5803ca69&lang=scss&scoped=true\"","import { RenderContext } from './rendererContext';\nimport { RenderAbortedException } from './renderAbortedException';\nimport environment from '@/environments/environment';\nimport { screenWidth, screenHeight } from '@/constants/base';\n\nexport class Renderer {\n\tprivate previewCanvas: HTMLCanvasElement;\n\tprivate runningContext: RenderContext | null = null;\n\n\tpublic constructor(w: number = screenWidth, h: number = screenHeight) {\n\t\tthis.previewCanvas = document.createElement('canvas');\n\t\tthis.previewCanvas.width = w;\n\t\tthis.previewCanvas.height = h;\n\t}\n\n\tpublic async render(\n\t\trenderCallback: (rc: RenderContext) => Promise<void>,\n\t\thq: boolean = true,\n\t\tpreview: boolean = true\n\t): Promise<boolean> {\n\t\tif (this.runningContext) {\n\t\t\tthis.runningContext.abort();\n\t\t}\n\n\t\tconst ctx = this.previewCanvas.getContext('2d')!;\n\t\tctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n\t\tconst context = (this.runningContext = new RenderContext(ctx, hq, preview));\n\t\ttry {\n\t\t\tawait renderCallback(this.runningContext);\n\t\t} catch (e) {\n\t\t\tif (e instanceof RenderAbortedException) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthrow e;\n\t\t} finally {\n\t\t\tif (context === this.runningContext) {\n\t\t\t\tthis.runningContext = null;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic get width(): number {\n\t\treturn this.previewCanvas.width;\n\t}\n\n\tpublic get height(): number {\n\t\treturn this.previewCanvas.height;\n\t}\n\n\tpublic paintOnto(\n\t\tc: CanvasRenderingContext2D,\n\t\tx: number,\n\t\ty: number,\n\t\tw?: number,\n\t\th?: number\n\t) {\n\t\tif (w && h) {\n\t\t\tc.drawImage(this.previewCanvas, x, y, w, h);\n\t\t} else {\n\t\t\tc.drawImage(this.previewCanvas, x, y);\n\t\t}\n\t}\n\n\tpublic async download(\n\t\trenderCallback: (rc: RenderContext) => Promise<void>,\n\t\tfilename: string\n\t): Promise<string> {\n\t\tconst downloadCanvas = document.createElement('canvas');\n\t\tdownloadCanvas.width = this.previewCanvas.width;\n\t\tdownloadCanvas.height = this.previewCanvas.height;\n\n\t\tconst ctx = downloadCanvas.getContext('2d')!;\n\t\tctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n\t\tawait renderCallback(new RenderContext(ctx, true, false));\n\n\t\treturn environment.saveToFile(downloadCanvas, filename);\n\t}\n\n\tpublic async renderToBlob(\n\t\trenderCallback: (rc: RenderContext) => Promise<void>\n\t): Promise<Blob> {\n\t\tconst downloadCanvas = document.createElement('canvas');\n\t\tdownloadCanvas.width = this.previewCanvas.width;\n\t\tdownloadCanvas.height = this.previewCanvas.height;\n\n\t\tconst ctx = downloadCanvas.getContext('2d')!;\n\t\tctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n\t\tawait renderCallback(new RenderContext(ctx, true, false));\n\t\treturn await new Promise<Blob>((resolve, reject) => {\n\t\t\tdownloadCanvas.toBlob(blob => {\n\t\t\t\tif (blob) resolve(blob);\n\t\t\t\telse reject();\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic getDataAt(x: number, y: number): Uint8ClampedArray {\n\t\tconst ctx = this.previewCanvas.getContext('2d');\n\n\t\treturn ctx!.getImageData(x, y, 1, 1).data;\n\t}\n}\n","// tslint:disable: no-magic-numbers\nexport const screenWidth = 1280;\nexport const screenHeight = 720;\n\nexport const positions = [\n\t'4-1',\n\t'3-1',\n\t'2-1',\n\t'4-2',\n\t'center',\n\t'4-3',\n\t'2-2',\n\t'3-3',\n\t'4-4',\n];\n\nexport const characterPositions = [\n\t200,\n\t240,\n\t400,\n\t493,\n\t640,\n\t786,\n\t880,\n\t1040,\n\t1080,\n];\n"],"sourceRoot":""}