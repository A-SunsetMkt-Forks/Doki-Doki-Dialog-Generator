{"version":3,"sources":["webpack:///./src/components/content-pack-builder/expression-builder/selection.vue?3317","webpack:///./src/components/content-pack-builder/expression-builder/selector.vue?66dc","webpack:///./src/components/content-pack-builder/expression-builder/index.vue?3468","webpack:///./src/components/content-pack-builder/expression-builder/selection.vue?9778","webpack:///./src/components/content-pack-builder/expression-builder/selection.vue?84b1","webpack:///./src/components/content-pack-builder/expression-builder/selection.vue?22dc","webpack:///./src/components/content-pack-builder/expression-builder/selection.vue","webpack:///./src/components/content-pack-builder/expression-builder/selector.vue?6959","webpack:///./src/components/content-pack-builder/expression-builder/selector.vue?ed73","webpack:///./src/components/content-pack-builder/expression-builder/selector.vue?434c","webpack:///./src/components/content-pack-builder/expression-builder/selector.vue","webpack:///./src/components/vertical-scroll-redirect.ts","webpack:///./src/util/workBatch/internalState.ts","webpack:///./src/util/workBatch/index.ts","webpack:///./src/components/content-pack-builder/expression-builder/index.vue?4014","webpack:///./src/components/content-pack-builder/expression-builder/index.vue?953b","webpack:///./src/components/content-pack-builder/expression-builder/index.vue","webpack:///./src/components/content-pack-builder/expression-builder/index.vue?f18d"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","on","dragEnter","hideDt","_v","headGroup","method","uploadsFinished","_s","Math","round","batchRunner","percentage","normalizeName","name","ref","addByImageFile","$event","verticalScrollRedirect","$refs","upload","click","attrs","addByUpload","addByUrl","_l","expression","idx","key","class","expression_item","active","currentUploadedExpression","style","backgroundImage","previewPoses","previewPoseIdx","width","height","directives","rawName","value","$$selectedVal","Array","prototype","filter","call","target","options","o","selected","map","val","_value","multiple","pose","domProps","modifiers","composing","offsetX","_n","$forceUpdate","offsetY","imagePatching","mask","model","callback","$$v","addMask","_e","addition","addExtras","removeUploadedExpression","finishUpload","leave","hasParts","headgroup","preview","staticRenderFns","background","stopPropagation","$emit","icon","label","images","i","join","default","components","component","_t","firefoxDeltaFactor","e","type","currentTarget","ev","deltaY","mozInputSource","scrollLeft","busy","error","completed","fullCount","runner","disposer","parallel","state","pendingData","currentlyRunning","Set","resolveCurrentRun","rejectCurrentRun","returnData","remainingDisposers","runningDisposers","newData","reject","slice","length","Promise","resolve","restock","remainingCapacity","startOne","size","startDisposer","data","shift","undefined","add","isRunning","has","ret","delete","values","next","reset","message","uploadedExpressionsPack","packId","dependencies","packCredits","characters","fonts","sprites","poemStyles","poemBackgrounds","backgrounds","colors","masks","adds","partFiles","everythingBroken","uploadedExpressions","processExpression","bind","asset","window","exp","initHeadGroup","availableHeadGroups","find","group","applySingleHeadGroup","uploadInput","files","file","url","URL","createObjectURL","addUrl","environment","prompt","push","renderer","renderToBlob","rx","drawImage","image","x","y","w","h","composite","blob","finalExpression","startsWith","revokeObjectURL","charDefDefaults","poseId","posePositions","head","indexOf","temporaryCharacterModel","charRenderer","$nextTick","ctx","getContext","clearRect","paintOnto","run","processedExpressions","storeCharacter","$store","content","current","char","id","character","heads","styleGroups","chibi","storeHeadGroup","previewSize","previewOffset","variants","processedExpression","vuexHistory","transaction","dispatch","contentPack","splice","parts","split","actualName","trim","toUpperCase","toLowerCase","dataTransfer","effectAllowed","from","items","item","match","dt","show","hide","characterData","headTypes","Object","keys","headTypeKey","headType","lq","partsFiles","poses","styleGroupIdx","styleGroup","styleIdx","styles","poseIdx","compatibleHeads","includes","styleGroupId","styleId","hq","sourcePack","expressionModels","styleComponents","renderCommands","headIdx","findIndex","command","headRenderCommand","newHeadCommand","offset","nr","Selection","Selector","ToggleBox","DropTarget","characterType","freeMove","close","panelId","preserveRatio","ratio","opacity","version","flip","onTop"],"mappings":"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","file":"js/chunk-164650d4.ac1ccc23.js","sourcesContent":["import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection.vue?vue&type=style&index=0&id=055af9e0&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection.vue?vue&type=style&index=0&id=055af9e0&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selector.vue?vue&type=style&index=0&id=0b6e2f14&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selector.vue?vue&type=style&index=0&id=0b6e2f14&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"wrapper\",on:{\"dragenter\":_vm.dragEnter,\"mouseleave\":_vm.hideDt}},[_c('h1',[_vm._v(\"Add expressions\")]),(!_vm.headGroup)?_c('selector',{attrs:{\"label\":\"What kind of expression would you like to add?\"}},_vm._l((_vm.availableHeadGroups),function(headgroup){return _c('selection',{key:headgroup.name,attrs:{\"label\":_vm.normalizeName(headgroup.name),\"images\":headgroup.preview},on:{\"selected\":function($event){_vm.headGroup = headgroup}}})}),1):(!_vm.method)?_c('selector',{attrs:{\"label\":\"How would you like to add the new expressions?\"}},[_c('selection',{attrs:{\"label\":\"Build expressions from parts\",\"icon\":\"info\",\"disabled\":_vm.hasParts},on:{\"selected\":function($event){_vm.method = 'parts'}}}),_c('selection',{attrs:{\"label\":\"Upload expression images\",\"icon\":\"info\"},on:{\"selected\":function($event){_vm.method = 'upload'}}})],1):(_vm.method === 'upload')?[(!_vm.uploadsFinished)?_c('div',{staticClass:\"page\"},[_c('h2',[_vm._v(\"Upload new '\"+_vm._s(_vm.normalizeName(_vm.headGroup.name))+\"' expressions\")]),_c('drop-target',{ref:\"dt\",staticClass:\"drop-target\",on:{\"drop\":_vm.addByImageFile}},[_vm._v(\"Drop here to add as a new expression\")]),_c('div',{staticClass:\"expression_list_wrapper\"},[_c('div',{staticClass:\"expression_list\",on:{\"&wheel\":function($event){return _vm.verticalScrollRedirect($event)}}},[_c('button',{on:{\"click\":function($event){return _vm.$refs.upload.click()}}},[_vm._v(\" Upload expression \"),_c('input',{ref:\"upload\",attrs:{\"type\":\"file\",\"multiple\":\"\"},on:{\"change\":_vm.addByUpload}})]),_c('button',{on:{\"click\":_vm.addByUrl}},[_vm._v(\"Add expression from URL\")]),_vm._l((_vm.uploadedExpressions),function(expression,idx){return _c('div',{key:idx,class:{\n\t\t\t\t\t\t\texpression_item: true,\n\t\t\t\t\t\t\tactive: _vm.currentUploadedExpression === expression,\n\t\t\t\t\t\t},style:({ backgroundImage: (\"url('\" + expression + \"')\") }),on:{\"click\":function($event){_vm.currentUploadedExpression = expression}}})})],2),_c('div',{staticClass:\"options_wrapper\"},[_c('div',{staticClass:\"image\"},[_c('canvas',{ref:\"target\",attrs:{\"width\":_vm.previewPoses[_vm.previewPoseIdx].width,\"height\":_vm.previewPoses[_vm.previewPoseIdx].height}})]),_c('div',[_vm._v(\" Preview pose: \"),_c('select',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.previewPoseIdx),expression:\"previewPoseIdx\"}],on:{\"change\":function($event){var $$selectedVal = Array.prototype.filter.call($event.target.options,function(o){return o.selected}).map(function(o){var val = \"_value\" in o ? o._value : o.value;return val}); _vm.previewPoseIdx=$event.target.multiple ? $$selectedVal : $$selectedVal[0]}}},_vm._l((_vm.previewPoses),function(pose,idx){return _c('option',{key:idx,domProps:{\"value\":idx}},[_vm._v(_vm._s(_vm.normalizeName(pose.name)))])}),0),_c('fieldset',[_c('legend',[_vm._v(\"Offset\")]),_c('table',[_c('tr',[_c('th',[_vm._v(\"X:\")]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.offsetX),expression:\"offsetX\",modifiers:{\"number\":true}}],attrs:{\"type\":\"number\"},domProps:{\"value\":(_vm.offsetX)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.offsetX=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})]),_c('th',[_vm._v(\"Y:\")]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.offsetY),expression:\"offsetY\",modifiers:{\"number\":true}}],attrs:{\"type\":\"number\"},domProps:{\"value\":(_vm.offsetY)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.offsetY=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})])])])]),(_vm.headGroup.imagePatching && _vm.headGroup.imagePatching.mask)?_c('toggle-box',{attrs:{\"label\":\"Reduce to fit DDDG standard\"},model:{value:(_vm.addMask),callback:function ($$v) {_vm.addMask=$$v},expression:\"addMask\"}}):_vm._e(),(\n\t\t\t\t\t\t\t\t_vm.headGroup.imagePatching && _vm.headGroup.imagePatching.addition\n\t\t\t\t\t\t\t)?_c('toggle-box',{attrs:{\"label\":\"Add new parts to fit DDDG standard\"},model:{value:(_vm.addExtras),callback:function ($$v) {_vm.addExtras=$$v},expression:\"addExtras\"}}):_vm._e(),_c('button',{attrs:{\"disabled\":_vm.currentUploadedExpression === null},on:{\"click\":_vm.removeUploadedExpression}},[_vm._v(\" Remove this expression \")]),_c('button',{on:{\"click\":_vm.finishUpload}},[_vm._v(\"Finish\")]),_c('button',{on:{\"click\":_vm.leave}},[_vm._v(\"Abort\")])],1)])])],1):_c('div',[_c('h2',[_vm._v(\" Finishing up images. \"+_vm._s(Math.round(_vm.batchRunner.percentage * 100))+\"% \")])])]:_vm._e()],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"selection\",style:({ background: _vm.background }),on:{\"click\":function($event){$event.stopPropagation();return _vm.$emit('selected')}}},[_c('div',{staticClass:\"icon material-icons\"},[_vm._v(_vm._s(_vm.icon))]),_c('div',{staticClass:\"label\"},[_vm._v(_vm._s(_vm.label))])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\r\n// App.vue has currently so many responsiblities that it's best to break it into chunks\r\nimport { Component, Vue, Prop } from 'vue-property-decorator';\r\n\r\n@Component({\r\n\tcomponents: {},\r\n})\r\nexport default class Selection extends Vue {\r\n\t@Prop() private icon!: string;\r\n\t@Prop() private label!: string;\r\n\t@Prop({ default: [] }) private images!: string[];\r\n\r\n\tpublic get background(): string {\r\n\t\treturn this.images\r\n\t\t\t.map(i => `center / contain no-repeat url('${i}')`)\r\n\t\t\t.join(',');\r\n\t}\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--13-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--13-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./selection.vue?vue&type=template&id=055af9e0&scoped=true&\"\nimport script from \"./selection.vue?vue&type=script&lang=ts&\"\nexport * from \"./selection.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./selection.vue?vue&type=style&index=0&id=055af9e0&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"055af9e0\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"selector\"},[_vm._t(\"default\")],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\r\n// App.vue has currently so many responsiblities that it's best to break it into chunks\r\nimport { Component, Vue } from 'vue-property-decorator';\r\n\r\n@Component({\r\n\tcomponents: {},\r\n})\r\nexport default class Selector extends Vue {}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--13-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selector.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--13-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selector.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./selector.vue?vue&type=template&id=0b6e2f14&scoped=true&\"\nimport script from \"./selector.vue?vue&type=script&lang=ts&\"\nexport * from \"./selector.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./selector.vue?vue&type=style&index=0&id=0b6e2f14&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0b6e2f14\",\n  null\n  \n)\n\nexport default component.exports","import { Component, Vue } from 'vue-property-decorator';\r\n\r\nconst firefoxDeltaFactor = 25;\r\n\r\n@Component({})\r\nexport class VerticalScrollRedirect extends Vue {\r\n\tpublic verticalScrollRedirect(e: WheelEvent) {\r\n\t\tif (e.type !== 'wheel') return;\r\n\t\tif (!e.currentTarget) return;\r\n\t\tconst target = e.currentTarget as HTMLElement;\r\n\r\n\t\tconst ev = e as WheelEvent;\r\n\t\tif (ev.deltaY === 0) return;\r\n\t\tif ((ev as any).mozInputSource) {\r\n\t\t\t// Firefox sends wierdly low delta values :/\r\n\t\t\ttarget.scrollLeft += ev.deltaY * firefoxDeltaFactor;\r\n\t\t} else {\r\n\t\t\ttarget.scrollLeft += ev.deltaY;\r\n\t\t}\r\n\t}\r\n}\r\n","import { Component, Vue } from 'vue-property-decorator';\r\n\r\n@Component({})\r\nexport class InternalState extends Vue {\r\n\tpublic busy: boolean = false;\r\n\tpublic error: string | null = null;\r\n\tpublic completed = 0;\r\n\tpublic fullCount = 0;\r\n}\r\n","import { Vue } from 'vue-property-decorator';\r\nimport { InternalState } from './internalState';\r\n\r\ntype Runner<P, R> = (\r\n\tpayload: P,\r\n\tisRunning: () => boolean\r\n) => Promise<R | undefined>;\r\n\r\ntype Disposer<R> = (payload: R) => Promise<void>;\r\n\r\nexport class WorkBatch<P, R> {\r\n\tprivate state = new Vue(InternalState) as InternalState;\r\n\tprivate pendingData: P[] = [];\r\n\tprivate currentlyRunning = new Set<P>();\r\n\tprivate resolveCurrentRun:\r\n\t\t| null\r\n\t\t| ((data: Array<R | undefined>) => void) = null;\r\n\tprivate rejectCurrentRun: null | (() => void) = null;\r\n\tprivate returnData: Array<R | undefined> = [];\r\n\r\n\tprivate remainingDisposers: Set<R> = new Set<R>();\r\n\tprivate runningDisposers: Set<R> = new Set<R>();\r\n\r\n\tpublic constructor(\r\n\t\tprivate readonly runner: Runner<P, R>,\r\n\t\tprivate readonly disposer: Disposer<R>,\r\n\t\tprivate readonly parallel = 4\r\n\t) {}\r\n\r\n\tpublic run(newData: P[]): Promise<Array<R | undefined>> {\r\n\t\tif (this.rejectCurrentRun) {\r\n\t\t\tthis.reject();\r\n\t\t}\r\n\t\tnewData = newData.slice();\r\n\t\tthis.pendingData = newData;\r\n\t\tthis.returnData = [];\r\n\t\tthis.state.fullCount = newData.length;\r\n\t\tthis.state.error = null;\r\n\t\tthis.state.busy = true;\r\n\t\tthis.state.completed = 0;\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.resolveCurrentRun = resolve;\r\n\t\t\tthis.rejectCurrentRun = reject;\r\n\t\t\tif (newData.length > 0) {\r\n\t\t\t\tthis.restock();\r\n\t\t\t} else {\r\n\t\t\t\tthis.resolve();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate get remainingCapacity() {\r\n\t\treturn (\r\n\t\t\tthis.parallel - this.currentlyRunning.size - this.runningDisposers.size\r\n\t\t);\r\n\t}\r\n\r\n\tprivate restock() {\r\n\t\twhile (this.remainingCapacity > 0 && this.pendingData.length > 0) {\r\n\t\t\tthis.startOne();\r\n\t\t}\r\n\t\twhile (this.remainingCapacity > 0 && this.remainingDisposers.size > 0) {\r\n\t\t\tthis.startDisposer();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async startOne() {\r\n\t\tconst data = this.pendingData.shift();\r\n\t\tconst idx = this.returnData.length;\r\n\t\tthis.returnData[idx] = undefined;\r\n\t\tif (!data) return;\r\n\t\tthis.currentlyRunning.add(data);\r\n\t\tconst isRunning = () => this.currentlyRunning.has(data);\r\n\t\tlet ret: R | undefined;\r\n\t\ttry {\r\n\t\t\tret = await this.runner(data, isRunning);\r\n\t\t} catch (e) {\r\n\t\t\tthis.reject(e);\r\n\t\t}\r\n\t\tif (isRunning()) {\r\n\t\t\t++this.state.completed;\r\n\t\t\tthis.returnData[idx] = ret;\r\n\t\t\tthis.currentlyRunning.delete(data);\r\n\t\t\tif (this.currentlyRunning.size === 0 && this.pendingData.length === 0) {\r\n\t\t\t\tthis.resolve();\r\n\t\t\t}\r\n\t\t} else if (ret !== undefined) {\r\n\t\t\tthis.remainingDisposers.add(ret);\r\n\t\t}\r\n\t\tthis.restock();\r\n\t}\r\n\r\n\tprivate async startDisposer() {\r\n\t\tconst data = this.remainingDisposers.values().next().value;\r\n\t\tthis.remainingDisposers.delete(data);\r\n\t\tthis.runningDisposers.add(data);\r\n\t\ttry {\r\n\t\t\tawait this.disposer(data);\r\n\t\t} catch (e) {}\r\n\t\tthis.runningDisposers.delete(data);\r\n\t\tthis.restock();\r\n\t}\r\n\r\n\tprivate resolve() {\r\n\t\tthis.state.busy = false;\r\n\t\t// Just to be sure\r\n\t\tthis.state.completed = this.state.fullCount;\r\n\t\tconst returnData = this.returnData;\r\n\t\tconst resolveCurrentRun = this.resolveCurrentRun!;\r\n\t\tthis.reset();\r\n\t\tresolveCurrentRun(returnData);\r\n\t}\r\n\r\n\tprivate reject(e?: Error) {\r\n\t\tthis.state.busy = false;\r\n\t\tthis.state.error = e?.message || null;\r\n\t\tconst returnData = this.returnData;\r\n\t\tconst rejectCurrentRun = this.rejectCurrentRun!;\r\n\t\tthis.reset();\r\n\t\tfor (const data of returnData) {\r\n\t\t\tif (data !== undefined) this.remainingDisposers.add(data);\r\n\t\t}\r\n\t\trejectCurrentRun();\r\n\t}\r\n\r\n\tprivate reset() {\r\n\t\tthis.returnData = [];\r\n\t\tthis.currentlyRunning = new Set<P>();\r\n\t\tthis.resolveCurrentRun = null;\r\n\t\tthis.rejectCurrentRun = null;\r\n\t}\r\n\r\n\tpublic get busy(): boolean {\r\n\t\treturn this.state.busy;\r\n\t}\r\n\r\n\tpublic get fullCount(): number {\r\n\t\treturn this.state.fullCount;\r\n\t}\r\n\r\n\tpublic get completed(): number {\r\n\t\treturn this.state.completed;\r\n\t}\r\n\r\n\tpublic get percentage(): number {\r\n\t\tif (this.fullCount === 0) return 0;\r\n\t\treturn this.completed / this.fullCount;\r\n\t}\r\n\r\n\tpublic get error(): string | null {\r\n\t\treturn this.state.error;\r\n\t}\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n// App.vue has currently so many responsiblities that it's best to break it into chunks\r\nimport { Component, Vue, Prop, Watch, Mixins } from 'vue-property-decorator';\r\nimport Selection from './selection.vue';\r\nimport Selector from './selector.vue';\r\nimport DropTarget from '../../toolbox/drop-target.vue';\r\nimport ToggleBox from '@/components/toggle.vue';\r\nimport { Store } from 'vuex';\r\nimport { IRootState } from '@/store';\r\nimport environment from '@/environments/environment';\r\nimport { VerticalScrollRedirect } from '@/components/vertical-scroll-redirect';\r\nimport { Character } from '../../../renderables/character';\r\nimport {\r\n\tContentPack,\r\n\tCharacter as CharacterModel,\r\n\tPose,\r\n\tIHeadCommand,\r\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\r\nimport { IAsset, ReplaceContentPackAction } from '../../../store/content';\r\nimport { getAssetByUrl } from '../../../asset-manager';\r\nimport { Renderer } from '../../../renderer/renderer';\r\nimport { WorkBatch } from '../../../util/workBatch';\r\nimport { IHistorySupport } from '../../../plugins/vuex-history';\r\n\r\nconst uploadedExpressionsPack: ContentPack<string> = {\r\n\tpackId: 'dddg.buildin.uploadedExpressions',\r\n\tdependencies: [],\r\n\tpackCredits: [],\r\n\tcharacters: [],\r\n\tfonts: [],\r\n\tsprites: [],\r\n\tpoemStyles: [],\r\n\tpoemBackgrounds: [],\r\n\tbackgrounds: [],\r\n\tcolors: [],\r\n};\r\n\r\nconst masks: { [s: string]: string | undefined } = {\r\n\t'dddg.buildin.base.monika:straight': 'assets/mask/monika-a-mask.png',\r\n\t'dddg.buildin.base.monika:sideways': 'assets/mask/monika-b-mask.png',\r\n\t'dddg.buildin.base.natsuki:straight': 'assets/mask/natsuki-a-mask.png',\r\n\t'dddg.buildin.base.natsuki:sideways': 'assets/mask/natsuki-b-mask.png',\r\n\t'dddg.buildin.base.natsuki:turnedAway': 'assets/mask/natsuki-c-mask.png',\r\n\t'dddg.buildin.base.sayori:straight': 'assets/mask/sayori-a-mask.png',\r\n\t'dddg.buildin.base.sayori:sideways': 'assets/mask/sayori-b-mask.png',\r\n\t'dddg.buildin.base.yuri:straight': 'assets/mask/yuri-a-mask.png',\r\n\t'dddg.buildin.base.yuri:sideways': 'assets/mask/yuri-b-mask.png',\r\n};\r\n\r\nconst adds: { [s: string]: string | undefined } = {\r\n\t'dddg.buildin.base.natsuki:straight': 'assets/mask/natsuki-a-add.png',\r\n};\r\n\r\nconst partFiles: { [s: string]: string[] | undefined } = {};\r\n\r\n@Component({\r\n\tcomponents: { Selection, Selector, ToggleBox, DropTarget },\r\n})\r\nexport default class ExpressionBuilder extends Mixins(VerticalScrollRedirect) {\r\n\tprivate static nr = 0;\r\n\r\n\t@Prop() public readonly character!: string;\r\n\t@Prop() public readonly initHeadGroup!: string | undefined;\r\n\tpublic $store!: Store<IRootState>;\r\n\r\n\tpublic method: null | 'upload' | 'parts' = 'upload';\r\n\tpublic headGroup: null | IHeadGroup = null;\r\n\tpublic uploadsFinished = false;\r\n\tpublic everythingBroken = false;\r\n\tpublic uploadedExpressions: string[] = [];\r\n\tpublic currentUploadedExpression: string | null = null;\r\n\tpublic previewPoseIdx: number = 0;\r\n\tpublic offsetX: number = 0;\r\n\tpublic offsetY: number = 0;\r\n\r\n\tpublic addMask = false;\r\n\tpublic addExtras = false;\r\n\tprivate vuexHistory!: IHistorySupport;\r\n\r\n\tprivate batchRunner = new WorkBatch<string, string>(\r\n\t\tthis.processExpression.bind(this),\r\n\t\tasync asset => {}\r\n\t);\r\n\r\n\tpublic created() {\r\n\t\t(window as any).exp = this;\r\n\t\tif (this.initHeadGroup) {\r\n\t\t\tthis.headGroup = this.availableHeadGroups.find(\r\n\t\t\t\tgroup => group.name === this.initHeadGroup\r\n\t\t\t)!;\r\n\t\t}\r\n\t\tthis.applySingleHeadGroup();\r\n\t}\r\n\r\n\tpublic get characterData(): CharacterModel<IAsset> {\r\n\t\treturn this.$store.state.content.current.characters.find(\r\n\t\t\tchar => char.id === this.character\r\n\t\t)!;\r\n\t}\r\n\r\n\tpublic get availableHeadGroups(): IHeadGroup[] {\r\n\t\tconst characterData = this.characterData;\r\n\t\tconst headTypes = Object.keys(characterData.heads);\r\n\t\treturn headTypes.map(headTypeKey => {\r\n\t\t\tconst headType = characterData.heads[headTypeKey];\r\n\r\n\t\t\treturn {\r\n\t\t\t\tname: headTypeKey,\r\n\t\t\t\tpreview: headType.variants[0].map(asset => asset.lq),\r\n\t\t\t\tpartsFiles: partFiles[headTypeKey] || [],\r\n\t\t\t\timagePatching: {\r\n\t\t\t\t\tmask: masks[headTypeKey],\r\n\t\t\t\t\taddition: adds[headTypeKey],\r\n\t\t\t\t},\r\n\t\t\t} as IHeadGroup;\r\n\t\t});\r\n\t}\r\n\r\n\t@Watch('availableHeadGroups')\r\n\tpublic applySingleHeadGroup() {\r\n\t\tif (this.availableHeadGroups.length === 1) {\r\n\t\t\tthis.headGroup = this.availableHeadGroups[0];\r\n\t\t}\r\n\t}\r\n\r\n\tpublic get hasParts(): boolean {\r\n\t\treturn !!this.availableHeadGroups.find(\r\n\t\t\theadGroup => headGroup.partsFiles.length > 0\r\n\t\t);\r\n\t}\r\n\r\n\tpublic async addByUpload(): Promise<void> {\r\n\t\tconst uploadInput = this.$refs.upload as HTMLInputElement;\r\n\t\tif (!uploadInput.files) return;\r\n\t\tfor (const file of uploadInput.files) {\r\n\t\t\tthis.addByImageFile(file);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic addByImageFile(file: File) {\r\n\t\tconst url = URL.createObjectURL(file);\r\n\t\tthis.addUrl(url);\r\n\t}\r\n\r\n\tpublic async addByUrl(): Promise<void> {\r\n\t\tconst url = await environment.prompt('Enter the url of the image.', '');\r\n\t\tif (!url) return;\r\n\t\tthis.addUrl(url);\r\n\t}\r\n\r\n\tpublic addUrl(url: string): void {\r\n\t\tthis.currentUploadedExpression = url;\r\n\t\tthis.uploadedExpressions.push(url);\r\n\t}\r\n\r\n\tpublic get previewPoses(): IPose[] {\r\n\t\tconst character = this.characterData;\r\n\t\tif (!character || !this.headGroup) return [];\r\n\t\tconst poses: IPose[] = [];\r\n\r\n\t\tfor (\r\n\t\t\tlet styleGroupIdx = 0;\r\n\t\t\tstyleGroupIdx < character.styleGroups.length;\r\n\t\t\t++styleGroupIdx\r\n\t\t) {\r\n\t\t\tconst styleGroup = character.styleGroups[styleGroupIdx];\r\n\t\t\tfor (let styleIdx = 0; styleIdx < styleGroup.styles.length; ++styleIdx) {\r\n\t\t\t\tconst style = styleGroup.styles[styleIdx];\r\n\t\t\t\tfor (let poseIdx = 0; poseIdx < style.poses.length; ++poseIdx) {\r\n\t\t\t\t\tconst pose = style.poses[poseIdx];\r\n\t\t\t\t\tif (pose.compatibleHeads.includes(this.headGroup.name)) {\r\n\t\t\t\t\t\tposes.push({\r\n\t\t\t\t\t\t\tname: pose.id,\r\n\t\t\t\t\t\t\tstyleGroupId: styleGroupIdx,\r\n\t\t\t\t\t\t\tstyleId: styleIdx,\r\n\t\t\t\t\t\t\tposeId: poseIdx,\r\n\t\t\t\t\t\t\twidth: pose.size[0],\r\n\t\t\t\t\t\t\theight: pose.size[1],\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn poses;\r\n\t}\r\n\r\n\tpublic get expressionModels(): IAsset[][] {\r\n\t\treturn this.uploadedExpressions.map(expression => [\r\n\t\t\t{\r\n\t\t\t\thq: expression,\r\n\t\t\t\tlq: expression,\r\n\t\t\t\tsourcePack: 'dddg.temp1:default',\r\n\t\t\t} as IAsset,\r\n\t\t]);\r\n\t}\r\n\r\n\tpublic get temporaryCharacterModel(): CharacterModel<IAsset> {\r\n\t\tconst poses = this.previewPoses;\r\n\t\tconst character = this.$store.state.content.current.characters.find(\r\n\t\t\tchar => char.id === this.character\r\n\t\t)!;\r\n\t\tconst offsetX = this.offsetX;\r\n\t\tconst offsetY = this.offsetY;\r\n\r\n\t\treturn {\r\n\t\t\tid: this.character,\r\n\t\t\theads: {\r\n\t\t\t\t'dddg.temp1:default': {\r\n\t\t\t\t\tvariants: this.expressionModels,\r\n\t\t\t\t\tpreviewSize: [0, 0],\r\n\t\t\t\t\tpreviewOffset: [0, 0],\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tstyleGroups: [\r\n\t\t\t\t{\r\n\t\t\t\t\tid: 'preview',\r\n\t\t\t\t\tstyleComponents: [],\r\n\t\t\t\t\tstyles: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcomponents: {},\r\n\t\t\t\t\t\t\tposes: poses.map((pose, idx) => {\r\n\t\t\t\t\t\t\t\tconst styleGroup = character.styleGroups[pose.styleGroupId];\r\n\t\t\t\t\t\t\t\tconst style = styleGroup.styles[pose.styleId];\r\n\t\t\t\t\t\t\t\tconst renderCommands = style.poses[\r\n\t\t\t\t\t\t\t\t\tpose.poseId\r\n\t\t\t\t\t\t\t\t].renderCommands.slice(0);\r\n\t\t\t\t\t\t\t\tlet headIdx = renderCommands.findIndex(\r\n\t\t\t\t\t\t\t\t\tcommand => command.type === 'head'\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tconst headRenderCommand = renderCommands[headIdx];\r\n\t\t\t\t\t\t\t\tconst newHeadCommand: IHeadCommand = {\r\n\t\t\t\t\t\t\t\t\ttype: 'head',\r\n\t\t\t\t\t\t\t\t\toffset: [\r\n\t\t\t\t\t\t\t\t\t\theadRenderCommand.offset[0] + offsetX,\r\n\t\t\t\t\t\t\t\t\t\theadRenderCommand.offset[1] + offsetY,\r\n\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\tthis.addMask &&\r\n\t\t\t\t\t\t\t\t\tthis.headGroup &&\r\n\t\t\t\t\t\t\t\t\tthis.headGroup.imagePatching &&\r\n\t\t\t\t\t\t\t\t\tthis.headGroup.imagePatching.mask\r\n\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\tconst mask = this.headGroup.imagePatching.mask;\r\n\t\t\t\t\t\t\t\t\trenderCommands.splice(headIdx, 1);\r\n\t\t\t\t\t\t\t\t\theadIdx = 1;\r\n\t\t\t\t\t\t\t\t\trenderCommands.splice(0, 0, newHeadCommand, {\r\n\t\t\t\t\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\t\t\t\t\timages: [\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\thq: mask,\r\n\t\t\t\t\t\t\t\t\t\t\t\tlq: mask,\r\n\t\t\t\t\t\t\t\t\t\t\t\tsourcePack: 'dddg.temp1',\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t\tcomposite: 'destination-in',\r\n\t\t\t\t\t\t\t\t\t\toffset: headRenderCommand.offset,\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\trenderCommands.splice(headIdx, 1, newHeadCommand);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\tthis.addExtras &&\r\n\t\t\t\t\t\t\t\t\tthis.headGroup &&\r\n\t\t\t\t\t\t\t\t\tthis.headGroup.imagePatching &&\r\n\t\t\t\t\t\t\t\t\tthis.headGroup.imagePatching.addition\r\n\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\tconst add = this.headGroup.imagePatching.addition;\r\n\t\t\t\t\t\t\t\t\trenderCommands.splice(headIdx + 1, 0, {\r\n\t\t\t\t\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\t\t\t\t\timages: [\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\thq: add,\r\n\t\t\t\t\t\t\t\t\t\t\t\tlq: add,\r\n\t\t\t\t\t\t\t\t\t\t\t\tsourcePack: 'dddg.temp1',\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t\toffset: headRenderCommand.offset,\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t...style.poses[pose.poseId],\r\n\t\t\t\t\t\t\t\t\trenderCommands,\r\n\t\t\t\t\t\t\t\t\tid: 'dddg.temp1:pose' + idx,\r\n\t\t\t\t\t\t\t\t\tcompatibleHeads: ['dddg.temp1:default'],\r\n\t\t\t\t\t\t\t\t} as Pose<IAsset>;\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\tlabel: '',\r\n\t\t\tchibi: null!,\r\n\t\t};\r\n\t}\r\n\r\n\tpublic async processExpression(\r\n\t\texpression: string,\r\n\t\tisRunning: () => boolean\r\n\t): Promise<string | undefined> {\r\n\t\tlet finalExpression: string;\r\n\t\tconst asset = (await getAssetByUrl(expression)) as HTMLImageElement;\r\n\t\tif (!isRunning()) return undefined;\r\n\t\tconst renderer = new Renderer(\r\n\t\t\tasset.width + this.offsetX,\r\n\t\t\tasset.height + this.offsetY\r\n\t\t);\r\n\t\tconst blob = await renderer.renderToBlob(async rx => {\r\n\t\t\trx.drawImage({\r\n\t\t\t\timage: asset,\r\n\t\t\t\tx: this.offsetX,\r\n\t\t\t\ty: this.offsetY,\r\n\t\t\t\tw: asset.width,\r\n\t\t\t\th: asset.height,\r\n\t\t\t});\r\n\r\n\t\t\tif (\r\n\t\t\t\tthis.addMask &&\r\n\t\t\t\tthis.headGroup &&\r\n\t\t\t\tthis.headGroup.imagePatching &&\r\n\t\t\t\tthis.headGroup.imagePatching.mask\r\n\t\t\t) {\r\n\t\t\t\tconst mask = (await getAssetByUrl(\r\n\t\t\t\t\tthis.headGroup.imagePatching.mask\r\n\t\t\t\t)) as HTMLImageElement;\r\n\t\t\t\tif (!isRunning()) return undefined;\r\n\t\t\t\trx.drawImage({\r\n\t\t\t\t\timage: mask,\r\n\t\t\t\t\tx: 0,\r\n\t\t\t\t\ty: 0,\r\n\t\t\t\t\tw: mask.width,\r\n\t\t\t\t\th: mask.height,\r\n\t\t\t\t\tcomposite: 'destination-in',\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\tthis.addExtras &&\r\n\t\t\t\tthis.headGroup &&\r\n\t\t\t\tthis.headGroup.imagePatching &&\r\n\t\t\t\tthis.headGroup.imagePatching.addition\r\n\t\t\t) {\r\n\t\t\t\tconst addition = (await getAssetByUrl(\r\n\t\t\t\t\tthis.headGroup.imagePatching.addition\r\n\t\t\t\t)) as HTMLImageElement;\r\n\t\t\t\tif (!isRunning()) return undefined;\r\n\t\t\t\trx.drawImage({\r\n\t\t\t\t\timage: addition,\r\n\t\t\t\t\tx: 0,\r\n\t\t\t\t\ty: 0,\r\n\t\t\t\t\tw: addition.width,\r\n\t\t\t\t\th: addition.height,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tfinalExpression = URL.createObjectURL(blob);\r\n\r\n\t\tif (expression !== finalExpression && expression.startsWith('blob:')) {\r\n\t\t\tURL.revokeObjectURL(expression);\r\n\t\t}\r\n\r\n\t\treturn finalExpression;\r\n\t}\r\n\r\n\t@Watch('previewPoseIdx')\r\n\t@Watch('previewPoses')\r\n\t@Watch('currentUploadedExpression')\r\n\t@Watch('offsetX')\r\n\t@Watch('offsetY')\r\n\t@Watch('addMask')\r\n\t@Watch('addExtras')\r\n\tpublic async redraw() {\r\n\t\tif (this.uploadsFinished) return;\r\n\t\tconst pose = this.previewPoses[this.previewPoseIdx];\r\n\t\tif (!pose) return;\r\n\t\tlet charRenderer: Character;\r\n\t\ttry {\r\n\t\t\tcharRenderer = new Character(\r\n\t\t\t\t{\r\n\t\t\t\t\t...charDefDefaults,\r\n\t\t\t\t\twidth: pose.width,\r\n\t\t\t\t\theight: pose.height,\r\n\t\t\t\t\tposeId: this.previewPoseIdx,\r\n\t\t\t\t\tx: pose.width / 2,\r\n\t\t\t\t\tposePositions: {\r\n\t\t\t\t\t\theadGroup: 0,\r\n\t\t\t\t\t\thead: this.uploadedExpressions.indexOf(\r\n\t\t\t\t\t\t\tthis.currentUploadedExpression!\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tawait this.temporaryCharacterModel\r\n\t\t\t);\r\n\t\t} catch (e) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.$nextTick(async () => {\r\n\t\t\tif (this.uploadsFinished) return;\r\n\t\t\tconst renderer = new Renderer(pose.width, pose.height);\r\n\t\t\tawait renderer.render(async rx => {\r\n\t\t\t\tawait charRenderer.render(false, rx);\r\n\t\t\t});\r\n\r\n\t\t\tconst target = this.$refs.target as HTMLCanvasElement;\r\n\t\t\tconst ctx = target.getContext('2d')!;\r\n\t\t\tctx.clearRect(0, 0, target.width, target.height);\r\n\t\t\trenderer.paintOnto(ctx, 0, 0, target.width, target.height);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async finishUpload() {\r\n\t\tthis.uploadsFinished = true;\r\n\t\tconst processedExpressions = (\r\n\t\t\tawait this.batchRunner.run(this.uploadedExpressions)\r\n\t\t).filter(exp => exp) as string[];\r\n\r\n\t\tconst storeCharacter = this.$store.state.content.current.characters.find(\r\n\t\t\tchar => char.id === this.character\r\n\t\t)!;\r\n\t\tlet character = uploadedExpressionsPack.characters.find(\r\n\t\t\tchar => char.id === this.character\r\n\t\t);\r\n\t\tif (!character) {\r\n\t\t\tcharacter = {\r\n\t\t\t\tid: this.character,\r\n\t\t\t\theads: {},\r\n\t\t\t\tstyleGroups: [],\r\n\t\t\t\tlabel: '',\r\n\t\t\t\tchibi: '',\r\n\t\t\t} as CharacterModel<string>;\r\n\t\t\tuploadedExpressionsPack.characters.push(character);\r\n\t\t}\r\n\r\n\t\tlet headGroup = character.heads[this.headGroup!.name];\r\n\t\tconst storeHeadGroup = storeCharacter.heads[this.headGroup!.name];\r\n\t\tif (!headGroup) {\r\n\t\t\theadGroup = {\r\n\t\t\t\tpreviewSize: storeHeadGroup.previewSize,\r\n\t\t\t\tpreviewOffset: storeHeadGroup.previewOffset,\r\n\t\t\t\tvariants: [],\r\n\t\t\t};\r\n\t\t\tcharacter.heads[this.headGroup!.name] = headGroup;\r\n\t\t}\r\n\r\n\t\tfor (const processedExpression of processedExpressions) {\r\n\t\t\theadGroup.variants.push([processedExpression]);\r\n\t\t}\r\n\r\n\t\tawait this.vuexHistory.transaction(() => {\r\n\t\t\tthis.$store.dispatch('content/replaceContentPack', {\r\n\t\t\t\tcontentPack: uploadedExpressionsPack,\r\n\t\t\t} as ReplaceContentPackAction);\r\n\t\t});\r\n\r\n\t\tthis.leave();\r\n\t}\r\n\r\n\tprivate leave() {\r\n\t\tthis.$emit('leave');\r\n\t\tthis.method = null;\r\n\t\tthis.headGroup = null;\r\n\t\tthis.uploadedExpressions = [];\r\n\t}\r\n\r\n\tprivate removeUploadedExpression() {\r\n\t\tif (!this.currentUploadedExpression) return;\r\n\t\tconst expression = this.currentUploadedExpression;\r\n\t\tthis.currentUploadedExpression = null;\r\n\t\tif (expression.startsWith('blob:')) {\r\n\t\t\tURL.revokeObjectURL(expression);\r\n\t\t}\r\n\t\tlet idx = this.uploadedExpressions.indexOf(expression);\r\n\t\tthis.uploadedExpressions.splice(idx, 1);\r\n\t\tif (idx > this.uploadedExpressions.length - 1) {\r\n\t\t\tidx = this.uploadedExpressions.length - 1;\r\n\t\t}\r\n\t\tthis.currentUploadedExpression = this.uploadedExpressions[idx] || null;\r\n\t}\r\n\r\n\tprivate normalizeName(name: string): string {\r\n\t\tconst parts = name.split(':');\r\n\t\tlet actualName = parts[parts.length - 1];\r\n\t\tconst packId = parts.length > 1 ? parts[0].trim() : '';\r\n\r\n\t\tactualName = (\r\n\t\t\tactualName[0].toUpperCase() + actualName.slice(1).toLowerCase()\r\n\t\t)\r\n\t\t\t.split('_')\r\n\t\t\t.join(' ');\r\n\t\tif (packId.startsWith('dddg.') || packId === '') {\r\n\t\t\treturn actualName;\r\n\t\t}\r\n\t\treturn packId + ': ' + actualName;\r\n\t}\r\n\r\n\tprivate dragEnter(e: DragEvent) {\r\n\t\tif (!this.headGroup || this.method !== 'upload') return;\r\n\t\tif (!e.dataTransfer) return;\r\n\t\te.dataTransfer.effectAllowed = 'none';\r\n\t\tif (\r\n\t\t\t!Array.from(e.dataTransfer.items).find(item =>\r\n\t\t\t\titem.type.match(/^image.*$/)\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\te.dataTransfer.effectAllowed = 'link';\r\n\t\t(this.$refs.dt as DropTarget).show();\r\n\t}\r\n\r\n\tprivate hideDt() {\r\n\t\tif (this.$refs.dt) (this.$refs.dt as DropTarget).hide();\r\n\t}\r\n}\r\n\r\nconst charDefDefaults = {\r\n\ttype: 'character' as 'character',\r\n\tcharacterType: '',\r\n\tfreeMove: false,\r\n\tclose: false,\r\n\tstyleGroupId: 0,\r\n\tstyleId: 0,\r\n\tposeId: 0,\r\n\tposePositions: {},\r\n\tpanelId: '',\r\n\tid: '',\r\n\ty: 0,\r\n\tpreserveRatio: true,\r\n\tratio: 1,\r\n\topacity: 100,\r\n\tversion: 1,\r\n\tflip: false,\r\n\tonTop: false,\r\n};\r\n\r\ninterface IPose {\r\n\tname: string;\r\n\tstyleGroupId: number;\r\n\tstyleId: number;\r\n\tposeId: number;\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\ninterface IHeadGroup {\r\n\tname: string;\r\n\tpreview: string[];\r\n\tpartsFiles: string[];\r\n\timagePatching?: {\r\n\t\tmask?: string;\r\n\t\taddition?: string;\r\n\t};\r\n}\r\n\r\ninterface ICachedProcessedExpression {\r\n\turl: string;\r\n\taddMask: boolean;\r\n\taddExtras: boolean;\r\n\toffsetX: number;\r\n\toffsetY: number;\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--13-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--13-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=46b32236&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=ts&\"\nexport * from \"./index.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=46b32236&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"46b32236\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=46b32236&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=46b32236&lang=scss&scoped=true&\""],"sourceRoot":""}