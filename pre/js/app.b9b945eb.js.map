{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/toolbox/subtools/color/sliderGroup.vue?c241","webpack:///./src/environments/browser.ts","webpack:///./src/environments/edge.ts","webpack:///./src/environments/electron.ts","webpack:///./src/environments/environment.ts","webpack:///./src/eventbus/event-bus.ts","webpack:///./src/components/message-console.vue?b712","webpack:///./src/renderables/character.ts","webpack:///./src/components/toolbox/tools/character/parts.vue?ae7b","webpack:///./src/components/ui/d-fieldset.vue?5378","webpack:///./src/components/toolbox/tools/notification.vue?f255","webpack:///./src/components/toolbox/tools/object-tool.vue?80ca","webpack:///./src/components/toolbox/toolbox.vue?3600","webpack:///./src/components/toolbox/commonsFieldsets/positionAndSize.vue?9b61","webpack:///./src/components/ui/link.vue","webpack:///./src/components/ui/link.vue?17aa","webpack:///./src/components/ui/link.vue?b75b","webpack:///./src/renderables/offscreenRenderable.ts","webpack:///./src/models/repo.ts","webpack:///./src/renderables/assetListRenderable.ts","webpack:///./src/components/ui/d-button.vue?18fe","webpack:///./src/components/toolbox/tools/panels.vue?44e2","webpack:///./src/components/toolbox/tools/add.vue?7e33","webpack:///./src/asset-manager.ts","webpack:///./src/components/toolbox/tools/background/settings.vue?4e30","webpack:///./src/components/toolbox/tools/choice.vue?2070","webpack:///./src/store/objectTypes/baseObjectProps.ts","webpack:///./src/components/toolbox/tools/credits.vue?600d","webpack:///./src/renderer/rendererContext.ts","webpack:///./src/components/toolbox/tools/background/button.vue?6543","webpack:///./src/components/toolbox/commonsFieldsets/layers.vue?59e8","webpack:///./src/renderer/renderAbortedException.ts","webpack:///./src/components/toolbox/subtools/image-options/image-options.vue?9b20","webpack:///./src/components/toggle.vue?38e4","webpack:///./src/components/toolbox/subtools/text/text.vue?d50f","webpack:///./src/util/rotation.ts","webpack:///./src/components/toolbox/tools/backgrounds.vue?4dc4","webpack:///./src/models/error-asset.ts","webpack:///./src/components/ui/d-flow.vue?c366","webpack:///./src/components/toolbox/tools/object-tool.vue?6b88","webpack:///./src/components/vertical-scroll-redirect.ts","webpack:///./src/components/toolbox/subtools/color/slider.vue?0f21","webpack:///./src/components/ui/d-fieldset.vue","webpack:///./src/components/ui/d-fieldset.vue?b40b","webpack:///./src/components/ui/d-fieldset.vue?68b3","webpack:///./src/store/objectTypes/characters.ts","webpack:///./src/components/ModalDialog.vue?073b","webpack:///./src/components/toolbox/subtools/color/color.vue?eb32","webpack:///./src/components/toggle.vue","webpack:///./src/components/toggle.vue?bbb0","webpack:///./src/components/toggle.vue?563e","webpack:///./src/models/seekers.ts","webpack:///./src/App.vue","webpack:///./src/components/toolbox/toolbox.vue","webpack:///./src/components/toolbox/tools/settings.vue","webpack:///./src/components/toolbox/tools/panelMixin.ts","webpack:///./src/components/ModalDialog.vue","webpack:///./src/components/ModalDialog.vue?1c09","webpack:///./src/components/ModalDialog.vue?d092","webpack:///./src/components/toolbox/tools/settings.vue?ffc4","webpack:///./src/components/toolbox/tools/settings.vue?175a","webpack:///./src/components/toolbox/tools/add.vue","webpack:///./src/components/ui/d-button.vue","webpack:///./src/components/ui/d-button.vue?c8db","webpack:///./src/components/ui/d-button.vue?96c1","webpack:///./src/components/toolbox/tools/add.vue?283d","webpack:///./src/components/toolbox/tools/add.vue?f544","webpack:///./src/components/toolbox/tools/character.vue","webpack:///./src/components/toolbox/tools/character/parts.vue","webpack:///./src/components/toolbox/tools/character/partButton.vue","webpack:///./src/components/toolbox/tools/character/partButton.vue?3b03","webpack:///./src/components/toolbox/tools/character/partButton.vue?542d","webpack:///./src/components/ui/d-flow.vue","webpack:///./src/components/ui/d-flow.vue?003a","webpack:///./src/components/toolbox/tools/character/parts.vue?7498","webpack:///./src/components/toolbox/tools/character/parts.vue?7e61","webpack:///./src/util/simpleSettable.ts","webpack:///./src/components/toolbox/tools/object-tool.vue","webpack:///./src/components/toolbox/commonsFieldsets/positionAndSize.vue","webpack:///./src/components/toolbox/commonsFieldsets/positionAndSize.vue?5867","webpack:///./src/components/toolbox/commonsFieldsets/positionAndSize.vue?28a6","webpack:///./src/components/toolbox/commonsFieldsets/layers.vue","webpack:///./src/components/toolbox/commonsFieldsets/layers.vue?ff96","webpack:///./src/components/toolbox/commonsFieldsets/layers.vue?32a0","webpack:///./src/components/toolbox/commonsFieldsets/delete.vue","webpack:///./src/components/toolbox/commonsFieldsets/delete.vue?8f34","webpack:///./src/components/toolbox/commonsFieldsets/delete.vue?3356","webpack:///./src/components/toolbox/subtools/image-options/image-options.vue","webpack:///./src/components/toolbox/subtools/color/slider.vue","webpack:///./src/components/toolbox/subtools/color/slider.vue?d57c","webpack:///./src/components/toolbox/subtools/color/slider.vue?1cb9","webpack:///./src/components/toolbox/subtools/color/color.vue","webpack:///./src/components/toolbox/subtools/color/sliderGroup.vue","webpack:///./src/util/colors/hsl.ts","webpack:///./src/util/colors/rgb.ts","webpack:///./src/components/toolbox/subtools/color/sliderGroup.vue?4e6a","webpack:///./src/components/toolbox/subtools/color/sliderGroup.vue?1ef8","webpack:///./src/components/toolbox/subtools/color/color.vue?5cc8","webpack:///./src/components/toolbox/subtools/color/color.vue?8003","webpack:///./src/util/exhaust.ts","webpack:///./src/store/sprite_options.ts","webpack:///./src/components/toolbox/subtools/image-options/image-options.vue?e076","webpack:///./src/components/toolbox/subtools/image-options/image-options.vue?11a3","webpack:///./src/components/toolbox/subtools/text/text.vue","webpack:///./src/renderer/textRenderer/string-walker.ts","webpack:///./src/renderer/textRenderer/tokenizer.ts","webpack:///./src/renderer/textRenderer/textCommands.ts","webpack:///./src/renderer/textRenderer/textRenderer.ts","webpack:///./src/constants/textBoxCustom.ts","webpack:///./src/constants/textBox.ts","webpack:///./src/components/toolbox/subtools/text/text.vue?8f59","webpack:///./src/components/toolbox/subtools/text/text.vue?e6bc","webpack:///./src/components/toolbox/tools/object-tool.vue?bb85","webpack:///./src/components/toolbox/tools/object-tool.vue?4815","webpack:///./src/components/toolbox/tools/character.vue?72b6","webpack:///./src/components/toolbox/tools/character.vue?e8cb","webpack:///./src/components/toolbox/tools/sprite.vue","webpack:///./src/components/toolbox/tools/sprite.vue?a683","webpack:///./src/components/toolbox/tools/sprite.vue?a58f","webpack:///./src/components/toolbox/tools/textbox.vue","webpack:///./src/components/toolbox/tools/textbox.vue?0f2e","webpack:///./src/components/toolbox/tools/textbox.vue?b36e","webpack:///./src/components/toolbox/tools/choice.vue","webpack:///./src/components/toolbox/tools/choice.vue?7308","webpack:///./src/components/toolbox/tools/choice.vue?ecd7","webpack:///./src/components/toolbox/tools/credits.vue","webpack:///./src/components/toolbox/tools/credits.vue?4104","webpack:///./src/components/toolbox/tools/credits.vue?4a91","webpack:///./src/components/toolbox/tools/backgrounds.vue","webpack:///./src/components/toolbox/tools/background/button.vue","webpack:///./src/components/toolbox/tools/background/button.vue?b7cb","webpack:///./src/components/toolbox/tools/background/button.vue?2499","webpack:///./src/components/toolbox/tools/background/settings.vue","webpack:///./src/components/toolbox/tools/background/settings.vue?6031","webpack:///./src/components/toolbox/tools/background/settings.vue?25f2","webpack:///./src/components/toolbox/tools/backgrounds.vue?b9bb","webpack:///./src/components/toolbox/tools/backgrounds.vue?9860","webpack:///./src/components/toolbox/tools/content-pack.vue","webpack:///./src/components/toolbox/tools/content-pack.vue?4942","webpack:///./src/components/toolbox/tools/content-pack.vue?a00e","webpack:///./src/components/toolbox/tools/panels.vue","webpack:///./src/store/panels.ts","webpack:///./src/renderables/background.ts","webpack:///./src/renderables/sprite.ts","webpack:///./src/renderer/pathTools.ts","webpack:///./src/renderables/scalingRenderable.ts","webpack:///./src/renderables/textbox.ts","webpack:///./src/constants/choices.ts","webpack:///./src/renderables/choices.ts","webpack:///./src/constants/notification.ts","webpack:///./src/renderables/notification.ts","webpack:///./src/constants/poem.ts","webpack:///./src/renderables/poem.ts","webpack:///./src/renderables/scene-renderer.ts","webpack:///./src/components/toolbox/tools/panels.vue?19b3","webpack:///./src/components/toolbox/tools/panels.vue?3f6d","webpack:///./src/components/toolbox/tools/notification.vue","webpack:///./src/components/toolbox/tools/notification.vue?5765","webpack:///./src/components/toolbox/tools/notification.vue?3253","webpack:///./src/components/toolbox/tools/poem.vue","webpack:///./src/components/toolbox/tools/poem.vue?4966","webpack:///./src/components/toolbox/tools/poem.vue?76f8","webpack:///./src/components/toolbox/toolbox.vue?d281","webpack:///./src/components/toolbox/toolbox.vue?6f67","webpack:///./src/components/message-console.vue","webpack:///./src/components/message-console.vue?c981","webpack:///./src/components/message-console.vue?fe48","webpack:///./src/components/render.vue","webpack:///./src/components/render.vue?3c85","webpack:///./src/components/render.vue?c91e","webpack:///./src/App.vue?1d14","webpack:///./src/App.vue?97f5","webpack:///./src/store/objectTypes/sprite.ts","webpack:///./src/store/objectTypes/choices.ts","webpack:///./src/store/objectTypes/textbox.ts","webpack:///./src/store/objectTypes/notification.ts","webpack:///./src/store/objectTypes/poem.ts","webpack:///./src/store/objects.ts","webpack:///./src/store/ui.ts","webpack:///./src/store/content/merge.ts","webpack:///./src/store/content/index.ts","webpack:///./src/store/index.ts","webpack:///./src/plugins/vuex-history.js","webpack:///./src/main.ts","webpack:///./src/components/toolbox/tools/settings.vue?149f","webpack:///./src/App.vue?56bf","webpack:///./src/components/toolbox/tools/textbox.vue?9d08","webpack:///./src/components/toolbox/drop-target.vue","webpack:///./src/components/toolbox/drop-target.vue?2f60","webpack:///./src/components/toolbox/drop-target.vue?d003","webpack:///./src/components/toolbox/tools/character.vue?3b75","webpack:///./src/components/toolbox/tools/character/partButton.vue?1308","webpack:///./src/components/toolbox/tools/poem.vue?4a58","webpack:///./src/components/toolbox/tools/content-pack.vue?2b70","webpack:///./src/components/toolbox/drop-target.vue?a4ce","webpack:///./src/renderer/renderer.ts","webpack:///./src/constants/base.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","installedCssChunks","jsonpScriptSrc","p","exports","module","l","e","promises","cssChunks","Promise","resolve","reject","href","fullhref","existingLinkTags","document","getElementsByTagName","tag","dataHref","getAttribute","rel","existingStyleTags","linkTag","createElement","type","onload","onerror","event","request","target","src","err","Error","code","parentNode","removeChild","head","appendChild","then","installedChunkData","promise","onScriptComplete","script","charset","timeout","nc","setAttribute","error","clearTimeout","chunk","errorType","realSrc","message","name","undefined","setTimeout","all","m","c","d","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","oe","console","jsonpArray","window","oldJsonpFunction","slice","state","autoAdd","downloadLocation","vuexHistory","$store","isSavingEnabled","localRepositoryUrl","self","this","canSave","IndexedDBHandler","addEventListener","preventDefault","returnValue","supports","optionalSaving","backgroundInstall","localRepo","lq","setDownloadFolder","openableFolders","Set","loading","doesDbExists","exists","savingEnabled","creatingDB","loadAutoload","autoload","getInstance","repo","packUrls","map","id","pack","getPack","dddg2Path","dddg1Path","transaction","dispatch","folder","store","downloadCanvas","filename","format","quality","a","createObjectURL","url","body","click","background","authors","saveAutoload","filter","x","idx","indexOf","base","darkMode","nsfw","defaultCharacterTalkingZoom","loadSettings","settings","saveSettings","defaultValue","prompt","handler","canvas","canCreateObjectUrl","URL","toDataURL","toBlob","blob","dataURItoBlob","dataURI","binStr","atob","split","len","arr","Uint8Array","charCodeAt","Blob","localStorage","setItem","createDB","catch","clear","clearDB","indexedDB","mozIndexedDB","webkitIndexedDB","msIndexedDB","IDBTransaction","webkitIDBTransaction","msIDBTransaction","db","saving","getItem","req","open","onupgradeneeded","oldVer","oldVersion","version","createObjectStore","deleteObjectStore","onsuccess","deleteDatabase","autoloads","objectStorePromise","reqPromise","put","callback","transact","objectStore","navigator","msSaveBlob","installedBackgroundsPack","packId","dependencies","packCredits","characters","fonts","sprites","poemStyles","poemBackgrounds","backgrounds","colors","electron","bgInvalidation","pendingContentPacks","autoLoading","ipcRenderer","on","filePath","filepath","parts","variants","label","invalidateInstalledBGs","fire","location","onConversation","packIds","reloadLocalRepo","contentPack","processed","send","sendConvo","arrayBuffer","buffer","assets","sourcePack","hq","asset","HTMLImageElement","fetch","img","array","startsWith","newUrl","requestAnimationFrame","updateInstalledBGs","cancelAnimationFrame","chooseEnv","isElectron","msSaveOrOpenBlob","envX","toast","eventBus","emit","kind","subscribe","eventType","unsubscribe","off","AssetFailureEvent","path","CustomAssetFailureEvent","InvalidateRenderEvent","ShowMessageEvent","ColorPickedEvent","color","VueErrorEvent","info","Character","obj","scaleable","panelId","pose","currentHeads","drawAssetsUnloaded","renderCommands","renderCommand","offset","composite","posePositions","images","posePosition","positions","part","partAssets","size","zoom","close","width","closeZoom","height","mixins","props","to","String","required","computed","replace","_","page","replaceAll","render","OffscreenRenderable","localRenderer","lastVersion","hitDetectionFallback","renderable","lastHq","ready","canvasWidth","canvasHeight","renderLocal","flip","rotation","y","selected","rx","needRedraw","needsRedraw","updateLocalCanvas","getRenderRotation","rotationAnchor","drawImage","image","canvasDrawPosX","canvasDrawPosY","w","canvasDrawWidth","h","canvasDrawHeight","shadow","preview","blur","filters","hx","hy","hitbox","getHitbox","centerX","x0","x1","centerY","y0","y1","rotatedHitX","rotatedHitY","hit","pixelPerfectHitTest","angle","anchor","innerX","Math","round","innerY","flippedX","scaleX","scaleY","getDataAt","_current","PI","repoUrl","Repo","onlineRepo","packs","combinedList","onlinePacks","onlineRepoLookup","Map","localPacks","localRepoLookup","loadedPackOrder","content","contentPacks","loadedPacksSet","addedPacks","has","add","autoloading","installed","online","loaded","onlineAuthors","localAuthors","freeze","loadRepo","getPacks","find","instance","createInstance","onlineRepoLoading","localRepoLoading","onlineRepoLoaded","localRepoLoaded","fetchJSON","ok","json","setStore","AssetListRenderable","refTextbox","zoomWidthDelta","objZoom","zoomHeightDelta","panel","objects","panels","inPanel","order","onTopOrder","talkingObjId","getAssetList","drawAsset","loadAssets","loadedDraws","loadedDraw","textboxZoom","enlargeWhenTalking","unloaded","webpSupportPromise","heifSupportPromise","isWebPSupported","_reject","losslessCode","isHeifSupported","log","assetCache","customAssets","getAAsset","getAssetByUrl","Image","crossOrigin","style","display","baseUrl","getAsset","registerAsset","file","registerAssetWithURL","baseProps","opacity","textboxColor","nameboxWidth","RenderContext","fsCtx","aborted","params","save","font","align","text","lineJoin","textAlign","outline","strokeStyle","lineWidth","strokeText","fill","fillStyle","fillText","restore","ret","measureText","globalCompositeOperation","filterList","offsetX","offsetY","blurRadius","join","opacityCombined","globalAlpha","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","rotX","rotY","translate","fillRect","rotate","scale","paintOnto","composition","beginPath","rect","stroke","repetition","previewCanvas","createPattern","transform","createLinearGradient","getContext","context","RenderAbortedException","rotateAround","relX","relY","angleCos","cos","angleSin","sin","translatedX","translatedY","rotatedX","rotatedY","ErrorAsset","firefoxDeltaFactor","VerticalScrollRedirect","methods","verticalScrollRedirect","currentTarget","getComputedStyle","ev","deltaY","overflowY","scrollHeight","scrollTop","clientHeight","stopPropagation","oldScrollLeft","scrollLeft","mozInputSource","class","title","__scopeId","CloseUpYOffset","BaseCharacterYPos","characterMutations","setPose","command","poseId","setCharStyleGroup","styleGroupId","setCharStyle","styleId","setPosePosition","setClose","setFreeMove","freeMove","closestCharacterSlot","getData","getters","characterType","getDataG","rootGetters","getPose","styleGroups","styles","poses","getParts","positionKeys","keys","positionKey","compatibleHeads","unshift","getHeads","headTypeId","headType","heads","pos","sorted","abs","sort","b","lastSpriteId","characterActions","createCharacters","rootState","commit","char","currentPanel","onTop","preserveRatio","ratio","ui","seekPart","delta","seekPose","mutatePoseAndPositions","change","seekStyle","linearStyles","flatMap","styleGroup","styleGroupIdx","styleIdx","styleGroupJson","JSON","stringify","components","styleA","styleB","localeCompare","linearIdx","findIndex","nextIdx","seekHead","headKey","setPart","val","setCharacterPosition","shiftCharacterSlot","currentSlotNr","newSlotNr","fixContentPackRemovalFromCharacter","oldPack","oldCharData","poseAndPositionChange","buildPoseAndPositionData","oldStyleGroup","oldStyle","oldPose","newCharData","current","chr","newStyleGroupIdx","newStyleGroup","styleProperies","newStyleIdx","newStyle","newPoseIdx","newPose","newPosePositions","newPosition","oldPositionIdx","oldHeadGroup","newHeadGroupIdx","oldHead","newHeadIdx","variant","commitPoseAndPositionChanges","character","poseAndPosition","oldHeadCollection","newHeadCollectionNr","uid","ref","for","modelValue","Boolean","default","set","$emit","checkbox","$refs","arraySeeker","canvasTooSmall","isSafari","drawLastDownload","download","showDialog","showExpressionDialog","dialogVisable","expressionBuilderVisible","expressionBuilderCharacter","initHeadGroup","expressionBuilderHeadGroup","aria-hidden","vertical","setPanel","aria-label","$event","disabled","hasPrevRender","allowSavesModal","options","allowSaves","no-base-size","denySavesModal","denySaves","waitOnSaveChange","savesAllowed","savesEnabledInEnv","lqAllowed","lqRendering","theme","showDownloadFolder","downloadFolder","openDownloadFolder","PanelMixin","mounted","updateVertical","$el","passive","classList","remove","watch","noBaseSize","option","Array","Toggle","ModalDialog","L","environment","allowed","useDarkTheme","choice","updateDownloadFolder","openFolder","showDropTarget","hideDropTarget","addCustomSpriteFile","group","icon-pos","icon","onChosen","toLowerCase","assetPath","alt","sprite","assetSpriteBackground","addSpriteToScene","spriteUpload","onSpriteFileUpload","uploadFromURL","showSpritesFolder","openSpritesFolder","addTextBox","addPoem","addDialog","addChoice","addConsole","paste","hasClipboardContent","iconPos","uploadedSpritesPack","DropTarget","DButton","customAssetCount","clipboard","chibi","dataTransfer","effectAllowed","from","items","item","match","spriteDt","show","hide","uploadInput","files","lastSegment","addNewCustomSprite","created","showAltPanel","panelForParts","alt-panel","hasMultiplePoses","hasMultipleStyles","captialize","closeUp","no-wraping","charData","index","styleComponents","styleComponent","noWraping","buttons","button","choose_component","spriteSize","Number","lookups","backgroundSize","floor","backgroundPosition","lookup","backgroundImage","direction","maxSize","gap","finalDirection","wrapingClass","attrs","flowContainer","$slots","scrollContainer","PartButton","DFieldset","DFlow","stylePriorities","component","collection","currentPose","headKeyIdx","headIdx","headImages","previewSize","previewOffset","currentStyle","poseIdx","generatePosePreview","partIdx","partImage","updateStyleData","baseStyle","concat","updatePose","selection","priority","subSelect","choose","parseInt","headTypeIdx","prioIdx","stylePriority","genericSetable","action","hasLabel","enableNameEdit","heading","showRename","renameOption","modalNameInput","textHandler","leave","finalColorHandler","imageOptionsOpen","step","min","useCustomTextboxColor","selectTextboxColor","placeholder","defaultNameboxWidth","copy","colspan","allowSize","allowStepMove","isFirstPos","positionNames","isLastPos","shiftLayer","Infinity","onClick","showShadowColor","noComposition","compositionMode","addEffectSelection","filterTypes","filterType","getFilterLabel","addFilter","currentFilter","removeFilter","currentFilterIdx","moveFilter","filterIdx","selectFilter","getFilterText","shadowX","shadowY","isPercentFilter","toFixed","max","maxValue","minValue","gradientStops","no-input","setValue","hueStops","shift-gradient","noInput","xmlns","viewBox","enterSlide","moveSlide","exitSlide","gradientOffset","x2","y2","spreadMethod","stroke-width","paint-order","pointerPath","parseFloat","sliderLength","sliderOffset","shiftGradient","slideActive","svg","contains","MouseEvent","which","bounding","getBoundingClientRect","clientX","touches","scaledX","relative","updateHex","addSwatch","pickColor","swatches","swatch","label1","v1","max-value","maxValue1","gradient-stops","stops1","label2","v2","maxValue2","stops2","label3","v3","maxValue3","stops3","stopsAlpha","deltas","HSLAColor","g","q","hue2rgb","toString","padStart","sqrt","pow","str","validCssRgb","validHex","fromCssRgb","fromHex","rgbEx","test","rgbaEx","rgbHead","parentesisPos","rbgTail","elements","trim","RGBAColor","hexShortEx","hexLongEx","hexTail","Slider","validator","lastRGBEmit","stops","eightsStops","stop","toRgb","toCss","initValues","valueChanged","updateValue","newColor","rgbColor","toHex","hslColor","toHSL","gen","generatedPackId","SliderGroup","inheritAttrs","emits","rgb","fromCss","settingColor","unmounted","hex","existingPack","newPack","exhaust","percentageValue","objLookup","setMutation","newFilter","moveBy","filterText","Color","_e","objectTypeScope","toUpperCase","colorSelector","selectedColor","applyColor","onValueChanged","insertText","insertCommand","selectedFont","selectColor","aroundContextSize","tokenize","tokens","stringWalker","currentTokenState","tokenStateNormal","tokenStateEnd","contents","walker","tokenStateCommand","tokenStateNewLine","tokenText","nextState","textContent","escape","next","msg","around","closing","commandName","argument","argumentsState","paramlessOp","isItalic","isBold","isUnderlined","isStrikethrough","fontName","strokeColor","strokeWidth","letterSpacing","relativeNumberOp","parameter","fontSize","alpha","op","num","isNaN","rebuildParts","renderParts","getRenderParts","neededToLoad","doc","fontString","check","load","ctx","applyTextStyleToCanvas","State","lastChar","None","ExplictQuote","Star","measureWidth","ImplictQuote","lastPart","alignment","xStart","xEnd","yStart","maxLineWidth","currentLine","fixLine","applyLineWrapping","lineHeights","lineHeight","line","lastItem","lastItemInLine","styleStack","tagStack","currentStyleHeight","measureHeight","currentTag","token","TextRenderer","textCommands","pop","lastBreakPoint","currentLineWidth","lastBreakLineWidth","newParts","tmpContext","lastStyle","textStyle","heightCache","lineSpacing","innerHTML","fontFamily","div","position","top","left","offsetHeight","textboxDefaultColor","controlsDefaultColor","nameboxDefaultColor","nameboxStrokeDefaultColor","nameboxTextOutlineDelta","nameboxBackgroundDelta","nameboxGradientMiddleStopPosition","nameboxGradientEndDelta","nameboxRounding","textboxRounding","textboxRoundingBuffer","controlColorDelta","controlDisableColorDelta","dotColorDelta","dotRadius","dotPatternSize","textboxOutlineColorDelta","TextBoxWidth","TextBoxCorruptedWidth","TextBoxHeight","TextBoxY","TextBoxTextXOffset","TextBoxTextYOffset","NameboxHeight","NameboxWidth","NameboxXOffset","NameboxTextYOffset","ControlsYBottomOffset","ControlsXHistoryOffset","ControlsXSkipOffset","ControlsXStuffOffset","ArrowXRightOffset","ArrowYBottomOffset","GlowRX","GlowRY","BaseTextStyle","NameboxTextStyle","ControlsTextStyle","ControlsTextDisabledStyle","NameboxY","rememberedStart","rememberedEnd","textArea","el","selectionStart","selectionEnd","$nextTick","selStart","selEnd","focus","arg","selectedText","before","after","commandOpen","PositionAndSize","Layers","Delete","TextEditor","ImageOptions","colorHandler","canEdit","localColorHandler","Parts","ObjectTool","charAt","substring","textBoxStyle","nameList","jumpToCharacter","talkingOther","textEditor","autoQuoting","autoWrap","dialog","showControls","allowSkipping","showContinueArrow","customNameboxWidth","overrideColor","customColor","colorSelect","deriveCustomColors","customControlsColor","customNameboxColor","customNameboxStroke","resetPosition","splitTextbox","textEditorName","colorName","btnIdx","currentIdx","select","buttonText","removeChoice","simpleButtonSettable","choices","choiceIdx","dragEnter","dt","addImageFile","bgColor","imageOptions","no-composition","upload","onFileUpload","addByUrl","showBackgroundsFolder","openBackgroundFolder","backgroundId","setBackground","isActive","bgData","urls","isColor","isVariant","flipped","hasVariants","seekVariant","scaling","currentBackgroundId","uploadedBackgroundsPack","BackgroundButton","BackgroundSettings","addNewCustomBackground","addNew","readonly","credits","activatable","activate","deactivatable","deactivate","installable","install","uninstallable","uninstall","needRestart","restart","selectedPack","active","queuedUninstall","freshInstall","reload","localRepoUninstall","autoLoadAdd","autoLoadRemove","ScalingModes","panelButtons","updateCurrentPanel","addNewPanel","deletePanel","canDeletePanel","moveAhead","canMoveAhead","moveBehind","canMoveBehind","webpSupport","heifSupport","isLossy","ppi","pages","estimateExportSize","transparentId","lastPanelNum","previewManager","panelToUrl","urlToPanel","register","unregister","delete","revokeObjectURL","namespaced","panelOrder","mutations","setCurrentPanel","setPanelPreview","lastRender","createPanel","setPanelOrder","setCurrentBackground","setBackgroundColor","setBackgroundFlipped","setBackgroundVariant","setBackgroundScaling","setComposition","setFilters","backgroundSetComposition","backgroundSetFilters","actions","duplicatePanel","parse","sourcePanelId","targetPanelId","root","oldIdx","seekBackgroundVariant","newOrderIdx","orderIdx","fixContentPackRemoval","oldContent","oldBackground","newBackground","oldVariantJSON","newVariantIdx","values","move","newIdx","mutation","setFilter","backgroundAddFilter","backgroundRemoveFilter","backgroundMoveFilter","backgroundSetFilter","compositeMode","Stretch","Cover","screenRatio","drawRect","init","readyResolve","roundedRectangle","moveTo","arcTo","closePath","roundedTopRectangle","lineTo","lastWidth","lastHeight","lastX","lastY","lastFlip","draw","customTransform","trx","flipNormalizedCenterX","vCentered","centeredVertically","w2","h2","refObject","talkingObj","baseX","renderBackdrop","renderNamebox","renderText","bottom","controlsY","controlsCenter","controls","drawText","controlsStyle","skip","controlsDisableStyle","continue","forcedStyle","nameboxOutlineColor","clip","subRx","gradient","linearGradient","baseBG","nameboxBackgroundColor","targetColor","addColorStop","loadFonts","fixAlignment","dotPattern","dotRx","drawDot","dotX","dotY","drawPath","ellipse","_subSubRx","pattern","patternFrom","glowGradient","outlineColor","baseY","quote","controlColor","col","disColor","ChoiceButtonColor","ChoiceButtonBorderColor","ChoiceButtonWidth","ChoiceSpacing","ChoiceYOffset","ChoicePadding","ChoiceY","ChoiceTextStyle","_height","choiceRenderers","updateChoiceBounds","choiceRenderer","getHeight","reduce","acc","renderer","choiceDistance","NotificationBackdropColor","NotificationPadding","NotificationSpacing","NotificationOkTextStyle","NotificationTextStyle","_width","backdrop","textRenderer","buttonRenderer","lineWrap","textWidth","getWidth","textHeight","buttonWidth","buttonHeight","defaultPoemBackground","defaultPoemStyle","defaultX","defaultY","poemTopPadding","poemPadding","defaultPoemWidth","defaultPoemHeight","consoleBackgroundColor","consoleWidth","consoleHeight","defaultConsoleBackground","defaultConsoleStyle","BasePoemStyle","consolePadding","consoleTopPadding","consoleLineWrapPadding","poemTopMargin","paper","padding","topPadding","lineWrapPadding","renderObjectCache","lCurrentlyRendering","renderCallback","date","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","opts","getRenderObjects","renderObject","hitTest","imageSmoothingEnabled","imageSmoothingQuality","getBackgroundRenderer","updatedContent","applyFilters","objectsState","toUncache","includes","estimateFactor","thumbnailFactor","thumbnailQuality","qualityFactor","defaultQuality","qualityWarningThreshold","objectOrders","txtBox","objId","extractObjectText","moveFocusToActivePanel","renderThumbnail","distribution","getPanelDistibution","prefix","extension","renderObjects","imageIdx","saveToFile","sizes","readableSizes","filePluralize","itPluralize","sizePluralize","mapper","targetCanvas","panelIdx","sceneRenderer","getLimitedPanelList","listedPages","foundMatch","trimmedPart","ary","pageIdx","imageI","sliceStart","sliceEnd","querySelector","scrollIntoView","ele","parent","parentElement","children","scroll","clientWidth","oldQuality","subType","poemBackground","poemStyle","poemTextStyles","SettingsPanel","AddPanel","BackgroundsPanel","CreditsPanel","CharacterPanel","TextBoxPanel","ChoicePanel","SpritePanel","ContentPacksPanel","PanelsPanel","NotificationPanel","PoemPanel","panelSelection","lastDownload","onPanelChange","newSelection","showLoading","messages","shortHidingTime","longHidingTime","hideShowTimeouts","showLoadingTimeout","hideLoadingTimeout","onLoadingChange","stack","newValue","bitmapHeight","bitmapWidth","cursor","draggable","onUiClick","onTouchStart","onDragStart","onSpriteDragMove","onSpriteDrop","onDragOver","onDrop","onMouseEnter","sdCtx","currentlyRendering","queuedRender","showingLast","dropSpriteCount","dropPreventClick","draggedObject","dragXOffset","dragYOffset","dragXOriginal","dragYOriginal","sceneRender","pickerMode","oldUrl","invalidateRender","render_","unsafe","renderLoadingScreen","loadingScreen","rctx","make","toRendererCoordinate","sd","offsetLeft","ry","offsetTop","sx","offsetWidth","sy","clientY","getImageData","selectedObject","objectsAt","currentObjectIdx","dropEffect","deltaX","shiftKey","getAsFile","TouchEvent","mut","aspectRatio","arrowMoveStepSize","packDialogWaitMs","canvasTooSmallThreshold","nsfwPacks","names","ToolBox","MessageConsole","Render","SingleBox","ExpressionBuilder","blendOver","uiSize","systemPrefersDarkMode","userPrefersDarkMode","last","setBlendOver","optimum","sw","sh","rh","rw","optimizeWithMenu","opth","optv","updateArea","documentElement","cw","ch","v","search","wait","packDialog","setSearch","headGroup","onKeydown","HTMLInputElement","HTMLTextAreaElement","ctrlKey","destroyed","removeEventListener","applyTheme","toggle","matchMedia","matcher","matches","addListener","app","env","connectToStore","spriteMutations","spriteActions","createSprite","choiceMutations","setChoices","setChoiceColor","setChoiceDistance","setAutoWrapping","lastChoiceId","choiceActions","createChoice","setChoiceText","splitTextboxSpacing","textBoxMutations","setText","setTalkingObject","setTalkingOther","setStyle","setControlsVisible","setControlsColor","setDeriveCustomColors","setNameboxColor","setNameboxStroke","setNameboxWidth","setSkipable","setContinueArrow","setCustomColor","setAutoQuoting","setResetBounds","resetBounds","setColorOverride","lastTextBoxId","textBoxActions","createTextBox","resetTextboxBounds","newWidth","centerDistance","baseCenter","boxOneCoords","boxTwoCoords","notificationMutations","setNotificationColor","setNotificationText","setNotificationBackdrop","lastNotificationId","notificationActions","createNotification","poemMutations","setPoemBackground","setPoemFont","setPoemText","lastPoemId","poemActions","createPoem","_command","createConsole","lastCopyId","removeFromList","addToList","setOnTop","setPosition","setFlip","setSize","setRatio","setRotation","removeObject","setLabel","setTextboxColor","setEnlargeWhenTalking","setObjectNameboxWidth","setObjectZoom","otherObject","setPreserveRatio","setWidth","setHeight","copyObjects","sourceOrders","allSourceIds","transationTable","sourceId","targetId","oldObject","newObject","newTextbox","copyObjectToClipboard","pasteObjectFromClipboard","deleteAllOfPanel","setVertical","setNsfw","setLqRendering","setSelection","setLastDownload","setClipboard","setDarkTheme","setDefaultCharacterTalkingZoom","setColorPicker","mergeContentPacks","mergeBackgrounds","mergeCharacters","mergeArrayUnique","mergeIdArrays","xObj","yObj","mergeBackground","mergeCharacter","mergeHeadCollections","xStyleGroup","yStyleGroup","xClasses","yClasses","mergeStyleClasses","xStyle","yStyle","mergePose","classKey","headGroupKey","getId","merge","definedIds","yId","existingIdx","existing","baseDir","baseTypes","setContentPacks","setCurrentContent","convertContentPack","convertedPack","existingPacks","dependency","removeContentPacks","newContentPacks","sortByDependencies","replaceContentPack","packIdx","loadContentPacks","response","statusText","paths","convertV1","getCharacters","getBackgrounds","types","replacementMap","payload","setUnsafe","removePacks","oldState","vueApp","config","globalProperties","resetStateMutation","replayMutation","vm","baseObj","assign","replayTransaction","forEach","replayAll","oldTransactions","done","mutationProperiesCache","getMutationProperties","mutationProperties","ignore","combinable","oldMutation","newMutation","combinator","currentWildcard","history","reactive","undone","ignoreMutations","currentTransaction","transactionQueue","initialized","initialize","exec","redo","undo","lastUndo","combination","App","use","mount","visible","drop","Renderer","runningContext","abort","clearRect","makeWithContext","screenWidth","screenHeight","characterPositions"],"mappings":"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","file":"js/app.b9b945eb.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded CSS chunks\n \tvar installedCssChunks = {\n \t\t\"app\": 0\n \t}\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"js/\" + ({}[chunkId]||chunkId) + \".\" + {\"chunk-084c2570\":\"83e5545f\",\"chunk-64406563\":\"1f262b86\"}[chunkId] + \".js\"\n \t}\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar promises = [];\n\n\n \t\t// mini-css-extract-plugin CSS loading\n \t\tvar cssChunks = {\"chunk-084c2570\":1,\"chunk-64406563\":1};\n \t\tif(installedCssChunks[chunkId]) promises.push(installedCssChunks[chunkId]);\n \t\telse if(installedCssChunks[chunkId] !== 0 && cssChunks[chunkId]) {\n \t\t\tpromises.push(installedCssChunks[chunkId] = new Promise(function(resolve, reject) {\n \t\t\t\tvar href = \"css/\" + ({}[chunkId]||chunkId) + \".\" + {\"chunk-084c2570\":\"797ebd56\",\"chunk-64406563\":\"308ae515\"}[chunkId] + \".css\";\n \t\t\t\tvar fullhref = __webpack_require__.p + href;\n \t\t\t\tvar existingLinkTags = document.getElementsByTagName(\"link\");\n \t\t\t\tfor(var i = 0; i < existingLinkTags.length; i++) {\n \t\t\t\t\tvar tag = existingLinkTags[i];\n \t\t\t\t\tvar dataHref = tag.getAttribute(\"data-href\") || tag.getAttribute(\"href\");\n \t\t\t\t\tif(tag.rel === \"stylesheet\" && (dataHref === href || dataHref === fullhref)) return resolve();\n \t\t\t\t}\n \t\t\t\tvar existingStyleTags = document.getElementsByTagName(\"style\");\n \t\t\t\tfor(var i = 0; i < existingStyleTags.length; i++) {\n \t\t\t\t\tvar tag = existingStyleTags[i];\n \t\t\t\t\tvar dataHref = tag.getAttribute(\"data-href\");\n \t\t\t\t\tif(dataHref === href || dataHref === fullhref) return resolve();\n \t\t\t\t}\n \t\t\t\tvar linkTag = document.createElement(\"link\");\n \t\t\t\tlinkTag.rel = \"stylesheet\";\n \t\t\t\tlinkTag.type = \"text/css\";\n \t\t\t\tlinkTag.onload = resolve;\n \t\t\t\tlinkTag.onerror = function(event) {\n \t\t\t\t\tvar request = event && event.target && event.target.src || fullhref;\n \t\t\t\t\tvar err = new Error(\"Loading CSS chunk \" + chunkId + \" failed.\\n(\" + request + \")\");\n \t\t\t\t\terr.code = \"CSS_CHUNK_LOAD_FAILED\";\n \t\t\t\t\terr.request = request;\n \t\t\t\t\tdelete installedCssChunks[chunkId]\n \t\t\t\t\tlinkTag.parentNode.removeChild(linkTag)\n \t\t\t\t\treject(err);\n \t\t\t\t};\n \t\t\t\tlinkTag.href = fullhref;\n\n \t\t\t\tvar head = document.getElementsByTagName(\"head\")[0];\n \t\t\t\thead.appendChild(linkTag);\n \t\t\t}).then(function() {\n \t\t\t\tinstalledCssChunks[chunkId] = 0;\n \t\t\t}));\n \t\t}\n\n \t\t// JSONP chunk loading for javascript\n\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n \t\t\t// a Promise means \"currently loading\".\n \t\t\tif(installedChunkData) {\n \t\t\t\tpromises.push(installedChunkData[2]);\n \t\t\t} else {\n \t\t\t\t// setup Promise in chunk cache\n \t\t\t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t\t\t});\n \t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n \t\t\t\t// start chunk loading\n \t\t\t\tvar script = document.createElement('script');\n \t\t\t\tvar onScriptComplete;\n\n \t\t\t\tscript.charset = 'utf-8';\n \t\t\t\tscript.timeout = 120;\n \t\t\t\tif (__webpack_require__.nc) {\n \t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t\t\t}\n \t\t\t\tscript.src = jsonpScriptSrc(chunkId);\n\n \t\t\t\t// create error before stack unwound to get useful stacktrace later\n \t\t\t\tvar error = new Error();\n \t\t\t\tonScriptComplete = function (event) {\n \t\t\t\t\t// avoid mem leaks in IE.\n \t\t\t\t\tscript.onerror = script.onload = null;\n \t\t\t\t\tclearTimeout(timeout);\n \t\t\t\t\tvar chunk = installedChunks[chunkId];\n \t\t\t\t\tif(chunk !== 0) {\n \t\t\t\t\t\tif(chunk) {\n \t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n \t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n \t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n \t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n \t\t\t\t\t\t\terror.type = errorType;\n \t\t\t\t\t\t\terror.request = realSrc;\n \t\t\t\t\t\t\tchunk[1](error);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t\t\t}\n \t\t\t\t};\n \t\t\t\tvar timeout = setTimeout(function(){\n \t\t\t\t\tonScriptComplete({ type: 'timeout', target: script });\n \t\t\t\t}, 120000);\n \t\t\t\tscript.onerror = script.onload = onScriptComplete;\n \t\t\t\tdocument.head.appendChild(script);\n \t\t\t}\n \t\t}\n \t\treturn Promise.all(promises);\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./sliderGroup.vue?vue&type=style&index=0&id=24b7dbc3&lang=scss&scoped=true\"","import { EnvCapabilities, Folder, IEnvironment, Settings } from './environment';\nimport { Background } from '@/renderables/background';\nimport { EnvState } from './envState';\nimport { DeepReadonly, reactive, ref } from 'vue';\nimport { Repo } from '@/models/repo';\nimport { IHistorySupport } from '@/plugins/vuex-history';\nimport { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport { IAuthors } from '@edave64/dddg-repo-filters/dist/authors';\nimport { IPack } from '@edave64/dddg-repo-filters/dist/pack';\n\nexport class Browser implements IEnvironment {\n\tpublic readonly state: EnvState = reactive({\n\t\tautoAdd: [],\n\t\tdownloadLocation: 'Default download folder',\n\t});\n\tpublic readonly supports: DeepReadonly<EnvCapabilities>;\n\n\tprivate vuexHistory: IHistorySupport | null = null;\n\tprivate $store: Store<DeepReadonly<IRootState>> | null = null;\n\n\tprivate readonly isSavingEnabled = ref(false);\n\n\tpublic readonly localRepositoryUrl = '';\n\n\tprivate loading: Promise<void>;\n\tprivate creatingDB?: Promise<IDBDatabase | void>;\n\n\tpublic get savingEnabled() {\n\t\treturn this.isSavingEnabled.value;\n\t}\n\n\tpublic set savingEnabled(value: boolean) {\n\t\tif (value) {\n\t\t\tlocalStorage.setItem('saving', 'true');\n\t\t\tthis.creatingDB = IndexedDBHandler.createDB();\n\t\t\tthis.creatingDB!.then(() => {\n\t\t\t\tthis.creatingDB = undefined;\n\t\t\t\tthis.isSavingEnabled.value = true;\n\t\t\t}).catch(() => {});\n\t\t} else {\n\t\t\t// I'm not just setting 'saving' to false because I want there to\n\t\t\t// be absolutely no trace if you revoke saving.\n\t\t\tlocalStorage.clear();\n\t\t\tthis.isSavingEnabled.value = false;\n\t\t\tthis.creatingDB = IndexedDBHandler.clearDB()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.creatingDB = undefined;\n\t\t\t\t})\n\t\t\t\t.catch(() => {});\n\t\t}\n\t}\n\n\tconstructor() {\n\t\t// eslint-disable-next-line @typescript-eslint/no-this-alias\n\t\tconst self = this;\n\t\tconst canSave = IndexedDBHandler.canSave();\n\n\t\twindow.addEventListener('beforeunload', function(e) {\n\t\t\t// Cancel the event\n\t\t\te.preventDefault(); // If you prevent default behavior in Mozilla Firefox prompt will always be shown\n\t\t\t// Chrome requires returnValue to be set\n\t\t\te.returnValue =\n\t\t\t\t'Are you sure you want to leave? All your progress will be lost!';\n\t\t});\n\n\t\tconst supports = reactive({\n\t\t\toptionalSaving: canSave,\n\t\t\tget autoLoading(): boolean {\n\t\t\t\treturn canSave && self.isSavingEnabled.value;\n\t\t\t},\n\t\t\tbackgroundInstall: false,\n\t\t\tlocalRepo: false,\n\t\t\tlq: true,\n\t\t\tsetDownloadFolder: false,\n\t\t\topenableFolders: new Set([]),\n\t\t});\n\n\t\tthis.supports = supports;\n\n\t\tif (canSave) {\n\t\t\tthis.loading = (async () => {\n\t\t\t\tconst exists = await IndexedDBHandler.doesDbExists();\n\t\t\t\tthis.savingEnabled = exists;\n\t\t\t})();\n\t\t} else {\n\t\t\tthis.loading = Promise.resolve();\n\t\t}\n\n\t\tthis.loading.then(async () => {\n\t\t\tif (this.creatingDB) await this.creatingDB;\n\t\t\tif (this.savingEnabled) {\n\t\t\t\tconst autoload = (await IndexedDBHandler.loadAutoload()) || [];\n\t\t\t\tthis.state.autoAdd = autoload;\n\t\t\t\tconst repo = await Repo.getInstance();\n\t\t\t\tconst packUrls = autoload.map(id => {\n\t\t\t\t\tconst pack = repo.getPack(id);\n\t\t\t\t\treturn pack.dddg2Path || pack.dddg1Path;\n\t\t\t\t});\n\t\t\t\tthis.vuexHistory!.transaction(async () => {\n\t\t\t\t\tawait this.$store!.dispatch('content/loadContentPacks', packUrls);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tupdateDownloadFolder(): void {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\topenFolder(folder: Folder): void {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\tpublic connectToStore(\n\t\tvuexHistory: IHistorySupport,\n\t\tstore: Store<DeepReadonly<IRootState>>\n\t) {\n\t\tthis.vuexHistory = vuexHistory;\n\t\tthis.$store = store;\n\t}\n\n\tpublic async saveToFile(\n\t\tdownloadCanvas: HTMLCanvasElement,\n\t\tfilename: string,\n\t\tformat = 'image/png',\n\t\tquality = 1\n\t): Promise<string> {\n\t\tconst a = document.createElement('a');\n\t\ta.setAttribute('download', filename);\n\t\tconst url = await this.createObjectURL(downloadCanvas, format, quality);\n\t\ta.setAttribute('href', url);\n\t\tdocument.body.appendChild(a);\n\t\ta.click();\n\t\tdocument.body.removeChild(a);\n\t\treturn url;\n\t}\n\n\tpublic installBackground(background: Background): boolean {\n\t\tthrow new Error('This environment does not support installing backgrounds');\n\t}\n\n\tpublic uninstallBackground(background: Background): boolean {\n\t\tthrow new Error(\n\t\t\t'This environment does not support uninstalling backgrounds'\n\t\t);\n\t}\n\n\tpublic localRepoInstall(url: string, repo: IPack, authors: IAuthors): void {\n\t\tthrow new Error('This environment does not support a local repository');\n\t}\n\n\tpublic localRepoUninstall(id: string): void {\n\t\tthrow new Error('This environment does not support a local repository');\n\t}\n\n\tpublic autoLoadAdd(id: string): void {\n\t\t(async () => {\n\t\t\tawait this.loading;\n\t\t\tawait this.creatingDB;\n\t\t\tawait IndexedDBHandler.saveAutoload([...this.state.autoAdd, id]);\n\t\t\tthis.state.autoAdd.push(id);\n\t\t})();\n\t}\n\n\tpublic autoLoadRemove(id: string): void {\n\t\t(async () => {\n\t\t\tawait this.loading;\n\t\t\tawait this.creatingDB;\n\n\t\t\tawait IndexedDBHandler.saveAutoload(\n\t\t\t\tthis.state.autoAdd.filter(x => x != id)\n\t\t\t);\n\t\t\tconst idx = this.state.autoAdd.indexOf(id);\n\t\t\tthis.state.autoAdd.splice(idx, 1);\n\t\t})();\n\t}\n\n\tpublic async loadSettings(): Promise<Settings> {\n\t\tawait this.loading;\n\t\tawait this.creatingDB;\n\t\tconst base: Settings = {\n\t\t\tdarkMode: undefined,\n\t\t\tlq: true,\n\t\t\tnsfw: false,\n\t\t\tdefaultCharacterTalkingZoom: true,\n\t\t};\n\t\tif (!this.isSavingEnabled.value) return base;\n\t\treturn {\n\t\t\t...base,\n\t\t\t...(await IndexedDBHandler.loadSettings()),\n\t\t};\n\t}\n\n\tpublic async saveSettings(settings: Settings): Promise<void> {\n\t\tawait this.loading;\n\t\tawait this.creatingDB;\n\t\tif (!this.isSavingEnabled.value) return;\n\t\tawait IndexedDBHandler.saveSettings(settings);\n\t}\n\n\tpublic async isInitialized(): Promise<void> {\n\t\tawait this.loading;\n\t\tawait this.creatingDB;\n\t}\n\n\tpublic prompt(\n\t\tmessage: string,\n\t\tdefaultValue?: string\n\t): Promise<string | null> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tresolve(prompt(message, defaultValue));\n\t\t});\n\t}\n\n\tpublic onPanelChange(handler: (panel: string) => void): void {\n\t\treturn;\n\t}\n\n\tprotected createObjectURL(\n\t\tcanvas: HTMLCanvasElement,\n\t\tformat: string,\n\t\tquality: number\n\t): Promise<string> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst canCreateObjectUrl = !!(window.URL && window.URL.createObjectURL);\n\t\t\tif (!canCreateObjectUrl)\n\t\t\t\treturn resolve(canvas.toDataURL(format, quality));\n\n\t\t\tif (canvas.toBlob) {\n\t\t\t\tcanvas.toBlob(\n\t\t\t\t\tblob => {\n\t\t\t\t\t\tif (!blob) {\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(URL.createObjectURL(blob));\n\t\t\t\t\t},\n\t\t\t\t\tformat,\n\t\t\t\t\tquality\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tconst url = canvas.toDataURL(format, quality);\n\t\t\t\tconst blob = this.dataURItoBlob(url, format);\n\t\t\t\tresolve(URL.createObjectURL(blob));\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected dataURItoBlob(dataURI: string, type: string) {\n\t\tconst binStr = atob(dataURI.split(',')[1]);\n\t\tconst len = binStr.length;\n\t\tconst arr = new Uint8Array(len);\n\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tarr[i] = binStr.charCodeAt(i);\n\t\t}\n\n\t\treturn new Blob([arr], { type });\n\t}\n}\n\nconst IndexedDBHandler = {\n\tindexedDB: (() => {\n\t\ttry {\n\t\t\treturn (window.indexedDB ||\n\t\t\t\t(window as any).mozIndexedDB ||\n\t\t\t\t(window as any).webkitIndexedDB ||\n\t\t\t\t(window as any).msIndexedDB) as IDBFactory;\n\t\t} catch (e) {\n\t\t\treturn null;\n\t\t}\n\t})(),\n\ttransaction: (() => {\n\t\ttry {\n\t\t\treturn ((window.IDBTransaction as any) ||\n\t\t\t\t(window as any).webkitIDBTransaction ||\n\t\t\t\t(window as any).msIDBTransaction) as IDBTransaction;\n\t\t} catch (e) {\n\t\t\treturn null;\n\t\t}\n\t})(),\n\tdb: null as null | Promise<IDBDatabase>,\n\n\tcanSave(): boolean {\n\t\treturn !!(IndexedDBHandler.indexedDB && window.localStorage);\n\t},\n\n\t// Optimally, this could just check if the database exists. But sadly, that's not standard. So we need to bring\n\t// localstorage into this. :/\n\tdoesDbExists(): Promise<boolean> {\n\t\tconst saving = localStorage.getItem('saving');\n\t\tif (saving === 'true') {\n\t\t\treturn Promise.resolve(true);\n\t\t}\n\t\treturn Promise.resolve(false);\n\t},\n\n\tcreateDB(): Promise<IDBDatabase> {\n\t\tif (IndexedDBHandler.db) return IndexedDBHandler.db;\n\t\treturn (IndexedDBHandler.db = new Promise((resolve, reject) => {\n\t\t\tconst req = IndexedDBHandler.indexedDB!.open('dddg', 2);\n\t\t\treq.onerror = event => {\n\t\t\t\treject(event);\n\t\t\t};\n\t\t\treq.onupgradeneeded = event => {\n\t\t\t\tconst db = (event.target! as any).result as IDBDatabase;\n\t\t\t\tconst oldVer = event.oldVersion ?? ((event as any).version as number);\n\t\t\t\tif (oldVer < 1) {\n\t\t\t\t\tdb.createObjectStore('settings');\n\t\t\t\t}\n\t\t\t\tif (oldVer === 1) {\n\t\t\t\t\tdb.deleteObjectStore('settings');\n\t\t\t\t\tdb.createObjectStore('settings');\n\t\t\t\t}\n\t\t\t};\n\t\t\treq.onsuccess = event => {\n\t\t\t\tresolve(req.result);\n\t\t\t};\n\t\t}));\n\t},\n\n\tclearDB(): Promise<void> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (!IndexedDBHandler.db) {\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst req = IndexedDBHandler.indexedDB!.deleteDatabase('dddg');\n\t\t\tIndexedDBHandler.db = null;\n\t\t\treq.onerror = event => {\n\t\t\t\treject(event);\n\t\t\t};\n\t\t\treq.onsuccess = event => {\n\t\t\t\tresolve();\n\t\t\t};\n\t\t});\n\t},\n\n\tsaveAutoload(autoloads: string[]): Promise<void> {\n\t\treturn this.objectStorePromise('readwrite', async store => {\n\t\t\tawait this.reqPromise(store.put([...autoloads], 'autoload'));\n\t\t});\n\t},\n\n\tloadAutoload(): Promise<string[]> {\n\t\treturn this.objectStorePromise('readonly', async store => {\n\t\t\treturn await this.reqPromise<string[]>(store.get('autoload'));\n\t\t});\n\t},\n\n\tsaveSettings<T>(settings: T): Promise<void> {\n\t\treturn this.objectStorePromise('readwrite', async store => {\n\t\t\tawait this.reqPromise(store.put({ ...settings }, 'settings'));\n\t\t});\n\t},\n\n\tloadSettings<T>(): Promise<T> {\n\t\treturn this.objectStorePromise('readonly', async store => {\n\t\t\treturn await this.reqPromise<T>(store.get('settings'));\n\t\t});\n\t},\n\n\tobjectStorePromise<T>(\n\t\tmode: 'readonly' | 'readwrite',\n\t\tcallback: (store: IDBObjectStore) => Promise<T>\n\t): Promise<T> {\n\t\tif (!this.db) return Promise.reject('No database');\n\t\treturn new Promise(async (resolve, reject) => {\n\t\t\tconst transact = (await this.db!).transaction(['settings'], mode);\n\t\t\tconst store = transact.objectStore('settings');\n\n\t\t\ttry {\n\t\t\t\tresolve(await callback(store));\n\t\t\t} catch (e) {\n\t\t\t\treject(e);\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Turns a database request into a promise to more easily use it in asyncronous code\n\t */\n\treqPromise<T>(req: IDBRequest<T>): Promise<T> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treq.onerror = error => {\n\t\t\t\treject(error);\n\t\t\t};\n\t\t\treq.onsuccess = event => {\n\t\t\t\tresolve(req.result);\n\t\t\t};\n\t\t});\n\t},\n};\n","import { Browser } from './browser';\n\nexport class OldEdge extends Browser {\n\tpublic async saveToFile(\n\t\tdownloadCanvas: HTMLCanvasElement,\n\t\tfilename: string,\n\t\tformat: string = 'image/png',\n\t\tquality: number = 1\n\t): Promise<string> {\n\t\tlet url = downloadCanvas.toDataURL(format, quality);\n\t\tconst blob = this.dataURItoBlob(url, format);\n\n\t\tif (window.URL && window.URL.createObjectURL) {\n\t\t\turl = URL.createObjectURL(blob);\n\t\t}\n\n\t\t// IE-specific code\n\t\twindow.navigator.msSaveBlob(blob, filename);\n\t\treturn url;\n\t}\n}\n","import { EnvCapabilities, Folder, IEnvironment, Settings } from './environment';\nimport { registerAssetWithURL, getAsset } from '@/asset-manager';\nimport { Background } from '@/renderables/background';\nimport eventBus, { ShowMessageEvent } from '@/eventbus/event-bus';\nimport { EnvState } from '@/environments/envState';\nimport { ContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IHistorySupport } from '@/plugins/vuex-history';\nimport { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport { ReplaceContentPackAction } from '@/store/content';\nimport { reactive } from 'vue';\nimport { Repo } from '@/models/repo';\nimport { DeepReadonly } from '@/util/readonly';\nimport { IAuthors } from '@edave64/dddg-repo-filters/dist/authors';\nimport { IPack } from '@edave64/dddg-repo-filters/dist/pack';\nimport { JSONContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/jsonFormat';\n\nconst packs: IPack[] = [];\n\nconst installedBackgroundsPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.installedBackgrounds',\n\tdependencies: [],\n\tpackCredits: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport class Electron implements IEnvironment {\n\tpublic readonly state: EnvState = reactive({\n\t\tautoAdd: [],\n\t\tdownloadLocation: '',\n\t});\n\tpublic readonly localRepositoryUrl = '/repo/';\n\n\tprivate readonly electron = (window as any) as IElectronWindow;\n\n\tprivate vuexHistory: IHistorySupport | null = null;\n\tprivate $store: Store<DeepReadonly<IRootState>> | null = null;\n\tprivate bgInvalidation: number | null = null;\n\tprivate readonly pendingContentPacks: string[] = [];\n\n\tconstructor() {\n\t\tthis.electron.ipcRenderer.on(\n\t\t\t'add-persistent-content-pack',\n\t\t\tasync (filePath: string) => {\n\t\t\t\tif (!this.$store || !this.vuexHistory) {\n\t\t\t\t\tthis.pendingContentPacks.push(filePath);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store!.dispatch('content/loadContentPacks', filePath);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.on(\n\t\t\t'add-persistent-background',\n\t\t\tasync (filepath: string) => {\n\t\t\t\tconst name = 'persistentBg-' + filepath;\n\t\t\t\tconst parts = filepath.split('/');\n\t\t\t\tregisterAssetWithURL(name, filepath);\n\t\t\t\tinstalledBackgroundsPack.backgrounds.push({\n\t\t\t\t\tid: name,\n\t\t\t\t\tvariants: [[name]],\n\t\t\t\t\tlabel: parts[parts.length - 1],\n\t\t\t\t});\n\t\t\t\tthis.invalidateInstalledBGs();\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.on('push-message', async (message: string) => {\n\t\t\teventBus.fire(new ShowMessageEvent(message));\n\t\t});\n\t\tthis.electron.ipcRenderer.on(\n\t\t\t'config.downloadFolderUpdate',\n\t\t\tasync (location: string) => {\n\t\t\t\tthis.state.downloadLocation = location;\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.onConversation(\n\t\t\t'load-packs',\n\t\t\tasync (packIds: string[]) => {\n\t\t\t\tconst repo = await Repo.getInstance();\n\t\t\t\tconst packUrls = packIds.map(id => {\n\t\t\t\t\tconst pack = repo.getPack(id);\n\t\t\t\t\treturn pack.dddg2Path || pack.dddg1Path;\n\t\t\t\t});\n\t\t\t\tthis.vuexHistory!.transaction(async () => {\n\t\t\t\t\tawait this.$store!.dispatch('content/loadContentPacks', packUrls);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.onConversation(\n\t\t\t'auto-load.changed',\n\t\t\tasync (packIds: string[]) => {\n\t\t\t\tthis.state.autoAdd = packIds;\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.onConversation('reload-repo', async () => {\n\t\t\tawait (await Repo.getInstance()).reloadLocalRepo();\n\t\t});\n\t\tthis.electron.ipcRenderer.onConversation(\n\t\t\t'replace-pack',\n\t\t\tasync (contentPack: ContentPack<string>) => {\n\t\t\t\tthis.vuexHistory!.transaction(async () => {\n\t\t\t\t\tawait this.$store!.dispatch('content/replaceContentPack', {\n\t\t\t\t\t\tprocessed: false,\n\t\t\t\t\t\tcontentPack,\n\t\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.send('init-dddg');\n\t}\n\tpublic updateDownloadFolder(): void {\n\t\tthis.electron.ipcRenderer.send('config.newDownloadFolder');\n\t}\n\tpublic openFolder(folder: Folder): void {\n\t\tthis.electron.ipcRenderer.send('open-folder', folder);\n\t}\n\tpublic onPanelChange(handler: (panel: string) => void): void {}\n\tpublic readonly supports: EnvCapabilities = {\n\t\tautoLoading: true,\n\t\tbackgroundInstall: true,\n\t\tlocalRepo: true,\n\t\tlq: false,\n\t\toptionalSaving: false,\n\t\tsetDownloadFolder: true,\n\t\topenableFolders: new Set(['downloads', 'backgrounds', 'sprites']),\n\t};\n\tpublic readonly savingEnabled: boolean = true;\n\tpublic async saveSettings(settings: Settings): Promise<void> {\n\t\tawait this.electron.ipcRenderer.sendConvo(\n\t\t\t'config.set',\n\t\t\t'nsfw',\n\t\t\tsettings.nsfw\n\t\t);\n\t\tawait this.electron.ipcRenderer.sendConvo(\n\t\t\t'config.set',\n\t\t\t'darkMode',\n\t\t\tsettings.darkMode ?? undefined\n\t\t);\n\t\tawait this.electron.ipcRenderer.sendConvo(\n\t\t\t'config.set',\n\t\t\t'defaultCharacterTalkingZoom',\n\t\t\tsettings.defaultCharacterTalkingZoom\n\t\t);\n\t}\n\tpublic async loadSettings(): Promise<Settings> {\n\t\treturn {\n\t\t\tlq: false,\n\t\t\tnsfw:\n\t\t\t\t(await this.electron.ipcRenderer.sendConvo('config.get', 'nsfw')) ??\n\t\t\t\tfalse,\n\t\t\tdarkMode:\n\t\t\t\t(await this.electron.ipcRenderer.sendConvo('config.get', 'darkMode')) ??\n\t\t\t\tundefined,\n\t\t\tdefaultCharacterTalkingZoom:\n\t\t\t\t(await this.electron.ipcRenderer.sendConvo(\n\t\t\t\t\t'config.get',\n\t\t\t\t\t'defaultCharacterTalkingZoom'\n\t\t\t\t)) ?? undefined,\n\t\t};\n\t}\n\n\tpublic async localRepoInstall(\n\t\turl: string,\n\t\trepo: IPack,\n\t\tauthors: IAuthors\n\t): Promise<void> {\n\t\tawait this.electron.ipcRenderer.sendConvo(\n\t\t\t'repo.install',\n\t\t\turl,\n\t\t\trepo,\n\t\t\tauthors\n\t\t);\n\t}\n\tpublic async localRepoUninstall(id: string): Promise<void> {\n\t\tawait this.electron.ipcRenderer.sendConvo('repo.uninstall', id);\n\t}\n\tpublic async autoLoadAdd(id: string): Promise<void> {\n\t\tawait this.electron.ipcRenderer.sendConvo('auto-load.add', id);\n\t}\n\tpublic async autoLoadRemove(id: string): Promise<void> {\n\t\tawait this.electron.ipcRenderer.sendConvo('auto-load.remove', id);\n\t}\n\n\tpublic saveToFile(\n\t\tdownloadCanvas: HTMLCanvasElement,\n\t\tfilename: string,\n\t\tformat = 'image/png',\n\t\tquality = 1\n\t): Promise<string> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tdownloadCanvas.toBlob(\n\t\t\t\tasync blob => {\n\t\t\t\t\tif (!blob) {\n\t\t\t\t\t\treject();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst buffer = await (blob as any).arrayBuffer();\n\t\t\t\t\tawait this.electron.ipcRenderer.sendConvo(\n\t\t\t\t\t\t'save-file',\n\t\t\t\t\t\tfilename,\n\t\t\t\t\t\tnew Uint8Array(buffer)\n\t\t\t\t\t);\n\t\t\t\t\tresolve(URL.createObjectURL(blob));\n\t\t\t\t},\n\t\t\t\tformat,\n\t\t\t\tquality\n\t\t\t);\n\t\t});\n\t}\n\n\tpublic async installBackground(background: Background): Promise<void> {\n\t\tif (background.assets.length !== 1) return;\n\t\tif (\n\t\t\tbackground.assets[0].sourcePack !== 'dddg.buildin.uploadedBackgrounds'\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst asset = await getAsset(background.assets[0].hq, true);\n\t\tif (!(asset instanceof HTMLImageElement)) return;\n\t\tconst img = await fetch(asset.src);\n\t\tconst array = new Uint8Array(await img.arrayBuffer());\n\t\tthis.electron.ipcRenderer.send('install-background', array);\n\t}\n\n\tpublic async uninstallBackground(background: Background): Promise<void> {\n\t\tif (background.assets.length !== 1) return;\n\t\tif (\n\t\t\tbackground.assets[0].sourcePack !== 'dddg.buildin.installedBackgrounds'\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst asset = await getAsset(background.assets[0].hq, true);\n\t\tif (!(asset instanceof HTMLImageElement)) return;\n\t\tif (!asset.src.startsWith('blob:')) {\n\t\t\tconst img = await fetch(asset.src);\n\t\t\tconst blob = await img.blob();\n\t\t\tconst newUrl = URL.createObjectURL(blob);\n\t\t\tregisterAssetWithURL(background.assets[0].hq, newUrl);\n\t\t}\n\t\tthis.electron.ipcRenderer.send('uninstall-background', background.id);\n\t}\n\n\tpublic async prompt(\n\t\tmessage: string,\n\t\tdefaultValue?: string\n\t): Promise<string | null> {\n\t\treturn await this.electron.ipcRenderer.sendConvo(\n\t\t\t'show-prompt',\n\t\t\tmessage,\n\t\t\tdefaultValue\n\t\t);\n\t}\n\n\tpublic connectToStore(\n\t\tvuexHistory: IHistorySupport,\n\t\tstore: Store<DeepReadonly<IRootState>>\n\t) {\n\t\tthis.vuexHistory = vuexHistory;\n\t\tthis.$store = store;\n\t\tthis.invalidateInstalledBGs();\n\n\t\tif (this.pendingContentPacks.length > 0) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tawait this.$store!.dispatch(\n\t\t\t\t\t'content/loadContentPacks',\n\t\t\t\t\tthis.pendingContentPacks\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate invalidateInstalledBGs() {\n\t\tif (!this.vuexHistory || !this.$store) return;\n\t\tif (this.bgInvalidation !== null) return;\n\t\tthis.bgInvalidation = requestAnimationFrame(() => {\n\t\t\tthis.updateInstalledBGs();\n\t\t});\n\t}\n\n\tprivate updateInstalledBGs() {\n\t\tif (this.bgInvalidation) {\n\t\t\tcancelAnimationFrame(this.bgInvalidation);\n\t\t\tthis.bgInvalidation = null;\n\t\t}\n\t\tif (!this.vuexHistory || !this.$store) return;\n\n\t\tthis.vuexHistory.transaction(() => {\n\t\t\tthis.$store!.dispatch('content/replaceContentPack', {\n\t\t\t\tcontentPack: installedBackgroundsPack,\n\t\t\t} as ReplaceContentPackAction);\n\t\t});\n\t}\n}\n\ninterface IElectronWindow {\n\tisElectron: boolean;\n\tipcRenderer: IpcRenderer;\n}\n\ninterface IpcRenderer {\n\ton(channel: string, listener: (...args: any[]) => void): void;\n\tonConversation(channel: string, listener: (...args: any[]) => void): void;\n\tsend(channel: string, ...args: any[]): void;\n\tsendConvo<T>(channel: string, ...args: any[]): Promise<T>;\n}\n","import { OldEdge } from './edge';\nimport { Browser } from './browser';\nimport { Electron } from './electron';\nimport { Background } from '@/renderables/background';\nimport { EnvState } from './envState';\nimport { IHistorySupport } from '@/plugins/vuex-history';\nimport { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport { DeepReadonly } from '@/util/readonly';\nimport { IAuthors } from '@edave64/dddg-repo-filters/dist/authors';\nimport { IPack as ICPack } from '@edave64/dddg-repo-filters/dist/pack';\n\nexport interface IPack {\n\turl: string;\n\tid: string;\n\tcredits: string;\n}\n\nexport type Folder = 'downloads' | 'sprites' | 'backgrounds';\n\nexport interface EnvCapabilities {\n\tsetDownloadFolder: boolean;\n\toptionalSaving: boolean;\n\tautoLoading: boolean;\n\tlocalRepo: boolean;\n\tbackgroundInstall: boolean;\n\tlq: boolean;\n\topenableFolders: ReadonlySet<Folder>;\n}\n\nexport interface Settings {\n\tlq?: boolean;\n\tnsfw?: boolean;\n\tdarkMode?: boolean;\n\tdefaultCharacterTalkingZoom?: boolean;\n}\n\nexport interface IEnvironment {\n\treadonly localRepositoryUrl: string;\n\treadonly state: EnvState;\n\treadonly supports: DeepReadonly<EnvCapabilities>;\n\tsavingEnabled: boolean;\n\n\tsaveToFile(\n\t\tcanvas: HTMLCanvasElement,\n\t\tfilename: string,\n\t\tformat?: string,\n\t\tquality?: number\n\t): Promise<string>;\n\tinstallBackground(background: Background): void;\n\tuninstallBackground(background: Background): void;\n\tupdateDownloadFolder(): void;\n\topenFolder(folder: Folder): void;\n\tprompt(message: string, defaultValue?: string): Promise<string | null>;\n\tonPanelChange(handler: (panel: string) => void): void;\n\n\tlocalRepoInstall(url: string, repo: ICPack, authors: IAuthors): void;\n\tlocalRepoUninstall(id: string): void;\n\tautoLoadAdd(id: string): void;\n\tautoLoadRemove(id: string): void;\n\n\tsaveSettings(settings: Settings): Promise<void>;\n\tloadSettings(): Promise<Settings>;\n\tconnectToStore(\n\t\tvuexHistory: IHistorySupport,\n\t\tstore: Store<DeepReadonly<IRootState>>\n\t): void;\n}\n\nfunction chooseEnv(): IEnvironment {\n\tif ((window as any).isElectron) {\n\t\treturn new Electron();\n\t}\n\tif (window.navigator.msSaveOrOpenBlob !== undefined) {\n\t\treturn new OldEdge();\n\t}\n\treturn new Browser();\n}\n\nconst envX = chooseEnv();\n\n(window as any).toast = envX;\nexport default envX;\n","import { DeepReadonly } from '@/util/readonly';\nimport mitt from 'mitt';\n\nconst eventBus = mitt();\n\nexport default {\n\tfire(event: IEvent) {\n\t\teventBus.emit(event.kind, event);\n\t},\n\n\tsubscribe<T extends IEvent>(\n\t\teventType: IEventClass<T>,\n\t\thandler: (ev: T) => void\n\t) {\n\t\teventBus.on(eventType.kind, handler as any);\n\t},\n\n\tunsubscribe<T extends IEvent>(\n\t\teventType: IEventClass<T>,\n\t\thandler: (ev: T) => void\n\t) {\n\t\teventBus.off(eventType.kind, handler as any);\n\t},\n};\n\ninterface IEvent {\n\tkind: string;\n}\n\ninterface IEventClass<T> {\n\tkind: string;\n\tnew (...args: any[]): T;\n}\n\n// tslint:disable: max-classes-per-file\n\nexport class AssetFailureEvent implements IEvent {\n\tpublic static readonly kind = 'AssetFailureEvent';\n\tpublic readonly kind = 'AssetFailureEvent';\n\tpublic constructor(public path: string) {}\n}\n\nexport class CustomAssetFailureEvent implements IEvent {\n\tpublic static readonly kind = 'CustomAssetFailureEvent';\n\tpublic readonly kind = 'CustomAssetFailureEvent';\n\tpublic constructor(public error: ErrorEvent) {}\n}\n\nexport class InvalidateRenderEvent implements IEvent {\n\tpublic static readonly kind = 'InvalidateRenderEvent';\n\tpublic readonly kind = 'InvalidateRenderEvent';\n}\n\nexport class ShowMessageEvent implements IEvent {\n\tpublic static readonly kind = 'ShowMessageEvent';\n\tpublic readonly kind = 'ShowMessageEvent';\n\tpublic constructor(public message: string) {}\n}\n\nexport class ColorPickedEvent implements IEvent {\n\tpublic static readonly kind = 'ColorPickedEvent';\n\tpublic readonly kind = 'ColorPickedEvent';\n\tpublic constructor(public color: string) {}\n}\nexport class VueErrorEvent implements IEvent {\n\tpublic static readonly kind = 'VueErrorEvent';\n\tpublic readonly kind = 'VueErrorEvent';\n\tpublic constructor(\n\t\tpublic readonly error: DeepReadonly<Error>,\n\t\tpublic readonly info: string\n\t) {}\n}\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./message-console.vue?vue&type=style&index=0&id=51633a54&lang=scss&scoped=true\"","import {\n\tICharacter,\n\tgetPose,\n\tgetHeads,\n\tgetData,\n} from '@/store/objectTypes/characters';\nimport {\n\tPose,\n\tCharacter as CharacterModel,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport { DeepReadonly } from '@/util/readonly';\nimport { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport {\n\tAssetListRenderable,\n\tIDrawAssetsUnloaded,\n} from './assetListRenderable';\n\nexport class Character extends AssetListRenderable<ICharacter> {\n\tpublic constructor(\n\t\tobj: DeepReadonly<ICharacter>,\n\t\tprivate data: DeepReadonly<CharacterModel<IAsset>>\n\t) {\n\t\tsuper(obj);\n\t}\n\n\tpublic updatedContent(\n\t\tstore: Store<DeepReadonly<IRootState>>,\n\t\tpanelId: string\n\t): void {\n\t\tsuper.updatedContent(store, panelId);\n\t\tthis.data = getData(store, this.obj);\n\t}\n\n\tprotected getAssetList(): IDrawAssetsUnloaded[] {\n\t\tconst pose = getPose(this.data, this.obj) as Pose<IAsset>;\n\t\tconst currentHeads = getHeads(this.data, this.obj);\n\t\tconst drawAssetsUnloaded: IDrawAssetsUnloaded[] = [];\n\n\t\tfor (const renderCommand of pose.renderCommands) {\n\t\t\tswitch (renderCommand.type) {\n\t\t\t\tcase 'head':\n\t\t\t\t\tdrawAssetsUnloaded.push({\n\t\t\t\t\t\toffset: renderCommand.offset,\n\t\t\t\t\t\tcomposite: renderCommand.composite,\n\t\t\t\t\t\tassets: currentHeads\n\t\t\t\t\t\t\t? currentHeads.variants[this.obj.posePositions.head || 0]\n\t\t\t\t\t\t\t: [],\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image':\n\t\t\t\t\tdrawAssetsUnloaded.push({\n\t\t\t\t\t\toffset: renderCommand.offset,\n\t\t\t\t\t\tcomposite: renderCommand.composite,\n\t\t\t\t\t\tassets: renderCommand.images,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'pose-part':\n\t\t\t\t\tconst posePosition = pose.positions[renderCommand.part];\n\t\t\t\t\tif (!posePosition || posePosition.length === 0) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tconst partAssets =\n\t\t\t\t\t\tposePosition[this.obj.posePositions[renderCommand.part] || 0];\n\t\t\t\t\tif (!partAssets) break;\n\t\t\t\t\tdrawAssetsUnloaded.push({\n\t\t\t\t\t\toffset: renderCommand.offset,\n\t\t\t\t\t\tcomposite: renderCommand.composite,\n\t\t\t\t\t\tassets: partAssets,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn drawAssetsUnloaded;\n\t}\n\n\tprotected scaleable = true;\n\tprotected get canvasHeight(): number {\n\t\tconst pose = getPose(this.data, this.obj) as Pose<IAsset>;\n\t\treturn pose.size[1];\n\t}\n\tprotected get canvasWidth(): number {\n\t\tconst pose = getPose(this.data, this.obj) as Pose<IAsset>;\n\t\treturn pose.size[0];\n\t}\n\n\tpublic get closeZoom(): number {\n\t\tlet zoom = 1;\n\t\tif (this.obj.close) zoom *= 2;\n\t\treturn zoom;\n\t}\n\n\tpublic get width() {\n\t\treturn this.obj.width * this.closeZoom;\n\t}\n\n\tpublic get height() {\n\t\treturn this.obj.height * this.closeZoom;\n\t}\n}\n","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./parts.vue?vue&type=style&index=0&id=47f2e1e8&lang=scss&scoped=true\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./d-fieldset.vue?vue&type=style&index=0&id=36ffea9a&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./notification.vue?vue&type=style&index=0&id=618f75f2&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./object-tool.vue?vue&type=style&index=0&id=585ac6ce&lang=scss&scoped=true\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./toolbox.vue?vue&type=style&index=0&id=111e9686&lang=scss\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./positionAndSize.vue?vue&type=style&index=0&id=7f101752&lang=scss&scoped=true\"","<template>\n\t<a target=\"_blank\" rel=\"noopener noreferrer\" :href=\"href\">\n\t\t<slot />\n\t</a>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport { VerticalScrollRedirect } from '../vertical-scroll-redirect';\n/**\n * a-tag links by default kinda suck for web apps, since they leave the current\n * page and do funny stuff with shared javascript contexts.\n * This takes care of the boilerplate\n */\nexport default defineComponent({\n\tmixins: [VerticalScrollRedirect],\n\tprops: {\n\t\tto: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\thref(): string {\n\t\t\tlet to = this.to;\n\t\t\tto = to.replace(\n\t\t\t\t/^github:\\/\\//,\n\t\t\t\t'https://github.com/edave64/Doki-Doki-Dialog-Generator/'\n\t\t\t);\n\t\t\tto = to.replace(/^wiki:\\/\\/(.*)/, (_, page) => {\n\t\t\t\treturn (\n\t\t\t\t\t'https://github.com/edave64/Doki-Doki-Dialog-Generator/wiki/Version-2:-' +\n\t\t\t\t\tpage.replaceAll(' ', '-')\n\t\t\t\t);\n\t\t\t});\n\t\t\treturn to;\n\t\t},\n\t},\n});\n</script>\n","\nimport { defineComponent } from 'vue';\nimport { VerticalScrollRedirect } from '../vertical-scroll-redirect';\n/**\n * a-tag links by default kinda suck for web apps, since they leave the current\n * page and do funny stuff with shared javascript contexts.\n * This takes care of the boilerplate\n */\nexport default defineComponent({\n\tmixins: [VerticalScrollRedirect],\n\tprops: {\n\t\tto: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\thref(): string {\n\t\t\tlet to = this.to;\n\t\t\tto = to.replace(\n\t\t\t\t/^github:\\/\\//,\n\t\t\t\t'https://github.com/edave64/Doki-Doki-Dialog-Generator/'\n\t\t\t);\n\t\t\tto = to.replace(/^wiki:\\/\\/(.*)/, (_, page) => {\n\t\t\t\treturn (\n\t\t\t\t\t'https://github.com/edave64/Doki-Doki-Dialog-Generator/wiki/Version-2:-' +\n\t\t\t\t\tpage.replaceAll(' ', '-')\n\t\t\t\t);\n\t\t\t});\n\t\t\treturn to;\n\t\t},\n\t},\n});\n","import { render } from \"./link.vue?vue&type=template&id=e82bc934\"\nimport script from \"./link.vue?vue&type=script&lang=ts\"\nexport * from \"./link.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","import { RenderContext } from '@/renderer/rendererContext';\r\nimport { Renderer } from '@/renderer/renderer';\r\nimport { IHitbox } from './renderable';\r\nimport { DeepReadonly } from '@/util/readonly';\r\nimport { SpriteFilter } from '@/store/sprite_options';\r\nimport { screenHeight, screenWidth } from '@/constants/base';\r\nimport { CompositeModes } from '@/renderer/rendererContext';\r\nimport { IObject } from '@/store/objects';\r\nimport { Store } from 'vuex';\r\nimport { IRootState } from '@/store';\r\nimport { rotateAround } from '@/util/rotation';\r\nimport { ITextBox } from '@/store/objectTypes/textbox';\r\n\r\nexport abstract class OffscreenRenderable<Obj extends IObject> {\r\n\tprivate localRenderer: Renderer | null = null;\r\n\tprivate lastVersion: any = null;\r\n\tprivate hitDetectionFallback = false;\r\n\tprotected renderable: boolean = false;\r\n\r\n\tpublic constructor(protected obj: DeepReadonly<Obj>) {}\r\n\r\n\tprotected abstract readonly canvasHeight: number;\r\n\tprotected abstract readonly canvasWidth: number;\r\n\r\n\t// The dimentions used to draw the local canvas onto the target. Is different from `canvasHeight` and `canvasWidth` to allow scaling\r\n\tprotected abstract readonly canvasDrawHeight: number;\r\n\tprotected abstract readonly canvasDrawWidth: number;\r\n\tprotected abstract readonly canvasDrawPosX: number;\r\n\tprotected abstract readonly canvasDrawPosY: number;\r\n\tprotected abstract renderLocal(rx: RenderContext): Promise<void>;\r\n\r\n\tprotected lastHq: boolean = false;\r\n\r\n\tprotected readonly ready = Promise.resolve();\r\n\r\n\tpublic get id(): string {\r\n\t\treturn this.obj.id;\r\n\t}\r\n\r\n\tprotected get x(): number {\r\n\t\treturn this.obj.x;\r\n\t}\r\n\tprotected get y(): number {\r\n\t\treturn this.obj.y;\r\n\t}\r\n\tprotected get version(): number {\r\n\t\treturn this.obj.version;\r\n\t}\r\n\tprotected get flip(): boolean {\r\n\t\treturn this.obj.flip;\r\n\t}\r\n\tprotected get rotation(): number {\r\n\t\treturn (this.obj.rotation / 180) * Math.PI;\r\n\t}\r\n\tprotected get composite(): CompositeModes {\r\n\t\treturn this.obj.composite;\r\n\t}\r\n\tprotected get filters(): DeepReadonly<SpriteFilter[]> {\r\n\t\treturn this.obj.filters;\r\n\t}\r\n\tprotected get width(): number {\r\n\t\treturn this.obj.width;\r\n\t}\r\n\tprotected get height(): number {\r\n\t\treturn this.obj.height;\r\n\t}\r\n\r\n\tpublic async updateLocalCanvas(hq: boolean) {\r\n\t\tawait this.ready;\r\n\t\tconst width = this.canvasWidth;\r\n\t\tconst height = this.canvasHeight;\r\n\t\tif (height === 0 && width === 0) {\r\n\t\t\tthis.renderable = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.renderable = true;\r\n\t\tthis.localRenderer = new Renderer(width, height);\r\n\t\tthis.lastHq = hq;\r\n\t\tawait this.localRenderer.render(this.renderLocal.bind(this));\r\n\t}\r\n\r\n\tpublic needsRedraw(): boolean {\r\n\t\treturn this.localRenderer === null || this.lastVersion !== this.version;\r\n\t}\r\n\r\n\tpublic getRenderRotation(): [number, { x: number; y: number } | undefined] {\r\n\t\treturn [\r\n\t\t\tthis.flip ? -this.rotation : this.rotation,\r\n\t\t\t{\r\n\t\t\t\tx: this.x,\r\n\t\t\t\ty: this.y + this.height / 2,\r\n\t\t\t},\r\n\t\t];\r\n\t}\r\n\r\n\tpublic async render(selected: boolean, rx: RenderContext) {\r\n\t\tconst needRedraw = this.lastHq !== rx.hq || this.needsRedraw();\r\n\r\n\t\tif (needRedraw) await this.updateLocalCanvas(!rx.hq);\r\n\r\n\t\tthis.lastVersion = this.version;\r\n\r\n\t\tif (!this.renderable) return;\r\n\r\n\t\tconst [rotation, rotationAnchor] = this.getRenderRotation();\r\n\r\n\t\trx.drawImage({\r\n\t\t\timage: this.localRenderer!,\r\n\t\t\tx: this.canvasDrawPosX,\r\n\t\t\ty: this.canvasDrawPosY,\r\n\t\t\tw: this.canvasDrawWidth,\r\n\t\t\th: this.canvasDrawHeight,\r\n\t\t\trotation,\r\n\t\t\trotationAnchor,\r\n\t\t\tflip: this.flip,\r\n\t\t\tshadow: selected && rx.preview ? { blur: 20, color: 'red' } : undefined,\r\n\t\t\tcomposite: this.composite,\r\n\t\t\tfilters: this.filters,\r\n\t\t});\r\n\t}\r\n\r\n\tpublic hitTest(hx: number, hy: number): boolean {\r\n\t\tif (!this.localRenderer) return false;\r\n\r\n\t\tconst hitbox = this.getHitbox();\r\n\r\n\t\tconst centerX = hitbox.x0 + (hitbox.x1 - hitbox.x0) / 2;\r\n\t\tconst centerY = hitbox.y0 + (hitbox.y1 - hitbox.y0) / 2;\r\n\r\n\t\t// Rotate the hit backwards, to cancle the rotation of the object\r\n\t\tconst [rotatedHitX, rotatedHitY] = rotateAround(\r\n\t\t\thx,\r\n\t\t\thy,\r\n\t\t\tcenterX,\r\n\t\t\tcenterY,\r\n\t\t\tthis.flip ? this.rotation : -this.rotation\r\n\t\t);\r\n\r\n\t\tconst hit =\r\n\t\t\trotatedHitX >= hitbox.x0 &&\r\n\t\t\trotatedHitX <= hitbox.x1 &&\r\n\t\t\trotatedHitY >= hitbox.y0 &&\r\n\t\t\trotatedHitY <= hitbox.y1;\r\n\r\n\t\tif (!hit) return false;\r\n\t\t// We can't do pixel perfect detection and we have a hitbox hit -> true\r\n\t\tif (this.hitDetectionFallback) return true;\r\n\r\n\t\ttry {\r\n\t\t\treturn this.pixelPerfectHitTest(hx, hy);\r\n\t\t} catch (e) {\r\n\t\t\tthis.hitDetectionFallback = true;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tpublic pixelPerfectHitTest(x: number, y: number): boolean {\r\n\t\tif (!this.localRenderer) return false;\r\n\t\tconst [angle, anchor] = this.getRenderRotation();\r\n\t\tconst [rotatedHitX, rotatedHitY] = anchor\r\n\t\t\t? rotateAround(x, y, anchor.x, anchor.y, -angle)\r\n\t\t\t: [x, y];\r\n\r\n\t\tconst innerX = Math.round(rotatedHitX - this.canvasDrawPosX);\r\n\t\tconst innerY = Math.round(rotatedHitY - this.canvasDrawPosY);\r\n\r\n\t\tconst canvasDrawWidth = this.canvasDrawWidth;\r\n\t\tconst canvasDrawHeight = this.canvasDrawHeight;\r\n\r\n\t\tif (\r\n\t\t\tinnerX >= 0 &&\r\n\t\t\tinnerX <= canvasDrawWidth &&\r\n\t\t\tinnerY >= 0 &&\r\n\t\t\tinnerY <= canvasDrawHeight\r\n\t\t) {\r\n\t\t\tconst flippedX = this.flip ? this.canvasDrawWidth - innerX : innerX;\r\n\t\t\tconst scaleX = this.canvasWidth / this.canvasDrawWidth;\r\n\t\t\tconst scaleY = this.canvasHeight / this.canvasDrawHeight;\r\n\t\t\tconst data = this.localRenderer.getDataAt(\r\n\t\t\t\tMath.round(flippedX * scaleX),\r\n\t\t\t\tMath.round(innerY * scaleY)\r\n\t\t\t);\r\n\t\t\treturn data[3] !== 0;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the hitbox of the object, *not* taking into account any rotation (as that would just inflate the hitbox and reduce accuracy)\r\n\t * To manually apply rotation to it, rotate your hit test by `this.rotation` around the center of the hitbox.\r\n\t */\r\n\tpublic getHitbox(): IHitbox {\r\n\t\treturn {\r\n\t\t\tx0: this.x - this.width / 2,\r\n\t\t\tx1: this.x + this.width / 2,\r\n\t\t\ty0: this.y,\r\n\t\t\ty1: this.y + this.height,\r\n\t\t};\r\n\t}\r\n\r\n\tpublic updatedContent(\r\n\t\t_current: Store<DeepReadonly<IRootState>>,\r\n\t\tpanelId: string\r\n\t): void {}\r\n}\r\n","import { IPack as IPrimitivePack } from '@edave64/dddg-repo-filters/dist/pack';\r\nimport { IAuthor, IAuthors } from '@edave64/dddg-repo-filters/dist/authors';\r\nimport environment from '@/environments/environment';\r\nimport eventBus, { ShowMessageEvent } from '@/eventbus/event-bus';\r\nimport { computed, ComputedRef, DeepReadonly, ref, Ref } from 'vue';\r\nimport { Store } from 'vuex';\r\nimport { IRootState } from '@/store';\r\n\r\nconst repoUrl = 'https://edave64.github.io/Doki-Doki-Dialog-Generator-Packs/';\r\n\r\nexport type LoadedRepo = {\r\n\tpacks: IPrimitivePack[];\r\n\tauthors: IAuthors;\r\n};\r\n\r\nexport class Repo {\r\n\tprivate static instance: null | Promise<Repo>;\r\n\tpublic static setStore: ($store: Store<DeepReadonly<IRootState>>) => void;\r\n\tprivate static $store: Promise<Store<DeepReadonly<IRootState>>> = new Promise(\r\n\t\t(resolve, reject) => {\r\n\t\t\tRepo.setStore = resolve;\r\n\t\t}\r\n\t);\r\n\r\n\tpublic static getInstance(): Promise<Repo> {\r\n\t\tif (!Repo.instance) Repo.instance = this.createInstance();\r\n\t\treturn Repo.instance;\r\n\t}\r\n\r\n\tprivate static async createInstance(): Promise<Repo> {\r\n\t\tconst onlineRepoLoading = Repo.loadRepo(repoUrl);\r\n\t\tconst localRepoLoading = environment.supports.localRepo\r\n\t\t\t? Repo.loadRepo(environment.localRepositoryUrl)\r\n\t\t\t: null;\r\n\r\n\t\tconst [onlineRepoLoaded, localRepoLoaded, $store] = await Promise.all([\r\n\t\t\tonlineRepoLoading,\r\n\t\t\tlocalRepoLoading,\r\n\t\t\tRepo.$store,\r\n\t\t]);\r\n\r\n\t\treturn new Repo(onlineRepoLoaded, localRepoLoaded, $store);\r\n\t}\r\n\r\n\tprivate static async loadRepo(repo: string): Promise<LoadedRepo | null> {\r\n\t\ttry {\r\n\t\t\tconst [packs, authors] = await Promise.all([\r\n\t\t\t\tRepo.fetchJSON<IPrimitivePack[]>(repo + 'repo.json'),\r\n\t\t\t\tRepo.fetchJSON<IAuthors>(repo + 'people.json'),\r\n\t\t\t]);\r\n\t\t\treturn { packs, authors };\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static async fetchJSON<A>(path: string): Promise<A> {\r\n\t\tconst req = await fetch(path);\r\n\t\tif (!req.ok) throw new Error('Could not load json');\r\n\t\treturn await req!.json();\r\n\t}\r\n\r\n\tprivate readonly onlineRepo: Ref<LoadedRepo | null>;\r\n\tprivate readonly localRepo: Ref<LoadedRepo | null>;\r\n\r\n\tprivate readonly combinedList: ComputedRef<DeepReadonly<Pack[]>>;\r\n\tprivate readonly authors: ComputedRef<DeepReadonly<IAuthors>>;\r\n\r\n\tprivate constructor(\r\n\t\tonlineRepo: LoadedRepo | null,\r\n\t\tlocalRepo: LoadedRepo | null,\r\n\t\tprivate $store: Store<DeepReadonly<IRootState>>\r\n\t) {\r\n\t\t(window as any).repo = this;\r\n\t\tif (!onlineRepo) {\r\n\t\t\tonlineRepo = { authors: {}, packs: [] };\r\n\t\t\teventBus.fire(new ShowMessageEvent(\"Couldn't load remote repository.\"));\r\n\t\t}\r\n\t\tif (!localRepo) {\r\n\t\t\tlocalRepo = { authors: {}, packs: [] };\r\n\t\t\tif (environment.supports.localRepo) {\r\n\t\t\t\teventBus.fire(new ShowMessageEvent(\"Couldn't load local repository.\"));\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.onlineRepo = ref(onlineRepo);\r\n\t\tthis.localRepo = ref(localRepo);\r\n\r\n\t\tthis.combinedList = computed(() => {\r\n\t\t\tconst onlineRepo = this.onlineRepo.value;\r\n\t\t\tconst onlinePacks = onlineRepo?.packs ?? [];\r\n\t\t\tconst onlineAuthors = onlineRepo?.authors ?? {};\r\n\t\t\tconst onlineRepoLookup = new Map(\r\n\t\t\t\tonlinePacks.map(pack => [pack.id, pack])\r\n\t\t\t);\r\n\r\n\t\t\tconst localRepo = this.localRepo.value;\r\n\t\t\tconst localPacks = localRepo?.packs ?? [];\r\n\t\t\tconst localAuthors = localRepo?.authors ?? {};\r\n\t\t\tconst localRepoLookup = new Map(localPacks.map(pack => [pack.id, pack]));\r\n\r\n\t\t\tconst autoloads = new Set(environment.state.autoAdd);\r\n\t\t\tconst loadedPackOrder = this.$store.state.content.contentPacks\r\n\t\t\t\t.map(pack => pack.packId)\r\n\t\t\t\t.filter(packId => !!packId) as string[];\r\n\t\t\tconst loadedPacksSet = new Set(loadedPackOrder) as Set<string>;\r\n\r\n\t\t\tconst addedPacks = new Set();\r\n\t\t\treturn [\r\n\t\t\t\t...loadedPackOrder,\r\n\t\t\t\t...localPacks.map(pack => pack.id),\r\n\t\t\t\t...onlinePacks.map(pack => pack.id),\r\n\t\t\t]\r\n\t\t\t\t.filter(packId => {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tpackId.startsWith('dddg.buildin.') ||\r\n\t\t\t\t\t\tpackId.startsWith('dddg.desktop.')\r\n\t\t\t\t\t)\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\tif (addedPacks.has(packId)) return false;\r\n\t\t\t\t\taddedPacks.add(packId);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t})\r\n\t\t\t\t.map(packId => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...(onlineRepoLookup.get(packId) ?? {\r\n\t\t\t\t\t\t\tcharacters: [],\r\n\t\t\t\t\t\t\tkind: [],\r\n\t\t\t\t\t\t\tauthors: [],\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t...(localRepoLookup.get(packId) ?? {}),\r\n\t\t\t\t\t\tautoloading: autoloads.has(packId),\r\n\t\t\t\t\t\tinstalled: localRepoLookup.has(packId),\r\n\t\t\t\t\t\tonline: onlineRepoLookup.has(packId),\r\n\t\t\t\t\t\tloaded: loadedPacksSet.has(packId),\r\n\t\t\t\t\t} as Pack;\r\n\t\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.authors = computed(() => {\r\n\t\t\tconst onlineRepo = this.onlineRepo.value;\r\n\t\t\tconst onlineAuthors = onlineRepo?.authors ?? {};\r\n\r\n\t\t\tconst localRepo = this.localRepo.value;\r\n\t\t\tconst localAuthors = localRepo?.authors ?? {};\r\n\t\t\treturn {\r\n\t\t\t\t...onlineAuthors,\r\n\t\t\t\t...localAuthors,\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\t// Stop Vue from breaking this object.\r\n\t\tObject.freeze(this);\r\n\t}\r\n\r\n\tpublic async reloadLocalRepo() {\r\n\t\tthis.localRepo.value = environment.supports.localRepo\r\n\t\t\t? await Repo.loadRepo(environment.localRepositoryUrl)\r\n\t\t\t: null;\r\n\t}\r\n\r\n\tpublic getPacks(): DeepReadonly<Pack[]> {\r\n\t\treturn this.combinedList.value;\r\n\t}\r\n\r\n\tpublic getPack(id: string): DeepReadonly<Pack> {\r\n\t\treturn this.getPacks().find(pack => pack.id === id)!;\r\n\t}\r\n\r\n\tpublic getAuthor(id: string): DeepReadonly<IAuthor | null> {\r\n\t\treturn this.authors.value[id] || null;\r\n\t}\r\n\r\n\tpublic getAuthors(): DeepReadonly<IAuthors> {\r\n\t\treturn this.authors.value;\r\n\t}\r\n}\r\n\r\nexport interface Pack extends IPrimitivePack {\r\n\tautoloading: boolean;\r\n\tonline: boolean;\r\n\tinstalled: boolean;\r\n\tloaded: boolean;\r\n}\r\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { getAAsset } from '@/asset-manager';\nimport { PoseRenderCommand } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport { ErrorAsset } from '../models/error-asset';\nimport { DeepReadonly } from '@/util/readonly';\nimport { IObject } from '@/store/objects';\nimport { OffscreenRenderable } from './offscreenRenderable';\nimport { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { IHitbox } from './renderable';\n\nexport abstract class AssetListRenderable<\n\tObj extends IObject\n> extends OffscreenRenderable<Obj> {\n\tprotected refTextbox: ITextBox | null = null;\n\tprotected abstract getAssetList(): Array<IDrawAssetsUnloaded | IDrawAssets>;\n\tprotected get canvasDrawWidth(): number {\n\t\treturn this.width * this.objZoom;\n\t}\n\tprotected get canvasDrawHeight(): number {\n\t\treturn this.height * this.objZoom;\n\t}\n\tprotected get canvasDrawPosX(): number {\n\t\treturn this.x - this.width / 2 + (this.height - this.canvasDrawHeight) / 2;\n\t}\n\tprotected get canvasDrawPosY(): number {\n\t\treturn this.y + (this.height - this.canvasDrawHeight);\n\t}\n\n\tprotected get objZoom(): number {\n\t\tconst textboxZoom =\n\t\t\tthis.obj.enlargeWhenTalking && this.refTextbox ? 1.05 : 1;\n\t\treturn textboxZoom * this.obj.zoom;\n\t}\n\n\tpublic getHitbox(): IHitbox {\n\t\tconst base = super.getHitbox();\n\t\tconst zoomWidthDelta = this.width * (this.objZoom - 1);\n\t\tconst zoomHeightDelta = this.height * (this.objZoom - 1);\n\n\t\treturn {\n\t\t\tx0: base.x0 - zoomWidthDelta / 2,\n\t\t\tx1: base.x1 + zoomWidthDelta / 2,\n\t\t\ty0: base.y0 - zoomHeightDelta,\n\t\t\ty1: base.y1,\n\t\t};\n\t}\n\n\tpublic updatedContent(\n\t\t_current: Store<DeepReadonly<IRootState>>,\n\t\tpanelId: string\n\t): void {\n\t\tconst panel = _current.state.objects.panels[panelId];\n\t\tconst inPanel = [...panel.order, ...panel.onTopOrder];\n\t\tthis.refTextbox = null;\n\t\tfor (const key of inPanel) {\n\t\t\tconst obj = _current.state.objects.objects[key] as ITextBox;\n\t\t\tif (obj.type === 'textBox' && obj.talkingObjId === this.obj.id) {\n\t\t\t\tthis.refTextbox = obj;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected async renderLocal(rx: RenderContext): Promise<void> {\n\t\tconst drawAssetsUnloaded: Array<\n\t\t\tIDrawAssetsUnloaded | IDrawAssets\n\t\t> = this.getAssetList();\n\n\t\tconst loadedDraws = await Promise.all(\n\t\t\tdrawAssetsUnloaded\n\t\t\t\t.filter(drawAsset => drawAsset.assets)\n\t\t\t\t.map(drawAsset => loadAssets(drawAsset, rx.hq))\n\t\t);\n\t\tfor (const loadedDraw of loadedDraws) {\n\t\t\tfor (const asset of loadedDraw.assets) {\n\t\t\t\trx.drawImage({\n\t\t\t\t\timage: asset,\n\t\t\t\t\tcomposite: loadedDraw.composite,\n\t\t\t\t\tx: loadedDraw.offset[0],\n\t\t\t\t\ty: loadedDraw.offset[1],\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport interface IDrawAssetsUnloaded {\n\toffset: DeepReadonly<[number, number]>;\n\tassets: DeepReadonly<IAsset[]>;\n\tcomposite?: PoseRenderCommand<any>['composite'];\n}\n\nexport interface IDrawAssets {\n\tloaded: true;\n\toffset: DeepReadonly<[number, number]>;\n\tassets: DeepReadonly<Array<HTMLImageElement | ErrorAsset>>;\n\tcomposite?: PoseRenderCommand<any>['composite'];\n}\n\nexport async function loadAssets(\n\tunloaded: IDrawAssetsUnloaded | IDrawAssets,\n\thq: boolean\n): Promise<IDrawAssets> {\n\tif ('loaded' in unloaded) return unloaded;\n\treturn {\n\t\tloaded: true,\n\t\toffset: unloaded.offset,\n\t\tassets: await Promise.all(\n\t\t\tunloaded.assets.map(asset => getAAsset(asset, hq))\n\t\t),\n\t\tcomposite: unloaded.composite,\n\t};\n}\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./d-button.vue?vue&type=style&index=0&id=465f5994&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./panels.vue?vue&type=style&index=0&id=2ffec108&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./add.vue?vue&type=style&index=0&id=2601b562&lang=scss&scoped=true\"","import EventBus, {\n\tAssetFailureEvent,\n\tCustomAssetFailureEvent,\n} from './eventbus/event-bus';\nimport { ErrorAsset } from './models/error-asset';\nimport { IAsset } from './store/content';\nimport environment from './environments/environment';\n\nlet webpSupportPromise: Promise<boolean>;\nlet heifSupportPromise: Promise<boolean>;\n\nexport function isWebPSupported(): Promise<boolean> {\n\tif (!webpSupportPromise) {\n\t\twebpSupportPromise = new Promise((resolve, _reject) => {\n\t\t\tconst losslessCode =\n\t\t\t\t'data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=';\n\t\t\tconst img = document.createElement('img');\n\t\t\timg.addEventListener('load', () => {\n\t\t\t\tresolve(img.width === 2 && img.height === 1);\n\t\t\t});\n\t\t\timg.addEventListener('error', () => {\n\t\t\t\tresolve(false);\n\t\t\t});\n\t\t\timg.src = losslessCode;\n\t\t});\n\t}\n\treturn webpSupportPromise;\n}\n\nexport function isHeifSupported(): Promise<boolean> {\n\tif (!heifSupportPromise) {\n\t\theifSupportPromise = new Promise((resolve, _reject) => {\n\t\t\tconst losslessCode =\n\t\t\t\t'data:image/heic;base64,AAAAGGZ0eXBoZWljAAAAAG1pZjFoZWljAAAAsW1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAHBpY3QAXABjAGMAcwBsAGEAAAAADnBpdG0AAAAAAAEAAAAQaWxvYwAAAABEQAAAAAAAI2lpbmYAAAAAAAEAAAAVaW5mZQIAAAAAAQAAaHZjMQAAAABDaXBycAAAACdpcGNvAAAAH2h2Y0NmzGx1ci0AAAAAAABv9HP+//v9bjr3AAAAABRpcG1hAAAAAAAAAAEAAQGBAAAACG1kYXQ=';\n\t\t\tconst img = document.createElement('img');\n\t\t\timg.addEventListener('load', () => {\n\t\t\t\tconsole.log('Heif no error. ' + (img.width === 2 && img.height === 1));\n\t\t\t\tresolve(img.width === 2 && img.height === 1);\n\t\t\t});\n\t\t\timg.addEventListener('error', () => {\n\t\t\t\tconsole.log('Heif not supported');\n\t\t\t\tresolve(false);\n\t\t\t});\n\t\t\timg.src = losslessCode;\n\t\t});\n\t}\n\treturn heifSupportPromise;\n}\n\nconst assetCache: {\n\t[url: string]: Promise<HTMLImageElement | ErrorAsset> | undefined;\n} = {};\nconst customAssets: { [id: string]: Promise<HTMLImageElement> } = {};\n\nexport async function getAAsset(\n\tasset: IAsset,\n\thq: boolean = true\n): Promise<HTMLImageElement | ErrorAsset> {\n\treturn getAssetByUrl(environment.supports.lq && !hq ? asset.lq : asset.hq);\n}\nexport async function getAssetByUrl(\n\turl: string\n): Promise<HTMLImageElement | ErrorAsset> {\n\tif (!assetCache[url]) {\n\t\tassetCache[url] = new Promise((resolve, _reject) => {\n\t\t\tconst img = new Image();\n\t\t\timg.addEventListener('load', () => {\n\t\t\t\tresolve(img);\n\t\t\t});\n\t\t\timg.addEventListener('error', () => {\n\t\t\t\tEventBus.fire(new AssetFailureEvent(url));\n\t\t\t\tassetCache[url] = undefined;\n\t\t\t\tresolve(new ErrorAsset());\n\t\t\t});\n\t\t\timg.crossOrigin = 'Anonymous';\n\t\t\timg.src = url;\n\t\t\timg.style.display = 'none';\n\t\t\tdocument.body.appendChild(img);\n\t\t});\n\t}\n\n\treturn assetCache[url]!;\n}\nexport const baseUrl = process.env.BASE_URL === '' ? '.' : process.env.BASE_URL;\n\nexport async function getAsset(\n\tasset: string,\n\thq: boolean = true\n): Promise<HTMLImageElement | ErrorAsset> {\n\tif (customAssets[asset]) {\n\t\treturn customAssets[asset];\n\t}\n\n\tconst url = `${baseUrl}/assets/${asset}${hq ? '' : '.lq'}${\n\t\t(await isWebPSupported()) ? '.webp' : '.png'\n\t}`.replace(/\\/+/, '/');\n\treturn getAssetByUrl(url);\n}\n\nexport function registerAsset(asset: string, file: File): string {\n\tconst url = URL.createObjectURL(file);\n\tcustomAssets[asset] = new Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\t\timg.addEventListener('load', () => {\n\t\t\tresolve(img);\n\t\t});\n\t\timg.addEventListener('error', error => {\n\t\t\tEventBus.fire(new CustomAssetFailureEvent(error));\n\t\t\treject(`Failed to load \"${url}\"`);\n\t\t});\n\t\timg.crossOrigin = 'Anonymous';\n\t\timg.src = url;\n\t\timg.style.display = 'none';\n\t\tdocument.body.appendChild(img);\n\t});\n\treturn url;\n}\n\nexport function registerAssetWithURL(\n\tasset: string,\n\turl: string\n): Promise<HTMLImageElement> {\n\treturn (customAssets[asset] = new Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\t\timg.addEventListener('load', () => {\n\t\t\tresolve(img);\n\t\t});\n\t\timg.addEventListener('error', error => {\n\t\t\tEventBus.fire(new CustomAssetFailureEvent(error));\n\t\t\treject(`Failed to load \"${url}\"`);\n\t\t});\n\t\timg.crossOrigin = 'Anonymous';\n\t\timg.src = url;\n\t\timg.style.display = 'none';\n\t\tdocument.body.appendChild(img);\n\t}));\n}\n","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./settings.vue?vue&type=style&index=0&id=99a6545a&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./choice.vue?vue&type=style&index=0&id=6218d3d4&lang=scss&scoped=true\"","import { screenWidth } from '@/constants/base';\r\n\r\nexport function baseProps() {\r\n\treturn {\r\n\t\tflip: false,\r\n\t\trotation: 0,\r\n\t\tversion: 0,\r\n\t\topacity: 100,\r\n\t\tx: screenWidth / 2,\r\n\t\tcomposite: 'source-over',\r\n\t\tfilters: [],\r\n\t\tlabel: null,\r\n\t\ttextboxColor: null,\r\n\t\tenlargeWhenTalking: false,\r\n\t\tnameboxWidth: null,\r\n\t\tzoom: 1,\r\n\t};\r\n}\r\n","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./credits.vue?vue&type=style&index=0&id=753d2b9a&lang=scss&scoped=true\"","import { RenderAbortedException } from './renderAbortedException';\nimport { Renderer } from './renderer';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { SpriteFilter } from '@/store/sprite_options';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport type CompositeModes =\n\t| 'source-over'\n\t| 'source-in'\n\t| 'source-out'\n\t| 'source-atop'\n\t| 'destination-over'\n\t| 'destination-in'\n\t| 'destination-out'\n\t| 'destination-atop'\n\t| 'lighter'\n\t| 'copy'\n\t| 'xor'\n\t| 'multiply'\n\t| 'screen'\n\t| 'overlay'\n\t| 'darken'\n\t| 'lighten'\n\t| 'color-dodge'\n\t| 'color-burn'\n\t| 'hard-light'\n\t| 'soft-light'\n\t| 'difference'\n\t| 'exclusion'\n\t| 'hue'\n\t| 'saturation'\n\t| 'color'\n\t| 'luminosity';\n\nexport class RenderContext {\n\tprivate aborted: boolean = false;\n\n\tprivate constructor(\n\t\tprivate canvas: HTMLCanvasElement,\n\t\tpublic readonly fsCtx: CanvasRenderingContext2D,\n\t\tpublic readonly hq: boolean,\n\t\tpublic readonly preview: boolean\n\t) {}\n\n\tpublic static make(\n\t\tcanvas: HTMLCanvasElement,\n\t\thq: boolean,\n\t\tpreview: boolean\n\t): RenderContext {\n\t\treturn new RenderContext(canvas, canvas.getContext('2d')!, hq, preview);\n\t}\n\n\tpublic static makeWithContext(\n\t\tcanvas: HTMLCanvasElement,\n\t\tcontext: CanvasRenderingContext2D,\n\t\thq: boolean,\n\t\tpreview: boolean\n\t): RenderContext {\n\t\treturn new RenderContext(canvas, context, hq, preview);\n\t}\n\n\tpublic drawText(\n\t\tparams: { text: string; align?: CanvasTextAlign; font?: string } & IRPos &\n\t\t\tIOOutline &\n\t\t\tIOFill\n\t) {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tthis.fsCtx.save();\n\n\t\tconst { font, align, x = 0, y = 0, text = '' } = {\n\t\t\t...{\n\t\t\t\tfont: '20px aller',\n\t\t\t\talign: 'left' as CanvasTextAlign,\n\t\t\t},\n\t\t\t...params,\n\t\t};\n\n\t\tthis.fsCtx.lineJoin = 'round';\n\t\tthis.fsCtx.textAlign = align;\n\t\tthis.fsCtx.font = font;\n\n\t\tif (params.outline) {\n\t\t\tthis.fsCtx.strokeStyle = params.outline.style;\n\t\t\tthis.fsCtx.lineWidth = params.outline.width;\n\t\t\tthis.fsCtx.strokeText(text, x, y);\n\t\t}\n\n\t\tif (params.fill) {\n\t\t\tthis.fsCtx.fillStyle = params.fill.style;\n\t\t\tthis.fsCtx.fillText(text, x, y);\n\t\t}\n\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic measureText(\n\t\tparams: {\n\t\t\ttext: string;\n\t\t\talign?: CanvasTextAlign;\n\t\t\tfont?: string;\n\t\t} & IOOutline &\n\t\t\tIOFill\n\t): TextMetrics {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tthis.fsCtx.save();\n\n\t\tconst { font, align, text = '' } = {\n\t\t\t...{\n\t\t\t\tfont: '20px aller',\n\t\t\t\talign: 'left' as CanvasTextAlign,\n\t\t\t},\n\t\t\t...params,\n\t\t};\n\n\t\tthis.fsCtx.lineJoin = 'round';\n\t\tthis.fsCtx.textAlign = align;\n\t\tthis.fsCtx.font = font;\n\n\t\tif (params.outline) {\n\t\t\tthis.fsCtx.strokeStyle = params.outline.style;\n\t\t\tthis.fsCtx.lineWidth = params.outline.width;\n\t\t}\n\n\t\tif (params.fill) {\n\t\t\tthis.fsCtx.fillStyle = params.fill.style;\n\t\t}\n\t\tconst ret = this.fsCtx.measureText(text);\n\t\tthis.fsCtx.restore();\n\t\treturn ret;\n\t}\n\n\tpublic drawImage(\n\t\tparams: {\n\t\t\timage: HTMLImageElement | ErrorAsset | Renderer;\n\t\t\tflip?: boolean;\n\t\t\tcomposite?: CompositeModes;\n\t\t} & IRPos &\n\t\t\tIOSize &\n\t\t\tIOShadow &\n\t\t\tIOFilters &\n\t\t\tIORotation\n\t): void {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tif (params.image instanceof ErrorAsset) return;\n\t\tconst { image, flip, x, y, w, h, filters, composite } = {\n\t\t\tflip: false,\n\t\t\tw: params.image.width,\n\t\t\th: params.image.height,\n\t\t\tcomposite: 'source-over' as 'source-over',\n\t\t\t...params,\n\t\t};\n\n\t\tthis.fsCtx.save();\n\t\tthis.fsCtx.globalCompositeOperation = composite;\n\n\t\tif (filters) {\n\t\t\t// Safari fallback\n\t\t\tif (!(('filter' in this.fsCtx) as any)) {\n\t\t\t\tlet opacityCombined = 1;\n\t\t\t\tfor (const filter of filters) {\n\t\t\t\t\tif (filter.type === 'opacity') {\n\t\t\t\t\t\topacityCombined *= filter.value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.fsCtx.globalAlpha = opacityCombined;\n\t\t\t} else {\n\t\t\t\tconst filterList: string[] = [];\n\t\t\t\tfor (const filter of filters) {\n\t\t\t\t\tif (filter.type === 'drop-shadow') {\n\t\t\t\t\t\tfilterList.push(\n\t\t\t\t\t\t\t`drop-shadow(${filter.offsetX}px ${filter.offsetY}px ${filter.blurRadius}px ${filter.color})`\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if (filter.type === 'hue-rotate') {\n\t\t\t\t\t\tfilterList.push(`hue-rotate(${filter.value}deg)`);\n\t\t\t\t\t} else if (filter.type === 'blur') {\n\t\t\t\t\t\tfilterList.push(`blur(${filter.value}px)`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfilterList.push(`${filter.type}(${filter.value * 100}%)`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.fsCtx.filter = filterList.join(' ');\n\t\t\t}\n\t\t}\n\n\t\tif (params.shadow) {\n\t\t\tconst shadow = params.shadow;\n\t\t\tif (shadow.color) {\n\t\t\t\tthis.fsCtx.shadowColor = shadow.color;\n\t\t\t}\n\t\t\tif (shadow.blur) {\n\t\t\t\tthis.fsCtx.shadowBlur = shadow.blur;\n\t\t\t}\n\t\t\tif (shadow.offsetX) {\n\t\t\t\tthis.fsCtx.shadowOffsetX = shadow.offsetX;\n\t\t\t}\n\t\t\tif (shadow.offsetY) {\n\t\t\t\tthis.fsCtx.shadowOffsetY = shadow.offsetY;\n\t\t\t}\n\t\t}\n\n\t\tif (params.rotation) {\n\t\t\tconst rotX = params.rotationAnchor ? params.rotationAnchor.x : 0;\n\t\t\tconst rotY = params.rotationAnchor ? params.rotationAnchor.y : 0;\n\t\t\tif (params.rotationAnchor) {\n\t\t\t\tthis.fsCtx.translate(rotX, rotY);\n\t\t\t}\n\t\t\tthis.fsCtx.fillRect(-10, -1, 21, 3);\n\t\t\tthis.fsCtx.rotate(params.rotation);\n\t\t\tif (params.rotationAnchor) {\n\t\t\t\tthis.fsCtx.translate(-rotX, -rotY);\n\t\t\t}\n\t\t}\n\n\t\tthis.fsCtx.translate(x + w / 2, y + h / 2);\n\t\tthis.fsCtx.scale(flip ? -1 : 1, 1);\n\t\tif (image instanceof Renderer) {\n\t\t\timage.paintOnto(this.fsCtx, { x: -w / 2, y: -h / 2, w, h });\n\t\t} else {\n\t\t\tthis.fsCtx.drawImage(image as HTMLImageElement, -w / 2, -h / 2, w, h);\n\t\t}\n\t\tthis.fsCtx.restore();\n\t\tthis.fsCtx.globalCompositeOperation = 'source-over';\n\t}\n\n\tpublic drawRect({\n\t\tx,\n\t\ty,\n\t\tw,\n\t\th,\n\t\toutline,\n\t\tfill,\n\t\tcomposition,\n\t}: IRPos & IRSize & IOOutline & IOFill & IOComposition) {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tthis.fsCtx.save();\n\t\tthis.fsCtx.beginPath();\n\t\tthis.fsCtx.rect(x, y, w, h);\n\n\t\tif (composition) {\n\t\t\tthis.fsCtx.globalCompositeOperation = composition;\n\t\t}\n\n\t\tif (fill) {\n\t\t\tthis.fsCtx.fillStyle = fill.style;\n\t\t\tthis.fsCtx.fill();\n\t\t}\n\t\tif (outline) {\n\t\t\tthis.fsCtx.strokeStyle = outline.style;\n\t\t\tthis.fsCtx.lineWidth = outline.width;\n\t\t\tthis.fsCtx.stroke();\n\t\t}\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic drawPath({\n\t\toutline,\n\t\tfill,\n\t\tpath,\n\t}: { path: (ctx: CanvasPath) => void } & IOOutline & IOFill) {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tthis.fsCtx.save();\n\t\tthis.fsCtx.beginPath();\n\t\tpath(this.fsCtx);\n\n\t\tif (fill) {\n\t\t\tthis.fsCtx.fillStyle = fill.style;\n\t\t\tthis.fsCtx.fill();\n\t\t}\n\t\tif (outline) {\n\t\t\tthis.fsCtx.strokeStyle = outline.style;\n\t\t\tthis.fsCtx.lineWidth = outline.width;\n\t\t\tthis.fsCtx.stroke();\n\t\t}\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic patternFrom(\n\t\timage: HTMLImageElement | Renderer,\n\t\trepetition: 'repeat' | 'repeat-x' | 'repeat-y' | 'no-repeat' = 'repeat'\n\t): CanvasPattern {\n\t\tif (image instanceof Renderer) {\n\t\t\timage = (image as any).previewCanvas;\n\t\t}\n\t\treturn this.fsCtx.createPattern(\n\t\t\t(image as any) as CanvasImageSource,\n\t\t\trepetition\n\t\t)!;\n\t}\n\n\tpublic async customTransform(\n\t\ttransform: (transformContext: CanvasRenderingContext2D) => Promise<void>,\n\t\trender: (rx: RenderContext) => Promise<void>\n\t) {\n\t\tthis.fsCtx.save();\n\t\tawait transform(this.fsCtx);\n\t\tawait render(this);\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic linearGradient(\n\t\tx0: number,\n\t\ty0: number,\n\t\tx1: number,\n\t\ty1: number\n\t): CanvasGradient {\n\t\treturn this.fsCtx.createLinearGradient(x0, y0, x1, y1);\n\t}\n\n\tpublic applyFilters(filters: DeepReadonly<SpriteFilter[]>) {\n\t\tif (filters.length === 0) return;\n\t\t// Safari fallback\n\t\tthis.fsCtx.save();\n\t\tlet opacityCombined = 1;\n\t\tfor (const filter of filters) {\n\t\t\tif (filter.type === 'opacity') {\n\t\t\t\topacityCombined *= filter.value;\n\t\t\t}\n\t\t}\n\t\tif ('filter' in this.fsCtx) {\n\t\t\tconst filterList: string[] = [];\n\t\t\tfor (const filter of filters) {\n\t\t\t\tif (filter.type === 'opacity') continue;\n\t\t\t\tif (filter.type === 'drop-shadow') {\n\t\t\t\t\tfilterList.push(\n\t\t\t\t\t\t`drop-shadow(${filter.offsetX}px ${filter.offsetY}px ${filter.blurRadius}px ${filter.color})`\n\t\t\t\t\t);\n\t\t\t\t} else if (filter.type === 'hue-rotate') {\n\t\t\t\t\tfilterList.push(`hue-rotate(${filter.value}deg)`);\n\t\t\t\t} else if (filter.type === 'blur') {\n\t\t\t\t\tfilterList.push(`blur(${filter.value}px)`);\n\t\t\t\t} else {\n\t\t\t\t\tfilterList.push(`${filter.type}(${filter.value * 100}%)`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.fsCtx.filter = filterList.join(' ');\n\t\t}\n\n\t\tthis.fsCtx.drawImage(this.canvas, 0, 0);\n\n\t\tif (opacityCombined !== 1) {\n\t\t\tthis.fsCtx.globalCompositeOperation = 'destination-atop';\n\t\t\tthis.fsCtx.fillStyle = `rgba(0,0,0,${opacityCombined})`;\n\t\t\tthis.fsCtx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n\t\t\tthis.fsCtx.globalCompositeOperation = 'source-over';\n\t\t}\n\n\t\tif ('filter' in this.fsCtx) {\n\t\t\tthis.fsCtx.filter = 'none';\n\t\t}\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic abort(): void {\n\t\tthis.aborted = true;\n\t}\n}\n\nexport interface IShadow {\n\tblur?: number;\n\tcolor?: string;\n\toffsetX?: number;\n\toffsetY?: number;\n}\n\nexport interface IOutline {\n\tstyle: string;\n\twidth: number;\n}\n\nexport interface IFill {\n\tstyle: string | CanvasGradient | CanvasPattern;\n}\n\ninterface IOShadow {\n\tshadow?: IShadow;\n}\n\ninterface IOComposition {\n\tcomposition?: CompositeModes;\n}\n\ninterface IRPos {\n\tx: number;\n\ty: number;\n}\n\ninterface IRSize {\n\tw: number;\n\th: number;\n}\n\ninterface IOSize {\n\tw?: number;\n\th?: number;\n}\n\ninterface IOOutline {\n\toutline?: IOutline;\n}\ninterface IOFilters {\n\tfilters?: DeepReadonly<SpriteFilter[]>;\n}\n\ninterface IORotation {\n\trotation?: number;\n\trotationAnchor?: {\n\t\tx: number;\n\t\ty: number;\n\t};\n}\n\ninterface IOFill {\n\tfill?: IFill;\n}\n","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./button.vue?vue&type=style&index=0&id=09138076&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./layers.vue?vue&type=style&index=0&id=90b83fd8&lang=scss&scoped=true\"","export class RenderAbortedException {}\n","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./image-options.vue?vue&type=style&index=0&id=4dd06317&lang=scss&scoped=true\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./toggle.vue?vue&type=style&index=0&id=7b1bf059&lang=scss\"","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./text.vue?vue&type=style&index=0&id=7fb63b2e&lang=scss&scoped=true\"","export function rotateAround(\r\n\tx: number,\r\n\ty: number,\r\n\trelX: number,\r\n\trelY: number,\r\n\tangle: number\r\n): [number, number] {\r\n\tconst angleCos = Math.cos(angle);\r\n\tconst angleSin = Math.sin(angle);\r\n\tconst translatedX = x - relX;\r\n\tconst translatedY = y - relY;\r\n\tconst rotatedX = angleCos * translatedX - angleSin * translatedY + relX;\r\n\tconst rotatedY = angleSin * translatedX + angleCos * translatedY + relY;\r\n\treturn [rotatedX, rotatedY];\r\n}\r\n","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./backgrounds.vue?vue&type=style&index=0&id=1c8b5613&lang=scss&scoped=true\"","export class ErrorAsset {}\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./d-flow.vue?vue&type=style&index=0&id=64adfc9c&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./object-tool.vue?vue&type=style&index=1&id=585ac6ce&lang=scss\"","import { ComponentOptionsMixin } from 'vue';\n\nconst firefoxDeltaFactor = 25;\n\nexport const VerticalScrollRedirect: ComponentOptionsMixin = {\n\tmethods: {\n\t\tverticalScrollRedirect(e: WheelEvent) {\n\t\t\tif (e.type !== 'wheel') return;\n\t\t\tif (!e.currentTarget) return;\n\t\t\tconst currentTarget = e.currentTarget as HTMLElement;\n\t\t\tconst target = getComputedStyle(currentTarget);\n\n\t\t\tconst ev = e as WheelEvent;\n\t\t\tif (ev.deltaY === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (target.overflowY === 'auto') {\n\t\t\t\tif (ev.deltaY > 0) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tcurrentTarget.scrollHeight >\n\t\t\t\t\t\tcurrentTarget.scrollTop + currentTarget.clientHeight\n\t\t\t\t\t) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (currentTarget.scrollTop > 0) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst oldScrollLeft = currentTarget.scrollLeft;\n\t\t\tif ((ev as any).mozInputSource) {\n\t\t\t\t// Firefox sends wierdly low delta values :/\n\t\t\t\tcurrentTarget.scrollLeft += ev.deltaY * firefoxDeltaFactor;\n\t\t\t} else {\n\t\t\t\tcurrentTarget.scrollLeft += ev.deltaY;\n\t\t\t}\n\t\t\tif (currentTarget.scrollLeft !== oldScrollLeft) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t},\n\t},\n};\n","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./slider.vue?vue&type=style&index=0&id=f14035dc&lang=scss&scoped=true\"","<template>\n\t<div class=\"fieldset_wrapper\">\n\t\t<fieldset>\n\t\t\t<legend v-if=\"title > ''\">{{ title }}</legend>\n\t\t\t<div class=\"fieldset_contents\">\n\t\t\t\t<slot />\n\t\t\t</div>\n\t\t</fieldset>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nexport default defineComponent({\n\tprops: {\n\t\ttitle: {\n\t\t\trequired: true,\n\t\t\ttype: String,\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.fieldset_contents {\n\tmargin-top: 0.5em;\n\theight: calc(100% - 0.5em);\n}\n\nlegend {\n\tline-height: 0px;\n\tuser-select: none;\n}\n\nfieldset {\n\tborder: 3px solid $default-border;\n\tborder: 3px solid var(--border);\n\theight: 100%;\n}\n.fieldset_wrapper {\n\tpadding-top: 0.5em;\n}\n</style>\n","\nimport { defineComponent } from 'vue';\nexport default defineComponent({\n\tprops: {\n\t\ttitle: {\n\t\t\trequired: true,\n\t\t\ttype: String,\n\t\t},\n\t},\n});\n","import { render } from \"./d-fieldset.vue?vue&type=template&id=36ffea9a&scoped=true\"\nimport script from \"./d-fieldset.vue?vue&type=script&lang=ts\"\nexport * from \"./d-fieldset.vue?vue&type=script&lang=ts\"\n\nimport \"./d-fieldset.vue?vue&type=style&index=0&id=36ffea9a&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-36ffea9a\"\n\nexport default script","import { ICommand } from '@/eventbus/command';\nimport {\n\tIObjectsState,\n\tICreateObjectMutation,\n\tIObject,\n\tISetPositionAction,\n\tISetObjectPositionMutation,\n\tIRemoveObjectAction,\n} from '@/store/objects';\nimport { MutationTree, ActionTree, Store, Commit, ActionContext } from 'vuex';\nimport { characterPositions } from '@/constants/base';\nimport { arraySeeker } from '@/models/seekers';\nimport { IHistoryOptions } from '@/plugins/vuex-history';\nimport {\n\tCharacter,\n\tPose,\n\tHeadCollection,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '../content';\nimport { IRootState } from '..';\nimport { DeepReadonly } from '@/util/readonly';\nimport { baseProps } from './baseObjectProps';\n\nexport interface ICharacter extends IObject {\n\ttype: 'character';\n\tcharacterType: string;\n\tfreeMove: boolean;\n\tclose: boolean;\n\tstyleGroupId: number;\n\tstyleId: number;\n\tposeId: number;\n\tposePositions: {\n\t\t[id: string]: number;\n\t};\n}\n\nexport const CloseUpYOffset = -74;\nexport const BaseCharacterYPos = -26;\n\nexport const characterMutations: MutationTree<IObjectsState> = {\n\tsetPose(state, command: ISetPoseMutation) {\n\t\tconst obj = state.objects[command.id] as ICharacter;\n\t\tobj.poseId = command.poseId;\n\t\t++obj.version;\n\t},\n\tsetCharStyleGroup(state, { id, styleGroupId }: ISetCharStyleGroupMutation) {\n\t\tconst obj = state.objects[id] as ICharacter;\n\t\tobj.styleGroupId = styleGroupId;\n\t\t++obj.version;\n\t},\n\tsetCharStyle(state, { id, styleId }: ISetCharStyleMutation) {\n\t\tconst obj = state.objects[id] as ICharacter;\n\t\tobj.styleId = styleId;\n\t\t++obj.version;\n\t},\n\tsetPosePosition(state, command: ISetPosePositionMutation) {\n\t\tconst obj = state.objects[command.id] as ICharacter;\n\t\tobj.posePositions = {\n\t\t\t...obj.posePositions,\n\t\t\t...command.posePositions,\n\t\t};\n\t\t++obj.version;\n\t},\n\tsetClose(state, command: ISetCloseMutation) {\n\t\tconst obj = state.objects[command.id] as ICharacter;\n\t\tobj.close = command.close;\n\t\t++obj.version;\n\t},\n\tsetFreeMove(state, command: ISetFreeMoveMutation) {\n\t\tconst obj = state.objects[command.id] as ICharacter;\n\t\tobj.freeMove = command.freeMove;\n\t\tif (!obj.freeMove) {\n\t\t\tobj.x = characterPositions[closestCharacterSlot(obj.x)];\n\t\t\tobj.y = BaseCharacterYPos;\n\t\t}\n\t},\n};\n\nexport function getData(\n\tstore: Store<DeepReadonly<IRootState>>,\n\tstate: DeepReadonly<ICharacter>\n): DeepReadonly<Character<IAsset>> {\n\tconst characters = store.getters['content/getCharacters'] as Map<\n\t\tCharacter<IAsset>['id'],\n\t\tCharacter<IAsset>\n\t>;\n\treturn characters.get(state.characterType)!;\n}\n\nexport function getDataG(\n\trootGetters: any,\n\tcharacterType: string\n): Readonly<Character<IAsset>> {\n\tconst characters = rootGetters['content/getCharacters'] as Map<\n\t\tCharacter<IAsset>['id'],\n\t\tCharacter<IAsset>\n\t>;\n\treturn characters.get(characterType)!;\n}\n\nexport function getPose(\n\tdata: DeepReadonly<Character<IAsset>>,\n\tstate: DeepReadonly<ICharacter>\n): DeepReadonly<Pose<IAsset>> {\n\treturn data.styleGroups[state.styleGroupId].styles[state.styleId].poses[\n\t\tstate.poseId\n\t];\n}\n\nexport function getParts(\n\tdata: DeepReadonly<Character<IAsset>>,\n\tstate: DeepReadonly<ICharacter>\n): DeepReadonly<string[]> {\n\tconst pose = getPose(data, state);\n\tconst positionKeys = [\n\t\t...Object.keys(pose.positions).filter(\n\t\t\tpositionKey => pose.positions[positionKey].length > 1\n\t\t),\n\t];\n\tif (pose.compatibleHeads.length > 0) positionKeys.unshift('head');\n\treturn positionKeys;\n}\n\nexport function getHeads(\n\tdata: DeepReadonly<Character<IAsset>>,\n\tstate: DeepReadonly<ICharacter>,\n\theadTypeId: number = state.posePositions.headType || 0\n): DeepReadonly<HeadCollection<IAsset>> | null {\n\tconst compatibleHeads = getPose(data, state).compatibleHeads;\n\tif (!compatibleHeads || compatibleHeads.length === 0) {\n\t\treturn null;\n\t}\n\tconst heads = data.heads[compatibleHeads[headTypeId]];\n\treturn heads;\n}\n\nexport function closestCharacterSlot(pos: number): number {\n\tconst sorted = characterPositions\n\t\t.map((x, idx) => ({ pos: Math.abs(pos - x), idx }))\n\t\t.sort((a, b) => a.pos - b.pos);\n\treturn sorted[0].idx;\n}\n\nlet lastSpriteId = 0;\n\nexport const characterActions: ActionTree<IObjectsState, IRootState> = {\n\tcreateCharacters(\n\t\t{ rootState, rootGetters, commit },\n\t\tcommand: ICreateCharacterAction\n\t) {\n\t\tconst char = getDataG(rootGetters, command.characterType);\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...baseProps(),\n\t\t\t\tid: 'characters_' + ++lastSpriteId,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tonTop: false,\n\t\t\t\ttype: 'character',\n\t\t\t\ty: BaseCharacterYPos,\n\t\t\t\tpreserveRatio: true,\n\t\t\t\tratio: 1,\n\t\t\t\theight: 768,\n\t\t\t\twidth: 768,\n\t\t\t\tcharacterType: command.characterType,\n\t\t\t\tclose: false,\n\t\t\t\tfreeMove: false,\n\t\t\t\tposeId: 0,\n\t\t\t\tstyleId: 0,\n\t\t\t\tstyleGroupId: 0,\n\t\t\t\tposePositions: {},\n\t\t\t\tlabel: char.label || char.id,\n\t\t\t\tenlargeWhenTalking: rootState.ui.defaultCharacterTalkingZoom,\n\t\t\t} as ICharacter,\n\t\t} as ICreateObjectMutation);\n\t},\n\n\tseekPart(\n\t\t{ state, commit, dispatch, rootGetters },\n\t\t{ delta, id, part }: ISeekPosePartAction\n\t) {\n\t\tif (part === 'head') {\n\t\t\tdispatch('seekHead', { id, delta } as ISeekHeadAction);\n\t\t\treturn;\n\t\t}\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst pose = getPose(getDataG(rootGetters, obj.characterType), obj);\n\t\tif (!pose.positions[part]) return;\n\t\tcommit('setPosePosition', {\n\t\t\tid,\n\t\t\tposePositions: {\n\t\t\t\t[part]: arraySeeker(\n\t\t\t\t\tpose.positions[part],\n\t\t\t\t\tobj.posePositions[part] || 0,\n\t\t\t\t\tdelta\n\t\t\t\t),\n\t\t\t},\n\t\t} as ISetPosePositionMutation);\n\t},\n\n\tseekPose({ state, commit, rootGetters }, { id, delta }: ISeekPoseAction) {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj.characterType);\n\t\tconst poses = data.styleGroups[obj.styleGroupId].styles[obj.styleId].poses;\n\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\tchange.poseId = arraySeeker(poses, change.poseId, delta);\n\t\t});\n\t},\n\n\tseekStyle({ state, commit, rootGetters }, { id, delta }: ISeekStyleAction) {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj.characterType);\n\t\tconst linearStyles = data.styleGroups\n\t\t\t.flatMap((styleGroup, styleGroupIdx) => {\n\t\t\t\treturn styleGroup.styles.map((style, styleIdx) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstyleGroupIdx,\n\t\t\t\t\t\tstyleIdx,\n\t\t\t\t\t\tstyleGroupJson: JSON.stringify(style.components),\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t})\n\t\t\t.sort((styleA, styleB) =>\n\t\t\t\tstyleA.styleGroupJson.localeCompare(styleB.styleGroupJson)\n\t\t\t);\n\t\tconst linearIdx = linearStyles.findIndex(\n\t\t\tstyle =>\n\t\t\t\tstyle.styleGroupIdx === obj.styleGroupId &&\n\t\t\t\tstyle.styleIdx === obj.styleId\n\t\t);\n\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\tconst nextIdx = arraySeeker(linearStyles, linearIdx, delta);\n\t\t\tconst style = linearStyles[nextIdx];\n\t\t\tchange.styleGroupId = style.styleGroupIdx;\n\t\t\tchange.styleId = style.styleIdx;\n\t\t});\n\t},\n\n\tseekHead({ state, commit, rootGetters }, { id, delta }: ISeekHeadAction) {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj.characterType);\n\t\tconst pose = getPose(data, obj);\n\t\tlet currentHeads = getHeads(data, obj);\n\t\tif (!currentHeads) return;\n\t\tlet head = (obj.posePositions.head || 0) + delta;\n\t\tlet headType = obj.posePositions.headType || 0;\n\t\tif (head < 0 || head >= currentHeads.variants.length) {\n\t\t\theadType = arraySeeker(\n\t\t\t\tpose.compatibleHeads.map(headKey => data.heads[headKey]),\n\t\t\t\theadType,\n\t\t\t\tdelta\n\t\t\t);\n\t\t\tcurrentHeads = getHeads(data, obj, headType)!;\n\t\t\thead = delta === 1 ? 0 : currentHeads.variants.length - 1;\n\t\t}\n\t\tcommit('setPosePosition', {\n\t\t\tid,\n\t\t\tposePositions: {\n\t\t\t\thead,\n\t\t\t\theadType,\n\t\t\t},\n\t\t} as ISetPosePositionMutation);\n\t},\n\n\tsetPart(\n\t\t{ state, commit, rootGetters },\n\t\t{ id, part, val }: ISetPartAction\n\t): void {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj.characterType);\n\t\tif (part === 'pose') {\n\t\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\t\tchange.poseId = val;\n\t\t\t});\n\t\t} else if (part === 'style') {\n\t\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\t\tchange.styleId = val;\n\t\t\t});\n\t\t} else {\n\t\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\t\tchange.posePositions[part] = val;\n\t\t\t});\n\t\t}\n\t},\n\n\tsetCharStyle(\n\t\t{ state, commit, rootGetters },\n\t\t{ id, styleGroupId, styleId }: ISetStyleAction\n\t) {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj.characterType);\n\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\tchange.styleGroupId = styleGroupId;\n\t\t\tchange.styleId = styleId;\n\t\t});\n\t},\n\n\tsetCharacterPosition(\n\t\t{ state, commit },\n\t\t{ id, x, y }: ISetPositionAction\n\t): void {\n\t\tconst obj = state.objects[id] as ICharacter;\n\t\tif (obj.freeMove) {\n\t\t\tcommit('setPosition', {\n\t\t\t\tid,\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t} as ISetObjectPositionMutation);\n\t\t} else {\n\t\t\tcommit('setPosition', {\n\t\t\t\tid,\n\t\t\t\tx: characterPositions[closestCharacterSlot(x)],\n\t\t\t\ty: BaseCharacterYPos + (obj.close ? CloseUpYOffset : 0),\n\t\t\t} as ISetObjectPositionMutation);\n\t\t}\n\t},\n\n\tshiftCharacterSlot(\n\t\t{ state, commit },\n\t\t{ id, delta }: IShiftCharacterSlotAction\n\t): void {\n\t\tconst obj = state.objects[id] as ICharacter;\n\t\tconst currentSlotNr = closestCharacterSlot(obj.x);\n\t\tlet newSlotNr = currentSlotNr + delta;\n\t\tif (newSlotNr < 0) {\n\t\t\tnewSlotNr = 0;\n\t\t}\n\t\tif (newSlotNr >= characterPositions.length) {\n\t\t\tnewSlotNr = characterPositions.length - 1;\n\t\t}\n\t\tcommit('setPosition', {\n\t\t\tid,\n\t\t\tx: characterPositions[newSlotNr],\n\t\t\ty: obj.y,\n\t\t} as ISetObjectPositionMutation);\n\t},\n};\n\nexport async function fixContentPackRemovalFromCharacter(\n\tcontext: ActionContext<IObjectsState, IRootState>,\n\tid: string,\n\toldPack: ContentPack<IAsset>\n) {\n\tconst obj = context.state.objects[id] as ICharacter;\n\tconst oldCharData = oldPack.characters.find(\n\t\tchar => char.id === obj.characterType\n\t);\n\tif (!oldCharData) {\n\t\tconsole.error('Character data is missing. Dropping the character.');\n\t\tcontext.dispatch('removeObject', {\n\t\t\tid,\n\t\t} as IRemoveObjectAction);\n\t\treturn;\n\t}\n\tconst poseAndPositionChange = buildPoseAndPositionData(obj);\n\tconst oldStyleGroup = oldCharData.styleGroups[obj.styleGroupId];\n\tconst oldStyle = oldStyleGroup.styles[poseAndPositionChange.styleId];\n\tconst oldPose = oldStyle.poses[poseAndPositionChange.poseId];\n\n\tconst newCharData = context.rootState.content.current.characters.find(\n\t\tchr => chr.id === oldCharData.id\n\t);\n\tif (!newCharData) {\n\t\tconsole.error('Character data is missing. Dropping the character.');\n\t\tcontext.dispatch('removeObject', {\n\t\t\tid,\n\t\t} as IRemoveObjectAction);\n\t\treturn;\n\t}\n\tconst newStyleGroupIdx = newCharData.styleGroups.findIndex(\n\t\tstyleGroup => styleGroup.id === oldStyleGroup.id\n\t);\n\tposeAndPositionChange.styleGroupId =\n\t\tnewStyleGroupIdx === -1 ? 0 : newStyleGroupIdx;\n\n\tconst newStyleGroup =\n\t\tnewCharData.styleGroups[poseAndPositionChange.styleGroupId];\n\tconst styleProperies = JSON.stringify(oldStyle.components);\n\tconst newStyleIdx = newStyleGroup.styles.findIndex(\n\t\tstyle => JSON.stringify(style.components) === styleProperies\n\t);\n\tposeAndPositionChange.styleId = newStyleIdx === -1 ? 0 : newStyleIdx;\n\n\tconst newStyle = newStyleGroup.styles[poseAndPositionChange.styleId];\n\tconst newPoseIdx = newStyle.poses.findIndex(pose => pose.id === oldPose.id);\n\tposeAndPositionChange.poseId = newPoseIdx === -1 ? 0 : newPoseIdx;\n\n\t// Styles and poses have been restored. Proceding with pose parts\n\tconst newPose = newStyle.poses[poseAndPositionChange.poseId];\n\n\tconst newPosePositions: ICharacter['posePositions'] = {};\n\n\tfor (const key in newPose.positions) {\n\t\tif (!newPose.positions.hasOwnProperty(key)) continue;\n\t\tconst newPosition = newPose.positions[key];\n\n\t\tif (oldPose.positions[key]) {\n\t\t\tconst oldPositionIdx = poseAndPositionChange.posePositions[key];\n\t\t\tif (oldPositionIdx >= 0 && oldPositionIdx < newPosition.length) {\n\t\t\t\tnewPosePositions[key] = oldPositionIdx;\n\t\t\t} else {\n\t\t\t\tnewPosePositions[key] = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tnewPosePositions[key] = 0;\n\t\t}\n\t}\n\n\tconst oldHeadGroup = oldPose.compatibleHeads[obj.posePositions.headType];\n\tconst newHeadGroupIdx = newPose.compatibleHeads.indexOf(oldHeadGroup);\n\n\tif (newHeadGroupIdx === -1) {\n\t\tposeAndPositionChange.posePositions.headType = 0;\n\t\tposeAndPositionChange.posePositions.head = 0;\n\t} else {\n\t\tif (newHeadGroupIdx !== obj.posePositions.headType) {\n\t\t\tposeAndPositionChange.posePositions.headType = newHeadGroupIdx;\n\t\t}\n\t\tconst oldHead = JSON.stringify(\n\t\t\toldCharData.heads[oldHeadGroup].variants[obj.posePositions.head]\n\t\t);\n\t\tconst newHeadIdx = newCharData.heads[oldHeadGroup].variants.findIndex(\n\t\t\tvariant => JSON.stringify(variant) === oldHead\n\t\t);\n\t\tif (newHeadIdx === -1) {\n\t\t\tposeAndPositionChange.posePositions.head = 0;\n\t\t} else {\n\t\t\tposeAndPositionChange.posePositions.head = newHeadIdx;\n\t\t}\n\t}\n\n\tcommitPoseAndPositionChanges(context.commit, obj, poseAndPositionChange);\n}\n\nexport const propertyOptions: IHistoryOptions = {\n\tmutations: {\n\t\tsetPosePosition: {\n\t\t\tcombinable: (oldMut, newMut) => oldMut.payload.id === newMut.payload.id,\n\t\t\tcombinator: (oldMut, newMut) => ({\n\t\t\t\ttype: newMut.type,\n\t\t\t\tpayload: {\n\t\t\t\t\tid: newMut.payload.id,\n\t\t\t\t\tposePositions: {\n\t\t\t\t\t\t...oldMut.payload.posePositions,\n\t\t\t\t\t\t...newMut.payload.posePositions,\n\t\t\t\t\t},\n\t\t\t\t} as ISetPosePositionMutation,\n\t\t\t}),\n\t\t},\n\t},\n};\n\nfunction buildPoseAndPositionData(\n\tcharacter: Readonly<ICharacter>\n): PoseAndPositionChange {\n\treturn {\n\t\tstyleGroupId: character.styleGroupId,\n\t\tstyleId: character.styleId,\n\t\tposeId: character.poseId,\n\t\tposePositions: { ...character.posePositions },\n\t};\n}\n\nfunction commitPoseAndPositionChanges(\n\tcommit: Commit,\n\tcharacter: Readonly<ICharacter>,\n\tposeAndPosition: PoseAndPositionChange\n) {\n\tif (poseAndPosition.styleGroupId !== character.styleGroupId) {\n\t\tcommit('setCharStyleGroup', {\n\t\t\tid: character.id,\n\t\t\tstyleGroupId: poseAndPosition.styleGroupId,\n\t\t} as ISetCharStyleGroupMutation);\n\t}\n\tif (poseAndPosition.styleId !== character.styleId) {\n\t\tconsole.log(\n\t\t\t`Setting style of ${character.id} to ${poseAndPosition.styleId}`\n\t\t);\n\t\tcommit('setCharStyle', {\n\t\t\tid: character.id,\n\t\t\tstyleId: poseAndPosition.styleId,\n\t\t} as ISetCharStyleMutation);\n\t}\n\tif (poseAndPosition.poseId !== character.poseId) {\n\t\tcommit('setPose', {\n\t\t\tid: character.id,\n\t\t\tposeId: poseAndPosition.poseId,\n\t\t} as ISetPoseMutation);\n\t}\n\tif (\n\t\tJSON.stringify(poseAndPosition.posePositions) !==\n\t\tJSON.stringify(character.posePositions)\n\t) {\n\t\tcommit('setPosePosition', {\n\t\t\tid: character.id,\n\t\t\tposePositions: poseAndPosition.posePositions,\n\t\t} as ISetPosePositionMutation);\n\t}\n}\n\nfunction mutatePoseAndPositions(\n\tcommit: Commit,\n\tcharacter: Readonly<ICharacter>,\n\tdata: Character<IAsset>,\n\tcallback: (change: PoseAndPositionChange) => void\n) {\n\tconst poseAndPosition = buildPoseAndPositionData(character);\n\tcallback(poseAndPosition);\n\n\tif (!data.styleGroups[poseAndPosition.styleGroupId]) {\n\t\tposeAndPosition.styleGroupId = 0;\n\t}\n\tconst styleGroup = data.styleGroups[poseAndPosition.styleGroupId];\n\n\tif (!styleGroup.styles[poseAndPosition.styleId]) {\n\t\tposeAndPosition.styleId = 0;\n\t}\n\tconst style = styleGroup.styles[poseAndPosition.styleId];\n\n\t// ensure pose integrity\n\tif (!style.poses[poseAndPosition.poseId]) {\n\t\tposeAndPosition.poseId = 0;\n\t}\n\tconst pose = style.poses[poseAndPosition.poseId];\n\n\tfor (const positionKey in pose.positions) {\n\t\tif (!pose.positions[positionKey]) continue;\n\t\tif (\n\t\t\t!pose.positions[positionKey][poseAndPosition.posePositions[positionKey]]\n\t\t) {\n\t\t\tposeAndPosition.posePositions[positionKey] = 0;\n\t\t}\n\t}\n\n\t// restore head group\n\tconst oldPose =\n\t\tdata.styleGroups[character.styleGroupId].styles[character.styleId].poses[\n\t\t\tcharacter.poseId\n\t\t];\n\tconst oldHeadCollection =\n\t\toldPose.compatibleHeads[character.posePositions.headType || 0];\n\tconst newHeadCollectionNr = pose.compatibleHeads.indexOf(oldHeadCollection);\n\tif (newHeadCollectionNr >= 0) {\n\t\tposeAndPosition.posePositions.headType = newHeadCollectionNr;\n\t} else {\n\t\tposeAndPosition.posePositions.headType = 0;\n\t\tposeAndPosition.posePositions.head = 0;\n\t}\n\n\tcommitPoseAndPositionChanges(commit, character, poseAndPosition);\n}\n\ninterface PoseAndPositionChange {\n\tstyleGroupId: ICharacter['styleGroupId'];\n\tstyleId: ICharacter['styleId'];\n\tposeId: ICharacter['poseId'];\n\tposePositions: ICharacter['posePositions'];\n}\n\nexport interface ISetPoseMutation extends ICommand {\n\treadonly poseId: number;\n}\n\nexport interface ISetCharStyleGroupMutation extends ICommand {\n\treadonly styleGroupId: number;\n}\n\nexport interface ISetCharStyleMutation extends ICommand {\n\treadonly styleId: number;\n}\n\nexport interface ISetPosePositionMutation extends ICommand {\n\treadonly posePositions: {\n\t\t[id: string]: number;\n\t};\n}\n\nexport interface ISetFreeMoveMutation extends ICommand {\n\treadonly freeMove: boolean;\n}\n\nexport interface ISetCloseMutation extends ICommand {\n\treadonly close: boolean;\n}\n\nexport interface ICreateCharacterAction {\n\treadonly characterType: string;\n}\n\nexport interface ISeekPoseAction extends ICommand {\n\treadonly delta: -1 | 1;\n}\n\nexport interface ISeekStyleAction extends ICommand {\n\treadonly delta: -1 | 1;\n}\n\nexport interface ISeekHeadAction extends ICommand {\n\treadonly delta: -1 | 1;\n}\n\nexport interface ISetPartAction extends ICommand {\n\treadonly part: string;\n\treadonly val: number;\n}\n\nexport interface ISetStyleAction extends ICommand {\n\treadonly styleGroupId: number;\n\treadonly styleId: number;\n}\n\nexport interface INsfwCheckAction extends ICommand {}\n\nexport interface ISeekPosePartAction extends ICommand {\n\treadonly part: string;\n\treadonly delta: -1 | 1;\n}\n\nexport interface ISetSpriteSizeMutation extends ICommand {\n\treadonly width: number;\n\treadonly height: number;\n}\n\nexport interface ISetSpriteRatioMutation extends ICommand {\n\treadonly preserveRatio: boolean;\n\treadonly ratio: number;\n}\n\nexport interface ISetSpriteWidthAction extends ICommand {\n\treadonly width: number;\n}\n\nexport interface ISetSpriteHeightAction extends ICommand {\n\treadonly height: number;\n}\n\nexport interface ISetSpriteRatioAction extends ICommand {\n\treadonly preserveRatio: boolean;\n}\n\nexport interface ICreateSpriteAction extends ICommand {\n\treadonly assetName: string;\n}\n\nexport interface IShiftCharacterSlotAction extends ICommand {\n\treadonly delta: -1 | 1;\n}\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./ModalDialog.vue?vue&type=style&index=0&id=64aeb4c5&scoped=true&lang=scss\"","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./color.vue?vue&type=style&index=0&id=8ecc10b2&lang=scss&scoped=true\"","<template>\r\n\t<div class=\"toggle_box\">\r\n\t\t<input :id=\"_.uid\" type=\"checkbox\" ref=\"checkbox\" v-model=\"value\" />\r\n\t\t<label :for=\"_.uid\" class=\"switch\"></label>\r\n\t\t<label :for=\"_.uid\" class=\"toggle_label\">{{ label }}</label>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue';\r\n\r\nexport default defineComponent({\r\n\tprops: {\r\n\t\tlabel: String,\r\n\t\tmodelValue: { type: Boolean, default: false },\r\n\t},\r\n\tcomputed: {\r\n\t\tvalue: {\r\n\t\t\tget(): boolean {\r\n\t\t\t\treturn this.modelValue;\r\n\t\t\t},\r\n\t\t\tset(value: boolean) {\r\n\t\t\t\tthis.$emit('update:modelValue', value);\r\n\t\t\t},\r\n\t\t},\r\n\t\tcheckbox(): HTMLInputElement {\r\n\t\t\treturn this.$refs.checkbox as HTMLInputElement;\r\n\t\t},\r\n\t},\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.toggle_box {\r\n\tdiv {\r\n\t\toverflow: visible;\r\n\t}\r\n\r\n\t/* The switch - the box around the slider */\r\n\t.switch {\r\n\t\theight: 20px;\r\n\t\twidth: 20px;\r\n\t\tdisplay: inline-block;\r\n\t\tbackground: url('./toggle/inactive.svg');\r\n\t\tbackground-size: cover;\r\n\t\tvertical-align: text-bottom;\r\n\t}\r\n\r\n\t/* Hide default HTML checkbox */\r\n\tinput {\r\n\t\topacity: 0;\r\n\t\twidth: 0;\r\n\t\theight: 0;\r\n\t\tposition: absolute;\r\n\t\tpointer-events: none;\r\n\t}\r\n\r\n\tinput:checked + .switch {\r\n\t\tbackground: url('./toggle/active.svg');\r\n\t\tbackground-size: cover;\r\n\t}\r\n\r\n\t.toggle_label {\r\n\t\tuser-select: none;\r\n\t}\r\n}\r\n\r\nbody.dark-theme {\r\n\t.toggle_box {\r\n\t\t.switch {\r\n\t\t\tbackground: url('./toggle/inactive-dark.svg');\r\n\t\t}\r\n\r\n\t\tinput:checked + .switch {\r\n\t\t\tbackground: url('./toggle/active-dark.svg');\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","\r\nimport { defineComponent } from 'vue';\r\n\r\nexport default defineComponent({\r\n\tprops: {\r\n\t\tlabel: String,\r\n\t\tmodelValue: { type: Boolean, default: false },\r\n\t},\r\n\tcomputed: {\r\n\t\tvalue: {\r\n\t\t\tget(): boolean {\r\n\t\t\t\treturn this.modelValue;\r\n\t\t\t},\r\n\t\t\tset(value: boolean) {\r\n\t\t\t\tthis.$emit('update:modelValue', value);\r\n\t\t\t},\r\n\t\t},\r\n\t\tcheckbox(): HTMLInputElement {\r\n\t\t\treturn this.$refs.checkbox as HTMLInputElement;\r\n\t\t},\r\n\t},\r\n});\r\n","import { render } from \"./toggle.vue?vue&type=template&id=7b1bf059\"\nimport script from \"./toggle.vue?vue&type=script&lang=ts\"\nexport * from \"./toggle.vue?vue&type=script&lang=ts\"\n\nimport \"./toggle.vue?vue&type=style&index=0&id=7b1bf059&lang=scss\"\nscript.render = render\n\nexport default script","import { DeepReadonly } from '@/util/readonly';\n\nexport function arraySeeker(\n\tarray: DeepReadonly<any[]>,\n\tpos: number,\n\tdelta: number\n) {\n\tlet val = pos + delta;\n\tconst length = array.length;\n\n\tif (val < 0) {\n\t\tval += length;\n\t}\n\tif (val >= length) {\n\t\tval -= length;\n\t}\n\treturn val;\n}\n\nexport function nsfwArraySeeker(\n\tarray: Array<{ nsfw?: boolean }>,\n\tpos: number,\n\tdelta: number,\n\tnsfw: boolean\n) {\n\tlet val = pos;\n\tconst length = array.length;\n\tdo {\n\t\tval += delta;\n\t\tif (val < 0) {\n\t\t\tval += length;\n\t\t}\n\t\tif (val >= length) {\n\t\t\tval -= length;\n\t\t}\n\t} while (array[val].nsfw && !nsfw);\n\treturn val;\n}\n","<template>\n\t<div v-if=\"canvasTooSmall && isSafari\">\n\t\tProtrait mode is not supported by safari. Please turn the device sideways.\n\t</div>\n\t<div v-else id=\"app\">\n\t\t<div id=\"container\">\n\t\t\t<render\n\t\t\t\tref=\"render\"\n\t\t\t\t:canvasWidth=\"canvasWidth\"\n\t\t\t\t:canvasHeight=\"canvasHeight\"\n\t\t\t/>\n\t\t</div>\n\t\t<message-console />\n\t\t<tool-box\n\t\t\t@show-prev-render=\"drawLastDownload\"\n\t\t\t@download=\"$refs.render.download()\"\n\t\t\t@show-dialog=\"showDialog\"\n\t\t\t@show-expression-dialog=\"showExpressionDialog\"\n\t\t/>\n\t\t<keep-alive>\n\t\t\t<modal-dialog\n\t\t\t\tv-if=\"dialogVisable\"\n\t\t\t\tref=\"dialog\"\n\t\t\t\t@leave=\"dialogVisable = false\"\n\t\t\t>\n\t\t\t\t<single-box ref=\"packDialog\" @leave=\"dialogVisable = false\" />\n\t\t\t</modal-dialog>\n\t\t</keep-alive>\n\t\t<modal-dialog\n\t\t\tv-if=\"expressionBuilderVisible\"\n\t\t\tref=\"dialog\"\n\t\t\t@leave=\"expressionBuilderVisible = false\"\n\t\t>\n\t\t\t<expression-builder\n\t\t\t\t:character=\"expressionBuilderCharacter\"\n\t\t\t\t:initHeadGroup=\"expressionBuilderHeadGroup\"\n\t\t\t\t@leave=\"expressionBuilderVisible = false\"\n\t\t\t/>\n\t\t</modal-dialog>\n\t</div>\n\t<div id=\"modal-messages\"></div>\n</template>\n\n<script lang=\"ts\">\n// App.vue has currently so many responsiblities that it's best to break it into chunks\nimport { ICreateTextBoxAction } from '@/store/objectTypes/textbox';\nimport {\n\tISetObjectPositionMutation,\n\tIRemoveObjectAction,\n\tICopyObjectToClipboardAction,\n\tIPasteFromClipboardAction,\n} from '@/store/objects';\nimport {\n\tIShiftCharacterSlotAction,\n\tICharacter,\n} from '@/store/objectTypes/characters';\nimport ToolBox from '@/components/toolbox/toolbox.vue';\nimport MessageConsole from '@/components/message-console.vue';\nimport Render from '@/components/render.vue';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport { ISetCurrentMutation } from '@/store/panels';\nimport { defineAsyncComponent, defineComponent } from 'vue';\nimport { Repo } from './models/repo';\nimport enviroment from '@/environments/environment';\nimport { IRemovePacksAction } from './store';\n\n// tslint:disable-next-line: no-magic-numbers\nconst aspectRatio = 16 / 9;\nconst arrowMoveStepSize = 20;\nconst packDialogWaitMs = 50;\nconst canvasTooSmallThreshold = 200;\n\nconst nsfwPacks = {\n\t'dddg.buildin.backgrounds.nsfw': `${process.env.BASE_URL}packs/buildin.base.backgrounds.nsfw.json`,\n\t'dddg.buildin.sayori.nsfw': `${process.env.BASE_URL}packs/buildin.base.sayori.nsfw.json`,\n\t'dddg.buildin.base.natsuki.nsfw': `${process.env.BASE_URL}packs/buildin.base.natsuki.nsfw.json`,\n\t'dddg.buildin.yuri.nsfw': `${process.env.BASE_URL}packs/buildin.base.yuri.nsfw.json`,\n};\n\nconst names = new Set(Object.keys(nsfwPacks));\nconst paths = Object.values(nsfwPacks);\n\nexport default defineComponent({\n\tcomponents: {\n\t\tToolBox,\n\t\tMessageConsole,\n\t\tRender,\n\t\tModalDialog,\n\t\tSingleBox: defineAsyncComponent(() =>\n\t\t\timport('@/components/repo/layouts/SingleBox.vue')\n\t\t),\n\t\tExpressionBuilder: defineAsyncComponent(() =>\n\t\t\timport('@/components/content-pack-builder/expression-builder/index.vue')\n\t\t),\n\t},\n\tdata: () => ({\n\t\tcanvasWidth: 0,\n\t\tcanvasHeight: 0,\n\t\tblendOver: null as string | null,\n\t\tuiSize: 192,\n\t\tcurrentlyRendering: false,\n\t\tpanel: '',\n\t\tdialogVisable: false,\n\t\tcanvasTooSmall: false,\n\t\texpressionBuilderVisible: false,\n\t\texpressionBuilderCharacter: '',\n\t\texpressionBuilderHeadGroup: undefined as string | undefined,\n\t\tsystemPrefersDarkMode: false,\n\t}),\n\tcomputed: {\n\t\tisSafari(): boolean {\n\t\t\treturn false;\n\t\t\t/*\t\treturn !!(\n\t\t\tnavigator.vendor &&\n\t\t\tnavigator.vendor.indexOf('Apple') > -1 &&\n\t\t\tnavigator.userAgent &&\n\t\t\tnavigator.userAgent.indexOf('CriOS') === -1 &&\n\t\t\tnavigator.userAgent.indexOf('FxiOS') === -1\n\t\t);*/\n\t\t},\n\t\tuseDarkTheme(): boolean {\n\t\t\treturn this.userPrefersDarkMode ?? this.systemPrefersDarkMode;\n\t\t},\n\t\tuserPrefersDarkMode(): boolean | null {\n\t\t\treturn this.$store.state.ui.useDarkTheme;\n\t\t},\n\t\tnsfw(): boolean {\n\t\t\treturn this.$store.state.ui.nsfw;\n\t\t},\n\t},\n\tmethods: {\n\t\tdrawLastDownload(): void {\n\t\t\tconst last = this.$store.state.ui.lastDownload;\n\t\t\tif (!last) return;\n\t\t\t(this.$refs.render as typeof Render).blendOver(last);\n\t\t},\n\t\tsetBlendOver(): void {\n\t\t\tthis.blendOver = this.$store.state.ui.lastDownload;\n\t\t},\n\t\toptimum(sw: number, sh: number): [number, number] {\n\t\t\tlet rh = sw / aspectRatio;\n\t\t\tlet rw = sh * aspectRatio;\n\n\t\t\tif (rh > sh) {\n\t\t\t\trh = sh;\n\t\t\t} else {\n\t\t\t\trw = sw;\n\t\t\t}\n\n\t\t\treturn [rw, rh];\n\t\t},\n\t\toptimizeWithMenu(sw: number, sh: number): [number, number, boolean] {\n\t\t\tconst opth = this.optimum(sw, sh - this.uiSize);\n\t\t\tconst optv = this.optimum(sw - this.uiSize, sh);\n\n\t\t\tif (!this.isSafari && opth[0] * opth[1] > optv[0] * optv[1]) {\n\t\t\t\treturn [opth[0], opth[1], false];\n\t\t\t} else {\n\t\t\t\treturn [optv[0], optv[1], true];\n\t\t\t}\n\t\t},\n\t\tupdateArea(): void {\n\t\t\tconst [cw, ch, v] = this.optimizeWithMenu(\n\t\t\t\tdocument.documentElement.clientWidth,\n\t\t\t\tdocument.documentElement.clientHeight\n\t\t\t);\n\n\t\t\tthis.canvasWidth = cw;\n\t\t\tthis.canvasHeight = ch;\n\n\t\t\tthis.canvasTooSmall = Math.max(cw, ch) < canvasTooSmallThreshold;\n\n\t\t\tif (this.$store.state.ui.vertical === v) return;\n\t\t\tthis.$store.commit('ui/setVertical', v);\n\t\t},\n\t\tshowDialog(search: string | undefined) {\n\t\t\tthis.dialogVisable = true;\n\t\t\tif (search) {\n\t\t\t\tconst wait = () => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.$refs.packDialog &&\n\t\t\t\t\t\t(this.$refs.packDialog as any).$refs.packDialog\n\t\t\t\t\t) {\n\t\t\t\t\t\t// This strange doubling is to get around the async component wrapper\n\t\t\t\t\t\t(this.$refs.packDialog as any).$refs.packDialog.setSearch(search);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetTimeout(wait, packDialogWaitMs);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.$nextTick(wait);\n\t\t\t}\n\t\t},\n\t\tshowExpressionDialog(e: IShowExpressionDialogEvent) {\n\t\t\tthis.expressionBuilderVisible = true;\n\t\t\tthis.expressionBuilderCharacter = e.character;\n\t\t\tthis.expressionBuilderHeadGroup = e.headGroup;\n\t\t},\n\t\tonKeydown(e: KeyboardEvent) {\n\t\t\tif (\n\t\t\t\te.target instanceof HTMLInputElement ||\n\t\t\t\te.target instanceof HTMLTextAreaElement\n\t\t\t) {\n\t\t\t\tconsole.log('skip keydown on potential target');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tconst selection = this.$store.state.objects.objects[\n\t\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t\t];\n\t\t\t\tif (e.ctrlKey) {\n\t\t\t\t\tif (e.key === 'z') {\n\t\t\t\t\t\t// this.$store.commit('history/undo');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (e.key === 'y') {\n\t\t\t\t\t\t// this.$store.commit('history/redo');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (e.key === 'v') {\n\t\t\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t\t\t'objects/pasteObjectFromClipboard',\n\t\t\t\t\t\t\t{} as IPasteFromClipboardAction\n\t\t\t\t\t\t);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!selection) return;\n\t\t\t\tif (e.key === 'Delete') {\n\t\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t} as IRemoveObjectAction);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.key === 'c' || e.key === 'x') {\n\t\t\t\t\tthis.$store.dispatch('objects/copyObjectToClipboard', {\n\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t} as ICopyObjectToClipboardAction);\n\t\t\t\t\tif (e.key === 'x') {\n\t\t\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t\t} as IRemoveObjectAction);\n\t\t\t\t\t}\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (selection.type === 'character') {\n\t\t\t\t\tconst character = selection as ICharacter;\n\t\t\t\t\tif (!character.freeMove) {\n\t\t\t\t\t\tif (e.key === 'ArrowLeft') {\n\t\t\t\t\t\t\tthis.$store.dispatch('objects/shiftCharacterSlot', {\n\t\t\t\t\t\t\t\tid: character.id,\n\t\t\t\t\t\t\t\tdelta: -1,\n\t\t\t\t\t\t\t} as IShiftCharacterSlotAction);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (e.key === 'ArrowRight') {\n\t\t\t\t\t\t\tthis.$store.dispatch('objects/shiftCharacterSlot', {\n\t\t\t\t\t\t\t\tid: character.id,\n\t\t\t\t\t\t\t\tdelta: 1,\n\t\t\t\t\t\t\t} as IShiftCharacterSlotAction);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet { x, y } = selection;\n\t\t\t\tif (e.key === 'ArrowLeft') {\n\t\t\t\t\tx -= e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowRight') {\n\t\t\t\t\tx += e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowUp') {\n\t\t\t\t\ty -= e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowDown') {\n\t\t\t\t\ty += e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\tid: selection.id,\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tdestroyed(): void {\n\t\t\twindow.removeEventListener('keydown', this.onKeydown);\n\t\t},\n\t\tapplyTheme(): void {\n\t\t\tdocument.body.classList.toggle('dark-theme', this.useDarkTheme);\n\t\t},\n\t},\n\twatch: {\n\t\tsystemPrefersDarkMode() {\n\t\t\tthis.applyTheme();\n\t\t},\n\t\tuserPrefersDarkMode() {\n\t\t\tthis.applyTheme();\n\t\t},\n\t\tasync nsfw(value: boolean) {\n\t\t\tif (value) {\n\t\t\t\tawait this.$store.dispatch('content/loadContentPacks', paths);\n\t\t\t} else {\n\t\t\t\tawait this.$store.dispatch('removePacks', {\n\t\t\t\t\tpacks: names,\n\t\t\t\t} as IRemovePacksAction);\n\t\t\t}\n\t\t},\n\t},\n\tmounted(): void {\n\t\twindow.addEventListener('keypress', e => {\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tif (this.$store.state.ui.selection === null) return;\n\t\t\t\t\tthis.$store.commit('ui/setSelection', null);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (window.matchMedia) {\n\t\t\t/* The viewport is less than, or equal to, 700 pixels wide */\n\t\t\tconst matcher = window.matchMedia('(prefers-color-scheme: dark)');\n\t\t\tthis.systemPrefersDarkMode = matcher.matches;\n\t\t\tmatcher.addListener(match => {\n\t\t\t\tthis.systemPrefersDarkMode = match.matches;\n\t\t\t});\n\t\t}\n\t},\n\tasync created(): Promise<void> {\n\t\t// Moving this to the \"mounted\"-handler crashes safari over version 12.\n\t\t// My best guess is because it runs in a microtask, which have been added in that Version.\n\t\tthis.updateArea();\n\t\tRepo.setStore(this.$store);\n\t\twindow.addEventListener('resize', this.updateArea);\n\t\twindow.removeEventListener('keydown', this.onKeydown);\n\t\twindow.addEventListener('keydown', this.onKeydown);\n\n\t\t(window as any).app = this;\n\t\t(window as any).store = this.$store;\n\t\t(window as any).env = enviroment;\n\n\t\tdocument.body.addEventListener(\n\t\t\t'drop',\n\t\t\t(event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t\tdocument.body.addEventListener(\n\t\t\t'dragover',\n\t\t\t(event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\tenviroment.connectToStore(this.vuexHistory, this.$store);\n\t\tconst settings = await enviroment.loadSettings();\n\n\t\tthis.vuexHistory.transaction(async () => {\n\t\t\tthis.$store.commit('ui/setLqRendering', settings.lq ?? false);\n\t\t\tthis.$store.commit('ui/setDarkTheme', settings.darkMode ?? null);\n\t\t\tthis.$store.commit(\n\t\t\t\t'ui/setDefaultCharacterTalkingZoom',\n\t\t\t\tsettings.defaultCharacterTalkingZoom ?? true\n\t\t\t);\n\n\t\t\tawait this.$store.dispatch('content/loadContentPacks', [\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.backgrounds.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.monika.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.sayori.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.natsuki.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.yuri.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc_chad.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc_classic.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.femc.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.classic_amy.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.amy.json`,\n\t\t\t]);\n\n\t\t\tawait this.$store.dispatch('panels/createPanel');\n\t\t\tif (Object.keys(this.$store.state.objects.objects).length === 0) {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createTextBox',\n\t\t\t\t\t{} as ICreateTextBoxAction\n\t\t\t\t);\n\t\t\t}\n\t\t\tawait this.$store.commit('panels/setCurrentBackground', {\n\t\t\t\tcurrent: 'dddg.buildin.backgrounds:ddlc.clubroom',\n\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t} as ISetCurrentMutation);\n\n\t\t\tawait this.$store.commit('ui/setNsfw', settings.nsfw ?? false);\n\t\t});\n\t},\n});\n\nexport interface IShowExpressionDialogEvent {\n\tcharacter: string;\n\theadGroup?: string;\n}\n</script>\n\n<style lang=\"scss\">\n@import '@/styles/globals.scss';\n</style>\n","<template>\n\t<div id=\"panels\" :class=\"{ vertical }\">\n\t\t<div id=\"toolbar\">\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'add' }\"\n\t\t\t\t@click=\"setPanel('add')\"\n\t\t\t\ttitle=\"Add new objects to the scene\"\n\t\t\t\taria-label=\"Add new objects to the scene\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">add_box</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'backgrounds' }\"\n\t\t\t\t@click=\"setPanel('backgrounds')\"\n\t\t\t\taria-label=\"Change the current background\"\n\t\t\t\ttitle=\"Change the current background\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">panorama</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'panels' }\"\n\t\t\t\ttitle=\"Panels\"\n\t\t\t\taria-label=\"Panels\"\n\t\t\t\t@click=\"setPanel('panels')\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">view_module</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'settings' }\"\n\t\t\t\ttitle=\"Settings\"\n\t\t\t\taria-label=\"Settings\"\n\t\t\t\t@click=\"setPanel('settings')\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">settings_applications</i>\n\t\t\t</button>\n\t\t</div>\n\t\t<settings-panel v-if=\"panel === 'settings'\" />\n\t\t<content-packs-panel v-else-if=\"panel === 'packs'\" />\n\t\t<backgrounds-panel\n\t\t\tv-else-if=\"panel === 'backgrounds'\"\n\t\t\t@show-dialog=\"$emit('show-dialog', $event)\"\n\t\t/>\n\t\t<credits-panel v-else-if=\"panel === 'help_credits'\" />\n\t\t<character-panel\n\t\t\tv-else-if=\"panel === 'character'\"\n\t\t\t@show-dialog=\"$emit('show-dialog', $event)\"\n\t\t\t@show-expression-dialog=\"$emit('show-expression-dialog', $event)\"\n\t\t/>\n\t\t<sprite-panel v-else-if=\"panel === 'sprite'\" />\n\t\t<text-box-panel v-else-if=\"panel === 'textBox'\" />\n\t\t<choice-panel v-else-if=\"panel === 'choice'\" />\n\t\t<panels-panel v-else-if=\"panel === 'panels'\" />\n\t\t<notification-panel v-else-if=\"panel === 'notification'\" />\n\t\t<poem-panel v-else-if=\"panel === 'poem'\" />\n\t\t<add-panel v-else @show-dialog=\"$emit('show-dialog', $event)\" />\n\t\t<div id=\"toolbar-end\">\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'help_credits' }\"\n\t\t\t\t@click=\"setPanel('help_credits')\"\n\t\t\t\ttitle=\"Help &amp; Credits\"\n\t\t\t\taria-label=\"Help &amp; Credits\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">help</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'packs' }\"\n\t\t\t\t@click=\"$emit('show-dialog')\"\n\t\t\t\ttitle=\"Content packs\"\n\t\t\t\taria-label=\"Content packs\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">extension</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t@click=\"$emit('show-prev-render')\"\n\t\t\t\ttitle=\"Show last downloaded panel\"\n\t\t\t\taria-label=\"Show last downloaded panel\"\n\t\t\t\t:disabled=\"!hasPrevRender\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">flip_to_back</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\ttitle=\"Take a screenshot of the current scene\"\n\t\t\t\taria-label=\"Take a screenshot of the current scene\"\n\t\t\t\t@click=\"$emit('download')\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">photo_camera</i>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport SettingsPanel from './tools/settings.vue';\nimport AddPanel from './tools/add.vue';\nimport CharacterPanel from './tools/character.vue';\nimport SpritePanel from './tools/sprite.vue';\nimport TextBoxPanel from './tools/textbox.vue';\nimport ChoicePanel from './tools/choice.vue';\nimport CreditsPanel from './tools/credits.vue';\nimport BackgroundsPanel from './tools/backgrounds.vue';\nimport ContentPacksPanel from './tools/content-pack.vue';\nimport PanelsPanel from './tools/panels.vue';\nimport NotificationPanel from './tools/notification.vue';\nimport PoemPanel from './tools/poem.vue';\nimport { IObject, ObjectTypes } from '@/store/objects';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\ntype PanelNames =\n\t| 'add'\n\t| 'backgrounds'\n\t| 'help_credits'\n\t| 'selection'\n\t| 'packs'\n\t| 'settings'\n\t| 'panels'\n\t| 'notification'\n\t| 'poem';\n\nexport default defineComponent({\n\tcomponents: {\n\t\tSettingsPanel,\n\t\tAddPanel,\n\t\tBackgroundsPanel,\n\t\tCreditsPanel,\n\t\tCharacterPanel,\n\t\tTextBoxPanel,\n\t\tChoicePanel,\n\t\tSpritePanel,\n\t\tContentPacksPanel,\n\t\tPanelsPanel,\n\t\tNotificationPanel,\n\t\tPoemPanel,\n\t},\n\tdata: () => ({\n\t\tpanelSelection: 'add' as PanelNames,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tselection(): string | null {\n\t\t\treturn this.$store.state.ui.selection;\n\t\t},\n\t\tpanel(): PanelNames | ObjectTypes {\n\t\t\tif (this.panelSelection === 'selection') {\n\t\t\t\tif (this.selection === null) {\n\t\t\t\t\t// eslint-disable-next-line vue/no-side-effects-in-computed-properties\n\t\t\t\t\tthis.panelSelection = 'add';\n\t\t\t\t} else {\n\t\t\t\t\tconst obj = this.$store.state.objects.objects[this.selection];\n\t\t\t\t\treturn obj.type;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this.panelSelection;\n\t\t},\n\t\thasPrevRender(): boolean {\n\t\t\treturn this.$store.state.ui.lastDownload !== null;\n\t\t},\n\t},\n\tmethods: {\n\t\tcreate() {\n\t\t\tenvironment.onPanelChange((panel: string) => {\n\t\t\t\tthis.panelSelection = panel as PanelNames;\n\t\t\t});\n\t\t},\n\t\tsetPanel(name: PanelNames) {\n\t\t\tif (name === this.panelSelection) name = 'add';\n\t\t\tthis.panelSelection = name;\n\t\t\tif (this.selection) {\n\t\t\t\tif (this.$store.state.ui.selection === null) return;\n\t\t\t\tthis.$store.commit('ui/setSelection', null);\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tselection(newSelection: IObject | null) {\n\t\t\tif (newSelection) {\n\t\t\t\tthis.panelSelection = 'selection';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.panelSelection === 'selection') {\n\t\t\t\tthis.panelSelection = 'add';\n\t\t\t}\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\">\n#panels {\n\tbackground-color: $default-native-background;\n\tbackground-color: var(--native-background);\n\tborder: 3px solid $default-border;\n\tborder: 3px solid var(--border);\n\tposition: absolute;\n\tdisplay: flex;\n\toverflow: hidden;\n\n\t.panel {\n\t\tdisplay: flex;\n\t\tflex-grow: 1;\n\t\tflex-direction: column;\n\t\tpadding: 4px;\n\t}\n\n\t&:not(.vertical) {\n\t\tflex-direction: row;\n\t\tleft: 0;\n\t\tbottom: 0;\n\t\theight: 192px;\n\t\twidth: 100vw;\n\n\t\t.panel {\n\t\t\tflex-grow: 1;\n\t\t\tflex-wrap: wrap;\n\t\t\talign-content: flex-start;\n\t\t\toverflow-x: auto;\n\t\t\toverflow-y: hidden;\n\n\t\t\t> * {\n\t\t\t\tmargin-right: 8px;\n\t\t\t}\n\t\t}\n\n\t\t#toolbar,\n\t\t#toolbar-end {\n\t\t\twidth: 48px;\n\t\t\theight: 100%;\n\t\t\tfloat: left;\n\t\t\tmargin-top: -3px;\n\t\t}\n\n\t\t#toolbar {\n\t\t\tbutton {\n\t\t\t\tborder-bottom: none;\n\n\t\t\t\t&:nth-child(4) {\n\t\t\t\t\tborder: 3px solid $default-border;\n\t\t\t\t\tborder: 3px solid var(--border);\n\t\t\t\t}\n\n\t\t\t\t&.active {\n\t\t\t\t\tborder-right: 3px solid $default-native-background;\n\t\t\t\t\tborder-right: 3px solid var(--native-background);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t#toolbar-end {\n\t\t\tbutton {\n\t\t\t\tborder-bottom: none;\n\t\t\t\t&:nth-child(4) {\n\t\t\t\t\tborder: 3px solid $default-border;\n\t\t\t\t\tborder: 3px solid var(--border);\n\t\t\t\t}\n\n\t\t\t\t&.active {\n\t\t\t\t\tborder-left: 3px solid $default-native-background;\n\t\t\t\t\tborder-left: 3px solid var(--native-background);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\th1 {\n\t\t\twriting-mode: vertical-rl;\n\t\t\theight: 100%;\n\t\t\twidth: min-content;\n\t\t}\n\t}\n\n\t&.vertical {\n\t\tflex-direction: column;\n\t\ttop: 0;\n\t\tright: 0;\n\t\theight: 100%;\n\t\twidth: 192px;\n\n\t\t.panel {\n\t\t\toverflow-x: hidden;\n\t\t\toverflow-y: auto;\n\n\t\t\t> * {\n\t\t\t\tflex-shrink: 0;\n\t\t\t}\n\t\t}\n\n\t\t#toolbar,\n\t\t#toolbar-end {\n\t\t\twidth: calc(100% + 6px);\n\t\t}\n\n\t\t#toolbar {\n\t\t\tbutton {\n\t\t\t\tborder-right: none;\n\t\t\t\t&:nth-child(4) {\n\t\t\t\t\tborder-right: 3px solid $default-border;\n\t\t\t\t\tborder-right: 3px solid var(--border);\n\t\t\t\t}\n\n\t\t\t\t&.active {\n\t\t\t\t\tborder-bottom: 3px solid $default-native-background;\n\t\t\t\t\tborder-bottom: 3px solid var(--native-background);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t#toolbar-end {\n\t\t\tmargin-bottom: -3px;\n\t\t\tbutton {\n\t\t\t\tborder-left: none;\n\n\t\t\t\t&:nth-child(4) {\n\t\t\t\t\tborder-right: 3px solid $default-border;\n\t\t\t\t\tborder-right: 3px solid var(--border);\n\t\t\t\t}\n\n\t\t\t\t&.active {\n\t\t\t\t\tborder-top: 3px solid $default-native-background;\n\t\t\t\t\tborder-top: 3px solid var(--native-background);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#toolbar {\n\t\tmargin-top: -3px;\n\t\tmargin-left: -3px;\n\t\tbutton {\n\t\t\toutline: 0;\n\t\t\twidth: 48px;\n\t\t\theight: 48px;\n\t\t\tline-height: 48px;\n\t\t\tbackground-color: $default-accent-background;\n\t\t\tbackground-color: var(--accent-background);\n\t\t\tborder: 3px solid $default-border;\n\t\t\tborder: 3px solid var(--border);\n\n\t\t\ti {\n\t\t\t\tvertical-align: sub;\n\t\t\t}\n\n\t\t\t&.active {\n\t\t\t\tbackground: $default-native-background;\n\t\t\t\tbackground: var(--native-background);\n\t\t\t}\n\t\t}\n\t}\n\n\t#toolbar-end {\n\t\tmargin-right: -3px;\n\t\tbutton {\n\t\t\toutline: 0;\n\t\t\twidth: 48px;\n\t\t\theight: 48px;\n\t\t\tline-height: 48px;\n\t\t\tbackground-color: $default-accent-background;\n\t\t\tbackground-color: var(--accent-background);\n\t\t\tborder: 3px solid $default-border;\n\t\t\tborder: 3px solid var(--border);\n\n\t\t\ti {\n\t\t\t\tvertical-align: sub;\n\t\t\t}\n\n\t\t\t&.active {\n\t\t\t\tbackground: $default-native-background;\n\t\t\t\tbackground: var(--native-background);\n\t\t\t}\n\t\t}\n\t}\n}\n\nh1,\nlabel {\n\tuser-select: none;\n}\n</style>\n","<template>\n\t<div class=\"panel\">\n\t\t<h1>Settings</h1>\n\t\t<teleport to=\"#modal-messages\">\n\t\t\t<modal-dialog\n\t\t\t\t:options=\"['Allow', 'Deny']\"\n\t\t\t\tv-if=\"allowSavesModal\"\n\t\t\t\t@leave=\"allowSaves('Deny')\"\n\t\t\t\t@option=\"allowSaves\"\n\t\t\t\tno-base-size\n\t\t\t>\n\t\t\t\t<div class=\"modal-scroll-area\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\tDo you want to allow DDDG to save settings on your device?\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tBy choosing to enable saving settings, DDDG can save data to your\n\t\t\t\t\t\tdevice, and nowhere else. However, your browser and any installed\n\t\t\t\t\t\tbrowser extensions might possibly read and send this data to other\n\t\t\t\t\t\tservers, e.g. to sync between devices. This is outside of our\n\t\t\t\t\t\tcontrol. But in general, we recommend only using browsers and\n\t\t\t\t\t\tbrowser extensions that you trust with your personal data.\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tYou can revoke this permission at any time.\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tOur usual <l to=\"wiki://Privacy Statement\">privacy policy</l> still\n\t\t\t\t\t\tapplies.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</modal-dialog>\n\t\t\t<modal-dialog\n\t\t\t\t:options=\"['Deny', 'Cancle']\"\n\t\t\t\tv-if=\"denySavesModal\"\n\t\t\t\t@leave=\"denySaves('Cancle')\"\n\t\t\t\t@option=\"denySaves\"\n\t\t\t\tno-base-size\n\t\t\t>\n\t\t\t\t<div class=\"modal-scroll-area\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\tDo you want to deny DDDG from saving settings on your device?\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tThis will cause all your settings to reset when leaving the page.\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tOur usual <l to=\"wiki://Privacy Statement\">privacy policy</l> still\n\t\t\t\t\t\tapplies.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</modal-dialog>\n\t\t</teleport>\n\t\t<button v-if=\"waitOnSaveChange\" disabled>\n\t\t\tApplying...\n\t\t</button>\n\t\t<button\n\t\t\tv-else-if=\"!savesAllowed && savesEnabledInEnv\"\n\t\t\t@click=\"allowSavesModal = true\"\n\t\t>\n\t\t\tAllow saving options\n\t\t</button>\n\t\t<button\n\t\t\tv-else-if=\"savesAllowed && savesEnabledInEnv\"\n\t\t\t@click=\"denySavesModal = true\"\n\t\t>\n\t\t\tDeny saving options\n\t\t</button>\n\t\t<toggle\n\t\t\tv-if=\"lqAllowed\"\n\t\t\tlabel=\"Low quality preview?\"\n\t\t\ttitle=\"Reduces the quality of the preview images to speed up the user experience and consume less data. Does not effect final render.\"\n\t\t\tv-model=\"lqRendering\"\n\t\t/>\n\t\t<toggle label=\"NSFW Mode?\" v-model=\"nsfw\" />\n\t\t<toggle\n\t\t\tlabel=\"Enlarge talking objects? (Default value)\"\n\t\t\tv-model=\"defaultCharacterTalkingZoom\"\n\t\t/>\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td><label>Theme:</label></td>\n\t\t\t\t<td>\n\t\t\t\t\t<select v-model=\"theme\">\n\t\t\t\t\t\t<option :value=\"null\">System</option>\n\t\t\t\t\t\t<option :value=\"false\">Light</option>\n\t\t\t\t\t\t<option :value=\"true\">Dark</option>\n\t\t\t\t\t</select>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\n\t\t<table v-if=\"showDownloadFolder\" class=\"downloadTable\">\n\t\t\t<tr>\n\t\t\t\t<td><label>Download folder:</label></td>\n\t\t\t\t<td>{{ downloadFolder }}</td>\n\t\t\t\t<td>\n\t\t\t\t\t<button @click=\"setDownloadFolder\">\n\t\t\t\t\t\tSet\n\t\t\t\t\t</button>\n\t\t\t\t\t<button @click=\"openDownloadFolder\">\n\t\t\t\t\t\tOpen\n\t\t\t\t\t</button>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IRemovePacksAction } from '@/store';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport L from '@/components/ui/link.vue';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { Toggle, ModalDialog, L },\n\tdata: () => ({\n\t\tallowSavesModal: false,\n\t\tdenySavesModal: false,\n\t\twaitOnSaveChange: false,\n\t}),\n\tcomputed: {\n\t\tsavesAllowed: {\n\t\t\tget(): boolean {\n\t\t\t\treturn environment.savingEnabled;\n\t\t\t},\n\t\t\tset(allowed: boolean) {\n\t\t\t\tthis.waitOnSaveChange = true;\n\t\t\t\tenvironment.savingEnabled = allowed;\n\t\t\t\tthis.saveSettings();\n\t\t\t},\n\t\t},\n\t\tsavesEnabledInEnv(): boolean {\n\t\t\treturn environment.supports.optionalSaving;\n\t\t},\n\t\tlqAllowed(): boolean {\n\t\t\treturn environment.supports.lq;\n\t\t},\n\t\tlqRendering: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.$store.state.ui.lqRendering;\n\t\t\t},\n\t\t\tset(lqRendering: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setLqRendering', lqRendering);\n\t\t\t\t});\n\t\t\t\tthis.saveSettings();\n\t\t\t},\n\t\t},\n\t\tnsfw: {\n\t\t\tget(): boolean {\n\t\t\t\treturn !!this.$store.state.ui.nsfw;\n\t\t\t},\n\t\t\tset(value: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setNsfw', value);\n\t\t\t\t\tthis.saveSettings();\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tdefaultCharacterTalkingZoom: {\n\t\t\tget(): boolean {\n\t\t\t\treturn !!this.$store.state.ui.defaultCharacterTalkingZoom;\n\t\t\t},\n\t\t\tset(value: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setDefaultCharacterTalkingZoom', value);\n\t\t\t\t\tthis.saveSettings();\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ttheme: {\n\t\t\tget(): boolean | null {\n\t\t\t\treturn this.$store.state.ui.useDarkTheme;\n\t\t\t},\n\t\t\tset(value: boolean | null) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setDarkTheme', value);\n\t\t\t\t\tthis.saveSettings();\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tshowDownloadFolder(): boolean {\n\t\t\treturn environment.supports.setDownloadFolder;\n\t\t},\n\t\tdownloadFolder(): string {\n\t\t\treturn environment.state.downloadLocation;\n\t\t},\n\t},\n\twatch: {\n\t\tsavesAllowed() {\n\t\t\tthis.waitOnSaveChange = false;\n\t\t},\n\t},\n\tmethods: {\n\t\tallowSaves(choice: 'Allow' | 'Deny') {\n\t\t\tthis.allowSavesModal = false;\n\t\t\tif (choice === 'Allow') {\n\t\t\t\tthis.savesAllowed = true;\n\t\t\t}\n\t\t},\n\t\tdenySaves(choice: 'Deny' | 'Cancel') {\n\t\t\tthis.denySavesModal = false;\n\t\t\tif (choice === 'Deny') {\n\t\t\t\tthis.savesAllowed = false;\n\t\t\t}\n\t\t},\n\t\tsaveSettings() {\n\t\t\tenvironment.saveSettings({\n\t\t\t\tlq: this.$store.state.ui.lqRendering,\n\t\t\t\tnsfw: this.$store.state.ui.nsfw,\n\t\t\t\tdarkMode: this.$store.state.ui.useDarkTheme ?? undefined,\n\t\t\t\tdefaultCharacterTalkingZoom: this.$store.state.ui\n\t\t\t\t\t.defaultCharacterTalkingZoom,\n\t\t\t});\n\t\t},\n\t\tsetDownloadFolder() {\n\t\t\tenvironment.updateDownloadFolder();\n\t\t},\n\t\topenDownloadFolder() {\n\t\t\tenvironment.openFolder('downloads');\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.panel {\n\t&.vertical {\n\t\t#dialog_text_wrapper {\n\t\t\twidth: 173px;\n\n\t\t\ttextarea {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\t.downloadTable {\n\t\t\ttd {\n\t\t\t\tdisplay: table-row;\n\t\t\t\tline-break: anywhere;\n\t\t\t}\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t#dialog_text_wrapper {\n\t\t\theight: 181px;\n\t\t\tdisplay: table;\n\n\t\t\t* {\n\t\t\t\tdisplay: table-row;\n\t\t\t}\n\t\t}\n\t}\n}\n\ntextarea {\n\tmin-height: 148px;\n}\n\n.btn_link {\n\tappearance: button;\n\ttext-align: center;\n}\n</style>\n","import { VerticalScrollRedirect } from '@/components/vertical-scroll-redirect';\nimport { ComponentOptionsMixin } from 'vue';\n\nexport const PanelMixin: ComponentOptionsMixin = {\n\tmixins: [VerticalScrollRedirect],\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tmounted() {\n\t\tthis.updateVertical();\n\t\tthis.$el.addEventListener(\n\t\t\t'wheel',\n\t\t\t(e: WheelEvent) => {\n\t\t\t\tif (!this.vertical) this.verticalScrollRedirect(e as WheelEvent);\n\t\t\t},\n\t\t\t{\n\t\t\t\tpassive: true,\n\t\t\t}\n\t\t);\n\t},\n\tmethods: {\n\t\tupdateVertical() {\n\t\t\tif (!this.$el) return;\n\t\t\tif (this.vertical) {\n\t\t\t\tthis.$el.classList.add('vertical');\n\t\t\t} else {\n\t\t\t\tthis.$el.classList.remove('vertical');\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tvertical() {\n\t\t\t(this as any).updateVertical();\n\t\t},\n\t},\n};\n","<template>\n\t<div class=\"dialog-wrapper\" @click=\"$emit('leave')\">\n\t\t<dialog open :class=\"{ 'base-size': !noBaseSize }\" @click.stop>\n\t\t\t<slot />\n\t\t\t<div v-if=\"options.length > 0\" id=\"submit-options\">\n\t\t\t\t<button\n\t\t\t\t\tv-for=\"option of options\"\n\t\t\t\t\t:key=\"option\"\n\t\t\t\t\tclass=\"option\"\n\t\t\t\t\t@click=\"$emit('option', option)\"\n\t\t\t\t>\n\t\t\t\t\t{{ option }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</dialog>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tnoBaseSize: Boolean,\n\t\toptions: {\n\t\t\ttype: Array as PropType<string[]>,\n\t\t\tdefault: [],\n\t\t},\n\t},\n});\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped lang=\"scss\">\n.dialog-wrapper {\n\tposition: absolute;\n\ttop: 0;\n\tbottom: 0;\n\tright: 0;\n\tleft: 0;\n\tbackground: rgba($color: #000000, $alpha: 0.5);\n\tdisplay: flex;\n\ttransition: all 0.15s;\n}\n\ndialog {\n\tmax-width: 90vw;\n\tmax-height: 90vh;\n\tbackground-attachment: scroll;\n\tbackground-color: $default-native-background;\n\tbackground-color: var(--native-background);\n\tbackground-position: right center;\n\tbackground-repeat: no-repeat;\n\tbackground-size: contain;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-self: center;\n\toverflow: hidden;\n\tpadding: 0;\n\tborder: 4px solid $default-border;\n\tborder: 4px solid var(--border);\n\toverflow: hidden;\n\talign-self: center;\n\tjustify-self: center;\n\tmargin: auto;\n\n\t&.base-size {\n\t\twidth: 860px;\n\t\theight: 860px;\n\t}\n\n\t#submit-options {\n\t\tdisplay: flex;\n\t\tjustify-content: space-evenly;\n\n\t\tbutton.option {\n\t\t\tborder: 0;\n\t\t\tbackground: none;\n\t\t\tfont-family: riffic;\n\t\t\tfont-size: 24px;\n\t\t}\n\t}\n}\n</style>\n","\nimport { defineComponent, PropType } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tnoBaseSize: Boolean,\n\t\toptions: {\n\t\t\ttype: Array as PropType<string[]>,\n\t\t\tdefault: [],\n\t\t},\n\t},\n});\n","import { render } from \"./ModalDialog.vue?vue&type=template&id=64aeb4c5&scoped=true\"\nimport script from \"./ModalDialog.vue?vue&type=script&lang=ts\"\nexport * from \"./ModalDialog.vue?vue&type=script&lang=ts\"\n\nimport \"./ModalDialog.vue?vue&type=style&index=0&id=64aeb4c5&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-64aeb4c5\"\n\nexport default script","\nimport Toggle from '@/components/toggle.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IRemovePacksAction } from '@/store';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport L from '@/components/ui/link.vue';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { Toggle, ModalDialog, L },\n\tdata: () => ({\n\t\tallowSavesModal: false,\n\t\tdenySavesModal: false,\n\t\twaitOnSaveChange: false,\n\t}),\n\tcomputed: {\n\t\tsavesAllowed: {\n\t\t\tget(): boolean {\n\t\t\t\treturn environment.savingEnabled;\n\t\t\t},\n\t\t\tset(allowed: boolean) {\n\t\t\t\tthis.waitOnSaveChange = true;\n\t\t\t\tenvironment.savingEnabled = allowed;\n\t\t\t\tthis.saveSettings();\n\t\t\t},\n\t\t},\n\t\tsavesEnabledInEnv(): boolean {\n\t\t\treturn environment.supports.optionalSaving;\n\t\t},\n\t\tlqAllowed(): boolean {\n\t\t\treturn environment.supports.lq;\n\t\t},\n\t\tlqRendering: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.$store.state.ui.lqRendering;\n\t\t\t},\n\t\t\tset(lqRendering: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setLqRendering', lqRendering);\n\t\t\t\t});\n\t\t\t\tthis.saveSettings();\n\t\t\t},\n\t\t},\n\t\tnsfw: {\n\t\t\tget(): boolean {\n\t\t\t\treturn !!this.$store.state.ui.nsfw;\n\t\t\t},\n\t\t\tset(value: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setNsfw', value);\n\t\t\t\t\tthis.saveSettings();\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tdefaultCharacterTalkingZoom: {\n\t\t\tget(): boolean {\n\t\t\t\treturn !!this.$store.state.ui.defaultCharacterTalkingZoom;\n\t\t\t},\n\t\t\tset(value: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setDefaultCharacterTalkingZoom', value);\n\t\t\t\t\tthis.saveSettings();\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ttheme: {\n\t\t\tget(): boolean | null {\n\t\t\t\treturn this.$store.state.ui.useDarkTheme;\n\t\t\t},\n\t\t\tset(value: boolean | null) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setDarkTheme', value);\n\t\t\t\t\tthis.saveSettings();\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tshowDownloadFolder(): boolean {\n\t\t\treturn environment.supports.setDownloadFolder;\n\t\t},\n\t\tdownloadFolder(): string {\n\t\t\treturn environment.state.downloadLocation;\n\t\t},\n\t},\n\twatch: {\n\t\tsavesAllowed() {\n\t\t\tthis.waitOnSaveChange = false;\n\t\t},\n\t},\n\tmethods: {\n\t\tallowSaves(choice: 'Allow' | 'Deny') {\n\t\t\tthis.allowSavesModal = false;\n\t\t\tif (choice === 'Allow') {\n\t\t\t\tthis.savesAllowed = true;\n\t\t\t}\n\t\t},\n\t\tdenySaves(choice: 'Deny' | 'Cancel') {\n\t\t\tthis.denySavesModal = false;\n\t\t\tif (choice === 'Deny') {\n\t\t\t\tthis.savesAllowed = false;\n\t\t\t}\n\t\t},\n\t\tsaveSettings() {\n\t\t\tenvironment.saveSettings({\n\t\t\t\tlq: this.$store.state.ui.lqRendering,\n\t\t\t\tnsfw: this.$store.state.ui.nsfw,\n\t\t\t\tdarkMode: this.$store.state.ui.useDarkTheme ?? undefined,\n\t\t\t\tdefaultCharacterTalkingZoom: this.$store.state.ui\n\t\t\t\t\t.defaultCharacterTalkingZoom,\n\t\t\t});\n\t\t},\n\t\tsetDownloadFolder() {\n\t\t\tenvironment.updateDownloadFolder();\n\t\t},\n\t\topenDownloadFolder() {\n\t\t\tenvironment.openFolder('downloads');\n\t\t},\n\t},\n});\n","import { render } from \"./settings.vue?vue&type=template&id=1217296c&scoped=true\"\nimport script from \"./settings.vue?vue&type=script&lang=ts\"\nexport * from \"./settings.vue?vue&type=script&lang=ts\"\n\nimport \"./settings.vue?vue&type=style&index=0&id=1217296c&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-1217296c\"\n\nexport default script","<template>\n\t<div\n\t\tclass=\"panel\"\n\t\tv-if=\"isWebPSupported !== undefined\"\n\t\t@dragenter=\"showDropTarget\"\n\t\t@mouseleave=\"hideDropTarget\"\n\t>\n\t\t<drop-target ref=\"spriteDt\" class=\"drop-target\" @drop=\"addCustomSpriteFile\"\n\t\t\t>Drop here to add as a new sprite</drop-target\n\t\t>\n\t\t<h1>Add</h1>\n\t\t<div :class=\"{ 'group-selector': true, vertical }\">\n\t\t\t<d-button\n\t\t\t\t:class=\"{ active: group === 'characters' }\"\n\t\t\t\ticon-pos=\"top\"\n\t\t\t\ticon=\"emoji_people\"\n\t\t\t\t@click=\"group = 'characters'\"\n\t\t\t>\n\t\t\t\tChar&shy;acters\n\t\t\t</d-button>\n\t\t\t<d-button\n\t\t\t\t:class=\"{ active: group === 'sprites' }\"\n\t\t\t\ticon-pos=\"top\"\n\t\t\t\ticon=\"change_history\"\n\t\t\t\t@click=\"group = 'sprites'\"\n\t\t\t>\n\t\t\t\tSprites\n\t\t\t</d-button>\n\t\t\t<d-button\n\t\t\t\t:class=\"{ active: group === 'ui' }\"\n\t\t\t\ticon-pos=\"top\"\n\t\t\t\ticon=\"view_quilt\"\n\t\t\t\t@click=\"group = 'ui'\"\n\t\t\t>\n\t\t\t\tUI\n\t\t\t</d-button>\n\t\t</div>\n\t\t<div :class=\"{ 'item-grid': true, vertical }\">\n\t\t\t<template v-if=\"group === 'characters'\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"character\"\n\t\t\t\t\tv-for=\"character of characters\"\n\t\t\t\t\t:key=\"character.id\"\n\t\t\t\t\t:title=\"character.label\"\n\t\t\t\t\t@click=\"onChosen(character.id.toLowerCase())\"\n\t\t\t\t>\n\t\t\t\t\t<img :src=\"assetPath(character)\" :alt=\"character.label\" />\n\t\t\t\t</div>\n\t\t\t\t<d-button\n\t\t\t\t\tclass=\"custom-sprite\"\n\t\t\t\t\ticon=\"extension\"\n\t\t\t\t\t@click=\"$emit('show-dialog', 'type: Characters')\"\n\t\t\t\t>\n\t\t\t\t\tSearch in content packs\n\t\t\t\t</d-button>\n\t\t\t</template>\n\t\t\t<template v-if=\"group === 'sprites'\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"sprite\"\n\t\t\t\t\tv-for=\"sprite of sprites\"\n\t\t\t\t\t:key=\"sprite.label\"\n\t\t\t\t\t:title=\"sprite.label\"\n\t\t\t\t\t:style=\"{ background: assetSpriteBackground(sprite) }\"\n\t\t\t\t\t@click=\"addSpriteToScene(sprite)\"\n\t\t\t\t>\n\t\t\t\t\t{{ sprite.label }}\n\t\t\t\t</div>\n\n\t\t\t\t<d-button\n\t\t\t\t\tclass=\"custom-sprite\"\n\t\t\t\t\ticon=\"publish\"\n\t\t\t\t\t@click=\"$refs.spriteUpload.click()\"\n\t\t\t\t>\n\t\t\t\t\tUpload new sprite\n\t\t\t\t\t<input type=\"file\" ref=\"spriteUpload\" @change=\"onSpriteFileUpload\" />\n\t\t\t\t</d-button>\n\t\t\t\t<d-button icon=\"insert_link\" @click=\"uploadFromURL\">\n\t\t\t\t\tNew sprite from URL\n\t\t\t\t</d-button>\n\t\t\t\t<d-button\n\t\t\t\t\ticon=\"extension\"\n\t\t\t\t\t@click=\"$emit('show-dialog', 'type: Sprites')\"\n\t\t\t\t>\n\t\t\t\t\tSearch in content packs\n\t\t\t\t</d-button>\n\t\t\t\t<d-button\n\t\t\t\t\tv-if=\"showSpritesFolder\"\n\t\t\t\t\ticon=\"folder\"\n\t\t\t\t\t@click=\"openSpritesFolder\"\n\t\t\t\t>\n\t\t\t\t\tOpen sprites folder\n\t\t\t\t</d-button>\n\t\t\t</template>\n\t\t\t<template v-if=\"group === 'ui'\">\n\t\t\t\t<button @click=\"addTextBox\">Textbox</button>\n\t\t\t\t<button @click=\"addPoem\">Poem</button>\n\t\t\t\t<button @click=\"addDialog\">Notification</button>\n\t\t\t\t<button @click=\"addChoice\">Choice</button>\n\t\t\t\t<button @click=\"addConsole\">Console</button>\n\t\t\t</template>\n\t\t\t<button @click=\"paste\" :disabled=\"!hasClipboardContent\">\n\t\t\t\tPaste\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { isWebPSupported } from '@/asset-manager';\nimport { ICreateCharacterAction } from '@/store/objectTypes/characters';\nimport { ICreateTextBoxAction } from '@/store/objectTypes/textbox';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport {\n\tCharacter,\n\tContentPack,\n\tSprite,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { PanelMixin } from './panelMixin';\nimport DropTarget from '../drop-target.vue';\nimport DButton from '@/components/ui/d-button.vue';\nimport { ICreateSpriteAction } from '@/store/objectTypes/sprite';\nimport { ICreateChoicesAction } from '@/store/objectTypes/choices';\nimport { ICreateNotificationAction } from '@/store/objectTypes/notification';\nimport { ICreatePoemAction } from '@/store/objectTypes/poem';\nimport environment, { Folder } from '@/environments/environment';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\nimport { IPasteFromClipboardAction } from '@/store/objects';\n\nconst uploadedSpritesPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.uploadedSprites',\n\tpackCredits: [''],\n\tdependencies: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DropTarget, DButton },\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\tcustomAssetCount: 0,\n\t\tgroup: 'characters' as 'characters' | 'sprites' | 'ui',\n\t}),\n\tcomputed: {\n\t\tcharacters(): DeepReadonly<Array<Character<IAsset>>> {\n\t\t\treturn this.$store.state.content.current.characters;\n\t\t},\n\t\tsprites(): DeepReadonly<Array<Sprite<IAsset>>> {\n\t\t\treturn this.$store.state.content.current.sprites;\n\t\t},\n\t\thasClipboardContent(): boolean {\n\t\t\treturn !!this.$store.state.ui.clipboard;\n\t\t},\n\t\tshowSpritesFolder(): boolean {\n\t\t\treturn (environment.supports.openableFolders as ReadonlySet<Folder>).has(\n\t\t\t\t'sprites'\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tassetSpriteBackground(sprite: Sprite<IAsset>) {\n\t\t\treturn sprite.variants[0]\n\t\t\t\t.map(variant => `url('${variant.lq}')`)\n\t\t\t\t.join(',');\n\t\t},\n\t\tassetPath(character: Character<IAsset>) {\n\t\t\treturn character.chibi\n\t\t\t\t? environment.supports.lq\n\t\t\t\t\t? character.chibi.lq\n\t\t\t\t\t: character.chibi.hq\n\t\t\t\t: '';\n\t\t},\n\t\tshowDropTarget(e: DragEvent) {\n\t\t\tif (!e.dataTransfer) return;\n\t\t\te.dataTransfer.effectAllowed = 'none';\n\t\t\tif (\n\t\t\t\t!Array.from(e.dataTransfer.items).find(item =>\n\t\t\t\t\titem.type.match(/^image.*$/)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.dataTransfer.effectAllowed = 'link';\n\t\t\tif (this.group === 'sprites') {\n\t\t\t\t(this.$refs.spriteDt as any).show();\n\t\t\t}\n\t\t},\n\t\thideDropTarget() {\n\t\t\tif (this.group === 'sprites') {\n\t\t\t\t(this.$refs.spriteDt as any).hide();\n\t\t\t}\n\t\t},\n\t\tonSpriteFileUpload() {\n\t\t\tconst uploadInput = this.$refs.spriteUpload as HTMLInputElement;\n\t\t\tif (!uploadInput.files) return;\n\t\t\tfor (const file of uploadInput.files) {\n\t\t\t\tthis.addCustomSpriteFile(file);\n\t\t\t}\n\t\t},\n\t\tasync uploadFromURL() {\n\t\t\tconst url = prompt('Enter the URL of the image');\n\t\t\tif (!url) return;\n\t\t\tconst lastSegment = url.split('/').slice(-1)[0];\n\t\t\tthis.addNewCustomSprite(lastSegment, url);\n\t\t},\n\t\tasync addSpriteToScene(sprite: Sprite<IAsset>) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tawait this.$store.dispatch('objects/createSprite', {\n\t\t\t\t\tassets: sprite.variants[0],\n\t\t\t\t} as ICreateSpriteAction);\n\t\t\t});\n\t\t},\n\t\taddTextBox() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createTextBox',\n\t\t\t\t\t{} as ICreateTextBoxAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddChoice() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createChoice',\n\t\t\t\t\t{} as ICreateChoicesAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddDialog() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createNotification',\n\t\t\t\t\t{} as ICreateNotificationAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddPoem() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createPoem', {} as ICreatePoemAction);\n\t\t\t});\n\t\t},\n\t\taddConsole() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createConsole', {} as ICreatePoemAction);\n\t\t\t});\n\t\t},\n\t\tpaste() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/pasteObjectFromClipboard',\n\t\t\t\t\t{} as IPasteFromClipboardAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\tonChosen(id: string) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createCharacters', {\n\t\t\t\t\tcharacterType: id,\n\t\t\t\t} as ICreateCharacterAction);\n\t\t\t});\n\t\t},\n\t\taddCustomSpriteFile(file: File) {\n\t\t\tconst url = URL.createObjectURL(file);\n\t\t\tthis.addNewCustomSprite(file.name, url);\n\t\t},\n\t\taddNewCustomSprite(label: string, url: string) {\n\t\t\tuploadedSpritesPack.sprites.push({\n\t\t\t\tid: url,\n\t\t\t\tlabel,\n\t\t\t\tvariants: [[url]],\n\t\t\t});\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: uploadedSpritesPack,\n\t\t\t\t\tprocessed: false,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t});\n\t\t},\n\t\topenSpritesFolder() {\n\t\t\tenvironment.openFolder('sprites');\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.isWebPSupported = await isWebPSupported();\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\ntextarea {\n\tflex-grow: 1;\n}\n\n#panels {\n\t&:not(.vertical) .panel {\n\t\tjustify-content: center;\n\t}\n}\n\n.panel {\n\tflex-wrap: nowrap;\n\n\t.custom-sprite {\n\t\tinput {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n}\n\n.group-selector {\n\tdisplay: flex;\n\n\t&.vertical {\n\t\twidth: 100%;\n\t\tflex-direction: row;\n\t}\n\n\t&:not(.vertical) {\n\t\t@include height-100();\n\t\tflex-direction: column;\n\t}\n\n\tbutton {\n\t\tflex-grow: 1;\n\t\t&.active {\n\t\t\tbackground: $default-native-background;\n\t\t\tbackground: var(--native-background);\n\t\t}\n\t}\n}\n\n.item-grid {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: space-evenly;\n\n\t&.vertical {\n\t\tmargin-top: 4px;\n\t\twidth: 100%;\n\t\tflex-direction: row;\n\n\t\tbutton {\n\t\t\twidth: 100%;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\tmargin-left: 4px;\n\t\t@include height-100();\n\t\tflex-direction: column;\n\t}\n\n\t.character img {\n\t\tmax-height: 72px;\n\t\tmax-width: 72px;\n\t}\n}\n\n.item-grid {\n\t.sprite {\n\t\tbox-shadow: inset 0 0 1px 3px $default-modal-backdrop;\n\t\tbox-shadow: inset 0 0 1px 3px var(--modal-backdrop);\n\t\theight: 256px;\n\t\twidth: 256px;\n\t\tbackground-size: contain !important;\n\t\tbackground-repeat: no-repeat !important;\n\t\tbackground-position: center center !important;\n\t\tmargin-right: 4px;\n\t\ttext-shadow: 0 0 4px #000, -1px -1px 0 #000, 1px -1px 0 #000,\n\t\t\t-1px 1px 0 #000, 1px 1px 0 #000;\n\t\tcolor: white;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n}\n</style>\n","<template>\n\t<button :class=\"[iconPos]\" :disabled=\"disabled\">\n\t\t<div class=\"material-icons\" aria-hidden=\"true\">{{ icon }}</div>\n\t\t<div class=\"content\"><slot /></div>\n\t</button>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue';\nexport default defineComponent({\n\tprops: {\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticonPos: {\n\t\t\ttype: String as PropType<'left' | 'top'>,\n\t\t\tdefault: 'left',\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\nbutton {\n\tborder: 2px solid $default-border;\n\tborder: 2px solid var(--border);\n\tbackground: $default-accent-background;\n\tbackground: var(--accent-background);\n\tpadding: 1px;\n\tdisplay: flex;\n\ttext-align: center;\n\tjustify-content: center;\n\talign-items: center;\n\n\t&.left {\n\t\tflex-direction: row;\n\t\t> .content {\n\t\t\tflex-grow: 1;\n\t\t}\n\t}\n\t&.top {\n\t\tflex-direction: column;\n\t}\n}\n</style>\n","\nimport { defineComponent, PropType } from 'vue';\nexport default defineComponent({\n\tprops: {\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticonPos: {\n\t\t\ttype: String as PropType<'left' | 'top'>,\n\t\t\tdefault: 'left',\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n});\n","import { render } from \"./d-button.vue?vue&type=template&id=465f5994&scoped=true\"\nimport script from \"./d-button.vue?vue&type=script&lang=ts\"\nexport * from \"./d-button.vue?vue&type=script&lang=ts\"\n\nimport \"./d-button.vue?vue&type=style&index=0&id=465f5994&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-465f5994\"\n\nexport default script","\nimport { isWebPSupported } from '@/asset-manager';\nimport { ICreateCharacterAction } from '@/store/objectTypes/characters';\nimport { ICreateTextBoxAction } from '@/store/objectTypes/textbox';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport {\n\tCharacter,\n\tContentPack,\n\tSprite,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { PanelMixin } from './panelMixin';\nimport DropTarget from '../drop-target.vue';\nimport DButton from '@/components/ui/d-button.vue';\nimport { ICreateSpriteAction } from '@/store/objectTypes/sprite';\nimport { ICreateChoicesAction } from '@/store/objectTypes/choices';\nimport { ICreateNotificationAction } from '@/store/objectTypes/notification';\nimport { ICreatePoemAction } from '@/store/objectTypes/poem';\nimport environment, { Folder } from '@/environments/environment';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\nimport { IPasteFromClipboardAction } from '@/store/objects';\n\nconst uploadedSpritesPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.uploadedSprites',\n\tpackCredits: [''],\n\tdependencies: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DropTarget, DButton },\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\tcustomAssetCount: 0,\n\t\tgroup: 'characters' as 'characters' | 'sprites' | 'ui',\n\t}),\n\tcomputed: {\n\t\tcharacters(): DeepReadonly<Array<Character<IAsset>>> {\n\t\t\treturn this.$store.state.content.current.characters;\n\t\t},\n\t\tsprites(): DeepReadonly<Array<Sprite<IAsset>>> {\n\t\t\treturn this.$store.state.content.current.sprites;\n\t\t},\n\t\thasClipboardContent(): boolean {\n\t\t\treturn !!this.$store.state.ui.clipboard;\n\t\t},\n\t\tshowSpritesFolder(): boolean {\n\t\t\treturn (environment.supports.openableFolders as ReadonlySet<Folder>).has(\n\t\t\t\t'sprites'\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tassetSpriteBackground(sprite: Sprite<IAsset>) {\n\t\t\treturn sprite.variants[0]\n\t\t\t\t.map(variant => `url('${variant.lq}')`)\n\t\t\t\t.join(',');\n\t\t},\n\t\tassetPath(character: Character<IAsset>) {\n\t\t\treturn character.chibi\n\t\t\t\t? environment.supports.lq\n\t\t\t\t\t? character.chibi.lq\n\t\t\t\t\t: character.chibi.hq\n\t\t\t\t: '';\n\t\t},\n\t\tshowDropTarget(e: DragEvent) {\n\t\t\tif (!e.dataTransfer) return;\n\t\t\te.dataTransfer.effectAllowed = 'none';\n\t\t\tif (\n\t\t\t\t!Array.from(e.dataTransfer.items).find(item =>\n\t\t\t\t\titem.type.match(/^image.*$/)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.dataTransfer.effectAllowed = 'link';\n\t\t\tif (this.group === 'sprites') {\n\t\t\t\t(this.$refs.spriteDt as any).show();\n\t\t\t}\n\t\t},\n\t\thideDropTarget() {\n\t\t\tif (this.group === 'sprites') {\n\t\t\t\t(this.$refs.spriteDt as any).hide();\n\t\t\t}\n\t\t},\n\t\tonSpriteFileUpload() {\n\t\t\tconst uploadInput = this.$refs.spriteUpload as HTMLInputElement;\n\t\t\tif (!uploadInput.files) return;\n\t\t\tfor (const file of uploadInput.files) {\n\t\t\t\tthis.addCustomSpriteFile(file);\n\t\t\t}\n\t\t},\n\t\tasync uploadFromURL() {\n\t\t\tconst url = prompt('Enter the URL of the image');\n\t\t\tif (!url) return;\n\t\t\tconst lastSegment = url.split('/').slice(-1)[0];\n\t\t\tthis.addNewCustomSprite(lastSegment, url);\n\t\t},\n\t\tasync addSpriteToScene(sprite: Sprite<IAsset>) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tawait this.$store.dispatch('objects/createSprite', {\n\t\t\t\t\tassets: sprite.variants[0],\n\t\t\t\t} as ICreateSpriteAction);\n\t\t\t});\n\t\t},\n\t\taddTextBox() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createTextBox',\n\t\t\t\t\t{} as ICreateTextBoxAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddChoice() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createChoice',\n\t\t\t\t\t{} as ICreateChoicesAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddDialog() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createNotification',\n\t\t\t\t\t{} as ICreateNotificationAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddPoem() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createPoem', {} as ICreatePoemAction);\n\t\t\t});\n\t\t},\n\t\taddConsole() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createConsole', {} as ICreatePoemAction);\n\t\t\t});\n\t\t},\n\t\tpaste() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/pasteObjectFromClipboard',\n\t\t\t\t\t{} as IPasteFromClipboardAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\tonChosen(id: string) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createCharacters', {\n\t\t\t\t\tcharacterType: id,\n\t\t\t\t} as ICreateCharacterAction);\n\t\t\t});\n\t\t},\n\t\taddCustomSpriteFile(file: File) {\n\t\t\tconst url = URL.createObjectURL(file);\n\t\t\tthis.addNewCustomSprite(file.name, url);\n\t\t},\n\t\taddNewCustomSprite(label: string, url: string) {\n\t\t\tuploadedSpritesPack.sprites.push({\n\t\t\t\tid: url,\n\t\t\t\tlabel,\n\t\t\t\tvariants: [[url]],\n\t\t\t});\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: uploadedSpritesPack,\n\t\t\t\t\tprocessed: false,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t});\n\t\t},\n\t\topenSpritesFolder() {\n\t\t\tenvironment.openFolder('sprites');\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.isWebPSupported = await isWebPSupported();\n\t},\n});\n","import { render } from \"./add.vue?vue&type=template&id=2601b562&scoped=true\"\nimport script from \"./add.vue?vue&type=script&lang=ts\"\nexport * from \"./add.vue?vue&type=script&lang=ts\"\n\nimport \"./add.vue?vue&type=style&index=0&id=2601b562&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-2601b562\"\n\nexport default script","<template>\n\t<object-tool :object=\"object\" :title=\"label\" :showAltPanel=\"panelForParts\">\n\t\t<template v-slot:alt-panel>\n\t\t\t<parts\n\t\t\t\tv-if=\"panelForParts\"\n\t\t\t\t:character=\"object\"\n\t\t\t\t:part=\"panelForParts\"\n\t\t\t\t@leave=\"panelForParts = null\"\n\t\t\t\t@show-dialog=\"$emit('show-dialog', $event)\"\n\t\t\t\t@show-expression-dialog=\"$emit('show-expression-dialog', $event)\"\n\t\t\t/>\n\t\t</template>\n\t\t<template v-slot:default>\n\t\t\t<d-fieldset\n\t\t\t\tv-if=\"hasMultiplePoses || parts.length > 0\"\n\t\t\t\tclass=\"pose-list\"\n\t\t\t\ttitle=\"Pose:\"\n\t\t\t>\n\t\t\t\t<table>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr v-if=\"hasMultipleStyles\">\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekStyle(-1)\">&lt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button class=\"middle-button\" @click=\"panelForParts = 'style'\">\n\t\t\t\t\t\t\t\t\tStyle\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekStyle(1)\">&gt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-if=\"hasMultiplePoses\">\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekPose(-1)\">&lt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button class=\"middle-button\" @click=\"panelForParts = 'pose'\">\n\t\t\t\t\t\t\t\t\tPose\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekPose(1)\">&gt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-for=\"part of parts\" :key=\"part\">\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekPart(part, -1)\">&lt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button class=\"middle-button\" @click=\"panelForParts = part\">\n\t\t\t\t\t\t\t\t\t{{ captialize(part) }}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekPart(part, 1)\">&gt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</d-fieldset>\n\t\t</template>\n\t\t<template v-slot:options>\n\t\t\t<toggle v-model=\"closeUp\" label=\"Close up?\" />\n\t\t</template>\n\t</object-tool>\n</template>\n\n<script lang=\"ts\">\nimport {\n\tgetData,\n\tgetParts,\n\tISeekPoseAction,\n\tISeekPosePartAction,\n\tICharacter,\n\tISeekStyleAction,\n} from '@/store/objectTypes/characters';\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport Parts from './character/parts.vue';\nimport { Character } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport { PanelMixin } from './panelMixin';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool from './object-tool.vue';\n\nconst setable = genericSetable<ICharacter>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tParts,\n\t\tDFieldset,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\tpanelForParts: null as string | null,\n\t}),\n\tcomputed: {\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\tcloseUp: setable('close', 'objects/setClose'),\n\t\tselection(): string {\n\t\t\treturn this.$store.state.ui.selection!;\n\t\t},\n\t\tobject(): DeepReadonly<ICharacter> {\n\t\t\tconst obj = this.$store.state.objects.objects[this.selection];\n\t\t\tif (obj.type !== 'character') return undefined!;\n\t\t\treturn obj as ICharacter;\n\t\t},\n\t\tcharData(): DeepReadonly<Character<IAsset>> {\n\t\t\treturn getData(this.$store, this.object);\n\t\t},\n\t\tlabel(): string {\n\t\t\treturn this.charData.label || '';\n\t\t},\n\t\tparts(): DeepReadonly<string[]> {\n\t\t\treturn getParts(this.charData, this.object);\n\t\t},\n\t\thasMultipleStyles(): boolean {\n\t\t\treturn (\n\t\t\t\tthis.charData.styleGroups[this.object.styleGroupId].styles.length > 1 ||\n\t\t\t\tthis.charData.styleGroups.length > 1\n\t\t\t);\n\t\t},\n\t\thasMultiplePoses(): boolean {\n\t\t\tconst styleGroup = this.charData.styleGroups[this.object.styleGroupId];\n\t\t\tconst style = styleGroup.styles[this.object.styleId];\n\t\t\treturn style.poses.length > 1;\n\t\t},\n\t},\n\tmethods: {\n\t\tseekPose(delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekPose', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as ISeekPoseAction);\n\t\t\t});\n\t\t},\n\t\tseekStyle(delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekStyle', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as ISeekStyleAction);\n\t\t\t});\n\t\t},\n\t\tseekPart(part: string, delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekPart', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t\tpart,\n\t\t\t\t} as ISeekPosePartAction);\n\t\t\t});\n\t\t},\n\t\tcaptialize(str: string) {\n\t\t\treturn str.charAt(0).toUpperCase() + str.substring(1);\n\t\t},\n\t},\n\twatch: {\n\t\tselection() {\n\t\t\tthis.panelForParts = null;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\nfieldset {\n\ttable {\n\t\twidth: 100%;\n\t}\n}\n\n.panel:not(.vertical) {\n\tfieldset {\n\t\tmax-height: 100%;\n\t\toverflow: auto;\n\t}\n}\n\n.panel.vertical {\n\tfieldset {\n\t\tinput {\n\t\t\twidth: 60px;\n\t\t}\n\t}\n}\n\n.middle-button {\n\twidth: 100%;\n}\n\n.arrow-col {\n\twidth: 24px;\n\n\tbutton {\n\t\twidth: 24px;\n\t}\n}\n</style>\n","<template>\n\t<d-flow no-wraping>\n\t\t<button @click=\"$emit('leave')\">Back</button>\n\t\t<button\n\t\t\t@click=\"\n\t\t\t\t$emit('show-expression-dialog', { character: character.characterType })\n\t\t\t\"\n\t\t\tv-if=\"part === 'head'\"\n\t\t\tclass=\"icon-button\"\n\t\t>\n\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t<span class=\"text-block\">Create new expressions</span>\n\t\t</button>\n\t\t<button\n\t\t\t@click=\"\n\t\t\t\t$emit('show-dialog', 'type: Expressions character: ' + charData.label)\n\t\t\t\"\n\t\t\tv-if=\"part === 'head'\"\n\t\t\tclass=\"icon-button\"\n\t\t>\n\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t<span class=\"text-block\">Search in content packs</span>\n\t\t</button>\n\t\t<button\n\t\t\t@click=\"$emit('show-dialog', 'type: Styles character: ' + charData.label)\"\n\t\t\tv-else-if=\"part === 'style'\"\n\t\t\tclass=\"icon-button\"\n\t\t>\n\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t<span>Search in content packs</span>\n\t\t</button>\n\t\t<button\n\t\t\t@click=\"$emit('show-dialog', 'type: Poses character: ' + charData.label)\"\n\t\t\tv-else\n\t\t\tclass=\"icon-button\"\n\t\t>\n\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t<span>Search in content packs</span>\n\t\t</button>\n\t\t<part-button\n\t\t\tv-for=\"(part, index) of parts\"\n\t\t\t:key=\"index\"\n\t\t\t:value=\"index\"\n\t\t\t:part=\"part\"\n\t\t\t@click=\"\n\t\t\t\tchoose(index);\n\t\t\t\t$emit('leave');\n\t\t\t\"\n\t\t/>\n\t\t<d-fieldset\n\t\t\tv-for=\"styleComponent of styleComponents\"\n\t\t\t:key=\"styleComponent.name\"\n\t\t\t:title=\"styleComponent.label\"\n\t\t>\n\t\t\t<d-flow noWraping>\n\t\t\t\t<part-button\n\t\t\t\t\tv-for=\"(button, id) of styleComponent.buttons\"\n\t\t\t\t\t:size=\"130\"\n\t\t\t\t\t:key=\"id\"\n\t\t\t\t\t:value=\"id\"\n\t\t\t\t\t:part=\"button\"\n\t\t\t\t\t@click=\"choose_component(styleComponent.name, id)\"\n\t\t\t\t/>\n\t\t\t</d-flow>\n\t\t</d-fieldset>\n\t</d-flow>\n</template>\n\n<script lang=\"ts\">\nimport { isWebPSupported } from '@/asset-manager';\nimport PartButton, { IPartButtonImage, IPartImage } from './partButton.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport {\n\tPose,\n\tCharacter,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport {\n\tgetPose,\n\tISetPosePositionMutation,\n\tISetPartAction,\n\tgetData,\n\tICharacter,\n\tISetStyleAction,\n} from '@/store/objectTypes/characters';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent, PropType } from 'vue';\n\ninterface IPartStyleGroup {\n\tlabel: string;\n\tname: string;\n\tbuttons: { [id: string]: IPartButtonImage };\n}\n\nexport default defineComponent({\n\tcomponents: { PartButton, DFieldset, DFlow },\n\tprops: {\n\t\tcharacter: {\n\t\t\ttype: Object as PropType<ICharacter>,\n\t\t\trequired: true,\n\t\t},\n\t\tpart: {\n\t\t\trequired: true,\n\t\t\ttype: String as PropType<string | 'pose' | 'style'>,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\t/**\n\t\t * [styleComponentKey, styleComponentValue]\n\t\t */\n\t\tstylePriorities: [] as Array<[string, string]>,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tstyleComponents(): DeepReadonly<IPartStyleGroup[]> {\n\t\t\tif (this.part !== 'style') return [];\n\t\t\tconst styleComponents = this.charData.styleGroups[\n\t\t\t\tthis.character.styleGroupId\n\t\t\t];\n\t\t\treturn styleComponents.styleComponents.map(component => {\n\t\t\t\tconst buttons: IPartStyleGroup['buttons'] = {};\n\t\t\t\tfor (const key in component.variants) {\n\t\t\t\t\t// eslint-disable-next-line no-prototype-builtins\n\t\t\t\t\tif (!component.variants.hasOwnProperty(key)) continue;\n\t\t\t\t\tconst variant = component.variants[key];\n\t\t\t\t\tbuttons[key] = {\n\t\t\t\t\t\tsize: styleComponents.styles[0].poses[0].size,\n\t\t\t\t\t\toffset: [0, 0],\n\t\t\t\t\t\timages: [{ offset: [0, 0], asset: variant }],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn { label: component.label, name: component.id, buttons };\n\t\t\t});\n\t\t},\n\t\tparts(): { [id: number]: DeepReadonly<IPartButtonImage> } {\n\t\t\tconst ret: { [id: string]: DeepReadonly<IPartButtonImage> } = {};\n\t\t\tlet collection: DeepReadonly<IAsset[][]>;\n\t\t\tlet offset: DeepReadonly<IPartButtonImage['offset']>;\n\t\t\tlet size: DeepReadonly<IPartButtonImage['size']>;\n\t\t\tconst data = this.charData;\n\t\t\tconst currentPose = getPose(data, this.character);\n\t\t\tswitch (this.part) {\n\t\t\t\tcase 'head':\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet headKeyIdx = 0;\n\t\t\t\t\t\theadKeyIdx < currentPose.compatibleHeads.length;\n\t\t\t\t\t\t++headKeyIdx\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst headKey = currentPose.compatibleHeads[headKeyIdx];\n\t\t\t\t\t\tconst heads = data.heads[headKey];\n\t\t\t\t\t\tfor (let headIdx = 0; headIdx < heads.variants.length; ++headIdx) {\n\t\t\t\t\t\t\tconst headImages = heads.variants[headIdx];\n\t\t\t\t\t\t\tret[`${headKeyIdx}_${headIdx}`] = {\n\t\t\t\t\t\t\t\tsize: heads.previewSize,\n\t\t\t\t\t\t\t\toffset: heads.previewOffset,\n\t\t\t\t\t\t\t\timages: headImages.map(\n\t\t\t\t\t\t\t\t\t(image): IPartImage => ({ asset: image, offset: [0, 0] })\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\tcase 'pose':\n\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\tconst currentStyle =\n\t\t\t\t\t\tdata.styleGroups[this.character.styleGroupId].styles[\n\t\t\t\t\t\t\tthis.character.styleId\n\t\t\t\t\t\t];\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet poseIdx = 0;\n\t\t\t\t\t\tposeIdx < currentStyle.poses.length;\n\t\t\t\t\t\t++poseIdx\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst pose = currentStyle.poses[poseIdx];\n\t\t\t\t\t\tret[poseIdx] = this.generatePosePreview(pose);\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\tcase 'style':\n\t\t\t\t\tfor (const styleGroup of data.styleGroups) {\n\t\t\t\t\t\tret[styleGroup.id] = this.generatePosePreview(\n\t\t\t\t\t\t\tstyleGroup.styles[0].poses[0]\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\n\t\t\t\tdefault:\n\t\t\t\t\tcollection = currentPose.positions[this.part];\n\t\t\t\t\tsize = currentPose.previewSize;\n\t\t\t\t\toffset = currentPose.previewOffset;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tfor (let partIdx = 0; partIdx < collection.length; ++partIdx) {\n\t\t\t\tconst part = collection[partIdx];\n\t\t\t\tret[partIdx] = {\n\t\t\t\t\timages: part.map((partImage: IAsset) => ({\n\t\t\t\t\t\toffset: [0, 0],\n\t\t\t\t\t\tasset: partImage,\n\t\t\t\t\t})),\n\t\t\t\t\tsize,\n\t\t\t\t\toffset,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\tcharData(): DeepReadonly<Character<IAsset>> {\n\t\t\treturn getData(this.$store, this.character);\n\t\t},\n\t},\n\tmethods: {\n\t\tupdateStyleData(): void {\n\t\t\tconst baseStyle = this.charData.styleGroups[this.character.styleGroupId]\n\t\t\t\t.styles[this.character.styleId];\n\t\t\tthis.stylePriorities = Object.keys(baseStyle.components).map(key => [\n\t\t\t\tkey,\n\t\t\t\tbaseStyle.components[key],\n\t\t\t]);\n\t\t},\n\t\tgeneratePosePreview(\n\t\t\tpose: DeepReadonly<Pose<IAsset>>\n\t\t): DeepReadonly<IPartButtonImage> {\n\t\t\tconst data = this.charData;\n\t\t\tconst heads = data.heads[pose.compatibleHeads[0]];\n\t\t\tconst head = heads ? heads.variants[0] : null;\n\t\t\tlet images: IAsset[] = [];\n\n\t\t\tfor (const command of pose.renderCommands) {\n\t\t\t\tswitch (command.type) {\n\t\t\t\t\tcase 'pose-part':\n\t\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\t\tconst part = pose.positions[command.part];\n\t\t\t\t\t\tif (!part || part.length === 0) break;\n\t\t\t\t\t\timages = images.concat(part[0] as IAsset[]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'head':\n\t\t\t\t\t\tif (head) images = images.concat(head);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'image':\n\t\t\t\t\t\timages = images.concat(command.images);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\timages: images.map(image => ({ asset: image, offset: [0, 0] })),\n\t\t\t\tsize: pose.previewSize,\n\t\t\t\toffset: pose.previewOffset,\n\t\t\t};\n\t\t},\n\t\tupdatePose(styleGroupId?: number) {\n\t\t\tif (styleGroupId === undefined)\n\t\t\t\tstyleGroupId = this.character.styleGroupId;\n\n\t\t\tconst data = this.charData;\n\t\t\tconst styleGroups = data.styleGroups[styleGroupId];\n\t\t\tlet selection = styleGroups.styles;\n\t\t\tfor (const priority of this.stylePriorities) {\n\t\t\t\tconst subSelect = selection.filter(style => {\n\t\t\t\t\treturn style.components[priority[0]] === priority[1];\n\t\t\t\t});\n\t\t\t\tif (subSelect.length > 0) selection = subSelect;\n\t\t\t}\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setCharStyle', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tstyleGroupId,\n\t\t\t\t\tstyleId: styleGroups.styles.indexOf(selection[0]),\n\t\t\t\t} as ISetStyleAction);\n\t\t\t});\n\t\t},\n\t\tchoose(index: string) {\n\t\t\tif (this.part === 'style') {\n\t\t\t\tthis.updatePose(\n\t\t\t\t\tthis.charData.styleGroups.findIndex(group => group.id === index)\n\t\t\t\t);\n\t\t\t} else if (this.part === 'head') {\n\t\t\t\tconst [headTypeIdx, headIdx] = index\n\t\t\t\t\t.split('_', 2)\n\t\t\t\t\t.map(part => parseInt(part, 10));\n\t\t\t\tthis.$store.commit('objects/setPosePosition', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tposePositions: {\n\t\t\t\t\t\theadType: headTypeIdx,\n\t\t\t\t\t\thead: headIdx,\n\t\t\t\t\t},\n\t\t\t\t} as ISetPosePositionMutation);\n\t\t\t} else {\n\t\t\t\tthis.setPart(this.part, parseInt(index, 10));\n\t\t\t}\n\t\t},\n\t\t// eslint-disable-next-line @typescript-eslint/camelcase\n\t\tchoose_component(component: string, id: string) {\n\t\t\tconst prioIdx = this.stylePriorities.findIndex(\n\t\t\t\tstylePriority => stylePriority[0] === component\n\t\t\t);\n\t\t\tthis.stylePriorities.splice(prioIdx, 1);\n\t\t\tthis.stylePriorities.unshift([component, id]);\n\t\t\tthis.updatePose();\n\t\t},\n\t\tsetPart(part: ISetPartAction['part'], index: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setPart', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tpart,\n\t\t\t\t\tval: index,\n\t\t\t\t} as ISetPartAction);\n\t\t\t});\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.updateStyleData();\n\t\tthis.isWebPSupported = await isWebPSupported();\n\t},\n\twatch: {\n\t\tcharacter() {\n\t\t\tthis.updateStyleData();\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.icon-button {\n\tvertical-align: middle;\n\twidth: 100px;\n}\n</style>\n","<template>\n\t<div\n\t\t:class=\"{ part: true, active: false /*background === value*/ }\"\n\t\t:style=\"style\"\n\t\t@click=\"$emit('click')\"\n\t></div>\n</template>\n\n<script lang=\"ts\">\nimport { getAAsset, getAsset } from '@/asset-manager';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { IAsset } from '@/store/content';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent, Prop } from 'vue';\n\nexport interface IPartButtonImage {\n\timages: IPartImage[];\n\tsize: DeepReadonly<[number, number]>;\n\toffset: DeepReadonly<[number, number]>;\n}\n\nexport interface IPartImage {\n\tasset: IAsset | string;\n\toffset: DeepReadonly<[number, number]>;\n}\n\nconst spriteSize = 960;\n\nexport default defineComponent({\n\tprops: {\n\t\tpart: {\n\t\t\trequired: true,\n\t\t} as Prop<IPartButtonImage>,\n\t\tvalue: {\n\t\t\trequired: true,\n\t\t},\n\t\tsize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 150,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tlookups: [] as Array<HTMLImageElement | ErrorAsset | null>,\n\t\tloaded: false,\n\t}),\n\tcomputed: {\n\t\tscaleX(): number {\n\t\t\treturn this.size / this.part!.size[0];\n\t\t},\n\t\tscaleY(): number {\n\t\t\treturn this.size / this.part!.size[1];\n\t\t},\n\t\tbackgroundSize(): string {\n\t\t\treturn `${Math.floor(spriteSize * this.scaleX)}px ${Math.floor(\n\t\t\t\tspriteSize * this.scaleY\n\t\t\t)}px`;\n\t\t},\n\t\tbackgroundPosition(): string {\n\t\t\treturn (\n\t\t\t\t`${Math.floor(this.part!.offset[0] * -this.scaleX)}px ` +\n\t\t\t\t`${Math.floor(this.part!.offset[1] * -this.scaleY)}px`\n\t\t\t);\n\t\t},\n\t\tstyle(): { [id: string]: string } {\n\t\t\tconst images = (this.lookups.filter(\n\t\t\t\tlookup => lookup instanceof HTMLImageElement\n\t\t\t) as HTMLImageElement[]).map(\n\t\t\t\tlookup => `url('${lookup.src.replace(\"'\", \"\\\\'\")}')`\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tbackgroundImage: images.join(','),\n\t\t\t\theight: this.size + 'px',\n\t\t\t\twidth: this.size + 'px',\n\t\t\t\tbackgroundPosition: this.backgroundPosition,\n\t\t\t\tbackgroundSize: this.backgroundSize,\n\t\t\t};\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.lookups = await Promise.all(\n\t\t\tthis.part!.images.map(image => {\n\t\t\t\tif (typeof image.asset === 'string') {\n\t\t\t\t\treturn getAsset(image.asset, false);\n\t\t\t\t} else {\n\t\t\t\t\treturn getAAsset(image.asset, false);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.part {\n\tmargin-top: 4px;\n\ttext-shadow: 0 0 2px black;\n\tcolor: white;\n\tbox-shadow: inset 0 0 1px 3px $default-modal-backdrop;\n\tbox-shadow: inset 0 0 1px 3px var(--modal-backdrop);\n\ttext-align: center;\n\tuser-select: none;\n\tvertical-align: middle;\n\n\t&.active {\n\t\tbox-shadow: inset 0 0 1px 3px $default-modal-backdrop-light;\n\t\tbox-shadow: inset 0 0 1px 3px var(--modal-backdrop-light);\n\t}\n}\n\n.partList:not(.vertical) .part {\n\tdisplay: inline-block;\n}\n\n.partList.vertical .part {\n\tdisplay: block;\n}\n</style>\n","\nimport { getAAsset, getAsset } from '@/asset-manager';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { IAsset } from '@/store/content';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent, Prop } from 'vue';\n\nexport interface IPartButtonImage {\n\timages: IPartImage[];\n\tsize: DeepReadonly<[number, number]>;\n\toffset: DeepReadonly<[number, number]>;\n}\n\nexport interface IPartImage {\n\tasset: IAsset | string;\n\toffset: DeepReadonly<[number, number]>;\n}\n\nconst spriteSize = 960;\n\nexport default defineComponent({\n\tprops: {\n\t\tpart: {\n\t\t\trequired: true,\n\t\t} as Prop<IPartButtonImage>,\n\t\tvalue: {\n\t\t\trequired: true,\n\t\t},\n\t\tsize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 150,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tlookups: [] as Array<HTMLImageElement | ErrorAsset | null>,\n\t\tloaded: false,\n\t}),\n\tcomputed: {\n\t\tscaleX(): number {\n\t\t\treturn this.size / this.part!.size[0];\n\t\t},\n\t\tscaleY(): number {\n\t\t\treturn this.size / this.part!.size[1];\n\t\t},\n\t\tbackgroundSize(): string {\n\t\t\treturn `${Math.floor(spriteSize * this.scaleX)}px ${Math.floor(\n\t\t\t\tspriteSize * this.scaleY\n\t\t\t)}px`;\n\t\t},\n\t\tbackgroundPosition(): string {\n\t\t\treturn (\n\t\t\t\t`${Math.floor(this.part!.offset[0] * -this.scaleX)}px ` +\n\t\t\t\t`${Math.floor(this.part!.offset[1] * -this.scaleY)}px`\n\t\t\t);\n\t\t},\n\t\tstyle(): { [id: string]: string } {\n\t\t\tconst images = (this.lookups.filter(\n\t\t\t\tlookup => lookup instanceof HTMLImageElement\n\t\t\t) as HTMLImageElement[]).map(\n\t\t\t\tlookup => `url('${lookup.src.replace(\"'\", \"\\\\'\")}')`\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tbackgroundImage: images.join(','),\n\t\t\t\theight: this.size + 'px',\n\t\t\t\twidth: this.size + 'px',\n\t\t\t\tbackgroundPosition: this.backgroundPosition,\n\t\t\t\tbackgroundSize: this.backgroundSize,\n\t\t\t};\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.lookups = await Promise.all(\n\t\t\tthis.part!.images.map(image => {\n\t\t\t\tif (typeof image.asset === 'string') {\n\t\t\t\t\treturn getAsset(image.asset, false);\n\t\t\t\t} else {\n\t\t\t\t\treturn getAAsset(image.asset, false);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t},\n});\n","import { render } from \"./partButton.vue?vue&type=template&id=7d67a652&scoped=true\"\nimport script from \"./partButton.vue?vue&type=script&lang=ts\"\nexport * from \"./partButton.vue?vue&type=script&lang=ts\"\n\nimport \"./partButton.vue?vue&type=style&index=0&id=7d67a652&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-7d67a652\"\n\nexport default script","\nimport { defineComponent, h, Prop, PropType, VNode } from 'vue';\nimport { VerticalScrollRedirect } from '../vertical-scroll-redirect';\nexport default defineComponent({\n\tmixins: [VerticalScrollRedirect],\n\tprops: {\n\t\t/**\n\t\t * Indicates whether or not line-breaks are allowed. Otherwise all elements automatically get the maximum\n\t\t * width/hight (depending on direction)\n\t\t */\n\t\tnoWraping: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdirection: {\n\t\t\ttype: String as PropType<\n\t\t\t\t'global' | 'inverted' | 'horizontal' | 'vertical'\n\t\t\t>,\n\t\t\tdefault: 'global',\n\t\t},\n\t\tmaxSize: {} as Prop<string | [string, string]>,\n\t\tgap: {\n\t\t\ttype: String,\n\t\t\tdefault: '0px',\n\t\t},\n\t},\n\tcomputed: {\n\t\tfinalDirection(): 'horizontal' | 'vertical' {\n\t\t\tif (this.direction === 'global') {\n\t\t\t\treturn this.$store.state.ui.vertical ? 'vertical' : 'horizontal';\n\t\t\t}\n\t\t\tif (this.direction === 'inverted') {\n\t\t\t\treturn this.$store.state.ui.vertical ? 'horizontal' : 'vertical';\n\t\t\t}\n\t\t\treturn this.direction;\n\t\t},\n\t},\n\trender(): VNode {\n\t\tconst wrapingClass = this.noWraping ? 'no-wraping' : 'wraping';\n\t\tconst attrs: { [s: string]: any } = {};\n\t\tconst flowContainer = h(\n\t\t\t'div',\n\t\t\t{\n\t\t\t\t...attrs,\n\t\t\t\tclass: ['d-flow', this.finalDirection, wrapingClass],\n\t\t\t\tstyle: {\n\t\t\t\t\tgap: this.gap,\n\t\t\t\t},\n\t\t\t},\n\t\t\tthis.$slots.default!()\n\t\t);\n\t\tif (this.maxSize) {\n\t\t\tconst maxSize =\n\t\t\t\tthis.maxSize instanceof Array\n\t\t\t\t\t? this.maxSize[this.finalDirection === 'horizontal' ? 0 : 1]\n\t\t\t\t\t: this.maxSize;\n\t\t\treturn h(\n\t\t\t\t'div',\n\t\t\t\t{\n\t\t\t\t\tref: 'scrollContainer',\n\t\t\t\t\tclass: ['d-flow-scroll-container', this.finalDirection],\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\t[this.finalDirection === 'horizontal'\n\t\t\t\t\t\t\t? 'maxWidth'\n\t\t\t\t\t\t\t: 'maxHeight']: maxSize,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[flowContainer]\n\t\t\t);\n\t\t}\n\t\treturn flowContainer;\n\t},\n\tmounted() {\n\t\tif (this.$refs.scrollContainer) {\n\t\t\t(this.$refs.scrollContainer as HTMLDivElement).addEventListener(\n\t\t\t\t'wheel',\n\t\t\t\t(this as any).verticalScrollRedirect\n\t\t\t);\n\t\t}\n\t},\n});\n","import script from \"./d-flow.vue?vue&type=script&lang=ts\"\nexport * from \"./d-flow.vue?vue&type=script&lang=ts\"\n\nimport \"./d-flow.vue?vue&type=style&index=0&id=64adfc9c&lang=scss&scoped=true\"\nscript.__scopeId = \"data-v-64adfc9c\"\n\nexport default script","\nimport { isWebPSupported } from '@/asset-manager';\nimport PartButton, { IPartButtonImage, IPartImage } from './partButton.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport {\n\tPose,\n\tCharacter,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport {\n\tgetPose,\n\tISetPosePositionMutation,\n\tISetPartAction,\n\tgetData,\n\tICharacter,\n\tISetStyleAction,\n} from '@/store/objectTypes/characters';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent, PropType } from 'vue';\n\ninterface IPartStyleGroup {\n\tlabel: string;\n\tname: string;\n\tbuttons: { [id: string]: IPartButtonImage };\n}\n\nexport default defineComponent({\n\tcomponents: { PartButton, DFieldset, DFlow },\n\tprops: {\n\t\tcharacter: {\n\t\t\ttype: Object as PropType<ICharacter>,\n\t\t\trequired: true,\n\t\t},\n\t\tpart: {\n\t\t\trequired: true,\n\t\t\ttype: String as PropType<string | 'pose' | 'style'>,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\t/**\n\t\t * [styleComponentKey, styleComponentValue]\n\t\t */\n\t\tstylePriorities: [] as Array<[string, string]>,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tstyleComponents(): DeepReadonly<IPartStyleGroup[]> {\n\t\t\tif (this.part !== 'style') return [];\n\t\t\tconst styleComponents = this.charData.styleGroups[\n\t\t\t\tthis.character.styleGroupId\n\t\t\t];\n\t\t\treturn styleComponents.styleComponents.map(component => {\n\t\t\t\tconst buttons: IPartStyleGroup['buttons'] = {};\n\t\t\t\tfor (const key in component.variants) {\n\t\t\t\t\t// eslint-disable-next-line no-prototype-builtins\n\t\t\t\t\tif (!component.variants.hasOwnProperty(key)) continue;\n\t\t\t\t\tconst variant = component.variants[key];\n\t\t\t\t\tbuttons[key] = {\n\t\t\t\t\t\tsize: styleComponents.styles[0].poses[0].size,\n\t\t\t\t\t\toffset: [0, 0],\n\t\t\t\t\t\timages: [{ offset: [0, 0], asset: variant }],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn { label: component.label, name: component.id, buttons };\n\t\t\t});\n\t\t},\n\t\tparts(): { [id: number]: DeepReadonly<IPartButtonImage> } {\n\t\t\tconst ret: { [id: string]: DeepReadonly<IPartButtonImage> } = {};\n\t\t\tlet collection: DeepReadonly<IAsset[][]>;\n\t\t\tlet offset: DeepReadonly<IPartButtonImage['offset']>;\n\t\t\tlet size: DeepReadonly<IPartButtonImage['size']>;\n\t\t\tconst data = this.charData;\n\t\t\tconst currentPose = getPose(data, this.character);\n\t\t\tswitch (this.part) {\n\t\t\t\tcase 'head':\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet headKeyIdx = 0;\n\t\t\t\t\t\theadKeyIdx < currentPose.compatibleHeads.length;\n\t\t\t\t\t\t++headKeyIdx\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst headKey = currentPose.compatibleHeads[headKeyIdx];\n\t\t\t\t\t\tconst heads = data.heads[headKey];\n\t\t\t\t\t\tfor (let headIdx = 0; headIdx < heads.variants.length; ++headIdx) {\n\t\t\t\t\t\t\tconst headImages = heads.variants[headIdx];\n\t\t\t\t\t\t\tret[`${headKeyIdx}_${headIdx}`] = {\n\t\t\t\t\t\t\t\tsize: heads.previewSize,\n\t\t\t\t\t\t\t\toffset: heads.previewOffset,\n\t\t\t\t\t\t\t\timages: headImages.map(\n\t\t\t\t\t\t\t\t\t(image): IPartImage => ({ asset: image, offset: [0, 0] })\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\tcase 'pose':\n\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\tconst currentStyle =\n\t\t\t\t\t\tdata.styleGroups[this.character.styleGroupId].styles[\n\t\t\t\t\t\t\tthis.character.styleId\n\t\t\t\t\t\t];\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet poseIdx = 0;\n\t\t\t\t\t\tposeIdx < currentStyle.poses.length;\n\t\t\t\t\t\t++poseIdx\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst pose = currentStyle.poses[poseIdx];\n\t\t\t\t\t\tret[poseIdx] = this.generatePosePreview(pose);\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\tcase 'style':\n\t\t\t\t\tfor (const styleGroup of data.styleGroups) {\n\t\t\t\t\t\tret[styleGroup.id] = this.generatePosePreview(\n\t\t\t\t\t\t\tstyleGroup.styles[0].poses[0]\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\n\t\t\t\tdefault:\n\t\t\t\t\tcollection = currentPose.positions[this.part];\n\t\t\t\t\tsize = currentPose.previewSize;\n\t\t\t\t\toffset = currentPose.previewOffset;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tfor (let partIdx = 0; partIdx < collection.length; ++partIdx) {\n\t\t\t\tconst part = collection[partIdx];\n\t\t\t\tret[partIdx] = {\n\t\t\t\t\timages: part.map((partImage: IAsset) => ({\n\t\t\t\t\t\toffset: [0, 0],\n\t\t\t\t\t\tasset: partImage,\n\t\t\t\t\t})),\n\t\t\t\t\tsize,\n\t\t\t\t\toffset,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\tcharData(): DeepReadonly<Character<IAsset>> {\n\t\t\treturn getData(this.$store, this.character);\n\t\t},\n\t},\n\tmethods: {\n\t\tupdateStyleData(): void {\n\t\t\tconst baseStyle = this.charData.styleGroups[this.character.styleGroupId]\n\t\t\t\t.styles[this.character.styleId];\n\t\t\tthis.stylePriorities = Object.keys(baseStyle.components).map(key => [\n\t\t\t\tkey,\n\t\t\t\tbaseStyle.components[key],\n\t\t\t]);\n\t\t},\n\t\tgeneratePosePreview(\n\t\t\tpose: DeepReadonly<Pose<IAsset>>\n\t\t): DeepReadonly<IPartButtonImage> {\n\t\t\tconst data = this.charData;\n\t\t\tconst heads = data.heads[pose.compatibleHeads[0]];\n\t\t\tconst head = heads ? heads.variants[0] : null;\n\t\t\tlet images: IAsset[] = [];\n\n\t\t\tfor (const command of pose.renderCommands) {\n\t\t\t\tswitch (command.type) {\n\t\t\t\t\tcase 'pose-part':\n\t\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\t\tconst part = pose.positions[command.part];\n\t\t\t\t\t\tif (!part || part.length === 0) break;\n\t\t\t\t\t\timages = images.concat(part[0] as IAsset[]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'head':\n\t\t\t\t\t\tif (head) images = images.concat(head);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'image':\n\t\t\t\t\t\timages = images.concat(command.images);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\timages: images.map(image => ({ asset: image, offset: [0, 0] })),\n\t\t\t\tsize: pose.previewSize,\n\t\t\t\toffset: pose.previewOffset,\n\t\t\t};\n\t\t},\n\t\tupdatePose(styleGroupId?: number) {\n\t\t\tif (styleGroupId === undefined)\n\t\t\t\tstyleGroupId = this.character.styleGroupId;\n\n\t\t\tconst data = this.charData;\n\t\t\tconst styleGroups = data.styleGroups[styleGroupId];\n\t\t\tlet selection = styleGroups.styles;\n\t\t\tfor (const priority of this.stylePriorities) {\n\t\t\t\tconst subSelect = selection.filter(style => {\n\t\t\t\t\treturn style.components[priority[0]] === priority[1];\n\t\t\t\t});\n\t\t\t\tif (subSelect.length > 0) selection = subSelect;\n\t\t\t}\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setCharStyle', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tstyleGroupId,\n\t\t\t\t\tstyleId: styleGroups.styles.indexOf(selection[0]),\n\t\t\t\t} as ISetStyleAction);\n\t\t\t});\n\t\t},\n\t\tchoose(index: string) {\n\t\t\tif (this.part === 'style') {\n\t\t\t\tthis.updatePose(\n\t\t\t\t\tthis.charData.styleGroups.findIndex(group => group.id === index)\n\t\t\t\t);\n\t\t\t} else if (this.part === 'head') {\n\t\t\t\tconst [headTypeIdx, headIdx] = index\n\t\t\t\t\t.split('_', 2)\n\t\t\t\t\t.map(part => parseInt(part, 10));\n\t\t\t\tthis.$store.commit('objects/setPosePosition', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tposePositions: {\n\t\t\t\t\t\theadType: headTypeIdx,\n\t\t\t\t\t\thead: headIdx,\n\t\t\t\t\t},\n\t\t\t\t} as ISetPosePositionMutation);\n\t\t\t} else {\n\t\t\t\tthis.setPart(this.part, parseInt(index, 10));\n\t\t\t}\n\t\t},\n\t\t// eslint-disable-next-line @typescript-eslint/camelcase\n\t\tchoose_component(component: string, id: string) {\n\t\t\tconst prioIdx = this.stylePriorities.findIndex(\n\t\t\t\tstylePriority => stylePriority[0] === component\n\t\t\t);\n\t\t\tthis.stylePriorities.splice(prioIdx, 1);\n\t\t\tthis.stylePriorities.unshift([component, id]);\n\t\t\tthis.updatePose();\n\t\t},\n\t\tsetPart(part: ISetPartAction['part'], index: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setPart', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tpart,\n\t\t\t\t\tval: index,\n\t\t\t\t} as ISetPartAction);\n\t\t\t});\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.updateStyleData();\n\t\tthis.isWebPSupported = await isWebPSupported();\n\t},\n\twatch: {\n\t\tcharacter() {\n\t\t\tthis.updateStyleData();\n\t\t},\n\t},\n});\n","import { render } from \"./parts.vue?vue&type=template&id=47f2e1e8&scoped=true\"\nimport script from \"./parts.vue?vue&type=script&lang=ts\"\nexport * from \"./parts.vue?vue&type=script&lang=ts\"\n\nimport \"./parts.vue?vue&type=style&index=0&id=47f2e1e8&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-47f2e1e8\"\n\nexport default script","import { IObject } from '@/store/objects';\r\nimport { ComponentCustomProperties } from 'vue';\r\n\r\nexport function genericSetable<T extends IObject>() {\r\n\treturn function setable<K extends keyof T>(\r\n\t\tkey: K,\r\n\t\tmessage: string,\r\n\t\taction = false\r\n\t) {\r\n\t\treturn {\r\n\t\t\tget(this: IThis<T>): T[K] {\r\n\t\t\t\treturn this.object[key];\r\n\t\t\t},\r\n\t\t\tset(this: IThis<T>, val: T[K]): void {\r\n\t\t\t\tthis.vuexHistory.transaction(() => {\r\n\t\t\t\t\tthis.$store[action ? 'dispatch' : 'commit'](message, {\r\n\t\t\t\t\t\tid: this.object.id,\r\n\t\t\t\t\t\t[key]: val,\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t};\r\n\t};\r\n}\r\n\r\ninterface IThis<T extends IObject> extends ComponentCustomProperties {\r\n\tobject: T;\r\n}\r\n","<template>\n\t<div class=\"panel\">\n\t\t<h1\n\t\t\t:style=\"{ fontStyle: this.hasLabel ? 'italic' : 'normal' }\"\n\t\t\t@click=\"enableNameEdit\"\n\t\t>\n\t\t\t{{ heading }}\n\t\t\t<span class=\"icon material-icons\">edit</span>\n\t\t</h1>\n\t\t<teleport to=\"#modal-messages\">\n\t\t\t<modal-dialog\n\t\t\t\t:options=\"['Apply', 'Cancel']\"\n\t\t\t\tno-base-size\n\t\t\t\tclass=\"modal-rename\"\n\t\t\t\tv-if=\"showRename\"\n\t\t\t\t@option=\"renameOption\"\n\t\t\t\t@leave=\"renameOption('Cancel')\"\n\t\t\t>\n\t\t\t\t<p class=\"modal-text\">\n\t\t\t\t\tEnter the new name\n\t\t\t\t</p>\n\t\t\t\t<p class=\"modal-text\">\n\t\t\t\t\t<input v-model=\"modalNameInput\" style=\"width: 100%\" />\n\t\t\t\t</p>\n\t\t\t</modal-dialog>\n\t\t</teleport>\n\t\t<text-editor\n\t\t\tv-if=\"textHandler\"\n\t\t\t:title=\"textHandler.title\"\n\t\t\t:modelValue=\"textHandler.get()\"\n\t\t\t@update:modelValue=\"textHandler.set($event)\"\n\t\t\t@leave=\"textHandler.leave()\"\n\t\t/>\n\t\t<color\n\t\t\tv-else-if=\"finalColorHandler\"\n\t\t\t:title=\"finalColorHandler.title\"\n\t\t\t:modelValue=\"finalColorHandler.get()\"\n\t\t\t@update:modelValue=\"finalColorHandler.set($event)\"\n\t\t\t@leave=\"finalColorHandler.leave()\"\n\t\t/>\n\t\t<image-options\n\t\t\tv-else-if=\"imageOptionsOpen\"\n\t\t\ttype=\"object\"\n\t\t\t:id=\"object.id\"\n\t\t\t@leave=\"imageOptionsOpen = false\"\n\t\t/>\n\t\t<slot v-else-if=\"showAltPanel\" name=\"alt-panel\" />\n\t\t<template v-else>\n\t\t\t<slot />\n\t\t\t<position-and-size :obj=\"object\" />\n\t\t\t<layers :object=\"object\" />\n\t\t\t<toggle v-model=\"flip\" label=\"Flip?\" />\n\t\t\t<table class=\"input-table\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td><label for=\"rotation\">Rotation: °</label></td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"rotation\"\n\t\t\t\t\t\t\tclass=\"smol\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model=\"rotation\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr v-if=\"object.type === 'character' || object.type === 'sprite'\">\n\t\t\t\t\t<td><label for=\"zoom\">Zoom: </label></td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"zoom\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tclass=\"smol\"\n\t\t\t\t\t\t\tstep=\"1\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tv-model=\"zoom\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\n\t\t\t<slot name=\"options\" />\n\t\t\t<d-fieldset v-if=\"hasLabel\" title=\"Textbox settings\">\n\t\t\t\t<toggle\n\t\t\t\t\tlabel=\"Enlarge when talking\"\n\t\t\t\t\tv-model=\"enlargeWhenTalking\"\n\t\t\t\t\tv-if=\"object.type === 'character' || object.type === 'sprite'\"\n\t\t\t\t/>\n\t\t\t\t<toggle\n\t\t\t\t\tlabel=\"Use custom textbox color\"\n\t\t\t\t\tv-model=\"useCustomTextboxColor\"\n\t\t\t\t/>\n\t\t\t\t<table>\n\t\t\t\t\t<tr v-if=\"useCustomTextboxColor\">\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"textbox_color\">Color:</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tid=\"textbox_color\"\n\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t:style=\"{ background: object.textboxColor }\"\n\t\t\t\t\t\t\t\t@click=\"selectTextboxColor\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"namebox_width\">Namebox width:</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"namebox_width\"\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t:placeholder=\"defaultNameboxWidth\"\n\t\t\t\t\t\t\t\tv-model.lazy=\"nameboxWidth\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t</d-fieldset>\n\t\t\t<button @click=\"imageOptionsOpen = true\">Image options</button>\n\t\t\t<button @click=\"copy\">Copy</button>\n\t\t\t<delete :obj=\"object\" />\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport Color from '@/components/toolbox/subtools/color/color.vue';\nimport { PanelMixin } from './panelMixin';\nimport TextEditor from '../subtools/text/text.vue';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { defineComponent, PropType } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport {\n\tICopyObjectToClipboardAction,\n\tIObject,\n\tISetLabelMutation,\n\tISetNameboxWidthMutation,\n\tISetObjectZoomMutation,\n\tISetTextBoxColor,\n} from '@/store/objects';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { textboxDefaultColor } from '@/constants/textBoxCustom';\nimport { NameboxWidth } from '@/constants/textBox';\n\nconst setable = genericSetable<IPoem>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tTextEditor,\n\t\tImageOptions,\n\t\tColor,\n\t\tModalDialog,\n\t\tDFieldset,\n\t},\n\tprops: {\n\t\tobject: {\n\t\t\ttype: Object as PropType<IObject>,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: String,\n\t\ttextHandler: {\n\t\t\ttype: Object as PropType<Handler>,\n\t\t},\n\t\tcolorHandler: {\n\t\t\ttype: Object as PropType<Handler>,\n\t\t},\n\t\tshowAltPanel: Boolean,\n\t},\n\tdata: () => ({\n\t\timageOptionsOpen: false,\n\t\tcanEdit: true,\n\t\tmodalNameInput: '',\n\t\tshowRename: false,\n\t\tlocalColorHandler: null as Handler | null,\n\t}),\n\tcomputed: {\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\trotation: setable('rotation', 'objects/setRotation'),\n\t\tenlargeWhenTalking: setable(\n\t\t\t'enlargeWhenTalking',\n\t\t\t'objects/setEnlargeWhenTalking'\n\t\t),\n\t\tnameboxWidth: {\n\t\t\tget(): string {\n\t\t\t\tconst val = this.object.nameboxWidth;\n\t\t\t\tif (val === null) return '';\n\t\t\t\treturn val + '';\n\t\t\t},\n\t\t\tset(value: string) {\n\t\t\t\tconst val = value.trim() === '' ? null : parseInt(value);\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setObjectNameboxWidth', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\tnameboxWidth: val,\n\t\t\t\t\t} as ISetNameboxWidthMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tzoom: {\n\t\t\tget(): number {\n\t\t\t\treturn this.object.zoom * 100;\n\t\t\t},\n\t\t\tset(zoom: number): void {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setObjectZoom', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\tzoom: zoom / 100,\n\t\t\t\t\t} as ISetObjectZoomMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tdefaultNameboxWidth(): number {\n\t\t\treturn NameboxWidth;\n\t\t},\n\t\tfinalColorHandler(): Handler | null {\n\t\t\treturn this.localColorHandler || this.colorHandler || null;\n\t\t},\n\t\thasLabel(): boolean {\n\t\t\treturn this.object.label !== null;\n\t\t},\n\t\theading(): string {\n\t\t\tconsole.log('heading', this.object.label, this.title, 'Object');\n\t\t\treturn this.object.label || this.title || 'Object';\n\t\t},\n\t\tuseCustomTextboxColor: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.object.textboxColor !== null;\n\t\t\t},\n\t\t\tset(val: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setTextboxColor', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\ttextboxColor: val ? textboxDefaultColor : null,\n\t\t\t\t\t} as ICopyObjectToClipboardAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t},\n\tmethods: {\n\t\tcopy() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/copyObjectToClipboard', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as ICopyObjectToClipboardAction);\n\t\t\t});\n\t\t},\n\t\tenableNameEdit() {\n\t\t\tthis.modalNameInput = this.object.label || '';\n\t\t\tthis.showRename = true;\n\t\t},\n\t\trenameOption(option: 'Apply' | 'Cancel') {\n\t\t\tthis.showRename = false;\n\t\t\tif (option === 'Apply') {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setLabel', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\tlabel: this.modalNameInput,\n\t\t\t\t\t} as ISetLabelMutation);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tselectTextboxColor() {\n\t\t\tthis.localColorHandler = {\n\t\t\t\ttitle: 'Textbox color',\n\t\t\t\tget: () => this.object.textboxColor,\n\t\t\t\tset: (color: string) => {\n\t\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\t\tthis.$store.commit('objects/setTextboxColor', {\n\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\ttextboxColor: color,\n\t\t\t\t\t\t} as ISetTextBoxColor);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.localColorHandler = null;\n\t\t\t\t},\n\t\t\t} as Handler;\n\t\t},\n\t},\n});\n\nexport interface Handler {\n\ttitle: string;\n\tget: () => string;\n\tset: (value: string) => void;\n\tleave: () => void;\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.panel.vertical {\n\t.input-table {\n\t\twidth: 100%;\n\t}\n}\n\n.input-table {\n\tinput {\n\t\twidth: 64px;\n\t}\n}\n\n.color-button {\n\theight: 24px;\n\twidth: 48px;\n\tvertical-align: middle;\n}\n\n#namebox_width {\n\twidth: 5em;\n}\n</style>\n<style lang=\"scss\">\n.modal-rename dialog {\n\tpadding: 4px;\n\tp {\n\t\tfont-family: aller;\n\t\tfont-size: 24px;\n\t}\n}\n</style>\n","<template>\n\t<d-fieldset :title=\"'Position' + (allowSize ? '/Size' : '')\">\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t<toggle\n\t\t\t\t\t\tv-if=\"allowStepMove\"\n\t\t\t\t\t\tv-model=\"freeMove\"\n\t\t\t\t\t\tlabel=\"Move freely?\"\n\t\t\t\t\t/>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr v-if=\"allowStepMove && !freeMove\">\n\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t<table>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"--pos\" :disabled=\"isFirstPos\">&lt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<select id=\"current_talking\" v-model.number=\"pos\">\n\t\t\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\t\t\tv-for=\"(val, key) of positionNames\"\n\t\t\t\t\t\t\t\t\t\t:key=\"key\"\n\t\t\t\t\t\t\t\t\t\t:value=\"key\"\n\t\t\t\t\t\t\t\t\t\t>{{ val }}</option\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"++pos\" :disabled=\"isLastPos\">&gt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<template v-else>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"sprite_x\">X:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"sprite_x\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model.number=\"x\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"sprite_y\">Y:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"sprite_y\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model.number=\"y\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</template>\n\t\t\t<template v-if=\"allowSize\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"sprite_w\">Width:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"sprite_w\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model.number=\"width\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"sprite_h\">Height:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"sprite_h\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model.number=\"height\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t<toggle v-model=\"preserveRatio\" label=\"Lock ratio?\" />\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</template>\n\t\t</table>\n\t</d-fieldset>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { positions, characterPositions } from '@/constants/base';\nimport {\n\tclosestCharacterSlot,\n\tISetFreeMoveMutation,\n\tICharacter,\n} from '@/store/objectTypes/characters';\nimport {\n\tISetPositionAction,\n\tISetObjectPositionMutation,\n\tIObject,\n\tISetHeightAction,\n\tISetWidthAction,\n\tISetRatioAction,\n} from '@/store/objects';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tprops: {\n\t\tobj: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\tcomputed: {\n\t\tfreeMove: {\n\t\t\tget(): boolean {\n\t\t\t\treturn (this.obj! as ICharacter).freeMove;\n\t\t\t},\n\t\t\tset(freeMove: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setFreeMove', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tfreeMove,\n\t\t\t\t\t} as ISetFreeMoveMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tpreserveRatio: {\n\t\t\tget(): boolean {\n\t\t\t\treturn (this.obj! as ICharacter).preserveRatio;\n\t\t\t},\n\t\t\tset(preserveRatio: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPreserveRatio', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tpreserveRatio,\n\t\t\t\t\t} as ISetRatioAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tpos: {\n\t\t\tget(): number {\n\t\t\t\treturn closestCharacterSlot(this.obj!.x);\n\t\t\t},\n\t\t\tset(value: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx: characterPositions[value],\n\t\t\t\t\t\ty: this.obj!.y,\n\t\t\t\t\t} as ISetPositionAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tx: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.x;\n\t\t\t},\n\t\t\tset(x: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty: this.y,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ty: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.y;\n\t\t\t},\n\t\t\tset(y: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx: this.x,\n\t\t\t\t\t\ty,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\theight: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.height;\n\t\t\t},\n\t\t\tset(height: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setHeight', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\theight,\n\t\t\t\t\t} as ISetHeightAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\twidth: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.width;\n\t\t\t},\n\t\t\tset(width: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setWidth', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\twidth,\n\t\t\t\t\t} as ISetWidthAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tallowSize(): boolean {\n\t\t\tconst obj = this.obj!;\n\t\t\tif (obj.type === 'textBox' && (obj as ITextBox).style !== 'custom') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (obj.type === 'character' && !(obj as ICharacter).freeMove) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\tallowStepMove(): boolean {\n\t\t\treturn 'freeMove' in this.obj!;\n\t\t},\n\t\tpositionNames(): string[] {\n\t\t\treturn positions;\n\t\t},\n\n\t\tisFirstPos(): boolean {\n\t\t\treturn this.pos === 0;\n\t\t},\n\n\t\tisLastPos(): boolean {\n\t\t\treturn this.pos === positions.length - 1;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\nfieldset {\n\t> table {\n\t\twidth: 100%;\n\n\t\t> tr > td:nth-child(2) {\n\t\t\twidth: 64px;\n\t\t}\n\n\t\ttable {\n\t\t\twidth: 100%;\n\t\t\tselect {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.vertical {\n\tfieldset {\n\t\tinput {\n\t\t\twidth: 64px;\n\t\t}\n\t}\n}\n\ninput {\n\twidth: 80px;\n}\n\n.arrow-col {\n\twidth: 24px;\n\n\tbutton {\n\t\twidth: 24px;\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { positions, characterPositions } from '@/constants/base';\nimport {\n\tclosestCharacterSlot,\n\tISetFreeMoveMutation,\n\tICharacter,\n} from '@/store/objectTypes/characters';\nimport {\n\tISetPositionAction,\n\tISetObjectPositionMutation,\n\tIObject,\n\tISetHeightAction,\n\tISetWidthAction,\n\tISetRatioAction,\n} from '@/store/objects';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tprops: {\n\t\tobj: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\tcomputed: {\n\t\tfreeMove: {\n\t\t\tget(): boolean {\n\t\t\t\treturn (this.obj! as ICharacter).freeMove;\n\t\t\t},\n\t\t\tset(freeMove: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setFreeMove', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tfreeMove,\n\t\t\t\t\t} as ISetFreeMoveMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tpreserveRatio: {\n\t\t\tget(): boolean {\n\t\t\t\treturn (this.obj! as ICharacter).preserveRatio;\n\t\t\t},\n\t\t\tset(preserveRatio: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPreserveRatio', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tpreserveRatio,\n\t\t\t\t\t} as ISetRatioAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tpos: {\n\t\t\tget(): number {\n\t\t\t\treturn closestCharacterSlot(this.obj!.x);\n\t\t\t},\n\t\t\tset(value: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx: characterPositions[value],\n\t\t\t\t\t\ty: this.obj!.y,\n\t\t\t\t\t} as ISetPositionAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tx: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.x;\n\t\t\t},\n\t\t\tset(x: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty: this.y,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ty: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.y;\n\t\t\t},\n\t\t\tset(y: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx: this.x,\n\t\t\t\t\t\ty,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\theight: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.height;\n\t\t\t},\n\t\t\tset(height: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setHeight', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\theight,\n\t\t\t\t\t} as ISetHeightAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\twidth: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.width;\n\t\t\t},\n\t\t\tset(width: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setWidth', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\twidth,\n\t\t\t\t\t} as ISetWidthAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tallowSize(): boolean {\n\t\t\tconst obj = this.obj!;\n\t\t\tif (obj.type === 'textBox' && (obj as ITextBox).style !== 'custom') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (obj.type === 'character' && !(obj as ICharacter).freeMove) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\tallowStepMove(): boolean {\n\t\t\treturn 'freeMove' in this.obj!;\n\t\t},\n\t\tpositionNames(): string[] {\n\t\t\treturn positions;\n\t\t},\n\n\t\tisFirstPos(): boolean {\n\t\t\treturn this.pos === 0;\n\t\t},\n\n\t\tisLastPos(): boolean {\n\t\t\treturn this.pos === positions.length - 1;\n\t\t},\n\t},\n});\n","import { render } from \"./positionAndSize.vue?vue&type=template&id=7f101752&scoped=true\"\nimport script from \"./positionAndSize.vue?vue&type=script&lang=ts\"\nexport * from \"./positionAndSize.vue?vue&type=script&lang=ts\"\n\nimport \"./positionAndSize.vue?vue&type=style&index=0&id=7f101752&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-7f101752\"\n\nexport default script","<template>\n\t<d-fieldset id=\"layerfs\" title=\"Layer:\">\n\t\t<table>\n\t\t\t<tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"shiftLayer(-Infinity)\" title=\"Move to back\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">vertical_align_bottom</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"shiftLayer(-1)\" title=\"Move backwards\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">arrow_downward</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"shiftLayer(1)\" title=\"Move forwards\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">arrow_upward</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"shiftLayer(Infinity)\" title=\"Move to front\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">vertical_align_top</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t\t<toggle v-model=\"onTop\" label=\"In front?\" />\n\t</d-fieldset>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { IObjectShiftLayerAction, IObject } from '@/store/objects';\nimport { genericSetable } from '@/util/simpleSettable';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tprops: {\n\t\tobject: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\tcomputed: {\n\t\tonTop: genericSetable<IObject>()('onTop', 'objects/setOnTop', true),\n\t},\n\tmethods: {\n\t\tshiftLayer(delta: number) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/shiftLayer', {\n\t\t\t\t\tid: this.object!.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as IObjectShiftLayerAction);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\ntable {\n\twidth: 100%;\n\n\tbutton {\n\t\twidth: 100%;\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { IObjectShiftLayerAction, IObject } from '@/store/objects';\nimport { genericSetable } from '@/util/simpleSettable';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tprops: {\n\t\tobject: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\tcomputed: {\n\t\tonTop: genericSetable<IObject>()('onTop', 'objects/setOnTop', true),\n\t},\n\tmethods: {\n\t\tshiftLayer(delta: number) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/shiftLayer', {\n\t\t\t\t\tid: this.object!.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as IObjectShiftLayerAction);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./layers.vue?vue&type=template&id=90b83fd8&scoped=true\"\nimport script from \"./layers.vue?vue&type=script&lang=ts\"\nexport * from \"./layers.vue?vue&type=script&lang=ts\"\n\nimport \"./layers.vue?vue&type=style&index=0&id=90b83fd8&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-90b83fd8\"\n\nexport default script","<template>\n\t<button @click=\"onClick\">Delete</button>\n</template>\n\n<script lang=\"ts\">\nimport { IObject, IRemoveObjectAction } from '@/store/objects';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tobj: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\n\tmethods: {\n\t\tonClick() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t} as IRemoveObjectAction);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n","\nimport { IObject, IRemoveObjectAction } from '@/store/objects';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tobj: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\n\tmethods: {\n\t\tonClick() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t} as IRemoveObjectAction);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./delete.vue?vue&type=template&id=8ad92c36\"\nimport script from \"./delete.vue?vue&type=script&lang=ts\"\nexport * from \"./delete.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n\t<color\n\t\tv-if=\"showShadowColor\"\n\t\tv-model=\"shadowColor\"\n\t\tformat=\"rgb\"\n\t\t@leave=\"showShadowColor = false\"\n\t/>\n\t<d-flow v-else no-wraping class=\"image-options-subpanel\">\n\t\t<h2>Image options</h2>\n\t\t<div class=\"column ok-col\">\n\t\t\t<button @click=\"$emit('leave')\">Back</button>\n\t\t</div>\n\t\t<div class=\"column\" v-if=\"!noComposition\">\n\t\t\t<label for=\"compositionSelect\">Compositing Mode:</label\n\t\t\t><l\n\t\t\t\tto=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation#Types\"\n\t\t\t\t>[?]</l\n\t\t\t>\n\t\t\t<select id=\"compositionSelect\" v-model=\"compositionMode\" @keydown.stop>\n\t\t\t\t<option value=\"source-over\">source-over</option>\n\t\t\t\t<!--\n\t\t\t\t<option value=\"source-in\">source-in</option>\n\t\t\t\t<option value=\"source-out\">source-out</option>\n\t\t\t\t-->\n\t\t\t\t<option value=\"source-atop\">source-atop</option>\n\t\t\t\t<option value=\"destination-over\">destination-over</option>\n\t\t\t\t<option value=\"destination-in\">destination-in</option>\n\t\t\t\t<option value=\"destination-in\">destination-out</option>\n\t\t\t\t<option value=\"destination-in\">destination-atop</option>\n\t\t\t\t<option value=\"lighter\">lighter</option>\n\t\t\t\t<option value=\"xor\">xor</option>\n\t\t\t\t<option value=\"multiply\">multiply</option>\n\t\t\t\t<option value=\"screen\">screen</option>\n\t\t\t\t<option value=\"overlay\">overlay</option>\n\t\t\t\t<option value=\"darken\">darken</option>\n\t\t\t\t<option value=\"lighten\">lighten</option>\n\t\t\t\t<option value=\"color-dodge\">color-dodge</option>\n\t\t\t\t<option value=\"color-burn\">color-burn</option>\n\t\t\t\t<option value=\"hard-light\">hard-light</option>\n\t\t\t\t<option value=\"soft-light\">soft-light</option>\n\t\t\t\t<option value=\"difference\">difference</option>\n\t\t\t\t<option value=\"exclusion\">exclusion</option>\n\t\t\t\t<option value=\"hue\">hue</option>\n\t\t\t\t<option value=\"saturation\">saturation</option>\n\t\t\t\t<option value=\"color\">color</option>\n\t\t\t\t<option value=\"luminosity\">luminosity</option>\n\t\t\t</select>\n\t\t</div>\n\t\t<d-fieldset class=\"column\" title=\"Effects\" style=\"overflow: hidden\">\n\t\t\t<d-flow class=\"filter-flow\" no-wraping gap=\"8px\">\n\t\t\t\t<d-flow direction=\"vertical\" no-wraping>\n\t\t\t\t\t<label for=\"addEffect\">Add new effect</label>\n\t\t\t\t\t<select id=\"addEffect\" v-model=\"addEffectSelection\" @keydown.stop>\n\t\t\t\t\t\t<option\n\t\t\t\t\t\t\tv-for=\"filterType of filterTypes\"\n\t\t\t\t\t\t\t:key=\"filterType\"\n\t\t\t\t\t\t\t:value=\"filterType\"\n\t\t\t\t\t\t\t>{{ getFilterLabel(filterType) }}</option\n\t\t\t\t\t\t>\n\t\t\t\t\t</select>\n\t\t\t\t\t<button\n\t\t\t\t\t\t:disabled=\"addEffectSelection === ''\"\n\t\t\t\t\t\t@click=\"addFilter\"\n\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t>\n\t\t\t\t\t\tAdd\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\t:disabled=\"!currentFilter\"\n\t\t\t\t\t\t@click=\"removeFilter\"\n\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t>\n\t\t\t\t\t\tRemove\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\t:disabled=\"currentFilterIdx === 0\"\n\t\t\t\t\t\t@click=\"moveFilter(-1)\"\n\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t>\n\t\t\t\t\t\tMove up\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\t:disabled=\"\n\t\t\t\t\t\t\tcurrentFilterIdx === filters.length - 1 || filters.length === 0\n\t\t\t\t\t\t\"\n\t\t\t\t\t\t@click=\"moveFilter(1)\"\n\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t>\n\t\t\t\t\t\tMove down\n\t\t\t\t\t</button>\n\t\t\t\t</d-flow>\n\t\t\t\t<d-flow maxSize=\"100%\" direction=\"vertical\" no-wraping>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for=\"(filter, filterIdx) in filters\"\n\t\t\t\t\t\t:key=\"filterIdx\"\n\t\t\t\t\t\t:class=\"{ choiceBtn: true, active: filterIdx === currentFilterIdx }\"\n\t\t\t\t\t\t@click=\"selectFilter(filterIdx)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ getFilterText(filter) }}\n\t\t\t\t\t</div>\n\t\t\t\t</d-flow>\n\t\t\t\t<table v-if=\"currentFilter\" class=\"value-input-table\">\n\t\t\t\t\t<template v-if=\"currentFilter.type === 'drop-shadow'\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"shadow_color\">Color:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tid=\"shadow_color\"\n\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t:style=\"{ background: shadowColor }\"\n\t\t\t\t\t\t\t\t\t@click=\"showShadowColor = true\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_x\">X:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_x\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tv-model.number=\"shadowX\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_y\">Y:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_y\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tv-model.number=\"shadowY\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_blur\">Blur:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_blur\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tv-model.number=\"shadowBlur\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"isPercentFilter\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_value\">Value:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_value\"\n\t\t\t\t\t\t\t\t\t:value=\"(currentFilter.value * 100).toFixed()\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t:max=\"maxValue\"\n\t\t\t\t\t\t\t\t\t:min=\"minValue\"\n\t\t\t\t\t\t\t\t\t@input=\"\n\t\t\t\t\t\t\t\t\t\tsetValue({ value: Number($event.target.value / 100) })\n\t\t\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>%\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-if=\"minValue === 0 && maxValue !== undefined\">\n\t\t\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t\t\t<slider\n\t\t\t\t\t\t\t\t\t:gradientStops=\"['#000000', '#ffffff']\"\n\t\t\t\t\t\t\t\t\tlabel=\"\"\n\t\t\t\t\t\t\t\t\t:maxValue=\"maxValue\"\n\t\t\t\t\t\t\t\t\t:modelValue=\"currentFilter.value * 100\"\n\t\t\t\t\t\t\t\t\tno-input\n\t\t\t\t\t\t\t\t\t@update:modelValue=\"\n\t\t\t\t\t\t\t\t\t\tsetValue({ value: Math.round($event) / 100 })\n\t\t\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_value\">Value:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_value\"\n\t\t\t\t\t\t\t\t\t:value=\"currentFilter.value\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t:max=\"maxValue\"\n\t\t\t\t\t\t\t\t\t:min=\"minValue\"\n\t\t\t\t\t\t\t\t\t@input=\"setValue({ value: Number($event.target.value) })\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-if=\"minValue === 0 && maxValue !== undefined\">\n\t\t\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t\t\t<slider\n\t\t\t\t\t\t\t\t\t:gradientStops=\"hueStops\"\n\t\t\t\t\t\t\t\t\tlabel=\"\"\n\t\t\t\t\t\t\t\t\t:maxValue=\"maxValue\"\n\t\t\t\t\t\t\t\t\t:modelValue=\"currentFilter.value\"\n\t\t\t\t\t\t\t\t\tno-input\n\t\t\t\t\t\t\t\t\t@update:modelValue=\"setValue({ value: Math.round($event) })\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<slider\n\t\t\t\t\t\t\t\t\t:gradientStops=\"hueStops\"\n\t\t\t\t\t\t\t\t\tlabel=\"\"\n\t\t\t\t\t\t\t\t\t:maxValue=\"maxValue\"\n\t\t\t\t\t\t\t\t\t:modelValue=\"currentFilter.value\"\n\t\t\t\t\t\t\t\t\tshift-gradient\n\t\t\t\t\t\t\t\t\tno-input\n\t\t\t\t\t\t\t\t\tdisabled\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</template>\n\t\t\t\t</table>\n\t\t\t</d-flow>\n\t\t</d-fieldset>\n\t</d-flow>\n</template>\n\n<script lang=\"ts\">\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport Slider from '@/components/toolbox/subtools/color/slider.vue';\nimport Color from '@/components/toolbox/subtools/color/color.vue';\nimport { defineComponent, Prop, PropType } from 'vue';\nimport { CompositeModes } from '@/renderer/rendererContext';\nimport { DeepReadonly } from '@/util/readonly';\nimport {\n\tIHasSpriteFilters,\n\tINumericSpriteFilter,\n\tpercentageValue,\n\tSpriteFilter,\n} from '@/store/sprite_options';\nimport { exhaust } from '@/util/exhaust';\nimport {\n\tIAddFilterAction,\n\tIMoveFilterAction,\n\tIRemoveFilterAction,\n\tISetCompositionMutation,\n\tISetFilterAction,\n} from '@/store/sprite_options';\nimport { IColor } from '@/util/colors/color';\nimport { HSLAColor } from '@/util/colors/hsl';\nimport L from '@/components/ui/link.vue';\n\nconst filterText: ReadonlyMap<SpriteFilter['type'], string> = new Map<\n\tSpriteFilter['type'],\n\tstring\n>([\n\t['blur', 'Blur'],\n\t['brightness', 'Brightness'],\n\t['contrast', 'Contrast'],\n\t['grayscale', 'Grayscale'],\n\t['hue-rotate', 'Rotate hue'],\n\t['invert', 'Invert colors'],\n\t['opacity', 'Opacity'],\n\t['saturate', 'Saturate'],\n\t['sepia', 'Sepia'],\n\t['drop-shadow', 'Drop shadow'],\n]);\n\nconst filters: ReadonlyArray<SpriteFilter['type']> = Array.from(\n\tfilterText.keys()\n).sort();\n\nexport default defineComponent({\n\tcomponents: { DFlow, DFieldset, Color, Slider, L },\n\tprops: {\n\t\ttype: {\n\t\t\ttype: String as PropType<'object' | 'background' | 'panel'>,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t},\n\t\tid: {\n\t\t\trequired: true,\n\t\t} as Prop<string | number>,\n\t\tnoComposition: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['leave'],\n\tdata: () => ({\n\t\taddEffectSelection: '' as SpriteFilter['type'] | '',\n\t\tcurrentFilterIdx: 0,\n\t\tshowShadowColor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): DeepReadonly<IHasSpriteFilters> {\n\t\t\tswitch (this.type) {\n\t\t\t\tcase 'object':\n\t\t\t\t\treturn this.$store.state.objects.objects[this.id!];\n\t\t\t\tcase 'background':\n\t\t\t\t\treturn this.$store.state.panels.panels[this.id!].background;\n\t\t\t\tcase 'panel':\n\t\t\t\t\treturn this.$store.state.panels.panels[this.id!];\n\t\t\t\tdefault:\n\t\t\t\t\texhaust(this.type);\n\t\t\t\t\treturn null!;\n\t\t\t}\n\t\t},\n\t\tcompositionMode: {\n\t\t\tget(): CompositeModes {\n\t\t\t\treturn this.object.composite;\n\t\t\t},\n\t\t\tset(composite: CompositeModes): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tswitch (this.type) {\n\t\t\t\t\t\tcase 'object':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setComposition', {\n\t\t\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\t\t\tcomposite,\n\t\t\t\t\t\t\t} as ISetCompositionMutation);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'background':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'panel':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\texhaust(this.type);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tfilters(): DeepReadonly<SpriteFilter[]> {\n\t\t\treturn this.object.filters;\n\t\t},\n\t\tfilterTypes(): ReadonlyArray<SpriteFilter['type']> {\n\t\t\ttry {\n\t\t\t\tconst canvas = document.createElement('canvas');\n\t\t\t\tconst context = canvas.getContext('2d')!;\n\t\t\t\tif ('filter' in context) {\n\t\t\t\t\treturn filters;\n\t\t\t\t}\n\t\t\t} catch (_e) {}\n\t\t\treturn ['opacity'];\n\t\t},\n\t\tcurrentFilter(): DeepReadonly<SpriteFilter> | null {\n\t\t\treturn this.filters[this.currentFilterIdx] || null;\n\t\t},\n\t\tisPercentFilter(): boolean {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return false;\n\t\t\treturn percentageValue.has(filter.type);\n\t\t},\n\t\tmaxValue(): number | undefined {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return undefined;\n\n\t\t\tif (filter.type === 'hue-rotate') return 360;\n\t\t\tif (\n\t\t\t\tfilter.type === 'grayscale' ||\n\t\t\t\tfilter.type === 'sepia' ||\n\t\t\t\tfilter.type === 'opacity' ||\n\t\t\t\tfilter.type === 'invert'\n\t\t\t)\n\t\t\t\treturn 100;\n\n\t\t\treturn undefined;\n\t\t},\n\t\tminValue(): number | undefined {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return undefined;\n\n\t\t\tswitch (filter.type) {\n\t\t\t\tcase 'blur':\n\t\t\t\tcase 'brightness':\n\t\t\t\tcase 'contrast':\n\t\t\t\tcase 'grayscale':\n\t\t\t\tcase 'hue-rotate':\n\t\t\t\tcase 'invert':\n\t\t\t\tcase 'opacity':\n\t\t\t\tcase 'saturate':\n\t\t\t\tcase 'sepia':\n\t\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t},\n\t\tshadowColor: {\n\t\t\tget(): string | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('color' in filter)) return undefined;\n\t\t\t\treturn filter.color;\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.setValue({ color });\n\t\t\t},\n\t\t},\n\t\tshadowX: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('offsetX' in filter)) return undefined;\n\t\t\t\treturn filter.offsetX;\n\t\t\t},\n\t\t\tset(offsetX: number) {\n\t\t\t\tthis.setValue({ offsetX });\n\t\t\t},\n\t\t},\n\t\tshadowY: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('offsetY' in filter)) return undefined;\n\t\t\t\treturn filter.offsetY;\n\t\t\t},\n\t\t\tset(offsetY: number) {\n\t\t\t\tthis.setValue({ offsetY });\n\t\t\t},\n\t\t},\n\t\tshadowBlur: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('blurRadius' in filter)) return undefined;\n\t\t\t\treturn filter.blurRadius;\n\t\t\t},\n\t\t\tset(blurRadius: number) {\n\t\t\t\tthis.setValue({ blurRadius });\n\t\t\t},\n\t\t},\n\t\thueStops(): string[] {\n\t\t\tconst stops = this.eightsStops(i => new HSLAColor(i, 1, 0.5, 1));\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t},\n\tmethods: {\n\t\tgetFilterLabel(type: SpriteFilter['type']): string {\n\t\t\treturn filterText.get(type)!;\n\t\t},\n\t\tgetFilterText(filter: SpriteFilter): string {\n\t\t\tif (percentageValue.has(filter.type)) {\n\t\t\t\treturn `${filterText.get(filter.type)} ${(\n\t\t\t\t\t(filter as INumericSpriteFilter<any>).value * 100\n\t\t\t\t).toFixed()}%`;\n\t\t\t} else if (filter.type === 'hue-rotate') {\n\t\t\t\treturn `${filterText.get(filter.type)} ${filter.value.toFixed()}°`;\n\t\t\t} else if (filter.type === 'blur') {\n\t\t\t\treturn `${filterText.get(filter.type)} ${filter.value.toFixed()}px`;\n\t\t\t}\n\t\t\treturn filterText.get(filter.type)!;\n\t\t},\n\t\tobjectTypeScope(command: string): string {\n\t\t\tswitch (this.type) {\n\t\t\t\tcase 'object':\n\t\t\t\t\treturn 'objects/' + command;\n\t\t\t\tcase 'background':\n\t\t\t\t\treturn (\n\t\t\t\t\t\t'panels/background' + command[0].toUpperCase() + command.slice(1)\n\t\t\t\t\t);\n\t\t\t\tcase 'panel':\n\t\t\t\t\treturn 'panels/' + command;\n\t\t\t}\n\t\t},\n\t\taddFilter() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('addFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\ttype: this.addEffectSelection,\n\t\t\t\t\tidx: this.currentFilterIdx + 1,\n\t\t\t\t} as IAddFilterAction);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tselectFilter(idx: number) {\n\t\t\tthis.currentFilterIdx = idx;\n\t\t},\n\t\tremoveFilter() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('removeFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t} as IRemoveFilterAction);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tmoveFilter(moveBy: number) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('moveFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t\tmoveBy,\n\t\t\t\t} as IMoveFilterAction);\n\t\t\t\tthis.currentFilterIdx += moveBy;\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tsetValue(value: Omit<ISetFilterAction, 'id' | 'idx'>) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('setFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t\t...value,\n\t\t\t\t} as ISetFilterAction);\n\t\t\t});\n\t\t},\n\t\teightsStops(gen: (i: number) => IColor): IColor[] {\n\t\t\tconst stops: IColor[] = [];\n\t\t\tfor (let i = 0; i <= 8; ++i) {\n\t\t\t\tstops.push(gen(i / 8));\n\t\t\t}\n\t\t\treturn stops;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\nh2 {\n\ttext-align: center;\n\tcolor: $default-text;\n\tcolor: var(--text);\n}\n.image-options-subpanel {\n\t&.vertical {\n\t\t.column {\n\t\t\twidth: 100%;\n\t\t\tmargin-top: 8px;\n\n\t\t\tbutton,\n\t\t\tselect {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\t}\n\n\t&.horizontal {\n\t\th2 {\n\t\t\twriting-mode: vertical-rl;\n\t\t\theight: inherit;\n\t\t\twidth: min-content;\n\t\t}\n\t\t.column {\n\t\t\tdisplay: flex;\n\t\t\t@include height-100();\n\t\t\tflex-direction: column;\n\t\t\tflex-wrap: wrap;\n\t\t\tmargin-left: 8px;\n\t\t}\n\t\t.ok-col {\n\t\t\twidth: 42px;\n\t\t\tbutton {\n\t\t\t\t@include height-100();\n\t\t\t}\n\t\t}\n\n\t\t.filter-flow {\n\t\t\t> .vertical {\n\t\t\t\twidth: auto;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.choiceBtn {\n\toverflow: hidden;\n\twidth: 100%;\n\theight: 24px;\n\ttext-overflow: ellipsis;\n\tpadding: 2px;\n\n\t&.active {\n\t\tbackground-color: $default-border;\n\t\tbackground-color: var(--border);\n\t}\n}\n\n.value-input-table {\n\ttd {\n\t\tvertical-align: top;\n\t}\n\tinput,\n\t.color-button {\n\t\twidth: 100px;\n\t}\n}\n</style>\n","<template>\n\t<div :class=\"{ slider: true, vertical }\" @keydown.stop>\n\t\t<label :for=\"_.uid\" v-if=\"!noInput\">{{ label }}</label>\n\t\t<div>\n\t\t\t<svg\n\t\t\t\tref=\"svg\"\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tviewBox=\"0 0 271 24\"\n\t\t\t\t@mousedown=\"enterSlide\"\n\t\t\t\t@touchstart=\"enterSlide\"\n\t\t\t\t@mousemove=\"moveSlide\"\n\t\t\t\t@touchmove=\"moveSlide\"\n\t\t\t\t@mouseup=\"exitSlide\"\n\t\t\t\t@touchend=\"exitSlide\"\n\t\t\t>\n\t\t\t\t<defs>\n\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t:id=\"`gradient${_.uid}`\"\n\t\t\t\t\t\t:x1=\"gradientOffset * 100 + '%'\"\n\t\t\t\t\t\ty1=\"0%\"\n\t\t\t\t\t\t:x2=\"(gradientOffset + 1) * 100 + '%'\"\n\t\t\t\t\t\ty2=\"0%\"\n\t\t\t\t\t\tspreadMethod=\"repeat\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<stop\n\t\t\t\t\t\t\tv-for=\"(color, idx) in gradientStops\"\n\t\t\t\t\t\t\t:key=\"idx\"\n\t\t\t\t\t\t\t:offset=\"(idx / (gradientStops.length - 1)) * 100 + '%'\"\n\t\t\t\t\t\t\t:style=\"'stop-color:' + color\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</linearGradient>\n\t\t\t\t</defs>\n\t\t\t\t<g>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M7 0H262V24H7z\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tpaint-order=\"fill stroke markers\"\n\t\t\t\t\t\t:fill=\"`url(#gradient${_.uid})`\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path :d=\"pointerPath\" stroke-width=\"2\" class=\"slider-pointer\" />\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t\t<input\n\t\t\t:id=\"_.uid\"\n\t\t\tclass=\"sliderInput\"\n\t\t\tmin=\"0\"\n\t\t\t:max=\"maxValue\"\n\t\t\t:value=\"modelValue\"\n\t\t\ttype=\"number\"\n\t\t\tv-if=\"!noInput\"\n\t\t\t@input=\"$emit('update:modelValue', parseFloat($event.target.value))\"\n\t\t\t@keydown.stop\n\t\t/>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, Prop } from 'vue';\n\nconst sliderLength = 255;\nconst sliderOffset = 8;\n\nexport default defineComponent({\n\tprops: {\n\t\tlabel: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tgradientStops: {\n\t\t\trequired: true,\n\t\t} as Prop<string[]>,\n\t\tmodelValue: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tmaxValue: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tshiftGradient: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tnoInput: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tslideActive: false,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tpointerPath(): string {\n\t\t\tconst val = (this.modelValue / this.maxValue) * sliderLength;\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\treturn `M${val} 0L${val + 14} 0L${val + 7} 12Z`;\n\t\t},\n\t\tgradientOffset(): number {\n\t\t\tif (!this.shiftGradient) return 0;\n\t\t\tif (this.modelValue === 0) return 0;\n\t\t\treturn this.modelValue / this.maxValue;\n\t\t},\n\t},\n\tmethods: {\n\t\tenterSlide(event: MouseEvent | TouchEvent): void {\n\t\t\tthis.slideActive = true;\n\t\t\tthis.moveSlide(event);\n\t\t},\n\t\tmoveSlide(event: MouseEvent | TouchEvent) {\n\t\t\tif (!this.slideActive) return;\n\t\t\tconst svg = this.$refs.svg as HTMLElement;\n\t\t\tif (!svg.contains(event.target as Node) && event.target !== svg) return;\n\t\t\tif (event instanceof MouseEvent && event.which !== 1) {\n\t\t\t\tthis.slideActive = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst bounding = svg.getBoundingClientRect();\n\t\t\tconst scale =\n\t\t\t\tbounding.width / (sliderOffset + sliderLength + sliderOffset);\n\t\t\tconst x =\n\t\t\t\t(event instanceof MouseEvent\n\t\t\t\t\t? event.clientX\n\t\t\t\t\t: event.touches[0].clientX) - bounding.x;\n\t\t\tconst scaledX = x / scale;\n\t\t\tevent.preventDefault();\n\t\t\tconst value =\n\t\t\t\t(Math.max(Math.min(scaledX - sliderOffset, sliderLength), 0) /\n\t\t\t\t\tsliderLength) *\n\t\t\t\tthis.maxValue;\n\t\t\tthis.$emit('update:modelValue', value);\n\t\t},\n\t\texitSlide() {\n\t\t\tthis.slideActive = false;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.slider {\n\tdisplay: table;\n\tlabel {\n\t\ttext-align: right;\n\t\twidth: 100px;\n\t}\n\n\tinput {\n\t\twidth: 52px;\n\t}\n\n\t&.vertical {\n\t\tsvg {\n\t\t\twidth: 100%;\n\t\t\theight: 24px;\n\t\t}\n\n\t\t> * {\n\t\t\tdisplay: table-row;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\tsvg {\n\t\t\twidth: 271px;\n\t\t\theight: 24px;\n\t\t}\n\n\t\t> * {\n\t\t\tdisplay: table-cell;\n\t\t\tvertical-align: middle;\n\t\t}\n\t}\n}\n\nsvg g {\n\tstroke: $default-border;\n\tstroke: var(--border);\n\n\t.slider-pointer {\n\t\tfill: $default-text;\n\t\tfill: var(--text);\n\t}\n}\n</style>\n","\nimport { defineComponent, Prop } from 'vue';\n\nconst sliderLength = 255;\nconst sliderOffset = 8;\n\nexport default defineComponent({\n\tprops: {\n\t\tlabel: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tgradientStops: {\n\t\t\trequired: true,\n\t\t} as Prop<string[]>,\n\t\tmodelValue: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tmaxValue: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tshiftGradient: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tnoInput: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tslideActive: false,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tpointerPath(): string {\n\t\t\tconst val = (this.modelValue / this.maxValue) * sliderLength;\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\treturn `M${val} 0L${val + 14} 0L${val + 7} 12Z`;\n\t\t},\n\t\tgradientOffset(): number {\n\t\t\tif (!this.shiftGradient) return 0;\n\t\t\tif (this.modelValue === 0) return 0;\n\t\t\treturn this.modelValue / this.maxValue;\n\t\t},\n\t},\n\tmethods: {\n\t\tenterSlide(event: MouseEvent | TouchEvent): void {\n\t\t\tthis.slideActive = true;\n\t\t\tthis.moveSlide(event);\n\t\t},\n\t\tmoveSlide(event: MouseEvent | TouchEvent) {\n\t\t\tif (!this.slideActive) return;\n\t\t\tconst svg = this.$refs.svg as HTMLElement;\n\t\t\tif (!svg.contains(event.target as Node) && event.target !== svg) return;\n\t\t\tif (event instanceof MouseEvent && event.which !== 1) {\n\t\t\t\tthis.slideActive = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst bounding = svg.getBoundingClientRect();\n\t\t\tconst scale =\n\t\t\t\tbounding.width / (sliderOffset + sliderLength + sliderOffset);\n\t\t\tconst x =\n\t\t\t\t(event instanceof MouseEvent\n\t\t\t\t\t? event.clientX\n\t\t\t\t\t: event.touches[0].clientX) - bounding.x;\n\t\t\tconst scaledX = x / scale;\n\t\t\tevent.preventDefault();\n\t\t\tconst value =\n\t\t\t\t(Math.max(Math.min(scaledX - sliderOffset, sliderLength), 0) /\n\t\t\t\t\tsliderLength) *\n\t\t\t\tthis.maxValue;\n\t\t\tthis.$emit('update:modelValue', value);\n\t\t},\n\t\texitSlide() {\n\t\t\tthis.slideActive = false;\n\t\t},\n\t},\n});\n","import { render } from \"./slider.vue?vue&type=template&id=f14035dc&scoped=true\"\nimport script from \"./slider.vue?vue&type=script&lang=ts\"\nexport * from \"./slider.vue?vue&type=script&lang=ts\"\n\nimport \"./slider.vue?vue&type=style&index=0&id=f14035dc&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-f14035dc\"\n\nexport default script","<template>\n\t<div :class=\"{ color: true, vertical }\">\n\t\t<h2>{{ title }}</h2>\n\t\t<button @click=\"$emit('leave')\">OK</button>\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td>\n\t\t\t\t\t<button @click=\"mode = 'hsla'\">HSLA</button>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<button @click=\"mode = 'rgba'\">RGBA</button>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\n\t\t<div class=\"column\">\n\t\t\t<slider-group :mode=\"mode\" v-model=\"color\" :relative=\"true\" />\n\t\t\t<div class=\"hex-selector\">\n\t\t\t\t<label class=\"hex-label\" :for=\"`hex_${_.uid}`\">Hex</label>\n\t\t\t\t<input\n\t\t\t\t\t:id=\"`hex_${_.uid}`\"\n\t\t\t\t\t:value=\"color\"\n\t\t\t\t\t@input=\"updateHex\"\n\t\t\t\t\t@keydown.stop\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<button @click=\"addSwatch\">Add as swatch</button>\n\t\t\t<d-button icon=\"colorize\" @click=\"pickColor\">Pick color</d-button>\n\t\t</div>\n\t\t<div id=\"color-swatches\" :class=\"{ vertical }\">\n\t\t\t<button\n\t\t\t\tv-for=\"swatch of swatches\"\n\t\t\t\tclass=\"swatch\"\n\t\t\t\t:key=\"swatch.color\"\n\t\t\t\t:style=\"{ backgroundColor: swatch.color }\"\n\t\t\t\t:title=\"swatch.label\"\n\t\t\t\t@click=\"\n\t\t\t\t\tcolor = swatch.color;\n\t\t\t\t\t$emit('leave');\n\t\t\t\t\"\n\t\t\t></button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport {\n\tColor,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport SliderGroup from './sliderGroup.vue';\nimport DButton from '../../../ui/d-button.vue';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { defineComponent, PropType } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\nimport eventBus, { ColorPickedEvent } from '@/eventbus/event-bus';\n\nconst generatedPackId = 'dddg.generated.colors';\n\nexport default defineComponent({\n\tcomponents: {\n\t\tSliderGroup,\n\t\tDButton,\n\t},\n\tinheritAttrs: false,\n\temits: ['leave', 'update:modelValue'],\n\tprops: {\n\t\tmodelValue: {\n\t\t\trequired: true,\n\t\t\ttype: String,\n\t\t},\n\t\ttitle: { default: '' },\n\t\tformat: {\n\t\t\ttype: String as PropType<'rgb' | 'hex'>,\n\t\t\tdefault: 'hex',\n\t\t},\n\t},\n\tdata: () => ({\n\t\tmode: 'hsla',\n\t\trelative: true,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tswatches(): DeepReadonly<Color[]> {\n\t\t\treturn this.$store.state.content.current.colors;\n\t\t},\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\tif (this.format === 'rgb') {\n\t\t\t\t\tconst rgb = RGBAColor.fromCss(this.modelValue);\n\t\t\t\t\treturn rgb.toHex();\n\t\t\t\t} else {\n\t\t\t\t\treturn this.modelValue;\n\t\t\t\t}\n\t\t\t},\n\t\t\tset(newColor: string) {\n\t\t\t\tif (this.format === 'rgb') {\n\t\t\t\t\tconst rgb = RGBAColor.fromCss(newColor);\n\t\t\t\t\tthis.$emit('update:modelValue', rgb.toCss());\n\t\t\t\t} else {\n\t\t\t\t\tthis.$emit('update:modelValue', newColor);\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n\tmounted() {\n\t\teventBus.subscribe(ColorPickedEvent, this.settingColor);\n\t},\n\tunmounted() {\n\t\teventBus.unsubscribe(ColorPickedEvent, this.settingColor);\n\t},\n\tmethods: {\n\t\tsettingColor(ev: ColorPickedEvent) {\n\t\t\tthis.color = RGBAColor.fromCss(ev.color).toHex();\n\t\t},\n\t\tupdateHex(event: Event) {\n\t\t\tconst hex = (event.target as HTMLInputElement).value;\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\tif (RGBAColor.validHex(hex) && (hex.length === 7 || hex.length === 9)) {\n\t\t\t\tthis.color = hex;\n\t\t\t}\n\t\t},\n\t\taddSwatch() {\n\t\t\tif (this.swatches.find(swatch => swatch.color === this.color)) return;\n\n\t\t\tconst existingPack = this.$store.state.content.contentPacks.find(\n\t\t\t\tpack => pack.packId === 'generatedPackId'\n\t\t\t) || {\n\t\t\t\tpackId: generatedPackId,\n\t\t\t\tpackCredits: [''],\n\t\t\t\tdependencies: [],\n\t\t\t\tcharacters: [],\n\t\t\t\tfonts: [],\n\t\t\t\tbackgrounds: [],\n\t\t\t\tsprites: [],\n\t\t\t\tpoemStyles: [],\n\t\t\t\tpoemBackgrounds: [],\n\t\t\t\tcolors: [],\n\t\t\t};\n\n\t\t\tconst newPack: ContentPack<IAsset> = {\n\t\t\t\t...existingPack,\n\t\t\t\tcolors: [\n\t\t\t\t\t...existingPack.colors,\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: this.color,\n\t\t\t\t\t\tcolor: this.color,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t} as any;\n\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: newPack,\n\t\t\t\t\tprocessed: true,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t});\n\t\t},\n\t\tpickColor(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.commit('ui/setColorPicker', true);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.color {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\n\th2 {\n\t\tfont-size: 20px;\n\t\tcolor: $default-text;\n\t\tcolor: var(--text);\n\t\tfont-family: riffic, sans-serif;\n\t\ttext-align: center;\n\t}\n\n\t&.vertical {\n\t\tflex-direction: row;\n\t\twidth: 100%;\n\n\t\t.column {\n\t\t\twidth: 100%;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\tflex-direction: column;\n\t\t@include height-100();\n\n\t\th2 {\n\t\t\twriting-mode: vertical-rl;\n\t\t\theight: inherit;\n\t\t\twidth: min-content;\n\t\t}\n\n\t\t.column {\n\t\t\t@include height-100();\n\t\t}\n\t}\n}\n\n.hex-selector {\n\tdisplay: table;\n\tlabel {\n\t\ttext-align: right;\n\t\twidth: 100px;\n\t}\n\n\tinput {\n\t\tmargin-left: 7px;\n\t}\n\n\t&.vertical {\n\t\t> * {\n\t\t\tdisplay: table-row;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t> * {\n\t\t\tdisplay: table-cell;\n\t\t\tvertical-align: middle;\n\t\t}\n\t}\n}\n\n#color-swatches {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: space-evenly;\n\n\t&.vertical {\n\t\tmargin-top: 4px;\n\t\twidth: 100%;\n\t\tflex-direction: row;\n\t}\n\n\t&:not(.vertical) {\n\t\tmargin-left: 4px;\n\t\t@include height-100();\n\t\tflex-direction: column;\n\t}\n\n\t.swatch {\n\t\theight: 42px;\n\t\twidth: 42px;\n\t\tmargin: 1px;\n\t\tborder-color: black;\n\t}\n}\n</style>\n","<template>\n\t<div>\n\t\t<slider\n\t\t\t:label=\"label1\"\n\t\t\tv-model=\"v1\"\n\t\t\t:max-value=\"maxValue1\"\n\t\t\t:gradient-stops=\"stops1\"\n\t\t/>\n\t\t<slider\n\t\t\t:label=\"label2\"\n\t\t\tv-model=\"v2\"\n\t\t\t:max-value=\"maxValue2\"\n\t\t\t:gradient-stops=\"stops2\"\n\t\t/>\n\t\t<slider\n\t\t\t:label=\"label3\"\n\t\t\tv-model=\"v3\"\n\t\t\t:max-value=\"maxValue3\"\n\t\t\t:gradient-stops=\"stops3\"\n\t\t/>\n\t\t<slider\n\t\t\tlabel=\"Alpha\"\n\t\t\tv-model=\"a\"\n\t\t\t:max-value=\"255\"\n\t\t\t:gradient-stops=\"stopsAlpha\"\n\t\t/>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { IColor } from '@/util/colors/color';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { HSLAColor } from '@/util/colors/hsl';\nimport Slider from './slider.vue';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Slider },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\tvalidator: (val: string): boolean => !!val.match(/^#[0-9a-f]{6,8}$/i),\n\t\t},\n\t\tmode: {\n\t\t\ttype: String,\n\t\t} as Prop<'hsla' | 'rgba'>,\n\t\trelative: Boolean,\n\t},\n\tdata: () => ({\n\t\tlastRGBEmit: null as string | null,\n\t\tv1: 0,\n\t\tv2: 0,\n\t\tv3: 0,\n\t\ta: 0,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tmaxValue1(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 360;\n\t\t},\n\t\tlabel1(): string {\n\t\t\tif (this.mode === 'rgba') return 'Red';\n\t\t\treturn 'Hue';\n\t\t},\n\t\tstops1(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst g = this.relative ? this.v2 : 0;\n\t\t\t\tconst b = this.relative ? this.v3 : 0;\n\t\t\t\tstops = [new RGBAColor(0, g, b, 1), new RGBAColor(255, g, b, 1)];\n\t\t\t} else {\n\t\t\t\tconst s = this.relative ? this.v2 / 100 : 1;\n\t\t\t\tconst l = this.relative ? this.v3 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(i, s, l, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tmaxValue2(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 100;\n\t\t},\n\t\tlabel2(): string {\n\t\t\tif (this.mode === 'rgba') return 'Green';\n\t\t\treturn 'Saturation';\n\t\t},\n\t\tstops2(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst r = this.relative ? this.v1 : 0;\n\t\t\t\tconst b = this.relative ? this.v3 : 0;\n\t\t\t\tstops = [new RGBAColor(r, 0, b, 1), new RGBAColor(r, 255, b, 1)];\n\t\t\t} else {\n\t\t\t\tconst h = this.relative ? this.v1 / 360 : 0;\n\t\t\t\tconst l = this.relative ? this.v3 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(h, i, l, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tmaxValue3(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 100;\n\t\t},\n\t\tlabel3(): string {\n\t\t\tif (this.mode === 'rgba') return 'Blue';\n\t\t\treturn 'Luminosity';\n\t\t},\n\t\tstops3(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst r = this.relative ? this.v1 : 0;\n\t\t\t\tconst g = this.relative ? this.v2 : 0;\n\t\t\t\tstops = [new RGBAColor(r, g, 0, 1), new RGBAColor(r, g, 255, 1)];\n\t\t\t} else {\n\t\t\t\tconst h = this.relative ? this.v1 / 360 : 0;\n\t\t\t\tconst s = this.relative ? this.v2 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(h, s, i, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tstopsAlpha(): string[] {\n\t\t\tconst color = RGBAColor.fromHex(this.modelValue!);\n\t\t\treturn [\n\t\t\t\tnew RGBAColor(color.r, color.g, color.b, 0).toCss(),\n\t\t\t\tnew RGBAColor(color.r, color.g, color.b, 1).toCss(),\n\t\t\t];\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.initValues();\n\t},\n\tmethods: {\n\t\tvalueChanged() {\n\t\t\tif (this.modelValue === this.lastRGBEmit) return;\n\t\t\tthis.initValues();\n\t\t},\n\t\tupdateValue() {\n\t\t\tlet newColor: IColor;\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tnewColor = new RGBAColor(this.v1, this.v2, this.v3, this.a / 255);\n\t\t\t} else {\n\t\t\t\tnewColor = new HSLAColor(\n\t\t\t\t\tthis.v1 / 360,\n\t\t\t\t\tthis.v2 / 100,\n\t\t\t\t\tthis.v3 / 100,\n\t\t\t\t\tthis.a / 255\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst rgbColor = newColor.toRgb().toHex();\n\t\t\tif (this.lastRGBEmit === rgbColor) return;\n\t\t\tif (rgbColor.length !== 9) {\n\t\t\t\tthrow new Error(`Invalid color code: ${rgbColor}`);\n\t\t\t}\n\t\t\tthis.lastRGBEmit = rgbColor;\n\t\t\tthis.$emit('update:modelValue', rgbColor);\n\t\t},\n\t\tinitValues() {\n\t\t\tconst color = RGBAColor.fromHex(this.modelValue!);\n\t\t\tthis.lastRGBEmit = color.toHex();\n\t\t\tthis.a = color.a * 255;\n\t\t\tif (this.mode === 'hsla') {\n\t\t\t\tconst hslColor = color.toHSL();\n\t\t\t\tthis.v1 = hslColor.h * 360;\n\t\t\t\tthis.v2 = hslColor.s * 100;\n\t\t\t\tthis.v3 = hslColor.l * 100;\n\t\t\t} else {\n\t\t\t\tthis.v1 = color.r;\n\t\t\t\tthis.v2 = color.g;\n\t\t\t\tthis.v3 = color.b;\n\t\t\t}\n\t\t},\n\t\teightsStops(gen: (i: number) => IColor): IColor[] {\n\t\t\tconst stops: IColor[] = [];\n\t\t\tfor (let i = 0; i <= 8; ++i) {\n\t\t\t\tstops.push(gen(i / 8));\n\t\t\t}\n\t\t\treturn stops;\n\t\t},\n\t},\n\twatch: {\n\t\tvalue() {\n\t\t\tthis.valueChanged();\n\t\t},\n\t\tv1() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tv2() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tv3() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\ta() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tmode() {\n\t\t\tthis.initValues();\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.slider {\n\tdisplay: table;\n\tlabel {\n\t\ttext-align: right;\n\t\twidth: 100px;\n\t}\n\n\tinput {\n\t\twidth: 52px;\n\t}\n\n\t&.vertical {\n\t\t> * {\n\t\t\tdisplay: table-row;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t> * {\n\t\t\tdisplay: table-cell;\n\t\t\tvertical-align: middle;\n\t\t}\n\t}\n}\n</style>\n","import { IColor } from './color';\nimport { RGBAColor } from './rgb';\n\n// tslint:disable: no-magic-numbers\nexport class HSLAColor implements IColor {\n\tpublic constructor(\n\t\tpublic readonly h: number,\n\t\tpublic readonly s: number,\n\t\tpublic readonly l: number,\n\t\tpublic readonly a: number\n\t) {\n\t\tObject.freeze(this);\n\t}\n\n\tpublic toCss(): string {\n\t\tif (this.a >= 1) {\n\t\t\treturn `hsl(${this.h}, ${this.s}, ${this.l})`;\n\t\t}\n\t\treturn `hsla(${this.h}, ${this.s}, ${this.l}, ${this.a})`;\n\t}\n\n\tpublic shift(deltas: HSLAColor): HSLAColor {\n\t\tlet { h, s, l, a } = this;\n\t\th += deltas.h;\n\t\tif (h >= 1) {\n\t\t\th -= 1;\n\t\t} else if (h < 0) {\n\t\t\th += 1;\n\t\t}\n\t\tif (s + deltas.s > 1) {\n\t\t\ts -= deltas.s;\n\t\t} else {\n\t\t\ts += deltas.s;\n\t\t\tif (s < 0) {\n\t\t\t\ts = 0;\n\t\t\t}\n\t\t}\n\t\tif (l + deltas.l > 1 || l + deltas.l < 0) {\n\t\t\tl -= deltas.l;\n\t\t} else {\n\t\t\tl += deltas.l;\n\t\t}\n\t\tif (a + deltas.a > 1 || a + deltas.a < 0) {\n\t\t\ta -= deltas.a;\n\t\t} else {\n\t\t\ta += deltas.a;\n\t\t}\n\t\treturn new HSLAColor(h, s, l, a);\n\t}\n\n\tpublic toRgb(): RGBAColor {\n\t\tconst { h, s, l, a } = this;\n\t\tlet r: number;\n\t\tlet g: number;\n\t\tlet b: number;\n\n\t\tif (s === 0) {\n\t\t\tr = g = b = l; // achromatic\n\t\t} else {\n\t\t\tconst q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n\t\t\tconst p = 2 * l - q;\n\t\t\tr = this.hue2rgb(p, q, h + 1 / 3);\n\t\t\tg = this.hue2rgb(p, q, h);\n\t\t\tb = this.hue2rgb(p, q, h - 1 / 3);\n\t\t}\n\n\t\treturn new RGBAColor(\n\t\t\tMath.round(r * 255),\n\t\t\tMath.round(g * 255),\n\t\t\tMath.round(b * 255),\n\t\t\ta\n\t\t);\n\t}\n\n\tpublic toHSL(): HSLAColor {\n\t\treturn this;\n\t}\n\n\tprivate hue2rgb(p: number, q: number, t: number) {\n\t\tif (t < 0) t += 1;\n\t\tif (t > 1) t -= 1;\n\t\tif (t < 1 / 6) return p + (q - p) * 6 * t;\n\t\tif (t < 1 / 2) return q;\n\t\tif (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n\t\treturn p;\n\t}\n}\n","import { HSLAColor } from './hsl';\n\n// tslint:disable: no-magic-numbers\nexport class RGBAColor {\n\tpublic static validCss(str: string): boolean {\n\t\treturn this.validCssRgb(str) || this.validHex(str);\n\t}\n\n\tpublic static fromCss(str: string): RGBAColor {\n\t\tif (this.validCssRgb(str)) {\n\t\t\treturn this.fromCssRgb(str);\n\t\t}\n\t\tif (this.validHex(str)) {\n\t\t\treturn this.fromHex(str);\n\t\t}\n\t\tthrow new Error('Invalid RGB color format');\n\t}\n\n\tpublic static validCssRgb(str: string): boolean {\n\t\treturn this.rgbEx.test(str) || this.rgbaEx.test(str);\n\t}\n\n\tpublic static fromCssRgb(str: string): RGBAColor {\n\t\tif (!this.validCssRgb(str)) throw new Error('Invalid RGB color format');\n\t\tconst rgbHead = str.slice(0, -1);\n\t\tconst parentesisPos = rgbHead.indexOf('(');\n\t\tconst rbgTail = rgbHead.slice(parentesisPos + 1);\n\t\tconst elements = rbgTail.split(',').map(x => parseFloat(x.trim()));\n\t\treturn new RGBAColor(\n\t\t\telements[0],\n\t\t\telements[1],\n\t\t\telements[2],\n\t\t\telements.length === 4 ? elements[3] : 1\n\t\t);\n\t}\n\n\tpublic static validHex(str: string): boolean {\n\t\treturn this.hexShortEx.test(str) || this.hexLongEx.test(str);\n\t}\n\n\tpublic static fromHex(str: string): RGBAColor {\n\t\tif (!this.validHex(str)) throw new Error('Invalid Hex color format');\n\t\tconst hexTail = str.slice(1);\n\t\tif (hexTail.length === 3) {\n\t\t\treturn new RGBAColor(\n\t\t\t\tparseInt(hexTail[0] + hexTail[0], 16),\n\t\t\t\tparseInt(hexTail[1] + hexTail[1], 16),\n\t\t\t\tparseInt(hexTail[2] + hexTail[2], 16),\n\t\t\t\t1\n\t\t\t);\n\t\t}\n\t\tif (hexTail.length === 4) {\n\t\t\treturn new RGBAColor(\n\t\t\t\tparseInt(hexTail[0] + hexTail[0], 16),\n\t\t\t\tparseInt(hexTail[1] + hexTail[1], 16),\n\t\t\t\tparseInt(hexTail[2] + hexTail[2], 16),\n\t\t\t\tparseInt(hexTail[3] + hexTail[3], 16) / 255\n\t\t\t);\n\t\t}\n\t\tif (hexTail.length === 6) {\n\t\t\treturn new RGBAColor(\n\t\t\t\tparseInt(hexTail[0] + hexTail[1], 16),\n\t\t\t\tparseInt(hexTail[2] + hexTail[3], 16),\n\t\t\t\tparseInt(hexTail[4] + hexTail[5], 16),\n\t\t\t\t1\n\t\t\t);\n\t\t}\n\t\tif (hexTail.length === 8) {\n\t\t\treturn new RGBAColor(\n\t\t\t\tparseInt(hexTail[0] + hexTail[1], 16),\n\t\t\t\tparseInt(hexTail[2] + hexTail[3], 16),\n\t\t\t\tparseInt(hexTail[4] + hexTail[5], 16),\n\t\t\t\tparseInt(hexTail[6] + hexTail[7], 16) / 255\n\t\t\t);\n\t\t}\n\t\tthrow new Error('Invalid Hex color format length');\n\t}\n\n\tprivate static rgbEx = /^rgb\\((\\d*?),(\\d*?),(\\d*?)\\)$/i;\n\tprivate static rgbaEx = /^rgba\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3}),([\\d.]+)\\)$/i;\n\tprivate static hexShortEx = /^#[0-9A-Z]{3,4}$/i;\n\tprivate static hexLongEx = /^#[0-9A-Z]{6,8}$/i;\n\n\tpublic constructor(\n\t\tpublic readonly r: number,\n\t\tpublic readonly g: number,\n\t\tpublic readonly b: number,\n\t\tpublic readonly a: number\n\t) {}\n\n\tpublic toCss(): string {\n\t\tif (this.a > 1) {\n\t\t\treturn `rgb(${this.r},${this.g},${this.b})`;\n\t\t}\n\t\treturn `rgba(${this.r},${this.g},${this.b},${this.a})`;\n\t}\n\n\tpublic toHex(): string {\n\t\treturn `#${Math.round(this.r)\n\t\t\t.toString(16)\n\t\t\t.padStart(2, '0')}${Math.round(this.g)\n\t\t\t.toString(16)\n\t\t\t.padStart(2, '0')}${Math.round(this.b)\n\t\t\t.toString(16)\n\t\t\t.padStart(2, '0')}${Math.round(this.a * 255)\n\t\t\t.toString(16)\n\t\t\t.padStart(2, '0')}`;\n\t}\n\n\tpublic toRgb(): RGBAColor {\n\t\treturn this;\n\t}\n\n\tpublic toHSL(): HSLAColor {\n\t\tlet { r, g, b } = this;\n\t\tconst { a } = this;\n\t\t(r /= 255), (g /= 255), (b /= 255);\n\t\tconst max = Math.max(r, g, b);\n\t\tconst min = Math.min(r, g, b);\n\t\tlet h: number;\n\t\tlet s: number;\n\t\tconst l: number = (max + min) / 2;\n\n\t\tif (max === min) {\n\t\t\th = s = 0; // achromatic\n\t\t} else {\n\t\t\tconst d = max - min;\n\t\t\ts = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\t\t\tswitch (max) {\n\t\t\t\tcase r:\n\t\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase g:\n\t\t\t\t\th = (b - r) / d + 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase b:\n\t\t\t\t\th = (r - g) / d + 4;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\th! /= 6;\n\t\t}\n\n\t\treturn new HSLAColor(h!, s, l, a);\n\t}\n\n\tpublic get luminance(): number {\n\t\treturn Math.sqrt(\n\t\t\tMath.pow(0.299 * (this.r / 255), 2) +\n\t\t\t\tMath.pow(0.587 * (this.g / 255), 2) +\n\t\t\t\tMath.pow(0.114 * (this.b / 255), 2)\n\t\t);\n\t}\n}\n","\nimport { IColor } from '@/util/colors/color';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { HSLAColor } from '@/util/colors/hsl';\nimport Slider from './slider.vue';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Slider },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\tvalidator: (val: string): boolean => !!val.match(/^#[0-9a-f]{6,8}$/i),\n\t\t},\n\t\tmode: {\n\t\t\ttype: String,\n\t\t} as Prop<'hsla' | 'rgba'>,\n\t\trelative: Boolean,\n\t},\n\tdata: () => ({\n\t\tlastRGBEmit: null as string | null,\n\t\tv1: 0,\n\t\tv2: 0,\n\t\tv3: 0,\n\t\ta: 0,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tmaxValue1(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 360;\n\t\t},\n\t\tlabel1(): string {\n\t\t\tif (this.mode === 'rgba') return 'Red';\n\t\t\treturn 'Hue';\n\t\t},\n\t\tstops1(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst g = this.relative ? this.v2 : 0;\n\t\t\t\tconst b = this.relative ? this.v3 : 0;\n\t\t\t\tstops = [new RGBAColor(0, g, b, 1), new RGBAColor(255, g, b, 1)];\n\t\t\t} else {\n\t\t\t\tconst s = this.relative ? this.v2 / 100 : 1;\n\t\t\t\tconst l = this.relative ? this.v3 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(i, s, l, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tmaxValue2(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 100;\n\t\t},\n\t\tlabel2(): string {\n\t\t\tif (this.mode === 'rgba') return 'Green';\n\t\t\treturn 'Saturation';\n\t\t},\n\t\tstops2(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst r = this.relative ? this.v1 : 0;\n\t\t\t\tconst b = this.relative ? this.v3 : 0;\n\t\t\t\tstops = [new RGBAColor(r, 0, b, 1), new RGBAColor(r, 255, b, 1)];\n\t\t\t} else {\n\t\t\t\tconst h = this.relative ? this.v1 / 360 : 0;\n\t\t\t\tconst l = this.relative ? this.v3 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(h, i, l, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tmaxValue3(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 100;\n\t\t},\n\t\tlabel3(): string {\n\t\t\tif (this.mode === 'rgba') return 'Blue';\n\t\t\treturn 'Luminosity';\n\t\t},\n\t\tstops3(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst r = this.relative ? this.v1 : 0;\n\t\t\t\tconst g = this.relative ? this.v2 : 0;\n\t\t\t\tstops = [new RGBAColor(r, g, 0, 1), new RGBAColor(r, g, 255, 1)];\n\t\t\t} else {\n\t\t\t\tconst h = this.relative ? this.v1 / 360 : 0;\n\t\t\t\tconst s = this.relative ? this.v2 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(h, s, i, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tstopsAlpha(): string[] {\n\t\t\tconst color = RGBAColor.fromHex(this.modelValue!);\n\t\t\treturn [\n\t\t\t\tnew RGBAColor(color.r, color.g, color.b, 0).toCss(),\n\t\t\t\tnew RGBAColor(color.r, color.g, color.b, 1).toCss(),\n\t\t\t];\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.initValues();\n\t},\n\tmethods: {\n\t\tvalueChanged() {\n\t\t\tif (this.modelValue === this.lastRGBEmit) return;\n\t\t\tthis.initValues();\n\t\t},\n\t\tupdateValue() {\n\t\t\tlet newColor: IColor;\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tnewColor = new RGBAColor(this.v1, this.v2, this.v3, this.a / 255);\n\t\t\t} else {\n\t\t\t\tnewColor = new HSLAColor(\n\t\t\t\t\tthis.v1 / 360,\n\t\t\t\t\tthis.v2 / 100,\n\t\t\t\t\tthis.v3 / 100,\n\t\t\t\t\tthis.a / 255\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst rgbColor = newColor.toRgb().toHex();\n\t\t\tif (this.lastRGBEmit === rgbColor) return;\n\t\t\tif (rgbColor.length !== 9) {\n\t\t\t\tthrow new Error(`Invalid color code: ${rgbColor}`);\n\t\t\t}\n\t\t\tthis.lastRGBEmit = rgbColor;\n\t\t\tthis.$emit('update:modelValue', rgbColor);\n\t\t},\n\t\tinitValues() {\n\t\t\tconst color = RGBAColor.fromHex(this.modelValue!);\n\t\t\tthis.lastRGBEmit = color.toHex();\n\t\t\tthis.a = color.a * 255;\n\t\t\tif (this.mode === 'hsla') {\n\t\t\t\tconst hslColor = color.toHSL();\n\t\t\t\tthis.v1 = hslColor.h * 360;\n\t\t\t\tthis.v2 = hslColor.s * 100;\n\t\t\t\tthis.v3 = hslColor.l * 100;\n\t\t\t} else {\n\t\t\t\tthis.v1 = color.r;\n\t\t\t\tthis.v2 = color.g;\n\t\t\t\tthis.v3 = color.b;\n\t\t\t}\n\t\t},\n\t\teightsStops(gen: (i: number) => IColor): IColor[] {\n\t\t\tconst stops: IColor[] = [];\n\t\t\tfor (let i = 0; i <= 8; ++i) {\n\t\t\t\tstops.push(gen(i / 8));\n\t\t\t}\n\t\t\treturn stops;\n\t\t},\n\t},\n\twatch: {\n\t\tvalue() {\n\t\t\tthis.valueChanged();\n\t\t},\n\t\tv1() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tv2() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tv3() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\ta() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tmode() {\n\t\t\tthis.initValues();\n\t\t},\n\t},\n});\n","import { render } from \"./sliderGroup.vue?vue&type=template&id=24b7dbc3&scoped=true\"\nimport script from \"./sliderGroup.vue?vue&type=script&lang=ts\"\nexport * from \"./sliderGroup.vue?vue&type=script&lang=ts\"\n\nimport \"./sliderGroup.vue?vue&type=style&index=0&id=24b7dbc3&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-24b7dbc3\"\n\nexport default script","\nimport {\n\tColor,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport SliderGroup from './sliderGroup.vue';\nimport DButton from '../../../ui/d-button.vue';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { defineComponent, PropType } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\nimport eventBus, { ColorPickedEvent } from '@/eventbus/event-bus';\n\nconst generatedPackId = 'dddg.generated.colors';\n\nexport default defineComponent({\n\tcomponents: {\n\t\tSliderGroup,\n\t\tDButton,\n\t},\n\tinheritAttrs: false,\n\temits: ['leave', 'update:modelValue'],\n\tprops: {\n\t\tmodelValue: {\n\t\t\trequired: true,\n\t\t\ttype: String,\n\t\t},\n\t\ttitle: { default: '' },\n\t\tformat: {\n\t\t\ttype: String as PropType<'rgb' | 'hex'>,\n\t\t\tdefault: 'hex',\n\t\t},\n\t},\n\tdata: () => ({\n\t\tmode: 'hsla',\n\t\trelative: true,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tswatches(): DeepReadonly<Color[]> {\n\t\t\treturn this.$store.state.content.current.colors;\n\t\t},\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\tif (this.format === 'rgb') {\n\t\t\t\t\tconst rgb = RGBAColor.fromCss(this.modelValue);\n\t\t\t\t\treturn rgb.toHex();\n\t\t\t\t} else {\n\t\t\t\t\treturn this.modelValue;\n\t\t\t\t}\n\t\t\t},\n\t\t\tset(newColor: string) {\n\t\t\t\tif (this.format === 'rgb') {\n\t\t\t\t\tconst rgb = RGBAColor.fromCss(newColor);\n\t\t\t\t\tthis.$emit('update:modelValue', rgb.toCss());\n\t\t\t\t} else {\n\t\t\t\t\tthis.$emit('update:modelValue', newColor);\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n\tmounted() {\n\t\teventBus.subscribe(ColorPickedEvent, this.settingColor);\n\t},\n\tunmounted() {\n\t\teventBus.unsubscribe(ColorPickedEvent, this.settingColor);\n\t},\n\tmethods: {\n\t\tsettingColor(ev: ColorPickedEvent) {\n\t\t\tthis.color = RGBAColor.fromCss(ev.color).toHex();\n\t\t},\n\t\tupdateHex(event: Event) {\n\t\t\tconst hex = (event.target as HTMLInputElement).value;\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\tif (RGBAColor.validHex(hex) && (hex.length === 7 || hex.length === 9)) {\n\t\t\t\tthis.color = hex;\n\t\t\t}\n\t\t},\n\t\taddSwatch() {\n\t\t\tif (this.swatches.find(swatch => swatch.color === this.color)) return;\n\n\t\t\tconst existingPack = this.$store.state.content.contentPacks.find(\n\t\t\t\tpack => pack.packId === 'generatedPackId'\n\t\t\t) || {\n\t\t\t\tpackId: generatedPackId,\n\t\t\t\tpackCredits: [''],\n\t\t\t\tdependencies: [],\n\t\t\t\tcharacters: [],\n\t\t\t\tfonts: [],\n\t\t\t\tbackgrounds: [],\n\t\t\t\tsprites: [],\n\t\t\t\tpoemStyles: [],\n\t\t\t\tpoemBackgrounds: [],\n\t\t\t\tcolors: [],\n\t\t\t};\n\n\t\t\tconst newPack: ContentPack<IAsset> = {\n\t\t\t\t...existingPack,\n\t\t\t\tcolors: [\n\t\t\t\t\t...existingPack.colors,\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: this.color,\n\t\t\t\t\t\tcolor: this.color,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t} as any;\n\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: newPack,\n\t\t\t\t\tprocessed: true,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t});\n\t\t},\n\t\tpickColor(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.commit('ui/setColorPicker', true);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./color.vue?vue&type=template&id=8ecc10b2&scoped=true\"\nimport script from \"./color.vue?vue&type=script&lang=ts\"\nexport * from \"./color.vue?vue&type=script&lang=ts\"\n\nimport \"./color.vue?vue&type=style&index=0&id=8ecc10b2&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-8ecc10b2\"\n\nexport default script","export function exhaust(a: never): never {\n\tthrow new Error(`Unexpected value \"${a}\"`);\n}\n","import { ICommand } from '@/eventbus/command';\nimport { CompositeModes } from '@/renderer/rendererContext';\nimport { exhaust } from '@/util/exhaust';\n\nexport type SpriteFilter =\n\t| INumericSpriteFilter<'blur'>\n\t| INumericSpriteFilter<'brightness'>\n\t| INumericSpriteFilter<'contrast'>\n\t| IDropShadowSpriteFilter\n\t| INumericSpriteFilter<'grayscale'>\n\t| INumericSpriteFilter<'hue-rotate'>\n\t| INumericSpriteFilter<'invert'>\n\t| INumericSpriteFilter<'opacity'>\n\t| INumericSpriteFilter<'saturate'>\n\t| INumericSpriteFilter<'sepia'>;\n\nexport const percentageValue = new Set<SpriteFilter['type']>([\n\t'brightness',\n\t'contrast',\n\t'grayscale',\n\t'invert',\n\t'opacity',\n\t'saturate',\n\t'sepia',\n]);\n\nexport interface IHasSpriteFilters {\n\tfilters: SpriteFilter[];\n\tcomposite: CompositeModes;\n}\n\nexport interface INumericSpriteFilter<K extends string> {\n\ttype: K;\n\tvalue: number;\n}\n\nexport interface IDropShadowSpriteFilter {\n\ttype: 'drop-shadow';\n\toffsetX: number;\n\toffsetY: number;\n\tblurRadius: number;\n\tcolor: string;\n}\n\nexport interface ISetFilterValue {\n\ttype: Exclude<SpriteFilter['type'], 'drop-shadow'>;\n\tvalue: number;\n}\n\nexport interface ISetDropShadowFilter {\n\ttype: 'drop-shadow';\n\toffsetX?: number;\n\toffsetY?: number;\n\tblurRadius?: number;\n\tcolor?: string;\n}\n\nexport function addFilter(\n\taction: IAddFilterAction,\n\tobjLookup: (id: string) => IHasSpriteFilters,\n\tsetMutation: (mutation: ISetFiltersMutation) => void\n): void {\n\tconst obj = objLookup(action.id);\n\tconst filters = [...obj.filters];\n\tlet newFilter: SpriteFilter;\n\tswitch (action.type) {\n\t\tcase 'hue-rotate':\n\t\t\tnewFilter = {\n\t\t\t\ttype: action.type,\n\t\t\t\tvalue: 0,\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'sepia':\n\t\tcase 'invert':\n\t\tcase 'blur':\n\t\tcase 'grayscale':\n\t\tcase 'brightness':\n\t\tcase 'contrast':\n\t\tcase 'opacity':\n\t\tcase 'saturate':\n\t\t\tnewFilter = {\n\t\t\t\ttype: action.type,\n\t\t\t\tvalue: 1,\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'drop-shadow':\n\t\t\tnewFilter = {\n\t\t\t\ttype: action.type,\n\t\t\t\tblurRadius: 0,\n\t\t\t\toffsetX: 10,\n\t\t\t\toffsetY: 10,\n\t\t\t\tcolor: '#555555',\n\t\t\t};\n\t\t\tbreak;\n\t\tdefault:\n\t\t\texhaust(action.type);\n\t}\n\tfilters.splice(action.idx, 0, newFilter);\n\n\tsetMutation({\n\t\tid: action.id,\n\t\tfilters,\n\t});\n}\n\nexport function removeFilter(\n\taction: IRemoveFilterAction,\n\tobjLookup: (id: string) => IHasSpriteFilters,\n\tsetMutation: (mutation: ISetFiltersMutation) => void\n) {\n\tconst obj = objLookup(action.id);\n\tconst filters = [...obj.filters];\n\tfilters.splice(action.idx, 1);\n\tsetMutation({\n\t\tid: action.id,\n\t\tfilters,\n\t} as ISetFiltersMutation);\n}\n\nexport function moveFilter(\n\taction: IMoveFilterAction,\n\tobjLookup: (id: string) => IHasSpriteFilters,\n\tsetMutation: (mutation: ISetFiltersMutation) => void\n) {\n\tconst obj = objLookup(action.id);\n\tconst filters = [...obj.filters];\n\tconst filter = filters[action.idx];\n\tfilters.splice(action.idx, 1);\n\tfilters.splice(action.idx + action.moveBy, 0, filter);\n\tsetMutation({\n\t\tid: action.id,\n\t\tfilters,\n\t} as ISetFiltersMutation);\n}\n\nexport function setFilter(\n\taction: ISetFilterAction,\n\tobjLookup: (id: string) => IHasSpriteFilters,\n\tsetMutation: (mutation: ISetFiltersMutation) => void\n) {\n\tconst obj = objLookup(action.id);\n\tconst filters = [...obj.filters];\n\tconst filter = { ...filters[action.idx] } as SpriteFilter;\n\tfilters[action.idx] = filter;\n\n\tif (filter.type === 'drop-shadow') {\n\t\tif (action.blurRadius !== undefined) {\n\t\t\tfilter.blurRadius = action.blurRadius;\n\t\t}\n\t\tif (action.color !== undefined) {\n\t\t\tfilter.color = action.color;\n\t\t}\n\t\tif (action.offsetX !== undefined) {\n\t\t\tfilter.offsetX = action.offsetX;\n\t\t}\n\t\tif (action.offsetY !== undefined) {\n\t\t\tfilter.offsetY = action.offsetY;\n\t\t}\n\t} else {\n\t\tfilter.value = action.value!;\n\t}\n\tsetMutation({\n\t\tid: action.id,\n\t\tfilters,\n\t} as ISetFiltersMutation);\n}\n\nexport type SetFilterValue = ISetFilterValue | ISetDropShadowFilter;\n\nexport function applyFilter(obj: IHasSpriteFilters, command: SetFilterValue) {\n\tconst filter = obj.filters.find(f => f.type === command.type);\n\tif (!filter) return;\n\tObject.assign(filter, command);\n}\n\nexport interface ISetCompositionMutation extends ICommand {\n\treadonly composite: CompositeModes;\n}\n\nexport interface ISetFiltersMutation extends ICommand {\n\treadonly filters: SpriteFilter[];\n}\n\nexport interface IAddFilterAction extends ICommand {\n\treadonly type: SpriteFilter['type'];\n\treadonly idx: number;\n}\n\nexport interface IRemoveFilterAction extends ICommand {\n\treadonly idx: number;\n}\n\nexport interface IMoveFilterAction extends ICommand {\n\treadonly idx: number;\n\treadonly moveBy: number;\n}\n\nexport interface ISetFilterAction extends ICommand {\n\treadonly idx: number;\n\treadonly value?: number;\n\treadonly offsetX?: number;\n\treadonly offsetY?: number;\n\treadonly blurRadius?: number;\n\treadonly color?: string;\n}\n","\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport Slider from '@/components/toolbox/subtools/color/slider.vue';\nimport Color from '@/components/toolbox/subtools/color/color.vue';\nimport { defineComponent, Prop, PropType } from 'vue';\nimport { CompositeModes } from '@/renderer/rendererContext';\nimport { DeepReadonly } from '@/util/readonly';\nimport {\n\tIHasSpriteFilters,\n\tINumericSpriteFilter,\n\tpercentageValue,\n\tSpriteFilter,\n} from '@/store/sprite_options';\nimport { exhaust } from '@/util/exhaust';\nimport {\n\tIAddFilterAction,\n\tIMoveFilterAction,\n\tIRemoveFilterAction,\n\tISetCompositionMutation,\n\tISetFilterAction,\n} from '@/store/sprite_options';\nimport { IColor } from '@/util/colors/color';\nimport { HSLAColor } from '@/util/colors/hsl';\nimport L from '@/components/ui/link.vue';\n\nconst filterText: ReadonlyMap<SpriteFilter['type'], string> = new Map<\n\tSpriteFilter['type'],\n\tstring\n>([\n\t['blur', 'Blur'],\n\t['brightness', 'Brightness'],\n\t['contrast', 'Contrast'],\n\t['grayscale', 'Grayscale'],\n\t['hue-rotate', 'Rotate hue'],\n\t['invert', 'Invert colors'],\n\t['opacity', 'Opacity'],\n\t['saturate', 'Saturate'],\n\t['sepia', 'Sepia'],\n\t['drop-shadow', 'Drop shadow'],\n]);\n\nconst filters: ReadonlyArray<SpriteFilter['type']> = Array.from(\n\tfilterText.keys()\n).sort();\n\nexport default defineComponent({\n\tcomponents: { DFlow, DFieldset, Color, Slider, L },\n\tprops: {\n\t\ttype: {\n\t\t\ttype: String as PropType<'object' | 'background' | 'panel'>,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t},\n\t\tid: {\n\t\t\trequired: true,\n\t\t} as Prop<string | number>,\n\t\tnoComposition: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['leave'],\n\tdata: () => ({\n\t\taddEffectSelection: '' as SpriteFilter['type'] | '',\n\t\tcurrentFilterIdx: 0,\n\t\tshowShadowColor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): DeepReadonly<IHasSpriteFilters> {\n\t\t\tswitch (this.type) {\n\t\t\t\tcase 'object':\n\t\t\t\t\treturn this.$store.state.objects.objects[this.id!];\n\t\t\t\tcase 'background':\n\t\t\t\t\treturn this.$store.state.panels.panels[this.id!].background;\n\t\t\t\tcase 'panel':\n\t\t\t\t\treturn this.$store.state.panels.panels[this.id!];\n\t\t\t\tdefault:\n\t\t\t\t\texhaust(this.type);\n\t\t\t\t\treturn null!;\n\t\t\t}\n\t\t},\n\t\tcompositionMode: {\n\t\t\tget(): CompositeModes {\n\t\t\t\treturn this.object.composite;\n\t\t\t},\n\t\t\tset(composite: CompositeModes): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tswitch (this.type) {\n\t\t\t\t\t\tcase 'object':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setComposition', {\n\t\t\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\t\t\tcomposite,\n\t\t\t\t\t\t\t} as ISetCompositionMutation);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'background':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'panel':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\texhaust(this.type);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tfilters(): DeepReadonly<SpriteFilter[]> {\n\t\t\treturn this.object.filters;\n\t\t},\n\t\tfilterTypes(): ReadonlyArray<SpriteFilter['type']> {\n\t\t\ttry {\n\t\t\t\tconst canvas = document.createElement('canvas');\n\t\t\t\tconst context = canvas.getContext('2d')!;\n\t\t\t\tif ('filter' in context) {\n\t\t\t\t\treturn filters;\n\t\t\t\t}\n\t\t\t} catch (_e) {}\n\t\t\treturn ['opacity'];\n\t\t},\n\t\tcurrentFilter(): DeepReadonly<SpriteFilter> | null {\n\t\t\treturn this.filters[this.currentFilterIdx] || null;\n\t\t},\n\t\tisPercentFilter(): boolean {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return false;\n\t\t\treturn percentageValue.has(filter.type);\n\t\t},\n\t\tmaxValue(): number | undefined {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return undefined;\n\n\t\t\tif (filter.type === 'hue-rotate') return 360;\n\t\t\tif (\n\t\t\t\tfilter.type === 'grayscale' ||\n\t\t\t\tfilter.type === 'sepia' ||\n\t\t\t\tfilter.type === 'opacity' ||\n\t\t\t\tfilter.type === 'invert'\n\t\t\t)\n\t\t\t\treturn 100;\n\n\t\t\treturn undefined;\n\t\t},\n\t\tminValue(): number | undefined {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return undefined;\n\n\t\t\tswitch (filter.type) {\n\t\t\t\tcase 'blur':\n\t\t\t\tcase 'brightness':\n\t\t\t\tcase 'contrast':\n\t\t\t\tcase 'grayscale':\n\t\t\t\tcase 'hue-rotate':\n\t\t\t\tcase 'invert':\n\t\t\t\tcase 'opacity':\n\t\t\t\tcase 'saturate':\n\t\t\t\tcase 'sepia':\n\t\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t},\n\t\tshadowColor: {\n\t\t\tget(): string | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('color' in filter)) return undefined;\n\t\t\t\treturn filter.color;\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.setValue({ color });\n\t\t\t},\n\t\t},\n\t\tshadowX: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('offsetX' in filter)) return undefined;\n\t\t\t\treturn filter.offsetX;\n\t\t\t},\n\t\t\tset(offsetX: number) {\n\t\t\t\tthis.setValue({ offsetX });\n\t\t\t},\n\t\t},\n\t\tshadowY: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('offsetY' in filter)) return undefined;\n\t\t\t\treturn filter.offsetY;\n\t\t\t},\n\t\t\tset(offsetY: number) {\n\t\t\t\tthis.setValue({ offsetY });\n\t\t\t},\n\t\t},\n\t\tshadowBlur: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('blurRadius' in filter)) return undefined;\n\t\t\t\treturn filter.blurRadius;\n\t\t\t},\n\t\t\tset(blurRadius: number) {\n\t\t\t\tthis.setValue({ blurRadius });\n\t\t\t},\n\t\t},\n\t\thueStops(): string[] {\n\t\t\tconst stops = this.eightsStops(i => new HSLAColor(i, 1, 0.5, 1));\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t},\n\tmethods: {\n\t\tgetFilterLabel(type: SpriteFilter['type']): string {\n\t\t\treturn filterText.get(type)!;\n\t\t},\n\t\tgetFilterText(filter: SpriteFilter): string {\n\t\t\tif (percentageValue.has(filter.type)) {\n\t\t\t\treturn `${filterText.get(filter.type)} ${(\n\t\t\t\t\t(filter as INumericSpriteFilter<any>).value * 100\n\t\t\t\t).toFixed()}%`;\n\t\t\t} else if (filter.type === 'hue-rotate') {\n\t\t\t\treturn `${filterText.get(filter.type)} ${filter.value.toFixed()}°`;\n\t\t\t} else if (filter.type === 'blur') {\n\t\t\t\treturn `${filterText.get(filter.type)} ${filter.value.toFixed()}px`;\n\t\t\t}\n\t\t\treturn filterText.get(filter.type)!;\n\t\t},\n\t\tobjectTypeScope(command: string): string {\n\t\t\tswitch (this.type) {\n\t\t\t\tcase 'object':\n\t\t\t\t\treturn 'objects/' + command;\n\t\t\t\tcase 'background':\n\t\t\t\t\treturn (\n\t\t\t\t\t\t'panels/background' + command[0].toUpperCase() + command.slice(1)\n\t\t\t\t\t);\n\t\t\t\tcase 'panel':\n\t\t\t\t\treturn 'panels/' + command;\n\t\t\t}\n\t\t},\n\t\taddFilter() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('addFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\ttype: this.addEffectSelection,\n\t\t\t\t\tidx: this.currentFilterIdx + 1,\n\t\t\t\t} as IAddFilterAction);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tselectFilter(idx: number) {\n\t\t\tthis.currentFilterIdx = idx;\n\t\t},\n\t\tremoveFilter() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('removeFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t} as IRemoveFilterAction);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tmoveFilter(moveBy: number) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('moveFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t\tmoveBy,\n\t\t\t\t} as IMoveFilterAction);\n\t\t\t\tthis.currentFilterIdx += moveBy;\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tsetValue(value: Omit<ISetFilterAction, 'id' | 'idx'>) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('setFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t\t...value,\n\t\t\t\t} as ISetFilterAction);\n\t\t\t});\n\t\t},\n\t\teightsStops(gen: (i: number) => IColor): IColor[] {\n\t\t\tconst stops: IColor[] = [];\n\t\t\tfor (let i = 0; i <= 8; ++i) {\n\t\t\t\tstops.push(gen(i / 8));\n\t\t\t}\n\t\t\treturn stops;\n\t\t},\n\t},\n});\n","import { render } from \"./image-options.vue?vue&type=template&id=4dd06317&scoped=true\"\nimport script from \"./image-options.vue?vue&type=script&lang=ts\"\nexport * from \"./image-options.vue?vue&type=script&lang=ts\"\n\nimport \"./image-options.vue?vue&type=style&index=0&id=4dd06317&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-4dd06317\"\n\nexport default script","<template>\n\t<color v-if=\"colorSelector\" v-model=\"selectedColor\" @leave=\"applyColor\" />\n\t<div v-else :class=\"{ 'text-subpanel': true, vertical }\">\n\t\t<h2>{{ title }}</h2>\n\t\t<div class=\"column ok-col\">\n\t\t\t<button @click=\"$emit('leave')\">OK</button>\n\t\t</div>\n\t\t<div class=\"column\">\n\t\t\t<textarea\n\t\t\t\tref=\"textArea\"\n\t\t\t\t:value=\"modelValue\"\n\t\t\t\t@input=\"onValueChanged\"\n\t\t\t\t@keydown.stop\n\t\t\t\t@keypress.stop\n\t\t\t/>\n\t\t</div>\n\t\t<div class=\"column error-col\" v-if=\"error\">{{ error }}</div>\n\t\t<div class=\"column\">\n\t\t\t<button @click=\"insertText('\\\\\\\\')\" class=\"style-button\">Insert \\</button>\n\t\t\t<button @click=\"insertText('\\\\{')\" class=\"style-button\">Insert {</button>\n\t\t\t<button @click=\"insertText('\\\\}')\" class=\"style-button\">Insert }</button>\n\t\t</div>\n\t\t<p class=\"hint-col\">Apply style to selected text:</p>\n\t\t<div class=\"column\">\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('b')\"\n\t\t\t\tclass=\"style-button\"\n\t\t\t\tstyle=\"font-weight: bold\"\n\t\t\t>\n\t\t\t\tBold\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('i')\"\n\t\t\t\tclass=\"style-button\"\n\t\t\t\tstyle=\"font-style: italic\"\n\t\t\t>\n\t\t\t\tItalics\n\t\t\t</button>\n\t\t\t<button @click=\"insertCommand('plain')\" class=\"style-button\">\n\t\t\t\tPlain\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('edited')\"\n\t\t\t\tclass=\"style-button edited-style\"\n\t\t\t>\n\t\t\t\tEdited\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('k', 2)\"\n\t\t\t\tclass=\"style-button\"\n\t\t\t\tstyle=\"letter-spacing: 5px;\"\n\t\t\t>\n\t\t\t\tKerning\n\t\t\t</button>\n\t\t</div>\n\t\t<div class=\"column\">\n\t\t\t<button @click=\"insertCommand('alpha', 0.5)\" class=\"style-button\">\n\t\t\t\tAlpha\n\t\t\t</button>\n\t\t</div>\n\t\t<div class=\"column\">\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('size', 12)\"\n\t\t\t\tclass=\"style-button\"\n\t\t\t\tstyle=\"font-size: 20px\"\n\t\t\t>\n\t\t\t\tFont size\n\t\t\t</button>\n\t\t\t<select v-model=\"selectedFont\" class=\"style-button\">\n\t\t\t\t<option value>Font</option>\n\t\t\t\t<option value=\"aller\" style=\"font-family: aller\"\n\t\t\t\t\t>Aller (Textbox)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"riffic\" style=\"font-family: riffic\"\n\t\t\t\t\t>Riffic (Bold text)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"hashtag\" style=\"font-family: hashtag\"\n\t\t\t\t\t>Hashtag (Sayori)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"ammy_handwriting\" style=\"font-family: ammy_handwriting\"\n\t\t\t\t\t>Ammy's Handwriting (Natsuki)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"journal\" style=\"font-family: journal\"\n\t\t\t\t\t>Journal (Monika)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"jp_hand_slanted\" style=\"font-family: jp_hand_slanted\"\n\t\t\t\t\t>JP Hand Slanted (Yuri)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"damagrafik_script\" style=\"font-family: damagrafik_script\"\n\t\t\t\t\t>Damagrafik (Yuri, Act 2)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"as_i_lay_dying\" style=\"font-family: as_i_lay_dying\"\n\t\t\t\t\t>As I Lay Dying (Yuri, Act Unused)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"halogen\" style=\"font-family: halogen\"\n\t\t\t\t\t>Halogen (MC)</option\n\t\t\t\t>\n\t\t\t</select>\n\t\t\t<button @click=\"selectColor('text')\" class=\"style-button\">\n\t\t\t\tText color\n\t\t\t</button>\n\t\t\t<button @click=\"selectColor('outline')\" class=\"style-button\">\n\t\t\t\tOutline color\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport Color from '../color/color.vue';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { NameboxTextStyle } from '@/constants/textBox';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tinheritAttrs: false,\n\tcomponents: { Color },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata: () => ({\n\t\tcolorSelector: '' as '' | 'text' | 'outline',\n\t\tselectedFont: '',\n\t\tselectedColor: '#000000',\n\t\trememberedStart: 0,\n\t\trememberedEnd: 0,\n\t\terror: '',\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\twatch: {\n\t\tselectedFont() {\n\t\t\tif (this.selectedFont === '') return;\n\t\t\tthis.insertCommand('font', this.selectedFont);\n\t\t\tthis.selectedFont = '';\n\t\t},\n\t},\n\tmethods: {\n\t\tonValueChanged() {\n\t\t\tconst val = (this.$refs.textArea as HTMLTextAreaElement).value;\n\t\t\ttry {\n\t\t\t\t// tslint:disable-next-line: no-unused-expression\n\t\t\t\tnew TextRenderer(val, NameboxTextStyle);\n\t\t\t\tthis.error = '';\n\t\t\t} catch (e) {\n\t\t\t\tthis.error = (e as Error).message;\n\t\t\t}\n\t\t\tthis.$emit('update:modelValue', val);\n\t\t},\n\t\tselectColor(colorSelector: '' | 'text' | 'outline') {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tthis.colorSelector = colorSelector;\n\t\t\tthis.rememberedStart = el.selectionStart;\n\t\t\tthis.rememberedEnd = el.selectionEnd;\n\t\t},\n\t\tapplyColor() {\n\t\t\tconst color = this.selectedColor;\n\t\t\tconst colorSelector = this.colorSelector;\n\t\t\tconst apply = () => {\n\t\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\t\tif (!el) {\n\t\t\t\t\tthis.$nextTick(apply);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tel.selectionStart = this.rememberedStart;\n\t\t\t\tel.selectionEnd = this.rememberedEnd;\n\t\t\t\tthis.insertCommand(\n\t\t\t\t\tcolorSelector === 'text' ? 'color' : 'outlinecolor',\n\t\t\t\t\tcolor\n\t\t\t\t);\n\t\t\t};\n\t\t\tthis.$nextTick(apply);\n\t\t\tthis.selectedColor = '#000000';\n\t\t\tthis.colorSelector = '';\n\t\t},\n\t\tinsertText(text: string) {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tconst val = el.value;\n\t\t\tconst selStart = el.selectionStart;\n\t\t\tconst selEnd = el.selectionEnd;\n\t\t\tel.value = val.slice(0, selStart) + text + val.slice(selEnd);\n\t\t\tel.selectionStart = el.selectionEnd = selStart + text.length;\n\t\t\tel.focus();\n\t\t\tthis.onValueChanged();\n\t\t},\n\t\tinsertCommand(command: string, arg?: any) {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tconst val = el.value;\n\t\t\tconst selStart = el.selectionStart;\n\t\t\tconst selEnd = el.selectionEnd;\n\t\t\tconst selectedText = val.slice(selStart, selEnd);\n\t\t\tconst before = val.slice(0, selStart);\n\t\t\tconst after = val.slice(selEnd);\n\t\t\tlet commandOpen = command;\n\t\t\tif (arg) {\n\t\t\t\tcommandOpen += '=' + arg;\n\t\t\t}\n\t\t\tel.value = `${before}{${commandOpen}}${selectedText}{/${command}}${after}`;\n\t\t\tel.selectionStart = selStart + commandOpen.length + 2;\n\t\t\tel.selectionEnd = el.selectionStart + selectedText.length;\n\t\t\tel.focus();\n\t\t\tthis.onValueChanged();\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.text-subpanel {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\t//flex-flow: nowrap;\n\n\th2 {\n\t\tfont-size: 20px;\n\t\tcolor: $default-text;\n\t\tcolor: var(--text);\n\t\tfont-family: riffic, sans-serif;\n\t\ttext-align: center;\n\t}\n\n\t&.vertical {\n\t\tflex-direction: row;\n\t\twidth: 100%;\n\n\t\t.column {\n\t\t\twidth: 100%;\n\n\t\t\tbutton,\n\t\t\tselect {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\ttextarea {\n\t\t\theight: 128px;\n\t\t}\n\t}\n\n\t.error-col {\n\t\tcolor: #880000;\n\t}\n\n\t&:not(.vertical) {\n\t\tflex-direction: column;\n\t\t@include height-100();\n\n\t\th2 {\n\t\t\twriting-mode: vertical-rl;\n\t\t\theight: inherit;\n\t\t\twidth: min-content;\n\t\t}\n\n\t\t.column {\n\t\t\tdisplay: flex;\n\t\t\t@include height-100();\n\t\t\tflex-direction: column;\n\t\t\tflex-wrap: wrap;\n\n\t\t\ttextarea {\n\t\t\t\t@include height-100();\n\t\t\t}\n\t\t}\n\n\t\t.hint-col {\n\t\t\twidth: 64px;\n\t\t\tmargin: 4px;\n\t\t}\n\n\t\t.error-col {\n\t\t\theight: 100%;\n\t\t\twidth: 168px;\n\t\t}\n\t\t.ok-col {\n\t\t\twidth: 32px;\n\t\t\tbutton {\n\t\t\t\t@include height-100();\n\t\t\t}\n\t\t}\n\t}\n}\n\n.hex-selector {\n\tdisplay: table;\n\tlabel {\n\t\ttext-align: right;\n\t\twidth: 100px;\n\t}\n\n\tinput {\n\t\tmargin-left: 7px;\n\t}\n\n\t&.vertical {\n\t\t> * {\n\t\t\tdisplay: table-row;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t> * {\n\t\t\tdisplay: table-cell;\n\t\t\tvertical-align: middle;\n\t\t}\n\t}\n}\n\n#color-swatches {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: space-evenly;\n\n\t&.vertical {\n\t\tmargin-top: 4px;\n\t\twidth: 100%;\n\t\tflex-direction: row;\n\t}\n\n\t&:not(.vertical) {\n\t\tmargin-left: 4px;\n\t\theight: 100%;\n\t\tflex-direction: column;\n\t}\n\n\t.swatch {\n\t\theight: 42px;\n\t\twidth: 42px;\n\t\tmargin: 1px;\n\t\tborder-color: black;\n\t}\n}\n\n.style-button {\n\tpadding: 4px;\n}\n\n.edited-style {\n\tcolor: white;\n\ttext-shadow: 0 6px 0.3px #000, 1px 6px 0.3px #000, 2px 5px 0.3px #000,\n\t\t3px 5px 0.3px #000, 4px 4px 0.3px #000, 5px 3px 0.3px #000,\n\t\t5px 2px 0.3px #000, 7px 1px 0.3px #000, 6px 0 0.3px #000,\n\t\t6px -1px 0.3px #000, 5px -2px 0.3px #000, 5px -3px 0.3px #000,\n\t\t4px -4px 0.3px #000, 3px -5px 0.3px #000, 2px -5px 0.3px #000,\n\t\t1px -6px 0.3px #000, 0 -6px 0.3px #000, -1px -6px 0.3px #000,\n\t\t-2px -5px 0.3px #000, -3px -5px 0.3px #000, -4px -4px 0.3px #000,\n\t\t-5px -3px 0.3px #000, -5px -2px 0.3px #000, -6px -1px 0.3px #000,\n\t\t-6px 0 0.3px #000, -6px 1px 0.3px #000, -5px 2px 0.3px #000,\n\t\t-5px 3px 0.3px #000, -4px 4px 0.3px #000, -3px 5px 0.3px #000,\n\t\t-2px 5px 0.3px #000, -1px 6px 0.3px #000, 0 6px 0 #000, 1px 6px 0 #000,\n\t\t2px 5px 0 #000, 3px 5px 0 #000, 4px 4px 0 #000, 5px 3px 0 #000,\n\t\t5px 2px 0 #000, 7px 1px 0 #000, 6px 0 0 #000, 6px -1px 0 #000,\n\t\t5px -2px 0 #000, 5px -3px 0 #000, 4px -4px 0 #000, 3px -5px 0 #000,\n\t\t2px -5px 0 #000, 1px -6px 0 #000, 0 -6px 0 #000, -1px -6px 0 #000,\n\t\t-2px -5px 0 #000, -3px -5px 0 #000, -4px -4px 0 #000, -5px -3px 0 #000,\n\t\t-5px -2px 0 #000, -6px -1px 0 #000, -6px 0 0 #000, -6px 1px 0 #000,\n\t\t-5px 2px 0 #000, -5px 3px 0 #000, -4px 4px 0 #000, -3px 5px 0 #000,\n\t\t-2px 5px 0 #000, -1px 6px 0 #000, 0 5px 0 #000, 1px 5px 0 #000,\n\t\t2px 4px 0 #000, 3px 4px 0 #000, 4px 3px 0 #000, 4px 2px 0 #000,\n\t\t5px 1px 0 #000, 5px 0 0 #000, 5px -1px 0 #000, 4px -2px 0 #000,\n\t\t4px -3px 0 #000, 3px -4px 0 #000, 2px -4px 0 #000, 1px -5px 0 #000,\n\t\t0 -5px 0 #000, -1px -5px 0 #000, -2px -4px 0 #000, -3px -4px 0 #000,\n\t\t-4px -3px 0 #000, -4px -2px 0 #000, -5px -1px 0 #000, -5px 0 0 #000,\n\t\t-5px 1px 0 #000, -4px 2px 0 #000, -4px 3px 0 #000, -3px 4px 0 #000,\n\t\t-2px 4px 0 #000, -1px 5px 0 #000, 0 4px 0 #000, 1px 4px 0 #000,\n\t\t2px 3px 0 #000, 3px 3px 0 #000, 3px 2px 0 #000, 4px 1px 0 #000, 4px 0 0 #000,\n\t\t4px -1px 0 #000, 3px -2px 0 #000, 3px -3px 0 #000, 2px -3px 0 #000,\n\t\t1px -4px 0 #000, 0 -4px 0 #000, -1px -4px 0 #000, -2px -3px 0 #000,\n\t\t-3px -3px 0 #000, -3px -2px 0 #000, -4px -1px 0 #000, -4px 0 0 #000,\n\t\t-4px 1px 0 #000, -3px 2px 0 #000, -3px 3px 0 #000, -2px 3px 0 #000,\n\t\t-1px 4px 0 #000, 0 3px 0 #000, 1px 3px 0 #000, 2px 2px 0 #000,\n\t\t3px 1px 0 #000, 3px 0 0 #000, 1px -3px 0 #000, 2px -2px 0 #000,\n\t\t3px -1px 0 #000, 0 -3px 0 #000, -1px -3px 0 #000, -2px -2px 0 #000,\n\t\t-3px -1px 0 #000, -3px 0 0 #000, -1px 3px 0 #000, -2px 2px 0 #000,\n\t\t-3px 1px 0 #000, 0 2px 0 #000, 1px 2px 0 #000, 2px 1px 0 #000, 2px 0 0 #000,\n\t\t1px -2px 0 #000, 2px -1px 0 #000, 0 -2px 0 #000, -1px -2px 0 #000,\n\t\t-2px -1px 0 #000, -2px 0 0 #000, -1px 2px 0 #000, -2px 1px 0 #000,\n\t\t0 1px 0 #000, 1px 1px 0 #000, 1px 0 0 #000, 1px -1px 0 #000, 0 -1px 0 #000,\n\t\t-1px -1px 0 #000, -1px 0 0 #000, -1px 1px 0 #000;\n}\n</style>\n","const aroundContextSize = 5;\n\nexport class StringWalker {\n\tprivate i: number = 0;\n\tpublic constructor(private readonly str: string) {}\n\n\tpublic get pos(): number {\n\t\treturn this.i;\n\t}\n\n\tpublic current(): string {\n\t\treturn this.str[this.i];\n\t}\n\n\tpublic get around(): string {\n\t\treturn this.str.slice(\n\t\t\tMath.max(0, this.i - aroundContextSize),\n\t\t\tthis.i + aroundContextSize\n\t\t);\n\t}\n\n\tpublic get ahead(): string {\n\t\treturn this.str[this.i + 1];\n\t}\n\n\tpublic get behind(): string {\n\t\treturn this.str[this.i + 1];\n\t}\n\n\tpublic next(): string {\n\t\t++this.i;\n\t\treturn this.current();\n\t}\n}\n","import { StringWalker } from './string-walker';\n\ninterface ITextToken {\n\tcontent: string;\n\tpos: number;\n\ttype: 'text';\n}\nexport interface ICommandToken {\n\tcommandName: string;\n\targument: string;\n\tpos: number;\n\ttype: 'command';\n}\ninterface ICommandCloseToken {\n\tcommandName: string;\n\tpos: number;\n\ttype: 'commandClose';\n}\ninterface INewlineToken {\n\ttype: 'newline';\n\tpos: number;\n}\n\nexport type Token =\n\t| ITextToken\n\t| ICommandToken\n\t| ICommandCloseToken\n\t| INewlineToken;\n\nexport function tokenize(str: string): Token[] {\n\tconst tokens: Token[] = [];\n\tconst stringWalker = new StringWalker(str);\n\tlet currentTokenState: TokenizerState = tokenStateNormal;\n\twhile (currentTokenState !== tokenStateEnd) {\n\t\tcurrentTokenState = currentTokenState(tokens, stringWalker);\n\t}\n\treturn tokens;\n}\n\ntype TokenizerState = (\n\tcontents: Token[],\n\twalker: StringWalker\n) => TokenizerState;\n\nfunction tokenStateNormal(\n\tcontents: Token[],\n\twalker: StringWalker\n): TokenizerState {\n\tif (walker.current() === undefined) return tokenStateEnd;\n\tif (walker.current() === '{') return tokenStateCommand;\n\tif (walker.current() === '\\n') return tokenStateNewLine;\n\treturn tokenText;\n}\n\nfunction tokenStateEnd(): TokenizerState {\n\treturn tokenStateEnd;\n}\n\nfunction tokenText(contents: Token[], walker: StringWalker): TokenizerState {\n\tconst { pos } = walker;\n\tlet textContent = '';\n\tlet escape = false;\n\tlet nextState: TokenizerState;\n\twhile (true) {\n\t\tif (walker.current() === undefined) {\n\t\t\tnextState = tokenStateEnd;\n\t\t\tbreak;\n\t\t} else if (escape) {\n\t\t\ttextContent += walker.current();\n\t\t\tescape = false;\n\t\t} else if (walker.current() === '\\\\') {\n\t\t\tescape = true;\n\t\t} else if (walker.current() === '{' || walker.current() === '\\n') {\n\t\t\tnextState = tokenStateNormal;\n\t\t\tbreak;\n\t\t} else {\n\t\t\ttextContent += walker.current();\n\t\t}\n\t\twalker.next();\n\t}\n\tcontents.push({\n\t\ttype: 'text',\n\t\tpos,\n\t\tcontent: textContent,\n\t});\n\treturn nextState;\n}\n\nfunction error(walker: StringWalker, msg: string): never {\n\tthrow new Error(\n\t\t`Error at position ${walker.pos}: (around: ${walker.around}) ${msg}`\n\t);\n}\n\nfunction tokenStateCommand(\n\tcontents: Token[],\n\twalker: StringWalker\n): TokenizerState {\n\tconst { pos } = walker;\n\tif (walker.current() !== '{') {\n\t\tthrow new Error('Parser error: Command does not start with {');\n\t}\n\tconst closing = walker.next() === '/';\n\tif (closing) {\n\t\twalker.next();\n\t}\n\tlet commandName = '';\n\tlet argument = '';\n\tlet argumentsState = false;\n\n\twhile (true) {\n\t\tif (walker.current() === undefined) {\n\t\t\terror(walker, 'Unexpected end of text inside a command');\n\t\t}\n\t\tif (walker.current() === '}') {\n\t\t\tbreak;\n\t\t} else if (!argumentsState) {\n\t\t\tif (walker.current().match(/[a-z]/i)) {\n\t\t\t\tcommandName += walker.current();\n\t\t\t} else if (walker.current() === '=') {\n\t\t\t\tif (closing) {\n\t\t\t\t\terror(walker, 'Closing commands may not contain arguments');\n\t\t\t\t}\n\t\t\t\targumentsState = true;\n\t\t\t} else {\n\t\t\t\terror(walker, 'Unexpected character in command name.');\n\t\t\t}\n\t\t} else {\n\t\t\targument += walker.current();\n\t\t}\n\t\twalker.next();\n\t}\n\twalker.next();\n\tif (closing) {\n\t\tcontents.push({\n\t\t\ttype: 'commandClose',\n\t\t\tcommandName,\n\t\t\tpos,\n\t\t});\n\t} else {\n\t\tcontents.push({\n\t\t\ttype: 'command',\n\t\t\tpos,\n\t\t\targument,\n\t\t\tcommandName,\n\t\t});\n\t}\n\treturn tokenStateNormal;\n}\n\nfunction tokenStateNewLine(\n\tcontents: Token[],\n\twalker: StringWalker\n): TokenizerState {\n\tcontents.push({ type: 'newline', pos: walker.pos });\n\twalker.next();\n\treturn tokenStateNormal;\n}\n","import { ITextStyle } from './textRenderer';\n\ntype Command = (style: ITextStyle, parameter?: string) => ITextStyle;\n\nexport default new Map<string, Command>([\n\tparamlessOp('i', style => ({ ...style, isItalic: true })),\n\tparamlessOp('b', style => ({ ...style, isBold: true })),\n\tparamlessOp('u', style => ({ ...style, isUnderlined: true })),\n\tparamlessOp('s', style => ({\n\t\t...style,\n\t\tisStrikethrough: true,\n\t})),\n\tparamlessOp('plain', style => ({\n\t\t...style,\n\t\tisStrikethrough: false,\n\t\tisUnderlined: false,\n\t\tisBold: false,\n\t\tisItalic: false,\n\t})),\n\tparamlessOp('edited', style => ({\n\t\t...style,\n\t\tfontName: 'verily',\n\t\tstrokeColor: '#000000',\n\t\tstrokeWidth: 20,\n\t\tletterSpacing: 8,\n\t})),\n\trelativeNumberOp('k', (style, relative, parameter) => ({\n\t\t...style,\n\t\tletterSpacing: relative ? style.letterSpacing + parameter : parameter,\n\t})),\n\trelativeNumberOp('size', (style, relative, parameter) => ({\n\t\t...style,\n\t\tfontSize: relative ? style.fontSize + parameter : parameter,\n\t})),\n\trelativeNumberOp('alpha', (style, relative, parameter) => ({\n\t\t...style,\n\t\talpha: relative ? style.alpha + parameter : parameter,\n\t})),\n\trelativeNumberOp('stroke', (style, relative, parameter) => ({\n\t\t...style,\n\t\tstrokeWidth: relative ? style.strokeWidth + parameter : parameter,\n\t})),\n\t[\n\t\t'font',\n\t\t(style, parameter?) => {\n\t\t\treturn { ...style, fontName: parameter! };\n\t\t},\n\t],\n\t[\n\t\t'color',\n\t\t(style, parameter?) => {\n\t\t\treturn { ...style, color: parameter! };\n\t\t},\n\t],\n\t[\n\t\t'outlinecolor',\n\t\t(style, parameter?) => {\n\t\t\treturn { ...style, strokeColor: parameter! };\n\t\t},\n\t],\n]);\n\nfunction paramlessOp(\n\tname: string,\n\top: (style: ITextStyle) => ITextStyle\n): [string, Command] {\n\treturn [\n\t\tname,\n\t\t(style: ITextStyle, parameter?: string) => {\n\t\t\tif (parameter) {\n\t\t\t\tthrow new Error(`Operator '${name}' does not take any arguments.`);\n\t\t\t}\n\t\t\treturn op(style);\n\t\t},\n\t];\n}\n\nfunction numberOp(\n\tname: string,\n\top: (style: ITextStyle, param: number) => ITextStyle\n): [string, Command] {\n\treturn [\n\t\tname,\n\t\t(style: ITextStyle, parameter?: string) => {\n\t\t\tif (!parameter) throw new Error(`Operator '${name}' needs an argument.`);\n\t\t\tconst num = Number(parameter);\n\t\t\tif (isNaN(num)) {\n\t\t\t\tthrow new Error(`Operator '${name}' needs a numeric argument.`);\n\t\t\t}\n\t\t\treturn op(style, num);\n\t\t},\n\t];\n}\n\nfunction relativeNumberOp(\n\tname: string,\n\top: (style: ITextStyle, relative: boolean, param: number) => ITextStyle\n): [string, Command] {\n\treturn [\n\t\tname,\n\t\t(style: ITextStyle, parameter?: string) => {\n\t\t\tif (!parameter) throw new Error(`Operator '${name}' needs an argument.`);\n\t\t\tconst relative = parameter[0] === '+' || parameter[0] === '-';\n\t\t\tconst num = Number(parameter);\n\t\t\tif (isNaN(num)) {\n\t\t\t\tthrow new Error(`Operator '${name}' needs a numeric argument.`);\n\t\t\t}\n\t\t\treturn op(style, relative, num);\n\t\t},\n\t];\n}\n","import { tokenize, Token, ICommandToken } from './tokenizer';\n\nimport textCommands from './textCommands';\nimport { exhaust } from '@/util/exhaust';\n\nexport interface ITextStyle {\n\tfontName: string;\n\tfontSize: number;\n\tisBold: boolean;\n\tisUnderlined: boolean;\n\tisStrikethrough: boolean;\n\tisItalic: boolean;\n\tcolor: string;\n\tstrokeWidth: number;\n\tstrokeColor: string;\n\tletterSpacing: number;\n\tlineSpacing: number;\n\talpha: number;\n}\n\ninterface ITextRenderItem {\n\tx: number;\n\ty: number;\n\theight: number;\n\twidth: number;\n}\n\ninterface IDrawCharacterItem extends ITextRenderItem {\n\ttype: 'character';\n\tcharacter: string;\n\tstyle: ITextStyle;\n}\n\ninterface INewlineItem extends ITextRenderItem {\n\ttype: 'newline';\n}\n\ntype RenderItem = IDrawCharacterItem | INewlineItem;\n\n// const widthCache = new Map<ITextStyle, Map<string, number>>();\n// const heightCache = new Map<ITextStyle, number>();\n\nexport class TextRenderer {\n\tpublic static textCommands = textCommands;\n\tprivate renderParts!: RenderItem[];\n\tprivate readonly tokens: Token[];\n\n\tpublic constructor(\n\t\tprivate str: string,\n\t\tprivate readonly baseStyle: ITextStyle\n\t) {\n\t\tthis.tokens = tokenize(str);\n\t\tthis.rebuildParts();\n\t}\n\n\tpublic rebuildParts() {\n\t\tthis.renderParts = this.getRenderParts(this.tokens, this.baseStyle);\n\t}\n\n\tpublic async loadFonts() {\n\t\tif (!('fonts' in document)) return;\n\t\tconst fonts = new Set<string>();\n\t\tlet currentStyle: ITextStyle | null = null;\n\t\tfor (const part of this.renderParts) {\n\t\t\tif (!('style' in part)) continue;\n\t\t\tif (part.style !== currentStyle) {\n\t\t\t\tcurrentStyle = part.style;\n\t\t\t\tif (currentStyle.fontName) {\n\t\t\t\t\tfonts.add(currentStyle.fontName);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet neededToLoad = false;\n\t\tfor (const font of fonts) {\n\t\t\tconst doc = document as any;\n\t\t\tconst fontString = `8px ${font}`;\n\t\t\tif (!doc.fonts.check(fontString)) {\n\t\t\t\tneededToLoad = true;\n\t\t\t\tawait doc.fonts.load(fontString);\n\t\t\t}\n\t\t}\n\n\t\tif (neededToLoad) {\n\t\t\tconst tokens = tokenize(this.str);\n\t\t\tthis.renderParts = this.getRenderParts(tokens, this.baseStyle);\n\t\t}\n\t}\n\n\tpublic render(ctx: CanvasRenderingContext2D): void {\n\t\tctx.save();\n\t\tlet currentStyle: ITextStyle | null = null;\n\t\tfor (const part of this.renderParts) {\n\t\t\tif (part.type === 'newline') continue;\n\t\t\tif (part.style !== currentStyle) {\n\t\t\t\tcurrentStyle = part.style;\n\t\t\t\tapplyTextStyleToCanvas(currentStyle, ctx);\n\t\t\t}\n\t\t\tif (currentStyle.strokeWidth > 0 && currentStyle.strokeColor > '') {\n\t\t\t\tctx.strokeText(part.character, part.x, part.y);\n\t\t\t}\n\t\t}\n\t\tfor (const part of this.renderParts) {\n\t\t\tif (part.type === 'newline') continue;\n\t\t\tif (part.style !== currentStyle) {\n\t\t\t\tcurrentStyle = part.style;\n\t\t\t\tapplyTextStyleToCanvas(currentStyle, ctx);\n\t\t\t}\n\t\t\tctx.fillText(part.character, part.x, part.y);\n\t\t}\n\t\tctx.restore();\n\t}\n\n\tpublic quote() {\n\t\tenum State {\n\t\t\tNone,\n\t\t\tExplictQuote,\n\t\t\tImplictQuote,\n\t\t\tStar,\n\t\t}\n\n\t\tlet lastChar = -1;\n\t\tlet state = State.None;\n\n\t\tfor (let i = 0; i < this.renderParts.length; ++i) {\n\t\t\tconst part = this.renderParts[i];\n\t\t\tif (part.type !== 'character') continue;\n\t\t\tswitch (state) {\n\t\t\t\tcase State.None:\n\t\t\t\t\tif (part.character.match(/\\s/)) continue;\n\t\t\t\t\tif (part.character === '\"') {\n\t\t\t\t\t\tstate = State.ExplictQuote;\n\t\t\t\t\t\tlastChar = i;\n\t\t\t\t\t} else if (part.character === '*') {\n\t\t\t\t\t\tstate = State.Star;\n\t\t\t\t\t\tlastChar = i;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.renderParts.splice(i, 0, {\n\t\t\t\t\t\t\ttype: 'character',\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\tstyle: part.style,\n\t\t\t\t\t\t\tcharacter: '\"',\n\t\t\t\t\t\t\theight: part.height,\n\t\t\t\t\t\t\twidth: measureWidth(part.style, '\"'),\n\t\t\t\t\t\t});\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tlastChar = i;\n\t\t\t\t\t\tstate = State.ImplictQuote;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase State.ExplictQuote:\n\t\t\t\t\tlastChar = i;\n\t\t\t\t\tif (part.character === '\"') {\n\t\t\t\t\t\tstate = State.None;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase State.ImplictQuote:\n\t\t\t\t\tif (part.character.match(/\\s/)) continue;\n\t\t\t\t\tif (part.character === '*') {\n\t\t\t\t\t\tthis.renderParts.splice(lastChar + 1, 0, {\n\t\t\t\t\t\t\ttype: 'character',\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\tstyle: part.style,\n\t\t\t\t\t\t\tcharacter: '\"',\n\t\t\t\t\t\t\theight: part.height,\n\t\t\t\t\t\t\twidth: measureWidth(part.style, '\"'),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tstate = State.Star;\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\tlastChar = i;\n\t\t\t\t\tbreak;\n\t\t\t\tcase State.Star:\n\t\t\t\t\tif (part.character === '*') {\n\t\t\t\t\t\tstate = State.None;\n\t\t\t\t\t}\n\t\t\t\t\tlastChar = i;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconst lastPart = this.renderParts[lastChar] as IDrawCharacterItem;\n\t\tif (lastPart && state === State.Star) {\n\t\t\tthis.renderParts.splice(lastChar + 1, 0, {\n\t\t\t\ttype: 'character',\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tstyle: lastPart.style,\n\t\t\t\tcharacter: '*',\n\t\t\t\theight: lastPart.height,\n\t\t\t\twidth: measureWidth(lastPart.style, '\"'),\n\t\t\t});\n\t\t}\n\t\tif (\n\t\t\tlastPart &&\n\t\t\t(state === State.ExplictQuote || state === State.ImplictQuote)\n\t\t) {\n\t\t\tthis.renderParts.splice(lastChar + 1, 0, {\n\t\t\t\ttype: 'character',\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tstyle: lastPart.style,\n\t\t\t\tcharacter: '\"',\n\t\t\t\theight: lastPart.height,\n\t\t\t\twidth: measureWidth(lastPart.style, '\"'),\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic fixAlignment(\n\t\talignment: 'left' | 'center' | 'right',\n\t\txStart: number,\n\t\txEnd: number,\n\t\tyStart: number,\n\t\tmaxLineWidth: number\n\t) {\n\t\tlet lineWidth = 0;\n\t\tlet currentLine: RenderItem[] = [];\n\n\t\tfunction fixLine() {\n\t\t\tlet x = xStart;\n\t\t\tif (alignment === 'center') {\n\t\t\t\tx = xStart + (xEnd - xStart) / 2 - lineWidth / 2;\n\t\t\t} else if (alignment === 'right') {\n\t\t\t\tx = xEnd - lineWidth;\n\t\t\t}\n\t\t\tfor (const item of currentLine) {\n\t\t\t\titem.x = x;\n\t\t\t\tx += item.width;\n\t\t\t}\n\t\t}\n\t\tlet renderParts = this.renderParts;\n\n\t\tif (maxLineWidth > 0) {\n\t\t\trenderParts = this.applyLineWrapping(\n\t\t\t\tthis.renderParts.slice(0),\n\t\t\t\tmaxLineWidth\n\t\t\t);\n\t\t}\n\n\t\tlet y = yStart;\n\t\tconst lineHeights = [];\n\t\tlet lineHeight = 0;\n\n\t\tfor (const item of renderParts) {\n\t\t\tlineHeight = Math.max(lineHeight, item.height);\n\n\t\t\tif (item.type === 'newline') {\n\t\t\t\tlineHeights.push(lineHeight);\n\t\t\t\tlineHeight = 0;\n\t\t\t}\n\t\t}\n\t\tlineHeights.push(lineHeight);\n\n\t\tlet line = 0;\n\n\t\tfor (const item of renderParts) {\n\t\t\tlineHeight = Math.max(lineHeight, item.height);\n\t\t\titem.y = y;\n\t\t\tcurrentLine.push(item);\n\t\t\tlineWidth += item.width;\n\n\t\t\tif (item.type === 'newline') {\n\t\t\t\tfixLine();\n\t\t\t\ty += lineHeights[++line] || 0;\n\t\t\t\tlineWidth = 0;\n\t\t\t\tlineHeight = 0;\n\t\t\t\tcurrentLine = [];\n\t\t\t} else if (item.type === 'character') {\n\t\t\t\tconst lastItem = currentLine[currentLine.length - 1];\n\t\t\t\tif (lastItem.type === 'character') {\n\t\t\t\t\tlineWidth += lastItem.style.letterSpacing;\n\t\t\t\t\tlastItem.width += lastItem.style.letterSpacing;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfixLine();\n\t}\n\n\tpublic getHeight(maxLineWidth: number) {\n\t\tlet lineHeight = 0;\n\t\tlet height = 0;\n\t\tconst renderParts =\n\t\t\tmaxLineWidth === 0\n\t\t\t\t? this.renderParts\n\t\t\t\t: this.applyLineWrapping(this.renderParts.slice(0), maxLineWidth);\n\n\t\tfor (const item of renderParts) {\n\t\t\tlineHeight = Math.max(lineHeight, item.height);\n\n\t\t\tif (item.type === 'newline') {\n\t\t\t\theight += lineHeight;\n\t\t\t\tlineHeight = 0;\n\t\t\t}\n\t\t}\n\t\theight += lineHeight;\n\n\t\treturn height;\n\t}\n\n\tpublic getWidth() {\n\t\tlet lineWidth = 0;\n\t\tlet maxLineWidth = 0;\n\t\tlet lastItemInLine: RenderItem | null = null;\n\n\t\tfor (const item of this.renderParts) {\n\t\t\tlineWidth += item.width;\n\n\t\t\tif (item.type === 'newline') {\n\t\t\t\tmaxLineWidth = Math.max(maxLineWidth, lineWidth);\n\t\t\t\tlineWidth = 0;\n\t\t\t\tlastItemInLine = null;\n\t\t\t} else if (item.type === 'character') {\n\t\t\t\tif (lastItemInLine && lastItemInLine.type === 'character') {\n\t\t\t\t\tlineWidth += lastItemInLine.style.letterSpacing;\n\t\t\t\t}\n\t\t\t\tlastItemInLine = item;\n\t\t\t}\n\t\t}\n\t\tmaxLineWidth = Math.max(maxLineWidth, lineWidth);\n\t\treturn maxLineWidth;\n\t}\n\n\tprivate getRenderParts(tokens: Token[], baseStyle: ITextStyle): RenderItem[] {\n\t\tconst renderParts: RenderItem[] = [];\n\t\tconst styleStack: ITextStyle[] = [];\n\t\tconst tagStack: Array<ICommandToken | null> = [];\n\t\tlet currentStyleHeight: number = measureHeight(baseStyle);\n\t\tlet currentStyle = baseStyle;\n\t\tlet currentTag: ICommandToken | null = null;\n\t\tfor (const token of tokens) {\n\t\t\tswitch (token.type) {\n\t\t\t\tcase 'command':\n\t\t\t\t\tif (TextRenderer.textCommands.has(token.commandName)) {\n\t\t\t\t\t\tstyleStack.push(currentStyle);\n\t\t\t\t\t\ttagStack.push(currentTag);\n\t\t\t\t\t\tcurrentStyle = TextRenderer.textCommands.get(token.commandName)!(\n\t\t\t\t\t\t\tcurrentStyle,\n\t\t\t\t\t\t\ttoken.argument\n\t\t\t\t\t\t);\n\t\t\t\t\t\tcurrentStyleHeight = measureHeight(currentStyle);\n\t\t\t\t\t\tcurrentTag = token;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`There is no text command called '${token.commandName}' at position ${token.pos}.`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'commandClose':\n\t\t\t\t\tif (!currentTag) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Unmatched closing command at position ${token.pos}. Closed '${token.commandName}', but no commands are currently open.`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (token.commandName !== currentTag.commandName) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Unmatched closing command at position ${token.pos}. Closed '${token.commandName}', expected to close '${currentTag}' first. (Opened at position ${currentTag.pos})`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcurrentTag = tagStack.pop()!;\n\t\t\t\t\tcurrentStyle = styleStack.pop()!;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'newline':\n\t\t\t\t\trenderParts.push({\n\t\t\t\t\t\theight: currentStyleHeight,\n\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\ttype: 'newline',\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'text':\n\t\t\t\t\tfor (const character of token.content) {\n\t\t\t\t\t\trenderParts.push({\n\t\t\t\t\t\t\ttype: 'character',\n\t\t\t\t\t\t\tcharacter,\n\t\t\t\t\t\t\theight: currentStyleHeight,\n\t\t\t\t\t\t\twidth: measureWidth(currentStyle, character),\n\t\t\t\t\t\t\tstyle: currentStyle,\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn renderParts;\n\t}\n\n\tprivate applyLineWrapping(\n\t\tparts: RenderItem[],\n\t\tmaxLineWidth: number\n\t): RenderItem[] {\n\t\tlet lastBreakPoint = -1;\n\t\tlet currentLineWidth = 0;\n\t\tlet lastBreakLineWidth = 0;\n\t\tconst newParts: RenderItem[] = [];\n\n\t\tfor (const item of parts) {\n\t\t\tif (item.type === 'newline') {\n\t\t\t\tlastBreakPoint = -1;\n\t\t\t\tcurrentLineWidth = 0;\n\t\t\t\tlastBreakLineWidth = 0;\n\t\t\t\tnewParts.push(item);\n\t\t\t} else if (item.type === 'character') {\n\t\t\t\tif (item.character === ' ') {\n\t\t\t\t\tif (currentLineWidth > maxLineWidth) {\n\t\t\t\t\t\tlastBreakPoint = -1;\n\t\t\t\t\t\tcurrentLineWidth = 0;\n\t\t\t\t\t\tlastBreakLineWidth = 0;\n\t\t\t\t\t\tnewParts.push({\n\t\t\t\t\t\t\ttype: 'newline',\n\t\t\t\t\t\t\theight: item.height,\n\t\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrentLineWidth += item.width;\n\t\t\t\t\t\tlastBreakLineWidth = currentLineWidth;\n\t\t\t\t\t\tlastBreakPoint = newParts.length;\n\t\t\t\t\t\tnewParts.push(item);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcurrentLineWidth += item.width;\n\n\t\t\t\t\tif (currentLineWidth > maxLineWidth && lastBreakPoint !== -1) {\n\t\t\t\t\t\tcurrentLineWidth -= lastBreakLineWidth;\n\t\t\t\t\t\tnewParts.splice(lastBreakPoint, 1, {\n\t\t\t\t\t\t\ttype: 'newline',\n\t\t\t\t\t\t\theight: item.height,\n\t\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlastBreakPoint = -1;\n\t\t\t\t\t\tlastBreakLineWidth = 0;\n\t\t\t\t\t\tnewParts.push(item);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewParts.push(item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\texhaust(item);\n\t\t\t}\n\t\t}\n\n\t\treturn newParts;\n\t}\n}\n\nconst tmpContext = document.createElement('canvas').getContext('2d')!;\nlet lastStyle: ITextStyle | null = null;\n\nfunction measureWidth(textStyle: ITextStyle, character: string): number {\n\tif (textStyle !== lastStyle) {\n\t\tapplyTextStyleToCanvas(textStyle, tmpContext);\n\t\tlastStyle = textStyle;\n\t}\n\treturn tmpContext.measureText(character).width;\n}\n\nconst heightCache = new Map<string, number>();\n\nfunction measureHeight(textStyle: ITextStyle): number {\n\tconst font = textStyle.fontSize + ' ' + textStyle.fontName;\n\tif (heightCache.has(font)) {\n\t\treturn heightCache.get(font)! * textStyle.lineSpacing;\n\t}\n\n\tconst text = document.createElement('span');\n\ttext.innerHTML = 'Hg';\n\ttext.style.fontFamily = textStyle.fontName;\n\ttext.style.fontSize = `${textStyle.fontSize}px`;\n\ttext.style.lineHeight = '1';\n\n\tconst div = document.createElement('div');\n\tdiv.style.opacity = '0';\n\tdiv.style.fontFamily = textStyle.fontName;\n\tdiv.style.fontSize = `${textStyle.fontSize}px`;\n\tdiv.style.lineHeight = '1';\n\tdiv.style.position = 'absolute';\n\tdiv.style.top = '0';\n\tdiv.style.left = '0';\n\tdiv.appendChild(text);\n\n\tdocument.body.appendChild(div);\n\n\ttry {\n\t\tconst height = div.offsetHeight;\n\t\theightCache.set(font, height);\n\t\treturn height * textStyle.lineSpacing;\n\t} finally {\n\t\tdiv.remove();\n\t}\n}\n\nfunction applyTextStyleToCanvas(\n\tstyle: ITextStyle,\n\tctx: CanvasRenderingContext2D\n) {\n\tctx.textAlign = 'left';\n\tctx.font =\n\t\t(style.isItalic ? 'italic ' : '') +\n\t\t(style.isBold ? 'bold ' : '') +\n\t\tstyle.fontSize +\n\t\t'px ' +\n\t\tstyle.fontName;\n\tctx.lineJoin = 'round';\n\n\tif (style.strokeWidth > 0 && style.strokeColor > '') {\n\t\tctx.strokeStyle = style.strokeColor;\n\t\tctx.lineWidth = style.strokeWidth;\n\t} else {\n\t\tctx.strokeStyle = '';\n\t\tctx.lineWidth = 0;\n\t}\n\n\tctx.globalAlpha = style.alpha || 0;\n\tctx.fillStyle = style.color;\n}\n","import { HSLAColor } from '@/util/colors/hsl';\n\nexport const textboxDefaultColor = '#ffa8d2';\nexport const controlsDefaultColor = '#552222';\nexport const nameboxDefaultColor = '#ffeef6';\nexport const nameboxStrokeDefaultColor = '#bb5599';\n\n// tslint:disable: no-magic-numbers\nexport const nameboxTextOutlineDelta = new HSLAColor(\n\t-0.03065134099616873,\n\t-0.5714285714285714,\n\t-0.29607843137254896,\n\t0\n);\n\nexport const nameboxBackgroundDelta = new HSLAColor(\n\t0.002028397565922768,\n\t0,\n\t0.13725490196078438,\n\t0\n);\n\nexport const nameboxGradientMiddleStopPosition = 0.82;\n\nexport const nameboxGradientEndDelta = new HSLAColor(\n\t-0.004901960784313708,\n\t-0.8599999999999999,\n\t-0.16274509803921566,\n\t0\n);\n\nexport const nameboxRounding = 12;\nexport const nameboxRoundingBuffer = 1.5;\n\nexport const textboxRounding = 12;\nexport const textboxRoundingBuffer = 1.5;\n\nexport const nameColorThreshold = 0.6;\n\nexport const controlColorDelta = new HSLAColor(\n\t0.08045977011494243,\n\t-0.5714285714285714,\n\t-0.5960784313725489,\n\t0\n);\n\nexport const controlDisableColorDelta = new HSLAColor(\n\t0,\n\t-0.14285714285714296,\n\t0.3,\n\t0\n);\n\nexport const dotColorDelta = new HSLAColor(\n\t0.004269293924466178,\n\t-0.01869158878504662,\n\t-0.039215686274509665,\n\t0\n);\n\nexport const dotRadius = 9.5;\nexport const dotPatternSize = 47;\n\nexport const textboxOutlineColorDelta = new HSLAColor(\n\t0.0023347701149424305,\n\t0,\n\t0.10784313725490202,\n\t0\n);\n","import { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth } from '@/constants/base';\nimport { nameboxStrokeDefaultColor } from './textBoxCustom';\n\n// tslint:disable: no-magic-numbers\nexport const TextBoxWidth = 816;\nexport const TextBoxCorruptedWidth = 900;\nexport const TextBoxHeight = 146;\nexport const TextBoxY = 568;\nexport const TextBoxKerning = 0;\nexport const TextBoxLineHeight = 29;\nexport const TextBoxCorruptedKerning = 8;\nexport const TextBoxTextXOffset = 38;\nexport const TextBoxTextYOffset = 50;\n\nexport const TextBoxTextCorruptedXOffset = 9;\nexport const TextBoxTextCorruptedYOffset = 9;\n\nexport const NameboxHeight = 39;\nexport const NameboxWidth = 168;\nexport const NameboxXOffset = 34;\nexport const NameboxTextYOffset = 29;\n\nexport const ControlsYBottomOffset = 12;\nexport const ControlsXHistoryOffset = -126;\nexport const ControlsXSkipOffset = -72;\nexport const ControlsXStuffOffset = -38;\n\nexport const ArrowXRightOffset = 30.75;\nexport const ArrowYBottomOffset = 26;\n\nexport const GlowRX = 426;\nexport const GlowRY = 58;\n\nexport const BaseTextStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tfontName: 'aller',\n\tfontSize: 24,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n};\n\nexport const NameboxTextStyle: ITextStyle = {\n\t...BaseTextStyle,\n\tfontName: 'riffic',\n\tfontSize: 24,\n\tstrokeColor: nameboxStrokeDefaultColor,\n\tstrokeWidth: 6,\n\tcolor: 'white',\n\tletterSpacing: 1,\n};\n\nexport const ControlsTextStyle = {\n\talign: 'left' as CanvasTextAlign,\n\tfont: '13px aller',\n\tfill: {\n\t\tstyle: '#522',\n\t},\n};\n\nexport const ControlsTextDisabledStyle = {\n\t...ControlsTextStyle,\n\tfill: {\n\t\tstyle: '#a66',\n\t},\n};\n\nexport const TextBoxStyle = {\n\talign: 'left' as CanvasTextAlign,\n\tfont: '24px aller',\n\toutline: {\n\t\tstyle: '#523140',\n\t\twidth: 4,\n\t},\n\tfill: {\n\t\tstyle: '#fff',\n\t},\n};\n\nexport const TextBoxCorruptedStyle = {\n\talign: 'left' as CanvasTextAlign,\n\tfont: '24px verily',\n\toutline: {\n\t\tstyle: '#000',\n\t\twidth: 20,\n\t},\n\tfill: {\n\t\tstyle: '#fff',\n\t},\n};\n\nexport const TextBoxX = screenWidth / 2 - TextBoxWidth / 2; // 232\nexport const TextBoxCorruptedX = screenWidth / 2 - TextBoxCorruptedWidth / 2;\nexport const TextBoxTextX = TextBoxX + TextBoxTextXOffset;\nexport const TextBoxTextY = TextBoxY + TextBoxTextYOffset;\n\nexport const NameboxY = TextBoxY - NameboxHeight;\nexport const NameboxX = TextBoxX + NameboxXOffset;\nexport const NameboxTextX = NameboxX + NameboxWidth / 2;\nexport const NameboxTextY = NameboxY + NameboxTextYOffset;\n\nexport const ControlsXHistory = TextBoxX + ControlsXHistoryOffset;\nexport const ControlsXSkip = TextBoxX + ControlsXSkipOffset;\nexport const ControlsXStuff = TextBoxX + ControlsXStuffOffset;\n","\nimport Color from '../color/color.vue';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { NameboxTextStyle } from '@/constants/textBox';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tinheritAttrs: false,\n\tcomponents: { Color },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata: () => ({\n\t\tcolorSelector: '' as '' | 'text' | 'outline',\n\t\tselectedFont: '',\n\t\tselectedColor: '#000000',\n\t\trememberedStart: 0,\n\t\trememberedEnd: 0,\n\t\terror: '',\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\twatch: {\n\t\tselectedFont() {\n\t\t\tif (this.selectedFont === '') return;\n\t\t\tthis.insertCommand('font', this.selectedFont);\n\t\t\tthis.selectedFont = '';\n\t\t},\n\t},\n\tmethods: {\n\t\tonValueChanged() {\n\t\t\tconst val = (this.$refs.textArea as HTMLTextAreaElement).value;\n\t\t\ttry {\n\t\t\t\t// tslint:disable-next-line: no-unused-expression\n\t\t\t\tnew TextRenderer(val, NameboxTextStyle);\n\t\t\t\tthis.error = '';\n\t\t\t} catch (e) {\n\t\t\t\tthis.error = (e as Error).message;\n\t\t\t}\n\t\t\tthis.$emit('update:modelValue', val);\n\t\t},\n\t\tselectColor(colorSelector: '' | 'text' | 'outline') {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tthis.colorSelector = colorSelector;\n\t\t\tthis.rememberedStart = el.selectionStart;\n\t\t\tthis.rememberedEnd = el.selectionEnd;\n\t\t},\n\t\tapplyColor() {\n\t\t\tconst color = this.selectedColor;\n\t\t\tconst colorSelector = this.colorSelector;\n\t\t\tconst apply = () => {\n\t\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\t\tif (!el) {\n\t\t\t\t\tthis.$nextTick(apply);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tel.selectionStart = this.rememberedStart;\n\t\t\t\tel.selectionEnd = this.rememberedEnd;\n\t\t\t\tthis.insertCommand(\n\t\t\t\t\tcolorSelector === 'text' ? 'color' : 'outlinecolor',\n\t\t\t\t\tcolor\n\t\t\t\t);\n\t\t\t};\n\t\t\tthis.$nextTick(apply);\n\t\t\tthis.selectedColor = '#000000';\n\t\t\tthis.colorSelector = '';\n\t\t},\n\t\tinsertText(text: string) {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tconst val = el.value;\n\t\t\tconst selStart = el.selectionStart;\n\t\t\tconst selEnd = el.selectionEnd;\n\t\t\tel.value = val.slice(0, selStart) + text + val.slice(selEnd);\n\t\t\tel.selectionStart = el.selectionEnd = selStart + text.length;\n\t\t\tel.focus();\n\t\t\tthis.onValueChanged();\n\t\t},\n\t\tinsertCommand(command: string, arg?: any) {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tconst val = el.value;\n\t\t\tconst selStart = el.selectionStart;\n\t\t\tconst selEnd = el.selectionEnd;\n\t\t\tconst selectedText = val.slice(selStart, selEnd);\n\t\t\tconst before = val.slice(0, selStart);\n\t\t\tconst after = val.slice(selEnd);\n\t\t\tlet commandOpen = command;\n\t\t\tif (arg) {\n\t\t\t\tcommandOpen += '=' + arg;\n\t\t\t}\n\t\t\tel.value = `${before}{${commandOpen}}${selectedText}{/${command}}${after}`;\n\t\t\tel.selectionStart = selStart + commandOpen.length + 2;\n\t\t\tel.selectionEnd = el.selectionStart + selectedText.length;\n\t\t\tel.focus();\n\t\t\tthis.onValueChanged();\n\t\t},\n\t},\n});\n","import { render } from \"./text.vue?vue&type=template&id=7fb63b2e&scoped=true\"\nimport script from \"./text.vue?vue&type=script&lang=ts\"\nexport * from \"./text.vue?vue&type=script&lang=ts\"\n\nimport \"./text.vue?vue&type=style&index=0&id=7fb63b2e&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-7fb63b2e\"\n\nexport default script","\nimport Toggle from '@/components/toggle.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport Color from '@/components/toolbox/subtools/color/color.vue';\nimport { PanelMixin } from './panelMixin';\nimport TextEditor from '../subtools/text/text.vue';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { defineComponent, PropType } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport {\n\tICopyObjectToClipboardAction,\n\tIObject,\n\tISetLabelMutation,\n\tISetNameboxWidthMutation,\n\tISetObjectZoomMutation,\n\tISetTextBoxColor,\n} from '@/store/objects';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { textboxDefaultColor } from '@/constants/textBoxCustom';\nimport { NameboxWidth } from '@/constants/textBox';\n\nconst setable = genericSetable<IPoem>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tTextEditor,\n\t\tImageOptions,\n\t\tColor,\n\t\tModalDialog,\n\t\tDFieldset,\n\t},\n\tprops: {\n\t\tobject: {\n\t\t\ttype: Object as PropType<IObject>,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: String,\n\t\ttextHandler: {\n\t\t\ttype: Object as PropType<Handler>,\n\t\t},\n\t\tcolorHandler: {\n\t\t\ttype: Object as PropType<Handler>,\n\t\t},\n\t\tshowAltPanel: Boolean,\n\t},\n\tdata: () => ({\n\t\timageOptionsOpen: false,\n\t\tcanEdit: true,\n\t\tmodalNameInput: '',\n\t\tshowRename: false,\n\t\tlocalColorHandler: null as Handler | null,\n\t}),\n\tcomputed: {\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\trotation: setable('rotation', 'objects/setRotation'),\n\t\tenlargeWhenTalking: setable(\n\t\t\t'enlargeWhenTalking',\n\t\t\t'objects/setEnlargeWhenTalking'\n\t\t),\n\t\tnameboxWidth: {\n\t\t\tget(): string {\n\t\t\t\tconst val = this.object.nameboxWidth;\n\t\t\t\tif (val === null) return '';\n\t\t\t\treturn val + '';\n\t\t\t},\n\t\t\tset(value: string) {\n\t\t\t\tconst val = value.trim() === '' ? null : parseInt(value);\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setObjectNameboxWidth', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\tnameboxWidth: val,\n\t\t\t\t\t} as ISetNameboxWidthMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tzoom: {\n\t\t\tget(): number {\n\t\t\t\treturn this.object.zoom * 100;\n\t\t\t},\n\t\t\tset(zoom: number): void {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setObjectZoom', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\tzoom: zoom / 100,\n\t\t\t\t\t} as ISetObjectZoomMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tdefaultNameboxWidth(): number {\n\t\t\treturn NameboxWidth;\n\t\t},\n\t\tfinalColorHandler(): Handler | null {\n\t\t\treturn this.localColorHandler || this.colorHandler || null;\n\t\t},\n\t\thasLabel(): boolean {\n\t\t\treturn this.object.label !== null;\n\t\t},\n\t\theading(): string {\n\t\t\tconsole.log('heading', this.object.label, this.title, 'Object');\n\t\t\treturn this.object.label || this.title || 'Object';\n\t\t},\n\t\tuseCustomTextboxColor: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.object.textboxColor !== null;\n\t\t\t},\n\t\t\tset(val: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setTextboxColor', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\ttextboxColor: val ? textboxDefaultColor : null,\n\t\t\t\t\t} as ICopyObjectToClipboardAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t},\n\tmethods: {\n\t\tcopy() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/copyObjectToClipboard', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as ICopyObjectToClipboardAction);\n\t\t\t});\n\t\t},\n\t\tenableNameEdit() {\n\t\t\tthis.modalNameInput = this.object.label || '';\n\t\t\tthis.showRename = true;\n\t\t},\n\t\trenameOption(option: 'Apply' | 'Cancel') {\n\t\t\tthis.showRename = false;\n\t\t\tif (option === 'Apply') {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setLabel', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\tlabel: this.modalNameInput,\n\t\t\t\t\t} as ISetLabelMutation);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tselectTextboxColor() {\n\t\t\tthis.localColorHandler = {\n\t\t\t\ttitle: 'Textbox color',\n\t\t\t\tget: () => this.object.textboxColor,\n\t\t\t\tset: (color: string) => {\n\t\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\t\tthis.$store.commit('objects/setTextboxColor', {\n\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\ttextboxColor: color,\n\t\t\t\t\t\t} as ISetTextBoxColor);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.localColorHandler = null;\n\t\t\t\t},\n\t\t\t} as Handler;\n\t\t},\n\t},\n});\n\nexport interface Handler {\n\ttitle: string;\n\tget: () => string;\n\tset: (value: string) => void;\n\tleave: () => void;\n}\n","import { render } from \"./object-tool.vue?vue&type=template&id=585ac6ce&scoped=true\"\nimport script from \"./object-tool.vue?vue&type=script&lang=ts\"\nexport * from \"./object-tool.vue?vue&type=script&lang=ts\"\n\nimport \"./object-tool.vue?vue&type=style&index=0&id=585ac6ce&lang=scss&scoped=true\"\nimport \"./object-tool.vue?vue&type=style&index=1&id=585ac6ce&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-585ac6ce\"\n\nexport default script","\nimport {\n\tgetData,\n\tgetParts,\n\tISeekPoseAction,\n\tISeekPosePartAction,\n\tICharacter,\n\tISeekStyleAction,\n} from '@/store/objectTypes/characters';\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport Parts from './character/parts.vue';\nimport { Character } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport { PanelMixin } from './panelMixin';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool from './object-tool.vue';\n\nconst setable = genericSetable<ICharacter>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tParts,\n\t\tDFieldset,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\tpanelForParts: null as string | null,\n\t}),\n\tcomputed: {\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\tcloseUp: setable('close', 'objects/setClose'),\n\t\tselection(): string {\n\t\t\treturn this.$store.state.ui.selection!;\n\t\t},\n\t\tobject(): DeepReadonly<ICharacter> {\n\t\t\tconst obj = this.$store.state.objects.objects[this.selection];\n\t\t\tif (obj.type !== 'character') return undefined!;\n\t\t\treturn obj as ICharacter;\n\t\t},\n\t\tcharData(): DeepReadonly<Character<IAsset>> {\n\t\t\treturn getData(this.$store, this.object);\n\t\t},\n\t\tlabel(): string {\n\t\t\treturn this.charData.label || '';\n\t\t},\n\t\tparts(): DeepReadonly<string[]> {\n\t\t\treturn getParts(this.charData, this.object);\n\t\t},\n\t\thasMultipleStyles(): boolean {\n\t\t\treturn (\n\t\t\t\tthis.charData.styleGroups[this.object.styleGroupId].styles.length > 1 ||\n\t\t\t\tthis.charData.styleGroups.length > 1\n\t\t\t);\n\t\t},\n\t\thasMultiplePoses(): boolean {\n\t\t\tconst styleGroup = this.charData.styleGroups[this.object.styleGroupId];\n\t\t\tconst style = styleGroup.styles[this.object.styleId];\n\t\t\treturn style.poses.length > 1;\n\t\t},\n\t},\n\tmethods: {\n\t\tseekPose(delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekPose', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as ISeekPoseAction);\n\t\t\t});\n\t\t},\n\t\tseekStyle(delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekStyle', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as ISeekStyleAction);\n\t\t\t});\n\t\t},\n\t\tseekPart(part: string, delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekPart', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t\tpart,\n\t\t\t\t} as ISeekPosePartAction);\n\t\t\t});\n\t\t},\n\t\tcaptialize(str: string) {\n\t\t\treturn str.charAt(0).toUpperCase() + str.substring(1);\n\t\t},\n\t},\n\twatch: {\n\t\tselection() {\n\t\t\tthis.panelForParts = null;\n\t\t},\n\t},\n});\n","import { render } from \"./character.vue?vue&type=template&id=47403597&scoped=true\"\nimport script from \"./character.vue?vue&type=script&lang=ts\"\nexport * from \"./character.vue?vue&type=script&lang=ts\"\n\nimport \"./character.vue?vue&type=style&index=0&id=47403597&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-47403597\"\n\nexport default script","<template>\n\t<object-tool :object=\"object\" title=\"Custom Sprite\" />\n</template>\n\n<script lang=\"ts\">\nimport ObjectTool from '@/components/toolbox/tools/object-tool.vue';\nimport { ISprite } from '@/store/objectTypes/sprite';\nimport { PanelMixin } from './panelMixin';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { ObjectTool },\n\tcomputed: {\n\t\tobject(): ISprite {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'sprite') return undefined!;\n\t\t\treturn obj as ISprite;\n\t\t},\n\t},\n});\n</script>\n","\nimport ObjectTool from '@/components/toolbox/tools/object-tool.vue';\nimport { ISprite } from '@/store/objectTypes/sprite';\nimport { PanelMixin } from './panelMixin';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { ObjectTool },\n\tcomputed: {\n\t\tobject(): ISprite {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'sprite') return undefined!;\n\t\t\treturn obj as ISprite;\n\t\t},\n\t},\n});\n","import { render } from \"./sprite.vue?vue&type=template&id=444b96a8\"\nimport script from \"./sprite.vue?vue&type=script&lang=ts\"\nexport * from \"./sprite.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n\t<object-tool\n\t\t:object=\"object\"\n\t\ttitle=\"Textbox\"\n\t\t:textHandler=\"textHandler\"\n\t\t:colorHandler=\"colorHandler\"\n\t>\n\t\t<template v-slot:default>\n\t\t\t<table class=\"upper-combos\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"text_style\">Style:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t<select id=\"text_style\" v-model=\"textBoxStyle\" @keydown.stop>\n\t\t\t\t\t\t\t<option value=\"normal\">Normal</option>\n\t\t\t\t\t\t\t<option value=\"corrupt\">Corrupt</option>\n\t\t\t\t\t\t\t<option value=\"custom\">Custom</option>\n\t\t\t\t\t\t\t<option value=\"none\">None</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"current_talking\">Person talking:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<select id=\"current_talking\" v-model=\"talkingObjId\" @keydown.stop>\n\t\t\t\t\t\t\t<option value=\"$null$\">No-one</option>\n\t\t\t\t\t\t\t<option v-for=\"[id, label] in nameList\" :key=\"id\" :value=\"id\">{{\n\t\t\t\t\t\t\t\tlabel\n\t\t\t\t\t\t\t}}</option>\n\t\t\t\t\t\t\t<option value=\"$other$\">Other</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttitle=\"Jump to talking character\"\n\t\t\t\t\t\t\t@click=\"jumpToCharacter\"\n\t\t\t\t\t\t\t:disabled=\"\n\t\t\t\t\t\t\t\ttalkingObjId === '$null$' || talkingObjId === '$other$'\n\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"custom_name\">Other name:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input id=\"custom_name\" v-model=\"talkingOther\" @keydown.stop />\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"textEditor = 'name'\">...</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\n\t\t\t<toggle label=\"Auto quoting?\" v-model=\"autoQuoting\" />\n\t\t\t<toggle label=\"Auto line wrap?\" v-model=\"autoWrap\" />\n\t\t\t<div id=\"dialog_text_wrapper\">\n\t\t\t\t<label for=\"dialog_text\">Dialog:</label>\n\t\t\t\t<textarea v-model=\"dialog\" id=\"dialog_text\" @keydown.stop />\n\t\t\t\t<button @click=\"textEditor = 'body'\">Formatting</button>\n\t\t\t</div>\n\t\t</template>\n\t\t<template v-slot:options>\n\t\t\t<d-fieldset\n\t\t\t\ttitle=\"Customization:\"\n\t\t\t\t:class=\"textBoxStyle === 'custom' ? 'customization-set' : ''\"\n\t\t\t>\n\t\t\t\t<d-flow direction=\"vertical\" maxSize=\"100%\" no-wraping>\n\t\t\t\t\t<toggle label=\"Controls visible?\" v-model=\"showControls\" />\n\t\t\t\t\t<toggle label=\"Able to skip?\" v-model=\"allowSkipping\" />\n\t\t\t\t\t<toggle label=\"Continue arrow?\" v-model=\"showContinueArrow\" />\n\t\t\t\t\t<table v-if=\"textBoxStyle === 'custom'\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"custom_namebox_width\">Namebox width:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"custom_namebox_width\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tstyle=\"width: 48px;\"\n\t\t\t\t\t\t\t\t\tv-model.number=\"customNameboxWidth\"\n\t\t\t\t\t\t\t\t\t:disabled=\"overrideColor\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t\t\t<toggle v-model=\"overrideColor\" label=\"Override color\" />\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-if=\"overrideColor\">\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"textbox_color\">Color:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tid=\"textbox_color\"\n\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t:style=\"{ background: object.customColor }\"\n\t\t\t\t\t\t\t\t\t@click=\"colorSelect = 'base'\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-if=\"overrideColor\">\n\t\t\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t\t\t<toggle\n\t\t\t\t\t\t\t\t\tid=\"derive_custom_colors\"\n\t\t\t\t\t\t\t\t\tv-model=\"deriveCustomColors\"\n\t\t\t\t\t\t\t\t\tlabel=\"Derive other colors\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<template v-if=\"overrideColor && !deriveCustomColors\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<label for=\"custom_controls_color\">Controls Color:</label>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tid=\"custom_controls_color\"\n\t\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t\t:style=\"{ background: object.customControlsColor }\"\n\t\t\t\t\t\t\t\t\t\t@click=\"colorSelect = 'controls'\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<label for=\"custom_namebox_color\">Namebox Color:</label>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tid=\"custom_namebox_color\"\n\t\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t\t:style=\"{ background: object.customNameboxColor }\"\n\t\t\t\t\t\t\t\t\t\t@click=\"colorSelect = 'namebox'\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<label for=\"custom_namebox_stroke\"\n\t\t\t\t\t\t\t\t\t\t>Namebox text stroke:</label\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tid=\"custom_namebox_stroke\"\n\t\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t\t:style=\"{ background: object.customNameboxStroke }\"\n\t\t\t\t\t\t\t\t\t\t@click=\"colorSelect = 'nameboxStroke'\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</table>\n\t\t\t\t</d-flow>\n\t\t\t</d-fieldset>\n\t\t\t<button @click=\"resetPosition\">Reset position</button>\n\t\t\t<button @click=\"splitTextbox\">Split textbox</button>\n\t\t</template>\n\t</object-tool>\n</template>\n\n<script lang=\"ts\">\nimport {\n\tITextBox,\n\tISetTextBoxCustomColorMutation,\n\tISetTextBoxCustomControlsColorMutation,\n\tISetTextBoxNameboxColorMutation,\n\tISetTextBoxNameboxStrokeMutation,\n\tISplitTextbox,\n\tIResetTextboxBounds,\n\tISetTextBoxTalkingObjMutation,\n} from '@/store/objectTypes/textbox';\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport { defineComponent } from 'vue';\nimport { exhaust } from '@/util/exhaust';\nimport { PanelMixin } from './panelMixin';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool, { Handler } from './object-tool.vue';\n\nconst setable = genericSetable<ITextBox>();\n\nexport default defineComponent({\n\tcomponents: {\n\t\tToggle,\n\t\tDFieldset,\n\t\tObjectTool,\n\t\tDFlow,\n\t},\n\tmixins: [PanelMixin],\n\tdata: () => ({\n\t\ttextEditor: '' as '' | 'name' | 'body',\n\t\tcolorSelect: '' as '' | 'base' | 'controls' | 'namebox' | 'nameboxStroke',\n\t}),\n\tcomputed: {\n\t\tobject(): ITextBox {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'textBox') return undefined!;\n\t\t\treturn obj as ITextBox;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: this.textEditorName,\n\t\t\t\tget: () => {\n\t\t\t\t\tif (this.textEditor === 'name') return this.object.talkingOther;\n\t\t\t\t\tif (this.textEditor === 'body') return this.dialog;\n\t\t\t\t\treturn '';\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tif (this.textEditor === 'name') this.talkingOther = text;\n\t\t\t\t\telse if (this.textEditor === 'body') this.dialog = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = '';\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tcolorHandler(): Handler | undefined {\n\t\t\tif (!this.colorSelect) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: this.colorName,\n\t\t\t\tget: () => {\n\t\t\t\t\tswitch (this.colorSelect) {\n\t\t\t\t\t\tcase '':\n\t\t\t\t\t\t\treturn '#000000';\n\t\t\t\t\t\tcase 'base':\n\t\t\t\t\t\t\treturn this.object.customColor;\n\t\t\t\t\t\tcase 'controls':\n\t\t\t\t\t\t\treturn this.object.customControlsColor;\n\t\t\t\t\t\tcase 'namebox':\n\t\t\t\t\t\t\treturn this.object.customNameboxColor;\n\t\t\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\t\t\treturn this.object.customNameboxStroke;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\texhaust(this.colorSelect);\n\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tset: (color: string) => {\n\t\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\t\tswitch (this.colorSelect) {\n\t\t\t\t\t\t\tcase '':\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'base':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setCustomColor', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\t\t} as ISetTextBoxCustomColorMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'controls':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setControlsColor', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcustomControlsColor: color,\n\t\t\t\t\t\t\t\t} as ISetTextBoxCustomControlsColorMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'namebox':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setNameboxColor', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcustomNameboxColor: color,\n\t\t\t\t\t\t\t\t} as ISetTextBoxNameboxColorMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setNameboxStroke', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcustomNameboxStroke: color,\n\t\t\t\t\t\t\t\t} as ISetTextBoxNameboxStrokeMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.colorSelect = '';\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttalkingObjId: {\n\t\t\tget(): string {\n\t\t\t\treturn this.object.talkingObjId || '$null$';\n\t\t\t},\n\t\t\tset(val: string): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setTalkingObject', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\ttalkingObjId: val === '$null$' ? null : val,\n\t\t\t\t\t} as ISetTextBoxTalkingObjMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ttalkingOther: setable('talkingOther', 'objects/setTalkingOther'),\n\t\tshowControls: setable('controls', 'objects/setControlsVisible'),\n\t\tallowSkipping: setable('skip', 'objects/setSkipable'),\n\t\tautoQuoting: setable('autoQuoting', 'objects/setAutoQuoting'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\tshowContinueArrow: setable('continue', 'objects/setContinueArrow'),\n\t\tdialog: setable('text', 'objects/setText'),\n\t\ttextBoxStyle: setable('style', 'objects/setStyle'),\n\t\toverrideColor: setable('overrideColor', 'objects/setColorOverride'),\n\t\tderiveCustomColors: setable(\n\t\t\t'deriveCustomColors',\n\t\t\t'objects/setDeriveCustomColors'\n\t\t),\n\t\tcustomNameboxWidth: setable(\n\t\t\t'customNameboxWidth',\n\t\t\t'objects/setNameboxWidth'\n\t\t),\n\t\tnameList(): [string, string][] {\n\t\t\tconst panel = this.$store.state.objects.panels[\n\t\t\t\tthis.$store.state.panels.currentPanel\n\t\t\t];\n\n\t\t\tconst ret: [string, string][] = [];\n\n\t\t\tfor (const id of [...panel.order, ...panel.onTopOrder]) {\n\t\t\t\tconst obj = this.$store.state.objects.objects[id];\n\t\t\t\tif (obj.label === null) continue;\n\t\t\t\tret.push([id, obj.label!]);\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\ttextEditorName(): string {\n\t\t\tif (this.textEditor === 'name') return 'Name';\n\t\t\tif (this.textEditor === 'body') return 'Dialog';\n\t\t\treturn '';\n\t\t},\n\t\tcustomControlsColor(): string {\n\t\t\treturn this.object.customControlsColor;\n\t\t},\n\t\tcolorName(): string {\n\t\t\tswitch (this.colorSelect) {\n\t\t\t\tcase '':\n\t\t\t\t\treturn '';\n\t\t\t\tcase 'base':\n\t\t\t\t\treturn 'Base color';\n\t\t\t\tcase 'controls':\n\t\t\t\t\treturn 'Controls color';\n\t\t\t\tcase 'namebox':\n\t\t\t\t\treturn 'Namebox color';\n\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\treturn 'Namebox text stroke';\n\t\t\t\tdefault:\n\t\t\t\t\texhaust(this.colorSelect);\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\tsplitTextbox(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/splitTextbox', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as ISplitTextbox);\n\t\t\t});\n\t\t},\n\t\tresetPosition(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/resetTextboxBounds', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as IResetTextboxBounds);\n\t\t\t});\n\t\t},\n\t\tjumpToCharacter(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.commit('ui/setSelection', this.talkingObjId);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n<style lang=\"scss\" scoped>\n.panel {\n\t&.vertical {\n\t\t#dialog_text_wrapper {\n\t\t\twidth: 173px;\n\n\t\t\ttextarea {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\ttable {\n\t\t\twidth: 100%;\n\n\t\t\tinput,\n\t\t\tselect {\n\t\t\t\twidth: 100px;\n\t\t\t}\n\t\t}\n\t}\n\n\ttextarea {\n\t\tdisplay: block;\n\t\theight: 114px;\n\t}\n\n\t&:not(.vertical) {\n\t\ttable.upper-combos {\n\t\t\twidth: 256px;\n\n\t\t\tselect {\n\t\t\t\twidth: 100px;\n\t\t\t}\n\t\t\tinput {\n\t\t\t\twidth: 75px;\n\t\t\t}\n\t\t\tbutton {\n\t\t\t\twidth: 25px;\n\t\t\t}\n\t\t}\n\n\t\t.customization-set {\n\t\t\t@include height-100();\n\t\t}\n\t}\n}\n\n.color-button {\n\theight: 24px;\n\twidth: 48px;\n\tvertical-align: middle;\n}\n</style>\n","\nimport {\n\tITextBox,\n\tISetTextBoxCustomColorMutation,\n\tISetTextBoxCustomControlsColorMutation,\n\tISetTextBoxNameboxColorMutation,\n\tISetTextBoxNameboxStrokeMutation,\n\tISplitTextbox,\n\tIResetTextboxBounds,\n\tISetTextBoxTalkingObjMutation,\n} from '@/store/objectTypes/textbox';\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport { defineComponent } from 'vue';\nimport { exhaust } from '@/util/exhaust';\nimport { PanelMixin } from './panelMixin';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool, { Handler } from './object-tool.vue';\n\nconst setable = genericSetable<ITextBox>();\n\nexport default defineComponent({\n\tcomponents: {\n\t\tToggle,\n\t\tDFieldset,\n\t\tObjectTool,\n\t\tDFlow,\n\t},\n\tmixins: [PanelMixin],\n\tdata: () => ({\n\t\ttextEditor: '' as '' | 'name' | 'body',\n\t\tcolorSelect: '' as '' | 'base' | 'controls' | 'namebox' | 'nameboxStroke',\n\t}),\n\tcomputed: {\n\t\tobject(): ITextBox {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'textBox') return undefined!;\n\t\t\treturn obj as ITextBox;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: this.textEditorName,\n\t\t\t\tget: () => {\n\t\t\t\t\tif (this.textEditor === 'name') return this.object.talkingOther;\n\t\t\t\t\tif (this.textEditor === 'body') return this.dialog;\n\t\t\t\t\treturn '';\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tif (this.textEditor === 'name') this.talkingOther = text;\n\t\t\t\t\telse if (this.textEditor === 'body') this.dialog = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = '';\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tcolorHandler(): Handler | undefined {\n\t\t\tif (!this.colorSelect) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: this.colorName,\n\t\t\t\tget: () => {\n\t\t\t\t\tswitch (this.colorSelect) {\n\t\t\t\t\t\tcase '':\n\t\t\t\t\t\t\treturn '#000000';\n\t\t\t\t\t\tcase 'base':\n\t\t\t\t\t\t\treturn this.object.customColor;\n\t\t\t\t\t\tcase 'controls':\n\t\t\t\t\t\t\treturn this.object.customControlsColor;\n\t\t\t\t\t\tcase 'namebox':\n\t\t\t\t\t\t\treturn this.object.customNameboxColor;\n\t\t\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\t\t\treturn this.object.customNameboxStroke;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\texhaust(this.colorSelect);\n\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tset: (color: string) => {\n\t\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\t\tswitch (this.colorSelect) {\n\t\t\t\t\t\t\tcase '':\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'base':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setCustomColor', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\t\t} as ISetTextBoxCustomColorMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'controls':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setControlsColor', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcustomControlsColor: color,\n\t\t\t\t\t\t\t\t} as ISetTextBoxCustomControlsColorMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'namebox':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setNameboxColor', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcustomNameboxColor: color,\n\t\t\t\t\t\t\t\t} as ISetTextBoxNameboxColorMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setNameboxStroke', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcustomNameboxStroke: color,\n\t\t\t\t\t\t\t\t} as ISetTextBoxNameboxStrokeMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.colorSelect = '';\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttalkingObjId: {\n\t\t\tget(): string {\n\t\t\t\treturn this.object.talkingObjId || '$null$';\n\t\t\t},\n\t\t\tset(val: string): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setTalkingObject', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\ttalkingObjId: val === '$null$' ? null : val,\n\t\t\t\t\t} as ISetTextBoxTalkingObjMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ttalkingOther: setable('talkingOther', 'objects/setTalkingOther'),\n\t\tshowControls: setable('controls', 'objects/setControlsVisible'),\n\t\tallowSkipping: setable('skip', 'objects/setSkipable'),\n\t\tautoQuoting: setable('autoQuoting', 'objects/setAutoQuoting'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\tshowContinueArrow: setable('continue', 'objects/setContinueArrow'),\n\t\tdialog: setable('text', 'objects/setText'),\n\t\ttextBoxStyle: setable('style', 'objects/setStyle'),\n\t\toverrideColor: setable('overrideColor', 'objects/setColorOverride'),\n\t\tderiveCustomColors: setable(\n\t\t\t'deriveCustomColors',\n\t\t\t'objects/setDeriveCustomColors'\n\t\t),\n\t\tcustomNameboxWidth: setable(\n\t\t\t'customNameboxWidth',\n\t\t\t'objects/setNameboxWidth'\n\t\t),\n\t\tnameList(): [string, string][] {\n\t\t\tconst panel = this.$store.state.objects.panels[\n\t\t\t\tthis.$store.state.panels.currentPanel\n\t\t\t];\n\n\t\t\tconst ret: [string, string][] = [];\n\n\t\t\tfor (const id of [...panel.order, ...panel.onTopOrder]) {\n\t\t\t\tconst obj = this.$store.state.objects.objects[id];\n\t\t\t\tif (obj.label === null) continue;\n\t\t\t\tret.push([id, obj.label!]);\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\ttextEditorName(): string {\n\t\t\tif (this.textEditor === 'name') return 'Name';\n\t\t\tif (this.textEditor === 'body') return 'Dialog';\n\t\t\treturn '';\n\t\t},\n\t\tcustomControlsColor(): string {\n\t\t\treturn this.object.customControlsColor;\n\t\t},\n\t\tcolorName(): string {\n\t\t\tswitch (this.colorSelect) {\n\t\t\t\tcase '':\n\t\t\t\t\treturn '';\n\t\t\t\tcase 'base':\n\t\t\t\t\treturn 'Base color';\n\t\t\t\tcase 'controls':\n\t\t\t\t\treturn 'Controls color';\n\t\t\t\tcase 'namebox':\n\t\t\t\t\treturn 'Namebox color';\n\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\treturn 'Namebox text stroke';\n\t\t\t\tdefault:\n\t\t\t\t\texhaust(this.colorSelect);\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\tsplitTextbox(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/splitTextbox', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as ISplitTextbox);\n\t\t\t});\n\t\t},\n\t\tresetPosition(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/resetTextboxBounds', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as IResetTextboxBounds);\n\t\t\t});\n\t\t},\n\t\tjumpToCharacter(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.commit('ui/setSelection', this.talkingObjId);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./textbox.vue?vue&type=template&id=07f8e3d3&scoped=true\"\nimport script from \"./textbox.vue?vue&type=script&lang=ts\"\nexport * from \"./textbox.vue?vue&type=script&lang=ts\"\n\nimport \"./textbox.vue?vue&type=style&index=0&id=07f8e3d3&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-07f8e3d3\"\n\nexport default script","<template>\n\t<object-tool :object=\"object\" title=\"Choice\" :textHandler=\"textHandler\">\n\t\t<d-fieldset class=\"buttons\" title=\"Buttons:\">\n\t\t\t<d-flow maxSize=\"100%\" direction=\"vertical\" noWraping>\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"(button, btnIdx) in buttons\"\n\t\t\t\t\t:class=\"{ choiceBtn: true, active: btnIdx === currentIdx }\"\n\t\t\t\t\t:key=\"btnIdx\"\n\t\t\t\t\t@click=\"select(btnIdx)\"\n\t\t\t\t>\n\t\t\t\t\t{{ button.text.trim() === '' ? '[Empty]' : button.text }}\n\t\t\t\t</div>\n\t\t\t</d-flow>\n\t\t</d-fieldset>\n\t\t<d-fieldset class=\"current_button\" title=\"Current button:\">\n\t\t\t<table>\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t<label for=\"choice-button-input\">Text</label>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"choice-button-input\"\n\t\t\t\t\t\t\tv-model=\"buttonText\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"textEditor = true\">...</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</d-fieldset>\n\t\t<button @click=\"addChoice\">Add</button>\n\t\t<button @click=\"removeChoice\">Remove</button>\n\t\t<toggle label=\"Auto line wrap?\" v-model=\"autoWrap\" />\n\t</object-tool>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IChoices, IRemoveChoiceAction } from '@/store/objectTypes/choices';\nimport { IChoice, IAddChoiceAction } from '@/store/objectTypes/choices';\nimport { DeepReadonly } from '@/util/readonly';\nimport { ComponentCustomProperties, defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool, { Handler } from './object-tool.vue';\n\nconst setable = genericSetable<IChoices>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tDFieldset,\n\t\tDFlow,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\tcurrentIdx: 0,\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): IChoices {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'choice') return undefined!;\n\t\t\treturn obj as IChoices;\n\t\t},\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\t// eslint-disable-next-line @typescript-eslint/camelcase\n\t\tbuttonText: simpleButtonSettable('text', 'objects/setChoiceText', true),\n\t\tbuttons(): DeepReadonly<IChoice[]> {\n\t\t\treturn this.object.choices;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: 'Text',\n\t\t\t\tget: () => {\n\t\t\t\t\treturn this.buttonText;\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tthis.buttonText = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = false;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tselect(idx: number): void {\n\t\t\tthis.currentIdx = idx;\n\t\t},\n\t\taddChoice(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/addChoice', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\ttext: '',\n\t\t\t\t} as IAddChoiceAction);\n\t\t\t});\n\t\t},\n\t\tremoveChoice(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tif (\n\t\t\t\t\tthis.currentIdx === this.object.choices.length - 1 &&\n\t\t\t\t\tthis.currentIdx > 0\n\t\t\t\t) {\n\t\t\t\t\tthis.select(this.currentIdx - 1);\n\t\t\t\t}\n\t\t\t\tthis.$store.dispatch('objects/removeChoice', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tchoiceIdx: this.currentIdx,\n\t\t\t\t} as IRemoveChoiceAction);\n\t\t\t});\n\t\t},\n\t},\n});\n\nfunction simpleButtonSettable<K extends keyof IChoice>(\n\tkey: K,\n\tmessage: string,\n\taction = false\n) {\n\treturn {\n\t\tget(this: IThis): IChoice[K] {\n\t\t\treturn this.object.choices[this.currentIdx][key];\n\t\t},\n\t\tset(this: IThis, val: IChoice[K]): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store[action ? 'dispatch' : 'commit'](message, {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tchoiceIdx: this.currentIdx,\n\t\t\t\t\t[key]: val,\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t};\n}\n\ninterface IThis extends ComponentCustomProperties {\n\tobject: IChoices;\n\tcurrentIdx: number;\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.choiceBtn {\n\toverflow: hidden;\n\twidth: 100%;\n\theight: 24px;\n\tmax-width: 100%;\n\ttext-overflow: ellipsis;\n\tpadding: 2px;\n\n\t&.active {\n\t\tbackground-color: $default-border;\n\t\tbackground-color: var(--border);\n\t}\n}\n\n.current_button {\n\tinput {\n\t\twidth: 130px;\n\t}\n}\n\n.panel.vertical {\n\t.buttons {\n\t\tmax-height: 200px;\n\t\twidth: 100%;\n\n\t\t> .list {\n\t\t\twidth: 172px;\n\n\t\t\t* {\n\t\t\t\twidth: 100%;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\tpadding: 2px;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.panel:not(.vertical) {\n\t.buttons {\n\t\t@include height-100();\n\t\twidth: 161px;\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IChoices, IRemoveChoiceAction } from '@/store/objectTypes/choices';\nimport { IChoice, IAddChoiceAction } from '@/store/objectTypes/choices';\nimport { DeepReadonly } from '@/util/readonly';\nimport { ComponentCustomProperties, defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool, { Handler } from './object-tool.vue';\n\nconst setable = genericSetable<IChoices>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tDFieldset,\n\t\tDFlow,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\tcurrentIdx: 0,\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): IChoices {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'choice') return undefined!;\n\t\t\treturn obj as IChoices;\n\t\t},\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\t// eslint-disable-next-line @typescript-eslint/camelcase\n\t\tbuttonText: simpleButtonSettable('text', 'objects/setChoiceText', true),\n\t\tbuttons(): DeepReadonly<IChoice[]> {\n\t\t\treturn this.object.choices;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: 'Text',\n\t\t\t\tget: () => {\n\t\t\t\t\treturn this.buttonText;\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tthis.buttonText = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = false;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tselect(idx: number): void {\n\t\t\tthis.currentIdx = idx;\n\t\t},\n\t\taddChoice(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/addChoice', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\ttext: '',\n\t\t\t\t} as IAddChoiceAction);\n\t\t\t});\n\t\t},\n\t\tremoveChoice(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tif (\n\t\t\t\t\tthis.currentIdx === this.object.choices.length - 1 &&\n\t\t\t\t\tthis.currentIdx > 0\n\t\t\t\t) {\n\t\t\t\t\tthis.select(this.currentIdx - 1);\n\t\t\t\t}\n\t\t\t\tthis.$store.dispatch('objects/removeChoice', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tchoiceIdx: this.currentIdx,\n\t\t\t\t} as IRemoveChoiceAction);\n\t\t\t});\n\t\t},\n\t},\n});\n\nfunction simpleButtonSettable<K extends keyof IChoice>(\n\tkey: K,\n\tmessage: string,\n\taction = false\n) {\n\treturn {\n\t\tget(this: IThis): IChoice[K] {\n\t\t\treturn this.object.choices[this.currentIdx][key];\n\t\t},\n\t\tset(this: IThis, val: IChoice[K]): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store[action ? 'dispatch' : 'commit'](message, {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tchoiceIdx: this.currentIdx,\n\t\t\t\t\t[key]: val,\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t};\n}\n\ninterface IThis extends ComponentCustomProperties {\n\tobject: IChoices;\n\tcurrentIdx: number;\n}\n","import { render } from \"./choice.vue?vue&type=template&id=6218d3d4&scoped=true\"\nimport script from \"./choice.vue?vue&type=script&lang=ts\"\nexport * from \"./choice.vue?vue&type=script&lang=ts\"\n\nimport \"./choice.vue?vue&type=style&index=0&id=6218d3d4&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-6218d3d4\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>Help and Credits</h1>\n\t\t<l class=\"btn\" to=\"wiki://Dokumentation\">Help</l>\n\t\t<l class=\"btn\" to=\"github://\">Fork me on GitHub</l>\n\t\t<l class=\"btn\" to=\"wiki://Privacy Statement\">Privacy Statement</l>\n\t\t<p>\n\t\t\tAll assets used are IP of Team Salvato and created by them, unless noted\n\t\t\totherwise.\n\t\t</p>\n\t\t<p>\n\t\t\tDoki Doki Dialog Generator developed by EDave64\n\t\t\t<br />Based on gemdude46's DDLC Shitpost generator\n\t\t</p>\n\t\t<p>\n\t\t\tUnused House Background by\n\t\t\t<l\n\t\t\t\tto=\"https://www.deviantart.com/fatelogic/art/VN-Background-Practice-295671161\"\n\t\t\t>\n\t\t\t\tFatelogic\n\t\t\t</l>\n\t\t</p>\n\t\t<p>\n\t\t\tAller Font by\n\t\t\t<l to=\"https://www.daltonmaag.com/library/aller\">Dalton Maag Ltd</l>\n\t\t</p>\n\t\t<p>\n\t\t\tRiffic Bold Font by\n\t\t\t<l to=\"https://www.fontspring.com/fonts/inky-type/riffic\">InkyType</l>\n\t\t</p>\n\t\t<p>\n\t\t\tVerily Serif Mono Font by\n\t\t\t<l to=\"https://www.dafont.com/verily-serif-mono.font\"\n\t\t\t\t>Stephen G. Hartke</l\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tF25 Bank Printer Font by\n\t\t\t<l to=\"https://www.dafont.com/f25-bank-printer.font\"\n\t\t\t\t>F25 Digital Typeface Design</l\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tJournal Font by\n\t\t\t<l to=\"https://www.dafont.com/journal.font\">Fontourist</l>\n\t\t</p>\n\t\t<p>\n\t\t\tHashtag Font by\n\t\t\t<l to=\"https://www.dafont.com/hashtag.font\"> TitanVex</l>\n\t\t</p>\n\t\t<p>\n\t\t\tJP Hand Slanted Font by\n\t\t\t<l to=\"https://www.dafont.com/jp-hand-slanted.font\">Jonathan Paterson</l>\n\t\t</p>\n\t\t<p>\n\t\t\tAs I Lay Dying Font by\n\t\t\t<l to=\"https://www.dafont.com/as-i-lay-dying.font\">Moises Esqueda</l>\n\t\t</p>\n\t\t<p>\n\t\t\tDamagrafik Script Font by\n\t\t\t<l to=\"https://www.dafont.com/damagrafik-script.font\">Davide Terenzi</l>\n\t\t</p>\n\t\t<p>\n\t\t\tAmmy's Handwriting Font by\n\t\t\t<l to=\"https://www.dafont.com/ammys-handwriting.font\">Ammy K.</l>\n\t\t</p>\n\t\t<p>\n\t\t\tHalogen Font by\n\t\t\t<l to=\"https://www.dafont.com/halogen.font\">JLH Fonts</l>\n\t\t</p>\n\t\t<p>\n\t\t\tMC Classic Sprite by Childish-N\n\t\t\t<br />MC Classic Chibi by GyleToTheRescue\n\t\t</p>\n\t\t<p>\n\t\t\tMC Sprite by Childish-N\n\t\t\t<br />MC Casual Sprite by SlightlySimple <br />MC Chibi by SlightlySimple\n\t\t</p>\n\t\t<p>\n\t\t\tMC Chad Sprite by Cylent-Nite\n\t\t\t<br />MC Chad Poses and expressions by SlightlySimple <br />MC Chad Poses\n\t\t\tand chibi by Meddy-sin\n\t\t</p>\n\t\t<p>\n\t\t\tFeMC Sprite by Meddy-sin\n\t\t\t<br />FeMC Casual Sprite by SlightlySimple\n\t\t</p>\n\t\t<p>Classic Amy Sprite by Meddy-sin</p>\n\t\t<p>Amy Sprite by Meddy-sin and SlightlySimple</p>\n\t\t<p>Special thanks to SlightlySimple for testing and technical help</p>\n\t\t<p>\n\t\t\tAtlas421, T-Rex Harris, smearglexd and Tactical Cupcakes for suggestions\n\t\t\tand testing\n\t\t</p>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { PanelMixin } from './panelMixin';\nimport L from '@/components/ui/link.vue';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { L },\n});\n</script>\n\n<style lang=\"scss\" scoped>\np {\n\tmargin: 4px;\n\tmax-width: 256px;\n}\n</style>\n","\nimport { PanelMixin } from './panelMixin';\nimport L from '@/components/ui/link.vue';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { L },\n});\n","import { render } from \"./credits.vue?vue&type=template&id=753d2b9a&scoped=true\"\nimport script from \"./credits.vue?vue&type=script&lang=ts\"\nexport * from \"./credits.vue?vue&type=script&lang=ts\"\n\nimport \"./credits.vue?vue&type=style&index=0&id=753d2b9a&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-753d2b9a\"\n\nexport default script","<template>\n\t<div class=\"panel\" @dragenter=\"dragEnter\" @mouseleave=\"$refs.dt.hide()\">\n\t\t<drop-target ref=\"dt\" class=\"drop-target\" @drop=\"addImageFile\"\n\t\t\t>Drop here to add as a new background</drop-target\n\t\t>\n\t\t<h1>Background</h1>\n\t\t<color v-if=\"colorSelect\" v-model=\"bgColor\" @leave=\"colorSelect = false\" />\n\t\t<image-options\n\t\t\tv-else-if=\"imageOptions\"\n\t\t\ttype=\"background\"\n\t\t\ttitle=\"\"\n\t\t\t:id=\"$store.state.panels.currentPanel\"\n\t\t\tno-composition\n\t\t\t@leave=\"imageOptions = false\"\n\t\t/>\n\t\t<template v-else>\n\t\t\t<background-settings\n\t\t\t\t@change-color=\"colorSelect = true\"\n\t\t\t\t@open-image-options=\"imageOptions = true\"\n\t\t\t/>\n\n\t\t\t<div class=\"btn upload-background\" @click=\"$refs.upload.click()\">\n\t\t\t\tUpload\n\t\t\t\t<input type=\"file\" ref=\"upload\" @change=\"onFileUpload\" />\n\t\t\t</div>\n\t\t\t<button class=\"upload-background\" @click=\"addByUrl\">Add by URL</button>\n\t\t\t<button\n\t\t\t\tclass=\"upload-background\"\n\t\t\t\t@click=\"$emit('show-dialog', 'type: Backgrounds')\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\">extension</i> Search in content packs\n\t\t\t</button>\n\t\t\t<d-button\n\t\t\t\tv-if=\"showBackgroundsFolder\"\n\t\t\t\ticon=\"folder\"\n\t\t\t\tclass=\"upload-background\"\n\t\t\t\t@click=\"openBackgroundFolder\"\n\t\t\t>\n\t\t\t\tOpen sprites folder\n\t\t\t</d-button>\n\t\t\t<background-button\n\t\t\t\tv-for=\"background of backgrounds\"\n\t\t\t\t:key=\"background\"\n\t\t\t\t:backgroundId=\"background\"\n\t\t\t\t@input=\"setBackground(background)\"\n\t\t\t/>\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport BackgroundButton from './background/button.vue';\nimport BackgroundSettings from './background/settings.vue';\nimport ImageOptions from '../subtools/image-options/image-options.vue';\nimport DropTarget from '../drop-target.vue';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport {\n\tBackground,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { ISetCurrentMutation, ISetColorMutation } from '@/store/panels';\nimport { PanelMixin } from './panelMixin';\nimport Color from '../subtools/color/color.vue';\nimport { defineComponent } from 'vue';\nimport environment, { Folder } from '@/environments/environment';\nimport DButton from '@/components/ui/d-button.vue';\n\nconst uploadedBackgroundsPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.uploadedBackgrounds',\n\tdependencies: [],\n\tpackCredits: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tBackgroundButton,\n\t\tBackgroundSettings,\n\t\tDropTarget,\n\t\tColor,\n\t\tImageOptions,\n\t\tDButton,\n\t},\n\tdata: () => ({\n\t\tcolorSelect: false,\n\t\timageOptions: false,\n\t}),\n\tcomputed: {\n\t\tbgColor: {\n\t\t\tget(): string {\n\t\t\t\treturn this.$store.state.panels.panels[\n\t\t\t\t\tthis.$store.state.panels.currentPanel\n\t\t\t\t].background.color;\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundColor', {\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetColorMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tbackgrounds(): Array<Background<IAsset>['id']> {\n\t\t\treturn [\n\t\t\t\t...this.$store.state.content.current.backgrounds.map(\n\t\t\t\t\tbackground => background.id\n\t\t\t\t),\n\t\t\t\t'buildin.static-color',\n\t\t\t\t'buildin.transparent',\n\t\t\t];\n\t\t},\n\t\tshowBackgroundsFolder(): boolean {\n\t\t\treturn (environment.supports.openableFolders as ReadonlySet<Folder>).has(\n\t\t\t\t'backgrounds'\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tsetBackground(id: Background<IAsset>['id']) {\n\t\t\tthis.$store.commit('panels/setCurrentBackground', {\n\t\t\t\tcurrent: id,\n\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t} as ISetCurrentMutation);\n\t\t},\n\t\tonFileUpload(e: Event) {\n\t\t\tconst uploadInput = this.$refs.upload as HTMLInputElement;\n\t\t\tif (!uploadInput.files) return;\n\t\t\tfor (const file of uploadInput.files) {\n\t\t\t\tthis.addImageFile(file);\n\t\t\t}\n\t\t},\n\t\taddImageFile(file: File) {\n\t\t\tconst url = URL.createObjectURL(file);\n\t\t\tthis.addNewCustomBackground(file.name, file.name, url);\n\t\t},\n\t\taddByUrl() {\n\t\t\tconst url = prompt('Enter the URL of the image');\n\t\t\tif (!url) return;\n\t\t\tconst lastSegment = url.split('/').slice(-1)[0];\n\t\t\tthis.addNewCustomBackground(lastSegment, lastSegment, url);\n\t\t},\n\t\taddNewCustomBackground(\n\t\t\tid: Background<IAsset>['id'],\n\t\t\tlabel: string,\n\t\t\turl: string\n\t\t) {\n\t\t\tuploadedBackgroundsPack.backgrounds.push({\n\t\t\t\tid,\n\t\t\t\tlabel,\n\t\t\t\tvariants: [[url]],\n\t\t\t});\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: uploadedBackgroundsPack,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t\tthis.setBackground(id);\n\t\t\t});\n\t\t},\n\t\tdragEnter(e: DragEvent) {\n\t\t\tif (!e.dataTransfer) return;\n\t\t\te.dataTransfer.effectAllowed = 'none';\n\t\t\tif (\n\t\t\t\t!Array.from(e.dataTransfer.items).find(item =>\n\t\t\t\t\titem.type.match(/^image.*$/)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.dataTransfer.effectAllowed = 'link';\n\t\t\t(this.$refs.dt as any).show();\n\t\t},\n\t\topenBackgroundFolder() {\n\t\t\tenvironment.openFolder('backgrounds');\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\ntextarea {\n\tflex-grow: 1;\n}\n\n.upload-background {\n\tmargin-top: 4px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\theight: 48px;\n\tmin-height: 48px;\n\ttext-align: center;\n\tuser-select: none;\n\n\tinput {\n\t\tdisplay: none;\n\t}\n}\n\n#panels:not(.vertical) > .panel {\n\t> div,\n\tbutton {\n\t\t&:not(.drop-target) {\n\t\t\twidth: 12rem;\n\t\t}\n\t}\n}\n\n.vertical {\n\tfieldset {\n\t\tinput {\n\t\t\twidth: 60px;\n\t\t}\n\t}\n}\n</style>\n","<template>\n\t<div\n\t\t:class=\"{ background: true, active: isActive }\"\n\t\t:title=\"title\"\n\t\t:style=\"style\"\n\t\t@click=\"$emit('input', backgroundId)\"\n\t>\n\t\t{{ title }}\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { getAAsset } from '@/asset-manager';\nimport { Background } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, BackgroundLookup } from '@/store/content';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { IPanel } from '@/store/panels';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport default defineComponent({\n\tprops: {\n\t\tbackgroundId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\tassets: [] as Array<HTMLImageElement | ErrorAsset>,\n\t}),\n\tcomputed: {\n\t\tbackground(): DeepReadonly<IPanel['background']> {\n\t\t\tconst currentPanel = this.$store.state.panels.currentPanel;\n\t\t\treturn this.$store.state.panels.panels[currentPanel].background;\n\t\t},\n\n\t\tbgData(): Background<IAsset> | null {\n\t\t\tconst backgrounds: BackgroundLookup = this.$store.getters[\n\t\t\t\t'content/getBackgrounds'\n\t\t\t];\n\t\t\treturn backgrounds.get(this.backgroundId) || null;\n\t\t},\n\n\t\tisActive(): boolean {\n\t\t\treturn this.backgroundId === this.background.current;\n\t\t},\n\n\t\ttitle(): string {\n\t\t\tswitch (this.backgroundId) {\n\t\t\t\tcase 'buildin.static-color':\n\t\t\t\t\treturn 'Static color';\n\t\t\t\tcase 'buildin.transparent':\n\t\t\t\t\treturn 'Transparent';\n\t\t\t}\n\t\t\treturn this.bgData!.label || '';\n\t\t},\n\n\t\tstyle(): { [id: string]: string } {\n\t\t\tswitch (this.backgroundId) {\n\t\t\t\tcase 'buildin.static-color':\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'background-color': this.background.color,\n\t\t\t\t\t};\n\t\t\t\tcase 'buildin.transparent':\n\t\t\t\t\treturn {};\n\t\t\t}\n\t\t\tconst urls = (this.assets.filter(\n\t\t\t\timg => img instanceof HTMLImageElement\n\t\t\t) as HTMLImageElement[])\n\t\t\t\t.map(img => `url('${img.src}')`)\n\t\t\t\t.join(',');\n\t\t\treturn {\n\t\t\t\tbackgroundImage: urls,\n\t\t\t};\n\t\t},\n\t},\n\tasync created() {\n\t\tif (this.bgData) {\n\t\t\tthis.assets = await Promise.all(\n\t\t\t\tthis.bgData.variants[0].map(asset => getAAsset(asset, false))\n\t\t\t);\n\t\t}\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.background {\n\tmargin-top: 4px;\n\tbackground-size: cover;\n\ttext-shadow: 0 0 4px #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000,\n\t\t1px 1px 0 #000;\n\tcolor: white;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tbox-shadow: inset 0 0 1px 3px $default-modal-backdrop;\n\tbox-shadow: inset 0 0 1px 3px var(--modal-backdrop);\n\theight: 48px;\n\tmin-height: 48px;\n\ttext-align: center;\n\tuser-select: none;\n\n\t&.active {\n\t\tbox-shadow: inset 0 0 1px 3px $default-modal-backdrop-light;\n\t\tbox-shadow: inset 0 0 1px 3px var(--modal-backdrop-light);\n\t}\n}\n</style>\n","\nimport { getAAsset } from '@/asset-manager';\nimport { Background } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, BackgroundLookup } from '@/store/content';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { IPanel } from '@/store/panels';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport default defineComponent({\n\tprops: {\n\t\tbackgroundId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\tassets: [] as Array<HTMLImageElement | ErrorAsset>,\n\t}),\n\tcomputed: {\n\t\tbackground(): DeepReadonly<IPanel['background']> {\n\t\t\tconst currentPanel = this.$store.state.panels.currentPanel;\n\t\t\treturn this.$store.state.panels.panels[currentPanel].background;\n\t\t},\n\n\t\tbgData(): Background<IAsset> | null {\n\t\t\tconst backgrounds: BackgroundLookup = this.$store.getters[\n\t\t\t\t'content/getBackgrounds'\n\t\t\t];\n\t\t\treturn backgrounds.get(this.backgroundId) || null;\n\t\t},\n\n\t\tisActive(): boolean {\n\t\t\treturn this.backgroundId === this.background.current;\n\t\t},\n\n\t\ttitle(): string {\n\t\t\tswitch (this.backgroundId) {\n\t\t\t\tcase 'buildin.static-color':\n\t\t\t\t\treturn 'Static color';\n\t\t\t\tcase 'buildin.transparent':\n\t\t\t\t\treturn 'Transparent';\n\t\t\t}\n\t\t\treturn this.bgData!.label || '';\n\t\t},\n\n\t\tstyle(): { [id: string]: string } {\n\t\t\tswitch (this.backgroundId) {\n\t\t\t\tcase 'buildin.static-color':\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'background-color': this.background.color,\n\t\t\t\t\t};\n\t\t\t\tcase 'buildin.transparent':\n\t\t\t\t\treturn {};\n\t\t\t}\n\t\t\tconst urls = (this.assets.filter(\n\t\t\t\timg => img instanceof HTMLImageElement\n\t\t\t) as HTMLImageElement[])\n\t\t\t\t.map(img => `url('${img.src}')`)\n\t\t\t\t.join(',');\n\t\t\treturn {\n\t\t\t\tbackgroundImage: urls,\n\t\t\t};\n\t\t},\n\t},\n\tasync created() {\n\t\tif (this.bgData) {\n\t\t\tthis.assets = await Promise.all(\n\t\t\t\tthis.bgData.variants[0].map(asset => getAAsset(asset, false))\n\t\t\t);\n\t\t}\n\t},\n});\n","import { render } from \"./button.vue?vue&type=template&id=09138076&scoped=true\"\nimport script from \"./button.vue?vue&type=script&lang=ts\"\nexport * from \"./button.vue?vue&type=script&lang=ts\"\n\nimport \"./button.vue?vue&type=style&index=0&id=09138076&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-09138076\"\n\nexport default script","<template>\n\t<d-fieldset\n\t\t:class=\"{ 'bg-settings': true, vertical: vertical }\"\n\t\ttitle=\"Settings:\"\n\t>\n\t\t<template v-if=\"isColor\">\n\t\t\t<label for=\"bg_color\">Color:</label>\n\t\t\t<button\n\t\t\t\tid=\"bg_color\"\n\t\t\t\tclass=\"color-button\"\n\t\t\t\t:style=\"{ background: color }\"\n\t\t\t\t@click=\"$emit('change-color')\"\n\t\t\t/>\n\t\t</template>\n\t\t<table v-if=\"isVariant\">\n\t\t\t<tr>\n\t\t\t\t<td colspan=\"3\">\n\t\t\t\t\t<toggle v-model=\"flipped\" label=\"Flipped?\" />\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr v-if=\"hasVariants\">\n\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t<button class=\"small-button\" @click=\"seekVariant(-1)\">&lt;</button>\n\t\t\t\t</td>\n\t\t\t\t<td style=\"text-align:center\">Variant</td>\n\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t<button class=\"small-button\" @click=\"seekVariant(1)\">&gt;</button>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td colspan=\"3\">\n\t\t\t\t\t<select v-model=\"scaling\" @keydown.stop>\n\t\t\t\t\t\t<option value=\"0\">None</option>\n\t\t\t\t\t\t<option value=\"1\">Stretch</option>\n\t\t\t\t\t\t<option value=\"2\">Cover</option>\n\t\t\t\t\t</select>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td colspan=\"3\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tid=\"image_options_button\"\n\t\t\t\t\t\t@click=\"$emit('open-image-options')\"\n\t\t\t\t\t>\n\t\t\t\t\t\tImage options\n\t\t\t\t\t</button>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</d-fieldset>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { Background } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport {\n\tISetColorMutation,\n\tISetFlipMutation,\n\tISeekVariantAction,\n\tISetScalingMutation,\n\tIPanel,\n} from '@/store/panels';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\treturn this.background.color;\n\t\t\t},\n\t\t\tset(color: string): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundColor', {\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetColorMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tflipped: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.background.flipped;\n\t\t\t},\n\t\t\tset(flipped: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundFlipped', {\n\t\t\t\t\t\tflipped,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetFlipMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tscaling: {\n\t\t\tget(): string {\n\t\t\t\treturn this.background.scaling.toString();\n\t\t\t},\n\n\t\t\tset(scaling: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundScaling', {\n\t\t\t\t\t\tscaling: parseInt(scaling, 10),\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetScalingMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tcurrentBackgroundId(): string {\n\t\t\treturn this.background.current;\n\t\t},\n\t\tbackground(): DeepReadonly<IPanel['background']> {\n\t\t\tconst currentPanel = this.$store.state.panels.currentPanel;\n\t\t\treturn this.$store.state.panels.panels[currentPanel].background;\n\t\t},\n\t\tbgData(): DeepReadonly<Background<IAsset>> | null {\n\t\t\treturn (\n\t\t\t\tthis.$store.state.content.current.backgrounds.find(\n\t\t\t\t\tbackground => background.id === this.currentBackgroundId\n\t\t\t\t) || null\n\t\t\t);\n\t\t},\n\t\tisColor(): boolean {\n\t\t\treturn this.currentBackgroundId === 'buildin.static-color';\n\t\t},\n\t\tisVariant(): boolean {\n\t\t\treturn !!this.bgData;\n\t\t},\n\t\thasVariants(): boolean {\n\t\t\treturn this.bgData ? this.bgData.variants.length > 1 : false;\n\t\t},\n\t},\n\tmethods: {\n\t\tseekVariant(delta: 1 | -1) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/seekBackgroundVariant', {\n\t\t\t\t\tdelta,\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as ISeekVariantAction);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.bg-settings:not(.vertical) {\n\t@include height-100();\n}\n\n.small-button {\n\twidth: 24px;\n}\n\nselect {\n\twidth: 100%;\n}\n\ntable {\n\twidth: 100%;\n}\n\n.arrow-col {\n\twidth: 24px;\n\n\tbutton {\n\t\twidth: 24px;\n\t}\n}\n\n.color-button {\n\theight: 24px;\n\twidth: 48px;\n\tvertical-align: middle;\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { Background } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport {\n\tISetColorMutation,\n\tISetFlipMutation,\n\tISeekVariantAction,\n\tISetScalingMutation,\n\tIPanel,\n} from '@/store/panels';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\treturn this.background.color;\n\t\t\t},\n\t\t\tset(color: string): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundColor', {\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetColorMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tflipped: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.background.flipped;\n\t\t\t},\n\t\t\tset(flipped: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundFlipped', {\n\t\t\t\t\t\tflipped,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetFlipMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tscaling: {\n\t\t\tget(): string {\n\t\t\t\treturn this.background.scaling.toString();\n\t\t\t},\n\n\t\t\tset(scaling: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundScaling', {\n\t\t\t\t\t\tscaling: parseInt(scaling, 10),\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetScalingMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tcurrentBackgroundId(): string {\n\t\t\treturn this.background.current;\n\t\t},\n\t\tbackground(): DeepReadonly<IPanel['background']> {\n\t\t\tconst currentPanel = this.$store.state.panels.currentPanel;\n\t\t\treturn this.$store.state.panels.panels[currentPanel].background;\n\t\t},\n\t\tbgData(): DeepReadonly<Background<IAsset>> | null {\n\t\t\treturn (\n\t\t\t\tthis.$store.state.content.current.backgrounds.find(\n\t\t\t\t\tbackground => background.id === this.currentBackgroundId\n\t\t\t\t) || null\n\t\t\t);\n\t\t},\n\t\tisColor(): boolean {\n\t\t\treturn this.currentBackgroundId === 'buildin.static-color';\n\t\t},\n\t\tisVariant(): boolean {\n\t\t\treturn !!this.bgData;\n\t\t},\n\t\thasVariants(): boolean {\n\t\t\treturn this.bgData ? this.bgData.variants.length > 1 : false;\n\t\t},\n\t},\n\tmethods: {\n\t\tseekVariant(delta: 1 | -1) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/seekBackgroundVariant', {\n\t\t\t\t\tdelta,\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as ISeekVariantAction);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./settings.vue?vue&type=template&id=99a6545a&scoped=true\"\nimport script from \"./settings.vue?vue&type=script&lang=ts\"\nexport * from \"./settings.vue?vue&type=script&lang=ts\"\n\nimport \"./settings.vue?vue&type=style&index=0&id=99a6545a&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-99a6545a\"\n\nexport default script","\nimport BackgroundButton from './background/button.vue';\nimport BackgroundSettings from './background/settings.vue';\nimport ImageOptions from '../subtools/image-options/image-options.vue';\nimport DropTarget from '../drop-target.vue';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport {\n\tBackground,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { ISetCurrentMutation, ISetColorMutation } from '@/store/panels';\nimport { PanelMixin } from './panelMixin';\nimport Color from '../subtools/color/color.vue';\nimport { defineComponent } from 'vue';\nimport environment, { Folder } from '@/environments/environment';\nimport DButton from '@/components/ui/d-button.vue';\n\nconst uploadedBackgroundsPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.uploadedBackgrounds',\n\tdependencies: [],\n\tpackCredits: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tBackgroundButton,\n\t\tBackgroundSettings,\n\t\tDropTarget,\n\t\tColor,\n\t\tImageOptions,\n\t\tDButton,\n\t},\n\tdata: () => ({\n\t\tcolorSelect: false,\n\t\timageOptions: false,\n\t}),\n\tcomputed: {\n\t\tbgColor: {\n\t\t\tget(): string {\n\t\t\t\treturn this.$store.state.panels.panels[\n\t\t\t\t\tthis.$store.state.panels.currentPanel\n\t\t\t\t].background.color;\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundColor', {\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetColorMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tbackgrounds(): Array<Background<IAsset>['id']> {\n\t\t\treturn [\n\t\t\t\t...this.$store.state.content.current.backgrounds.map(\n\t\t\t\t\tbackground => background.id\n\t\t\t\t),\n\t\t\t\t'buildin.static-color',\n\t\t\t\t'buildin.transparent',\n\t\t\t];\n\t\t},\n\t\tshowBackgroundsFolder(): boolean {\n\t\t\treturn (environment.supports.openableFolders as ReadonlySet<Folder>).has(\n\t\t\t\t'backgrounds'\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tsetBackground(id: Background<IAsset>['id']) {\n\t\t\tthis.$store.commit('panels/setCurrentBackground', {\n\t\t\t\tcurrent: id,\n\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t} as ISetCurrentMutation);\n\t\t},\n\t\tonFileUpload(e: Event) {\n\t\t\tconst uploadInput = this.$refs.upload as HTMLInputElement;\n\t\t\tif (!uploadInput.files) return;\n\t\t\tfor (const file of uploadInput.files) {\n\t\t\t\tthis.addImageFile(file);\n\t\t\t}\n\t\t},\n\t\taddImageFile(file: File) {\n\t\t\tconst url = URL.createObjectURL(file);\n\t\t\tthis.addNewCustomBackground(file.name, file.name, url);\n\t\t},\n\t\taddByUrl() {\n\t\t\tconst url = prompt('Enter the URL of the image');\n\t\t\tif (!url) return;\n\t\t\tconst lastSegment = url.split('/').slice(-1)[0];\n\t\t\tthis.addNewCustomBackground(lastSegment, lastSegment, url);\n\t\t},\n\t\taddNewCustomBackground(\n\t\t\tid: Background<IAsset>['id'],\n\t\t\tlabel: string,\n\t\t\turl: string\n\t\t) {\n\t\t\tuploadedBackgroundsPack.backgrounds.push({\n\t\t\t\tid,\n\t\t\t\tlabel,\n\t\t\t\tvariants: [[url]],\n\t\t\t});\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: uploadedBackgroundsPack,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t\tthis.setBackground(id);\n\t\t\t});\n\t\t},\n\t\tdragEnter(e: DragEvent) {\n\t\t\tif (!e.dataTransfer) return;\n\t\t\te.dataTransfer.effectAllowed = 'none';\n\t\t\tif (\n\t\t\t\t!Array.from(e.dataTransfer.items).find(item =>\n\t\t\t\t\titem.type.match(/^image.*$/)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.dataTransfer.effectAllowed = 'link';\n\t\t\t(this.$refs.dt as any).show();\n\t\t},\n\t\topenBackgroundFolder() {\n\t\t\tenvironment.openFolder('backgrounds');\n\t\t},\n\t},\n});\n","import { render } from \"./backgrounds.vue?vue&type=template&id=1c8b5613&scoped=true\"\nimport script from \"./backgrounds.vue?vue&type=script&lang=ts\"\nexport * from \"./backgrounds.vue?vue&type=script&lang=ts\"\n\nimport \"./backgrounds.vue?vue&type=style&index=0&id=1c8b5613&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-1c8b5613\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>Content Packs</h1>\n\t\t<button @click=\"addNew\">Add new Pack</button>\n\t\t<d-fieldset title=\"Installed Packs:\">\n\t\t\t<div class=\"list\">\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"pack in packs\"\n\t\t\t\t\t:class=\"{ active: pack.name === name }\"\n\t\t\t\t\t:key=\"pack.name\"\n\t\t\t\t\t@click=\"select(pack.name)\"\n\t\t\t\t>\n\t\t\t\t\t{{ pack.name }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</d-fieldset>\n\t\t<label for=\"pack_name\">Name:</label>\n\t\t<input id=\"pack_name\" :value=\"name\" readonly />\n\t\t<label for=\"pack_credits\">Credits:</label>\n\t\t<div id=\"pack_credits\" v-html=\"credits\"></div>\n\t\t<button v-if=\"activatable\" @click=\"activate\">Activate</button>\n\t\t<button v-if=\"deactivatable\" @click=\"deactivate\">Deactivate</button>\n\t\t<button v-if=\"installable\" @click=\"install\">Install</button>\n\t\t<button v-if=\"uninstallable\" @click=\"uninstall\">Uninstall</button>\n\t\t<div v-if=\"needRestart\">\n\t\t\tThe tool need restart for changes to take effect.\n\t\t\t<button @click=\"restart\">Restart Now</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { PanelMixin } from './panelMixin';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\ninterface IPack {\n\tname: string;\n\tcredits: [string | [string, string]];\n\tinstalled: boolean;\n\tqueuedUninstall: boolean;\n\tactive: boolean;\n\tfreshInstall: boolean;\n\turl: string;\n}\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DFieldset },\n\tdata: () => ({\n\t\tselectedPack: null as IPack | null,\n\t\tneedRestart: false,\n\t}),\n\tcomputed: {\n\t\tpacks(): IPack[] {\n\t\t\tconst packs = this.$store.state.content.contentPacks;\n\t\t\treturn packs\n\t\t\t\t.filter(pack => pack.packId && !pack.packId.startsWith('dddg.buildin.'))\n\t\t\t\t.map(\n\t\t\t\t\tpack =>\n\t\t\t\t\t\t({\n\t\t\t\t\t\t\tname: pack.packId,\n\t\t\t\t\t\t\tcredits: pack.packCredits,\n\t\t\t\t\t\t\tinstalled: true,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tqueuedUninstall: false,\n\t\t\t\t\t\t\tfreshInstall: false,\n\t\t\t\t\t\t\turl: '',\n\t\t\t\t\t\t} as IPack)\n\t\t\t\t);\n\t\t},\n\n\t\tname(): string {\n\t\t\tif (!this.selectedPack) return '';\n\t\t\treturn this.selectedPack.name;\n\t\t},\n\t\tcredits(): [string | [string, string]] {\n\t\t\tif (!this.selectedPack) return [''];\n\t\t\treturn this.selectedPack.credits;\n\t\t},\n\t\tactivatable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (!this.selectedPack.installed) return false;\n\t\t\tif (this.selectedPack.queuedUninstall) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn !this.selectedPack.active;\n\t\t},\n\t\tdeactivatable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (!this.selectedPack.installed) return false;\n\t\t\tif (this.selectedPack.queuedUninstall) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn this.selectedPack.active;\n\t\t},\n\t\tinstallable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\treturn this.selectedPack.queuedUninstall || !this.selectedPack.installed;\n\t\t},\n\t\tuninstallable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn !(\n\t\t\t\tthis.selectedPack.queuedUninstall || !this.selectedPack.installed\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tselect(name: string) {\n\t\t\tthis.selectedPack = this.packs.find(pack => pack.name === name) || null;\n\t\t},\n\t\tasync addNew() {\n\t\t\tconst url = await environment.prompt(\n\t\t\t\t'Enter the URL of the character pack:'\n\t\t\t);\n\t\t\tif (!url) return;\n\t\t\tawait this.$store.dispatch('content/loadContentPacks', url);\n\t\t},\n\t\trestart() {\n\t\t\tlocation.reload(true);\n\t\t},\n\t\tinstall(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tif (this.selectedPack.queuedUninstall) {\n\t\t\t\tthis.selectedPack.queuedUninstall = false;\n\t\t\t} else {\n\t\t\t\tthis.selectedPack.installed = true;\n\t\t\t}\n\t\t},\n\t\tuninstall(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.localRepoUninstall(this.selectedPack.url);\n\t\t\tthis.selectedPack.queuedUninstall = true;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t\tactivate(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.autoLoadAdd(this.selectedPack.url);\n\t\t\tthis.selectedPack.active = true;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t\tdeactivate(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.autoLoadRemove(this.selectedPack.url);\n\t\t\tthis.selectedPack.active = false;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\np {\n\tmargin: 4px;\n}\n.list {\n\toverflow-y: auto;\n\toverflow-x: hidden;\n\t.active {\n\t\tbackground-color: $default-border;\n\t\tbackground-color: var(--border);\n\t}\n}\n\n.panel.vertical {\n\tfieldset {\n\t\twidth: 100%;\n\n\t\t> .list {\n\t\t\tmax-height: 200px;\n\t\t\twidth: 172px;\n\n\t\t\t* {\n\t\t\t\twidth: 100%;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\tpadding: 2px;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.panel:not(.vertical) {\n\t.list {\n\t\tmax-height: 140px;\n\t}\n}\n</style>\n","\nimport { PanelMixin } from './panelMixin';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\ninterface IPack {\n\tname: string;\n\tcredits: [string | [string, string]];\n\tinstalled: boolean;\n\tqueuedUninstall: boolean;\n\tactive: boolean;\n\tfreshInstall: boolean;\n\turl: string;\n}\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DFieldset },\n\tdata: () => ({\n\t\tselectedPack: null as IPack | null,\n\t\tneedRestart: false,\n\t}),\n\tcomputed: {\n\t\tpacks(): IPack[] {\n\t\t\tconst packs = this.$store.state.content.contentPacks;\n\t\t\treturn packs\n\t\t\t\t.filter(pack => pack.packId && !pack.packId.startsWith('dddg.buildin.'))\n\t\t\t\t.map(\n\t\t\t\t\tpack =>\n\t\t\t\t\t\t({\n\t\t\t\t\t\t\tname: pack.packId,\n\t\t\t\t\t\t\tcredits: pack.packCredits,\n\t\t\t\t\t\t\tinstalled: true,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tqueuedUninstall: false,\n\t\t\t\t\t\t\tfreshInstall: false,\n\t\t\t\t\t\t\turl: '',\n\t\t\t\t\t\t} as IPack)\n\t\t\t\t);\n\t\t},\n\n\t\tname(): string {\n\t\t\tif (!this.selectedPack) return '';\n\t\t\treturn this.selectedPack.name;\n\t\t},\n\t\tcredits(): [string | [string, string]] {\n\t\t\tif (!this.selectedPack) return [''];\n\t\t\treturn this.selectedPack.credits;\n\t\t},\n\t\tactivatable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (!this.selectedPack.installed) return false;\n\t\t\tif (this.selectedPack.queuedUninstall) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn !this.selectedPack.active;\n\t\t},\n\t\tdeactivatable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (!this.selectedPack.installed) return false;\n\t\t\tif (this.selectedPack.queuedUninstall) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn this.selectedPack.active;\n\t\t},\n\t\tinstallable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\treturn this.selectedPack.queuedUninstall || !this.selectedPack.installed;\n\t\t},\n\t\tuninstallable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn !(\n\t\t\t\tthis.selectedPack.queuedUninstall || !this.selectedPack.installed\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tselect(name: string) {\n\t\t\tthis.selectedPack = this.packs.find(pack => pack.name === name) || null;\n\t\t},\n\t\tasync addNew() {\n\t\t\tconst url = await environment.prompt(\n\t\t\t\t'Enter the URL of the character pack:'\n\t\t\t);\n\t\t\tif (!url) return;\n\t\t\tawait this.$store.dispatch('content/loadContentPacks', url);\n\t\t},\n\t\trestart() {\n\t\t\tlocation.reload(true);\n\t\t},\n\t\tinstall(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tif (this.selectedPack.queuedUninstall) {\n\t\t\t\tthis.selectedPack.queuedUninstall = false;\n\t\t\t} else {\n\t\t\t\tthis.selectedPack.installed = true;\n\t\t\t}\n\t\t},\n\t\tuninstall(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.localRepoUninstall(this.selectedPack.url);\n\t\t\tthis.selectedPack.queuedUninstall = true;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t\tactivate(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.autoLoadAdd(this.selectedPack.url);\n\t\t\tthis.selectedPack.active = true;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t\tdeactivate(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.autoLoadRemove(this.selectedPack.url);\n\t\t\tthis.selectedPack.active = false;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t},\n});\n","import { render } from \"./content-pack.vue?vue&type=template&id=714ad0fa&scoped=true\"\nimport script from \"./content-pack.vue?vue&type=script&lang=ts\"\nexport * from \"./content-pack.vue?vue&type=script&lang=ts\"\n\nimport \"./content-pack.vue?vue&type=style&index=0&id=714ad0fa&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-714ad0fa\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>Panels</h1>\n\t\t<image-options\n\t\t\tv-if=\"imageOptions\"\n\t\t\ttype=\"panel\"\n\t\t\ttitle=\"\"\n\t\t\t:id=\"currentPanel\"\n\t\t\tno-composition\n\t\t\t@leave=\"\n\t\t\t\timageOptions = false;\n\t\t\t\trenderThumbnail();\n\t\t\t\"\n\t\t/>\n\t\t<template v-else>\n\t\t\t<d-fieldset class=\"existing_panels_fieldset\" title=\"Existing Panels\">\n\t\t\t\t<d-flow no-wraping maxSize=\"350px\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for=\"(panel, idx) of panelButtons\"\n\t\t\t\t\t\t:key=\"panel.id\"\n\t\t\t\t\t\t:class=\"{ panel_button: true, active: panel.id === currentPanel }\"\n\t\t\t\t\t\t:style=\"`background-image: url('${panel.image}')`\"\n\t\t\t\t\t\t@click=\"updateCurrentPanel(panel.id)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"panel_text\">\n\t\t\t\t\t\t\t<p>{{ panel.text }}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"panel_nr\">{{ idx + 1 }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</d-flow>\n\t\t\t</d-fieldset>\n\t\t\t<div class=\"column\">\n\t\t\t\t<d-button icon=\"add_to_queue\" @click=\"addNewPanel\">\n\t\t\t\t\tAdd new\n\t\t\t\t</d-button>\n\t\t\t\t<d-button\n\t\t\t\t\ticon=\"remove_from_queue\"\n\t\t\t\t\t@click=\"deletePanel\"\n\t\t\t\t\t:disabled=\"!canDeletePanel\"\n\t\t\t\t>\n\t\t\t\t\tDelete panel\n\t\t\t\t</d-button>\n\n\t\t\t\t<d-button\n\t\t\t\t\ticon=\"arrow_upward\"\n\t\t\t\t\t@click=\"moveAhead\"\n\t\t\t\t\t:disabled=\"!canMoveAhead\"\n\t\t\t\t>\n\t\t\t\t\tMove ahead\n\t\t\t\t</d-button>\n\t\t\t\t<d-button\n\t\t\t\t\ticon=\"arrow_downward\"\n\t\t\t\t\t@click=\"moveBehind\"\n\t\t\t\t\t:disabled=\"!canMoveBehind\"\n\t\t\t\t>\n\t\t\t\t\tMove behind\n\t\t\t\t</d-button>\n\t\t\t\t<d-button icon=\"color_lens\" @click=\"imageOptions = true\">\n\t\t\t\t\tImage options\n\t\t\t\t</d-button>\n\t\t\t</div>\n\t\t\t<d-fieldset title=\"Export\">\n\t\t\t\t<table>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"export_format\">Format</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select id=\"export_format\" v-model=\"format\">\n\t\t\t\t\t\t\t\t<option value=\"image/png\">PNG (lossless)</option>\n\t\t\t\t\t\t\t\t<option value=\"image/webp\" v-if=\"webpSupport\"\n\t\t\t\t\t\t\t\t\t>WebP (lossy)</option\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<option value=\"image/heif\" v-if=\"heifSupport\"\n\t\t\t\t\t\t\t\t\t>HEIF (lossy)</option\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<option value=\"image/jpeg\">JPEG (lossy)</option>\n\t\t\t\t\t\t\t\t<!-- <option value=\"image/jpeg\">WebM (lossy, video)</option>-->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr v-if=\"isLossy\">\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"export_quality\">Quality:</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"export_quality\"\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tmax=\"100\"\n\t\t\t\t\t\t\t\tv-model.number=\"quality\"\n\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"export_ppi\">\n\t\t\t\t\t\t\t\tPanels per image:\n\t\t\t\t\t\t\t\t<br /><small>(0 for one single image)</small>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"export_ppi\"\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tv-model.number=\"ppi\"\n\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"export_pages\">\n\t\t\t\t\t\t\t\tPanels to export:\n\t\t\t\t\t\t\t\t<br /><small>(Leave empty for all)</small>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"export_pages\"\n\t\t\t\t\t\t\t\tv-model=\"pages\"\n\t\t\t\t\t\t\t\tplaceholder=\"E.g. 1-5, 8, 11-13\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<d-button icon=\"photo_camera\" @click=\"download\">\n\t\t\t\t\t\t\t\tDownload\n\t\t\t\t\t\t\t</d-button>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<button @click=\"estimateExportSize\">Estimate filesizes</button>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t</d-fieldset>\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { PanelMixin } from './panelMixin';\nimport {\n\tIDuplicatePanelAction,\n\tISetCurrentPanelMutation,\n\tIDeletePanelAction,\n\tISetPanelPreviewMutation,\n\tIMovePanelAction,\n} from '@/store/panels';\nimport { isWebPSupported, isHeifSupported } from '@/asset-manager';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { SceneRenderer } from '@/renderables/scene-renderer';\nimport { DeepReadonly } from '@/util/readonly';\nimport environment from '@/environments/environment';\nimport eventBus, { ShowMessageEvent } from '@/eventbus/event-bus';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport { IObject } from '@/store/objects';\nimport { INotification } from '@/store/objectTypes/notification';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { IChoices } from '@/store/objectTypes/choices';\nimport { defineComponent } from 'vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DButton from '@/components/ui/d-button.vue';\nimport ImageOptions from '../subtools/image-options/image-options.vue';\n\ninterface IPanelButton {\n\tid: string;\n\timage: string;\n\ttext: string;\n}\n\n// tslint:disable: no-magic-numbers\nconst estimateFactor = 1.5;\nconst thumbnailFactor = 1 / 4;\nconst thumbnailQuality = 0.5;\nconst qualityFactor = 100;\n\nconst defaultQuality = 90;\n\nconst qualityWarningThreshold = 70;\n// tslint:enable: no-magic-numbers\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DFieldset, DFlow, DButton, ImageOptions },\n\tdata: () => ({\n\t\twebpSupport: false,\n\t\theifSupport: false,\n\t\tppi: 0,\n\t\tpages: '',\n\t\tformat: 'image/png',\n\t\tquality: defaultQuality,\n\t\timageOptions: false,\n\t}),\n\tcomputed: {\n\t\tcurrentPanel(): string {\n\t\t\treturn this.$store.state.panels.currentPanel;\n\t\t},\n\n\t\tisLossy(): boolean {\n\t\t\treturn this.format !== 'image/png';\n\t\t},\n\n\t\tcanDeletePanel(): boolean {\n\t\t\treturn this.panelButtons.length > 1;\n\t\t},\n\n\t\tpanelButtons(): IPanelButton[] {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\treturn panelOrder.map(id => {\n\t\t\t\tconst panel = this.$store.state.panels.panels[id];\n\t\t\t\tconst objectOrders = this.$store.state.objects.panels[id];\n\t\t\t\tconst txtBox = objectOrders\n\t\t\t\t\t? ([] as string[])\n\t\t\t\t\t\t\t.concat(objectOrders.order, objectOrders.onTopOrder)\n\t\t\t\t\t\t\t.map(objId => this.$store.state.objects.objects[objId])\n\t\t\t\t\t\t\t.map(this.extractObjectText)\n\t\t\t\t\t: [];\n\t\t\t\treturn {\n\t\t\t\t\tid,\n\t\t\t\t\timage: panel.lastRender,\n\t\t\t\t\ttext: txtBox.reduce(\n\t\t\t\t\t\t(acc, current) => (acc.length > current.length ? acc : current),\n\t\t\t\t\t\t''\n\t\t\t\t\t),\n\t\t\t\t} as IPanelButton;\n\t\t\t});\n\t\t},\n\n\t\tcanMoveAhead(): boolean {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\tconst idx = panelOrder.indexOf(this.currentPanel);\n\t\t\treturn idx > 0;\n\t\t},\n\n\t\tcanMoveBehind(): boolean {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\tconst idx = panelOrder.indexOf(this.currentPanel);\n\t\t\treturn idx < panelOrder.length - 1;\n\t\t},\n\t},\n\tasync created() {\n\t\t[this.webpSupport, this.heifSupport] = await Promise.all([\n\t\t\tisWebPSupported(),\n\t\t\tisHeifSupported(),\n\t\t]);\n\t},\n\tasync mounted() {\n\t\tthis.moveFocusToActivePanel();\n\t\tthis.renderThumbnail();\n\t},\n\tmethods: {\n\t\tasync download() {\n\t\t\tconst distribution = this.getPanelDistibution();\n\t\t\tconst date = new Date();\n\t\t\tconst prefix = `cd-${[\n\t\t\t\tdate.getFullYear(),\n\t\t\t\t`${date.getMonth() + 1}`.padStart(2, '0'),\n\t\t\t\t`${date.getDate()}`.padStart(2, '0'),\n\t\t\t\t`${date.getHours()}`.padStart(2, '0'),\n\t\t\t\t`${date.getMinutes()}`.padStart(2, '0'),\n\t\t\t\t`${date.getSeconds()}`.padStart(2, '0'),\n\t\t\t].join('-')}`;\n\t\t\tconst extension = this.format.split('/')[1];\n\t\t\tconst format = this.format;\n\t\t\tconst quality = this.quality;\n\t\t\tawait this.renderObjects(\n\t\t\t\tdistribution,\n\t\t\t\ttrue,\n\t\t\t\tasync (imageIdx: number, canvas: HTMLCanvasElement) => {\n\t\t\t\t\tenvironment.saveToFile(\n\t\t\t\t\t\tcanvas,\n\t\t\t\t\t\t`${prefix}_${imageIdx}.${extension}`,\n\t\t\t\t\t\tformat,\n\t\t\t\t\t\tquality / qualityFactor\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tasync estimateExportSize() {\n\t\t\tconst distribution = this.getPanelDistibution();\n\t\t\tconst format = this.format || 'image/png';\n\t\t\tconst quality = this.quality || defaultQuality;\n\t\t\tconst sizes = await this.renderObjects(\n\t\t\t\tdistribution,\n\t\t\t\tfalse,\n\t\t\t\tasync (imageIdx: number, canvas: HTMLCanvasElement) => {\n\t\t\t\t\treturn new Promise<number>((resolve, reject) => {\n\t\t\t\t\t\tcanvas.toBlob(\n\t\t\t\t\t\t\tblob => {\n\t\t\t\t\t\t\t\tif (!blob) {\n\t\t\t\t\t\t\t\t\treject(`Image ${imageIdx + 1} could not be rendered.`);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresolve(blob.size);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tformat,\n\t\t\t\t\t\t\tquality / qualityFactor\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t\tconst readableSizes = sizes.map(\n\t\t\t\tsize => ((size * estimateFactor) / 1024 / 1024).toFixed(2) + 'MiB'\n\t\t\t);\n\t\t\tconst filePluralize = readableSizes.length > 1 ? 'files' : 'file';\n\t\t\tconst itPluralize = readableSizes.length > 1 ? 'These' : 'It';\n\t\t\tconst sizePluralize = readableSizes.length > 1 ? 'sizes' : 'size';\n\t\t\teventBus.fire(\n\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t`This would export ${\n\t\t\t\t\t\treadableSizes.length\n\t\t\t\t\t} ${filePluralize}. ${itPluralize} would have the following (aproximate) ${sizePluralize}: ${readableSizes.join(\n\t\t\t\t\t\t','\n\t\t\t\t\t)}`\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\tasync renderObjects<T>(\n\t\t\tdistribution: DeepReadonly<string[][]>,\n\t\t\thq: boolean,\n\t\t\tmapper: (imageIdx: number, canvas: HTMLCanvasElement) => Promise<T>\n\t\t): Promise<T[]> {\n\t\t\treturn await Promise.all(\n\t\t\t\tdistribution.map(async (image, imageIdx) => {\n\t\t\t\t\tconst targetCanvas = document.createElement('canvas');\n\t\t\t\t\ttargetCanvas.width = screenWidth;\n\t\t\t\t\ttargetCanvas.height = screenHeight * image.length;\n\t\t\t\t\tconst context = targetCanvas.getContext('2d')!;\n\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\timage.map(async (panelId, panelIdx) => {\n\t\t\t\t\t\t\tconst sceneRenderer = new SceneRenderer(\n\t\t\t\t\t\t\t\tthis.$store,\n\t\t\t\t\t\t\t\timage[panelIdx],\n\t\t\t\t\t\t\t\tscreenWidth,\n\t\t\t\t\t\t\t\tscreenHeight\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tawait sceneRenderer.render(hq, false);\n\n\t\t\t\t\t\t\tsceneRenderer.paintOnto(context, {\n\t\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\t\ty: screenHeight * panelIdx,\n\t\t\t\t\t\t\t\tw: screenWidth,\n\t\t\t\t\t\t\t\th: screenHeight,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t\treturn await mapper(imageIdx, targetCanvas);\n\t\t\t\t})\n\t\t\t);\n\t\t},\n\t\tgetLimitedPanelList(): DeepReadonly<string[]> {\n\t\t\tconst max = this.$store.state.panels.panelOrder.length - 1;\n\t\t\tconst min = 0;\n\t\t\tconst parts = this.pages.split(',');\n\t\t\tconst listedPages: number[] = [];\n\t\t\tlet foundMatch = false;\n\n\t\t\tfor (const part of parts) {\n\t\t\t\tconst trimmedPart = part.trim();\n\t\t\t\tconst match = trimmedPart.match(/^\\s*((\\d+)|(\\d+)\\s*-\\s*(\\d+))\\s*$/);\n\t\t\t\tif (!match) {\n\t\t\t\t\tif (trimmedPart !== '') {\n\t\t\t\t\t\teventBus.fire(\n\t\t\t\t\t\t\tnew ShowMessageEvent(`Could not read '${part}' in the page list.`)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfoundMatch = true;\n\t\t\t\tif (match[2]) listedPages.push(parseInt(match[2], 10) - 1);\n\t\t\t\telse {\n\t\t\t\t\tconst from = Math.max(parseInt(match[3], 10) - 1, min);\n\t\t\t\t\tconst to = Math.min(parseInt(match[4], 10) - 1, max);\n\t\t\t\t\tif (from === undefined || to === undefined || from > to) continue;\n\t\t\t\t\tfor (let i = from; i <= to; ++i) {\n\t\t\t\t\t\tlistedPages.push(i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!foundMatch) {\n\t\t\t\treturn this.$store.state.panels.panelOrder;\n\t\t\t}\n\n\t\t\treturn listedPages\n\t\t\t\t.sort((a, b) => a - b)\n\t\t\t\t.filter((value, idx, ary) => ary[idx - 1] !== value)\n\t\t\t\t.map(pageIdx => this.$store.state.panels.panelOrder[pageIdx]);\n\t\t},\n\t\tgetPanelDistibution(): DeepReadonly<string[][]> {\n\t\t\tconst panelOrder = this.getLimitedPanelList();\n\t\t\tif (this.ppi === 0) return [panelOrder];\n\t\t\tconst images: string[][] = [];\n\t\t\tfor (let imageI = 0; imageI < panelOrder.length / this.ppi; ++imageI) {\n\t\t\t\tconst sliceStart = imageI * this.ppi;\n\t\t\t\tconst sliceEnd = sliceStart + this.ppi;\n\t\t\t\timages.push([...panelOrder.slice(sliceStart, sliceEnd)]);\n\t\t\t}\n\t\t\treturn images;\n\t\t},\n\t\tmoveFocusToActivePanel() {\n\t\t\tconst active = this.$el.querySelector('.panel_button.active');\n\t\t\tif (active) {\n\t\t\t\tthis.scrollIntoView(active);\n\t\t\t}\n\t\t},\n\t\tscrollIntoView(ele: Element) {\n\t\t\tconst parent = ele.parentElement!.parentElement!;\n\t\t\tconst idx = Array.from(ele.parentElement!.children).indexOf(ele);\n\t\t\tif (this.$store.state.ui.vertical) {\n\t\t\t\tconst scroll =\n\t\t\t\t\tidx * ele.clientHeight -\n\t\t\t\t\tparent.clientHeight / 2 +\n\t\t\t\t\tele.clientHeight / 2;\n\t\t\t\tparent.scrollTop = scroll;\n\t\t\t\tparent.scrollLeft = 0;\n\t\t\t} else {\n\t\t\t\tconst scroll =\n\t\t\t\t\tidx * ele.clientWidth - parent.clientWidth / 2 + ele.clientWidth / 2;\n\t\t\t\tparent.scrollLeft = scroll;\n\t\t\t\tparent.scrollTop = 0;\n\t\t\t}\n\t\t},\n\t\textractObjectText(obj: DeepReadonly<IObject>) {\n\t\t\tswitch (obj.type) {\n\t\t\t\tcase 'textBox':\n\t\t\t\t\treturn (obj as ITextBox).text;\n\t\t\t\tcase 'notification':\n\t\t\t\t\treturn (obj as INotification).text;\n\t\t\t\tcase 'poem':\n\t\t\t\t\treturn (obj as IPoem).text;\n\t\t\t\tcase 'choice':\n\t\t\t\t\treturn (obj as IChoices).choices\n\t\t\t\t\t\t.map(choice => `[${choice.text}]`)\n\t\t\t\t\t\t.join('\\n');\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\tasync addNewPanel() {\n\t\t\tawait this.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('panels/duplicatePanel', {\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as IDuplicatePanelAction);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tupdateCurrentPanel(panelId: string) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.commit('panels/setCurrentPanel', {\n\t\t\t\t\tpanelId,\n\t\t\t\t} as ISetCurrentPanelMutation);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tdeletePanel() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('panels/delete', {\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as IDeletePanelAction);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tmoveAhead() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/move', {\n\t\t\t\t\tpanelId: this.currentPanel,\n\t\t\t\t\tdelta: -1,\n\t\t\t\t} as IMovePanelAction);\n\t\t\t});\n\t\t},\n\t\tmoveBehind() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/move', {\n\t\t\t\t\tpanelId: this.currentPanel,\n\t\t\t\t\tdelta: 1,\n\t\t\t\t} as IMovePanelAction);\n\t\t\t});\n\t\t},\n\t\tasync renderThumbnail() {\n\t\t\tconst sceneRenderer = new SceneRenderer(\n\t\t\t\tthis.$store,\n\t\t\t\tthis.currentPanel,\n\t\t\t\tscreenWidth,\n\t\t\t\tscreenHeight\n\t\t\t);\n\n\t\t\tawait sceneRenderer.render(false, true);\n\n\t\t\tconst targetCanvas = document.createElement('canvas');\n\t\t\ttargetCanvas.width = screenWidth * thumbnailFactor;\n\t\t\ttargetCanvas.height = screenHeight * thumbnailFactor;\n\n\t\t\tsceneRenderer.paintOnto(targetCanvas.getContext('2d')!, {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tw: targetCanvas.width,\n\t\t\t\th: targetCanvas.height,\n\t\t\t});\n\t\t\ttargetCanvas.toBlob(\n\t\t\t\tblob => {\n\t\t\t\t\tif (!blob) return;\n\t\t\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\t\tthis.$store.commit('panels/setPanelPreview', {\n\t\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t} as ISetPanelPreviewMutation);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t(await isWebPSupported()) ? 'image/webp' : 'image/jpeg',\n\t\t\t\tthumbnailQuality\n\t\t\t);\n\t\t},\n\t},\n\twatch: {\n\t\tquality(quality: number, oldQuality: number) {\n\t\t\tif (quality === qualityFactor) {\n\t\t\t\teventBus.fire(\n\t\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t\t'Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression.'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (\n\t\t\t\toldQuality > qualityWarningThreshold &&\n\t\t\t\tquality <= qualityWarningThreshold\n\t\t\t) {\n\t\t\t\teventBus.fire(\n\t\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t\t'Note: A quality level below 70% might be very noticable and impair legibility of text.'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.panel_button {\n\theight: 150px;\n\twidth: 150px;\n\tflex-shrink: 0;\n\tpadding: 4px;\n\tbackground-size: contain;\n\tbackground-position: center center;\n\tbackground-repeat: no-repeat;\n\tbackground-color: $default-native-background;\n\tbackground-color: var(--native-background);\n\tborder: 2px solid $default-border;\n\tborder: 2px solid var(--border);\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground-color: $default-native-background;\n\tbackground-color: var(--native-background);\n\n\ttext-shadow: 0 0 4px #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000,\n\t\t1px 1px 0 #000;\n\n\t&.active {\n\t\tbackground-color: $default-border;\n\t\tbackground-color: var(--border);\n\t}\n}\n\n.panel_text {\n\tflex-grow: 1;\n\tposition: relative;\n\n\tp {\n\t\theight: 60px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\twhite-space: pre;\n\t}\n}\n\n.panel_nr {\n\ttext-align: right;\n}\n\n#export_ppi,\n#export_pages {\n\twidth: 128px;\n}\n\nsmall {\n\tfont-size: 0.75em;\n}\n\n.panel {\n\t&.vertical {\n\t\t.column {\n\t\t\twidth: 100%;\n\n\t\t\tbutton,\n\t\t\tselect {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\tfieldset {\n\t\t\twidth: 100%;\n\t\t\t.existing_panels {\n\t\t\t\tmax-height: 350px;\n\t\t\t\twidth: 100%;\n\t\t\t\tflex-direction: column;\n\n\t\t\t\t.panel_button {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 150px;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttable {\n\t\t\t\twidth: 100%;\n\t\t\t\ttd {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tdisplay: table-row;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t&:not(.vertical) {\n\t\t.column {\n\t\t\tdisplay: flex;\n\t\t\t@include height-100();\n\t\t\tflex-direction: column;\n\t\t\tflex-wrap: wrap;\n\n\t\t\ttextarea {\n\t\t\t\theight: 100%;\n\t\t\t}\n\t\t}\n\n\t\t.existing_panels_fieldset {\n\t\t\t@include height-100();\n\t\t}\n\n\t\tfieldset {\n\t\t\t.existing_panels {\n\t\t\t\tflex-direction: row;\n\n\t\t\t\t.panel_button {\n\t\t\t\t\theight: 100%;\n\t\t\t\t\twidth: 150px;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttable {\n\t\t\t\ttd {\n\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n</style>\n","import { Module } from 'vuex';\nimport { ContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, BackgroundLookup } from './content';\nimport { IRootState } from '.';\nimport { arraySeeker } from '@/models/seekers';\nimport { ICopyObjectsAction, IDeleteAllOfPanel } from './objects';\nimport {\n\taddFilter,\n\tIAddFilterAction,\n\tIHasSpriteFilters,\n\tIMoveFilterAction,\n\tIRemoveFilterAction,\n\tISetCompositionMutation,\n\tISetFilterAction,\n\tISetFiltersMutation,\n\tmoveFilter,\n\tremoveFilter,\n\tsetFilter,\n} from './sprite_options';\n\nexport enum ScalingModes {\n\tNone = 0,\n\tStretch = 1,\n\tCover = 2,\n}\n\nexport interface IPanel extends IHasSpriteFilters {\n\tid: string;\n\tbackground: IPanelBackground;\n\tlastRender: string;\n}\n\ninterface IPanelBackground extends IHasSpriteFilters {\n\tcurrent: string;\n\tcolor: string;\n\tflipped: boolean;\n\tvariant: number;\n\tscaling: ScalingModes;\n}\n\nexport interface IPanels {\n\tpanels: { [id: string]: IPanel };\n\tpanelOrder: string[];\n\tcurrentPanel: string;\n}\n\nexport const transparentId = 'buildin.transparent';\nexport const staticColorId = 'buildin.static-color';\n\nlet lastPanelNum = 0;\n\nconst previewManager = {\n\tpanelToUrl: new Map<string, string>(),\n\turlToPanel: new Map<string, string[]>(),\n\tregister(panelId: string, url: string) {\n\t\tif (this.panelToUrl.has(panelId)) {\n\t\t\tif (this.panelToUrl.get(panelId) === url) return;\n\t\t\tthis.unregister(panelId, this.panelToUrl.get(panelId)!);\n\t\t}\n\t\tthis.panelToUrl.set(panelId, url);\n\t\tif (this.urlToPanel.has(url)) {\n\t\t\tthis.urlToPanel.get(url)!.push(panelId);\n\t\t} else {\n\t\t\tthis.urlToPanel.set(url, [panelId]);\n\t\t}\n\t},\n\tunregister(panelId: string, url: string) {\n\t\tif (this.urlToPanel.has(url)) {\n\t\t\tconst panels = this.urlToPanel.get(url)!;\n\t\t\tpanels.splice(panels.indexOf(panelId), 1);\n\t\t\tif (panels.length === 0) {\n\t\t\t\tthis.urlToPanel.delete(url);\n\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t}\n\t\t}\n\t\tthis.panelToUrl.delete(panelId);\n\t},\n};\n\nexport default {\n\tnamespaced: true,\n\tstate: {\n\t\tpanels: {},\n\t\tpanelOrder: [],\n\t\tcurrentPanel: null!,\n\t},\n\tmutations: {\n\t\tsetCurrentPanel(state, { panelId }: ISetCurrentPanelMutation) {\n\t\t\tstate.currentPanel = panelId;\n\t\t},\n\t\tsetPanelPreview(state, { panelId, url }: ISetPanelPreviewMutation) {\n\t\t\tstate.panels[panelId].lastRender = url;\n\t\t\tpreviewManager.register(panelId, url);\n\t\t},\n\t\tcreatePanel(state, { panel }: ICreatePanel) {\n\t\t\tstate.panels[panel.id] = panel;\n\t\t},\n\t\tsetPanelOrder(state, { panelOrder }: ISetPanelOrder) {\n\t\t\tstate.panelOrder = [...panelOrder];\n\t\t},\n\t\tsetCurrentBackground(state, { current, panelId }: ISetCurrentMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.current = current;\n\t\t\tpanel.background.variant = 0;\n\t\t},\n\t\tsetBackgroundColor(state, { color, panelId }: ISetColorMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.color = color;\n\t\t},\n\t\tsetBackgroundFlipped(state, { flipped, panelId }: ISetFlipMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.flipped = flipped;\n\t\t},\n\t\tsetBackgroundVariant(state, { variant, panelId }: ISetVariantMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.variant = variant;\n\t\t},\n\t\tsetBackgroundScaling(state, { scaling, panelId }: ISetScalingMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.scaling = scaling;\n\t\t},\n\t\tdeletePanel(state, { panelId }: IDeletePanelMutation) {\n\t\t\tpreviewManager.unregister(\n\t\t\t\tpanelId,\n\t\t\t\tpreviewManager.panelToUrl.get(panelId)!\n\t\t\t);\n\t\t\tdelete state.panels[panelId];\n\t\t},\n\t\tsetComposition(state, command: ISetCompositionMutation) {\n\t\t\tconst obj = state.panels[command.id];\n\t\t\tobj.composite = command.composite;\n\t\t},\n\t\tsetFilters(state, command: ISetFiltersMutation) {\n\t\t\tconst obj = state.panels[command.id];\n\t\t\tobj.filters = command.filters;\n\t\t},\n\t\tbackgroundSetComposition(state, command: ISetCompositionMutation) {\n\t\t\tconst obj = state.panels[command.id];\n\t\t\tobj.background.composite = command.composite;\n\t\t},\n\t\tbackgroundSetFilters(state, command: ISetFiltersMutation) {\n\t\t\tconst obj = state.panels[command.id];\n\t\t\tobj.background.filters = command.filters;\n\t\t},\n\t},\n\tactions: {\n\t\tcreatePanel({ state, commit }) {\n\t\t\tconst id = 'panel' + ++lastPanelNum;\n\t\t\tcommit('createPanel', {\n\t\t\t\tpanel: {\n\t\t\t\t\tid,\n\t\t\t\t\tbackground: {\n\t\t\t\t\t\tcolor: '#000000',\n\t\t\t\t\t\tcurrent: transparentId,\n\t\t\t\t\t\tflipped: false,\n\t\t\t\t\t\tscaling: ScalingModes.None,\n\t\t\t\t\t\tvariant: 0,\n\t\t\t\t\t\tcomposite: 'source-over',\n\t\t\t\t\t\tfilters: [],\n\t\t\t\t\t},\n\t\t\t\t\tlastRender: '',\n\t\t\t\t\tcomposite: 'source-over',\n\t\t\t\t\tfilters: [],\n\t\t\t\t},\n\t\t\t} as ICreatePanel);\n\t\t\tif (!state.panelOrder) {\n\t\t\t\tcommit('setPanelOrder', {\n\t\t\t\t\tpanelOrder: [id],\n\t\t\t\t} as ISetPanelOrder);\n\t\t\t} else {\n\t\t\t\tcommit('setPanelOrder', {\n\t\t\t\t\tpanelOrder: [...state.panelOrder, id],\n\t\t\t\t} as ISetPanelOrder);\n\t\t\t}\n\t\t\tcommit('setCurrentPanel', {\n\t\t\t\tpanelId: id,\n\t\t\t} as ISetCurrentPanelMutation);\n\t\t},\n\t\tduplicatePanel(\n\t\t\t{ state, commit, dispatch },\n\t\t\t{ panelId }: IDuplicatePanelAction\n\t\t) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tconst id = 'panel' + ++lastPanelNum;\n\t\t\tpreviewManager.register(id, panel.lastRender);\n\t\t\tcommit('createPanel', {\n\t\t\t\tpanel: {\n\t\t\t\t\tid,\n\t\t\t\t\tbackground: JSON.parse(JSON.stringify(panel.background)),\n\t\t\t\t\tlastRender: panel.lastRender,\n\t\t\t\t\tcomposite: panel.composite,\n\t\t\t\t\tfilters: JSON.parse(JSON.stringify(panel.filters)),\n\t\t\t\t},\n\t\t\t} as ICreatePanel);\n\t\t\tdispatch(\n\t\t\t\t'objects/copyObjects',\n\t\t\t\t{\n\t\t\t\t\tsourcePanelId: panelId,\n\t\t\t\t\ttargetPanelId: id,\n\t\t\t\t} as ICopyObjectsAction,\n\t\t\t\t{ root: true }\n\t\t\t);\n\t\t\tconst oldIdx = state.panelOrder.indexOf(panelId);\n\t\t\tcommit('setPanelOrder', {\n\t\t\t\tpanelOrder: [\n\t\t\t\t\t...state.panelOrder.slice(0, oldIdx + 1),\n\t\t\t\t\tid,\n\t\t\t\t\t...state.panelOrder.slice(oldIdx + 1),\n\t\t\t\t],\n\t\t\t} as ISetPanelOrder);\n\t\t\tcommit('setCurrentPanel', {\n\t\t\t\tpanelId: id,\n\t\t\t} as ISetCurrentPanelMutation);\n\t\t},\n\t\tseekBackgroundVariant(\n\t\t\t{ state, rootGetters, commit },\n\t\t\t{ delta }: ISeekVariantAction\n\t\t) {\n\t\t\tconst panel = state.panels[state.currentPanel];\n\t\t\tconst backgrounds = rootGetters[\n\t\t\t\t'content/getBackgrounds'\n\t\t\t] as BackgroundLookup;\n\t\t\tconst background = backgrounds.get(panel.background.current);\n\t\t\tif (!background) return;\n\t\t\tcommit('setBackgroundVariant', {\n\t\t\t\tpanelId: state.currentPanel,\n\t\t\t\tvariant: arraySeeker(\n\t\t\t\t\tbackground.variants,\n\t\t\t\t\tpanel.background.variant,\n\t\t\t\t\tdelta\n\t\t\t\t),\n\t\t\t} as ISetVariantMutation);\n\t\t},\n\t\tdelete({ state, dispatch, commit }, { panelId }: IDeletePanelAction) {\n\t\t\tif (state.panelOrder.length <= 1) return;\n\t\t\tconst orderIdx = state.panelOrder.indexOf(panelId);\n\t\t\tlet newOrderIdx;\n\t\t\tif (orderIdx === state.panelOrder.length - 1) {\n\t\t\t\tnewOrderIdx = orderIdx - 1;\n\t\t\t} else {\n\t\t\t\tnewOrderIdx = orderIdx + 1;\n\t\t\t}\n\t\t\tcommit('setCurrentPanel', {\n\t\t\t\tpanelId: state.panelOrder[newOrderIdx],\n\t\t\t} as ISetCurrentPanelMutation);\n\t\t\tcommit('setPanelOrder', {\n\t\t\t\tpanelOrder: [\n\t\t\t\t\t...state.panelOrder.slice(0, orderIdx),\n\t\t\t\t\t...state.panelOrder.slice(orderIdx + 1),\n\t\t\t\t],\n\t\t\t} as ISetPanelOrder);\n\t\t\tdispatch(\n\t\t\t\t'objects/deleteAllOfPanel',\n\t\t\t\t{\n\t\t\t\t\tpanelId,\n\t\t\t\t} as IDeleteAllOfPanel,\n\t\t\t\t{ root: true }\n\t\t\t);\n\t\t\tcommit('deletePanel', {\n\t\t\t\tpanelId,\n\t\t\t} as IDeletePanelMutation);\n\t\t},\n\t\tasync fixContentPackRemoval(\n\t\t\t{ state, rootGetters, commit, rootState },\n\t\t\toldContent: ContentPack<IAsset>\n\t\t) {\n\t\t\tfor (const panel of Object.values(state.panels)) {\n\t\t\t\tconst oldBackground = oldContent.backgrounds.find(\n\t\t\t\t\tx => x.id === panel.background.current\n\t\t\t\t);\n\t\t\t\t// Probably build in?\n\t\t\t\tif (!oldBackground) return;\n\n\t\t\t\tconst newBackground = (rootGetters[\n\t\t\t\t\t'content/getBackgrounds'\n\t\t\t\t] as BackgroundLookup).get(panel.background.current);\n\n\t\t\t\tif (!newBackground) {\n\t\t\t\t\tif (rootState.content.current.backgrounds[0]) {\n\t\t\t\t\t\tcommit('setCurrentBackground', {\n\t\t\t\t\t\t\tcurrent: rootState.content.current.backgrounds[0].id,\n\t\t\t\t\t\t\tpanelId: panel.id,\n\t\t\t\t\t\t} as ISetCurrentMutation);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcommit('setCurrentBackground', {\n\t\t\t\t\t\t\tcurrent: 'buildin.transparent',\n\t\t\t\t\t\t\tpanelId: panel.id,\n\t\t\t\t\t\t} as ISetCurrentMutation);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst oldVariantJSON = JSON.stringify(\n\t\t\t\t\toldBackground.variants[panel.background.variant]\n\t\t\t\t);\n\t\t\t\tconst newVariantIdx = newBackground.variants.findIndex(\n\t\t\t\t\tvariant => JSON.stringify(variant) === oldVariantJSON\n\t\t\t\t);\n\t\t\t\tif (newVariantIdx !== panel.background.variant) {\n\t\t\t\t\tcommit('setBackgroundVariant', {\n\t\t\t\t\t\tvariant: newVariantIdx === -1 ? 0 : newVariantIdx,\n\t\t\t\t\t\tpanelId: panel.id,\n\t\t\t\t\t} as ISetVariantMutation);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmove({ state, commit }, { panelId, delta }: IMovePanelAction) {\n\t\t\tconst collection = [...state.panelOrder];\n\t\t\tconst oldIdx = collection.indexOf(panelId);\n\t\t\tcollection.splice(oldIdx, 1);\n\t\t\tconst newIdx = Math.max(oldIdx + delta, 0);\n\t\t\tcollection.splice(newIdx, 0, panelId);\n\t\t\tcommit('setPanelOrder', { panelOrder: collection } as ISetPanelOrder);\n\t\t},\n\t\taddFilter({ state, commit }, action: IAddFilterAction) {\n\t\t\taddFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tremoveFilter({ state, commit }, action: IRemoveFilterAction) {\n\t\t\tremoveFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tmoveFilter({ state, commit }, action: IMoveFilterAction) {\n\t\t\tmoveFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tsetFilter({ state, commit }, action: ISetFilterAction) {\n\t\t\tsetFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tbackgroundAddFilter({ state, commit }, action: IAddFilterAction) {\n\t\t\taddFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id].background,\n\t\t\t\tmutation => commit('backgroundSetFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tbackgroundRemoveFilter({ state, commit }, action: IRemoveFilterAction) {\n\t\t\tremoveFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id].background,\n\t\t\t\tmutation => commit('backgroundSetFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tbackgroundMoveFilter({ state, commit }, action: IMoveFilterAction) {\n\t\t\tmoveFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id].background,\n\t\t\t\tmutation => commit('backgroundSetFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tbackgroundSetFilter({ state, commit }, action: ISetFilterAction) {\n\t\t\tsetFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id].background,\n\t\t\t\tmutation => commit('backgroundSetFilters', mutation)\n\t\t\t);\n\t\t},\n\t},\n} as Module<IPanels, IRootState>;\n\nexport interface ISetCurrentPanelMutation {\n\treadonly panelId: string;\n}\n\nexport interface IDeletePanelMutation {\n\treadonly panelId: string;\n}\n\nexport interface ISetPanelPreviewMutation {\n\treadonly panelId: string;\n\treadonly url: string;\n}\n\nexport interface IDuplicatePanelAction {\n\treadonly panelId: string;\n}\n\nexport interface IDeletePanelAction {\n\treadonly panelId: string;\n}\n\nexport interface ICreatePanel {\n\treadonly panel: IPanel;\n}\n\nexport interface ISetPanelOrder {\n\treadonly panelOrder: string[];\n}\n\nexport interface ISetCurrentMutation {\n\treadonly panelId: string;\n\treadonly current: string;\n}\n\nexport interface ISetColorMutation {\n\treadonly panelId: string;\n\treadonly color: string;\n}\n\nexport interface ISetFlipMutation {\n\treadonly panelId: string;\n\treadonly flipped: boolean;\n}\n\nexport interface ISetVariantMutation {\n\treadonly panelId: string;\n\treadonly variant: number;\n}\n\nexport interface ISetScalingMutation {\n\treadonly panelId: string;\n\treadonly scaling: ScalingModes;\n}\n\nexport interface ISeekVariantAction {\n\treadonly delta: 1 | -1;\n}\n\nexport interface IMovePanelAction {\n\treadonly panelId: string;\n\treadonly delta: number;\n}\n","import { CompositeModes, RenderContext } from '@/renderer/rendererContext';\nimport { getAAsset } from '@/asset-manager';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport { IAsset } from '@/store/content';\nimport { ScalingModes } from '@/store/panels';\nimport { DeepReadonly } from '@/util/readonly';\nimport { SpriteFilter } from '@/store/sprite_options';\n\nexport interface IBackgroundRenderer {\n\trender(rx: RenderContext): Promise<void>;\n}\n\nexport class Background implements IBackgroundRenderer {\n\tpublic constructor(\n\t\tpublic readonly id: string,\n\t\tpublic readonly assets: DeepReadonly<IAsset[]>,\n\t\tpublic readonly flip: boolean,\n\t\tpublic readonly scale: ScalingModes,\n\t\tpublic readonly compositeMode: CompositeModes,\n\t\tpublic readonly filters: DeepReadonly<SpriteFilter[]>\n\t) {}\n\n\tpublic async render(rx: RenderContext): Promise<void> {\n\t\tconst images = await Promise.all(\n\t\t\tthis.assets.map(asset => getAAsset(asset, rx.hq))\n\t\t);\n\t\tfor (const image of images) {\n\t\t\tif (!(image instanceof HTMLImageElement)) return;\n\t\t\tlet x = 0;\n\t\t\tlet y = 0;\n\t\t\tlet w = image.width;\n\t\t\tlet h = image.height;\n\n\t\t\tswitch (this.scale) {\n\t\t\t\tcase ScalingModes.None:\n\t\t\t\t\tx = screenWidth / 2 - w / 2;\n\t\t\t\t\ty = screenHeight / 2 - h / 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScalingModes.Stretch:\n\t\t\t\t\tw = screenWidth;\n\t\t\t\t\th = screenHeight;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScalingModes.Cover:\n\t\t\t\t\tconst ratio = w / h;\n\t\t\t\t\tconst screenRatio = screenWidth / screenHeight;\n\n\t\t\t\t\tif (ratio > screenRatio) {\n\t\t\t\t\t\th = screenHeight;\n\t\t\t\t\t\tw = h * ratio;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tw = screenWidth;\n\t\t\t\t\t\th = w / ratio;\n\t\t\t\t\t}\n\n\t\t\t\t\tx = screenWidth / 2 - w / 2;\n\t\t\t\t\ty = screenHeight / 2 - h / 2;\n\t\t\t}\n\n\t\t\trx.drawImage({\n\t\t\t\timage,\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tw,\n\t\t\t\th,\n\t\t\t\tflip: this.flip,\n\t\t\t\tcomposite: this.compositeMode,\n\t\t\t\tfilters: this.filters,\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport const color = {\n\tid: 'buildin.static-color',\n\tname: 'Static color',\n\tcolor: '#000000',\n\n\tasync render(rx: RenderContext): Promise<void> {\n\t\trx.drawRect({\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tw: screenWidth,\n\t\t\th: screenHeight,\n\t\t\tfill: { style: this.color },\n\t\t});\n\t},\n};\n\nexport const transparent = {\n\tid: 'buildin.transparent',\n\tname: 'Transparent',\n\t// tslint:disable-next-line: no-empty\n\tasync render(rx: RenderContext) {},\n};\n","import { getAAsset } from '@/asset-manager';\nimport { ISprite } from '@/store/objectTypes/sprite';\nimport { DeepReadonly } from '@/util/readonly';\nimport {\n\tAssetListRenderable,\n\tIDrawAssets,\n\tIDrawAssetsUnloaded,\n} from './assetListRenderable';\n\nexport class Sprite extends AssetListRenderable<ISprite> {\n\tprivate assets!: IDrawAssets[];\n\tprotected ready!: Promise<void>;\n\tprotected canvasHeight: number = 0;\n\tprotected canvasWidth: number = 0;\n\n\tconstructor(obj: DeepReadonly<ISprite>) {\n\t\tsuper(obj);\n\t\tthis.init();\n\t}\n\n\tprotected get version(): number {\n\t\treturn this.assets === null ? -1 : this.obj.version;\n\t}\n\n\tpublic async init() {\n\t\tlet readyResolve!: () => void;\n\t\tthis.ready = new Promise((resolve, reject) => {\n\t\t\treadyResolve = resolve;\n\t\t});\n\t\tconst assets = await Promise.all(\n\t\t\tthis.obj.assets.map(asset => getAAsset(asset))\n\t\t);\n\t\tlet width = 0;\n\t\tlet height = 0;\n\t\tfor (const asset of assets) {\n\t\t\tif (asset instanceof HTMLImageElement) {\n\t\t\t\tif (asset.height > height) height = asset.height;\n\t\t\t\tif (asset.width > width) width = asset.width;\n\t\t\t}\n\t\t}\n\t\tthis.canvasWidth = width;\n\t\tthis.canvasHeight = height;\n\t\tthis.assets = [\n\t\t\t{\n\t\t\t\tloaded: true,\n\t\t\t\tassets,\n\t\t\t\toffset: [0, 0],\n\t\t\t},\n\t\t];\n\t\treadyResolve();\n\t}\n\tprotected getAssetList(): (IDrawAssets | IDrawAssetsUnloaded)[] {\n\t\treturn this.assets || [];\n\t}\n}\n","export function roundedRectangle(\n\tctx: CanvasPath,\n\tx: number,\n\ty: number,\n\tw: number,\n\th: number,\n\tr: number\n) {\n\tif (w < 0) w = 0;\n\tif (h < 0) h = 0;\n\tif (w < 2 * r) r = w / 2;\n\tif (h < 2 * r) r = h / 2;\n\tctx.moveTo(x + r, y);\n\tctx.arcTo(x + w, y, x + w, y + h, r);\n\tctx.arcTo(x + w, y + h, x, y + h, r);\n\tctx.arcTo(x, y + h, x, y, r);\n\tctx.arcTo(x, y, x + w, y, r);\n\tctx.closePath();\n}\n\nexport function roundedTopRectangle(\n\tctx: CanvasPath,\n\tx: number,\n\ty: number,\n\tw: number,\n\th: number,\n\tr: number\n) {\n\tif (w < 0) w = 0;\n\tif (h < 0) h = 0;\n\tif (w < 2 * r) r = w / 2;\n\tif (h < 2 * r) r = h / 2;\n\tctx.moveTo(x + r, y);\n\tctx.arcTo(x + w, y, x + w, y + h, r);\n\tctx.lineTo(x + w, y + h);\n\tctx.lineTo(x, y + h);\n\tctx.arcTo(x, y, x + w, y, r);\n\tctx.closePath();\n}\n","import { OffscreenRenderable } from './offscreenRenderable';\nimport { IObject } from '@/store/objects';\nimport { screenHeight, screenWidth } from '@/constants/base';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { IHitbox } from './renderable';\n\nexport abstract class ScalingRenderable<\n\tObj extends IObject\n> extends OffscreenRenderable<Obj> {\n\tprotected lastWidth = -1;\n\tprotected lastHeight = -1;\n\tprotected lastX = -1;\n\tprotected lastY = -1;\n\tprotected lastFlip: boolean | null = null;\n\n\tprotected readonly canvasHeight = screenHeight;\n\tprotected readonly canvasWidth = screenWidth;\n\tprotected readonly canvasDrawHeight = screenHeight;\n\tprotected readonly canvasDrawWidth = screenWidth;\n\tprotected readonly canvasDrawPosX = 0;\n\tprotected readonly canvasDrawPosY = 0;\n\n\tpublic getRenderRotation(): [number, { x: number; y: number } | undefined] {\n\t\treturn [0, undefined];\n\t}\n\n\tpublic needsRedraw(): boolean {\n\t\tif (super.needsRedraw()) return true;\n\t\treturn (\n\t\t\tthis.width !== this.lastWidth ||\n\t\t\tthis.height !== this.lastHeight ||\n\t\t\tthis.x !== this.lastX ||\n\t\t\tthis.y !== this.lastY ||\n\t\t\tthis.flip !== this.lastFlip\n\t\t);\n\t}\n\n\tpublic async updateLocalCanvas(hq: boolean) {\n\t\tthis.lastWidth = this.width;\n\t\tthis.lastHeight = this.height;\n\t\tthis.lastX = this.x;\n\t\tthis.lastY = this.y;\n\t\tthis.lastFlip = this.flip;\n\t\tawait super.updateLocalCanvas(hq);\n\t}\n\n\tprotected async renderLocal(rx: RenderContext): Promise<void> {\n\t\tif (this.rotation === 0) return this.draw(rx);\n\t\tawait rx.customTransform(async trx => {\n\t\t\tconst hitbox = this.getHitbox();\n\t\t\tconst centerX = hitbox.x0 + (hitbox.x1 - hitbox.x0) / 2;\n\t\t\tconst centerY = hitbox.y0 + (hitbox.y1 - hitbox.y0) / 2;\n\n\t\t\tconst flipNormalizedCenterX = this.flip ? screenWidth - centerX : centerX;\n\n\t\t\ttrx.translate(flipNormalizedCenterX, centerY);\n\t\t\ttrx.rotate(this.rotation);\n\t\t\ttrx.translate(-flipNormalizedCenterX, -centerY);\n\t\t}, this.draw.bind(this));\n\t}\n\n\tpublic getHitbox(): IHitbox {\n\t\tconst vCentered = this.centeredVertically;\n\t\tconst w2 = this.width / 2;\n\t\tconst h2 = this.height / 2;\n\t\treturn {\n\t\t\tx0: this.x - w2,\n\t\t\tx1: this.x + w2,\n\t\t\ty0: vCentered ? this.y - h2 : this.y,\n\t\t\ty1: vCentered ? this.y + h2 : this.y + this.height,\n\t\t};\n\t}\n\n\tprotected abstract draw(rx: RenderContext): Promise<void>;\n\n\tprotected get centeredVertically(): boolean {\n\t\treturn false;\n\t}\n}\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { getAsset } from '@/asset-manager';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport {\n\tNameboxTextStyle,\n\tControlsTextStyle,\n\tControlsTextDisabledStyle,\n\tTextBoxWidth,\n\tNameboxHeight,\n\tTextBoxHeight,\n\tTextBoxCorruptedWidth,\n\tNameboxXOffset,\n\tNameboxWidth,\n\tNameboxTextYOffset,\n\tControlsXHistoryOffset,\n\tControlsXSkipOffset,\n\tControlsXStuffOffset,\n\tArrowXRightOffset,\n\tArrowYBottomOffset,\n\tTextBoxTextYOffset,\n\tTextBoxTextXOffset,\n\tControlsYBottomOffset,\n\tGlowRY,\n\tGlowRX,\n} from '@/constants/textBox';\nimport { Renderer } from '@/renderer/renderer';\nimport { roundedRectangle, roundedTopRectangle } from '@/renderer/pathTools';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { TextRenderer, ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport {\n\tnameboxTextOutlineDelta,\n\tnameboxBackgroundDelta,\n\tnameboxGradientEndDelta,\n\tnameboxGradientMiddleStopPosition,\n\tcontrolColorDelta,\n\tcontrolDisableColorDelta,\n\tnameboxRounding,\n\tdotColorDelta,\n\tdotRadius,\n\tdotPatternSize,\n\ttextboxRoundingBuffer,\n\ttextboxRounding,\n\ttextboxOutlineColorDelta,\n\ttextboxDefaultColor,\n} from '@/constants/textBoxCustom';\nimport { ScalingRenderable } from './scalingRenderable';\nimport { Store } from 'vuex';\nimport { DeepReadonly } from 'vue';\nimport { IRootState } from '@/store';\nimport { IObject } from '@/store/objects';\n\nexport class TextBox extends ScalingRenderable<ITextBox> {\n\tprotected refObject: IObject | null = null;\n\n\tpublic get width(): number {\n\t\treturn this.obj.style === 'custom' ? this.obj.width : TextBoxWidth;\n\t}\n\n\tpublic get height(): number {\n\t\treturn (\n\t\t\t(this.obj.style === 'custom' ? this.obj.height : TextBoxHeight) +\n\t\t\tNameboxHeight\n\t\t);\n\t}\n\n\tpublic get forcedStyle(): ITextBox['style'] {\n\t\tif (\n\t\t\tthis.obj.style === 'normal' &&\n\t\t\tthis.refObject &&\n\t\t\t(this.refObject.textboxColor || this.refObject.nameboxWidth !== null)\n\t\t)\n\t\t\treturn 'custom';\n\t\treturn this.obj.style;\n\t}\n\n\tpublic get customColor(): string {\n\t\tif (this.obj.overrideColor) return this.obj.customColor;\n\t\tif (this.refObject && this.refObject.textboxColor)\n\t\t\treturn this.refObject.textboxColor;\n\t\treturn textboxDefaultColor;\n\t}\n\n\tpublic get controlColor(): string {\n\t\tif (this.obj.deriveCustomColors) {\n\t\t\tconst base = RGBAColor.fromCss(this.customColor).toHSL();\n\t\t\treturn base\n\t\t\t\t.shift(controlColorDelta)\n\t\t\t\t.toRgb()\n\t\t\t\t.toCss();\n\t\t}\n\t\treturn this.obj.customControlsColor;\n\t}\n\n\tpublic get controlsStyle() {\n\t\tif (this.forcedStyle !== 'custom') return ControlsTextStyle;\n\t\treturn {\n\t\t\t...ControlsTextStyle,\n\t\t\tfill: {\n\t\t\t\tstyle: this.controlColor,\n\t\t\t},\n\t\t};\n\t}\n\n\tpublic get controlsDisableStyle() {\n\t\tif (this.forcedStyle !== 'custom') return ControlsTextDisabledStyle;\n\n\t\tconst col = RGBAColor.fromCss(this.controlColor).toHSL();\n\t\tconst disColor = col\n\t\t\t.shift(controlDisableColorDelta)\n\t\t\t.toRgb()\n\t\t\t.toCss();\n\n\t\treturn {\n\t\t\t...ControlsTextStyle,\n\n\t\t\tfill: {\n\t\t\t\tstyle: disColor,\n\t\t\t},\n\t\t};\n\t}\n\tpublic updatedContent(\n\t\t_current: Store<DeepReadonly<IRootState>>,\n\t\tpanelId: string\n\t): void {\n\t\tsuper.updatedContent(_current, panelId);\n\n\t\tconst talkingObj = this.obj.talkingObjId;\n\t\tif (talkingObj !== null && talkingObj !== '$other$') {\n\t\t\tconst obj = _current.state.objects.objects[talkingObj] as IObject;\n\t\t\tif (obj) {\n\t\t\t\tthis.refObject = obj;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.refObject = null;\n\t}\n\n\tprotected async draw(rx: RenderContext): Promise<void> {\n\t\tconst w = this.width;\n\t\tconst h = this.height;\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.flip ? screenWidth - this.obj.x : this.obj.x;\n\t\tconst x = baseX - w2;\n\t\tconst y = this.obj.y;\n\n\t\tawait this.renderBackdrop(rx, x, y + NameboxHeight);\n\n\t\tif (this.obj.talkingObjId !== null) {\n\t\t\tconst name =\n\t\t\t\tthis.obj.talkingObjId === '$other$'\n\t\t\t\t\t? this.obj.talkingOther\n\t\t\t\t\t: this.refObject?.label || 'Missing name';\n\t\t\tawait this.renderNamebox(rx, x + NameboxXOffset, y, name);\n\t\t}\n\n\t\tawait this.renderText(rx, x, y, this.obj.autoWrap ? w : 0);\n\n\t\tconst bottom = y + h;\n\t\tconst controlsY = bottom - ControlsYBottomOffset;\n\t\tconst controlsCenter = x + w / 2;\n\n\t\tif (this.obj.controls) {\n\t\t\trx.drawText({\n\t\t\t\ttext: 'History',\n\t\t\t\tx: controlsCenter + ControlsXHistoryOffset,\n\t\t\t\ty: controlsY,\n\t\t\t\t...this.controlsStyle,\n\t\t\t});\n\t\t\trx.drawText({\n\t\t\t\ttext: 'Skip',\n\t\t\t\tx: controlsCenter + ControlsXSkipOffset,\n\t\t\t\ty: controlsY,\n\t\t\t\t...(this.obj.skip ? this.controlsStyle : this.controlsDisableStyle),\n\t\t\t});\n\t\t\trx.drawText({\n\t\t\t\ttext: 'Auto   Save   Load   Settings',\n\t\t\t\tx: controlsCenter + ControlsXStuffOffset,\n\t\t\t\ty: controlsY,\n\t\t\t\t...this.controlsStyle,\n\t\t\t});\n\t\t}\n\n\t\tif (this.obj.continue) {\n\t\t\trx.drawImage({\n\t\t\t\timage: await getAsset('next'),\n\t\t\t\tx: x + w - ArrowXRightOffset,\n\t\t\t\ty: bottom - ArrowYBottomOffset,\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate get nameboxOutlineColor(): string {\n\t\tif (this.obj.deriveCustomColors) {\n\t\t\tconst base = RGBAColor.fromCss(this.customColor).toHSL();\n\t\t\treturn base\n\t\t\t\t.shift(nameboxTextOutlineDelta)\n\t\t\t\t.toRgb()\n\t\t\t\t.toCss();\n\t\t}\n\t\treturn this.obj.customNameboxStroke;\n\t}\n\n\tprivate get nameboxBackgroundColor(): string {\n\t\tif (this.obj.deriveCustomColors) {\n\t\t\tconst base = RGBAColor.fromCss(this.customColor).toHSL();\n\t\t\treturn base\n\t\t\t\t.shift(nameboxBackgroundDelta)\n\t\t\t\t.toRgb()\n\t\t\t\t.toCss();\n\t\t}\n\t\treturn this.obj.customNameboxColor;\n\t}\n\n\tprivate get nameboxWidth(): number {\n\t\tif (this.forcedStyle !== 'custom') return NameboxWidth;\n\t\tif (this.refObject && this.refObject.nameboxWidth !== null) {\n\t\t\treturn this.refObject.nameboxWidth;\n\t\t}\n\t\tif (this.obj.customNameboxWidth !== null)\n\t\t\treturn this.obj.customNameboxWidth;\n\t\treturn NameboxWidth;\n\t}\n\n\tprivate async renderNamebox(\n\t\trx: RenderContext,\n\t\tx: number,\n\t\ty: number,\n\t\tname: string\n\t): Promise<void> {\n\t\tlet w: number;\n\t\tconst h = NameboxHeight;\n\t\tlet style: ITextStyle = NameboxTextStyle;\n\t\tif (this.forcedStyle === 'custom') {\n\t\t\tstyle = {\n\t\t\t\t...style,\n\t\t\t\tstrokeColor: this.nameboxOutlineColor,\n\t\t\t\tstrokeWidth: 6,\n\t\t\t\tcolor: '#FFFFFF',\n\t\t\t};\n\t\t\tw = this.nameboxWidth;\n\t\t\tawait rx.customTransform(\n\t\t\t\tasync ctx => {\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\troundedTopRectangle(ctx, x, y, w, h, nameboxRounding);\n\t\t\t\t\tctx.clip();\n\t\t\t\t},\n\t\t\t\tasync subRx => {\n\t\t\t\t\tconst gradient = subRx.linearGradient(x, y, x, y + NameboxHeight);\n\t\t\t\t\tconst baseBG = RGBAColor.fromCss(this.nameboxBackgroundColor);\n\t\t\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\t\t\tconst color = new RGBAColor(baseBG.r, baseBG.g, baseBG.b, 0.95);\n\t\t\t\t\tconst targetColor = color\n\t\t\t\t\t\t.toHSL()\n\t\t\t\t\t\t.shift(nameboxGradientEndDelta)\n\t\t\t\t\t\t.toRgb();\n\t\t\t\t\tgradient.addColorStop(0, color.toCss());\n\t\t\t\t\tgradient.addColorStop(\n\t\t\t\t\t\tnameboxGradientMiddleStopPosition,\n\t\t\t\t\t\tcolor.toCss()\n\t\t\t\t\t);\n\t\t\t\t\tgradient.addColorStop(1, targetColor.toCss());\n\t\t\t\t\tsubRx.drawRect({\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty,\n\t\t\t\t\t\tw: this.obj.width,\n\t\t\t\t\t\th,\n\t\t\t\t\t\tfill: {\n\t\t\t\t\t\t\tstyle: gradient,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t} else if (this.forcedStyle !== 'none') {\n\t\t\tw = this.nameboxWidth;\n\t\t\trx.drawImage({\n\t\t\t\timage: await getAsset('namebox'),\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t});\n\t\t} else {\n\t\t\tw = this.nameboxWidth;\n\t\t}\n\n\t\tconst render = new TextRenderer(name, style);\n\t\tawait render.loadFonts();\n\n\t\trender.fixAlignment('center', x, x + w, y + NameboxTextYOffset, 0);\n\n\t\trender.render(rx.fsCtx);\n\t}\n\n\tprivate async renderBackdrop(\n\t\trx: RenderContext,\n\t\tx: number,\n\t\ty: number\n\t): Promise<void> {\n\t\tif (this.forcedStyle === 'custom') {\n\t\t\tconst hslColor = RGBAColor.fromCss(this.customColor).toHSL();\n\t\t\tconst dotPattern = new Renderer(dotPatternSize, dotPatternSize);\n\t\t\tdotPattern.render(async (dotRx: RenderContext) => {\n\t\t\t\tconst fill = {\n\t\t\t\t\tstyle: hslColor\n\t\t\t\t\t\t.shift(dotColorDelta)\n\t\t\t\t\t\t.toRgb()\n\t\t\t\t\t\t.toCss(),\n\t\t\t\t};\n\n\t\t\t\tfunction drawDot(dotX: number, dotY: number) {\n\t\t\t\t\tdotRx.drawPath({\n\t\t\t\t\t\tpath: ctx => {\n\t\t\t\t\t\t\tctx.ellipse(dotX, dotY, dotRadius, dotRadius, 0, 0, 2 * Math.PI);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfill,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tdrawDot(0, 0);\n\t\t\t\tdrawDot(dotPatternSize, 0);\n\t\t\t\tdrawDot(0, dotPatternSize);\n\t\t\t\tdrawDot(dotPatternSize, dotPatternSize);\n\t\t\t\tdrawDot(dotPatternSize / 2, dotPatternSize / 2);\n\t\t\t}, true);\n\t\t\tawait rx.customTransform(\n\t\t\t\tasync ctx => {\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\troundedRectangle(\n\t\t\t\t\t\tctx,\n\t\t\t\t\t\tx + textboxRoundingBuffer,\n\t\t\t\t\t\ty + textboxRoundingBuffer,\n\t\t\t\t\t\tthis.obj.width - textboxRoundingBuffer * 2,\n\t\t\t\t\t\tthis.obj.height - textboxRoundingBuffer * 2,\n\t\t\t\t\t\ttextboxRounding\n\t\t\t\t\t);\n\t\t\t\t\tctx.clip();\n\t\t\t\t},\n\t\t\t\tasync subRx => {\n\t\t\t\t\tconst h = this.obj.height;\n\t\t\t\t\tconst w = this.obj.width;\n\t\t\t\t\tconst gradient = subRx.linearGradient(x, y, x, y + h);\n\t\t\t\t\tconst color = RGBAColor.fromHex(this.customColor);\n\t\t\t\t\tgradient.addColorStop(0, color.toCss());\n\t\t\t\t\tgradient.addColorStop(\n\t\t\t\t\t\t1,\n\t\t\t\t\t\t`rgba(${color.r},${color.g},${color.b},0.6667)`\n\t\t\t\t\t);\n\t\t\t\t\tsubRx.drawRect({\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty,\n\t\t\t\t\t\tw,\n\t\t\t\t\t\th,\n\t\t\t\t\t\tfill: {\n\t\t\t\t\t\t\tstyle: gradient,\n\t\t\t\t\t\t},\n\t\t\t\t\t\toutline: {\n\t\t\t\t\t\t\tstyle: '#ffdfee',\n\t\t\t\t\t\t\twidth: 6,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tawait subRx.customTransform(\n\t\t\t\t\t\tasync ctx => {\n\t\t\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tasync _subSubRx => {\n\t\t\t\t\t\t\tconst pattern = subRx.patternFrom(dotPattern);\n\t\t\t\t\t\t\tsubRx.drawRect({\n\t\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\t\tw,\n\t\t\t\t\t\t\t\th,\n\t\t\t\t\t\t\t\tfill: {\n\t\t\t\t\t\t\t\t\tstyle: pattern,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcomposition: 'source-atop',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tconst glowGradient = subRx.linearGradient(\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty + h - GlowRY,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty + h\n\t\t\t\t\t);\n\t\t\t\t\tglowGradient.addColorStop(0, 'rgba(255,255,255,0.3137)');\n\t\t\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\t\t\tglowGradient.addColorStop(0.5, 'rgba(255,255,255,0.0627)');\n\t\t\t\t\tglowGradient.addColorStop(1, 'rgba(255,255,255,0)');\n\t\t\t\t\tsubRx.drawPath({\n\t\t\t\t\t\tpath: ctx => {\n\t\t\t\t\t\t\tctx.ellipse(x + w / 2, y + h, GlowRX, GlowRY, 0, 0, 2 * Math.PI);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfill: {\n\t\t\t\t\t\t\tstyle: glowGradient,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t\tconst outlineColor = hslColor\n\t\t\t\t.shift(textboxOutlineColorDelta)\n\t\t\t\t.toRgb()\n\t\t\t\t.toCss();\n\t\t\trx.drawPath({\n\t\t\t\tpath: path => {\n\t\t\t\t\troundedRectangle(\n\t\t\t\t\t\tpath,\n\t\t\t\t\t\tx + textboxRoundingBuffer,\n\t\t\t\t\t\ty + textboxRoundingBuffer,\n\t\t\t\t\t\tthis.obj.width - textboxRoundingBuffer * 2,\n\t\t\t\t\t\tthis.obj.height - textboxRoundingBuffer * 2,\n\t\t\t\t\t\ttextboxRounding\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\toutline: {\n\t\t\t\t\tstyle: outlineColor,\n\t\t\t\t\twidth: 3,\n\t\t\t\t},\n\t\t\t});\n\t\t} else if (this.forcedStyle !== 'none') {\n\t\t\tif (this.forcedStyle === 'corrupt') {\n\t\t\t\tx += (TextBoxWidth - TextBoxCorruptedWidth) / 2;\n\t\t\t}\n\t\t\tconst image = await getAsset(\n\t\t\t\tthis.forcedStyle === 'corrupt' ? 'textbox_monika' : 'textbox'\n\t\t\t);\n\t\t\trx.drawImage({ image, x, y });\n\t\t}\n\t}\n\n\tprivate async renderText(\n\t\trx: RenderContext,\n\t\tbaseX: number,\n\t\tbaseY: number,\n\t\tmaxLineWidth: number\n\t): Promise<void> {\n\t\tconst render = new TextRenderer(this.obj.text, {\n\t\t\talpha: 1,\n\t\t\tcolor: '#ffffff',\n\t\t\tfontName: 'aller',\n\t\t\tfontSize: 24,\n\t\t\tisBold: false,\n\t\t\tisItalic: false,\n\t\t\tisStrikethrough: false,\n\t\t\tisUnderlined: false,\n\t\t\tletterSpacing: 0,\n\t\t\tstrokeColor: '#523140',\n\t\t\tstrokeWidth: 4,\n\t\t\tlineSpacing: 1.2,\n\t\t});\n\t\tif (this.obj.autoQuoting && this.obj.talkingObjId !== null) {\n\t\t\trender.quote();\n\t\t}\n\t\tawait render.loadFonts();\n\n\t\trender.fixAlignment(\n\t\t\t'left',\n\t\t\tbaseX + TextBoxTextXOffset,\n\t\t\t0,\n\t\t\tbaseY + NameboxHeight + TextBoxTextYOffset,\n\t\t\tmaxLineWidth - TextBoxTextXOffset - TextBoxTextXOffset\n\t\t);\n\n\t\trender.render(rx.fsCtx);\n\t}\n}\n","import { HSLAColor } from '@/util/colors/hsl';\nimport { screenHeight } from './base';\nimport { ITextStyle } from '@/renderer/textRenderer/textRenderer';\n\n// tslint:disable: no-magic-numbers\nexport const nameboxTextOutlineDelta = new HSLAColor(\n\t-0.03065134099616873,\n\t-0.5714285714285714,\n\t-0.29607843137254896,\n\t0\n);\n\nexport const ChoiceButtonColor = '#ffe6f4';\nexport const ChoiceButtonBorderColor = '#ffbde1';\nexport const ChoiceButtonWidth = 420;\nexport const ChoiceSpacing = 22;\nexport const ChoiceX = 640;\nexport const ChoiceYOffset = 270;\nexport const ChoicePadding = 7;\n\nexport const ChoiceY = (screenHeight - ChoiceYOffset) / 2;\n\nexport const ChoiceTextStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tfontName: 'aller',\n\tfontSize: 24,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n};\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport { IChoices } from '@/store/objectTypes/choices';\nimport {\n\tChoiceTextStyle,\n\tChoiceButtonBorderColor,\n\tChoiceButtonColor,\n\tChoicePadding,\n\tChoiceSpacing,\n} from '@/constants/choices';\nimport { ScalingRenderable } from './scalingRenderable';\n\nexport class Choice extends ScalingRenderable<IChoices> {\n\tprivate _height: number = 0;\n\tpublic get height(): number {\n\t\treturn this._height;\n\t}\n\tprotected get centeredVertically(): boolean {\n\t\treturn true;\n\t}\n\n\tprivate choiceRenderers: TextRenderer[] = [];\n\n\tprotected async draw(rx: RenderContext): Promise<void> {\n\t\tawait this.updateChoiceBounds();\n\t\tconsole.log('rerender choice');\n\n\t\tconst w = this.obj.width;\n\t\tconst h = this.height;\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.flip ? screenWidth - this.obj.x : this.obj.x;\n\t\tconst x = baseX - w2;\n\t\tlet y = this.obj.y - h / 2;\n\n\t\tfor (const choiceRenderer of this.choiceRenderers) {\n\t\t\tawait choiceRenderer.loadFonts();\n\t\t\tconst height = choiceRenderer.getHeight(\n\t\t\t\tthis.obj.autoWrap ? this.obj.width : 0\n\t\t\t);\n\t\t\trx.drawRect({\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tw,\n\t\t\t\th: height + ChoicePadding * 2,\n\t\t\t\toutline: {\n\t\t\t\t\tstyle: ChoiceButtonBorderColor,\n\t\t\t\t\twidth: 3,\n\t\t\t\t},\n\t\t\t\tfill: {\n\t\t\t\t\tstyle: ChoiceButtonColor,\n\t\t\t\t},\n\t\t\t});\n\t\t\tchoiceRenderer.fixAlignment(\n\t\t\t\t'center',\n\t\t\t\tx,\n\t\t\t\tx + w,\n\t\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\t\ty + ChoiceSpacing * 1.25,\n\t\t\t\tthis.obj.autoWrap ? w : 0\n\t\t\t);\n\t\t\tchoiceRenderer.render(rx.fsCtx);\n\t\t\ty += height + ChoicePadding * 2 + ChoiceSpacing;\n\t\t}\n\t}\n\n\tprivate async updateChoiceBounds() {\n\t\tthis.choiceRenderers = this.obj.choices.map(\n\t\t\tchoice => new TextRenderer(choice.text || ' ', ChoiceTextStyle)\n\t\t);\n\n\t\tthis._height =\n\t\t\tthis.choiceRenderers.reduce(\n\t\t\t\t(acc, renderer) =>\n\t\t\t\t\tacc +\n\t\t\t\t\trenderer.getHeight(this.obj.autoWrap ? this.obj.width : 0) +\n\t\t\t\t\tChoicePadding * 2,\n\t\t\t\t0\n\t\t\t) +\n\t\t\tthis.obj.choiceDistance * (this.obj.choices.length - 1);\n\t}\n}\n","import { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { BaseTextStyle } from './textBox';\nimport { nameboxStrokeDefaultColor } from './textBoxCustom';\n\n// tslint:disable: no-magic-numbers\nexport const NotificationBackgroundColor = '#ffe6f4';\nexport const NotificationBorderColor = '#ffbde1';\nexport const NotificationBackdropColor = 'rgba(255,255,255,0.6)';\n// export const NotificationMaxWidth = 744;\nexport const NotificationPadding = 40;\nexport const NotificationSpacing = 30;\n\nexport const NotificationOkTextStyle: ITextStyle = {\n\t...BaseTextStyle,\n\tfontName: 'riffic',\n\tfontSize: 24,\n\tstrokeColor: nameboxStrokeDefaultColor,\n\tstrokeWidth: 8,\n\tletterSpacing: 1,\n\tcolor: 'white',\n};\n\nexport const NotificationTextStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tfontName: 'aller',\n\tfontSize: 24,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1.2,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n};\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport {\n\tChoiceButtonBorderColor,\n\tChoiceButtonColor,\n} from '@/constants/choices';\nimport { INotification } from '@/store/objectTypes/notification';\nimport {\n\tNotificationTextStyle,\n\tNotificationPadding,\n\tNotificationSpacing,\n\tNotificationOkTextStyle,\n\tNotificationBackdropColor,\n} from '@/constants/notification';\nimport { ScalingRenderable } from './scalingRenderable';\n\nexport class Notification extends ScalingRenderable<INotification> {\n\tprivate _height: number = 0;\n\tpublic get height(): number {\n\t\treturn this._height;\n\t}\n\tprivate _width: number = 0;\n\tpublic get width(): number {\n\t\treturn this._width;\n\t}\n\tprotected get centeredVertically(): boolean {\n\t\treturn true;\n\t}\n\n\tpublic get id() {\n\t\treturn this.obj.id;\n\t}\n\n\tpublic async render(selected: boolean, rx: RenderContext) {\n\t\tif (this.obj.backdrop) {\n\t\t\trx.drawRect({\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tw: screenWidth,\n\t\t\t\th: screenHeight,\n\t\t\t\tfill: {\n\t\t\t\t\tstyle: NotificationBackdropColor,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tawait super.render(selected, rx);\n\t}\n\n\tprotected async draw(rx: RenderContext): Promise<void> {\n\t\tconst textRenderer = new TextRenderer(this.obj.text, NotificationTextStyle);\n\t\tconst buttonRenderer = new TextRenderer('OK', NotificationOkTextStyle);\n\t\tawait textRenderer.loadFonts();\n\t\tawait buttonRenderer.loadFonts();\n\n\t\tconst lineWrap = this.obj.autoWrap\n\t\t\t? this.obj.width - NotificationPadding * 2\n\t\t\t: 0;\n\n\t\tconst textWidth = this.obj.autoWrap ? lineWrap : textRenderer.getWidth();\n\t\tconst textHeight = textRenderer.getHeight(lineWrap);\n\t\tconst buttonWidth = this.obj.autoWrap\n\t\t\t? lineWrap\n\t\t\t: buttonRenderer.getWidth();\n\t\tconst buttonHeight = buttonRenderer.getHeight(lineWrap);\n\n\t\tconst w = (this._width =\n\t\t\tMath.max(textWidth, buttonWidth) + NotificationPadding * 2);\n\t\tconst h = (this._height =\n\t\t\ttextHeight +\n\t\t\tNotificationPadding * 2 +\n\t\t\tNotificationSpacing +\n\t\t\tbuttonHeight);\n\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.flip ? screenWidth - this.obj.x : this.obj.x;\n\t\tconst x = baseX - w2;\n\t\tconst y = this.obj.y - h / 2;\n\n\t\trx.drawRect({\n\t\t\tx,\n\t\t\ty,\n\t\t\tw,\n\t\t\th,\n\t\t\toutline: {\n\t\t\t\tstyle: ChoiceButtonBorderColor,\n\t\t\t\twidth: 3,\n\t\t\t},\n\t\t\tfill: {\n\t\t\t\tstyle: ChoiceButtonColor,\n\t\t\t},\n\t\t});\n\t\ttextRenderer.fixAlignment(\n\t\t\t'center',\n\t\t\tx,\n\t\t\tx + w,\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\ty + NotificationPadding * 1.5,\n\t\t\tlineWrap\n\t\t);\n\t\ttextRenderer.render(rx.fsCtx);\n\t\tbuttonRenderer.fixAlignment(\n\t\t\t'center',\n\t\t\tx,\n\t\t\tx + w,\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\ty + h - NotificationPadding,\n\t\t\tlineWrap\n\t\t);\n\t\tbuttonRenderer.render(rx.fsCtx);\n\t}\n}\n","import { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth, screenHeight } from '@/constants/base';\n\n// tslint:disable: no-magic-numbers\nexport const poemBackgrounds = [\n\t{ name: 'Normal paper', file: 'poem.jpg' },\n\t{ name: 'Lightly soiled paper', file: 'poem_y1.jpg' },\n\t{ name: 'Heavily soiled paper', file: 'poem_y2.jpg' },\n\t{ name: 'Console', file: 'internal:console' },\n\t{ name: 'Transparent', file: 'internal:transparent' },\n];\nexport const defaultPoemBackground = 0;\nexport const defaultPoemStyle = 0;\nexport const defaultX = screenWidth / 2;\nexport const defaultY = screenHeight / 2;\nexport const poemTopPadding = 33;\nexport const poemBottomPadding = 100;\nexport const poemPadding = 30;\nexport const defaultPoemWidth = 800;\nexport const defaultPoemHeight = 720;\n\n//#region Console style\nexport const consoleBackgroundColor = 'rgba(51,51,51,0.75)';\nexport const consoleWidth = 480;\nexport const consoleHeight = 180;\nexport const defaultConsoleBackground = 3;\nexport const defaultConsoleStyle = 7;\n//#endregion Console style\n\nconst BasePoemStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1.2,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n\tfontName: 'aller',\n\tfontSize: 12,\n};\n\nexport interface IPoemTextStyle extends ITextStyle {\n\tname: string;\n}\n\nexport const poemTextStyles: IPoemTextStyle[] = [\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Sayori',\n\t\tfontName: 'hashtag',\n\t\tfontSize: 34,\n\t\tlineSpacing: 1.05,\n\t\tletterSpacing: 0,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Natsuki',\n\t\tfontName: 'ammy_handwriting',\n\t\tfontSize: 28,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Monika',\n\t\tfontName: 'journal',\n\t\tfontSize: 34,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Yuri',\n\t\tfontName: 'jp_hand_slanted',\n\t\tlineSpacing: 1.5,\n\t\tfontSize: 32,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Yuri Act 2',\n\t\tfontName: 'damagrafik_script',\n\t\tfontSize: 18,\n\t\tletterSpacing: -8,\n\t\t// justify: true,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Yuri Unused',\n\t\tfontName: 'as_i_lay_dying',\n\t\tfontSize: 40,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'MC',\n\t\tfontName: 'halogen',\n\t\tfontSize: 30,\n\t\tlineSpacing: 1.53,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Console',\n\t\tfontName: 'f25_bank_printer',\n\t\tfontSize: 18,\n\t\tcolor: 'white',\n\t\tlineSpacing: 1.1,\n\t},\n];\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport {\n\tpoemBackgrounds,\n\tpoemTextStyles,\n\tpoemTopPadding,\n\tpoemPadding,\n\tconsoleBackgroundColor,\n} from '@/constants/poem';\nimport { getAssetByUrl } from '@/asset-manager';\nimport { ScalingRenderable } from './scalingRenderable';\n\nconst consolePadding = -2;\nconst consoleTopPadding = 26;\nconst consoleLineWrapPadding = 10;\nconst poemTopMargin = 10;\n\nexport class Poem extends ScalingRenderable<IPoem> {\n\tprivate _height: number = 0;\n\tpublic get height(): number {\n\t\treturn this._height;\n\t}\n\n\tprivate _width: number = 0;\n\tpublic get width(): number {\n\t\treturn this._width;\n\t}\n\tprotected get centeredVertically(): boolean {\n\t\treturn true;\n\t}\n\n\tprotected async draw(rx: RenderContext): Promise<void> {\n\t\tconst paper = poemBackgrounds[this.obj.background];\n\t\tconst flippedX = this.flip ? screenWidth - this.obj.x : this.obj.x;\n\t\tlet y = this.obj.y;\n\t\tlet x = flippedX + poemTopMargin;\n\t\tlet padding = poemPadding;\n\t\tlet topPadding = poemTopPadding;\n\t\tlet lineWrapPadding = padding * 2;\n\n\t\tif (paper.file === 'internal:console') {\n\t\t\tconst h = (this._height = this.obj.height);\n\t\t\tconst w = (this._width = this.obj.width);\n\n\t\t\trx.drawRect({\n\t\t\t\tx: flippedX - w / 2,\n\t\t\t\ty: this.obj.y - h / 2,\n\t\t\t\th,\n\t\t\t\tw,\n\t\t\t\tfill: { style: consoleBackgroundColor },\n\t\t\t});\n\t\t\tpadding = consolePadding;\n\t\t\ttopPadding = consoleTopPadding;\n\t\t\tlineWrapPadding = consoleLineWrapPadding;\n\t\t} else if (paper.file === 'internal:transparent') {\n\t\t\tthis._height = this.obj.height;\n\t\t\tthis._width = this.obj.width;\n\t\t} else {\n\t\t\tconst asset = await getAssetByUrl(`assets/poemBackgrounds/${paper.file}`);\n\t\t\tif (asset instanceof HTMLImageElement) {\n\t\t\t\trx.drawImage({\n\t\t\t\t\timage: asset,\n\t\t\t\t\tx: flippedX - asset.width / 2,\n\t\t\t\t\ty: this.obj.y - asset.height / 2,\n\t\t\t\t});\n\t\t\t\tthis._height = asset.height;\n\t\t\t\tthis._width = asset.width;\n\t\t\t}\n\t\t}\n\t\ty -= this.height / 2;\n\t\tx -= this.width / 2;\n\n\t\tconst style = poemTextStyles[this.obj.font];\n\t\tconst render = new TextRenderer(this.obj.text, style);\n\t\tawait render.loadFonts();\n\n\t\trender.fixAlignment(\n\t\t\t'left',\n\t\t\tx + padding,\n\t\t\tx + padding,\n\t\t\ty + topPadding + padding,\n\t\t\tthis.obj.autoWrap ? this.width - lineWrapPadding : 0\n\t\t);\n\n\t\trender.render(rx.fsCtx);\n\t}\n}\n","import { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport { color, Background, IBackgroundRenderer } from './background';\nimport panels, { IPanel } from '@/store/panels';\nimport { DeepReadonly } from '@/util/readonly';\nimport { ISprite } from '@/store/objectTypes/sprite';\nimport { Sprite } from './sprite';\nimport { Character } from './character';\nimport { ICharacter, getData } from '@/store/objectTypes/characters';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { TextBox } from './textbox';\nimport { Choice } from './choices';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { getAsset } from '@/asset-manager';\nimport { Renderer } from '@/renderer/renderer';\nimport { BackgroundLookup } from '@/store/content';\nimport { IChoices } from '@/store/objectTypes/choices';\nimport { INotification } from '@/store/objectTypes/notification';\nimport { Notification } from '@/renderables/notification';\nimport { Poem } from './poem';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { IObject } from '@/store/objects';\nimport { OffscreenRenderable } from './offscreenRenderable';\n\nexport class SceneRenderer {\n\tprivate renderObjectCache = new Map<string, OffscreenRenderable<IObject>>();\n\tprivate lCurrentlyRendering = false;\n\tprivate renderer: Renderer;\n\n\tpublic constructor(\n\t\tprivate store: Store<DeepReadonly<IRootState>>,\n\t\tprivate panelId: string,\n\t\treadonly canvasWidth: number,\n\t\treadonly canvasHeight: number\n\t) {\n\t\tthis.renderer = new Renderer(canvasWidth, canvasHeight);\n\t}\n\n\tpublic render(hq: boolean, preview: boolean): Promise<boolean> {\n\t\tif (!this.panel) return Promise.resolve(false);\n\t\treturn this.renderer.render(this.renderCallback.bind(this), hq, preview);\n\t}\n\n\tpublic download(): Promise<string> {\n\t\tconst date = new Date();\n\t\tconst filename = `panel-${[\n\t\t\tdate.getFullYear(),\n\t\t\t`${date.getMonth() + 1}`.padStart(2, '0'),\n\t\t\t`${date.getDate()}`.padStart(2, '0'),\n\t\t\t`${date.getHours()}`.padStart(2, '0'),\n\t\t\t`${date.getMinutes()}`.padStart(2, '0'),\n\t\t\t`${date.getSeconds()}`.padStart(2, '0'),\n\t\t].join('-')}.png`;\n\t\treturn this.renderer.download(this.renderCallback.bind(this), filename);\n\t}\n\n\tpublic get currentlyRendering() {\n\t\treturn this.lCurrentlyRendering;\n\t}\n\n\tpublic paintOnto(\n\t\tc: CanvasRenderingContext2D,\n\t\topts: { x: number; y: number; w?: number; h?: number }\n\t) {\n\t\tthis.renderer.paintOnto(c, opts);\n\t}\n\n\tpublic objectsAt(x: number, y: number): string[] {\n\t\treturn this.getRenderObjects()\n\t\t\t.filter(renderObject => renderObject.hitTest(x, y))\n\t\t\t.map(renderObject => ((renderObject as unknown) as { id: string }).id);\n\t}\n\n\tprivate async renderCallback(rx: RenderContext): Promise<void> {\n\t\tthis.lCurrentlyRendering = true;\n\t\ttry {\n\t\t\trx.fsCtx.imageSmoothingEnabled = true;\n\t\t\trx.fsCtx.imageSmoothingQuality = rx.hq ? 'high' : 'low';\n\n\t\t\tawait this.getBackgroundRenderer()?.render(rx);\n\n\t\t\tconst selection = this.store.state.ui.selection;\n\t\t\tfor (const object of this.getRenderObjects()) {\n\t\t\t\tlet selected = false;\n\t\t\t\tif (object instanceof OffscreenRenderable) {\n\t\t\t\t\tobject.updatedContent(this.store, this.panelId);\n\t\t\t\t\tselected = selection === object.id;\n\t\t\t\t}\n\t\t\t\tawait object.render(selected, rx);\n\t\t\t}\n\t\t\trx.applyFilters([...this.panel.filters]);\n\t\t\tif (rx.preview) {\n\t\t\t\trx.drawImage({\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tcomposite: 'destination-over',\n\t\t\t\t\timage: await getAsset('backgrounds/transparent'),\n\t\t\t\t});\n\t\t\t}\n\t\t} finally {\n\t\t\tthis.lCurrentlyRendering = false;\n\t\t}\n\t}\n\n\tprivate getRenderObjects() {\n\t\tconst objectsState = this.store.state.objects.panels[this.panelId];\n\t\tconst order = objectsState\n\t\t\t? [...objectsState.order, ...objectsState.onTopOrder]\n\t\t\t: [];\n\t\tconst objects = this.store.state.objects.objects;\n\t\tconst toUncache = Object.keys(this.renderObjectCache).filter(\n\t\t\tid => !order.includes(id)\n\t\t);\n\n\t\tfor (const id of toUncache) {\n\t\t\tthis.renderObjectCache.delete(id);\n\t\t}\n\n\t\treturn order.map(id => {\n\t\t\tlet renderObject = this.renderObjectCache.get(id);\n\t\t\tif (!renderObject) {\n\t\t\t\tconst obj = objects[id];\n\t\t\t\tswitch (obj.type) {\n\t\t\t\t\tcase 'sprite':\n\t\t\t\t\t\trenderObject = new Sprite(obj as DeepReadonly<ISprite>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'character':\n\t\t\t\t\t\tconst char = obj as DeepReadonly<ICharacter>;\n\t\t\t\t\t\trenderObject = new Character(char, getData(this.store, char));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'textBox':\n\t\t\t\t\t\trenderObject = new TextBox(obj as DeepReadonly<ITextBox>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'choice':\n\t\t\t\t\t\trenderObject = new Choice(obj as DeepReadonly<IChoices>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'notification':\n\t\t\t\t\t\trenderObject = new Notification(obj as DeepReadonly<INotification>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'poem':\n\t\t\t\t\t\trenderObject = new Poem(obj as DeepReadonly<IPoem>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tthis.renderObjectCache.set(id, renderObject);\n\t\t\t}\n\t\t\treturn renderObject;\n\t\t});\n\t}\n\n\tprivate get panel(): DeepReadonly<IPanel> {\n\t\treturn this.store.state.panels.panels[this.panelId];\n\t}\n\n\tprivate getBackgroundRenderer(): IBackgroundRenderer | null {\n\t\tconst panel = this.panel;\n\t\tswitch (panel.background.current) {\n\t\t\tcase 'buildin.static-color':\n\t\t\t\tcolor.color = panel.background.color;\n\t\t\t\treturn color;\n\t\t\tdefault:\n\t\t\t\tconst lookup = this.store.getters[\n\t\t\t\t\t'content/getBackgrounds'\n\t\t\t\t] as BackgroundLookup;\n\t\t\t\tconst current = lookup.get(panel.background.current);\n\t\t\t\tif (!current) return null;\n\t\t\t\tconst variant = current.variants[panel.background.variant];\n\t\t\t\tif (!variant) return null;\n\t\t\t\treturn new Background(\n\t\t\t\t\tpanel.background.current,\n\t\t\t\t\tvariant,\n\t\t\t\t\tpanel.background.flipped,\n\t\t\t\t\tpanel.background.scaling,\n\t\t\t\t\tpanel.background.composite,\n\t\t\t\t\tpanel.background.filters\n\t\t\t\t);\n\t\t}\n\t}\n}\n","\nimport { PanelMixin } from './panelMixin';\nimport {\n\tIDuplicatePanelAction,\n\tISetCurrentPanelMutation,\n\tIDeletePanelAction,\n\tISetPanelPreviewMutation,\n\tIMovePanelAction,\n} from '@/store/panels';\nimport { isWebPSupported, isHeifSupported } from '@/asset-manager';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { SceneRenderer } from '@/renderables/scene-renderer';\nimport { DeepReadonly } from '@/util/readonly';\nimport environment from '@/environments/environment';\nimport eventBus, { ShowMessageEvent } from '@/eventbus/event-bus';\nimport { screenWidth, screenHeight } from '@/constants/base';\nimport { IObject } from '@/store/objects';\nimport { INotification } from '@/store/objectTypes/notification';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { IChoices } from '@/store/objectTypes/choices';\nimport { defineComponent } from 'vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DButton from '@/components/ui/d-button.vue';\nimport ImageOptions from '../subtools/image-options/image-options.vue';\n\ninterface IPanelButton {\n\tid: string;\n\timage: string;\n\ttext: string;\n}\n\n// tslint:disable: no-magic-numbers\nconst estimateFactor = 1.5;\nconst thumbnailFactor = 1 / 4;\nconst thumbnailQuality = 0.5;\nconst qualityFactor = 100;\n\nconst defaultQuality = 90;\n\nconst qualityWarningThreshold = 70;\n// tslint:enable: no-magic-numbers\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DFieldset, DFlow, DButton, ImageOptions },\n\tdata: () => ({\n\t\twebpSupport: false,\n\t\theifSupport: false,\n\t\tppi: 0,\n\t\tpages: '',\n\t\tformat: 'image/png',\n\t\tquality: defaultQuality,\n\t\timageOptions: false,\n\t}),\n\tcomputed: {\n\t\tcurrentPanel(): string {\n\t\t\treturn this.$store.state.panels.currentPanel;\n\t\t},\n\n\t\tisLossy(): boolean {\n\t\t\treturn this.format !== 'image/png';\n\t\t},\n\n\t\tcanDeletePanel(): boolean {\n\t\t\treturn this.panelButtons.length > 1;\n\t\t},\n\n\t\tpanelButtons(): IPanelButton[] {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\treturn panelOrder.map(id => {\n\t\t\t\tconst panel = this.$store.state.panels.panels[id];\n\t\t\t\tconst objectOrders = this.$store.state.objects.panels[id];\n\t\t\t\tconst txtBox = objectOrders\n\t\t\t\t\t? ([] as string[])\n\t\t\t\t\t\t\t.concat(objectOrders.order, objectOrders.onTopOrder)\n\t\t\t\t\t\t\t.map(objId => this.$store.state.objects.objects[objId])\n\t\t\t\t\t\t\t.map(this.extractObjectText)\n\t\t\t\t\t: [];\n\t\t\t\treturn {\n\t\t\t\t\tid,\n\t\t\t\t\timage: panel.lastRender,\n\t\t\t\t\ttext: txtBox.reduce(\n\t\t\t\t\t\t(acc, current) => (acc.length > current.length ? acc : current),\n\t\t\t\t\t\t''\n\t\t\t\t\t),\n\t\t\t\t} as IPanelButton;\n\t\t\t});\n\t\t},\n\n\t\tcanMoveAhead(): boolean {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\tconst idx = panelOrder.indexOf(this.currentPanel);\n\t\t\treturn idx > 0;\n\t\t},\n\n\t\tcanMoveBehind(): boolean {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\tconst idx = panelOrder.indexOf(this.currentPanel);\n\t\t\treturn idx < panelOrder.length - 1;\n\t\t},\n\t},\n\tasync created() {\n\t\t[this.webpSupport, this.heifSupport] = await Promise.all([\n\t\t\tisWebPSupported(),\n\t\t\tisHeifSupported(),\n\t\t]);\n\t},\n\tasync mounted() {\n\t\tthis.moveFocusToActivePanel();\n\t\tthis.renderThumbnail();\n\t},\n\tmethods: {\n\t\tasync download() {\n\t\t\tconst distribution = this.getPanelDistibution();\n\t\t\tconst date = new Date();\n\t\t\tconst prefix = `cd-${[\n\t\t\t\tdate.getFullYear(),\n\t\t\t\t`${date.getMonth() + 1}`.padStart(2, '0'),\n\t\t\t\t`${date.getDate()}`.padStart(2, '0'),\n\t\t\t\t`${date.getHours()}`.padStart(2, '0'),\n\t\t\t\t`${date.getMinutes()}`.padStart(2, '0'),\n\t\t\t\t`${date.getSeconds()}`.padStart(2, '0'),\n\t\t\t].join('-')}`;\n\t\t\tconst extension = this.format.split('/')[1];\n\t\t\tconst format = this.format;\n\t\t\tconst quality = this.quality;\n\t\t\tawait this.renderObjects(\n\t\t\t\tdistribution,\n\t\t\t\ttrue,\n\t\t\t\tasync (imageIdx: number, canvas: HTMLCanvasElement) => {\n\t\t\t\t\tenvironment.saveToFile(\n\t\t\t\t\t\tcanvas,\n\t\t\t\t\t\t`${prefix}_${imageIdx}.${extension}`,\n\t\t\t\t\t\tformat,\n\t\t\t\t\t\tquality / qualityFactor\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tasync estimateExportSize() {\n\t\t\tconst distribution = this.getPanelDistibution();\n\t\t\tconst format = this.format || 'image/png';\n\t\t\tconst quality = this.quality || defaultQuality;\n\t\t\tconst sizes = await this.renderObjects(\n\t\t\t\tdistribution,\n\t\t\t\tfalse,\n\t\t\t\tasync (imageIdx: number, canvas: HTMLCanvasElement) => {\n\t\t\t\t\treturn new Promise<number>((resolve, reject) => {\n\t\t\t\t\t\tcanvas.toBlob(\n\t\t\t\t\t\t\tblob => {\n\t\t\t\t\t\t\t\tif (!blob) {\n\t\t\t\t\t\t\t\t\treject(`Image ${imageIdx + 1} could not be rendered.`);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresolve(blob.size);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tformat,\n\t\t\t\t\t\t\tquality / qualityFactor\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t\tconst readableSizes = sizes.map(\n\t\t\t\tsize => ((size * estimateFactor) / 1024 / 1024).toFixed(2) + 'MiB'\n\t\t\t);\n\t\t\tconst filePluralize = readableSizes.length > 1 ? 'files' : 'file';\n\t\t\tconst itPluralize = readableSizes.length > 1 ? 'These' : 'It';\n\t\t\tconst sizePluralize = readableSizes.length > 1 ? 'sizes' : 'size';\n\t\t\teventBus.fire(\n\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t`This would export ${\n\t\t\t\t\t\treadableSizes.length\n\t\t\t\t\t} ${filePluralize}. ${itPluralize} would have the following (aproximate) ${sizePluralize}: ${readableSizes.join(\n\t\t\t\t\t\t','\n\t\t\t\t\t)}`\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\tasync renderObjects<T>(\n\t\t\tdistribution: DeepReadonly<string[][]>,\n\t\t\thq: boolean,\n\t\t\tmapper: (imageIdx: number, canvas: HTMLCanvasElement) => Promise<T>\n\t\t): Promise<T[]> {\n\t\t\treturn await Promise.all(\n\t\t\t\tdistribution.map(async (image, imageIdx) => {\n\t\t\t\t\tconst targetCanvas = document.createElement('canvas');\n\t\t\t\t\ttargetCanvas.width = screenWidth;\n\t\t\t\t\ttargetCanvas.height = screenHeight * image.length;\n\t\t\t\t\tconst context = targetCanvas.getContext('2d')!;\n\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\timage.map(async (panelId, panelIdx) => {\n\t\t\t\t\t\t\tconst sceneRenderer = new SceneRenderer(\n\t\t\t\t\t\t\t\tthis.$store,\n\t\t\t\t\t\t\t\timage[panelIdx],\n\t\t\t\t\t\t\t\tscreenWidth,\n\t\t\t\t\t\t\t\tscreenHeight\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tawait sceneRenderer.render(hq, false);\n\n\t\t\t\t\t\t\tsceneRenderer.paintOnto(context, {\n\t\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\t\ty: screenHeight * panelIdx,\n\t\t\t\t\t\t\t\tw: screenWidth,\n\t\t\t\t\t\t\t\th: screenHeight,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t\treturn await mapper(imageIdx, targetCanvas);\n\t\t\t\t})\n\t\t\t);\n\t\t},\n\t\tgetLimitedPanelList(): DeepReadonly<string[]> {\n\t\t\tconst max = this.$store.state.panels.panelOrder.length - 1;\n\t\t\tconst min = 0;\n\t\t\tconst parts = this.pages.split(',');\n\t\t\tconst listedPages: number[] = [];\n\t\t\tlet foundMatch = false;\n\n\t\t\tfor (const part of parts) {\n\t\t\t\tconst trimmedPart = part.trim();\n\t\t\t\tconst match = trimmedPart.match(/^\\s*((\\d+)|(\\d+)\\s*-\\s*(\\d+))\\s*$/);\n\t\t\t\tif (!match) {\n\t\t\t\t\tif (trimmedPart !== '') {\n\t\t\t\t\t\teventBus.fire(\n\t\t\t\t\t\t\tnew ShowMessageEvent(`Could not read '${part}' in the page list.`)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfoundMatch = true;\n\t\t\t\tif (match[2]) listedPages.push(parseInt(match[2], 10) - 1);\n\t\t\t\telse {\n\t\t\t\t\tconst from = Math.max(parseInt(match[3], 10) - 1, min);\n\t\t\t\t\tconst to = Math.min(parseInt(match[4], 10) - 1, max);\n\t\t\t\t\tif (from === undefined || to === undefined || from > to) continue;\n\t\t\t\t\tfor (let i = from; i <= to; ++i) {\n\t\t\t\t\t\tlistedPages.push(i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!foundMatch) {\n\t\t\t\treturn this.$store.state.panels.panelOrder;\n\t\t\t}\n\n\t\t\treturn listedPages\n\t\t\t\t.sort((a, b) => a - b)\n\t\t\t\t.filter((value, idx, ary) => ary[idx - 1] !== value)\n\t\t\t\t.map(pageIdx => this.$store.state.panels.panelOrder[pageIdx]);\n\t\t},\n\t\tgetPanelDistibution(): DeepReadonly<string[][]> {\n\t\t\tconst panelOrder = this.getLimitedPanelList();\n\t\t\tif (this.ppi === 0) return [panelOrder];\n\t\t\tconst images: string[][] = [];\n\t\t\tfor (let imageI = 0; imageI < panelOrder.length / this.ppi; ++imageI) {\n\t\t\t\tconst sliceStart = imageI * this.ppi;\n\t\t\t\tconst sliceEnd = sliceStart + this.ppi;\n\t\t\t\timages.push([...panelOrder.slice(sliceStart, sliceEnd)]);\n\t\t\t}\n\t\t\treturn images;\n\t\t},\n\t\tmoveFocusToActivePanel() {\n\t\t\tconst active = this.$el.querySelector('.panel_button.active');\n\t\t\tif (active) {\n\t\t\t\tthis.scrollIntoView(active);\n\t\t\t}\n\t\t},\n\t\tscrollIntoView(ele: Element) {\n\t\t\tconst parent = ele.parentElement!.parentElement!;\n\t\t\tconst idx = Array.from(ele.parentElement!.children).indexOf(ele);\n\t\t\tif (this.$store.state.ui.vertical) {\n\t\t\t\tconst scroll =\n\t\t\t\t\tidx * ele.clientHeight -\n\t\t\t\t\tparent.clientHeight / 2 +\n\t\t\t\t\tele.clientHeight / 2;\n\t\t\t\tparent.scrollTop = scroll;\n\t\t\t\tparent.scrollLeft = 0;\n\t\t\t} else {\n\t\t\t\tconst scroll =\n\t\t\t\t\tidx * ele.clientWidth - parent.clientWidth / 2 + ele.clientWidth / 2;\n\t\t\t\tparent.scrollLeft = scroll;\n\t\t\t\tparent.scrollTop = 0;\n\t\t\t}\n\t\t},\n\t\textractObjectText(obj: DeepReadonly<IObject>) {\n\t\t\tswitch (obj.type) {\n\t\t\t\tcase 'textBox':\n\t\t\t\t\treturn (obj as ITextBox).text;\n\t\t\t\tcase 'notification':\n\t\t\t\t\treturn (obj as INotification).text;\n\t\t\t\tcase 'poem':\n\t\t\t\t\treturn (obj as IPoem).text;\n\t\t\t\tcase 'choice':\n\t\t\t\t\treturn (obj as IChoices).choices\n\t\t\t\t\t\t.map(choice => `[${choice.text}]`)\n\t\t\t\t\t\t.join('\\n');\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\tasync addNewPanel() {\n\t\t\tawait this.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('panels/duplicatePanel', {\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as IDuplicatePanelAction);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tupdateCurrentPanel(panelId: string) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.commit('panels/setCurrentPanel', {\n\t\t\t\t\tpanelId,\n\t\t\t\t} as ISetCurrentPanelMutation);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tdeletePanel() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('panels/delete', {\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as IDeletePanelAction);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tmoveAhead() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/move', {\n\t\t\t\t\tpanelId: this.currentPanel,\n\t\t\t\t\tdelta: -1,\n\t\t\t\t} as IMovePanelAction);\n\t\t\t});\n\t\t},\n\t\tmoveBehind() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/move', {\n\t\t\t\t\tpanelId: this.currentPanel,\n\t\t\t\t\tdelta: 1,\n\t\t\t\t} as IMovePanelAction);\n\t\t\t});\n\t\t},\n\t\tasync renderThumbnail() {\n\t\t\tconst sceneRenderer = new SceneRenderer(\n\t\t\t\tthis.$store,\n\t\t\t\tthis.currentPanel,\n\t\t\t\tscreenWidth,\n\t\t\t\tscreenHeight\n\t\t\t);\n\n\t\t\tawait sceneRenderer.render(false, true);\n\n\t\t\tconst targetCanvas = document.createElement('canvas');\n\t\t\ttargetCanvas.width = screenWidth * thumbnailFactor;\n\t\t\ttargetCanvas.height = screenHeight * thumbnailFactor;\n\n\t\t\tsceneRenderer.paintOnto(targetCanvas.getContext('2d')!, {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tw: targetCanvas.width,\n\t\t\t\th: targetCanvas.height,\n\t\t\t});\n\t\t\ttargetCanvas.toBlob(\n\t\t\t\tblob => {\n\t\t\t\t\tif (!blob) return;\n\t\t\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\t\tthis.$store.commit('panels/setPanelPreview', {\n\t\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t} as ISetPanelPreviewMutation);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t(await isWebPSupported()) ? 'image/webp' : 'image/jpeg',\n\t\t\t\tthumbnailQuality\n\t\t\t);\n\t\t},\n\t},\n\twatch: {\n\t\tquality(quality: number, oldQuality: number) {\n\t\t\tif (quality === qualityFactor) {\n\t\t\t\teventBus.fire(\n\t\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t\t'Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression.'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (\n\t\t\t\toldQuality > qualityWarningThreshold &&\n\t\t\t\tquality <= qualityWarningThreshold\n\t\t\t) {\n\t\t\t\teventBus.fire(\n\t\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t\t'Note: A quality level below 70% might be very noticable and impair legibility of text.'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t},\n\t},\n});\n","import { render } from \"./panels.vue?vue&type=template&id=2ffec108&scoped=true\"\nimport script from \"./panels.vue?vue&type=script&lang=ts\"\nexport * from \"./panels.vue?vue&type=script&lang=ts\"\n\nimport \"./panels.vue?vue&type=style&index=0&id=2ffec108&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-2ffec108\"\n\nexport default script","<template>\n\t<object-tool :object=\"object\" title=\"Notification\" :textHandler=\"textHandler\">\n\t\t<template v-slot:default>\n\t\t\t<div id=\"notification_text\">\n\t\t\t\t<label for=\"notification_text\">Text:</label>\n\t\t\t\t<textarea v-model=\"text\" id=\"notification_text\" @keydown.stop />\n\t\t\t\t<button @click=\"textEditor = true\">Formatting</button>\n\t\t\t</div>\n\t\t</template>\n\t\t<template v-slot:options>\n\t\t\t<toggle v-model=\"renderBackdrop\" label=\"Show backdrop?\" />\n\t\t</template>\n\t</object-tool>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport ObjectTool, { Handler } from './object-tool.vue';\nimport { PanelMixin } from './panelMixin';\nimport { INotification } from '../../../store/objectTypes/notification';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<INotification>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): INotification {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'notification') return undefined!;\n\t\t\treturn obj as INotification;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: 'Text',\n\t\t\t\tget: () => {\n\t\t\t\t\treturn this.text;\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tthis.text = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = false;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttext: setable('text', 'objects/setNotificationText'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\trenderBackdrop: setable('backdrop', 'objects/setNotificationBackdrop'),\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.current_button {\n\tinput {\n\t\twidth: 145px;\n\t}\n}\n\n.panel {\n\t&.vertical {\n\t\t#notification_text {\n\t\t\twidth: 173px;\n\n\t\t\ttextarea {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\tfieldset.buttons {\n\t\t\twidth: 100%;\n\t\t}\n\t}\n\n\ttextarea {\n\t\tdisplay: block;\n\t\theight: 114px;\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport ObjectTool, { Handler } from './object-tool.vue';\nimport { PanelMixin } from './panelMixin';\nimport { INotification } from '../../../store/objectTypes/notification';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<INotification>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): INotification {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'notification') return undefined!;\n\t\t\treturn obj as INotification;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: 'Text',\n\t\t\t\tget: () => {\n\t\t\t\t\treturn this.text;\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tthis.text = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = false;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttext: setable('text', 'objects/setNotificationText'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\trenderBackdrop: setable('backdrop', 'objects/setNotificationBackdrop'),\n\t},\n});\n","import { render } from \"./notification.vue?vue&type=template&id=618f75f2&scoped=true\"\nimport script from \"./notification.vue?vue&type=script&lang=ts\"\nexport * from \"./notification.vue?vue&type=script&lang=ts\"\n\nimport \"./notification.vue?vue&type=style&index=0&id=618f75f2&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-618f75f2\"\n\nexport default script","<template>\n\t<object-tool\n\t\t:object=\"object\"\n\t\t:title=\"object.subType === 'poem' ? 'Poem' : 'Console'\"\n\t\t:textHandler=\"textHandler\"\n\t>\n\t\t<div id=\"poem_text\">\n\t\t\t<label for=\"poem_text\">Text:</label>\n\t\t\t<textarea v-model=\"text\" @keydown.stop />\n\t\t\t<button @click=\"textEditor = true\">Formatting</button>\n\t\t</div>\n\t\t<toggle label=\"Auto line wrap?\" v-model=\"autoWrap\" />\n\t\t<template v-if=\"object.subType === 'poem'\">\n\t\t\t<select v-model=\"poemBackground\" @keydown.stop>\n\t\t\t\t<option\n\t\t\t\t\tv-for=\"(background, idx) of backgrounds\"\n\t\t\t\t\t:value=\"idx\"\n\t\t\t\t\t:key=\"idx\"\n\t\t\t\t\t>{{ background.name }}</option\n\t\t\t\t>\n\t\t\t</select>\n\t\t\t<select v-model=\"poemStyle\" @keydown.stop>\n\t\t\t\t<option\n\t\t\t\t\tv-for=\"(style, idx) of poemTextStyles\"\n\t\t\t\t\t:value=\"idx\"\n\t\t\t\t\t:key=\"idx\"\n\t\t\t\t\t>{{ style.name }}</option\n\t\t\t\t>\n\t\t\t</select>\n\t\t</template>\n\t</object-tool>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport {\n\tpoemBackgrounds,\n\tpoemTextStyles,\n\tIPoemTextStyle,\n} from '@/constants/poem';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool, { Handler } from './object-tool.vue';\n\nconst setable = genericSetable<IPoem>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tbackgrounds(): Array<{ name: string; file: string }> {\n\t\t\treturn poemBackgrounds;\n\t\t},\n\t\tpoemTextStyles(): IPoemTextStyle[] {\n\t\t\treturn poemTextStyles;\n\t\t},\n\t\tobject(): IPoem {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'poem') return undefined!;\n\t\t\treturn obj as IPoem;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: 'Text',\n\t\t\t\tget: () => {\n\t\t\t\t\treturn this.text;\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tthis.text = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = false;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttext: setable('text', 'objects/setPoemText'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\tpoemStyle: setable('font', 'objects/setPoemFont'),\n\t\tpoemBackground: setable('background', 'objects/setPoemBackground'),\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.panel {\n\t&.vertical {\n\t\t#poem_text {\n\t\t\twidth: 173px;\n\n\t\t\ttextarea {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\tfieldset.buttons {\n\t\t\twidth: 100%;\n\t\t}\n\t}\n\t&:not(.vertical) {\n\t\ttextarea {\n\t\t\tdisplay: block;\n\t\t\theight: 114px;\n\t\t}\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport {\n\tpoemBackgrounds,\n\tpoemTextStyles,\n\tIPoemTextStyle,\n} from '@/constants/poem';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool, { Handler } from './object-tool.vue';\n\nconst setable = genericSetable<IPoem>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tbackgrounds(): Array<{ name: string; file: string }> {\n\t\t\treturn poemBackgrounds;\n\t\t},\n\t\tpoemTextStyles(): IPoemTextStyle[] {\n\t\t\treturn poemTextStyles;\n\t\t},\n\t\tobject(): IPoem {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'poem') return undefined!;\n\t\t\treturn obj as IPoem;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: 'Text',\n\t\t\t\tget: () => {\n\t\t\t\t\treturn this.text;\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tthis.text = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = false;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttext: setable('text', 'objects/setPoemText'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\tpoemStyle: setable('font', 'objects/setPoemFont'),\n\t\tpoemBackground: setable('background', 'objects/setPoemBackground'),\n\t},\n});\n","import { render } from \"./poem.vue?vue&type=template&id=2a8686c0&scoped=true\"\nimport script from \"./poem.vue?vue&type=script&lang=ts\"\nexport * from \"./poem.vue?vue&type=script&lang=ts\"\n\nimport \"./poem.vue?vue&type=style&index=0&id=2a8686c0&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-2a8686c0\"\n\nexport default script","\nimport SettingsPanel from './tools/settings.vue';\nimport AddPanel from './tools/add.vue';\nimport CharacterPanel from './tools/character.vue';\nimport SpritePanel from './tools/sprite.vue';\nimport TextBoxPanel from './tools/textbox.vue';\nimport ChoicePanel from './tools/choice.vue';\nimport CreditsPanel from './tools/credits.vue';\nimport BackgroundsPanel from './tools/backgrounds.vue';\nimport ContentPacksPanel from './tools/content-pack.vue';\nimport PanelsPanel from './tools/panels.vue';\nimport NotificationPanel from './tools/notification.vue';\nimport PoemPanel from './tools/poem.vue';\nimport { IObject, ObjectTypes } from '@/store/objects';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\ntype PanelNames =\n\t| 'add'\n\t| 'backgrounds'\n\t| 'help_credits'\n\t| 'selection'\n\t| 'packs'\n\t| 'settings'\n\t| 'panels'\n\t| 'notification'\n\t| 'poem';\n\nexport default defineComponent({\n\tcomponents: {\n\t\tSettingsPanel,\n\t\tAddPanel,\n\t\tBackgroundsPanel,\n\t\tCreditsPanel,\n\t\tCharacterPanel,\n\t\tTextBoxPanel,\n\t\tChoicePanel,\n\t\tSpritePanel,\n\t\tContentPacksPanel,\n\t\tPanelsPanel,\n\t\tNotificationPanel,\n\t\tPoemPanel,\n\t},\n\tdata: () => ({\n\t\tpanelSelection: 'add' as PanelNames,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tselection(): string | null {\n\t\t\treturn this.$store.state.ui.selection;\n\t\t},\n\t\tpanel(): PanelNames | ObjectTypes {\n\t\t\tif (this.panelSelection === 'selection') {\n\t\t\t\tif (this.selection === null) {\n\t\t\t\t\t// eslint-disable-next-line vue/no-side-effects-in-computed-properties\n\t\t\t\t\tthis.panelSelection = 'add';\n\t\t\t\t} else {\n\t\t\t\t\tconst obj = this.$store.state.objects.objects[this.selection];\n\t\t\t\t\treturn obj.type;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this.panelSelection;\n\t\t},\n\t\thasPrevRender(): boolean {\n\t\t\treturn this.$store.state.ui.lastDownload !== null;\n\t\t},\n\t},\n\tmethods: {\n\t\tcreate() {\n\t\t\tenvironment.onPanelChange((panel: string) => {\n\t\t\t\tthis.panelSelection = panel as PanelNames;\n\t\t\t});\n\t\t},\n\t\tsetPanel(name: PanelNames) {\n\t\t\tif (name === this.panelSelection) name = 'add';\n\t\t\tthis.panelSelection = name;\n\t\t\tif (this.selection) {\n\t\t\t\tif (this.$store.state.ui.selection === null) return;\n\t\t\t\tthis.$store.commit('ui/setSelection', null);\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tselection(newSelection: IObject | null) {\n\t\t\tif (newSelection) {\n\t\t\t\tthis.panelSelection = 'selection';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.panelSelection === 'selection') {\n\t\t\t\tthis.panelSelection = 'add';\n\t\t\t}\n\t\t},\n\t},\n});\n","import { render } from \"./toolbox.vue?vue&type=template&id=111e9686\"\nimport script from \"./toolbox.vue?vue&type=script&lang=ts\"\nexport * from \"./toolbox.vue?vue&type=script&lang=ts\"\n\nimport \"./toolbox.vue?vue&type=style&index=0&id=111e9686&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n\t<div id=\"messageConsole\" :class=\"{ vertical }\">\n\t\t<p v-if=\"showLoading\">Loading...</p>\n\t\t<p v-for=\"(message, i) in messages\" :key=\"message + '_' + i\">\n\t\t\t{{ message }}\n\t\t</p>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport EventBus, {\n\tAssetFailureEvent,\n\tCustomAssetFailureEvent,\n\tShowMessageEvent,\n\tVueErrorEvent,\n} from '@/eventbus/event-bus';\nimport { defineComponent } from 'vue';\n\nconst shortHidingTime = 5000;\nconst longHidingTime = 20000;\nconst hideShowTimeouts = 100;\n\nexport default defineComponent({\n\tprops: {\n\t\tloading: {\n\t\t\tdefault: false,\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tmessages: [] as string[],\n\t\tshowLoading: false,\n\t\tshowLoadingTimeout: 0,\n\t\thideLoadingTimeout: 0,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.onLoadingChange(this.loading);\n\t\tEventBus.subscribe(AssetFailureEvent, ev => {\n\t\t\tthis.messages.push(`Failed to load asset '${ev.path}'`);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, shortHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(CustomAssetFailureEvent, ev => {\n\t\t\tthis.messages.push(\n\t\t\t\t'Failed to load custom asset. Try to download it manually and then upload it.'\n\t\t\t);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(ShowMessageEvent, ev => {\n\t\t\tthis.messages.push(ev.message);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(VueErrorEvent, ev => {\n\t\t\tthis.messages.push(ev.error.name);\n\t\t\tthis.messages.push(JSON.stringify(ev.error.stack));\n\t\t\tthis.messages.push(ev.info);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t\tthis.messages.shift();\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\t},\n\n\tmethods: {\n\t\tonLoadingChange(newValue: boolean) {\n\t\t\tif (newValue) {\n\t\t\t\tif (this.hideLoadingTimeout) {\n\t\t\t\t\tclearTimeout(this.hideLoadingTimeout);\n\t\t\t\t\tthis.hideLoadingTimeout = 0;\n\t\t\t\t}\n\t\t\t\tif (!this.showLoading && !this.showLoadingTimeout) {\n\t\t\t\t\tthis.showLoadingTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.showLoading = true;\n\t\t\t\t\t\tthis.showLoadingTimeout = 0;\n\t\t\t\t\t}, hideShowTimeouts);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.showLoadingTimeout) {\n\t\t\t\t\tclearTimeout(this.showLoadingTimeout);\n\t\t\t\t\tthis.showLoadingTimeout = 0;\n\t\t\t\t}\n\t\t\t\tif (this.showLoading && !this.hideLoadingTimeout) {\n\t\t\t\t\tthis.hideLoadingTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.showLoading = false;\n\t\t\t\t\t\tthis.hideLoadingTimeout = 0;\n\t\t\t\t\t}, hideShowTimeouts);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\n\twatch: {\n\t\tloading(newValue: boolean) {\n\t\t\tthis.onLoadingChange(newValue);\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n#messageConsole {\n\tfont-family: monospace;\n\ttext-shadow: 0px 0px 4px #ffffff;\n\tposition: absolute;\n\n\t&.vertical {\n\t\tright: 200px;\n\t\ttop: 0;\n\t}\n\n\t&:not(.vertical) {\n\t\tbottom: 200px;\n\t\tleft: 0;\n\t}\n}\n</style>\n","\nimport EventBus, {\n\tAssetFailureEvent,\n\tCustomAssetFailureEvent,\n\tShowMessageEvent,\n\tVueErrorEvent,\n} from '@/eventbus/event-bus';\nimport { defineComponent } from 'vue';\n\nconst shortHidingTime = 5000;\nconst longHidingTime = 20000;\nconst hideShowTimeouts = 100;\n\nexport default defineComponent({\n\tprops: {\n\t\tloading: {\n\t\t\tdefault: false,\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tmessages: [] as string[],\n\t\tshowLoading: false,\n\t\tshowLoadingTimeout: 0,\n\t\thideLoadingTimeout: 0,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.onLoadingChange(this.loading);\n\t\tEventBus.subscribe(AssetFailureEvent, ev => {\n\t\t\tthis.messages.push(`Failed to load asset '${ev.path}'`);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, shortHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(CustomAssetFailureEvent, ev => {\n\t\t\tthis.messages.push(\n\t\t\t\t'Failed to load custom asset. Try to download it manually and then upload it.'\n\t\t\t);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(ShowMessageEvent, ev => {\n\t\t\tthis.messages.push(ev.message);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(VueErrorEvent, ev => {\n\t\t\tthis.messages.push(ev.error.name);\n\t\t\tthis.messages.push(JSON.stringify(ev.error.stack));\n\t\t\tthis.messages.push(ev.info);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t\tthis.messages.shift();\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\t},\n\n\tmethods: {\n\t\tonLoadingChange(newValue: boolean) {\n\t\t\tif (newValue) {\n\t\t\t\tif (this.hideLoadingTimeout) {\n\t\t\t\t\tclearTimeout(this.hideLoadingTimeout);\n\t\t\t\t\tthis.hideLoadingTimeout = 0;\n\t\t\t\t}\n\t\t\t\tif (!this.showLoading && !this.showLoadingTimeout) {\n\t\t\t\t\tthis.showLoadingTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.showLoading = true;\n\t\t\t\t\t\tthis.showLoadingTimeout = 0;\n\t\t\t\t\t}, hideShowTimeouts);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.showLoadingTimeout) {\n\t\t\t\t\tclearTimeout(this.showLoadingTimeout);\n\t\t\t\t\tthis.showLoadingTimeout = 0;\n\t\t\t\t}\n\t\t\t\tif (this.showLoading && !this.hideLoadingTimeout) {\n\t\t\t\t\tthis.hideLoadingTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.showLoading = false;\n\t\t\t\t\t\tthis.hideLoadingTimeout = 0;\n\t\t\t\t\t}, hideShowTimeouts);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\n\twatch: {\n\t\tloading(newValue: boolean) {\n\t\t\tthis.onLoadingChange(newValue);\n\t\t},\n\t},\n});\n","import { render } from \"./message-console.vue?vue&type=template&id=51633a54&scoped=true\"\nimport script from \"./message-console.vue?vue&type=script&lang=ts\"\nexport * from \"./message-console.vue?vue&type=script&lang=ts\"\n\nimport \"./message-console.vue?vue&type=style&index=0&id=51633a54&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-51633a54\"\n\nexport default script","<template>\n\t<canvas\n\t\tid=\"scaled_display\"\n\t\tref=\"sd\"\n\t\t:height=\"bitmapHeight\"\n\t\t:width=\"bitmapWidth\"\n\t\t:style=\"{ width: canvasWidth + 'px', height: canvasHeight + 'px', cursor }\"\n\t\tdraggable=\"true\"\n\t\t@click=\"onUiClick\"\n\t\t@touchstart=\"onTouchStart\"\n\t\t@dragstart=\"onDragStart\"\n\t\t@touchmove=\"onSpriteDragMove\"\n\t\t@mousemove=\"onSpriteDragMove\"\n\t\t@touchend=\"onSpriteDrop\"\n\t\t@mouseup=\"onSpriteDrop\"\n\t\t@dragover=\"onDragOver\"\n\t\t@drop=\"onDrop\"\n\t\t@mouseenter=\"onMouseEnter\"\n\t\t>HTML5 is required to use the Doki Doki Dialog Generator.</canvas\n\t>\n</template>\n\n<script lang=\"ts\">\nimport { MutationPayload } from 'vuex';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { registerAsset } from '@/asset-manager';\nimport eventBus, {\n\tColorPickedEvent,\n\tInvalidateRenderEvent,\n} from '@/eventbus/event-bus';\nimport { IObject, ISetObjectPositionMutation } from '@/store/objects';\nimport { ICreateSpriteAction } from '@/store/objectTypes/sprite';\nimport { SceneRenderer } from '../renderables/scene-renderer';\nimport { DeepReadonly } from '../util/readonly';\nimport { screenHeight, screenWidth } from '@/constants/base';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tcanvasWidth: { default: 0 },\n\t\tcanvasHeight: { default: 0 },\n\t},\n\tdata: () => ({\n\t\tsdCtx: null! as CanvasRenderingContext2D,\n\t\tcurrentlyRendering: false,\n\t\tqueuedRender: null as null | number,\n\t\tshowingLast: false,\n\t\tdropSpriteCount: 0,\n\t\tdropPreventClick: false,\n\n\t\tdraggedObject: null as DeepReadonly<IObject> | null,\n\t\tdragXOffset: 0,\n\t\tdragYOffset: 0,\n\t\tdragXOriginal: 0,\n\t\tdragYOriginal: 0,\n\t}),\n\tcomputed: {\n\t\tselection(): string | null {\n\t\t\treturn this.$store.state.ui.selection;\n\t\t},\n\t\tlqRendering(): boolean {\n\t\t\treturn this.$store.state.ui.lqRendering;\n\t\t},\n\t\tsceneRender(): SceneRenderer {\n\t\t\treturn new SceneRenderer(\n\t\t\t\tthis.$store,\n\t\t\t\tthis.$store.state.panels.currentPanel,\n\t\t\t\tthis.bitmapWidth,\n\t\t\t\tthis.bitmapHeight\n\t\t\t);\n\t\t},\n\t\tbitmapHeight(): number {\n\t\t\treturn screenHeight;\n\t\t},\n\t\tbitmapWidth(): number {\n\t\t\treturn screenWidth;\n\t\t},\n\t\tpickerMode(): boolean {\n\t\t\treturn this.$store.state.ui.pickColor;\n\t\t},\n\t\tcursor(): 'default' | 'crosshair' {\n\t\t\treturn this.pickerMode ? 'crosshair' : 'default';\n\t\t},\n\t},\n\tmethods: {\n\t\tasync download(): Promise<void> {\n\t\t\tconst url = await this.sceneRender.download();\n\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tconst oldUrl = this.$store.state.ui.lastDownload;\n\n\t\t\t\tthis.$store.commit('ui/setLastDownload', url);\n\t\t\t\tif (oldUrl) {\n\t\t\t\t\tURL.revokeObjectURL(oldUrl);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tinvalidateRender() {\n\t\t\tif (this.queuedRender) return;\n\t\t\tthis.queuedRender = requestAnimationFrame(() => this.render_());\n\t\t},\n\t\tasync render_(): Promise<void> {\n\t\t\tif (this.queuedRender) {\n\t\t\t\tcancelAnimationFrame(this.queuedRender);\n\t\t\t\tthis.queuedRender = null;\n\t\t\t}\n\n\t\t\tif (this.$store.state.unsafe) return;\n\n\t\t\tawait this.sceneRender.render(!this.lqRendering, true);\n\t\t\tthis.display();\n\t\t},\n\t\trenderLoadingScreen() {\n\t\t\tif (!this.sdCtx) return;\n\t\t\tconst loadingScreen = document.createElement('canvas');\n\t\t\tloadingScreen.height = this.bitmapHeight;\n\t\t\tloadingScreen.width = this.bitmapWidth;\n\t\t\tconst rctx = RenderContext.make(loadingScreen, true, false);\n\t\t\trctx.drawText({\n\t\t\t\ttext: 'Starting...',\n\t\t\t\tx: loadingScreen.width / 2,\n\t\t\t\ty: loadingScreen.height / 2,\n\t\t\t\talign: 'center',\n\t\t\t\toutline: {\n\t\t\t\t\twidth: 5,\n\t\t\t\t\tstyle: '#b59',\n\t\t\t\t},\n\t\t\t\tfont: '32px riffic',\n\t\t\t\tfill: {\n\t\t\t\t\tstyle: 'white',\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.sdCtx!.drawImage(loadingScreen, this.canvasWidth, this.canvasHeight);\n\t\t},\n\t\tdisplay(): void {\n\t\t\tif (!this.sdCtx) return;\n\t\t\tthis.showingLast = false;\n\t\t\tthis.sceneRender.paintOnto(this.sdCtx, {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tw: this.bitmapWidth,\n\t\t\t\th: this.bitmapHeight,\n\t\t\t});\n\t\t},\n\t\ttoRendererCoordinate(x: number, y: number): [number, number] {\n\t\t\tconst sd = this.$refs.sd as HTMLCanvasElement;\n\t\t\tconst rx = x - sd.offsetLeft;\n\t\t\tconst ry = y - sd.offsetTop;\n\t\t\tconst sx = (rx / sd.offsetWidth) * sd.width;\n\t\t\tconst sy = (ry / sd.offsetWidth) * sd.width;\n\t\t\treturn [sx, sy];\n\t\t},\n\t\tonUiClick(e: MouseEvent): void {\n\t\t\tconst [sx, sy] = this.toRendererCoordinate(e.clientX, e.clientY);\n\n\t\t\tif (this.pickerMode) {\n\t\t\t\tconst data = this.sdCtx.getImageData(sx, sy, 1, 1).data;\n\t\t\t\tconst hex = `rgba(${data[0].toString()},${data[1].toString()},${data[2].toString()},${(\n\t\t\t\t\tdata[3] / 255\n\t\t\t\t).toString()})`;\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('ui/setColorPicker', false);\n\t\t\t\t\teventBus.fire(new ColorPickedEvent(hex));\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dropPreventClick) {\n\t\t\t\tthis.dropPreventClick = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst objects = this.sceneRender.objectsAt(sx, sy);\n\n\t\t\tconst currentObjectIdx = objects.findIndex(id => id === this.selection);\n\t\t\tlet selectedObject: string | null;\n\n\t\t\tif (currentObjectIdx === 0) {\n\t\t\t\tselectedObject = null;\n\t\t\t} else if (currentObjectIdx !== -1) {\n\t\t\t\t// Select the next lower character\n\t\t\t\tselectedObject = objects[currentObjectIdx - 1];\n\t\t\t} else {\n\t\t\t\tselectedObject = objects[objects.length - 1] || null;\n\t\t\t}\n\n\t\t\tif (this.$store.state.ui.selection === selectedObject) return;\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.commit('ui/setSelection', selectedObject);\n\t\t\t});\n\t\t},\n\t\tonDragStart(e: DragEvent) {\n\t\t\te.preventDefault();\n\t\t\tif (!this.selection) return;\n\t\t\tthis.draggedObject = this.$store.state.objects.objects[this.selection];\n\t\t\tconst [x, y] = this.toRendererCoordinate(e.clientX, e.clientY);\n\t\t\tthis.dragXOffset = x - this.draggedObject.x;\n\t\t\tthis.dragYOffset = y - this.draggedObject.y;\n\t\t\tthis.dragXOriginal = this.draggedObject.x;\n\t\t\tthis.dragYOriginal = this.draggedObject.y;\n\t\t},\n\t\tonTouchStart(e: TouchEvent) {\n\t\t\tif (!this.selection) return;\n\t\t\tthis.draggedObject = this.$store.state.objects.objects[this.selection];\n\t\t\tconst [x, y] = this.toRendererCoordinate(\n\t\t\t\te.touches[0].clientX,\n\t\t\t\te.touches[0].clientY\n\t\t\t);\n\t\t\tthis.dragXOffset = x - this.draggedObject.x;\n\t\t\tthis.dragYOffset = y - this.draggedObject.y;\n\t\t\tthis.dragXOriginal = this.draggedObject.x;\n\t\t\tthis.dragYOriginal = this.draggedObject.y;\n\t\t},\n\t\tonDragOver(e: DragEvent) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\te.dataTransfer!.dropEffect = 'copy';\n\t\t},\n\t\tonSpriteDragMove(e: MouseEvent | TouchEvent) {\n\t\t\tif (this.draggedObject) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\t// Formatter quirk\n\t\t\t\t// tslint:disable:indent\n\t\t\t\tlet [x, y] =\n\t\t\t\t\te instanceof MouseEvent\n\t\t\t\t\t\t? this.toRendererCoordinate(e.clientX, e.clientY)\n\t\t\t\t\t\t: this.toRendererCoordinate(\n\t\t\t\t\t\t\t\te.touches[0].clientX,\n\t\t\t\t\t\t\t\te.touches[0].clientY\n\t\t\t\t\t\t  );\n\t\t\t\t// tslint:enable:indent\n\t\t\t\tx -= this.dragXOffset;\n\t\t\t\ty -= this.dragYOffset;\n\n\t\t\t\tconst deltaX = Math.abs(x - this.dragXOriginal);\n\t\t\t\tconst deltaY = Math.abs(y - this.dragYOriginal);\n\n\t\t\t\tif (deltaX + deltaY > 1) this.dropPreventClick = true;\n\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tif (deltaX > deltaY) {\n\t\t\t\t\t\ty = this.dragYOriginal;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tx = this.dragXOriginal;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\t\tid: this.draggedObject!.id,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tasync onDrop(e: DragEvent) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (!e.dataTransfer) return;\n\n\t\t\tfor (const item of e.dataTransfer.items) {\n\t\t\t\tif (item.kind === 'file' && item.type.match(/image.*/)) {\n\t\t\t\t\tconst name = 'dropCustomAsset' + ++this.dropSpriteCount;\n\t\t\t\t\tconst url = registerAsset(name, item.getAsFile()!);\n\n\t\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\t\tawait this.$store.dispatch('objects/createSprite', {\n\t\t\t\t\t\t\tassets: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\thq: url,\n\t\t\t\t\t\t\t\t\tlq: url,\n\t\t\t\t\t\t\t\t\tsourcePack: 'dddg.generated.uploaded-sprites',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t} as ICreateSpriteAction);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonSpriteDrop(e: MouseEvent | TouchEvent) {\n\t\t\tif (this.draggedObject) {\n\t\t\t\tif ('TouchEvent' in window && e instanceof TouchEvent) {\n\t\t\t\t\tthis.dropPreventClick = false;\n\t\t\t\t}\n\t\t\t\tthis.draggedObject = null;\n\t\t\t}\n\t\t},\n\t\tonMouseEnter(e: MouseEvent) {\n\t\t\tif (e.buttons !== 1) {\n\t\t\t\tthis.draggedObject = null;\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tcanvasWidth() {\n\t\t\tthis.display();\n\t\t},\n\t\tcanvasHeight() {\n\t\t\tthis.display();\n\t\t},\n\t},\n\tasync created(): Promise<void> {\n\t\teventBus.subscribe(InvalidateRenderEvent, () => this.invalidateRender());\n\t\tthis.$store.subscribe((mut: MutationPayload) => {\n\t\t\tif (mut.type === 'panels/setPanelPreview') return;\n\t\t\tif (mut.type === 'panels/currentPanel') return;\n\t\t\tthis.invalidateRender();\n\t\t});\n\t},\n\tmounted(): void {\n\t\tconst sd = this.$refs.sd as HTMLCanvasElement;\n\t\tthis.sdCtx = sd.getContext('2d')!;\n\n\t\tthis.renderLoadingScreen();\n\t\tthis.invalidateRender();\n\t},\n});\n</script>\n\n<style lang=\"scss\"></style>\n","\nimport { MutationPayload } from 'vuex';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { registerAsset } from '@/asset-manager';\nimport eventBus, {\n\tColorPickedEvent,\n\tInvalidateRenderEvent,\n} from '@/eventbus/event-bus';\nimport { IObject, ISetObjectPositionMutation } from '@/store/objects';\nimport { ICreateSpriteAction } from '@/store/objectTypes/sprite';\nimport { SceneRenderer } from '../renderables/scene-renderer';\nimport { DeepReadonly } from '../util/readonly';\nimport { screenHeight, screenWidth } from '@/constants/base';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tcanvasWidth: { default: 0 },\n\t\tcanvasHeight: { default: 0 },\n\t},\n\tdata: () => ({\n\t\tsdCtx: null! as CanvasRenderingContext2D,\n\t\tcurrentlyRendering: false,\n\t\tqueuedRender: null as null | number,\n\t\tshowingLast: false,\n\t\tdropSpriteCount: 0,\n\t\tdropPreventClick: false,\n\n\t\tdraggedObject: null as DeepReadonly<IObject> | null,\n\t\tdragXOffset: 0,\n\t\tdragYOffset: 0,\n\t\tdragXOriginal: 0,\n\t\tdragYOriginal: 0,\n\t}),\n\tcomputed: {\n\t\tselection(): string | null {\n\t\t\treturn this.$store.state.ui.selection;\n\t\t},\n\t\tlqRendering(): boolean {\n\t\t\treturn this.$store.state.ui.lqRendering;\n\t\t},\n\t\tsceneRender(): SceneRenderer {\n\t\t\treturn new SceneRenderer(\n\t\t\t\tthis.$store,\n\t\t\t\tthis.$store.state.panels.currentPanel,\n\t\t\t\tthis.bitmapWidth,\n\t\t\t\tthis.bitmapHeight\n\t\t\t);\n\t\t},\n\t\tbitmapHeight(): number {\n\t\t\treturn screenHeight;\n\t\t},\n\t\tbitmapWidth(): number {\n\t\t\treturn screenWidth;\n\t\t},\n\t\tpickerMode(): boolean {\n\t\t\treturn this.$store.state.ui.pickColor;\n\t\t},\n\t\tcursor(): 'default' | 'crosshair' {\n\t\t\treturn this.pickerMode ? 'crosshair' : 'default';\n\t\t},\n\t},\n\tmethods: {\n\t\tasync download(): Promise<void> {\n\t\t\tconst url = await this.sceneRender.download();\n\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tconst oldUrl = this.$store.state.ui.lastDownload;\n\n\t\t\t\tthis.$store.commit('ui/setLastDownload', url);\n\t\t\t\tif (oldUrl) {\n\t\t\t\t\tURL.revokeObjectURL(oldUrl);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tinvalidateRender() {\n\t\t\tif (this.queuedRender) return;\n\t\t\tthis.queuedRender = requestAnimationFrame(() => this.render_());\n\t\t},\n\t\tasync render_(): Promise<void> {\n\t\t\tif (this.queuedRender) {\n\t\t\t\tcancelAnimationFrame(this.queuedRender);\n\t\t\t\tthis.queuedRender = null;\n\t\t\t}\n\n\t\t\tif (this.$store.state.unsafe) return;\n\n\t\t\tawait this.sceneRender.render(!this.lqRendering, true);\n\t\t\tthis.display();\n\t\t},\n\t\trenderLoadingScreen() {\n\t\t\tif (!this.sdCtx) return;\n\t\t\tconst loadingScreen = document.createElement('canvas');\n\t\t\tloadingScreen.height = this.bitmapHeight;\n\t\t\tloadingScreen.width = this.bitmapWidth;\n\t\t\tconst rctx = RenderContext.make(loadingScreen, true, false);\n\t\t\trctx.drawText({\n\t\t\t\ttext: 'Starting...',\n\t\t\t\tx: loadingScreen.width / 2,\n\t\t\t\ty: loadingScreen.height / 2,\n\t\t\t\talign: 'center',\n\t\t\t\toutline: {\n\t\t\t\t\twidth: 5,\n\t\t\t\t\tstyle: '#b59',\n\t\t\t\t},\n\t\t\t\tfont: '32px riffic',\n\t\t\t\tfill: {\n\t\t\t\t\tstyle: 'white',\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.sdCtx!.drawImage(loadingScreen, this.canvasWidth, this.canvasHeight);\n\t\t},\n\t\tdisplay(): void {\n\t\t\tif (!this.sdCtx) return;\n\t\t\tthis.showingLast = false;\n\t\t\tthis.sceneRender.paintOnto(this.sdCtx, {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tw: this.bitmapWidth,\n\t\t\t\th: this.bitmapHeight,\n\t\t\t});\n\t\t},\n\t\ttoRendererCoordinate(x: number, y: number): [number, number] {\n\t\t\tconst sd = this.$refs.sd as HTMLCanvasElement;\n\t\t\tconst rx = x - sd.offsetLeft;\n\t\t\tconst ry = y - sd.offsetTop;\n\t\t\tconst sx = (rx / sd.offsetWidth) * sd.width;\n\t\t\tconst sy = (ry / sd.offsetWidth) * sd.width;\n\t\t\treturn [sx, sy];\n\t\t},\n\t\tonUiClick(e: MouseEvent): void {\n\t\t\tconst [sx, sy] = this.toRendererCoordinate(e.clientX, e.clientY);\n\n\t\t\tif (this.pickerMode) {\n\t\t\t\tconst data = this.sdCtx.getImageData(sx, sy, 1, 1).data;\n\t\t\t\tconst hex = `rgba(${data[0].toString()},${data[1].toString()},${data[2].toString()},${(\n\t\t\t\t\tdata[3] / 255\n\t\t\t\t).toString()})`;\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('ui/setColorPicker', false);\n\t\t\t\t\teventBus.fire(new ColorPickedEvent(hex));\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dropPreventClick) {\n\t\t\t\tthis.dropPreventClick = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst objects = this.sceneRender.objectsAt(sx, sy);\n\n\t\t\tconst currentObjectIdx = objects.findIndex(id => id === this.selection);\n\t\t\tlet selectedObject: string | null;\n\n\t\t\tif (currentObjectIdx === 0) {\n\t\t\t\tselectedObject = null;\n\t\t\t} else if (currentObjectIdx !== -1) {\n\t\t\t\t// Select the next lower character\n\t\t\t\tselectedObject = objects[currentObjectIdx - 1];\n\t\t\t} else {\n\t\t\t\tselectedObject = objects[objects.length - 1] || null;\n\t\t\t}\n\n\t\t\tif (this.$store.state.ui.selection === selectedObject) return;\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.commit('ui/setSelection', selectedObject);\n\t\t\t});\n\t\t},\n\t\tonDragStart(e: DragEvent) {\n\t\t\te.preventDefault();\n\t\t\tif (!this.selection) return;\n\t\t\tthis.draggedObject = this.$store.state.objects.objects[this.selection];\n\t\t\tconst [x, y] = this.toRendererCoordinate(e.clientX, e.clientY);\n\t\t\tthis.dragXOffset = x - this.draggedObject.x;\n\t\t\tthis.dragYOffset = y - this.draggedObject.y;\n\t\t\tthis.dragXOriginal = this.draggedObject.x;\n\t\t\tthis.dragYOriginal = this.draggedObject.y;\n\t\t},\n\t\tonTouchStart(e: TouchEvent) {\n\t\t\tif (!this.selection) return;\n\t\t\tthis.draggedObject = this.$store.state.objects.objects[this.selection];\n\t\t\tconst [x, y] = this.toRendererCoordinate(\n\t\t\t\te.touches[0].clientX,\n\t\t\t\te.touches[0].clientY\n\t\t\t);\n\t\t\tthis.dragXOffset = x - this.draggedObject.x;\n\t\t\tthis.dragYOffset = y - this.draggedObject.y;\n\t\t\tthis.dragXOriginal = this.draggedObject.x;\n\t\t\tthis.dragYOriginal = this.draggedObject.y;\n\t\t},\n\t\tonDragOver(e: DragEvent) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\te.dataTransfer!.dropEffect = 'copy';\n\t\t},\n\t\tonSpriteDragMove(e: MouseEvent | TouchEvent) {\n\t\t\tif (this.draggedObject) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\t// Formatter quirk\n\t\t\t\t// tslint:disable:indent\n\t\t\t\tlet [x, y] =\n\t\t\t\t\te instanceof MouseEvent\n\t\t\t\t\t\t? this.toRendererCoordinate(e.clientX, e.clientY)\n\t\t\t\t\t\t: this.toRendererCoordinate(\n\t\t\t\t\t\t\t\te.touches[0].clientX,\n\t\t\t\t\t\t\t\te.touches[0].clientY\n\t\t\t\t\t\t  );\n\t\t\t\t// tslint:enable:indent\n\t\t\t\tx -= this.dragXOffset;\n\t\t\t\ty -= this.dragYOffset;\n\n\t\t\t\tconst deltaX = Math.abs(x - this.dragXOriginal);\n\t\t\t\tconst deltaY = Math.abs(y - this.dragYOriginal);\n\n\t\t\t\tif (deltaX + deltaY > 1) this.dropPreventClick = true;\n\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tif (deltaX > deltaY) {\n\t\t\t\t\t\ty = this.dragYOriginal;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tx = this.dragXOriginal;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\t\tid: this.draggedObject!.id,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tasync onDrop(e: DragEvent) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (!e.dataTransfer) return;\n\n\t\t\tfor (const item of e.dataTransfer.items) {\n\t\t\t\tif (item.kind === 'file' && item.type.match(/image.*/)) {\n\t\t\t\t\tconst name = 'dropCustomAsset' + ++this.dropSpriteCount;\n\t\t\t\t\tconst url = registerAsset(name, item.getAsFile()!);\n\n\t\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\t\tawait this.$store.dispatch('objects/createSprite', {\n\t\t\t\t\t\t\tassets: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\thq: url,\n\t\t\t\t\t\t\t\t\tlq: url,\n\t\t\t\t\t\t\t\t\tsourcePack: 'dddg.generated.uploaded-sprites',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t} as ICreateSpriteAction);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonSpriteDrop(e: MouseEvent | TouchEvent) {\n\t\t\tif (this.draggedObject) {\n\t\t\t\tif ('TouchEvent' in window && e instanceof TouchEvent) {\n\t\t\t\t\tthis.dropPreventClick = false;\n\t\t\t\t}\n\t\t\t\tthis.draggedObject = null;\n\t\t\t}\n\t\t},\n\t\tonMouseEnter(e: MouseEvent) {\n\t\t\tif (e.buttons !== 1) {\n\t\t\t\tthis.draggedObject = null;\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tcanvasWidth() {\n\t\t\tthis.display();\n\t\t},\n\t\tcanvasHeight() {\n\t\t\tthis.display();\n\t\t},\n\t},\n\tasync created(): Promise<void> {\n\t\teventBus.subscribe(InvalidateRenderEvent, () => this.invalidateRender());\n\t\tthis.$store.subscribe((mut: MutationPayload) => {\n\t\t\tif (mut.type === 'panels/setPanelPreview') return;\n\t\t\tif (mut.type === 'panels/currentPanel') return;\n\t\t\tthis.invalidateRender();\n\t\t});\n\t},\n\tmounted(): void {\n\t\tconst sd = this.$refs.sd as HTMLCanvasElement;\n\t\tthis.sdCtx = sd.getContext('2d')!;\n\n\t\tthis.renderLoadingScreen();\n\t\tthis.invalidateRender();\n\t},\n});\n","import { render } from \"./render.vue?vue&type=template&id=b322d676\"\nimport script from \"./render.vue?vue&type=script&lang=ts\"\nexport * from \"./render.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\n// App.vue has currently so many responsiblities that it's best to break it into chunks\nimport { ICreateTextBoxAction } from '@/store/objectTypes/textbox';\nimport {\n\tISetObjectPositionMutation,\n\tIRemoveObjectAction,\n\tICopyObjectToClipboardAction,\n\tIPasteFromClipboardAction,\n} from '@/store/objects';\nimport {\n\tIShiftCharacterSlotAction,\n\tICharacter,\n} from '@/store/objectTypes/characters';\nimport ToolBox from '@/components/toolbox/toolbox.vue';\nimport MessageConsole from '@/components/message-console.vue';\nimport Render from '@/components/render.vue';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport { ISetCurrentMutation } from '@/store/panels';\nimport { defineAsyncComponent, defineComponent } from 'vue';\nimport { Repo } from './models/repo';\nimport enviroment from '@/environments/environment';\nimport { IRemovePacksAction } from './store';\n\n// tslint:disable-next-line: no-magic-numbers\nconst aspectRatio = 16 / 9;\nconst arrowMoveStepSize = 20;\nconst packDialogWaitMs = 50;\nconst canvasTooSmallThreshold = 200;\n\nconst nsfwPacks = {\n\t'dddg.buildin.backgrounds.nsfw': `${process.env.BASE_URL}packs/buildin.base.backgrounds.nsfw.json`,\n\t'dddg.buildin.sayori.nsfw': `${process.env.BASE_URL}packs/buildin.base.sayori.nsfw.json`,\n\t'dddg.buildin.base.natsuki.nsfw': `${process.env.BASE_URL}packs/buildin.base.natsuki.nsfw.json`,\n\t'dddg.buildin.yuri.nsfw': `${process.env.BASE_URL}packs/buildin.base.yuri.nsfw.json`,\n};\n\nconst names = new Set(Object.keys(nsfwPacks));\nconst paths = Object.values(nsfwPacks);\n\nexport default defineComponent({\n\tcomponents: {\n\t\tToolBox,\n\t\tMessageConsole,\n\t\tRender,\n\t\tModalDialog,\n\t\tSingleBox: defineAsyncComponent(() =>\n\t\t\timport('@/components/repo/layouts/SingleBox.vue')\n\t\t),\n\t\tExpressionBuilder: defineAsyncComponent(() =>\n\t\t\timport('@/components/content-pack-builder/expression-builder/index.vue')\n\t\t),\n\t},\n\tdata: () => ({\n\t\tcanvasWidth: 0,\n\t\tcanvasHeight: 0,\n\t\tblendOver: null as string | null,\n\t\tuiSize: 192,\n\t\tcurrentlyRendering: false,\n\t\tpanel: '',\n\t\tdialogVisable: false,\n\t\tcanvasTooSmall: false,\n\t\texpressionBuilderVisible: false,\n\t\texpressionBuilderCharacter: '',\n\t\texpressionBuilderHeadGroup: undefined as string | undefined,\n\t\tsystemPrefersDarkMode: false,\n\t}),\n\tcomputed: {\n\t\tisSafari(): boolean {\n\t\t\treturn false;\n\t\t\t/*\t\treturn !!(\n\t\t\tnavigator.vendor &&\n\t\t\tnavigator.vendor.indexOf('Apple') > -1 &&\n\t\t\tnavigator.userAgent &&\n\t\t\tnavigator.userAgent.indexOf('CriOS') === -1 &&\n\t\t\tnavigator.userAgent.indexOf('FxiOS') === -1\n\t\t);*/\n\t\t},\n\t\tuseDarkTheme(): boolean {\n\t\t\treturn this.userPrefersDarkMode ?? this.systemPrefersDarkMode;\n\t\t},\n\t\tuserPrefersDarkMode(): boolean | null {\n\t\t\treturn this.$store.state.ui.useDarkTheme;\n\t\t},\n\t\tnsfw(): boolean {\n\t\t\treturn this.$store.state.ui.nsfw;\n\t\t},\n\t},\n\tmethods: {\n\t\tdrawLastDownload(): void {\n\t\t\tconst last = this.$store.state.ui.lastDownload;\n\t\t\tif (!last) return;\n\t\t\t(this.$refs.render as typeof Render).blendOver(last);\n\t\t},\n\t\tsetBlendOver(): void {\n\t\t\tthis.blendOver = this.$store.state.ui.lastDownload;\n\t\t},\n\t\toptimum(sw: number, sh: number): [number, number] {\n\t\t\tlet rh = sw / aspectRatio;\n\t\t\tlet rw = sh * aspectRatio;\n\n\t\t\tif (rh > sh) {\n\t\t\t\trh = sh;\n\t\t\t} else {\n\t\t\t\trw = sw;\n\t\t\t}\n\n\t\t\treturn [rw, rh];\n\t\t},\n\t\toptimizeWithMenu(sw: number, sh: number): [number, number, boolean] {\n\t\t\tconst opth = this.optimum(sw, sh - this.uiSize);\n\t\t\tconst optv = this.optimum(sw - this.uiSize, sh);\n\n\t\t\tif (!this.isSafari && opth[0] * opth[1] > optv[0] * optv[1]) {\n\t\t\t\treturn [opth[0], opth[1], false];\n\t\t\t} else {\n\t\t\t\treturn [optv[0], optv[1], true];\n\t\t\t}\n\t\t},\n\t\tupdateArea(): void {\n\t\t\tconst [cw, ch, v] = this.optimizeWithMenu(\n\t\t\t\tdocument.documentElement.clientWidth,\n\t\t\t\tdocument.documentElement.clientHeight\n\t\t\t);\n\n\t\t\tthis.canvasWidth = cw;\n\t\t\tthis.canvasHeight = ch;\n\n\t\t\tthis.canvasTooSmall = Math.max(cw, ch) < canvasTooSmallThreshold;\n\n\t\t\tif (this.$store.state.ui.vertical === v) return;\n\t\t\tthis.$store.commit('ui/setVertical', v);\n\t\t},\n\t\tshowDialog(search: string | undefined) {\n\t\t\tthis.dialogVisable = true;\n\t\t\tif (search) {\n\t\t\t\tconst wait = () => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.$refs.packDialog &&\n\t\t\t\t\t\t(this.$refs.packDialog as any).$refs.packDialog\n\t\t\t\t\t) {\n\t\t\t\t\t\t// This strange doubling is to get around the async component wrapper\n\t\t\t\t\t\t(this.$refs.packDialog as any).$refs.packDialog.setSearch(search);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetTimeout(wait, packDialogWaitMs);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.$nextTick(wait);\n\t\t\t}\n\t\t},\n\t\tshowExpressionDialog(e: IShowExpressionDialogEvent) {\n\t\t\tthis.expressionBuilderVisible = true;\n\t\t\tthis.expressionBuilderCharacter = e.character;\n\t\t\tthis.expressionBuilderHeadGroup = e.headGroup;\n\t\t},\n\t\tonKeydown(e: KeyboardEvent) {\n\t\t\tif (\n\t\t\t\te.target instanceof HTMLInputElement ||\n\t\t\t\te.target instanceof HTMLTextAreaElement\n\t\t\t) {\n\t\t\t\tconsole.log('skip keydown on potential target');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tconst selection = this.$store.state.objects.objects[\n\t\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t\t];\n\t\t\t\tif (e.ctrlKey) {\n\t\t\t\t\tif (e.key === 'z') {\n\t\t\t\t\t\t// this.$store.commit('history/undo');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (e.key === 'y') {\n\t\t\t\t\t\t// this.$store.commit('history/redo');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (e.key === 'v') {\n\t\t\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t\t\t'objects/pasteObjectFromClipboard',\n\t\t\t\t\t\t\t{} as IPasteFromClipboardAction\n\t\t\t\t\t\t);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!selection) return;\n\t\t\t\tif (e.key === 'Delete') {\n\t\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t} as IRemoveObjectAction);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.key === 'c' || e.key === 'x') {\n\t\t\t\t\tthis.$store.dispatch('objects/copyObjectToClipboard', {\n\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t} as ICopyObjectToClipboardAction);\n\t\t\t\t\tif (e.key === 'x') {\n\t\t\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t\t} as IRemoveObjectAction);\n\t\t\t\t\t}\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (selection.type === 'character') {\n\t\t\t\t\tconst character = selection as ICharacter;\n\t\t\t\t\tif (!character.freeMove) {\n\t\t\t\t\t\tif (e.key === 'ArrowLeft') {\n\t\t\t\t\t\t\tthis.$store.dispatch('objects/shiftCharacterSlot', {\n\t\t\t\t\t\t\t\tid: character.id,\n\t\t\t\t\t\t\t\tdelta: -1,\n\t\t\t\t\t\t\t} as IShiftCharacterSlotAction);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (e.key === 'ArrowRight') {\n\t\t\t\t\t\t\tthis.$store.dispatch('objects/shiftCharacterSlot', {\n\t\t\t\t\t\t\t\tid: character.id,\n\t\t\t\t\t\t\t\tdelta: 1,\n\t\t\t\t\t\t\t} as IShiftCharacterSlotAction);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet { x, y } = selection;\n\t\t\t\tif (e.key === 'ArrowLeft') {\n\t\t\t\t\tx -= e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowRight') {\n\t\t\t\t\tx += e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowUp') {\n\t\t\t\t\ty -= e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowDown') {\n\t\t\t\t\ty += e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\tid: selection.id,\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tdestroyed(): void {\n\t\t\twindow.removeEventListener('keydown', this.onKeydown);\n\t\t},\n\t\tapplyTheme(): void {\n\t\t\tdocument.body.classList.toggle('dark-theme', this.useDarkTheme);\n\t\t},\n\t},\n\twatch: {\n\t\tsystemPrefersDarkMode() {\n\t\t\tthis.applyTheme();\n\t\t},\n\t\tuserPrefersDarkMode() {\n\t\t\tthis.applyTheme();\n\t\t},\n\t\tasync nsfw(value: boolean) {\n\t\t\tif (value) {\n\t\t\t\tawait this.$store.dispatch('content/loadContentPacks', paths);\n\t\t\t} else {\n\t\t\t\tawait this.$store.dispatch('removePacks', {\n\t\t\t\t\tpacks: names,\n\t\t\t\t} as IRemovePacksAction);\n\t\t\t}\n\t\t},\n\t},\n\tmounted(): void {\n\t\twindow.addEventListener('keypress', e => {\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tif (this.$store.state.ui.selection === null) return;\n\t\t\t\t\tthis.$store.commit('ui/setSelection', null);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (window.matchMedia) {\n\t\t\t/* The viewport is less than, or equal to, 700 pixels wide */\n\t\t\tconst matcher = window.matchMedia('(prefers-color-scheme: dark)');\n\t\t\tthis.systemPrefersDarkMode = matcher.matches;\n\t\t\tmatcher.addListener(match => {\n\t\t\t\tthis.systemPrefersDarkMode = match.matches;\n\t\t\t});\n\t\t}\n\t},\n\tasync created(): Promise<void> {\n\t\t// Moving this to the \"mounted\"-handler crashes safari over version 12.\n\t\t// My best guess is because it runs in a microtask, which have been added in that Version.\n\t\tthis.updateArea();\n\t\tRepo.setStore(this.$store);\n\t\twindow.addEventListener('resize', this.updateArea);\n\t\twindow.removeEventListener('keydown', this.onKeydown);\n\t\twindow.addEventListener('keydown', this.onKeydown);\n\n\t\t(window as any).app = this;\n\t\t(window as any).store = this.$store;\n\t\t(window as any).env = enviroment;\n\n\t\tdocument.body.addEventListener(\n\t\t\t'drop',\n\t\t\t(event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t\tdocument.body.addEventListener(\n\t\t\t'dragover',\n\t\t\t(event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\tenviroment.connectToStore(this.vuexHistory, this.$store);\n\t\tconst settings = await enviroment.loadSettings();\n\n\t\tthis.vuexHistory.transaction(async () => {\n\t\t\tthis.$store.commit('ui/setLqRendering', settings.lq ?? false);\n\t\t\tthis.$store.commit('ui/setDarkTheme', settings.darkMode ?? null);\n\t\t\tthis.$store.commit(\n\t\t\t\t'ui/setDefaultCharacterTalkingZoom',\n\t\t\t\tsettings.defaultCharacterTalkingZoom ?? true\n\t\t\t);\n\n\t\t\tawait this.$store.dispatch('content/loadContentPacks', [\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.backgrounds.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.monika.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.sayori.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.natsuki.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.yuri.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc_chad.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc_classic.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.femc.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.classic_amy.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.amy.json`,\n\t\t\t]);\n\n\t\t\tawait this.$store.dispatch('panels/createPanel');\n\t\t\tif (Object.keys(this.$store.state.objects.objects).length === 0) {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createTextBox',\n\t\t\t\t\t{} as ICreateTextBoxAction\n\t\t\t\t);\n\t\t\t}\n\t\t\tawait this.$store.commit('panels/setCurrentBackground', {\n\t\t\t\tcurrent: 'dddg.buildin.backgrounds:ddlc.clubroom',\n\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t} as ISetCurrentMutation);\n\n\t\t\tawait this.$store.commit('ui/setNsfw', settings.nsfw ?? false);\n\t\t});\n\t},\n});\n\nexport interface IShowExpressionDialogEvent {\n\tcharacter: string;\n\theadGroup?: string;\n}\n","import { render } from \"./App.vue?vue&type=template&id=690aa3ef\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=690aa3ef&lang=scss\"\nscript.render = render\n\nexport default script","import { ICommand } from '@/eventbus/command';\nimport { getAAsset } from '@/asset-manager';\nimport { IObjectsState, ICreateObjectMutation, IObject } from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { IRootState } from '..';\nimport { IAsset } from '../content';\nimport { baseProps } from './baseObjectProps';\n\nexport interface ISprite extends IObject {\n\ttype: 'sprite';\n\tassets: IAsset[];\n}\n\nexport const spriteMutations: MutationTree<IObjectsState> = {};\n\nlet lastSpriteId = 0;\n\nexport const spriteActions: ActionTree<IObjectsState, IRootState> = {\n\tasync createSprite({ commit, rootState }, command: ICreateSpriteAction) {\n\t\tconst asset = await getAAsset(command.assets[0], false);\n\t\tif (!(asset instanceof HTMLImageElement)) return;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...baseProps(),\n\t\t\t\tassets: command.assets,\n\t\t\t\theight: asset.height,\n\t\t\t\twidth: asset.width,\n\t\t\t\tid: 'sprite_' + ++lastSpriteId,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tonTop: false,\n\t\t\t\tpreserveRatio: true,\n\t\t\t\tratio: asset.width / asset.height,\n\t\t\t\ttype: 'sprite',\n\t\t\t\ty: 0,\n\t\t\t\tenlargeWhenTalking: rootState.ui.defaultCharacterTalkingZoom,\n\t\t\t} as ISprite,\n\t\t} as ICreateObjectMutation);\n\t},\n};\n\nexport interface ICreateSpriteAction extends ICommand {\n\treadonly assets: IAsset[];\n}\n","import { ICommand } from '@/eventbus/command';\nimport { IObjectsState, ICreateObjectMutation, IObject } from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { TextBoxWidth, TextBoxHeight } from '@/constants/textBox';\nimport { IRootState } from '..';\nimport {\n\tChoiceSpacing,\n\tChoiceButtonColor,\n\tChoiceY,\n\tChoiceButtonWidth,\n} from '@/constants/choices';\nimport { ISetAutoWrappingMutation } from './textbox';\nimport { baseProps } from './baseObjectProps';\n\nexport interface IChoice {\n\ttext: string;\n\tselected: boolean;\n}\n\nexport interface IChoices extends IObject {\n\ttype: 'choice';\n\tcustomColor: string;\n\tchoices: IChoice[];\n\tchoiceDistance: number;\n\tautoWrap: boolean;\n}\n\nexport const choiceMutations: MutationTree<IObjectsState> = {\n\tsetChoices(state, command: ISetChoicesMutation) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tobj.choices = command.choices;\n\t\t++obj.version;\n\t},\n\tsetChoiceColor(state, command: ISetChoiceColorMutation) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tobj.customColor = command.customColor;\n\t\t++obj.version;\n\t},\n\tsetChoiceDistance(state, command: ISetChoiceDistanceMutation) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tobj.choiceDistance = command.choiceDistance;\n\t\t++obj.version;\n\t},\n\tsetAutoWrapping(state, command: ISetAutoWrappingMutation) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tobj.autoWrap = command.autoWrap;\n\t\t++obj.version;\n\t},\n};\n\nlet lastChoiceId = 0;\n\nexport const choiceActions: ActionTree<IObjectsState, IRootState> = {\n\tcreateChoice({ commit, rootState }, command: ICreateChoicesAction): string {\n\t\tconst id = 'choice_' + ++lastChoiceId;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...baseProps(),\n\t\t\t\ty: ChoiceY,\n\t\t\t\twidth: ChoiceButtonWidth,\n\t\t\t\theight: 0,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\tautoWrap: true,\n\t\t\t\ttype: 'choice',\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tratio: TextBoxWidth / TextBoxHeight,\n\t\t\t\tchoiceDistance: ChoiceSpacing,\n\t\t\t\tchoices: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselected: false,\n\t\t\t\t\t\ttext: 'Click here to edit choice',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tcustomColor: ChoiceButtonColor,\n\t\t\t} as IChoices,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n\n\taddChoice({ state, commit }, command: IAddChoiceAction) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tcommit('setChoices', {\n\t\t\tid: command.id,\n\t\t\tchoices: [\n\t\t\t\t...obj.choices,\n\t\t\t\t{\n\t\t\t\t\tselected: false,\n\t\t\t\t\ttext: command.text,\n\t\t\t\t},\n\t\t\t],\n\t\t} as ISetChoicesMutation);\n\t},\n\n\tremoveChoice({ state, commit }, command: IRemoveChoiceAction) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tconst choices = [...obj.choices];\n\t\tif (!choices[command.choiceIdx]) return;\n\t\tchoices.splice(command.choiceIdx, 1);\n\t\t// Do not allow empty choices\n\t\tif (choices.length === 0) {\n\t\t\tchoices.push({\n\t\t\t\tselected: false,\n\t\t\t\ttext: '',\n\t\t\t});\n\t\t}\n\t\tcommit('setChoices', {\n\t\t\tid: command.id,\n\t\t\tchoices,\n\t\t} as ISetChoicesMutation);\n\t},\n\n\tsetChoiceText({ state, commit }, command: ISetChoiceTextAction) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tconst choices = [...obj.choices];\n\t\tif (!choices[command.choiceIdx]) return;\n\t\tchoices[command.choiceIdx].text = command.text;\n\t\tcommit('setChoices', {\n\t\t\tid: command.id,\n\t\t\tchoices,\n\t\t} as ISetChoicesMutation);\n\t},\n};\n\nexport interface ISetChoicesMutation extends ICommand {\n\treadonly choices: IChoices['choices'];\n}\n\nexport interface ISetChoiceColorMutation extends ICommand {\n\treadonly customColor: IChoices['customColor'];\n}\n\nexport interface ISetChoiceDistanceMutation extends ICommand {\n\treadonly choiceDistance: IChoices['choiceDistance'];\n}\n\nexport interface ICreateChoicesAction extends ICommand {}\n\nexport interface IAddChoiceAction extends ICommand {\n\treadonly text: string;\n}\n\nexport interface ISetChoiceTextAction extends ICommand {\n\treadonly choiceIdx: number;\n\treadonly text: string;\n}\n\nexport interface IRemoveChoiceAction extends ICommand {\n\treadonly choiceIdx: number;\n}\n","import { ICommand } from '@/eventbus/command';\nimport {\n\tIObjectsState,\n\tICreateObjectMutation,\n\tIObject,\n\tISetObjectPositionMutation,\n\tISetObjectFlipMutation,\n\tISetSpriteRotationMutation,\n} from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { NameboxY, TextBoxWidth, TextBoxHeight } from '@/constants/textBox';\nimport { ISetSpriteSizeMutation } from './characters';\nimport { IRootState } from '..';\nimport { baseProps } from './baseObjectProps';\nimport { screenWidth } from '@/constants/base';\nimport { rotateAround } from '@/util/rotation';\nimport {\n\tcontrolsDefaultColor,\n\tnameboxDefaultColor,\n\tnameboxStrokeDefaultColor,\n\ttextboxDefaultColor,\n} from '@/constants/textBoxCustom';\nexport interface ITextBox extends IObject {\n\ttype: 'textBox';\n\ttext: string;\n\ttalkingObjId: null | '$other$' | string;\n\ttalkingOther: string;\n\tstyle: 'normal' | 'corrupt' | 'custom' | 'none';\n\toverrideColor: boolean;\n\tcustomColor: string;\n\tderiveCustomColors: boolean;\n\tcustomControlsColor: string;\n\tcustomNameboxColor: string;\n\tcustomNameboxStroke: string;\n\tcustomNameboxWidth: number;\n\tcontrols: boolean;\n\tskip: boolean;\n\tautoQuoting: boolean;\n\tautoWrap: boolean;\n\tcontinue: boolean;\n\tresetBounds: {\n\t\tx: number;\n\t\ty: number;\n\t\twidth: number;\n\t\theight: number;\n\t\trotation: number;\n\t};\n}\n\nconst splitTextboxSpacing = 4;\n\nexport const textBoxMutations: MutationTree<IObjectsState> = {\n\tsetText(state, command: ISetTextBoxTextMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.text = command.text;\n\t\t++obj.version;\n\t},\n\tsetTalkingObject(state, command: ISetTextBoxTalkingObjMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.talkingObjId = command.talkingObjId;\n\t\t++obj.version;\n\t},\n\tsetTalkingOther(state, command: ISetTextBoxTalkingOtherMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.talkingOther = command.talkingOther;\n\t\tobj.talkingObjId = '$other$';\n\t\t++obj.version;\n\t},\n\tsetStyle(state, command: ISetTextBoxStyleMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.style = command.style;\n\t\t++obj.version;\n\t},\n\tsetControlsVisible(state, command: ISetTextBoxControlsVisibleMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.controls = command.controls;\n\t\t++obj.version;\n\t},\n\tsetControlsColor(state, command: ISetTextBoxCustomControlsColorMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customControlsColor = command.customControlsColor;\n\t\t++obj.version;\n\t},\n\tsetDeriveCustomColors(state, command: ISetTextBoxDeriveCustomColorMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.deriveCustomColors = command.deriveCustomColors;\n\t\t++obj.version;\n\t},\n\tsetNameboxColor(state, command: ISetTextBoxNameboxColorMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customNameboxColor = command.customNameboxColor;\n\t\t++obj.version;\n\t},\n\tsetNameboxStroke(state, command: ISetTextBoxNameboxStrokeMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customNameboxStroke = command.customNameboxStroke;\n\t\t++obj.version;\n\t},\n\tsetNameboxWidth(state, command: ISetTextBoxNameboxWidthMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customNameboxWidth = command.customNameboxWidth;\n\t\t++obj.version;\n\t},\n\tsetSkipable(state, command: ISetTextBoxControlsSkipMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.skip = command.skip;\n\t\t++obj.version;\n\t},\n\tsetContinueArrow(state, command: ISetTextBoxControlsContinueMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.continue = command.continue;\n\t\t++obj.version;\n\t},\n\tsetCustomColor(state, command: ISetTextBoxCustomColorMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customColor = command.color;\n\t\t++obj.version;\n\t},\n\tsetAutoQuoting(state, command: ISetTextBoxAutoQuotingMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.autoQuoting = command.autoQuoting;\n\t\t++obj.version;\n\t},\n\tsetAutoWrapping(state, command: ISetAutoWrappingMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.autoWrap = command.autoWrap;\n\t\t++obj.version;\n\t},\n\tsetResetBounds(state, command: ISetResetBoundsMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.resetBounds = command.resetBounds;\n\t\tobj.x = command.resetBounds.x;\n\t\tobj.y = command.resetBounds.y;\n\t\tobj.height = command.resetBounds.height;\n\t\tobj.width = command.resetBounds.width;\n\t\tobj.rotation = command.resetBounds.rotation;\n\t\t++obj.version;\n\t},\n\tsetColorOverride(state, command: ISetColorOverrideMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.overrideColor = command.overrideColor;\n\t\t++obj.version;\n\t},\n};\n\nlet lastTextBoxId = 0;\n\nexport const textBoxActions: ActionTree<IObjectsState, IRootState> = {\n\tcreateTextBox({ commit, rootState }, command: ICreateTextBoxAction): string {\n\t\tconst id = 'textBox_' + ++lastTextBoxId;\n\t\tconst resetBounds = command.resetBounds || {\n\t\t\tx: screenWidth / 2,\n\t\t\ty: NameboxY,\n\t\t\twidth: TextBoxWidth,\n\t\t\theight: TextBoxHeight,\n\t\t\trotation: 0,\n\t\t};\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...baseProps(),\n\t\t\t\t...resetBounds,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\ttype: 'textBox',\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tratio: TextBoxWidth / TextBoxHeight,\n\t\t\t\tcontinue: true,\n\t\t\t\tcontrols: true,\n\t\t\t\tskip: true,\n\t\t\t\tautoQuoting: true,\n\t\t\t\tautoWrap: true,\n\t\t\t\tstyle: 'normal',\n\t\t\t\toverrideColor: false,\n\t\t\t\tcustomColor: textboxDefaultColor,\n\t\t\t\tderiveCustomColors: true,\n\t\t\t\tcustomControlsColor: controlsDefaultColor,\n\t\t\t\tcustomNameboxColor: nameboxDefaultColor,\n\t\t\t\tcustomNameboxWidth: 168,\n\t\t\t\tcustomNameboxStroke: nameboxStrokeDefaultColor,\n\t\t\t\ttalkingObjId: null,\n\t\t\t\ttalkingOther: '',\n\t\t\t\ttext: '',\n\t\t\t\tresetBounds,\n\t\t\t} as ITextBox,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n\n\tsetStyle({ commit }, command: ISetTextBoxStyleAction) {\n\t\tcommit('setStyle', {\n\t\t\tid: command.id,\n\t\t\tstyle: command.style,\n\t\t} as ISetTextBoxStyleMutation);\n\t},\n\n\tresetTextboxBounds({ commit, state }, command: IResetTextboxBounds) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tcommit('setPosition', {\n\t\t\tid: command.id,\n\t\t\tx: obj.resetBounds.x,\n\t\t\ty: obj.resetBounds.y,\n\t\t} as ISetObjectPositionMutation);\n\t\tcommit('setSize', {\n\t\t\tid: command.id,\n\t\t\theight: obj.resetBounds.height,\n\t\t\twidth: obj.resetBounds.width,\n\t\t} as ISetSpriteSizeMutation);\n\t\tcommit('setRotation', {\n\t\t\tid: command.id,\n\t\t\trotation: obj.resetBounds.rotation,\n\t\t} as ISetSpriteRotationMutation);\n\t},\n\n\tasync splitTextbox({ commit, state, dispatch }, command: ISplitTextbox) {\n\t\tconst obj = state.objects[command.id];\n\t\tconst newWidth = (obj.width - splitTextboxSpacing) / 2;\n\t\tconst centerDistance = newWidth / 2 + splitTextboxSpacing / 2;\n\n\t\tconst baseCenter = [obj.x, obj.y];\n\t\tlet boxOneCoords = [obj.x - centerDistance, obj.y];\n\t\tlet boxTwoCoords = [obj.x + centerDistance, obj.y];\n\n\t\tif (obj.rotation !== 0) {\n\t\t\tboxOneCoords = rotateAround(\n\t\t\t\tboxOneCoords[0],\n\t\t\t\tboxOneCoords[1],\n\t\t\t\tbaseCenter[0],\n\t\t\t\tbaseCenter[1],\n\t\t\t\t(obj.rotation / 180) * Math.PI\n\t\t\t);\n\t\t\tboxTwoCoords = rotateAround(\n\t\t\t\tboxTwoCoords[0],\n\t\t\t\tboxTwoCoords[1],\n\t\t\t\tbaseCenter[0],\n\t\t\t\tbaseCenter[1],\n\t\t\t\t(obj.rotation / 180) * Math.PI\n\t\t\t);\n\t\t}\n\n\t\tcommit('setResetBounds', {\n\t\t\tid: command.id,\n\t\t\tresetBounds: {\n\t\t\t\tx: boxOneCoords[0],\n\t\t\t\ty: boxOneCoords[1],\n\t\t\t\twidth: newWidth,\n\t\t\t\theight: obj.height,\n\t\t\t\trotation: obj.rotation,\n\t\t\t},\n\t\t} as ISetResetBoundsMutation);\n\t\tcommit('setStyle', {\n\t\t\tid: command.id,\n\t\t\tstyle: 'custom',\n\t\t} as ISetTextBoxStyleMutation);\n\t\tconst id = (await dispatch('createTextBox', {\n\t\t\tresetBounds: {\n\t\t\t\tx: boxTwoCoords[0],\n\t\t\t\ty: boxTwoCoords[1],\n\t\t\t\twidth: newWidth,\n\t\t\t\theight: obj.height,\n\t\t\t\trotation: obj.rotation,\n\t\t\t},\n\t\t} as ICreateTextBoxAction)) as string;\n\t\tcommit('setStyle', {\n\t\t\tid,\n\t\t\tstyle: 'custom',\n\t\t} as ISetTextBoxStyleMutation);\n\t\tif (obj.flip) {\n\t\t\tcommit('setFlip', {\n\t\t\t\tid,\n\t\t\t\tflip: obj.flip,\n\t\t\t} as ISetObjectFlipMutation);\n\t\t}\n\t},\n};\n\nexport interface ISetTextBoxTextMutation extends ICommand {\n\treadonly text: string;\n}\n\nexport interface ISetTextBoxTalkingObjMutation extends ICommand {\n\treadonly talkingObjId: ITextBox['talkingObjId'];\n}\n\nexport interface ISetTextBoxTalkingOtherMutation extends ICommand {\n\treadonly talkingOther: string;\n}\n\nexport interface ISetTextBoxStyleMutation extends ICommand {\n\treadonly style: ITextBox['style'];\n}\n\nexport interface ISetTextBoxControlsVisibleMutation extends ICommand {\n\treadonly controls: boolean;\n}\n\nexport interface ISetTextBoxDeriveCustomColorMutation extends ICommand {\n\treadonly deriveCustomColors: boolean;\n}\n\nexport interface ISetTextBoxCustomControlsColorMutation extends ICommand {\n\treadonly customControlsColor: string;\n}\n\nexport interface ISetTextBoxNameboxColorMutation extends ICommand {\n\treadonly customNameboxColor: string;\n}\n\nexport interface ISetTextBoxNameboxStrokeMutation extends ICommand {\n\treadonly customNameboxStroke: string;\n}\n\nexport interface ISetTextBoxNameboxWidthMutation extends ICommand {\n\treadonly customNameboxWidth: number;\n}\n\nexport interface ISetTextBoxAutoQuotingMutation extends ICommand {\n\treadonly autoQuoting: boolean;\n}\n\nexport interface ISetAutoWrappingMutation extends ICommand {\n\treadonly autoWrap: boolean;\n}\n\nexport interface ISetResetBoundsMutation extends ICommand {\n\treadonly resetBounds: ITextBox['resetBounds'];\n}\n\nexport interface ISetColorOverrideMutation extends ICommand {\n\treadonly overrideColor: boolean;\n}\n\nexport interface ISetColorOverrideMutation extends ICommand {\n\treadonly overrideColor: boolean;\n}\n\nexport interface ISetTextBoxControlsSkipMutation extends ICommand {\n\treadonly skip: boolean;\n}\n\nexport interface ISetTextBoxControlsContinueMutation extends ICommand {\n\treadonly continue: boolean;\n}\n\nexport interface ISetTextBoxCustomColorMutation extends ICommand {\n\treadonly color: string;\n}\n\nexport interface ICreateTextBoxAction extends ICommand {\n\treadonly resetBounds?: ITextBox['resetBounds'];\n}\n\nexport interface ISetTextBoxStyleAction extends ICommand {\n\treadonly style: ITextBox['style'];\n}\n\nexport interface ISplitTextbox extends ICommand {}\n\nexport interface IResetTextboxBounds extends ICommand {}\n","import { ICommand } from '@/eventbus/command';\nimport { IObjectsState, ICreateObjectMutation, IObject } from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { TextBoxWidth, TextBoxHeight } from '@/constants/textBox';\nimport { IRootState } from '..';\nimport {\n\tChoiceButtonColor,\n\tChoiceY,\n\tChoiceButtonWidth,\n} from '@/constants/choices';\nimport { screenHeight, screenWidth } from '@/constants/base';\nimport { ISetAutoWrappingMutation } from './textbox';\nimport { baseProps } from './baseObjectProps';\n\nexport interface INotification extends IObject {\n\ttype: 'notification';\n\tcustomColor: string;\n\ttext: string;\n\tbackdrop: boolean;\n\tautoWrap: boolean;\n}\n\nexport const notificationMutations: MutationTree<IObjectsState> = {\n\tsetNotificationColor(state, command: ISetChoiceColorMutation) {\n\t\tconst obj = state.objects[command.id] as INotification;\n\t\tobj.customColor = command.customColor;\n\t\t++obj.version;\n\t},\n\tsetNotificationText(state, { id, text }: ISetNotificationTextMutation) {\n\t\tconst obj = state.objects[id] as INotification;\n\t\tobj.text = text;\n\t\t++obj.version;\n\t},\n\tsetNotificationBackdrop(\n\t\tstate,\n\t\t{ id, backdrop }: ISetNotificationBackdropMutation\n\t) {\n\t\tconst obj = state.objects[id] as INotification;\n\t\tobj.backdrop = backdrop;\n\t\t++obj.version;\n\t},\n\tsetAutoWrapping(state, command: ISetAutoWrappingMutation) {\n\t\tconst obj = state.objects[command.id] as INotification;\n\t\tobj.autoWrap = command.autoWrap;\n\t\t++obj.version;\n\t},\n};\n\nlet lastNotificationId = 0;\n\nexport const notificationActions: ActionTree<IObjectsState, IRootState> = {\n\tcreateNotification(\n\t\t{ commit, rootState },\n\t\tcommand: ICreateNotificationAction\n\t): string {\n\t\tconst id = 'notification_' + ++lastNotificationId;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...baseProps(),\n\t\t\t\ty: screenHeight / 2,\n\t\t\t\twidth: ChoiceButtonWidth,\n\t\t\t\theight: 0,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tautoWrap: false,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\ttype: 'notification',\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tratio: TextBoxWidth / TextBoxHeight,\n\t\t\t\tcustomColor: ChoiceButtonColor,\n\t\t\t\ttext: 'Click here to edit notification',\n\t\t\t\tbackdrop: true,\n\t\t\t} as INotification,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n};\n\nexport interface ISetNotificationTextMutation extends ICommand {\n\treadonly text: INotification['text'];\n}\n\nexport interface ISetNotificationBackdropMutation extends ICommand {\n\treadonly backdrop: INotification['backdrop'];\n}\n\nexport interface ISetChoiceColorMutation extends ICommand {\n\treadonly customColor: INotification['customColor'];\n}\n\nexport interface ICreateNotificationAction extends ICommand {}\n","import { ICommand } from '@/eventbus/command';\nimport { IObjectsState, ICreateObjectMutation, IObject } from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { IRootState } from '..';\nimport {\n\tdefaultPoemBackground,\n\tdefaultX,\n\tdefaultY,\n\tdefaultPoemWidth,\n\tdefaultPoemHeight,\n\tconsoleHeight,\n\tconsoleWidth,\n\tdefaultPoemStyle,\n\tdefaultConsoleBackground,\n\tdefaultConsoleStyle,\n} from '@/constants/poem';\nimport { ISetAutoWrappingMutation } from './textbox';\nimport { baseProps } from './baseObjectProps';\n\nexport interface IPoem extends IObject {\n\ttype: 'poem';\n\tsubType: 'poem' | 'console';\n\tbackground: number;\n\tfont: number;\n\ttext: string;\n\tautoWrap: boolean;\n}\n\nexport const poemMutations: MutationTree<IObjectsState> = {\n\tsetPoemBackground(state, { id, background }: ISetBackgroundMutation) {\n\t\tconst obj = state.objects[id] as IPoem;\n\t\tobj.background = background;\n\t\t++obj.version;\n\t},\n\tsetPoemFont(state, { id, font }: ISetFontMutation) {\n\t\tconst obj = state.objects[id] as IPoem;\n\t\tobj.font = font;\n\t\t++obj.version;\n\t},\n\tsetPoemText(state, { id, text }: ISetTextMutation) {\n\t\tconst obj = state.objects[id] as IPoem;\n\t\tobj.text = text;\n\t\t++obj.version;\n\t},\n\tsetAutoWrapping(state, command: ISetAutoWrappingMutation) {\n\t\tconst obj = state.objects[command.id] as IPoem;\n\t\tobj.autoWrap = command.autoWrap;\n\t\t++obj.version;\n\t},\n};\n\nlet lastPoemId = 0;\n\nexport const poemActions: ActionTree<IObjectsState, IRootState> = {\n\tcreatePoem({ commit, rootState }, _command: ICreatePoemAction): string {\n\t\tconst id = 'poem_' + ++lastPoemId;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\tsubType: 'poem',\n\t\t\t\tx: defaultX,\n\t\t\t\ty: defaultY,\n\t\t\t\twidth: defaultPoemWidth,\n\t\t\t\theight: defaultPoemHeight,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tflip: false,\n\t\t\t\trotation: 0,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\topacity: 100,\n\t\t\t\ttype: 'poem',\n\t\t\t\tversion: 0,\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tautoWrap: true,\n\t\t\t\tratio: defaultPoemWidth / defaultPoemHeight,\n\t\t\t\tbackground: defaultPoemBackground,\n\t\t\t\tfont: defaultPoemStyle,\n\t\t\t\ttext: 'New poem\\n\\nClick here to edit poem',\n\t\t\t\tcomposite: 'source-over',\n\t\t\t\tfilters: [],\n\t\t\t\tlabel: null,\n\t\t\t\ttextboxColor: null,\n\t\t\t\tenlargeWhenTalking: true,\n\t\t\t\tnameboxWidth: null,\n\t\t\t\tzoom: 1,\n\t\t\t} as IPoem,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n\tcreateConsole({ commit, rootState }, _command: ICreatePoemAction): string {\n\t\tconst id = 'poem_' + ++lastPoemId;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...baseProps(),\n\t\t\t\tsubType: 'console',\n\t\t\t\tx: consoleWidth / 2,\n\t\t\t\ty: consoleHeight / 2,\n\t\t\t\twidth: consoleWidth,\n\t\t\t\theight: consoleHeight,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\ttype: 'poem',\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tratio: consoleWidth / consoleHeight,\n\t\t\t\tbackground: defaultConsoleBackground,\n\t\t\t\tfont: defaultConsoleStyle,\n\t\t\t\ttext: '> _\\n  \\n  Console command\\n  Click here to edit',\n\t\t\t\tautoWrap: true,\n\t\t\t} as IPoem,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n};\n\nexport interface ISetBackgroundMutation extends ICommand {\n\treadonly background: IPoem['background'];\n}\n\nexport interface ISetFontMutation extends ICommand {\n\treadonly font: IPoem['font'];\n}\n\nexport interface ISetTextMutation extends ICommand {\n\treadonly text: IPoem['text'];\n}\n\nexport interface ICreatePoemAction extends ICommand {}\n","import { Module } from 'vuex';\nimport { ICommand } from '@/eventbus/command';\nimport { spriteMutations, spriteActions } from './objectTypes/sprite';\nimport {\n\tcharacterActions,\n\tcharacterMutations,\n\tfixContentPackRemovalFromCharacter,\n} from './objectTypes/characters';\nimport { choiceMutations, choiceActions } from './objectTypes/choices';\nimport {\n\tITextBox,\n\ttextBoxActions,\n\ttextBoxMutations,\n\tISetTextBoxTalkingOtherMutation,\n} from './objectTypes/textbox';\nimport {\n\tnotificationMutations,\n\tnotificationActions,\n} from './objectTypes/notification';\nimport { poemMutations, poemActions } from './objectTypes/poem';\nimport { IRootState } from '.';\nimport { ContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from './content';\nimport {\n\taddFilter,\n\tIAddFilterAction,\n\tIHasSpriteFilters,\n\tIMoveFilterAction,\n\tIRemoveFilterAction,\n\tISetFilterAction,\n\tISetFiltersMutation,\n\tISetCompositionMutation,\n\tmoveFilter,\n\tremoveFilter,\n\tsetFilter,\n} from './sprite_options';\n\nexport interface IPanel {\n\tid: string;\n\torder: string[];\n\tonTopOrder: string[];\n}\n\nexport interface IObjectsState {\n\tobjects: { [id: string]: IObject };\n\tpanels: { [id: string]: IPanel };\n}\n\nexport interface IObject extends IHasSpriteFilters {\n\ttype: ObjectTypes;\n\tpanelId: string;\n\tid: string;\n\tx: number;\n\ty: number;\n\twidth: number;\n\theight: number;\n\trotation: number;\n\tpreserveRatio: boolean;\n\tratio: number;\n\tversion: number;\n\tflip: boolean;\n\tonTop: boolean;\n\tlabel: null | string;\n\ttextboxColor: string | null;\n\tenlargeWhenTalking: boolean;\n\tnameboxWidth: null | number;\n\tzoom: number;\n}\n\nexport type ObjectTypes =\n\t| 'sprite'\n\t| 'character'\n\t| 'textBox'\n\t| 'choice'\n\t| 'notification'\n\t| 'poem';\n\nlet lastCopyId = 0;\n\nexport default {\n\tnamespaced: true,\n\tstate: {\n\t\tobjects: {},\n\t\tpanels: {},\n\t},\n\tmutations: {\n\t\tcreate(state, { object }: ICreateObjectMutation) {\n\t\t\tif (!state.panels[object.panelId]) {\n\t\t\t\tstate.panels[object.panelId] = {\n\t\t\t\t\tid: object.panelId,\n\t\t\t\t\tonTopOrder: [],\n\t\t\t\t\torder: [],\n\t\t\t\t};\n\t\t\t}\n\t\t\tconst panel = state.panels[object.panelId];\n\t\t\tconst collection = object.onTop ? panel.onTopOrder : panel.order;\n\t\t\tstate.objects[object.id] = object;\n\t\t\tcollection.push(object.id);\n\t\t},\n\t\tremoveFromList(state, command: IRemoveFromListMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tconst collection = command.onTop ? panel.onTopOrder : panel.order;\n\t\t\tconst idx = collection.indexOf(command.id);\n\t\t\tcollection.splice(idx, 1);\n\t\t},\n\t\taddToList(state, command: IAddToListMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tconst collection = command.onTop ? panel.onTopOrder : panel.order;\n\t\t\tcollection.splice(command.position, 0, command.id);\n\t\t},\n\t\tsetOnTop(state, command: ISetOnTopMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.onTop = command.onTop;\n\t\t},\n\t\tsetPosition(state, command: ISetObjectPositionMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.x = command.x;\n\t\t\tobj.y = command.y;\n\t\t},\n\t\tsetFlip(state, command: ISetObjectFlipMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.flip = command.flip;\n\t\t},\n\t\tsetSize(state, command: ISetSpriteSizeMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.width = command.width;\n\t\t\tobj.height = command.height;\n\t\t},\n\t\tsetRatio(state, command: ISetSpriteRatioMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.preserveRatio = command.preserveRatio;\n\t\t\tobj.ratio = command.ratio;\n\t\t},\n\t\tsetRotation(state, command: ISetSpriteRotationMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.rotation =\n\t\t\t\tcommand.rotation < 0\n\t\t\t\t\t? 360 - (Math.abs(command.rotation) % 360)\n\t\t\t\t\t: command.rotation % 360;\n\t\t},\n\t\tremoveObject(state, command: IRemoveObjectMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tdelete state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tif (panel.onTopOrder.length === 0 && panel.order.length === 0) {\n\t\t\t\tdelete state.panels[obj.panelId];\n\t\t\t}\n\t\t},\n\t\tsetComposition(state, command: ISetCompositionMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.composite = command.composite;\n\t\t},\n\t\tsetFilters(state, command: ISetFiltersMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.filters = command.filters;\n\t\t},\n\t\tsetLabel(state, command: ISetLabelMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.label = command.label;\n\t\t},\n\t\tsetTextboxColor(state, command: ISetTextBoxColor) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.textboxColor = command.textboxColor;\n\t\t},\n\t\tsetEnlargeWhenTalking(state, command: ISetEnlargeWhenTalkingMutation) {\n\t\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\t\tobj.enlargeWhenTalking = command.enlargeWhenTalking;\n\t\t\t++obj.version;\n\t\t},\n\t\tsetObjectNameboxWidth(state, command: ISetNameboxWidthMutation) {\n\t\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\t\tobj.nameboxWidth = command.nameboxWidth;\n\t\t\t++obj.version;\n\t\t},\n\t\tsetObjectZoom(state, command: ISetObjectZoomMutation) {\n\t\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\t\tobj.zoom = command.zoom;\n\t\t\t++obj.version;\n\t\t},\n\t\t...spriteMutations,\n\t\t...characterMutations,\n\t\t...textBoxMutations,\n\t\t...choiceMutations,\n\t\t...notificationMutations,\n\t\t...poemMutations,\n\t},\n\tactions: {\n\t\tremoveObject({ state, commit, rootState }, command: IRemoveObjectAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tif (rootState.ui.selection === command.id) {\n\t\t\t\tcommit('ui/setSelection', null, { root: true });\n\t\t\t}\n\t\t\tfor (const key of [...panel.onTopOrder, ...panel.order]) {\n\t\t\t\tconst otherObject = state.objects[key] as ITextBox;\n\t\t\t\tif (obj.id === key || otherObject.type !== 'textBox') continue;\n\n\t\t\t\tif (otherObject.talkingObjId !== obj.id) continue;\n\n\t\t\t\tcommit('setTalkingOther', {\n\t\t\t\t\tid: otherObject.id,\n\t\t\t\t\ttalkingOther: obj.label || '',\n\t\t\t\t} as ISetTextBoxTalkingOtherMutation);\n\t\t\t}\n\t\t\tcommit('removeFromList', {\n\t\t\t\tid: command.id,\n\t\t\t\tonTop: obj.onTop,\n\t\t\t} as IRemoveFromListMutation);\n\t\t\tcommit('removeObject', {\n\t\t\t\tid: command.id,\n\t\t\t} as IRemoveObjectMutation);\n\t\t},\n\t\tsetPosition({ state, commit, dispatch }, command: ISetPositionAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tif (obj.type === 'character') {\n\t\t\t\tdispatch('setCharacterPosition', command as ISetPositionAction);\n\t\t\t} else {\n\t\t\t\tcommit('setPosition', command as ISetObjectPositionMutation);\n\t\t\t}\n\t\t},\n\t\tsetOnTop({ state, commit }, command: IObjectSetOnTopAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tif (obj.onTop === command.onTop) return;\n\t\t\tcommit('removeFromList', {\n\t\t\t\tid: command.id,\n\t\t\t\tonTop: obj.onTop,\n\t\t\t} as IRemoveFromListMutation);\n\t\t\tcommit('addToList', {\n\t\t\t\tid: command.id,\n\t\t\t\tposition: (command.onTop ? panel.onTopOrder : panel.order).length,\n\t\t\t\tonTop: command.onTop,\n\t\t\t} as IRemoveFromListMutation);\n\t\t\tcommit('setOnTop', {\n\t\t\t\tid: command.id,\n\t\t\t\tonTop: command.onTop,\n\t\t\t} as ISetOnTopMutation);\n\t\t},\n\t\tshiftLayer({ state, commit }, command: IObjectShiftLayerAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tconst collection = obj.onTop ? panel.onTopOrder : panel.order;\n\t\t\tconst position = collection.indexOf(obj.id);\n\n\t\t\tlet newPosition = position + command.delta;\n\t\t\tif (newPosition < 0) {\n\t\t\t\tnewPosition = 0;\n\t\t\t}\n\t\t\tif (newPosition > collection.length) {\n\t\t\t\tnewPosition = collection.length;\n\t\t\t}\n\t\t\tcommit('removeFromList', {\n\t\t\t\tid: command.id,\n\t\t\t\tonTop: obj.onTop,\n\t\t\t} as IRemoveFromListMutation);\n\t\t\tcommit('addToList', {\n\t\t\t\tid: command.id,\n\t\t\t\tposition: newPosition,\n\t\t\t\tonTop: obj.onTop,\n\t\t\t} as IAddToListMutation);\n\t\t},\n\t\tsetPreserveRatio({ commit, state }, command: ISetRatioAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst ratio = command.preserveRatio ? obj.width / obj.height : 0;\n\t\t\tcommit('setRatio', {\n\t\t\t\tid: command.id,\n\t\t\t\tpreserveRatio: command.preserveRatio,\n\t\t\t\tratio,\n\t\t\t} as ISetSpriteRatioMutation);\n\t\t},\n\t\tsetWidth({ commit, state }, command: ISetWidthAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst height = !obj.preserveRatio\n\t\t\t\t? obj.height\n\t\t\t\t: command.width / obj.ratio;\n\t\t\tcommit('setSize', {\n\t\t\t\tid: command.id,\n\t\t\t\theight,\n\t\t\t\twidth: command.width,\n\t\t\t} as ISetSpriteSizeMutation);\n\t\t},\n\t\tsetHeight({ commit, state }, command: ISetHeightAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst width = !obj.preserveRatio ? obj.width : command.height * obj.ratio;\n\t\t\tcommit('setSize', {\n\t\t\t\tid: command.id,\n\t\t\t\theight: command.height,\n\t\t\t\twidth,\n\t\t\t} as ISetSpriteSizeMutation);\n\t\t},\n\t\tfixContentPackRemoval(context, oldContent: ContentPack<IAsset>) {\n\t\t\tObject.values(context.state.objects).map(obj => {\n\t\t\t\tswitch (obj.type) {\n\t\t\t\t\tcase 'character':\n\t\t\t\t\t\tfixContentPackRemovalFromCharacter(context, obj.id, oldContent);\n\t\t\t\t\t\treturn;\n\t\t\t\t\tcase 'sprite':\n\t\t\t\t\t\treturn;\n\t\t\t\t\tcase 'textBox':\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tcopyObjects(\n\t\t\t{ commit, state },\n\t\t\t{ sourcePanelId, targetPanelId }: ICopyObjectsAction\n\t\t) {\n\t\t\tconst sourceOrders = state.panels[sourcePanelId];\n\t\t\tif (!sourceOrders) return;\n\t\t\tconst allSourceIds = [...sourceOrders.onTopOrder, ...sourceOrders.order];\n\t\t\tconst transationTable = new Map<string, string>();\n\t\t\tfor (const sourceId of allSourceIds) {\n\t\t\t\tconst targetId = `copy_${++lastCopyId}`;\n\t\t\t\ttransationTable.set(sourceId, targetId);\n\t\t\t}\n\t\t\tfor (const sourceId of allSourceIds) {\n\t\t\t\tconst oldObject = state.objects[sourceId];\n\t\t\t\tconst newObject: IObject = JSON.parse(JSON.stringify(oldObject));\n\t\t\t\tif ('talkingObjId' in newObject) {\n\t\t\t\t\tconst newTextbox = newObject as ITextBox;\n\t\t\t\t\tif (\n\t\t\t\t\t\tnewTextbox.talkingObjId !== null &&\n\t\t\t\t\t\ttransationTable.has(newTextbox.talkingObjId)\n\t\t\t\t\t) {\n\t\t\t\t\t\tnewTextbox.talkingObjId = transationTable.get(\n\t\t\t\t\t\t\tnewTextbox.talkingObjId\n\t\t\t\t\t\t)!;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcommit('create', {\n\t\t\t\t\tobject: {\n\t\t\t\t\t\t...newObject,\n\t\t\t\t\t\tid: transationTable.get(sourceId)!,\n\t\t\t\t\t\tpanelId: targetPanelId,\n\t\t\t\t\t},\n\t\t\t\t} as ICreateObjectMutation);\n\t\t\t}\n\t\t},\n\t\tcopyObjectToClipboard(\n\t\t\t{ commit, state },\n\t\t\t{ id }: ICopyObjectToClipboardAction\n\t\t) {\n\t\t\tconst oldObject = state.objects[id];\n\t\t\tcommit('ui/setClipboard', JSON.stringify(oldObject), { root: true });\n\t\t},\n\t\tpasteObjectFromClipboard({ commit, rootState }) {\n\t\t\tif (!rootState.ui.clipboard) return;\n\t\t\tconst oldObject = JSON.parse(rootState.ui.clipboard);\n\t\t\tcommit('create', {\n\t\t\t\tobject: {\n\t\t\t\t\t...oldObject,\n\t\t\t\t\tid: `copy_${++lastCopyId}`,\n\t\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\t},\n\t\t\t} as ICreateObjectMutation);\n\t\t},\n\t\tdeleteAllOfPanel({ state, dispatch }, { panelId }: IDeleteAllOfPanel) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tfor (const id of [...panel.onTopOrder, ...panel.order]) {\n\t\t\t\tdispatch('removeObject', { id } as IRemoveObjectAction);\n\t\t\t}\n\t\t},\n\t\taddFilter({ state, commit }, action: IAddFilterAction) {\n\t\t\taddFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.objects[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tremoveFilter({ state, commit }, action: IRemoveFilterAction) {\n\t\t\tremoveFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.objects[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tmoveFilter({ state, commit }, action: IMoveFilterAction) {\n\t\t\tmoveFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.objects[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tsetFilter({ state, commit }, action: ISetFilterAction) {\n\t\t\tsetFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.objects[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\t...spriteActions,\n\t\t...characterActions,\n\t\t...textBoxActions,\n\t\t...choiceActions,\n\t\t...notificationActions,\n\t\t...poemActions,\n\t},\n} as Module<IObjectsState, IRootState>;\n\nexport interface ICreateObjectMutation {\n\treadonly object: IObject;\n}\n\nexport interface IDeleteAllOfPanel {\n\treadonly panelId: string;\n}\n\nexport interface IObjectMutation {\n\treadonly id: string;\n}\n\nexport interface ISetSpriteSizeMutation extends ICommand {\n\treadonly width: number;\n\treadonly height: number;\n}\n\nexport interface ISetSpriteRatioMutation extends ICommand {\n\treadonly preserveRatio: boolean;\n\treadonly ratio: number;\n}\n\nexport interface ISetSpriteRotationMutation extends ICommand {\n\treadonly rotation: number;\n}\n\nexport interface ISetObjectPositionMutation extends IObjectMutation {\n\treadonly x: number;\n\treadonly y: number;\n}\n\nexport interface ISetOnTopMutation extends IObjectMutation {\n\treadonly onTop: boolean;\n}\n\nexport interface ISetObjectFlipMutation extends IObjectMutation {\n\treadonly flip: boolean;\n}\n\nexport interface IRemoveFromListMutation extends IObjectMutation {\n\treadonly onTop: boolean;\n}\n\nexport interface IAddToListMutation extends IObjectMutation {\n\treadonly onTop: boolean;\n\treadonly position: number;\n}\n\nexport interface ISetLabelMutation extends ICommand {\n\treadonly label: string;\n}\n\nexport interface ISetTextBoxColor extends ICommand {\n\treadonly textboxColor: string | null;\n}\n\nexport interface ISetEnlargeWhenTalkingMutation extends ICommand {\n\treadonly enlargeWhenTalking: boolean;\n}\n\nexport interface ISetNameboxWidthMutation extends ICommand {\n\treadonly nameboxWidth: null | number;\n}\n\nexport interface ISetObjectZoomMutation extends ICommand {\n\treadonly zoom: number;\n}\n\nexport interface IObjectShiftLayerAction extends ICommand {\n\treadonly delta: number;\n}\n\nexport interface IObjectSetOnTopAction extends ICommand {\n\treadonly onTop: boolean;\n}\n\nexport interface ISetWidthAction extends ICommand {\n\treadonly width: number;\n}\n\nexport interface ISetHeightAction extends ICommand {\n\treadonly height: number;\n}\n\nexport interface ISetRatioAction extends ICommand {\n\treadonly preserveRatio: boolean;\n}\n\nexport interface IRemoveObjectMutation extends ICommand {}\nexport interface IRemoveObjectAction extends ICommand {}\n\nexport interface ISetPositionAction extends ICommand {\n\treadonly x: number;\n\treadonly y: number;\n}\n\nexport interface IObjectContentPackRemovalAction extends ICommand {\n\treadonly oldPack: ContentPack<IAsset>;\n}\n\nexport interface ICopyObjectsAction {\n\treadonly sourcePanelId: string;\n\treadonly targetPanelId: string;\n}\n\nexport interface ICopyObjectToClipboardAction {\n\treadonly id: string;\n}\n\nexport interface IPasteFromClipboardAction {\n\treadonly panelId: string;\n}\n","import { Module } from 'vuex';\nimport { IRootState } from '.';\n\nexport interface IUiState {\n\tvertical: boolean;\n\tnsfw: boolean;\n\tselection: string | null;\n\tlqRendering: boolean;\n\tlastDownload: string | null;\n\tclipboard: string | null;\n\tuseDarkTheme: boolean | null;\n\tdefaultCharacterTalkingZoom: boolean;\n\tpickColor: boolean;\n}\n\nexport default {\n\tnamespaced: true,\n\tstate: {\n\t\tvertical: false,\n\t\tlqRendering: true,\n\t\tnsfw: false,\n\t\tselection: null,\n\t\tlastDownload: null,\n\t\tclipboard: null,\n\t\tuseDarkTheme: null,\n\t\tdefaultCharacterTalkingZoom: true,\n\t\tpickColor: false,\n\t},\n\tmutations: {\n\t\tsetVertical(state, vertical: boolean) {\n\t\t\tstate.vertical = vertical;\n\t\t},\n\t\tsetNsfw(state, nsfw: boolean) {\n\t\t\tstate.nsfw = nsfw;\n\t\t},\n\t\tsetLqRendering(state, lqRendering: boolean) {\n\t\t\tstate.lqRendering = lqRendering;\n\t\t},\n\t\tsetSelection(state, selection: string | null) {\n\t\t\tstate.selection = selection;\n\t\t},\n\t\tsetLastDownload(state, download: string) {\n\t\t\tstate.lastDownload = download;\n\t\t},\n\t\tsetClipboard(state, contents: string) {\n\t\t\tstate.clipboard = contents;\n\t\t},\n\t\tsetDarkTheme(state, theme: boolean | null) {\n\t\t\tstate.useDarkTheme = theme;\n\t\t},\n\t\tsetDefaultCharacterTalkingZoom(state, zoom: boolean) {\n\t\t\tstate.defaultCharacterTalkingZoom = zoom;\n\t\t},\n\t\tsetColorPicker(state, pickColor: boolean) {\n\t\t\tstate.pickColor = pickColor;\n\t\t},\n\t},\n} as Module<IUiState, IRootState>;\n","import {\n\tContentPack,\n\tBackground,\n\tCharacter,\n\tHeadCollections,\n\tPose,\n\tStyleClasses,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '.';\n\nexport function mergeContentPacks(\n\tx: ContentPack<IAsset>,\n\ty: ContentPack<IAsset>\n): ContentPack<IAsset> {\n\treturn {\n\t\tbackgrounds: mergeBackgrounds(x.backgrounds, y.backgrounds),\n\t\tcharacters: mergeCharacters<IAsset>(x.characters, y.characters),\n\t\tdependencies: mergeArrayUnique(x.dependencies, y.dependencies),\n\t\tfonts: mergeIdArrays(\n\t\t\tx.fonts,\n\t\t\ty.fonts,\n\t\t\tobj => obj.id,\n\t\t\t(xObj, yObj) => ({\n\t\t\t\t...xObj,\n\t\t\t\tfiles: mergeArrayUnique(xObj.files, yObj.files),\n\t\t\t})\n\t\t),\n\t\tpoemStyles: mergeIdArrays(\n\t\t\tx.poemStyles,\n\t\t\ty.poemStyles,\n\t\t\tobj => obj.label,\n\t\t\t() => {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\t\t),\n\t\tpoemBackgrounds: [...x.poemBackgrounds, ...y.poemBackgrounds],\n\t\tsprites: mergeIdArrays(\n\t\t\tx.sprites,\n\t\t\ty.sprites,\n\t\t\tobj => obj.id,\n\t\t\t(xObj, yObj) => ({\n\t\t\t\tid: xObj.id,\n\t\t\t\tlabel: xObj.label,\n\t\t\t\tvariants: [...xObj.variants, ...yObj.variants],\n\t\t\t})\n\t\t),\n\t\tcolors: mergeIdArrays(\n\t\t\tx.colors,\n\t\t\ty.colors,\n\t\t\tobj => obj.color,\n\t\t\txObj => xObj\n\t\t),\n\t};\n}\n\nfunction mergeBackgrounds<A>(\n\tx: Array<Background<A>>,\n\ty: Array<Background<A>>\n): Array<Background<A>> {\n\treturn mergeIdArrays(x, y, obj => obj.id, mergeBackground);\n}\n\nfunction mergeBackground<A>(x: Background<A>, y: Background<A>): Background<A> {\n\treturn {\n\t\tid: x.id,\n\t\tlabel: x.label,\n\t\tvariants: [...x.variants, ...y.variants],\n\t};\n}\n\nfunction mergeCharacters<A>(\n\tx: Array<Character<A>>,\n\ty: Array<Character<A>>\n): Array<Character<A>> {\n\treturn mergeIdArrays(x, y, obj => obj.id, mergeCharacter);\n}\n\nfunction mergeCharacter<A>(x: Character<A>, y: Character<A>): Character<A> {\n\treturn {\n\t\tchibi: x.chibi,\n\t\tid: x.id,\n\t\tlabel: x.label,\n\t\theads: mergeHeadCollections(x.heads, y.heads),\n\t\tstyleGroups: mergeIdArrays(\n\t\t\tx.styleGroups,\n\t\t\ty.styleGroups,\n\t\t\tobj => obj.id,\n\t\t\t(xStyleGroup, yStyleGroup) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: xStyleGroup.id,\n\t\t\t\t\tstyleComponents: mergeIdArrays(\n\t\t\t\t\t\txStyleGroup.styleComponents,\n\t\t\t\t\t\tyStyleGroup.styleComponents,\n\t\t\t\t\t\tobj => obj.id,\n\t\t\t\t\t\t(xClasses, yClasses) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tid: xClasses.id,\n\t\t\t\t\t\t\t\tlabel: xClasses.label,\n\t\t\t\t\t\t\t\tvariants: mergeStyleClasses(\n\t\t\t\t\t\t\t\t\txClasses.variants,\n\t\t\t\t\t\t\t\t\tyClasses.variants\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t),\n\t\t\t\t\tstyles: mergeIdArrays(\n\t\t\t\t\t\txStyleGroup.styles,\n\t\t\t\t\t\tyStyleGroup.styles,\n\t\t\t\t\t\tobj => JSON.stringify(obj.components),\n\t\t\t\t\t\t(xStyle, yStyle) => ({\n\t\t\t\t\t\t\tcomponents: xStyle.components,\n\t\t\t\t\t\t\tposes: mergeIdArrays(\n\t\t\t\t\t\t\t\txStyle.poses,\n\t\t\t\t\t\t\t\tyStyle.poses,\n\t\t\t\t\t\t\t\tobj => obj.id,\n\t\t\t\t\t\t\t\tmergePose\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t})\n\t\t\t\t\t),\n\t\t\t\t};\n\t\t\t}\n\t\t),\n\t};\n}\n\nfunction mergeStyleClasses<A>(\n\tx: StyleClasses<A>,\n\ty: StyleClasses<A>\n): StyleClasses<A> {\n\tconst ret: StyleClasses<A> = { ...x };\n\n\tfor (const classKey in y) {\n\t\tif (!y.hasOwnProperty(classKey)) continue;\n\t\tif (ret.hasOwnProperty(classKey)) continue;\n\t\tret[classKey] = y[classKey];\n\t}\n\n\treturn ret;\n}\n\nfunction mergePose<A>(x: Pose<A>, y: Pose<A>): Pose<A> {\n\tconst positions: Pose<A>['positions'] = { ...x.positions };\n\n\tfor (const key in y.positions) {\n\t\tif (positions[key]) {\n\t\t\tpositions[key] = [...positions[key], ...y.positions[key]] as A[][];\n\t\t} else {\n\t\t\tpositions[key] = y.positions[key];\n\t\t}\n\t}\n\n\treturn {\n\t\tid: x.id,\n\t\tcompatibleHeads: mergeArrayUnique(x.compatibleHeads, y.compatibleHeads),\n\t\tpreviewOffset: x.previewOffset,\n\t\tpreviewSize: x.previewSize,\n\t\tscale: x.scale,\n\t\tsize: x.size,\n\t\trenderCommands: x.renderCommands,\n\t\tpositions,\n\t};\n}\n\nfunction mergeHeadCollections<A>(\n\tx: HeadCollections<A>,\n\ty: HeadCollections<A>\n): HeadCollections<A> {\n\tconst ret = { ...x };\n\n\tfor (const headGroupKey in y) {\n\t\tif (!y.hasOwnProperty(headGroupKey)) continue;\n\t\tconst headGroup = y[headGroupKey];\n\t\tif (ret[headGroupKey]) {\n\t\t\tconst oldHeadGroup = ret[headGroupKey];\n\t\t\tret[headGroupKey] = {\n\t\t\t\tpreviewOffset: oldHeadGroup.previewOffset,\n\t\t\t\tpreviewSize: oldHeadGroup.previewSize,\n\t\t\t\tvariants: [...oldHeadGroup.variants, ...headGroup.variants],\n\t\t\t};\n\t\t} else {\n\t\t\tret[headGroupKey] = headGroup;\n\t\t}\n\t}\n\n\treturn ret;\n}\n\nfunction mergeArrayUnique<A>(x: A[], y: A[]): A[] {\n\tconst ret = [...x];\n\tfor (const yObj of y) {\n\t\tif (!ret.includes(yObj)) {\n\t\t\tret.push(yObj);\n\t\t}\n\t}\n\treturn ret;\n}\n\nfunction mergeIdArrays<A, B>(\n\tx: A[],\n\ty: A[],\n\tgetId: (obj: A) => B,\n\tmerge: (x: A, y: A) => A\n): A[] {\n\tconst ret = [...x];\n\tconst definedIds = new Map<B, number>(\n\t\tx.map((xObj, idx) => [getId(xObj), idx])\n\t);\n\n\tfor (const yObj of y) {\n\t\tconst yId = getId(yObj);\n\t\tif (definedIds.has(yId)) {\n\t\t\tconst existingIdx = definedIds.get(yId)!;\n\t\t\tconst existing = ret[existingIdx];\n\t\t\tret.splice(existingIdx, 1, merge(existing, yObj));\n\t\t} else {\n\t\t\tdefinedIds.set(yId, ret.length);\n\t\t\tret.push(yObj);\n\t\t}\n\t}\n\n\treturn ret;\n}\n","import { Module } from 'vuex';\nimport {\n\tContentPack,\n\tCharacter,\n\tBackground,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport {\n\tassetWalker,\n\tnormalizePath,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/util';\nimport { normalizeContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/parser';\nimport { convert as convertV1 } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/convertV1';\n// tslint:disable-next-line: max-line-length\nimport { normalizeCharacter as normalizeCharacterV1 } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v1/parser';\nimport { isWebPSupported } from '@/asset-manager';\nimport { mergeContentPacks } from './merge';\nimport { IRootState } from '..';\n\nexport interface IContentState {\n\tcontentPacks: Array<ContentPack<IAsset>>;\n\tcurrent: ContentPack<IAsset>;\n}\n\nexport interface IAsset {\n\thq: string;\n\tlq: string;\n\tsourcePack: string;\n}\n\nfunction baseDir(url: string): string {\n\treturn (\n\t\turl\n\t\t\t.split('/')\n\t\t\t.slice(0, -1)\n\t\t\t.join('/') + '/'\n\t);\n}\n\n// These types are assumed to always be supported\nconst baseTypes = new Set(['png', 'gif', 'bmp', 'svg']);\n\nexport type BackgroundLookup = Map<\n\tBackground<IAsset>['id'],\n\tBackground<IAsset>\n>;\n\nexport default {\n\tnamespaced: true,\n\tstate: {\n\t\tcontentPacks: [],\n\t\tcurrent: {\n\t\t\tdependencies: [],\n\t\t\tbackgrounds: [],\n\t\t\tcharacters: [],\n\t\t\tfonts: [],\n\t\t\tpoemStyles: [],\n\t\t\tpoemBackgrounds: [],\n\t\t\tsprites: [],\n\t\t\tcolors: [],\n\t\t},\n\t},\n\tmutations: {\n\t\tsetContentPacks(state: IContentState, packs: Array<ContentPack<IAsset>>) {\n\t\t\tstate.contentPacks = packs;\n\t\t},\n\t\tsetCurrentContent(state: IContentState, content: ContentPack<IAsset>) {\n\t\t\tstate.current = content;\n\t\t},\n\t},\n\tactions: {\n\t\tasync contentPack({ commit, state }, contentPack: ContentPack<string>) {\n\t\t\tconst convertedPack = (await convertContentPack(\n\t\t\t\tcontentPack\n\t\t\t)) as ContentPack<IAsset>;\n\t\t\tconst existingPacks = new Set(state.contentPacks.map(x => x.packId!));\n\t\t\tfor (const dependency of contentPack.dependencies) {\n\t\t\t\tif (!existingPacks.has(dependency)) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Missing dependency '${dependency}'. Refusing to install ${contentPack.packId}`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcommit('setContentPacks', [...state.contentPacks, convertedPack]);\n\t\t\tcommit(\n\t\t\t\t'setCurrentContent',\n\t\t\t\tmergeContentPacks(state.current, convertedPack)\n\t\t\t);\n\t\t},\n\n\t\tasync removeContentPacks({ commit, state }, packIds: Set<string>) {\n\t\t\tconst newContentPacks = sortByDependencies(\n\t\t\t\tstate.contentPacks.filter(pack => !packIds.has(pack.packId!))\n\t\t\t);\n\t\t\tcommit('setContentPacks', newContentPacks);\n\t\t\tcommit(\n\t\t\t\t'setCurrentContent',\n\t\t\t\t(newContentPacks as Array<ContentPack<IAsset>>).reduce((acc, value) =>\n\t\t\t\t\tmergeContentPacks(acc, value)\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\n\t\tasync replaceContentPack(\n\t\t\t{ commit, state },\n\t\t\taction: ReplaceContentPackAction\n\t\t) {\n\t\t\tconst convertedPack = action.processed\n\t\t\t\t? action.contentPack\n\t\t\t\t: await convertContentPack(action.contentPack);\n\t\t\tlet packs = state.contentPacks;\n\t\t\tconst packIdx = packs.findIndex(\n\t\t\t\tpack => pack.packId === action.contentPack.packId\n\t\t\t);\n\t\t\tif (packIdx === -1) {\n\t\t\t\tpacks.push(convertedPack);\n\t\t\t} else {\n\t\t\t\tpacks.splice(packIdx, 1, convertedPack);\n\t\t\t}\n\t\t\tpacks = sortByDependencies(packs);\n\t\t\tcommit('setContentPacks', packs);\n\t\t\tcommit(\n\t\t\t\t'setCurrentContent',\n\t\t\t\t(packs as Array<ContentPack<IAsset>>).reduce((acc, value) =>\n\t\t\t\t\tmergeContentPacks(acc, value)\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\n\t\tasync loadContentPacks({ dispatch }, urls: string | string[]) {\n\t\t\tif (typeof urls === 'string') {\n\t\t\t\turls = [urls];\n\t\t\t}\n\t\t\tconst contentPacks = await Promise.all(\n\t\t\t\turls.map(async url => {\n\t\t\t\t\tconst response = await fetch(url);\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\terror(\n\t\t\t\t\t\t\t`Could not load content pack. Server responded with: ${response.statusText}`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet json;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tjson = await response.json();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\terror('Content pack is not valid json!');\n\t\t\t\t\t}\n\n\t\t\t\t\tlet contentPack: ContentPack<string>;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst paths = {\n\t\t\t\t\t\t\t'./': baseDir(url),\n\t\t\t\t\t\t\t'/': baseDir(location.href) + 'assets/',\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (json.version === '2.0') {\n\t\t\t\t\t\t\tcontentPack = normalizeContentPack(json, paths) as ContentPack<\n\t\t\t\t\t\t\t\tstring\n\t\t\t\t\t\t\t>;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontentPack = convertV1(\n\t\t\t\t\t\t\t\tnormalizeCharacterV1(json, paths),\n\t\t\t\t\t\t\t\tpaths,\n\t\t\t\t\t\t\t\tfalse\n\t\t\t\t\t\t\t) as ContentPack<string>;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\terror('Content pack is not in a valid format!', e);\n\t\t\t\t\t}\n\t\t\t\t\treturn contentPack;\n\t\t\t\t})\n\t\t\t);\n\n\t\t\tfor (const contentPack of contentPacks) {\n\t\t\t\tawait dispatch('contentPack', contentPack);\n\t\t\t}\n\n\t\t\treturn contentPacks.map(x => x.packId);\n\t\t},\n\t},\n\tgetters: {\n\t\tgetCharacters({\n\t\t\tcurrent,\n\t\t}): Map<Character<IAsset>['id'], Character<IAsset>> {\n\t\t\tconst ret = new Map<Character<IAsset>['id'], Character<IAsset>>();\n\t\t\tfor (const character of current.characters) {\n\t\t\t\tret.set(character.id, character);\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\tgetBackgrounds({ current }): BackgroundLookup {\n\t\t\tconst ret = new Map<Background<IAsset>['id'], Background<IAsset>>();\n\t\t\tfor (const background of current.backgrounds) {\n\t\t\t\tret.set(background.id, background);\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t},\n} as Module<IContentState, IRootState>;\n\nfunction sortByDependencies(\n\tpacks: Array<ContentPack<IAsset>>\n): Array<ContentPack<IAsset>> {\n\treturn packs;\n}\n\nasync function convertContentPack(\n\tpack: ContentPack<string>\n): Promise<ContentPack<IAsset>> {\n\tconst types: ReadonlySet<string> = new Set(\n\t\t(await isWebPSupported()) ? ['webp', ...baseTypes] : baseTypes\n\t);\n\n\tconst replacementMap = new Map([\n\t\t['ext', '{lq:.lq:}.{format:webp:webp:png:png}'],\n\t]);\n\n\tconst ret = assetWalker(\n\t\tpack,\n\t\t(path: string, type: 'image' | 'font'): IAsset => {\n\t\t\tconst hq = normalizePath(path, replacementMap, types, false);\n\t\t\tconst lq = normalizePath(path, replacementMap, types, true);\n\n\t\t\treturn {\n\t\t\t\thq,\n\t\t\t\tlq,\n\t\t\t\tsourcePack: pack.packId || 'buildIn',\n\t\t\t};\n\t\t}\n\t) as ContentPack<IAsset>;\n\treturn ret;\n}\n\nfunction error(msg: string, payload?: any): never {\n\tconsole.error(msg, payload);\n\tthrow new Error(msg);\n}\n\n// tslint:disable: indent\nexport type ReplaceContentPackAction =\n\t| {\n\t\t\tcontentPack: ContentPack<string>;\n\t\t\tprocessed: false;\n\t  }\n\t| {\n\t\t\tcontentPack: ContentPack<IAsset>;\n\t\t\tprocessed: true;\n\t  };\n// tslint:enable: indent\n","import { createStore } from 'vuex';\nimport objects, { IObjectsState } from './objects';\nimport ui, { IUiState } from './ui';\nimport panels, { IPanels } from './panels';\nimport content, { IContentState, IAsset } from './content';\nimport { ContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\n\nexport interface IRootState {\n\tobjects: IObjectsState;\n\tui: IUiState;\n\tpanels: IPanels;\n\tcontent: IContentState;\n\tunsafe: boolean;\n}\n\nexport default createStore({\n\tstate: {\n\t\tunsafe: false,\n\t} as any,\n\tmutations: {\n\t\tsetUnsafe(state, unsafe: boolean) {\n\t\t\tstate.unsafe = unsafe;\n\t\t},\n\t},\n\tactions: {\n\t\tasync removePacks(\n\t\t\t{ dispatch, commit, state },\n\t\t\t{ packs }: IRemovePacksAction\n\t\t) {\n\t\t\tconst oldState: ContentPack<IAsset> = JSON.parse(\n\t\t\t\tJSON.stringify(state.content.current)\n\t\t\t);\n\n\t\t\tcommit('setUnsafe', true);\n\t\t\tawait dispatch('content/removeContentPacks', packs);\n\t\t\tawait dispatch('panels/fixContentPackRemoval', oldState);\n\t\t\tawait dispatch('objects/fixContentPackRemoval', oldState);\n\t\t\tcommit('setUnsafe', false);\n\t\t},\n\t},\n\tmodules: { objects, ui, panels, content },\n});\n\nexport interface IRemovePacksAction {\n\tpacks: Set<string>;\n}\n","import { reactive } from 'vue';\n\nexport default {\n\t/**\n\t *\n\t * @param {Vue} Vue\n\t * @param {{}} options\n\t */\n\tinstall(vueApp, options = {}) {\n\t\tif (!vueApp.config.globalProperties.$store) {\n\t\t\tthrow new Error(\n\t\t\t\t'VuexUndoRedo plugin must be installed after the Vuex plugin.'\n\t\t\t);\n\t\t}\n\t\tif (!options.resetStateMutation) options.resetStateMutation = 'emptyState';\n\t\tif (!options.mutations) options.mutations = {};\n\n\t\tconst $store = vueApp.config.globalProperties.$store;\n\n\t\t/**\n\t\t * @param {Vue} vm\n\t\t * @param {*} mutation\n\t\t */\n\t\tfunction replayMutation(vm, mutation) {\n\t\t\tlet baseObj = {};\n\t\t\tswitch (typeof mutation.payload) {\n\t\t\t\tcase 'object':\n\t\t\t\t\tif (mutation.payload instanceof Array) {\n\t\t\t\t\t\tbaseObj = [];\n\t\t\t\t\t}\n\t\t\t\t\t$store.commit(\n\t\t\t\t\t\t`${mutation.type}`,\n\t\t\t\t\t\tObject.assign(baseObj, mutation.payload)\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t$store.commit(`${mutation.type}`, mutation.payload);\n\t\t\t}\n\t\t}\n\n\t\tasync function replayTransaction(vm, transaction) {\n\t\t\treturn await vm.transaction(() => {\n\t\t\t\ttransaction.forEach(mutation => {\n\t\t\t\t\treplayMutation(vm, mutation);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * @param {Vue} vm\n\t\t * @param {*} mutation\n\t\t */\n\t\tasync function replayAll(vm) {\n\t\t\tconst oldTransactions = vm.data.done.slice(0);\n\t\t\tvm.data.done = [];\n\t\t\t$store.commit(options.resetStateMutation);\n\t\t\tfor (let i = 0; i < oldTransactions.length; ++i) {\n\t\t\t\tawait replayTransaction(vm, oldTransactions[i]);\n\t\t\t}\n\t\t}\n\n\t\tconst mutationProperiesCache = {};\n\n\t\t/**\n\t\t *\n\t\t * @param {IHistoryOptions} options\n\t\t * @param {*} name\n\t\t */\n\t\tfunction getMutationProperties(name) {\n\t\t\tif (!mutationProperiesCache[name]) {\n\t\t\t\tconst parts = name.split('/');\n\t\t\t\tconst mutationProperties = {\n\t\t\t\t\tignore: mutation => false,\n\t\t\t\t\tcombinable: (oldMutation, newMutation) => false,\n\t\t\t\t\tcombinator: (oldMutation, newMutation) => newMutation,\n\t\t\t\t};\n\t\t\t\tlet currentWildcard = '';\n\t\t\t\tfor (const part of parts) {\n\t\t\t\t\tif (options.mutations[currentWildcard + '*']) {\n\t\t\t\t\t\tObject.assign(\n\t\t\t\t\t\t\tmutationProperties,\n\t\t\t\t\t\t\toptions.mutations[currentWildcard + '*']\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcurrentWildcard += part + '/';\n\t\t\t\t}\n\t\t\t\tif (options.mutations[name]) {\n\t\t\t\t\tObject.assign(mutationProperties, options.mutations[name]);\n\t\t\t\t}\n\t\t\t\tmutationProperiesCache[name] = mutationProperties;\n\t\t\t}\n\t\t\treturn mutationProperiesCache[name];\n\t\t}\n\n\t\tconst history = {\n\t\t\tdata: reactive({\n\t\t\t\tdone: [],\n\t\t\t\tundone: [],\n\t\t\t\tnewMutation: true,\n\t\t\t\tignoreMutations: options.ignoreMutations || [],\n\t\t\t\tcurrentTransaction: null,\n\t\t\t\ttransactionQueue: [],\n\t\t\t\tinitialized: false,\n\t\t\t}),\n\t\t\tinitialize() {\n\t\t\t\tif (history.initialized) return;\n\t\t\t\thistory.initialized = true;\n\t\t\t\t$store.subscribe(mutation => {\n\t\t\t\t\tconst exec = () => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tmutation.type === options.resetStateMutation ||\n\t\t\t\t\t\t\tgetMutationProperties(mutation.type).ignore(mutation)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\thistory.currentTransaction.push(mutation);\n\t\t\t\t\t\tif (history.newMutation) {\n\t\t\t\t\t\t\thistory.data.undone = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tif (history.currentTransaction) {\n\t\t\t\t\t\texec();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If a mutation triggers outside of any transaction, it gets it's own transaction\n\t\t\t\t\t\thistory.transaction(() => {\n\t\t\t\t\t\t\texec();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tredo() {\n\t\t\t\tif (history.data.undone.length <= 0) return;\n\t\t\t\tconst commit = history.data.undone.pop();\n\t\t\t\thistory.newMutation = false;\n\t\t\t\treplayTransaction(history, commit);\n\t\t\t\thistory.newMutation = true;\n\t\t\t},\n\t\t\tasync undo() {\n\t\t\t\tif (history.data.done.length <= 0) return;\n\t\t\t\thistory.data.undone.push(history.data.done.pop());\n\t\t\t\thistory.newMutation = false;\n\t\t\t\tawait replayAll(history);\n\t\t\t\thistory.newMutation = true;\n\t\t\t},\n\t\t\t/**\n\t\t\t * @param {transactionCallback} callback\n\t\t\t */\n\t\t\ttransaction(callback) {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst exec = async () => {\n\t\t\t\t\t\thistory.currentTransaction = [];\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait callback();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.log('Error during transaction!: ', e);\n\t\t\t\t\t\t\t// reject(e);\n\t\t\t\t\t\t\t//this.currentTransaction = [];\n\t\t\t\t\t\t\t// The transaction that just failed is not in the undo history yet.\n\t\t\t\t\t\t\t// So replaying that is equivalent to undoing the transaction.\n\t\t\t\t\t\t\t//replayAll(this);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst lastUndo = history.data.done[history.data.done.length - 1];\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\thistory.currentTransaction.length === 1 &&\n\t\t\t\t\t\t\tlastUndo &&\n\t\t\t\t\t\t\tlastUndo.length === 1\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tconst options = getMutationProperties(\n\t\t\t\t\t\t\t\thistory.currentTransaction[0].type\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\toptions.combinable(lastUndo[0], history.currentTransaction[0])\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tconst combination = options.combinator(\n\t\t\t\t\t\t\t\t\tlastUndo[0],\n\t\t\t\t\t\t\t\t\thistory.currentTransaction[0]\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\thistory.data.done.pop();\n\t\t\t\t\t\t\t\tif (combination) {\n\t\t\t\t\t\t\t\t\thistory.currentTransaction = [combination];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// Returning a non-truthy value in the combinator simply eliminates both transactions.\n\t\t\t\t\t\t\t\t\t// So if the user manually undoes an action, you can just pretend it never happened.\n\t\t\t\t\t\t\t\t\thistory.currentTransaction = [];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (history.currentTransaction.length > 0) {\n\t\t\t\t\t\t\thistory.data.done.push(history.currentTransaction);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thistory.currentTransaction = null;\n\t\t\t\t\t\tif (history.data.transactionQueue.length > 0) {\n\t\t\t\t\t\t\thistory.data.transactionQueue.pop()();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t};\n\t\t\t\t\tif (history.currentTransaction) {\n\t\t\t\t\t\thistory.data.transactionQueue.push(exec);\n\t\t\t\t\t} else {\n\t\t\t\t\t\texec();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t};\n\n\t\tvueApp.config.globalProperties.vuexHistory = history;\n\t\thistory.initialize();\n\t},\n};\n\n/**\n * @callback transactionCallback\n * @async\n */\n","import { createApp } from 'vue';\r\nimport App from './App.vue';\r\nimport store from './store';\r\nimport History from './plugins/vuex-history';\r\n\r\ncreateApp(App)\r\n\t.use(store)\r\n\t.use(History)\r\n\t.mount('#app');\r\n","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./settings.vue?vue&type=style&index=0&id=1217296c&lang=scss&scoped=true\"","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&id=690aa3ef&lang=scss\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./textbox.vue?vue&type=style&index=0&id=07f8e3d3&lang=scss&scoped=true\"","<template>\n\t<div\n\t\tv-if=\"visible\"\n\t\t@dragleave=\"visible = false\"\n\t\t@drop=\"drop\"\n\t\t:class=\"{ vertical: vertical }\"\n\t>\n\t\t<slot />\n\t</div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tdata: () => ({\n\t\tvisible: false,\n\t}),\n\tmethods: {\n\t\tshow(): void {\n\t\t\tthis.visible = true;\n\t\t},\n\t\thide(): void {\n\t\t\tthis.visible = false;\n\t\t},\n\t\tdrop(e: DragEvent): void {\n\t\t\tthis.hide();\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (!e.dataTransfer) return;\n\n\t\t\tfor (const item of e.dataTransfer.items) {\n\t\t\t\tif (item.kind === 'file' && item.type.match(/image.*/)) {\n\t\t\t\t\tthis.$emit('drop', item.getAsFile());\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n});\n</script>\n<style lang=\"scss\" scoped>\ndiv {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground: rgba(50, 50, 50, 0.75);\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tcolor: $default-native-background;\n\tcolor: var(--native-background);\n\ttext-shadow: 0 0 4px #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000,\n\t\t1px 1px 0 #000;\n\tfont-size: 24px;\n\tfont-family: riffic, sans-serif;\n}\n</style>\n","\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tdata: () => ({\n\t\tvisible: false,\n\t}),\n\tmethods: {\n\t\tshow(): void {\n\t\t\tthis.visible = true;\n\t\t},\n\t\thide(): void {\n\t\t\tthis.visible = false;\n\t\t},\n\t\tdrop(e: DragEvent): void {\n\t\t\tthis.hide();\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (!e.dataTransfer) return;\n\n\t\t\tfor (const item of e.dataTransfer.items) {\n\t\t\t\tif (item.kind === 'file' && item.type.match(/image.*/)) {\n\t\t\t\t\tthis.$emit('drop', item.getAsFile());\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n});\n","import { render } from \"./drop-target.vue?vue&type=template&id=0c92f421&scoped=true\"\nimport script from \"./drop-target.vue?vue&type=script&lang=ts\"\nexport * from \"./drop-target.vue?vue&type=script&lang=ts\"\n\nimport \"./drop-target.vue?vue&type=style&index=0&id=0c92f421&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-0c92f421\"\n\nexport default script","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./character.vue?vue&type=style&index=0&id=47403597&lang=scss&scoped=true\"","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./partButton.vue?vue&type=style&index=0&id=7d67a652&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./poem.vue?vue&type=style&index=0&id=2a8686c0&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./content-pack.vue?vue&type=style&index=0&id=714ad0fa&lang=scss&scoped=true\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./drop-target.vue?vue&type=style&index=0&id=0c92f421&lang=scss&scoped=true\"","import { RenderContext } from './rendererContext';\nimport { RenderAbortedException } from './renderAbortedException';\nimport environment from '@/environments/environment';\nimport { screenWidth, screenHeight } from '@/constants/base';\n\nexport class Renderer {\n\tprivate previewCanvas: HTMLCanvasElement;\n\tprivate runningContext: RenderContext | null = null;\n\n\tpublic constructor(w: number = screenWidth, h: number = screenHeight) {\n\t\tthis.previewCanvas = document.createElement('canvas');\n\t\tthis.previewCanvas.width = w;\n\t\tthis.previewCanvas.height = h;\n\t}\n\n\tpublic async render(\n\t\trenderCallback: (rc: RenderContext) => Promise<void>,\n\t\thq: boolean = true,\n\t\tpreview: boolean = true\n\t): Promise<boolean> {\n\t\tif (this.runningContext) {\n\t\t\tthis.runningContext.abort();\n\t\t}\n\n\t\tconst ctx = this.previewCanvas.getContext('2d')!;\n\t\tctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n\t\tconst context = (this.runningContext = RenderContext.makeWithContext(\n\t\t\tthis.previewCanvas,\n\t\t\tctx,\n\t\t\thq,\n\t\t\tpreview\n\t\t));\n\t\ttry {\n\t\t\tawait renderCallback(this.runningContext);\n\t\t} catch (e) {\n\t\t\tif (e instanceof RenderAbortedException) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthrow e;\n\t\t} finally {\n\t\t\tif (context === this.runningContext) {\n\t\t\t\tthis.runningContext = null;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic get width(): number {\n\t\treturn this.previewCanvas.width;\n\t}\n\n\tpublic get height(): number {\n\t\treturn this.previewCanvas.height;\n\t}\n\n\tpublic paintOnto(\n\t\tc: CanvasRenderingContext2D,\n\t\topts: { x: number; y: number; w?: number; h?: number }\n\t) {\n\t\tif (opts.w && opts.h) {\n\t\t\tc.drawImage(this.previewCanvas, opts.x, opts.y, opts.w, opts.h);\n\t\t} else {\n\t\t\tc.drawImage(this.previewCanvas, opts.x, opts.y);\n\t\t}\n\t}\n\n\tpublic async download(\n\t\trenderCallback: (rc: RenderContext) => Promise<void>,\n\t\tfilename: string\n\t): Promise<string> {\n\t\tconst downloadCanvas = document.createElement('canvas');\n\t\tdownloadCanvas.width = this.previewCanvas.width;\n\t\tdownloadCanvas.height = this.previewCanvas.height;\n\n\t\tconst ctx = downloadCanvas.getContext('2d')!;\n\t\tctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n\t\tawait renderCallback(\n\t\t\tRenderContext.makeWithContext(downloadCanvas, ctx, true, false)\n\t\t);\n\n\t\treturn environment.saveToFile(downloadCanvas, filename);\n\t}\n\n\tpublic async renderToBlob(\n\t\trenderCallback: (rc: RenderContext) => Promise<void>\n\t): Promise<Blob> {\n\t\tconst downloadCanvas = document.createElement('canvas');\n\t\tdownloadCanvas.width = this.previewCanvas.width;\n\t\tdownloadCanvas.height = this.previewCanvas.height;\n\n\t\tconst ctx = downloadCanvas.getContext('2d')!;\n\t\tctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n\t\tawait renderCallback(\n\t\t\tRenderContext.makeWithContext(downloadCanvas, ctx, true, false)\n\t\t);\n\t\treturn await new Promise<Blob>((resolve, reject) => {\n\t\t\tdownloadCanvas.toBlob(blob => {\n\t\t\t\tif (blob) resolve(blob);\n\t\t\t\telse reject();\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic getDataAt(x: number, y: number): Uint8ClampedArray {\n\t\tconst ctx = this.previewCanvas.getContext('2d');\n\n\t\treturn ctx!.getImageData(x, y, 1, 1).data;\n\t}\n}\n","// tslint:disable: no-magic-numbers\nexport const screenWidth = 1280;\nexport const screenHeight = 720;\n\nexport const positions = [\n\t'4-1',\n\t'3-1',\n\t'2-1',\n\t'4-2',\n\t'center',\n\t'4-3',\n\t'2-2',\n\t'3-3',\n\t'4-4',\n];\n\nexport const characterPositions = [\n\t200,\n\t240,\n\t400,\n\t493,\n\t640,\n\t786,\n\t880,\n\t1040,\n\t1080,\n];\n"],"sourceRoot":""}