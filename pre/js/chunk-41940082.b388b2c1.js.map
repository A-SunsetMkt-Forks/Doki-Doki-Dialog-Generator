{"version":3,"sources":["webpack:///./src/components/content-pack-builder/expression-builder/index.vue?df84","webpack:///./src/components/content-pack-builder/expression-builder/selection.vue?3317","webpack:///./src/components/content-pack-builder/expression-builder/selector.vue?66dc","webpack:///./src/components/content-pack-builder/expression-builder/index.vue?acaf","webpack:///./src/components/content-pack-builder/expression-builder/selection.vue?c1ed","webpack:///./src/components/content-pack-builder/expression-builder/selection.vue?84b1","webpack:///./src/components/content-pack-builder/expression-builder/selection.vue?22dc","webpack:///./src/components/content-pack-builder/expression-builder/selection.vue","webpack:///./src/components/content-pack-builder/expression-builder/selector.vue?fec6","webpack:///./src/components/content-pack-builder/expression-builder/selector.vue?ed73","webpack:///./src/components/content-pack-builder/expression-builder/selector.vue?434c","webpack:///./src/components/content-pack-builder/expression-builder/selector.vue","webpack:///./src/util/workBatch/internalState.ts","webpack:///./src/util/workBatch/index.ts","webpack:///./src/components/content-pack-builder/expression-builder/index.vue?4014","webpack:///./src/components/content-pack-builder/expression-builder/index.vue?953b","webpack:///./src/components/content-pack-builder/expression-builder/index.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","on","dragEnter","hideDt","_v","headGroup","method","uploadsFinished","_s","Math","round","batchRunner","percentage","normalizeName","name","attrs","downloadLink","_e","listLink","ref","addByImageFile","$event","verticalScrollRedirect","$refs","upload","click","addByUpload","addByUrl","_l","expression","idx","key","class","expression_item","active","currentUploadedExpression","style","backgroundImage","previewPoses","previewPoseIdx","width","height","directives","rawName","value","$$selectedVal","Array","prototype","filter","call","target","options","o","selected","map","val","_value","multiple","pose","domProps","modifiers","composing","offsetX","_n","$forceUpdate","offsetY","imagePatching","mask","model","callback","$$v","addMask","addition","addExtras","removeUploadedExpression","finishUpload","leave","hasParts","headgroup","preview","staticRenderFns","background","stopPropagation","$emit","icon","label","images","i","join","default","components","component","_t","busy","error","completed","fullCount","runner","disposer","parallel","state","pendingData","currentlyRunning","Set","resolveCurrentRun","rejectCurrentRun","returnData","remainingDisposers","runningDisposers","newData","reject","slice","length","Promise","resolve","restock","remainingCapacity","startOne","size","startDisposer","data","shift","undefined","add","isRunning","has","ret","delete","values","next","reset","e","message","uploadedExpressionsPack","packId","dependencies","packCredits","characters","fonts","sprites","poemStyles","poemBackgrounds","backgrounds","colors","masks","adds","baseUrl","listPaths","partFiles","everythingBroken","uploadedExpressions","processExpression","bind","asset","window","exp","initHeadGroup","availableHeadGroups","find","group","applySingleHeadGroup","uploadInput","files","file","url","URL","createObjectURL","addUrl","environment","prompt","push","renderer","renderToBlob","rx","drawImage","image","x","y","w","h","composite","blob","finalExpression","startsWith","revokeObjectURL","charDefDefaults","poseId","posePositions","head","indexOf","temporaryCharacterModel","charRenderer","$nextTick","ctx","getContext","clearRect","paintOnto","run","processedExpressions","storeCharacter","$store","content","current","char","id","character","heads","styleGroups","chibi","storeHeadGroup","previewSize","previewOffset","variants","processedExpression","vuexHistory","transaction","dispatch","contentPack","splice","parts","split","actualName","trim","toUpperCase","toLowerCase","dataTransfer","effectAllowed","from","items","item","type","match","dt","show","hide","characterData","headTypes","Object","keys","headTypeKey","headType","lq","partsFiles","hq","charName","headGroupName","poses","styleGroupIdx","styleGroup","styleIdx","styles","poseIdx","compatibleHeads","includes","styleGroupId","styleId","sourcePack","expressionModels","styleComponents","renderCommands","headIdx","findIndex","command","headRenderCommand","newHeadCommand","offset","nr","Selection","Selector","ToggleBox","DropTarget","characterType","freeMove","close","panelId","preserveRatio","ratio","opacity","version","flip","onTop"],"mappings":"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","file":"js/chunk-41940082.b388b2c1.js","sourcesContent":["import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=2622fa43&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=2622fa43&lang=scss&scoped=true&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection.vue?vue&type=style&index=0&id=055af9e0&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection.vue?vue&type=style&index=0&id=055af9e0&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selector.vue?vue&type=style&index=0&id=0b6e2f14&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selector.vue?vue&type=style&index=0&id=0b6e2f14&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"wrapper\",on:{\"dragenter\":_vm.dragEnter,\"mouseleave\":_vm.hideDt}},[_c('h1',[_vm._v(\"Add expressions\")]),(!_vm.headGroup)?_c('selector',{attrs:{\"label\":\"What kind of expression would you like to add?\"}},_vm._l((_vm.availableHeadGroups),function(headgroup){return _c('selection',{key:headgroup.name,attrs:{\"label\":_vm.normalizeName(headgroup.name),\"images\":headgroup.preview},on:{\"selected\":function($event){_vm.headGroup = headgroup}}})}),1):(!_vm.method)?_c('selector',{attrs:{\"label\":\"How would you like to add the new expressions?\"}},[_c('selection',{attrs:{\"label\":\"Build expressions from parts\",\"icon\":\"info\",\"disabled\":_vm.hasParts},on:{\"selected\":function($event){_vm.method = 'parts'}}}),_c('selection',{attrs:{\"label\":\"Upload expression images\",\"icon\":\"info\"},on:{\"selected\":function($event){_vm.method = 'upload'}}})],1):(_vm.method === 'upload')?[(!_vm.uploadsFinished)?_c('div',{staticClass:\"page\"},[_c('h2',[_vm._v(\" Upload new '\"+_vm._s(_vm.normalizeName(_vm.headGroup.name))+\"' expressions \"),(_vm.downloadLink)?_c('a',{attrs:{\"href\":_vm.downloadLink,\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"(Template)\")]):_vm._e(),(_vm.listLink)?_c('a',{attrs:{\"href\":_vm.listLink,\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"(List)\")]):_vm._e()]),_c('drop-target',{ref:\"dt\",staticClass:\"drop-target\",on:{\"drop\":_vm.addByImageFile}},[_vm._v(\"Drop here to add as a new expression\")]),_c('div',{staticClass:\"expression_list_wrapper\"},[_c('div',{staticClass:\"expression_list\",on:{\"&wheel\":function($event){return _vm.verticalScrollRedirect($event)}}},[_c('button',{on:{\"click\":function($event){return _vm.$refs.upload.click()}}},[_vm._v(\" Upload expression \"),_c('input',{ref:\"upload\",attrs:{\"type\":\"file\",\"multiple\":\"\"},on:{\"change\":_vm.addByUpload}})]),_c('button',{on:{\"click\":_vm.addByUrl}},[_vm._v(\"Add expression from URL\")]),_vm._l((_vm.uploadedExpressions),function(expression,idx){return _c('div',{key:idx,class:{\n\t\t\t\t\t\t\texpression_item: true,\n\t\t\t\t\t\t\tactive: _vm.currentUploadedExpression === expression,\n\t\t\t\t\t\t},style:({ backgroundImage: (\"url('\" + expression + \"')\") }),on:{\"click\":function($event){_vm.currentUploadedExpression = expression}}})})],2),_c('div',{staticClass:\"options_wrapper\"},[_c('div',{staticClass:\"image\"},[_c('canvas',{ref:\"target\",attrs:{\"width\":_vm.previewPoses[_vm.previewPoseIdx].width,\"height\":_vm.previewPoses[_vm.previewPoseIdx].height}})]),_c('div',[_vm._v(\" Preview pose: \"),_c('select',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.previewPoseIdx),expression:\"previewPoseIdx\"}],on:{\"change\":function($event){var $$selectedVal = Array.prototype.filter.call($event.target.options,function(o){return o.selected}).map(function(o){var val = \"_value\" in o ? o._value : o.value;return val}); _vm.previewPoseIdx=$event.target.multiple ? $$selectedVal : $$selectedVal[0]}}},_vm._l((_vm.previewPoses),function(pose,idx){return _c('option',{key:idx,domProps:{\"value\":idx}},[_vm._v(_vm._s(_vm.normalizeName(pose.name)))])}),0),_c('fieldset',[_c('legend',[_vm._v(\"Offset\")]),_c('table',[_c('tr',[_c('th',[_vm._v(\"X:\")]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.offsetX),expression:\"offsetX\",modifiers:{\"number\":true}}],attrs:{\"type\":\"number\"},domProps:{\"value\":(_vm.offsetX)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.offsetX=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})]),_c('th',[_vm._v(\"Y:\")]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.offsetY),expression:\"offsetY\",modifiers:{\"number\":true}}],attrs:{\"type\":\"number\"},domProps:{\"value\":(_vm.offsetY)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.offsetY=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})])])])]),(_vm.headGroup.imagePatching && _vm.headGroup.imagePatching.mask)?_c('toggle-box',{attrs:{\"label\":\"Reduce to fit DDDG standard\"},model:{value:(_vm.addMask),callback:function ($$v) {_vm.addMask=$$v},expression:\"addMask\"}}):_vm._e(),(\n\t\t\t\t\t\t\t\t_vm.headGroup.imagePatching && _vm.headGroup.imagePatching.addition\n\t\t\t\t\t\t\t)?_c('toggle-box',{attrs:{\"label\":\"Add new parts to fit DDDG standard\"},model:{value:(_vm.addExtras),callback:function ($$v) {_vm.addExtras=$$v},expression:\"addExtras\"}}):_vm._e(),_c('button',{attrs:{\"disabled\":_vm.currentUploadedExpression === null},on:{\"click\":_vm.removeUploadedExpression}},[_vm._v(\" Remove this expression \")]),_c('button',{on:{\"click\":_vm.finishUpload}},[_vm._v(\"Finish\")]),_c('button',{on:{\"click\":_vm.leave}},[_vm._v(\"Abort\")])],1)])])],1):_c('div',[_c('h2',[_vm._v(\" Finishing up images. \"+_vm._s(Math.round(_vm.batchRunner.percentage * 100))+\"% \")])])]:_vm._e()],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"selection\",style:({ background: _vm.background }),on:{\"click\":function($event){$event.stopPropagation();return _vm.$emit('selected')}}},[_c('div',{staticClass:\"icon material-icons\"},[_vm._v(_vm._s(_vm.icon))]),_c('div',{staticClass:\"label\"},[_vm._v(_vm._s(_vm.label))])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\r\n// App.vue has currently so many responsiblities that it's best to break it into chunks\r\nimport { Component, Vue, Prop } from 'vue-property-decorator';\r\n\r\n@Component({\r\n\tcomponents: {},\r\n})\r\nexport default class Selection extends Vue {\r\n\t@Prop() private icon!: string;\r\n\t@Prop() private label!: string;\r\n\t@Prop({ default: [] }) private images!: string[];\r\n\r\n\tpublic get background(): string {\r\n\t\treturn this.images\r\n\t\t\t.map(i => `center / contain no-repeat url('${i}')`)\r\n\t\t\t.join(',');\r\n\t}\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--13-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--13-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./selection.vue?vue&type=template&id=055af9e0&scoped=true&\"\nimport script from \"./selection.vue?vue&type=script&lang=ts&\"\nexport * from \"./selection.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./selection.vue?vue&type=style&index=0&id=055af9e0&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"055af9e0\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"selector\"},[_vm._t(\"default\")],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\r\n// App.vue has currently so many responsiblities that it's best to break it into chunks\r\nimport { Component, Vue } from 'vue-property-decorator';\r\n\r\n@Component({\r\n\tcomponents: {},\r\n})\r\nexport default class Selector extends Vue {}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--13-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selector.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--13-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selector.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./selector.vue?vue&type=template&id=0b6e2f14&scoped=true&\"\nimport script from \"./selector.vue?vue&type=script&lang=ts&\"\nexport * from \"./selector.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./selector.vue?vue&type=style&index=0&id=0b6e2f14&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0b6e2f14\",\n  null\n  \n)\n\nexport default component.exports","import { Component, Vue } from 'vue-property-decorator';\r\n\r\n@Component({})\r\nexport class InternalState extends Vue {\r\n\tpublic busy: boolean = false;\r\n\tpublic error: string | null = null;\r\n\tpublic completed = 0;\r\n\tpublic fullCount = 0;\r\n}\r\n","import { Vue } from 'vue-property-decorator';\r\nimport { InternalState } from './internalState';\r\n\r\ntype Runner<P, R> = (\r\n\tpayload: P,\r\n\tisRunning: () => boolean\r\n) => Promise<R | undefined>;\r\n\r\ntype Disposer<R> = (payload: R) => Promise<void>;\r\n\r\nexport class WorkBatch<P, R> {\r\n\tprivate state = new Vue(InternalState) as InternalState;\r\n\tprivate pendingData: P[] = [];\r\n\tprivate currentlyRunning = new Set<P>();\r\n\tprivate resolveCurrentRun:\r\n\t\t| null\r\n\t\t| ((data: Array<R | undefined>) => void) = null;\r\n\tprivate rejectCurrentRun: null | (() => void) = null;\r\n\tprivate returnData: Array<R | undefined> = [];\r\n\r\n\tprivate remainingDisposers: Set<R> = new Set<R>();\r\n\tprivate runningDisposers: Set<R> = new Set<R>();\r\n\r\n\tpublic constructor(\r\n\t\tprivate readonly runner: Runner<P, R>,\r\n\t\tprivate readonly disposer: Disposer<R>,\r\n\t\tprivate readonly parallel = 4\r\n\t) {}\r\n\r\n\tpublic run(newData: P[]): Promise<Array<R | undefined>> {\r\n\t\tif (this.rejectCurrentRun) {\r\n\t\t\tthis.reject();\r\n\t\t}\r\n\t\tnewData = newData.slice();\r\n\t\tthis.pendingData = newData;\r\n\t\tthis.returnData = [];\r\n\t\tthis.state.fullCount = newData.length;\r\n\t\tthis.state.error = null;\r\n\t\tthis.state.busy = true;\r\n\t\tthis.state.completed = 0;\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.resolveCurrentRun = resolve;\r\n\t\t\tthis.rejectCurrentRun = reject;\r\n\t\t\tif (newData.length > 0) {\r\n\t\t\t\tthis.restock();\r\n\t\t\t} else {\r\n\t\t\t\tthis.resolve();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate get remainingCapacity() {\r\n\t\treturn (\r\n\t\t\tthis.parallel - this.currentlyRunning.size - this.runningDisposers.size\r\n\t\t);\r\n\t}\r\n\r\n\tprivate restock() {\r\n\t\twhile (this.remainingCapacity > 0 && this.pendingData.length > 0) {\r\n\t\t\tthis.startOne();\r\n\t\t}\r\n\t\twhile (this.remainingCapacity > 0 && this.remainingDisposers.size > 0) {\r\n\t\t\tthis.startDisposer();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async startOne() {\r\n\t\tconst data = this.pendingData.shift();\r\n\t\tconst idx = this.returnData.length;\r\n\t\tthis.returnData[idx] = undefined;\r\n\t\tif (!data) return;\r\n\t\tthis.currentlyRunning.add(data);\r\n\t\tconst isRunning = () => this.currentlyRunning.has(data);\r\n\t\tlet ret: R | undefined;\r\n\t\ttry {\r\n\t\t\tret = await this.runner(data, isRunning);\r\n\t\t} catch (e) {\r\n\t\t\tthis.reject(e);\r\n\t\t}\r\n\t\tif (isRunning()) {\r\n\t\t\t++this.state.completed;\r\n\t\t\tthis.returnData[idx] = ret;\r\n\t\t\tthis.currentlyRunning.delete(data);\r\n\t\t\tif (this.currentlyRunning.size === 0 && this.pendingData.length === 0) {\r\n\t\t\t\tthis.resolve();\r\n\t\t\t}\r\n\t\t} else if (ret !== undefined) {\r\n\t\t\tthis.remainingDisposers.add(ret);\r\n\t\t}\r\n\t\tthis.restock();\r\n\t}\r\n\r\n\tprivate async startDisposer() {\r\n\t\tconst data = this.remainingDisposers.values().next().value;\r\n\t\tthis.remainingDisposers.delete(data);\r\n\t\tthis.runningDisposers.add(data);\r\n\t\ttry {\r\n\t\t\tawait this.disposer(data);\r\n\t\t} catch (e) {}\r\n\t\tthis.runningDisposers.delete(data);\r\n\t\tthis.restock();\r\n\t}\r\n\r\n\tprivate resolve() {\r\n\t\tthis.state.busy = false;\r\n\t\t// Just to be sure\r\n\t\tthis.state.completed = this.state.fullCount;\r\n\t\tconst returnData = this.returnData;\r\n\t\tconst resolveCurrentRun = this.resolveCurrentRun!;\r\n\t\tthis.reset();\r\n\t\tresolveCurrentRun(returnData);\r\n\t}\r\n\r\n\tprivate reject(e?: Error) {\r\n\t\tthis.state.busy = false;\r\n\t\tthis.state.error = e?.message || null;\r\n\t\tconst returnData = this.returnData;\r\n\t\tconst rejectCurrentRun = this.rejectCurrentRun!;\r\n\t\tthis.reset();\r\n\t\tfor (const data of returnData) {\r\n\t\t\tif (data !== undefined) this.remainingDisposers.add(data);\r\n\t\t}\r\n\t\trejectCurrentRun();\r\n\t}\r\n\r\n\tprivate reset() {\r\n\t\tthis.returnData = [];\r\n\t\tthis.currentlyRunning = new Set<P>();\r\n\t\tthis.resolveCurrentRun = null;\r\n\t\tthis.rejectCurrentRun = null;\r\n\t}\r\n\r\n\tpublic get busy(): boolean {\r\n\t\treturn this.state.busy;\r\n\t}\r\n\r\n\tpublic get fullCount(): number {\r\n\t\treturn this.state.fullCount;\r\n\t}\r\n\r\n\tpublic get completed(): number {\r\n\t\treturn this.state.completed;\r\n\t}\r\n\r\n\tpublic get percentage(): number {\r\n\t\tif (this.fullCount === 0) return 0;\r\n\t\treturn this.completed / this.fullCount;\r\n\t}\r\n\r\n\tpublic get error(): string | null {\r\n\t\treturn this.state.error;\r\n\t}\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n// App.vue has currently so many responsiblities that it's best to break it into chunks\r\nimport { Component, Vue, Prop, Watch, Mixins } from 'vue-property-decorator';\r\nimport Selection from './selection.vue';\r\nimport Selector from './selector.vue';\r\nimport DropTarget from '../../toolbox/drop-target.vue';\r\nimport ToggleBox from '@/components/toggle.vue';\r\nimport { Store } from 'vuex';\r\nimport { IRootState } from '@/store';\r\nimport environment from '@/environments/environment';\r\nimport { VerticalScrollRedirect } from '@/components/vertical-scroll-redirect';\r\nimport { Character } from '../../../renderables/character';\r\nimport {\r\n\tContentPack,\r\n\tCharacter as CharacterModel,\r\n\tPose,\r\n\tIHeadCommand,\r\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\r\nimport { IAsset, ReplaceContentPackAction } from '../../../store/content';\r\nimport { getAssetByUrl } from '../../../asset-manager';\r\nimport { Renderer } from '../../../renderer/renderer';\r\nimport { WorkBatch } from '../../../util/workBatch';\r\nimport { IHistorySupport } from '../../../plugins/vuex-history';\r\n\r\nconst uploadedExpressionsPack: ContentPack<string> = {\r\n\tpackId: 'dddg.buildin.uploadedExpressions',\r\n\tdependencies: [],\r\n\tpackCredits: [],\r\n\tcharacters: [],\r\n\tfonts: [],\r\n\tsprites: [],\r\n\tpoemStyles: [],\r\n\tpoemBackgrounds: [],\r\n\tbackgrounds: [],\r\n\tcolors: [],\r\n};\r\n\r\nconst masks: { [s: string]: string | undefined } = {\r\n\t'dddg.buildin.base.monika:straight': 'assets/mask/monika-a-mask.png',\r\n\t'dddg.buildin.base.monika:sideways': 'assets/mask/monika-b-mask.png',\r\n\t'dddg.buildin.base.natsuki:straight': 'assets/mask/natsuki-a-mask.png',\r\n\t'dddg.buildin.base.natsuki:sideways': 'assets/mask/natsuki-b-mask.png',\r\n\t'dddg.buildin.base.natsuki:turnedAway': 'assets/mask/natsuki-c-mask.png',\r\n\t'dddg.buildin.base.sayori:straight': 'assets/mask/sayori-a-mask.png',\r\n\t'dddg.buildin.base.sayori:sideways': 'assets/mask/sayori-b-mask.png',\r\n\t'dddg.buildin.base.yuri:straight': 'assets/mask/yuri-a-mask.png',\r\n\t'dddg.buildin.base.yuri:sideways': 'assets/mask/yuri-b-mask.png',\r\n};\r\n\r\nconst adds: { [s: string]: string | undefined } = {\r\n\t'dddg.buildin.base.natsuki:straight': 'assets/mask/natsuki-a-add.png',\r\n};\r\n\r\nconst baseUrl =\r\n\t'https://github.com/edave64/Doki-Doki-Dialog-Generator/tree/master/public/assets/';\r\n\r\nconst listPaths: { [s: string]: string | undefined } = {\r\n\t'dddg.buildin.base.monika:ddlc.monika': `${baseUrl}monika`,\r\n\t'dddg.buildin.base.natsuki:ddlc.natsuki': `${baseUrl}natsuki`,\r\n\t'dddg.buildin.base.sayori:ddlc.sayori': `${baseUrl}sayori`,\r\n\t'dddg.buildin.base.yuri:ddlc.yuri': `${baseUrl}yuri`,\r\n\t'dddg.buildin.amy1:ddlc.fan.amy1': `${baseUrl}classic_amy`,\r\n\t'dddg.buildin.amy2:ddlc.fan.amy2': `${baseUrl}amy`,\r\n\t'dddg.buildin.femc:ddlc.fan.femc': `${baseUrl}femc`,\r\n\t'dddg.buildin.femc:ddlc.fan.femc:straight_lh': `${baseUrl}femc_lh`,\r\n\t'dddg.buildin.femc:ddlc.fan.femc:straight_hetero': `${baseUrl}femc/hetero`,\r\n\t'dddg.buildin.femc:ddlc.fan.femc:straight_hetero_lh': `${baseUrl}femc_lh/hetero`,\r\n\t'dddg.buildin.mc_classic:ddlc.fan.mc1': `${baseUrl}classic_mc`,\r\n\t'dddg.buildin.mc:ddlc.fan.mc2': `${baseUrl}mc`,\r\n\t'dddg.buildin.mc:ddlc.fan.mc2:straight_red': `${baseUrl}mc/red`,\r\n\t'dddg.buildin.mc_chad:ddlc.fan.mc_chad': `${baseUrl}chad`,\r\n\t'dddg.buildin.mc_chad:ddlc.fan.mc_chad:straight_red': `${baseUrl}chad/red`,\r\n};\r\n\r\nconst partFiles: { [s: string]: string[] | undefined } = {};\r\n\r\n@Component({\r\n\tcomponents: { Selection, Selector, ToggleBox, DropTarget },\r\n})\r\nexport default class ExpressionBuilder extends Mixins(VerticalScrollRedirect) {\r\n\tprivate static nr = 0;\r\n\r\n\t@Prop() public readonly character!: string;\r\n\t@Prop() public readonly initHeadGroup!: string | undefined;\r\n\tpublic $store!: Store<IRootState>;\r\n\r\n\tpublic method: null | 'upload' | 'parts' = 'upload';\r\n\tpublic headGroup: null | IHeadGroup = null;\r\n\tpublic uploadsFinished = false;\r\n\tpublic everythingBroken = false;\r\n\tpublic uploadedExpressions: string[] = [];\r\n\tpublic currentUploadedExpression: string | null = null;\r\n\tpublic previewPoseIdx: number = 0;\r\n\tpublic offsetX: number = 0;\r\n\tpublic offsetY: number = 0;\r\n\r\n\tpublic addMask = false;\r\n\tpublic addExtras = false;\r\n\tprivate vuexHistory!: IHistorySupport;\r\n\r\n\tprivate batchRunner = new WorkBatch<string, string>(\r\n\t\tthis.processExpression.bind(this),\r\n\t\tasync asset => {}\r\n\t);\r\n\r\n\tpublic created() {\r\n\t\t(window as any).exp = this;\r\n\t\tif (this.initHeadGroup) {\r\n\t\t\tthis.headGroup = this.availableHeadGroups.find(\r\n\t\t\t\tgroup => group.name === this.initHeadGroup\r\n\t\t\t)!;\r\n\t\t}\r\n\t\tthis.applySingleHeadGroup();\r\n\t}\r\n\r\n\tpublic get characterData(): CharacterModel<IAsset> {\r\n\t\treturn this.$store.state.content.current.characters.find(\r\n\t\t\tchar => char.id === this.character\r\n\t\t)!;\r\n\t}\r\n\r\n\tpublic get availableHeadGroups(): IHeadGroup[] {\r\n\t\tconst characterData = this.characterData;\r\n\t\tconst headTypes = Object.keys(characterData.heads);\r\n\t\treturn headTypes.map(headTypeKey => {\r\n\t\t\tconst headType = characterData.heads[headTypeKey];\r\n\r\n\t\t\treturn {\r\n\t\t\t\tname: headTypeKey,\r\n\t\t\t\tpreview: headType.variants[0].map(asset => asset.lq),\r\n\t\t\t\tpartsFiles: partFiles[headTypeKey] || [],\r\n\t\t\t\timagePatching: {\r\n\t\t\t\t\tmask: masks[headTypeKey],\r\n\t\t\t\t\taddition: adds[headTypeKey],\r\n\t\t\t\t},\r\n\t\t\t} as IHeadGroup;\r\n\t\t});\r\n\t}\r\n\r\n\t@Watch('availableHeadGroups')\r\n\tpublic applySingleHeadGroup() {\r\n\t\tif (this.availableHeadGroups.length === 1) {\r\n\t\t\tthis.headGroup = this.availableHeadGroups[0];\r\n\t\t}\r\n\t}\r\n\r\n\tpublic get hasParts(): boolean {\r\n\t\treturn !!this.availableHeadGroups.find(\r\n\t\t\theadGroup => headGroup.partsFiles.length > 0\r\n\t\t);\r\n\t}\r\n\r\n\tpublic async addByUpload(): Promise<void> {\r\n\t\tconst uploadInput = this.$refs.upload as HTMLInputElement;\r\n\t\tif (!uploadInput.files) return;\r\n\t\tfor (const file of uploadInput.files) {\r\n\t\t\tthis.addByImageFile(file);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic addByImageFile(file: File) {\r\n\t\tconst url = URL.createObjectURL(file);\r\n\t\tthis.addUrl(url);\r\n\t}\r\n\r\n\tpublic async addByUrl(): Promise<void> {\r\n\t\tconst url = await environment.prompt('Enter the url of the image.', '');\r\n\t\tif (!url) return;\r\n\t\tthis.addUrl(url);\r\n\t}\r\n\r\n\tpublic addUrl(url: string): void {\r\n\t\tthis.currentUploadedExpression = url;\r\n\t\tthis.uploadedExpressions.push(url);\r\n\t}\r\n\r\n\tpublic get downloadLink(): string | null {\r\n\t\tconst character = this.characterData;\r\n\t\tif (!character || !this.headGroup) return null;\r\n\t\tconst headType = character.heads[this.headGroup!.name];\r\n\t\tif (!headType) return null;\r\n\t\treturn headType.variants[0][0].hq;\r\n\t}\r\n\r\n\tpublic get listLink(): string | null {\r\n\t\tif (!this.characterData || !this.headGroup) return null;\r\n\t\tconst charName = this.characterData.id;\r\n\t\tconst headGroupName = this.headGroup.name;\r\n\t\tif (listPaths[charName + ':' + headGroupName]) {\r\n\t\t\treturn listPaths[charName + ':' + headGroupName] || null;\r\n\t\t}\r\n\t\treturn listPaths[charName] || null;\r\n\t}\r\n\r\n\tpublic get previewPoses(): IPose[] {\r\n\t\tconst character = this.characterData;\r\n\t\tif (!character || !this.headGroup) return [];\r\n\t\tconst poses: IPose[] = [];\r\n\r\n\t\tfor (\r\n\t\t\tlet styleGroupIdx = 0;\r\n\t\t\tstyleGroupIdx < character.styleGroups.length;\r\n\t\t\t++styleGroupIdx\r\n\t\t) {\r\n\t\t\tconst styleGroup = character.styleGroups[styleGroupIdx];\r\n\t\t\tfor (let styleIdx = 0; styleIdx < styleGroup.styles.length; ++styleIdx) {\r\n\t\t\t\tconst style = styleGroup.styles[styleIdx];\r\n\t\t\t\tfor (let poseIdx = 0; poseIdx < style.poses.length; ++poseIdx) {\r\n\t\t\t\t\tconst pose = style.poses[poseIdx];\r\n\t\t\t\t\tif (pose.compatibleHeads.includes(this.headGroup.name)) {\r\n\t\t\t\t\t\tposes.push({\r\n\t\t\t\t\t\t\tname: pose.id,\r\n\t\t\t\t\t\t\tstyleGroupId: styleGroupIdx,\r\n\t\t\t\t\t\t\tstyleId: styleIdx,\r\n\t\t\t\t\t\t\tposeId: poseIdx,\r\n\t\t\t\t\t\t\twidth: pose.size[0],\r\n\t\t\t\t\t\t\theight: pose.size[1],\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn poses;\r\n\t}\r\n\r\n\tpublic get expressionModels(): IAsset[][] {\r\n\t\treturn this.uploadedExpressions.map(expression => [\r\n\t\t\t{\r\n\t\t\t\thq: expression,\r\n\t\t\t\tlq: expression,\r\n\t\t\t\tsourcePack: 'dddg.temp1:default',\r\n\t\t\t} as IAsset,\r\n\t\t]);\r\n\t}\r\n\r\n\tpublic get temporaryCharacterModel(): CharacterModel<IAsset> {\r\n\t\tconst poses = this.previewPoses;\r\n\t\tconst character = this.$store.state.content.current.characters.find(\r\n\t\t\tchar => char.id === this.character\r\n\t\t)!;\r\n\t\tconst offsetX = this.offsetX;\r\n\t\tconst offsetY = this.offsetY;\r\n\r\n\t\treturn {\r\n\t\t\tid: this.character,\r\n\t\t\theads: {\r\n\t\t\t\t'dddg.temp1:default': {\r\n\t\t\t\t\tvariants: this.expressionModels,\r\n\t\t\t\t\tpreviewSize: [0, 0],\r\n\t\t\t\t\tpreviewOffset: [0, 0],\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tstyleGroups: [\r\n\t\t\t\t{\r\n\t\t\t\t\tid: 'preview',\r\n\t\t\t\t\tstyleComponents: [],\r\n\t\t\t\t\tstyles: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcomponents: {},\r\n\t\t\t\t\t\t\tposes: poses.map((pose, idx) => {\r\n\t\t\t\t\t\t\t\tconst styleGroup = character.styleGroups[pose.styleGroupId];\r\n\t\t\t\t\t\t\t\tconst style = styleGroup.styles[pose.styleId];\r\n\t\t\t\t\t\t\t\tconst renderCommands = style.poses[\r\n\t\t\t\t\t\t\t\t\tpose.poseId\r\n\t\t\t\t\t\t\t\t].renderCommands.slice(0);\r\n\t\t\t\t\t\t\t\tlet headIdx = renderCommands.findIndex(\r\n\t\t\t\t\t\t\t\t\tcommand => command.type === 'head'\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tconst headRenderCommand = renderCommands[headIdx];\r\n\t\t\t\t\t\t\t\tconst newHeadCommand: IHeadCommand = {\r\n\t\t\t\t\t\t\t\t\ttype: 'head',\r\n\t\t\t\t\t\t\t\t\toffset: [\r\n\t\t\t\t\t\t\t\t\t\theadRenderCommand.offset[0] + offsetX,\r\n\t\t\t\t\t\t\t\t\t\theadRenderCommand.offset[1] + offsetY,\r\n\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\tthis.addMask &&\r\n\t\t\t\t\t\t\t\t\tthis.headGroup &&\r\n\t\t\t\t\t\t\t\t\tthis.headGroup.imagePatching &&\r\n\t\t\t\t\t\t\t\t\tthis.headGroup.imagePatching.mask\r\n\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\tconst mask = this.headGroup.imagePatching.mask;\r\n\t\t\t\t\t\t\t\t\trenderCommands.splice(headIdx, 1);\r\n\t\t\t\t\t\t\t\t\theadIdx = 1;\r\n\t\t\t\t\t\t\t\t\trenderCommands.splice(0, 0, newHeadCommand, {\r\n\t\t\t\t\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\t\t\t\t\timages: [\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\thq: mask,\r\n\t\t\t\t\t\t\t\t\t\t\t\tlq: mask,\r\n\t\t\t\t\t\t\t\t\t\t\t\tsourcePack: 'dddg.temp1',\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t\tcomposite: 'destination-in',\r\n\t\t\t\t\t\t\t\t\t\toffset: headRenderCommand.offset,\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\trenderCommands.splice(headIdx, 1, newHeadCommand);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\tthis.addExtras &&\r\n\t\t\t\t\t\t\t\t\tthis.headGroup &&\r\n\t\t\t\t\t\t\t\t\tthis.headGroup.imagePatching &&\r\n\t\t\t\t\t\t\t\t\tthis.headGroup.imagePatching.addition\r\n\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\tconst add = this.headGroup.imagePatching.addition;\r\n\t\t\t\t\t\t\t\t\trenderCommands.splice(headIdx + 1, 0, {\r\n\t\t\t\t\t\t\t\t\t\ttype: 'image',\r\n\t\t\t\t\t\t\t\t\t\timages: [\r\n\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\thq: add,\r\n\t\t\t\t\t\t\t\t\t\t\t\tlq: add,\r\n\t\t\t\t\t\t\t\t\t\t\t\tsourcePack: 'dddg.temp1',\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\t\t\t\toffset: headRenderCommand.offset,\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\t...style.poses[pose.poseId],\r\n\t\t\t\t\t\t\t\t\trenderCommands,\r\n\t\t\t\t\t\t\t\t\tid: 'dddg.temp1:pose' + idx,\r\n\t\t\t\t\t\t\t\t\tcompatibleHeads: ['dddg.temp1:default'],\r\n\t\t\t\t\t\t\t\t} as Pose<IAsset>;\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\tlabel: '',\r\n\t\t\tchibi: null!,\r\n\t\t};\r\n\t}\r\n\r\n\tpublic async processExpression(\r\n\t\texpression: string,\r\n\t\tisRunning: () => boolean\r\n\t): Promise<string | undefined> {\r\n\t\tlet finalExpression: string;\r\n\t\tconst asset = (await getAssetByUrl(expression)) as HTMLImageElement;\r\n\t\tif (!isRunning()) return undefined;\r\n\t\tconst renderer = new Renderer(\r\n\t\t\tasset.width + this.offsetX,\r\n\t\t\tasset.height + this.offsetY\r\n\t\t);\r\n\t\tconst blob = await renderer.renderToBlob(async rx => {\r\n\t\t\trx.drawImage({\r\n\t\t\t\timage: asset,\r\n\t\t\t\tx: this.offsetX,\r\n\t\t\t\ty: this.offsetY,\r\n\t\t\t\tw: asset.width,\r\n\t\t\t\th: asset.height,\r\n\t\t\t});\r\n\r\n\t\t\tif (\r\n\t\t\t\tthis.addMask &&\r\n\t\t\t\tthis.headGroup &&\r\n\t\t\t\tthis.headGroup.imagePatching &&\r\n\t\t\t\tthis.headGroup.imagePatching.mask\r\n\t\t\t) {\r\n\t\t\t\tconst mask = (await getAssetByUrl(\r\n\t\t\t\t\tthis.headGroup.imagePatching.mask\r\n\t\t\t\t)) as HTMLImageElement;\r\n\t\t\t\tif (!isRunning()) return undefined;\r\n\t\t\t\trx.drawImage({\r\n\t\t\t\t\timage: mask,\r\n\t\t\t\t\tx: 0,\r\n\t\t\t\t\ty: 0,\r\n\t\t\t\t\tw: mask.width,\r\n\t\t\t\t\th: mask.height,\r\n\t\t\t\t\tcomposite: 'destination-in',\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\tthis.addExtras &&\r\n\t\t\t\tthis.headGroup &&\r\n\t\t\t\tthis.headGroup.imagePatching &&\r\n\t\t\t\tthis.headGroup.imagePatching.addition\r\n\t\t\t) {\r\n\t\t\t\tconst addition = (await getAssetByUrl(\r\n\t\t\t\t\tthis.headGroup.imagePatching.addition\r\n\t\t\t\t)) as HTMLImageElement;\r\n\t\t\t\tif (!isRunning()) return undefined;\r\n\t\t\t\trx.drawImage({\r\n\t\t\t\t\timage: addition,\r\n\t\t\t\t\tx: 0,\r\n\t\t\t\t\ty: 0,\r\n\t\t\t\t\tw: addition.width,\r\n\t\t\t\t\th: addition.height,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tfinalExpression = URL.createObjectURL(blob);\r\n\r\n\t\tif (expression !== finalExpression && expression.startsWith('blob:')) {\r\n\t\t\tURL.revokeObjectURL(expression);\r\n\t\t}\r\n\r\n\t\treturn finalExpression;\r\n\t}\r\n\r\n\t@Watch('previewPoseIdx')\r\n\t@Watch('previewPoses')\r\n\t@Watch('currentUploadedExpression')\r\n\t@Watch('offsetX')\r\n\t@Watch('offsetY')\r\n\t@Watch('addMask')\r\n\t@Watch('addExtras')\r\n\tpublic async redraw() {\r\n\t\tif (this.uploadsFinished) return;\r\n\t\tconst pose = this.previewPoses[this.previewPoseIdx];\r\n\t\tif (!pose) return;\r\n\t\tlet charRenderer: Character;\r\n\t\ttry {\r\n\t\t\tcharRenderer = new Character(\r\n\t\t\t\t{\r\n\t\t\t\t\t...charDefDefaults,\r\n\t\t\t\t\twidth: pose.width,\r\n\t\t\t\t\theight: pose.height,\r\n\t\t\t\t\tposeId: this.previewPoseIdx,\r\n\t\t\t\t\tx: pose.width / 2,\r\n\t\t\t\t\tposePositions: {\r\n\t\t\t\t\t\theadGroup: 0,\r\n\t\t\t\t\t\thead: this.uploadedExpressions.indexOf(\r\n\t\t\t\t\t\t\tthis.currentUploadedExpression!\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tawait this.temporaryCharacterModel\r\n\t\t\t);\r\n\t\t} catch (e) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.$nextTick(async () => {\r\n\t\t\tif (this.uploadsFinished) return;\r\n\t\t\tconst renderer = new Renderer(pose.width, pose.height);\r\n\t\t\tawait renderer.render(async rx => {\r\n\t\t\t\tawait charRenderer.render(false, rx);\r\n\t\t\t});\r\n\r\n\t\t\tconst target = this.$refs.target as HTMLCanvasElement;\r\n\t\t\tconst ctx = target.getContext('2d')!;\r\n\t\t\tctx.clearRect(0, 0, target.width, target.height);\r\n\t\t\trenderer.paintOnto(ctx, 0, 0, target.width, target.height);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async finishUpload() {\r\n\t\tthis.uploadsFinished = true;\r\n\t\tconst processedExpressions = (\r\n\t\t\tawait this.batchRunner.run(this.uploadedExpressions)\r\n\t\t).filter(exp => exp) as string[];\r\n\r\n\t\tconst storeCharacter = this.$store.state.content.current.characters.find(\r\n\t\t\tchar => char.id === this.character\r\n\t\t)!;\r\n\t\tlet character = uploadedExpressionsPack.characters.find(\r\n\t\t\tchar => char.id === this.character\r\n\t\t);\r\n\t\tif (!character) {\r\n\t\t\tcharacter = {\r\n\t\t\t\tid: this.character,\r\n\t\t\t\theads: {},\r\n\t\t\t\tstyleGroups: [],\r\n\t\t\t\tlabel: '',\r\n\t\t\t\tchibi: '',\r\n\t\t\t} as CharacterModel<string>;\r\n\t\t\tuploadedExpressionsPack.characters.push(character);\r\n\t\t}\r\n\r\n\t\tlet headGroup = character.heads[this.headGroup!.name];\r\n\t\tconst storeHeadGroup = storeCharacter.heads[this.headGroup!.name];\r\n\t\tif (!headGroup) {\r\n\t\t\theadGroup = {\r\n\t\t\t\tpreviewSize: storeHeadGroup.previewSize,\r\n\t\t\t\tpreviewOffset: storeHeadGroup.previewOffset,\r\n\t\t\t\tvariants: [],\r\n\t\t\t};\r\n\t\t\tcharacter.heads[this.headGroup!.name] = headGroup;\r\n\t\t}\r\n\r\n\t\tfor (const processedExpression of processedExpressions) {\r\n\t\t\theadGroup.variants.push([processedExpression]);\r\n\t\t}\r\n\r\n\t\tawait this.vuexHistory.transaction(() => {\r\n\t\t\tthis.$store.dispatch('content/replaceContentPack', {\r\n\t\t\t\tcontentPack: uploadedExpressionsPack,\r\n\t\t\t} as ReplaceContentPackAction);\r\n\t\t});\r\n\r\n\t\tthis.leave();\r\n\t}\r\n\r\n\tprivate leave() {\r\n\t\tthis.$emit('leave');\r\n\t\tthis.method = null;\r\n\t\tthis.headGroup = null;\r\n\t\tthis.uploadedExpressions = [];\r\n\t}\r\n\r\n\tprivate removeUploadedExpression() {\r\n\t\tif (!this.currentUploadedExpression) return;\r\n\t\tconst expression = this.currentUploadedExpression;\r\n\t\tthis.currentUploadedExpression = null;\r\n\t\tif (expression.startsWith('blob:')) {\r\n\t\t\tURL.revokeObjectURL(expression);\r\n\t\t}\r\n\t\tlet idx = this.uploadedExpressions.indexOf(expression);\r\n\t\tthis.uploadedExpressions.splice(idx, 1);\r\n\t\tif (idx > this.uploadedExpressions.length - 1) {\r\n\t\t\tidx = this.uploadedExpressions.length - 1;\r\n\t\t}\r\n\t\tthis.currentUploadedExpression = this.uploadedExpressions[idx] || null;\r\n\t}\r\n\r\n\tprivate normalizeName(name: string): string {\r\n\t\tconst parts = name.split(':');\r\n\t\tlet actualName = parts[parts.length - 1];\r\n\t\tconst packId = parts.length > 1 ? parts[0].trim() : '';\r\n\r\n\t\tactualName = (\r\n\t\t\tactualName[0].toUpperCase() + actualName.slice(1).toLowerCase()\r\n\t\t)\r\n\t\t\t.split('_')\r\n\t\t\t.join(' ');\r\n\t\tif (packId.startsWith('dddg.') || packId === '') {\r\n\t\t\treturn actualName;\r\n\t\t}\r\n\t\treturn packId + ': ' + actualName;\r\n\t}\r\n\r\n\tprivate dragEnter(e: DragEvent) {\r\n\t\tif (!this.headGroup || this.method !== 'upload') return;\r\n\t\tif (!e.dataTransfer) return;\r\n\t\te.dataTransfer.effectAllowed = 'none';\r\n\t\tif (\r\n\t\t\t!Array.from(e.dataTransfer.items).find(item =>\r\n\t\t\t\titem.type.match(/^image.*$/)\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\te.dataTransfer.effectAllowed = 'link';\r\n\t\t(this.$refs.dt as DropTarget).show();\r\n\t}\r\n\r\n\tprivate hideDt() {\r\n\t\tif (this.$refs.dt) (this.$refs.dt as DropTarget).hide();\r\n\t}\r\n}\r\n\r\nconst charDefDefaults = {\r\n\ttype: 'character' as 'character',\r\n\tcharacterType: '',\r\n\tfreeMove: false,\r\n\tclose: false,\r\n\tstyleGroupId: 0,\r\n\tstyleId: 0,\r\n\tposeId: 0,\r\n\tposePositions: {},\r\n\tpanelId: '',\r\n\tid: '',\r\n\ty: 0,\r\n\tpreserveRatio: true,\r\n\tratio: 1,\r\n\topacity: 100,\r\n\tversion: 1,\r\n\tflip: false,\r\n\tonTop: false,\r\n};\r\n\r\ninterface IPose {\r\n\tname: string;\r\n\tstyleGroupId: number;\r\n\tstyleId: number;\r\n\tposeId: number;\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\ninterface IHeadGroup {\r\n\tname: string;\r\n\tpreview: string[];\r\n\tpartsFiles: string[];\r\n\timagePatching?: {\r\n\t\tmask?: string;\r\n\t\taddition?: string;\r\n\t};\r\n}\r\n\r\ninterface ICachedProcessedExpression {\r\n\turl: string;\r\n\taddMask: boolean;\r\n\taddExtras: boolean;\r\n\toffsetX: number;\r\n\toffsetY: number;\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--13-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--13-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=2622fa43&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=ts&\"\nexport * from \"./index.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=2622fa43&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2622fa43\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}